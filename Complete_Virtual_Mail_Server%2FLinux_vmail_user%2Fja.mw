<languages/>

== vmail ユーザ ==

メールボックスに保存するには、UNIX において有効なユーザ ID とグループ ID が必要ですので、メールボックスのほかにこれらの ID も作成せねばなりません。
* ほとんどのサービスには、1000 未満のシステム ID が割り当てられます
* Gentoo では、ユーザ ID は 1000 から始まります
* 5000 番が vmail ユーザのためにえらばれます

同じシステム上で数百ものシェルユーザがあれば、それらと異なる ID を割当てねばなりません。vmail グループも同様です。vmail は、誰にもシェルログインが不可能なアカウントにします。

{{RootCmd|groupadd -g 5000 vmail
|useradd -m -d /var/vmail -s /bin/false -u 5000 -g vmail vmail}}

{{Note|Nitpicking, specifying uid and gid isn't really required, but it's always tidy to think about it. After the users and groups have been added, it may wise to edit the {{Path|/etc/passwd}} and {{Path|/etc/group}} files and move the new user and group to an appropriate place. This because by default {{c|useradd}} and {{c|groupadd}} will increase the last found entry and thus a new user would be 5001. This obviously is only important if these files needed to be kept organized and clean.}}

== ストレージ領域 ==

次に検討すべきはメールストレージのことです。これはパーティションでも、NFS 共有でも、一般的なサブディレクトリでも構いません。ここでは上記のように、{{Path|/var/vmail}} にし、32 GiB の RAID10 のパーティションにすることにします。どこに保存するにせよ、所有者を適切に設定しなければなりません。

{{RootCmd|chown vmail:vmail /var/vmail/}}

また、権限も適切に設定せねばなりません:

{{RootCmd|chmod 2770 /var/vmail/}}

権限をよく確認して、事後にエラーの発生することのないようにしましょう:

{{RootCmd|ls -ld /var/vmail|output=
drwxrws--- 3 vmail vmail 4096 Aug  2 07:24 /var/vmail
}}

＝＝ vmail ユーザと Postfix ==

Postfix needs to know where and under what ownership to store mail.

{{Note|If required, this also can be looked up on a per user basis from the database. For example, when the maildirs are not located in a central directory, but in each users home directory. In this document, the vmail user is the only user to be allowed access, and thus this is not touched on.}}

{{FileBox|filename=/etc/postfix/main.cf|title=UID と GID　を postfix にひもつける|1=
# メールボックスの uid と gid を postfix にひもつける
virtual_uid_maps = static:5000
virtual_gid_maps = static:5000
 
# 全てのバーチャルメールボックスのベースディレクトリを設定する
virtual_mailbox_base = /var/vmail
}}

[[Category:Mail Servers]]
