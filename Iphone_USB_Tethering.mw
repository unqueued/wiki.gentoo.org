This page is inspired by [[Android_USB_Tethering]], and only documents the differences.

= Tested Devices =
* iPhone 4S, iOS5

= tools needed =
{{Package|app-pda/ipheth-pair}} found in [http://git.overlays.gentoo.org/gitweb/?p=dev/dberkholz.git;a=tree;f=app-pda/ipheth-pair dberkholz's overlay]. You can set up the overlay with [[Layman]].

{{Emerge|app-pda/ipheth-pair}}
= ipheth interface =
if ipheth-pair is installed successfully, plug in the iPhone with USE cable. We will see, e.g.
{{File|dmesg|iPhone ipheth|<pre>
[    2.080017] usb 8-1: new high-speed USB device number 2 using ehci_hcd
[    2.215940] usb 8-1: New USB device found, idVendor=05ac, idProduct=12a0
[    2.215946] usb 8-1: New USB device strings: Mfr=1, Product=2, SerialNumber=3
[    2.215950] usb 8-1: Product: iPhone
[    2.215953] usb 8-1: Manufacturer: Apple Inc.
[    2.215956] usb 8-1: SerialNumber: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
[   26.988569] ipheth 8-1:4.2: Apple iPhone USB Ethernet device attached
[   26.988939] usbcore: registered new interface driver ipheth
</pre>}}

A new network interface '''eth1''' plugged by ipheth can be found, after running dhcp on it, we can see:
{{RootCmd|ip a show eth1|output=<pre>
4: eth1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UNKNOWN qlen 1000
    link/ether 9e:20:7b:6b:94:bd brd ff:ff:ff:ff:ff:ff
    inet 172.20.10.2/28 brd 172.20.10.15 scope global eth1
    inet6 fe80::9c20:7bff:fe6b:94bd/64 scope link 
       valid_lft forever preferred_lft forever
</pre>}}

= udev trigger =
We can use [[OpenRC/Event Driven|hotplug feature of OpenRC]] to set up ipheth interface automatically.

{{Package|sys-fs/udev-init-scripts}} ships /lib/udev/net.sh, which can be used to hotplug network interfaces. The main frame of the script is
{{File|/lib/udev/net.sh|net interface hotplug|<pre>
IFACE=$1
ACTION=$2
...
SCRIPT=/etc/init.d/net.$IFACE
...
IN_HOTPLUG=1 "${SCRIPT}" --quiet "${ACTION}"
</pre>}}

and we can call it by an [[Udev|udev rule]],
{{File|/lib/udev/rules.d/90-iphone-tether.rules|net.sh trigger|<pre>
# udev rules for setting correct configuration and pairing on tethered iPhones
ATTR{idVendor}!="05ac", GOTO="ipheth_rules_end"

# Execute pairing program when appropriate
ACTION=="add", SUBSYSTEM=="net", ENV{ID_USB_DRIVER}=="ipheth", SYMLINK+="iphone", RUN+="ipheth-pair", RUN+="net.sh eth1 start"
SUBSYSTEM=="net", ACTION=="remove", ENV{ID_USB_DRIVER}=="ipheth", SYMLINK+="iphone", RUN+="net.sh %k stop"

LABEL="ipheth_rules_end"
</pre>}}

After plugging iPhone, we can see the hotplugged service:
{{RootCmd|rc-status|output=<pre>
...
Dynamic Runlevel: hotplugged
 net.eth1                        [  started  ]
...
</pre>}}
