<languages />

{{Metadata|abstract=Xorg ,est le serveur X Window qui permet aux utilisateurs de disposer d'un environnement graphique. Ce guide explique comment l'installer et le configurer.}}

Xorg is the [[X server|X Window server]] which allows users to have a graphical environment at their fingertips. This guide explains what Xorg is, how to install it, and the various configuration options.

== Qu'est-ce que le serveur X Window ? ==

=== Environnement graphique vs ligne de commande ===

L'utilisateur moyen peut être effrayé à l'idée d'avoir à taper des commandes. Pourquoi ne pourrait-il pas pointer avec la souris et cliquer pour se frayer son chemin dans l'espace de liberté procuré par Gentoo (et Linux en général) ? Eh bien, naturellement, il peut le faire ! Linux offre une grande variété d'interfaces utilisateur très attractives et des environnements que vous pouvez installer au-dessus de votre installation existante. 

C'est une des plus grandes surprises pour les nouveaux utilisateurs  de découvrir que l'interface utilisateur graphique, n'est rien d'autre qu'une application qui tourne sur leur système. Ce n'est ''pas'' une partie du noyau Linux, ou une autre fonctionnalité interne du système. C'est un outil puissant qui active complètement les capacités graphiques de votre station de travail. 

Comme les normes sont importantes, une norme pour dessiner et déplacer des fenêtres sur l'écran, interagissant avec l'utilisateur via la souris, le clavier et autres dispositifs, a été créée et nommée le ''système X Window''', couramment abrégé en ''X11'' ou tout simplement ''X''. Ce système est utilisé sur Unix, Linux et les systèmes d'exploitation basés sur Unix à travers le monde entier. 

L'application qui permet aux utilisateurs d'exécuter les interfaces graphiques et qui se base sur la norme X11 est Xorg-X11, un embranchement du projet XFree86. XFree86 ayant décidé d'utiliser une licence qui pourrait s'avérer incompatible avec la licence GPL, l'utilisation de Xorg est par conséquent recommandée. L'arbre de Portage ne contient plus de paquet XFree86 dorénavant.

=== Le projet X.org  ===

Le projet  [http://www.x.org X.org] a créé et tient à jour une mise en œuvre du système X11 librement distribuable et open-source. Il s'agit d'une infrastructure de bureau open-source basée sur X11. 

Xorg procure une interface entre votre matériel et l'application graphique que vous voulez exécuter. En plus de cela, Xorg est compatible avec le fonctionnement en réseau, ce qui signifie que vous pouvez exécuter une application sur un système tout en visualisant les résultats sur un autre. 

== Installer Xorg ==

Before you can install Xorg, you need to prepare your system for it. First, we'll set up the kernel to support input devices and video cards. Then we'll prepare {{Path|[[:/etc/portage/make.conf]]}} so that the right drivers and Xorg packages are built and installed. 

=== Prise en charge des pilotes de périphérique d'entrée ===

By default, Xorg uses <code>[[evdev]]</code>, a generic input driver. You'll need to activate support for <code>evdev</code> by making a change to your kernel configuration. Read the [[Kernel/Gentoo_Kernel_Configuration_Guide|Kernel Configuration Guide]] if you don't know how to setup your kernel. 

{{KernelBox|title=Enabling evdev in the kernel|<pre>
Device Drivers --->
  Input device support --->
  <*>  Event interface
</pre>
}}

[https://gitweb.gentoo.org/repo/gentoo.git/commit/?id=d3ac878318dd96a88190a13b5ac7572ec0c56380 make.defaults] has [[Libinput]] as the default input device driver.

=== Kernel modesetting ===

Modern open source video drivers rely on kernel mode setting (KMS). KMS provides an improved graphical boot with less flickering, faster user switching, a built-in framebuffer console, seamless switching from the console to Xorg, and other features.

{{Important|KMS conflicts with legacy framebuffer drivers, which must remain '''disabled''' in the kernel configuration.}}

First prepare the kernel for KMS. This step regardless of which Xorg video driver will be used: 

{{KernelBox|title=Disable legacy framebuffer support and enable basic console FB support|<pre>
Device Drivers --->
   Graphics support --->
      Frame Buffer Devices --->
         <*> Support for frame buffer devices --->
         ## (Disable all drivers, including VGA, Intel, nVidia, and ATI, except EFI-based Framebuffer Support, only if you are using UEFI)
 
    ## (Further down, enable basic console support. KMS uses this.)
    Console display driver support --->
      <*>  Framebuffer Console Support
</pre>
}}

Next configure the kernel to use the proper KMS driver for the video card. Intel, nVidia, and AMD/ATI are the most common cards, so follow code listing for each card below. 

For Intel cards see the [[Intel#Kernel|kernel section of the Intel article]].

Pour les cartes nVidia : 

{{KernelBox|title=nVidia settings|<pre>
Device Drivers --->
   Graphics support --->
      <*>  Nouveau (nVidia) cards
</pre>
}}

Pour les cartes AMD/ATI les plus récentes ([[ATI_FAQ|RadeonHD 2000 et postérieures]]), vous devrez installer {{Package|x11-drivers/radeon-ucode}} ou {{Package|sys-kernel/linux-firmware}}. Une fois que vous avez installé un de ces paquets, configurez votre noyau comme expliqué en détails dans  [[Radeon#Firmware|la section firmware ]] de la  [[Radeon|page Radeon]]:: 

{{KernelBox|title=AMD/ATI settings|<pre>
## (Setup the kernel to use the radeon-ucode firmware)
Device Drivers --->
   Generic Driver Options --->
   [*]  Include in-kernel firmware blobs in kernel binary
  ## # ATI card specific, (see Radeon page for details which firmware files to include)
   (radeon/<CARD-MODEL>.bin ...)
  ## # Specify the root directory
   (/lib/firmware/) External firmware blobs to build into the kernel binary
 
## (Enable Radeon KMS support)
Device Drivers --->
   Graphics support --->
   <*>    ATI Radeon
   [*]      Enable modesetting on radeon by default
   [ ]      Enable userspace modesetting on radeon (DEPRECATED)
</pre>
}}

{{Note|Old Radeon cards (X1900 series and older) do not need the {{Package|x11-drivers/radeon-ucode}} package or any firmware configuration.  For them simply enable the Direct Rendering Manager (DRM) and ATI Radeon modesetting.}}

{{Note|Linux kernel >{{=}} 3.9 does not have the ''Enable modesetting on radeon by default'' since it is already implied by default. Do not be alarmed if you find this option missing in new kernels.}}

Exit the kernel configuration, [[Kernel/Rebuild|rebuild the kernel, and reboot]].

Now that KMS has been set up, continue preparing {{Path|[[:/etc/portage/make.conf]]}} in the next section.

=== make.conf ===

Now that the kernel is prepared, two important variables in the {{Path|[[:/etc/portage/make.conf]]}} file must be configured before installing Xorg. 

The first variable is <var>[[:/etc/portage/make.conf#VIDEO_CARDS|VIDEO_CARDS]]</var>. This is used to set the video drivers that you intend to use and is usually based on the kind of video card you have. The most common settings are <code>nouveau</code> for nVidia cards or <code>radeon</code> for ATI cards. Both have actively developed, well-supported open-source drivers. 

{{Note|Vous pouvez aussi essayer les pilotes propriétaire de  nVidia et d'AMD/ATI, <code>nvidia</code> et <code>fglrx</code> respectivement. Cependant, définir les pilotes propriétaire sort du champ de ce guide. Reportez-vous au guide [[NVidia/nvidia-drivers|guide nVidia de Gentoo Linux ]] et à  la [[ATI_FAQ|FAQ ATI de Gentoo Linux]]. . Si vous ne savez pas quel pilote choisir, reportez-vous à ces guides pour plus d'informations.}}

Le pilote <code>intel</code> peut être utilisé pour les stations de travail ou les ordinateurs portables munis des jeux de circuits Intel courants intégrés. 

{{Note|The <var>VIDEO_CARDS</var> variable may contain more than one value as long as each value is separated by a space.}}

The second variable is [[:/etc/portage/make.conf#INPUT_DEVICES|<var>INPUT_DEVICES</var>]] and is used to determine which drivers are to be built for input devices. In most cases setting it to <code>[[libinput]]</code> or <code>[[evdev]]</code> should work just fine. If you use alternative input devices, such as a Synaptics touchpad for a laptop, be sure to add it to <var>INPUT_DEVICES</var>. 

Decide which drivers will be used and add necessary settings to the {{Path|[[:/etc/portage/make.conf]]}} file: 

{{CodeBox|title=Exemple d'entrées pour make.conf |lang=bash|1=
## (Pour la prise en charge de la souris, du clavier et du pavé tactile Synaptics)
INPUT_DEVICES="evdev synaptics"
## (Pour des cartes nVidia)
VIDEO_CARDS="nouveau"
## (Pour les cartes AMD/ATI)
VIDEO_CARDS="radeon"
}}

Si les définitions suggérées ne fonctionnent pas pour vous, vous devriez installer le paquet <code>emerge -pv xorg-drivers</code>, passer en revue toutes les options disponibles et choisir celles qui s'appliquent à votre système. Cet exemple est pour un système doté d'un clavier, d'une souris, d'un pavé tactile Synaptics et d'une carte vidéo Radeon. 

{{Emerge|x11-base/xorg-drivers|params+=--verbose|output=<pre>
 
These are the packages that would be merged, in order:
 
Calculating dependencies... done!
[ebuild   R   ]  x11-base/xorg-drivers-1.9  INPUT_DEVICES="evdev synaptics
-acecad -aiptek -elographics% -fpit% -joystick -keyboard -mouse -penmount -tslib
-virtualbox -vmmouse -void -wacom"
VIDEO_CARDS="radeon -apm -ark -ast -chips -cirrus -dummy -epson -fbdev -fglrx
(-geode) -glint -i128 (-i740) (-impact) -intel -mach64 -mga -neomagic (-newport)
-nouveau -nv -nvidia -r128 -rendition -s3 -s3virge -savage -siliconmotion -sis
-sisusb (-sunbw2) (-suncg14) (-suncg3) (-suncg6) (-sunffb) (-sunleo) (-suntcx)
-tdfx -tga -trident -tseng -v4l -vesa -via -virtualbox -vmware (-voodoo) (-xgi)"
0 kB
</pre>
}}

Après avoir défini toutes les variables nécessaires, Xorg peut être installé.

{{Emerge|xorg-server}}

{{Note|The {{Package|x11-base/xorg-x11}} meta-package could be installed instead of the more lightweight {{Package|x11-base/xorg-server}}. Functionally {{Package|x11-base/xorg-x11}} and {{Package|x11-base/xorg-server}} are the same, however {{Package|x11-base/xorg-x11}} brings in many more packages that most systems will probably not require. Additional packages include a large assortment of [[fonts]] in many languages. They are not necessary for a working X11 framework.}}

Dès que l'installation est terminée, vous devez réinitialiser quelques variables d'environnement avant de continuer :

{{RootCmd
|env-update
|source /etc/profile
}}

=== Utilisateurs NVidia ===

For NVidia users it might be beneficial to run {{c|nvidia-xconfig}} in order to generate a working {{Path|xorg.conf}} file for the selected graphics card. Without this step the {{Path|xorg.conf}} file will need to be created manually as described below. Missing the {{Path|xorg.conf}} will sometimes generate a "No screens found" error to the terminal when attempting to {{c|startx}}.

Also the NVidia driver will only work after a reboot, so be sure to restart the system after running {{c|nvidia-xconfig}}.

{{RootCmd|nvidia-xconfig}}

Il est possible - et même recommandé - de choisir le moteur de rendu OpenGL matériel plutôt que logiciel :

{{RootCmd|eselect opengl set nvidia}}

== Configurer Xorg ==

The [[X server]] is designed to work out-of-the-box, with no need to manually edit Xorg's configuration files. It ''should'' detect and configure devices such as displays, keyboards, and mice.

Vous devriez d'abord essayer  [[#using_startx| utiliser startx]] sans éditer aucun fichier de configuration. Si Xorg en démarre pas, où s'il y a un autre problème, alors vous devez configurer Xorg à la main comme expliqué dans la section qui suit. 

{{Note|If changes have been made to the kernel, do not forget to '''restart the system''' ''before'' using {{c|startx}} in order to be using the newly built kernel. If the kernel was updated to a newer version in the process this will most likely require the bootloader's configuration files to be updated as well.}}

=== Le répertoire  xorg.conf.d  ===

{{Important|Configuring files in {{Path|[[Xorg.conf#xorg.conf.d.2C_xorg.conf|xorg.conf.d]]}} should be seen as a last resort option. If possible it is desirable to run Xorg without any special configuration.}}

Most of the configuration files for Xorg are stored in {{Path|[[Xorg.conf#xorg.conf.d.2C_xorg.conf|/etc/X11/xorg.conf.d/]]}}. Each file is given a unique name and ends in {{Path|.conf}}. The file names in Xorg's configuration directory will be read in alpha numeric order. For example, {{Path|10-evdev.conf}} will be read before {{Path|20-synaptics.conf}}; {{Path|a-evdev.conf}} will be read before {{Path|b-synaptics.conf}}, and so on. The files in this directory are not required to be numbered, but doing so will help to keep them organized. Organization is helpful when debugging faulty configuration files.

{{Note|Xorg provides example configurations in {{Path|/usr/share/doc/xorg-server-${version}/xorg.conf.example.bz2}}. These can be used to create custom configuration files in {{Path|[[Xorg.conf#xorg.conf.d.2C_xorg.conf|/etc/X11/xorg.conf.d/]]}}. The examples are heavily commented, but if more documentation regarding the syntax is needed, {{c|man xorg.conf}} is always available. Other examples can be found in the section [[#Other_resources|Other resources]] at the end of this guide.}}

=== Utiliser  startx ===

Try {{c|startx}} to start up the [[X server]]. {{c|startx}} is a script (it's installed by {{Package|x11-apps/xinit}}) that executes an ''X session''; that is, it starts the [[X server]] and some graphical applications on top of it. It decides which applications to run using the following logic: 

* Si un fichier nommé  {{Path|.xinitrc}} existe dans le répertoire home, il exécute les commandes qu'il y trouve.

*  Otherwise, it will read the value of the <var>XSESSION</var> variable from the {{Path|/etc/env.d/90xsession}} file and execute the relevant session accordingly. Values for <var>XSESSION</var> are available in {{Path|/etc/X11/Sessions/}}. To set a system wide default session run:

: {{RootCmd|echo XSESSION{{=}}"Xfce4" > /etc/env.d/90xsession}}

: This will create the {{Path|90xsession}} file and set the default X session to [[Xfce/Guide|Xfce]]. Remember to run {{c|env-update}} after making changes to {{Path|90xsession}}.

{{Cmd|startx}}

Si vous n'avez pas encore installé un gestionnaire de fenêtres, vous verrez un écran noir. Comme cela peut aussi être le signe que quelque chose ne va pas, vous devriez installer <code>twm</code> et <code>xterm</code> ''juste pour tester X'' . 

Once the programs are installed, run {{c|startx}} again. A few {{c|xterm}} windows should appear, making it easy to verify the [[X server]] is working correctly. Once satisfied with the results, unmerge {{Package|x11-wm/twm}} and {{Package|x11-terms/xterm}} if installed in the step above to remove the testing packages. They will not be needed to setup a proper desktop environment.

The session (program to start) could also be given as an argument to {{c|startx}}:

{{Cmd|startx /usr/bin/startfluxbox}}

You can also pass X11 server options, by preceding them with a double dash:

{{Cmd|startx -- vt7}}

== Peaufiner les réglages de  X  ==

=== Définir votre  résolution d'écran ===

If the screen resolution looks to be wrong, you will need to check two sections in your {{Path|[[Xorg.conf#xorg.conf.d.2C_xorg.conf|xorg.conf.d]]}} configuration. First of all, you have the ''Screen'' section which lists the resolutions that your [[X server]] will run at. This section might not list any resolutions at all. If this is the case, Xorg will estimate the resolutions based on the information in the second section, ''Monitor''. 

Now let us change the resolution. In the next example from {{Path|/etc/X11/xorg.conf.d/40-monitor.conf}} we add the <code>PreferredMode</code> line so that our [[X server]] starts at 1440x900 by default. The <code>Option</code> in the <code>Device</code> section must match the name of your monitor (<code>DVI-0</code>), which can be obtained by running {{c|xrandr}}. Install {{c|xrandr}} ({{c|emerge xrandr}}) just long enough to get this information. The argument after the monitor name (in the <code>Device</code> section) must match the <code>Identifier</code> in the <code>Monitor</code> section. 

{{RootCmd|nano -w /etc/X11/xorg.conf.d/40-monitor.conf|output=<pre>
Section "Device"
  Identifier  "RadeonHD 4550"
  Option      "Monitor-DVI-0" "DVI screen"
EndSection
Section "Monitor"
  Identifier  "DVI screen"
  Option      "PreferredMode" "1440x900"
EndSection
</pre>
}}

Run X ({{c|startx}}) to discover it uses the desired resolution.

=== Moniteurs multiples ===

More than one monitor in can be established in {{Path|[[Xorg.conf#xorg.conf.d.2C_xorg.conf|/etc/X11/xorg.conf.d/]]}}. Give each monitor a unique identifier, then list its physical position, such as "RightOf" or "Above" another monitor. The following example shows how to configure a DVI and a VGA monitor, with the VGA monitor as the right-hand screen: 

{{RootCmd|nano -w /etc/X11/xorg.conf.d/40-monitor.conf|output=<pre>
Section "Device"
  Identifier "RadeonHD 4550"
  Option     "Monitor-DVI-0" "DVI screen"
  Option     "Monitor-VGA-0" "VGA screen"
EndSection
Section "Monitor"
  Identifier "DVI screen"
EndSection
Section "Monitor"
  Identifier "VGA screen"
  Option     "RightOf" "DVI screen"
EndSection
</pre>
}}

=== Configurer le clavier ===

To setup X to use an international keyboard create the appropriate config file in {{Path|[[Xorg.conf#xorg.conf.d.2C_xorg.conf|/etc/X11/xorg.conf.d/]]}}. This example features a Czech keyboard layout: 

{{RootCmd|nano -w /etc/X11/xorg.conf.d/30-keyboard.conf|output=<pre>
Section "InputClass"
        Identifier "keyboard-all"
        Driver "evdev"
        Option "XkbLayout" "us,cz"
        Option "XkbModel" "logitech_g15"
        Option "XkbRules" "xorg"
        Option "XkbOptions" "grp:alt_shift_toggle,grp:switch,grp_led:scroll,compose:rwin,terminate:ctrl_alt_bksp"
        Option "XkbVariant" ",qwerty"
        MatchIsKeyboard "on"
EndSection
</pre>
}}

For methods of switching the keyboard layout see the [[Keyboard_layout_switching#X11|Keyboard layout switching]] article.

La commande ''terminate'' ( <code>terminate:ctrl_alt_bksp</code> ) vous permet de tuer la session X à l'aide de la combinaison de touches Ctrl-Alt-Backspace. Néanmoins, ceci provoque une sortie de X disgracieuse -- quelque chose que vous ne souhaitez pas toujours. Cela peut être utile, lorsque des programmes figent votre écran totalement, ou quand vous peaufinez la configuration de votre environnement Xorg.
Soyez prudent en tuant votre environnement de bureau de cette manière -- la plupart des programmes n'aiment pas ça et peuvent perdre une partie ( voire la totalité) des données sur lesquelles vous étiez en train de travailler.

=== Pour terminer ===

Run {{c|startx}} and be happy about the result. Congratulations, you now (hopefully) have a working Xorg! The next step is to install a useful window manager or desktop environment such as [[KDE]], [[GNOME]], or [[Xfce]]. Information on installing these desktop environments can be found here on the wiki.

== Voir aussi ==

* [[Wayland]] - The next generation window manager for Linux.
* [[Security Handbook/Securing services#X|X (Security Handbook)]] - The Security Handbook's entry on securing the X server.

== Ressources ==

=== Créer et éditer les fichiers de  configuration ===

{{c|man xorg.conf}} and {{c|man evdev}} provide quick yet complete references about the syntax used by these configuration files. Be sure to have them open on a terminal when editing Xorg configuration files! 

Il existe aussi beaucoup de ressources en ligne sur l'édition des fichiers de configuration dans {{Path|/etc/X11/}}. Nous nous contentons d'en donner quelques unes ici ; utilisez [http://www.google.com Google] pour en savoir plus.

=== Autres ressources ===

More information about installing and configuring various graphical desktop environments and applications can be found in the [[Category:Desktop|Gentoo desktop resources]] section of our documentation. 

When upgrading to xorg-server 1.9 or higher, be sure to read the [[X_server/upgrade|migration guide]]. 

X.org fournit beaucoup de  [http://www.x.org/wiki/FAQ FAQs]  sur son site WEB, en plus de la documentation.

{{Migrated|originalauthors={{Dev|SwifT}}, {{Dev|nightmorph}}}}
[[Category:X.Org]]
