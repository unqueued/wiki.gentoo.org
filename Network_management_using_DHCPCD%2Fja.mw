<languages />
この記事は [https://forums.gentoo.org/viewtopic-t-965190.html Gentoo Forum の投稿] をもとに書いたもので、完全なネットワークスタック管理に dhcpcd を用いる方法を述べています。

== セットアップ ==

[[Dhcpcd|dhcpcd]] をインストールしてください。つぎに、default ランレベルに追加し、サービスを始動させます:

{{RootCmd
|rc-update add dhcpcd default
|/etc/init.d/dhcpcd start
}}

This setup deviates from the default networking instructions in the Gentoo Handbook. It has the advantage that it provides automatic switching between wired and wireless network interfaces.

== 無線 ==

無線には {{c|wpa_supplicant}} を使用します。以下のいずれかを行いましょう
* [https://gentoo.org/support/news-items/2016-01-08-some-dhcpcd-hooks-are-now-examples.html 10-wpa_supplicant] フックを {{Path|dhcpcd-hooks}} ディレクトリにコピーしdhcpcd を再始動
* [[wpa_supplicant]] を [https://forums.gentoo.org/viewtopic-t-1036958-start-9.html CONFIG_MATCH_IFACE] オプションを用いて設定し、サービスとして実行

フックをインストールするには:

{{RootCmd|cp /usr/share/dhcpcd/hooks/10-wpa_supplicant /lib/dhcpcd/dhcpcd-hooks|/etc/init.d/dhcpcd restart}}

{{Important/ja|このフックを使うのであれば、wpa_supplicant は、どのランレベルにも追加しないでください。}}

{{c|wpa_supplicant}} の方法で行うなら、[[Wpa_supplicant#Setup_for_dhcpcd_as_network_manager| Gentoo wiki の wpa_supplicant のページ]]をみてください。

== テスト ==

{{c|dhcpcd}} と {{c|wpa_supplicant}} を停止させ、デバッグを有効にした状態で {{c|dhcpcd}} を実行します。{{c|dhcpcd}} が接続処理を進める過程がフォアグラウンドで表示されますので確認します。

{{RootCmd|/etc/init.d/dhcpcd stop
|killall wpa_supplicant
|dhcpcd -dB
|output=<pre>
dhcpcd[23772]: version 6.4.5 starting
dhcpcd[23772]: udev: starting
dhcpcd[23772]: dev: loaded udev
...
...
</pre>}}

== 静的 IP アドレス ==

ネットワークインタフェイスカードによっては [[Static_Routing|静的 IP アドレス]]で設定することを要します。その場合は [[dhcpcd-ui#Usage|GUI]] で設定してください。もしくは、[[Dhcpcd#Static_IP_addresses]] にかかれているように、{{Path|/etc/dhcpcd.conf}} に項目を[http://roy.marples.name/man/html5/dhcpcd.conf.html 自ら記載する]ことでも設定可能です。

== Gentoo net.* スクリプトからの移行 ==

When migrating from [[netifrc|Gentoo's net.* scripts]] it is essential to remove the {{Path|net.*}} scripts from the runlevels.

{{Cmd|rc-config list {{!}} grep 'wpa_supplicant\{{!}}dhcpcd\{{!}}net.'|output=<pre>
  net.wlp8s0                default
  dhcpcd                    default</pre>}}

Any match starting with <code>net.</code> must not have a runlevel assigned. In the above example, {{Path|net.wlp8s0}} needs to be removed.

{{RootCmd|rc-update del net.wlp8s0
|/etc/init.d/net.wlp8s0 stop}}

Once the network setup works well, it is possible to completely remove the old Gentoo {{Path|net.*}} scripts. To do so, disable the <code>netifrc</code> useflag, re-emerge OpenRC and finally unmerge {{Package|net-misc/netifrc}}:

{{RootCmd|echo 'sys-apps/openrc -netifrc' >> /etc/portage/package.use
|emerge --ask --newuse --oneshot sys-apps/openrc
|emerge --ask --depclean net-misc/netifrc}}

Also the old configuration files and symlinks can be removed:

{{RootCmd|rm /etc/conf.d/net
|rm /etc/init.d/net.*}}

== Network dependent services ==

Manipulating [[Network_dependent_services|network dependent services]] by {{c|dhcpcd}} is no longer supported since openrc-0.16.4.

== GUI ==

A [[dhcpcd-ui|dhcpcd graphical user interface]] is provided by {{Package|net-misc/dhcpcd-ui}}.

== 参考 ==

* [[Dhcpcd]]
* [[dhcpcd-ui]]

== 外部の情報 ==

* [https://forums.gentoo.org/viewtopic-t-965190-start-93.html Post 93 of Gentoo Forums :: View topic - TIP: Complete network stack without net.* scripts]


[[Category:Network_management]]
