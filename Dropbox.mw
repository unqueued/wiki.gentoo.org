Dropbox is [[Article description::a closed source file synchronization and cloud service utility built from open and closed source software.]]

== Installation ==

=== USE flags ===

{{USEflag|package=net-misc/dropbox}}

=== Emerge ===

{{Emerge|{{Package|net-misc/dropbox}}}}

== Configuration ==

Set the <var>DROPBOX_USERS</var> variable to the regular user name in {{Path|/etc/conf.d/dropbox}}

{{RootCmd|nano -w /etc/conf.d/dropbox}}

<code>DROPBOX_USERS="user_name"</code>

Next, add the Dropbox init script to the default runlevel:

{{RootCmd|rc-update add dropbox default}}

Now as a regular user run the command line shown below:

{{Cmd|dropbox start}}

Which will create these directories in the user's directory:

* {{Path|Dropbox/}}
* {{Path|.dropbox-dist/}}
* {{Path|.dropbox/}}

{{Note|The command line above will also launch the Dropbox login window. Enter credentials or register an existing account to finish up the installation.}}

{{Note|The instructions shown above will not result in a GUI launcher for Dropbox being integrated into the window manager or desktop environment, so it seems. At least, some users have reported with XFCE4. A Dropbox launcher may need to be created for each desktop environment.}}

=== Xfce ===

==== Launcher ====

To create a Dropbox launcher for Xfce, 

Download an [https://www.dropbox.com/sh/y30u5e1hnnqmv22/AADAMMM-gFutPWsm_tDDAR8ka/png?dl=0 icon] and copy it into the {{Path|/opt/dropbox/images/hicolor/16x16/}} directory.

Here is a screenshot of the the launcher properties window:

[[File:dropbox_launcher_screenshot.png|352x409px]]

=== KDE ===

==== KDE4 ====
Adding Dropbox ServiceMenu to Dolphin, which allows easy access to most of Dropbox features. It uses Dropbox CLI to generate public urls, and pyndexer to allow sharing directories in public folder.

Download [http://kde-apps.org/CONTENT/content-files/124416-DropboxServiceMenu-0.16.1.tar.gz scripts] and unzip it.
{{Cmd|tar xvzf *DropboxServiceMenu*.tar.gz}}

Then you can use install script, which makes it all himself.

{{Cmd|./install-it.sh}}

After install you must some edit script, because original script-set no longer development (but it still works good).

{{Cmd|nano ~/.kde4/share/kde4/services/ServiceMenus/dropbox-scripts/dropbox_menu.sh}}

Find 37 line

<code>dropbox_path=`${SCRIPTS_PATH}get_dropbox_folder.sh`</code>

And change it to:

<code>dropbox_path="$HOME/Dropbox"</code>

Don't forget add dropbox-daemon to autorun in systemsettings.

[[File:Kde-dropbox-10.png|459x402px]]

==== KDE Plasma 5 ====

KDE Plasma dropped support for legacy Xembed-based systray support. In order for the systray icon to appear Plasma needs to be built with legacy systray support. Please refer to the [[KDE/Plasma_5_upgrade#Missing_systray_icons|Plasma 5 page]] for details. Dropbox integration with Dolphin is provided by {{Package|kde-apps/dolphin-plugins}} when the <code>dropbox</code> USE flag is enabled:

{{USEflag|package=kde-apps/dolphin-plugins}}

{{Emerge|kde-apps/dolphin-plugins}}

=== Init systems ===

==== Systemd ====

For {{c|systemd}} users: enable it, passing a username as the instance identifier:

{{RootCmd|systemctl enable dropbox@<user_name>}}

Be sure to replace <code><user_name></code> in the example above with an appropriate user name.

By default, service will not display a tray-icon because it does not know which display to use. To repair this edit service:

{{RootCmd|systemctl edit dropbox@<user_name>}}

{{CodeBox|title=Adding display for DropBox|lang=ini|1=
[Service]
Environment=DISPLAY=:0
}}

== Troubleshooting ==

=== Dropbox says it's an old version ===

When you start dropbox and return the error of it's an old version of dropbox, you can have some problems, between their version to some problems of dropbox, please, follow the following steps, their can help you to solve the problem

==== Step 1: Unmasking the later version ====

unmask the latest version for your architecture, you can found the information in {{package|net-misc/dropbox}}

===== x86 =====

{{RootCmd|echo -e "net-misc/dropbox ~x86" >> /etc/portage/package.accept_keywords}}

===== amd64 =====

{{RootCmd|echo -e "net-misc/dropbox ~amd64" >> /etc/portage/package.accept_keywords}}

==== Step 2: Dropbox not create the .dropbox-dist ====

Another problem is that dropbox does not install the dropboxd daemon, it's on {{path|.dropbox-dist}} folder of their user's home, for force to Dropbox to install it you must install the CLI version (don't uninstall nothing) and force the installation of the daemon

{{RootCmd|emerge --ask net-misc/dropbox-cli
}}

Creating the daemon's folder:

{{Cmd|dropbox-cli start -i}}

Starting Dropbox:

{{Cmd|dropbox start}}

if it does not start now, keep calm and follow the next step

==== Step 3: Dropbox does not start now ====

At this time, you have a problem between the GL library installed by dropbox called {{Path|libGL.so.1}} , it conflicts with your X, to solve the problem, remove it, its inside {{Path|~/.dropbox-dist/dropbox-lnx.{Dropbox's version}/}}, remove it

{{Cmd| rm ~/.dropbox-dist/dropbox-lnx.x86_64-3.10.11/libGL.so.1| dropbox start
}}

Sometimes is is also necessary to remove the DRM library from {{Path|~/.dropbox-dist/dropbox-lnx.{Dropbox's version}/}}, remove it

{{Cmd| rm ~/.dropbox-dist/dropbox-lnx.x86_64-3.10.11/libdrm.so.2| dropbox start
}}

=== Crash with nvidia-drivers ===

When trying to launch Dropbox on a system with nVidia proprietary drivers ({{Package|x11-drivers/nvidia-drivers}}) Dropbox wouldn't start. It turns out that the problem is related to a bundled {{Path|libGL.so.1}} library inside the Dropbox installation.

In order to fix this it is necessary to remove this library and let Dropbox use the system-provided version. This is already done by the ebuild, however Dropbox is automatically updating itself into {{Path|~/.dropbox-dist/}} so it is necessary to also remove the library from there.

{{Cmd|rm ~/.dropbox-dist/dropbox-lnx.x86_64-3.8.8/libGL.so}}

=== Don't show Dropbox icon on KDE/Plasma's systray ===

make sure that you added the "legacy-systray" support and understand all issues mentioned in [[KDE/Plasma_5_upgrade#Missing_systray_icons|Plasma 5 page]]

Resume of adding legacy-systray suport for KDE/Plasma:

{{RootCmd
|echo "kde-plasma/plasma-desktop legacy-systray gtk2 gtk3 qt4" >> /etc/portage/package.use
|emerge --ask dev-libs/sni-qt libappindicator:2 libappindicator:3
|emerge --ask --update --deep --verbose --tree --newuse kde-plasma/plasma-desktop
}}

If it does not works for you, make sure that you are on the latest version ({{Keyword|~x86}}, {{Keyword|~amd64}},...) and, stop the service, remove the following files and restart dropbox from the user's bash.

Stopping Dropbox:

{{RootCmd|rc-service dropbox stop}}

Deleting some files (make sure that's your adding your Dropbox's Version on {Dropbox's Version}) and restarting dropbox:

{{Cmd
|rm .dropbox-dist/dropbox-lnx.{Dropbox's Version}/libQt5*
|rm .dropbox-dist/dropbox-lnx.{Dropbox's Version}/qt.conf
|rm .dropbox-dist/dropbox-lnx.{Dropbox's Version}/plugins/platforms/libqxcb.so
|dropbox
}}

===  libffi.so.6 missing ===

'''ERROR:'''<br />
ImportError: libffi.so.6: cannot open shared object file: No such file or directory


If you tried to start Dropbox after installing it and got the followingÀê

{{Cmd|dropbox start|collapse-output=true|output=<pre>
dropbox: locating interpreter
dropbox: logging to /tmp/dropbox-antifreeze-qeteiz
dropbox: initializing
dropbox: initializing python 3.5.4
dropbox: setting program path '/opt/dropbox/dropbox'
dropbox: setting home path '/opt/dropbox'
dropbox: setting python path '/opt/dropbox:/opt/dropbox/python-packages-35.zip'
dropbox: python initialized
dropbox: running dropbox
dropbox: setting args
dropbox: applying overrides
dropbox: running main script
dropbox: load fq extension '/opt/dropbox/cryptography.hazmat.bindings._constant_time.cpython-35m-x86_64-linux-gnu.so'
Traceback (most recent call last):
  File "dropbox/__init__.pyc", line 8, in <module>
  File "dropbox/overrides.pyc", line 517, in <module>
  File "dropbox/overrides.pyc", line 418, in __ssl_wrap_socket_internal_ca_certs
  File "dropbox/ssl/revoked_certs.pyc", line 9, in <module>
  File "cryptography/x509/__init__.pyc", line 9, in <module>
  File "cryptography/x509/base.pyc", line 16, in <module>
  File "cryptography/x509/extensions.pyc", line 18, in <module>
  File "cryptography/hazmat/primitives/constant_time.pyc", line 9, in <module>
  File "<_bootstrap_overrides>", line 153, in load_module
ImportError: libffi.so.6: cannot open shared object file: No such file or directory
!! dropbox: fatal python exception:
['Traceback (most recent call last):\n', '  File "dropbox/__init__.pyc", line 8, in <module>\n', '  File "dropbox/overrides.pyc", line 517, in <module>\n', '  File "dropbox/overrides.pyc", line 418, in __ssl_wrap_socket_internal_ca_certs\n', '  File "dropbox/ssl/revoked_certs.pyc", line 9, in <module>\n', '  
File "cryptography/x509/__init__.pyc", line 9, in <module>\n', '  File "cryptography/x509/base.pyc", line 16, in <module>\n', '  File "cryptography/x509/extensions.pyc", line 18, in <module>\n', '  File "cryptography/hazmat/primitives/constant_time.pyc", line 9, in <module>\n', '  File 
"<_bootstrap_overrides>", line 153, in load_module\n', 'ImportError: libffi.so.6: cannot open shared object file: No such file or directory\n'] (error 3)
Aborted
</pre>}}

'''SOLUTION'''
 {{Note|You need to have {{Package|dev-libs/libffi}} installed before proceeding with the symlink.}}

a) Since it's looking for a <code>libffi.so.6</code>, just make another symlink in <code>/usr/lib64</code> so that Dropbox is able to start properly:
{{RootCmd|prompt=/usr/lib64 #|ln -sv libffi.so.7 libffi.so.6|output=<pre>
'libffi.so.6' -> 'libffi.so.7'
</pre>}}

b) Look for missing lib using <code>e-file</code> command which is present in [https://packages.gentoo.org/packages/app-portage/pfl app-portage/pfl].

{{Cmd|e-file libffi.so.6}}

Move the missing lib to a predefined location. <code>/usr/lib*</code> by default.

== See also ==

* [[SparkleShare]] - An open source Dropbox alternative based on [[Git]].
* [[Owncloud]] - A self-hosted, cloud aware, sync service containing features similar to Dropbox.

[[Category:Software]]
[[Category:Closed source software]]
