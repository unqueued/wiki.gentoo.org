<languages />
<translate>
{{InfoBox stack
|{{InfoBox gdoc|Overlays|text=Overlays Gentoo Project|header=true}}
}}

<!--T:2-->
Within Gentoo Linux, users already have one "main" package repository, called the Portage tree. This main repository contains all the software packages (called ebuilds) maintained by Gentoo developers. But users can add additional repositories to the tree that are "layed over" the main tree - hence the name, overlays.

<!--T:3-->
Since package repositories are nothing more (or less) than a set of files (ebuilds, metadata files, ChangeLog entries ...) these repositories can be pulled in from public repositories (git, cvs, svn ...) or downloaded as tarballs and extracted manually onto the system. It is advised to use managed repositories by trusted third parties; any installed overlay will cause Portage to look through the overlayed files when deciding which software to install. If compromised code is in the overlay, then compromised packages could be installed on the system. 

== Repositories == <!--T:4-->

Additional package trees are usually hosted by ''repositories''. These are overlays that are ready to be incorporated on Gentoo systems. The now default approach for handling repositories is through {{Path|[[:/etc/portage/repos.conf]]}} which, like many other Portage related locations, can be a directory as well.

A deprecated, yet still supported method is to use the <code>PORTDIR_OVERLAY</code> variable inside {{Path|make.conf}}. This variable can point to one or more additional locations on the file system where repositories are available. The use of the {{Path|repos.conf}} location is preferred though.

Repository definitions inside {{Path|repos.conf}} also inform Portage if and how the repository can be updated. With it, calling <tt>emerge --sync</tt> will automatically update the repositories as well.

For more information, see [[:/etc/portage/repos.conf]] and [[Project:Portage/Sync#Operation]].

=== Priorities === <!--T:16-->

<!--T:17-->
Each overlay has its unique priority. This makes sure that in the case of a specific version being found in several overlays, the resolution is unambiguous. Ebuilds from overlays with higher priorities take precedence over ebuilds from overlays with lower priorities.

<!--T:42-->
The list of overlays with their priorities can be obtained through the output of the following command (look for the "Repositories" string):

<!--T:43-->
{{Cmd|emerge --info --verbose}}

<!--T:44-->
The default Gentoo Portage tree will have a priority of -1000. That means that all other overlays generally take precedence as they are assigned a higher priority. That is the default behavior, because overlays are designed to "lay over/on top" of the portage tree.

== Supporting tools ==

A number of tools support or integrate with overlays.

=== Layman ===

The <tt>layman</tt> application makes it easier to manage and update multiple additional overlays. It is a command-line application 
through which publicly available overlays can be listed, subscribed to and unsubscribed from, as well as update those repositories. 

It supports both the <code>PORTDIR_OVERLAY</code> as well as {{Path|repos.conf}} method.
* When using <code>PORTDIR_OVERLAY</code>, <tt>layman</tt> manages a dedicated configuration file which should be sourced in by {{Path|make.conf}}
* When using {{Path|repos.conf}}, <tt>layman</tt> manages files inside the {{Path|repos.conf/}} directory directly

<!--T:13-->
For more information, see [[Layman]].

=== emaint ===

See [[Project:Portage/Sync#Operation]].

=== eix === <!--T:30-->
{{:Overlay/eix-sync}}

=== Crossdev === <!--T:8-->

<!--T:9-->
[[crossdev]] will automatically place the ebuilds/categories it generates into the first overlay found in <code>PORTDIR_OVERLAY</code>. Most users will want to prevent [[crossdev]] from disturbing [[layman]]'s overlays or the user's personal per-machine overlay (normally created at {{Path|/usr/local/portage}}). Create an overlay specifically for [[crossdev]]'s use:

<!--T:39-->
{{RootCmd|mkdir -p /usr/local/portage-crossdev/profiles
|echo local-crossdev > /usr/local/portage-crossdev/profiles/repo_name}}

<!--T:10-->
Then instruct Portage and crossdev to use this overlay:

<!--T:40-->
{{FileBox|filename=/etc/portage/make.conf|title=Let crossdev to store its ebuild in local-crossdev and indicate that the local overlay should override every other overlay|lang=bash|1=
source /var/lib/layman/make.conf
PORTDIR_OVERLAY="/usr/local/portage-crossdev ${PORTDIR_OVERLAY} /usr/local/portage"
}}

<!--T:11-->
{{FileBox|filename=/etc/portage/make.conf|title=Prevent crossdev from messing with the local overlay when not using layman|lang=bash|1=
PORTDIR_OVERLAY="/usr/local/portage-crossdev /usr/local/portage"
}}

== Best practices ==

=== Cache generation === <!--T:26-->

<!--T:27-->
When large overlays are installed, portage may take a long time to perform operations like dependency resolution. This is because overlays do not usually contain a metadata cache.

<!--T:28-->
Generate a local metadata cache by running <tt>emerge --regen</tt> after syncing the overlays:

<!--T:29-->
{{RootCmd
|layman -S
|emerge --regen}}

<!--T:58-->
Be careful, because <tt>emerge --regen</tt> takes a lot of time and it's not recommended for rsync users as rsync updates the cache using server-side caches (most of users of portage are rsync users). Rsync users should simply run <tt>emerge --sync</tt> (or <tt>eix-sync</tt>) to regenerate the cache. It's probably only users of very large overlays should try <tt>emerge --regen</tt>.

=== Masking when using unsafe overlays === <!--T:23-->

<!--T:24-->
When using huge overlays or those with unknown/low quality it is best practice to hardmask the whole overlay.

<!--T:47-->
{{FileBox|filename=/etc/portage/package.mask|title=Mask all packages in an overlay|lang=bash|1=
*/*::overlay-name
}}

<!--T:48-->
After that unmask the packages that will be installed.

<!--T:49-->
{{FileBox|filename=/etc/portage/package.unmask|title=Unmask a specific package in an overlay|lang=bash|1=
foo/bar::overlay-name
}}

== See also == <!--T:60-->

<!--T:61-->
* [[Project:Overlays]] - The official Gentoo project for overlays support.
* [[Project:Overlays/User_Guide]] - A user guide written by the Overlay project.

</translate>

[[Category:Portage]]
