<languages />

Dit artikel beschrijft de stappen om naar een nieuwe [[kernel]] te upgraden.

== Installatie ==

Een kernel upgrade is mogelijk nodig wanneer nieuwe kernel broncode is geïnstalleerd na een systeem update of wanneer je zelf nieuwe kernel broncode installeert.

== Configuratie ==

De configuratie staat parallel aan dat van een [[Kernel/Configuration|manuele configuratie]], omdat enkel het configuratie bestand word hergebruikt. Alle stappen zijn hier vermeld voor de volledigheid, voor een meer gedetailleerde uitleg kan het andere artikel gelezen worden.

=== Zet de symbolische link ===

De symbolische link {{Path|/usr/src/linux}} zou altijd naar de kernel broncode moeten verwijzen die momenteel gebruikt word. Dit kan in een van de volgende drie manieren gedaan worden:

; 1. Installeer de kernel broncode met een actieve ''symlink'' [[USE flag]].
: Dit zal de {{Path|/usr/src/linux}} doen verwijzen naar de nieuw geïnstalleerde kernel broncode. Indien nodig, kan dit nog steeds aangepast worden met de volgende twee methoden:

; 2. Zet de symbolische link met '''eselect''':

: {{RootCmd| eselect kernel list |
  |output=Available kernel symlink targets:<br /> &nbsp; [1] linux-3.3.8-gentoo *<br /> &nbsp; [2]   linux-3.4.9-gentoo}}

: Dit toont de beschikbare kernel broncodes. Het sterretje toont de huidig gekozen kernel broncode aan. Om de kernel broncode te veranderen, bijvoorbeeld de tweede optie, doet u:

: {{RootCmd|eselect kernel set 2}}

; 3. De symbolische link manueel zetten:

: {{RootCmd|ln -sf /usr/src/linux-3.4.9 /usr/src/linux |
  |ls -l /usr/src/linux |
  |output=lrwxrwxrwx 1 root root 11 Aug 29 22:10 /usr/src/linux -> /usr/src/linux-3.4.9-gentoo}}

=== De broncode opkuisen ===
Als je de huidige kernel wil herbouwen, zal je de huidige kernel broncode moeten opruimen:
{{RootCmd|make distclean}}

=== Kopieer de vorige kernel configuratie ===
De configuratie van de huidige kernel die je draait dient gekopieerd te worden naar de nieuwe. Het kan in verschillende plaatsen gevonden worden:

* In het [[procfs]] bestandssysteem, als de kernel optie ''Kernel .config support'' werd geactiveerd in jouw huidige kernel:

: {{RootCmd|zcat /proc/config.gz > /usr/src/linux/.config}}

* In de map {{Path|/boot}}, als je het configuratie bestand daar had geïnstalleerd:

: {{RootCmd|cp /boot/config-3.3.8-gentoo /usr/src/linux/.config}}

* In de kernel map van de huidige kernel die je draait:

: {{RootCmd|cp /usr/src/linux-3.3.8-gentoo/.config /usr/src/linux/}}

=== make oldconfig ===
Nu vernieuwen we het vorige configuratie bestand voor jouw nieuwe kernel:

{{RootCmd|cd /usr/src/linux
|make oldconfig}}

The following configuration parallels that of the text based configuration with '''make config'''. For every difference between the kernel versions, it asks if you want to activate the driver or feature. An example:

{{RootCmd|make oldconfig
|output=Anticipatory I/O scheduler (IOSCHED_AS) [Y/n/m/?] (NEW)
}}

The string ''(NEW)'' at the end of the line marks this option as new. Left to the string in square brackets are the possible answers: ''Y''es, ''n''o, ''m''odule or ''?'' to show the help. The recommend answer is capitalized (here ''Y''). The help explains the option or driver.

Unfortunately '''make oldconfig''' doesn't show - next to the help - a lot more information for each option, like the context, so that it is sometimes difficult to give the right answer. In this case the best way to go is to remember the option name and revise it afterwards through one of the [[Kernel/Configuration#Configuration tools|graphical kernel configuration tools]].

== Reinstall external kernel modules ==

Any external kernel modules, such as [[:Category:Binary kernel modules|binary kernel modules]], need to be rebuilt for each new kernel. If the kernel hasn't been built yet, it has to first be prepared for the building of the external kernel modules:

{{RootCmd|make modules_prepare}}

You can rebuild the packages using the ''@module-rebuild'' set:

{{Emerge|@module-rebuild}}

== Build ==

For this step, follow the steps in the [[Kernel/Configuration#Build|manual configuration]] article.

== Removing old kernels ==

See the [[Kernel/Removal|kernel removal]] article. 

== External resources ==

* [http://kernelnewbies.org/LinuxChanges kernel changelog with some explanations of new features]

[[Category:Kernel]]
