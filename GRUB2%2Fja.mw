<languages />
{{InfoBox stack
|{{InfoBox homepage|http://www.gnu.org/software/grub/|header=true}}
|{{InfoBox wikipedia|GNU_GRUB#GRUB 2}}
}}

'''GRUB2''' はモダンなコンピュータをサポートするブートローダです。これは、古い[[GRUB]]ブートローダ(今では"GRUB Legacy"と呼ばれています)を置き換えることを意図されています。GRUB2はGRUB Legacyとは完全に分離したコードベースを持ち、進化したスクリプティングを可能にする新しいシェルライクなシンタックスを誇りにしています。現在のGRUB LegacyユーザはシステムをGRUB2に移行することが推奨されます。

ショットガンアプローチが必要なら、[[GRUB2 Quick Start]]を参照してください。

== インストール ==

{{Package|sys-boot/grub}} パッケージはスロット化されています。grub-0.97([[GRUB|GRUB Legacy]]) と grub-2.00 は同時にインストールされることができますが、MBRにはどちらか1つのバージョンのGRUBのみをインストールすることができます。この記事では、GRUB2について解説します。

デフォルトでは、GRUB2はデフォルトのプラットフォームターゲットをビルド時に推測します。これは {{Path|make.conf}} において <var>GRUB_PLATFORMS</var> 変数をセットすることでオーバーライドできます。

{{FileBox|filename=/etc/portage/make.conf|title=EMU, EFIとPCをサポートするGRUB_PLATFORMS変数の設定例|lang=bash|1=
GRUB_PLATFORMS="emu efi-32 efi-64 pc"
}}

ターゲットのCPU毎に、次のプラットフォームがサポートされています:

{| class="table"
!
! colspan="7" | Target
|-
! Platform
! i386
! ia64
! mips
! mipsel
! powerpc
! spac64
! x86_64
|-
! arc
| {{No}}
| {{No}}
| {{No}}
| {{Yes}}
| {{No}}
| {{No}}
| {{No}}
|-
! coreboot
| {{Yes}}
| {{No}}
| {{No}}
| {{No}}
| {{No}}
| {{No}}
| style="background: PaleTurquoise; text-align: center" | 32-bit
|-
! efi
| {{Yes}}
| {{Yes}}
| {{No}}
| {{No}}
| {{No}}
| {{No}}
| {{Yes}}
|-
! emu
| {{Yes}}
| {{Yes}}
| {{Yes}}
| {{Yes}}
| {{Yes}}
| {{Yes}}
| {{Yes}}
|-
! ieee1275
| {{Yes}}
| {{No}}
| {{No}}
| {{No}}
| {{Yes}}
| {{Yes}}
| style="background: PaleTurquoise;  text-align: center" | 32-bit
|-
! loongson
| {{No}}
| {{No}}
| {{No}}
| {{Yes}}
| {{No}}
| {{No}}
| {{No}}
|-
! multiboot
| {{Yes}}
| {{No}}
| {{No}}
| {{No}}
| {{No}}
| {{No}}
| style="background: PaleTurquoise; text-align: center" | 32-bit
|-
! qemu
| {{Yes}}
| {{No}}
| {{No}}
| {{No}}
| {{No}}
| {{No}}
| style="background: PaleTurquoise; text-align: center" | 32-bit
|-
! qemu-mips
| {{No}}
| {{No}}
| {{Yes}}
| {{No}}
| {{No}}
| {{No}}
| {{No}}
|-
! pc
| {{Yes}}
| {{No}}
| {{No}}
| {{No}}
| {{No}}
| {{No}}
| style="background: PaleTurquoise; text-align: center" | 32-bit
|-
|}

通常のemergeシンタックスを用いてGRUB2をインストールします。

{{Emerge|sys-boot/grub:2|params+=--newuse}}

必要なら、{{c|os-prober}} ユーティリティ({{Package|sys-boot/os-prober}} で提供されます)をインストールして、{{c|grub2-mkconfig}} コマンドを実行した際にGRUB2が他のオペレーティングシステムを探索するようにしてください。たいていの場合、これでGRUB2が自動で他のオペレーティングシステム(Windows 7, Windows 8.1 など)を検出できるようになります。

{{Emerge|sys-boot/os-prober|params+=--newuse}}

GRUB2(と、場合によっては{{Package|sys-boot/os-prober}})をインストールしても、ブートローダは自動では有効になりません。これらは、オペレーティングシステムにソフトウェアをインストールするのみで、(システムのブート時にそれが使われるようにするために)システムそのものにブートローダをインストールするには、追加のステップが必要になります。これについては[[#Configuration|設定]]セクションで解説します。

== 設定 ==

GRUB2 の設定には２つの重要な作業があります:
# GRUB2 のソフトウェアを、システムのブートローダーとしてインストール
# GRUB2 ブートローダー自体の設定

GRUB2ソフトウェアのインストールはシステムのタイプによってそれぞれ異なり、[[#Installing the boot loader|ブートローダーのインストール]]で解説します。まず、ブートローダそのものの設定について解説します。

=== メインの設定ファイル ===

grubの設定を生成するために、{{c|grub2-mkconfig}} スクリプトを使います。これは {{Path|/etc/grub.d/*}} 以下のスクリプト及び {{Path|/etc/default/grub}} 設定ファイルを用い、最終的な {{Path|/boot/grub/grub.cfg}} を――GRUB2自体が使用する唯一の設定ファイルを――生成します。 

{| class="table"
|-
! ファイル !! フォーマット !! 編集すべきか? !! 説明
|-
| {{Path|/usr/sbin/grub2-mkconfig}} || POSIX シェルスクリプト || {{No}} || {{Package|sys-boot/grub}}:2 パッケージの一部としてインストールされます。 下に説明されるファイルを設定した後、このスクリプトを実行して {{Path|/boot/grub/grub.cfg}} を生成します。
|-
| {{Path|/boot/grub/grub.cfg}} || GRUB2 シェルスクリプト || {{No}} || {{c|grub2-mkconfig}} が生成するファイルです。このファイルはGRUB2のビルトインスクリプトインタプリタによって評価されるもので、必ずしもすべてのPOSIXコマンドやシンタックスをサポートするものではありません。サポートされる機能については、GRUBマニュアルの [https://www.gnu.org/software/grub/manual/grub.html#Shell_002dlike-scripting scripting reference] を参照してください。このファイルに対する変更は、次回 grub2-mkconfig が実行されたとき保持されないことに注意してください。
|-
| {{Path|/etc/grub.d/*}} || POSIX シェルスクリプト || {{Partial|Maybe}} || {{Path|/etc/grub.d/*}} 以下の、実行可能属性がセットされたスクリプトは順番に評価され、標準出力が結合されて最終的な {{Path|/boot/grub/grub.cfg}}(もしくは {{c|grub2-mkconfig}} <code>-o</code> オプションで指定された何らかのファイル)を形成します。これらのスクリプトはその時のシステムのシェルを使うので、あらゆるサポートされたシンタックスを使うことができます。理想的にはPOSIX互換のスクリプトであるべきであり、また、出力されるスクリプトはGRUB2のインタプリタと互換性のあるものでなければなりません。スクリプトを無効にしたり追加したりすることが必要かもしれません。例えば、自動では生成できないようなメニュー項目を追加したい時など。
|-
| {{Path|/etc/default/grub}} || POSIX シェルスクリプト || {{Yes}} || ほとんどの場合、直接変更されるべきファイルはこのファイルただ一つです。これは主に、 {{Path|/etc/grub.d}} のスクリプトで用いられる変数を設定して、使える設定ファイルを生成するために利用されます。サポートされる変数については、[[GRUB2/Config_Variables|GRUB2 configuration variables]] もしくは [https://www.gnu.org/software/grub/manual/grub.html#Simple-configuration official reference] を参照してください。
|}

GRUB2は、([[GRUB|GRUB Legacy]] や [[LILO]] のような)管理者によるブートオプション設定の手動での維持を必要としません。その代わりに、{{c|grub2-mkconfig}} コマンドを用いて、設定ファイル({{Path|/boot/grub/grub.cfg}})を生成することができます。このユーティリティは {{Path|/etc/grub.d/}} にあるスクリプトと {{Path|/etc/default/grub}} の設定を使用します。

{{Warning|ソフトウェアRAIDを使用しているとき、{{c|grub2-mkconfig}} ユーティリティは正しく動作しません。{{Path|/etc/grub.d/}} にあるスクリプトの手動設定が必要になり、そうしなければ、インストール後にシステムはブート不能な状態におかれることになるでしょう。}}

何らかの設定を変更したら、{{c|grub2-mkconfig}} ユーティリティを {{Path|/boot/grub/grub.cfg}}にある出力ファイル(これはGRUB2のデフォルトの出力場所です)を指定した <code>-o</code> オプション付きで実行します:

{{RootCmd|grub2-mkconfig -o /boot/grub/grub.cfg|output=<pre>
Generating grub.cfg ...
Found linux image: /boot/vmlinuz-3.3.0-gentoo
done
</pre>}}

{{c|grub2-mkconfig}} ユーティリティが呼ばれるたびに、新しい設定が生成されます。 

{{Warning|もし {{c|grub2-mkconfig}} が見つかった項目を報告してこない場合、それはひとつも項目が見つかっていないということです。この場合、GRUB2はシステムの再起動のあとブートオプションをひとつも提供してくれないことになり、解決に時間のかかるトリッキーな状況になるかもしれません。システムを再起動する前に、出力が申し分ないかどうか確かめてください。}}

=== 設定パラメータのセット ===

{{Path|/etc/default/grub}} にある次の変数はGRUB2がどのように機能するかをコントロールするために設定される最も一般的なものです:

{| class="table"
! 変数
! 説明
! デフォルト値
|-
| <var>GRUB_DEFAULT</var>
| ブート時に最初に選択される項目を定義する変数です。番号の数字かメニュータイトル、あるいは"saved"を設定します。
| 最初に検出された項目がデフォルトになります。
|-
| <var>GRUB_TIMEOUT</var> 
| デフォルトのメニュー項目をブートする前の遅延を秒で指定します。<code>0</code>に設定すると瞬時にブートし、<code>-1</code>にすると無期限に待ちつづけます。
| デフォルトは5秒です。
|-
| <var>GRUB_CMDLINE_LINUX</var>
| すべてのLinuxメニュー項目のカーネルコマンドラインに与える引数を設定します。例えば、ハイバーネーションをサポートするためには、swapパーティションが {{Path|/dev/sdXY}} なら、 <code>GRUB_CMDLINE_LINUX="resume=/dev/sdXY"</code> を追加する必要があります。
| 
|-
| <var>GRUB_CMDLINE_LINUX_DEFAULT</var>
| リカバリ以外のLinuxメニュー項目のカーネルコマンドラインに与える引数を設定します。
| 
|-
| <var>GRUB_DEVICE</var> 
| 初期ルートデバイス(つまり、カーネルの <code>root=</code> 引数)を設定します。これを設定すると、 {{c|grub2-mkconfig}} コマンドの自動検知したルートデバイスがオーバーライドされます。例えば、 <code>GRUB_DEVICE=/dev/ram0</code> と設定すると、カーネルコマンドラインで強制的に <code>root=/dev/ram0</code> が使われるようになります。
| 
|}

より完全なリストについては、[[GRUB2/Config_Variables|GRUB2 configuration variables]]サブページを参照してください。

パラメータを変更したら、{{c|grub2-mkconfig}} でGRUB2の設定ファイルを再生成してください。

=== 設定スクリプトの有効化と無効化 ===

{{Path|/etc/grub.d/}} ディレクトリには、 {{c|grub2-mkconfig}} が {{Path|grub.cfg}} ファイルの生成に用いるスクリプトが含まれます。デフォルトでは、このディレクトリの中身は次のようなものであるはずです:

{{Cmd|ls /etc/grub.d/|output=<pre>
00_header  10_linux  20_linux_xen  30_os-prober  40_custom  41_custom README
</pre>}}

GRUB2は、インストールされたスクリプトのうち、実行可能に設定されたすべてのスクリプト(デフォルトでは全部がそうです)を利用します。いずれかのスクリプトを無効にするには、 {{c|chmod}} コマンドを用い、単にスクリプトのファイルパーミッションから実行可能ビットを取り除いてください。次の例では、 {{Path|00_header}} と {{Path|10_linux}} を除く全てのスクリプトを無効にします。

{{RootCmd|chmod -x /etc/grub.d/<nowiki>{</nowiki>20_linux_xen,30_os-prober,40_custom,41_custom<nowiki>}</nowiki>}}

スクリプトを変更したり、実行可能ビットを取り除いたりした後は、 {{c|grub2-mkconfig}} を用いてGRUB2の設定ファイルを再生成してください。

=== 設定スクリプトに手を加える ===

Some features or GRUB2 functionalities are only possible to be exploited by modifying the configuration scripts. For instance, to support dual-booting with FreeBSD, the following manipulation needs to be done.

{{Path|/etc/grub.d/40_custom}} スクリプトを以下のように変更します:  

{{FileBox|filename=/etc/grub.d/40_custom|title=デュアルブートの追加|<pre>
menuentry "FreeBSD" --class freebsd --class bsd --class os {
 insmod ufs2
 insmod bsd
 set root=(hd0,1)
 kfreebsd /boot/kernel/kernel
 kfreebsd_loadenv /boot/device.hints
 set kFreeBSD.vfs.root.mountfrom=ufs:/dev/ada0s1a
 set kFreeBSD.vfs.root.mountfrom.options=rw
 set kFreeBSD.hw.psm.synaptics_support=1
}
</pre>}}

{{Path|/dev/sda1}} もしくは <code>(hd0,1)</code> が、FreeBSDが置かれているパーティションです。FreeBSDパーティションに通常のUFSインストールが行われたなら、{{Path|/dev/sda1}} はコンテナになっています(論理パーティションのようなものです)。これはswapとルートパーティションからなります。{{c|ls -la /etc/grub.d/40_custom}} を実行し、{{Path|40_custom}} が実行可能であることを確認してください。もし実行可能ビットがセットされていない場合は、{{c|chmod u+x 40_custom}} コマンドでセットしてください。  

次に、{{c|grub2-install}} コマンドを用いてGRUB2をインストールし、GRUB2の設定ファイルを更新してください。

{{RootCmd|grub2-install /dev/sda
|grub2-mkconfig -o /boot/grub/grub.cfg}}

== ブートローダーのインストール ==

GRUB2をシステムのブートローダーとしてインストールする方法は、システムがどのようにブートするのか(BIOSかUEFIか)と、ブートローダーがインストールされるディスクがどのようにパーティションされているのか(パーティションレイアウトがMBRかGPTか)によって変わってきます。

この記事では次の場合についてをカバーします:

* [[#BIOS と MBR|BIOS と MBR]]
* [[#BIOS と GPT|BIOS と GPT]]
* [[#UEFI と GPT|UEFI と GPT]]

システムに対して適切なインストール方法の解説を選んでください。

=== BIOS と MBR ===

{{Note|When the system is meant to dual-boot with Microsoft Windows, make sure that the system itself does ''not'' have an EFI firmware. Even when such systems are booted in 'legacy BIOS' mode, Microsoft Windows will refuse to boot.}}

{{Path|/boot}} を確実に利用可能にしてください。もしこれが独立したパーティションなら、確実にマウントしてください:

{{RootCmd|mount /boot}}

関連するファイルを {{Path|/boot/grub}} にコピーするために、 {{c|grub2-install}} コマンドを実行してください。PCプラットフォームではさらに、これによってマスターブートレコード(MBR)かパーティションのブートセクタにブートイメージがインストールされます。もしすべてがうまくいけば、 {{c|grub2-install}} の実行後、以下のような出力が得られることが期待されます:

{{RootCmd|grub2-install /dev/sda|output=<pre>
Installation finished. No error reported.
</pre>}}

{{c|grub2-install}} は、CPUアーキテクチャとシステムプラットフォームを指定するための <code>--target</code> オプションを受け付けます。指定しなかった場合、 {{c|grub2-install}} は適切な値を推測しようとします。{{Keyword|amd64}}/{{Keyword|x86}} システムにおいては、デフォルトで <code>i386-pc</code> が使用されます。 {{c|grub2-install}} はまた、GRUB2のブートファイルを探す場所をGRUB2インストーラに知らせるための <code>--boot-directory</code> オプションを受け付けます。これはデフォルトでは {{Path|/boot}} ですが、ルートパーティションを移動しようとしている場合などに有用です。

==== BIOS と MBR でのパーティショニング ====

最初のパーティションの前に十分な空き領域を用意しておいてください。最初のパーティションをセクタ2048で開始すれば、少なくとも1MiBのディスク領域がマスターブートレコードに残されることになります。GRUBのための"BIOSブートパーティション"とよばれる追加パーティションを作成することが(必須ではありませんが)推奨されます。このパーティションは定義される必要があるだけで、フォーマットは必要ありません。

もし[[Handbook:Main_Page|Gentoo installation instructions]]に従ったのなら、BIOSブートパーティションはすでに有効なはずです。

=== BIOS と GPT ===

{{Note|When the system is meant to dual-boot with Microsoft Windows, make sure that the system itself does ''not'' have an EFI firmware. Even when such systems are booted in 'legacy BIOS' mode, Microsoft Windows will refuse to boot. Also, older Microsoft Windows systems might not support GPT. It is possible to use a hybrid MBR-GPT approach, see [[Hybrid partition table]].}}

もし {{Path|/boot}} パーティションが必要ならば、 {{Path|/boot}} パーティションのマウントから始めましょう。

{{RootCmd|mount /boot}}

すべてがうまくいけば、 {{c|grub2-install}} コマンドの実行後、以下のような出力が得られることが期待されます:

{{RootCmd|grub2-install /dev/sda|output=<pre>
Installation finished. No error reported.
</pre>}}

{{c|grub2-install}} は、CPUアーキテクチャとシステムプラットフォームを指定するための <code>--target</code> オプションを受け付けます。指定しなかった場合、 {{c|grub2-install}} は正しい値を推測しようとします。{{Keyword|amd64}}/{{Keyword|x86}} システムにおいては、デフォルトで <code>i386-pc</code> が使用されます。 {{c|grub2-install}} はまた、GRUB2のブートファイルを探す場所をGRUB2インストーラに知らせるための <code>--boot-directory</code> オプションを受け付けます。これはデフォルトでは {{Path|/boot}} ですが、ルートパーティションを移動しようとしている場合などに有用です。

==== BIOS と GPT でのパーティショニング ====

GPTパーティションテーブルがシステムに存在するとき、タイプ <code>EF02</code> の小さな"BIOSブートパーティション"(タイプ <code>EF00</code> の"EFIシステムパーティション(ESP)"とは異なります)を有効にする必要があります。動作させるには1MiBで十分ですが、2-4MiBがより安全な選択でしょう。このBIOSブートパーティションがブートローダーのステージ2を保持することになります。BIOSブートパーティションはファイルシステムでフォーマットされる必要はありません。{{c|grub2-install}} コマンドが独自のファイルシステムで既存のファイルシステムを上書きします。

{{Important|Readers should be aware the BIOS boot partition is ''not'' the same partition that is commonly mounted at {{Path|/boot}}. The {{Path|/boot}} and BIOS boot different partitions and should be handled separately. BIOS boot partition should ''not'' be regularly mounted on the system (e.g. it should ''not'' be defined in {{Path|/etc/fstab}}). The {{Path|/boot}} partition ''can'' be regularly mounted with no issues and therefore can be present in the {{Path|/etc/fstab}} file.}}

パーティションをBIOSパーティションとして設定するには、コマンドラインツールの {{c|parted}} ({{Package|sys-block/parted}}) を用い、以下のようにタイプしてください(<code>1</code>をBIOSブートパーティションに設定したいパーティションの番号に置きかえてください!):

{{RootCmd|set 1 bios_grub on|prompt=(parted) |color=white}}

{{Package|sys-apps/gptfdisk}} の {{c|cgdisk}} ユーティリティでは、これはパーティションタイプを <code>0xEF02</code> に設定し、 <code>gptbios</code> というラベルを設定することで全うされます。

EFIシステムパーティションは必要ではありませんが、システムのマザーボードがEFIのボードにアップグレードされたとき、後からこれに変更できるよう、BIOSブートパーティションを十分大きくしておくのはまともな判断でしょう。

次に示すのは、BIOSブート [0xEF02] パーティションとEFI [0xEF00] パーティションの両方を含むGPTパーティションのディスクで {{c|gdisk}} ユーティリティを用い、 {{Key|p}} キーを押したときの出力です:

{{RootCmd|gdisk /dev/sdc|output=<pre>
GPT fdisk (gdisk) version 0.8.1
 
Partition table scan:
  MBR: protective
  BSD: not present
  APM: not present
  GPT: present
 
Found valid GPT with protective MBR; using GPT.
 
Command (? for help): p
Disk /dev/sdc: 976773168 sectors, 465.8 GiB
Logical sector size: 512 bytes
Disk identifier (GUID): AA369F4D-37A4-4C0D-A357-DC24B99A6337
Partition table holds up to 128 entries
First usable sector is 34, last usable sector is 976773134
Partitions will be aligned on 2048-sector boundaries
Total free space is 2014 sectors (1007.0 KiB)
 
Number  Start (sector)    End (sector)  Size       Code  Name
   1            2048       828377087   395.0 GiB   8E00  Linux LVM
   2       828377088       891291647   30.0 GiB    0700  Microsoft basic data
   3       891291648       975177727   40.0 GiB    0700  Microsoft basic data
   4       975177728       976754687   770.0 MiB   8300  Linux filesystem
   5       976754688       976756735   1024.0 KiB  EF02  BIOS boot partition
   6       976756736       976773134   8.0 MiB     EF00  EFI System
 
Command (? for help): 
</pre>}}

{{Note|{{c|fdisk}}をGPTで用いるときは、十六進数の<code>0x</code>接頭辞の入力は必要ありません。}}

同様のセットアップに対し、{{c|parted}} ユーティリティはやや異なる記法で出力を返します:

{{RootCmd|parted /dev/sdc|output=<pre>
GNU Parted 3.0
Using /dev/sdc
(parted) print
...
Sector size (logical/physical): 512B/512B
Partition Table: gpt
  
Number  Start   End    Size    File system  Name                  Flags
 1      1049kB  424GB  424GB                Linux LVM             lvm
 2      424GB   456GB  32.2GB               Microsoft basic data
 3      456GB   499GB  42.9GB               Microsoft basic data
 4      499GB   500GB  807MB   ext2         Linux filesystem
 5      500GB   500GB  1049kB               BIOS boot partition   bios_grub
 6      500GB   500GB  8396kB               EFI System            boot
  
(parted)
</pre>}}

{{c|gdisk}} でのパーティションの作成は、すでに {{c|fdisk}} パーティショニングユーティリティに慣れているユーザーにとっては理解しやすいでしょう。{{c|gdisk}} を開始したら、メインメニューで(newを意味する) {{Key|n}} をタイプし、(必要なら)開始と終了のセクタを与え、EFIシステムパーティションに <code>EF00</code> パーティションタイプを設定してください。

[[Handbook:Main_Page|Gentoo installation instructions]]に従ったユーザーならば、すでに適切なパーティションレイアウトに設定されているはずです。

=== UEFI と GPT ===

Make sure that the {{Path|/boot}} location is available - if this uses a separate partition, make sure that it is mounted:

{{RootCmd|mount /boot}}

Run the {{c|grub2-install}} command to copy the relevant files to {{Path|/boot/grub}}. This should install Grub2 in {{Path|/boot/grub}}, copy the core image to {{Path|/boot/efi/EFI/gentoo/grubx64.efi}}, and call [[Efibootmgr|efibootmgr]] to add a boot entry.

{{RootCmd|grub2-install --efi-directory{{=}}/boot/efi|output=<pre>
Installation finished. No error reported.
</pre>}}

上のコマンドは、vfatのEFIシステムパーティション(ESP)が {{Path|/boot/efi}} にマウントされていることを前提にします。もしESPが {{Path|/boot}} に直接マウントされているなら、<code>--efi-directory=/boot</code> としてください。 

{{c|grub2-install}} also accepts a <code>--target</code> option to set the CPU architecture and system platform. If unspecified, {{c|grub2-install}} will attempt to guess the proper values; on an AMD64 EFI-booted system it will use <code>x86_64-efi</code> by default. {{c|grub2-install}} also accepts a <code>--boot-directory</code> option to tell the GRUB2 installer which directory to look for GRUB2's boot files. This defaults to {{Path|/boot}} but is useful when trying to move a root partition.

==== UEFI と GPT でのパーティショニング ====

GRUB2によるUEFI GPTブートには、システムに''必ず''FATファイルシステムを含んだ専用のパーティションが必要です。

The EFI partition can ''replace'' having a {{Path|/boot}} partition on {{Path|/dev/sda1}} by having a {{Path|/boot/efi}} partition on {{Path|/dev/sda1}}. This is to say a successful EFI boot scenario using GRUB2 ''can'' operate with two partitions total (three total if a swap partition is needed): a root partition and an EFI partition. Using this configuration, the {{Path|/boot}} ''folder'' will be located in the root {{Path|/}} ''partition'' (at {{Path|/boot}}) and the EFI ''partition'' will mount ''in'' the boot ''folder'' (at {{Path|/boot/efi}}). For further clarification, see the example {{Path|/etc/fstab}} file below.

{{FileBox|filename=/etc/fstab|title=UEFIに対応したswapパーティションを含む {{Path|/etc/fstab}} ファイルの例:|<pre>
/dev/sda1		/boot/efi	vfat		noauto,noatime	1 2
/dev/sda2		none		swap		sw		0 0
/dev/sda3		/		ext4		noatime		0 1
</pre>}}

Generating a 100MB partition for {{Path|/boot/efi}} should provide plenty of space for holding multiple {{Path|*.efi}} files (multiple entries will most likely not be needed; most systems will only use one).

Create the partition using the partitioning [[Partition#GUID_Partition_Table|tool of choice]]. The {{c|gdisk}} ({{Package|sys-apps/gptfdisk}}) and {{c|parted}} ({{Package|sys-block/parted}}) tools fit nicely for this purpose. When using the {{c|gdisk}} utility, be sure to use type <code>EF00</code>.

Proceed to create a FAT filesystem on the EFI system partition using {{c|mkdosfs}} and add it to {{Path|/etc/fstab}} by following the example below:

{{RootCmd|mkdosfs -F 32 -n efi-boot /dev/sda1
|mkdir /boot/efi}}

{{FileBox|filename=/etc/fstab|title=Adding the /boot/efi mount entry|<pre>
/dev/sda1		/boot/efi	vfat		noauto,noatime	1 2
</pre>}}

{{RootCmd|mount /boot/efi}}

{{Note|It is helpful to set the <var>GRUB_PLATFORMS</var> variable in {{Path|/etc/portage/make.conf}}. This will assist GRUB2 in determining what options to use when detecting the proper EFI target. For 32-bit EFI systems use <code>efi-32</code>. For 64-bit use <code>efi-64</code>.}}

{{Important|In order for GRUB2 to install properly, the EFI directory ''must'' be mounted ''and'' the <code>efivars</code> kernel module must be loaded before the {{c|grub2-install}} command will complete successfully.}}

==== 代替案: デフォルトのUEFIファームウェアの場所を利用する ====

If the system's UEFI firmware fails to find GRUB2's EFI bootloader file, using the default boot loader location should provide a working solution. This circumvents the boot menu managed by [[Efibootmgr|efibootmgr]] and thus offers reduced functionality, but is less error prone. To do this, verify the EFI partition is mounted at {{Path|/boot/efi}} then copy the file {{Path|grubx64.efi}} located at {{Path|/boot/efi/EFI/gentoo/grubx64.efi}} to {{Path|/boot/efi/EFI/BOOT/BOOTX64.EFI}}. This example assumes a 64-bit EFI system, adjust accordingly for 32-bit EFI systems.

== 拡張機能 ==

GRUB2は、その多くの機能によって、非常にパワフルなブートローダーとなっています。サポートされる機能は:

* Booting from UEFI platforms.
* Booting from GPT partitioned drives without needing a hybrid MBR (hybrid MBR can enabled as needed for compatibility or portability).
* Booting from a [[btrfs]] formatted {{Path|/boot}} partition.
* Booting directly from a [[btrfs]] raid set without needing an [[initramfs]] for early mount setup.
* Booting directly from logical volume management (such as [[LVM|LVM2]]).
* Booting with support for DM-RAID (RAID 0, 1, 4, 5, 6, 9 and 10).
* Booting from encrypted devices (LUKS).

Some specific features are explained in more detail next.

=== チェーンロード ===

GRUB2 was built with a truly improved chainload mode when compared to GRUB Legacy. To chainload another boot loader, use the <code>chainloader</code> option.

{{FileBox|filename=/boot/grub/grub.cfg|title=Chainloading another bootloader|<pre>
menuentry "Custom Super Bootloader Example" {
     insmod part_msdos
     insmod chain
     chainloader (hd1,1)+1
}
</pre>}}

For more information on chainloading, please see the [[GRUB2/Chainloading|Chainloading]] sub-page.

=== フレームバッファディスプレイを使う ===

To have GRUB2 use a [[framebuffer]] graphical display, re-emerge GRUB with the <code>truetype</code> USE flag enabled. This will install a default True Type font as well as a font conversion utility.

{{Emerge|--newuse sys-boot/grub:2}}

Proceed to configure the default GRUB2 configuration file located at {{Path|/etc/default/grub}}. For example:

{{FileBox|filename=/etc/default/grub|title=フレームバッファに関する設定|lang=bash|1=
# 解像度と色深度の設定
GRUB_GFXMODE=1366x768x32
 
# カーネルのロードの際に解像度を保つ
GRUB_GFXPAYLOAD_LINUX=keep
 
# 背景画像の設定
GRUB_BACKGROUND="/boot/grub/bg.png"
 
# grub2-mkfontユーティリティで変換したカスタムフォントを使う
GRUB_FONT="/boot/grub/fonts/roboto.pf2"
}}

システムのグラフィックカードがどのディスプレイモードをサポートしているか調べるためには、GRUB2シェルで以下に示すコマンドを使ってください:

{{Cmd|prompt=(grub)|color=white|insmod all_video|videoinfo}}

== トラブルシューティング ==

ほとんどの問題は、正しいパーティションレイアウトを確実に設定することで解決できます。ディスクの最初のパーティションの前に十分な領域を確保するか、任意で確実に"BIOSブートパーティション"が利用できるようにしてください。さらに、{{Path|/boot/grub/grub.cfg}} が {{c|grub2-mkconfig}} で正しく生成されているか確認するか、あるいはカスタムのメニュー項目で生成してください。

さらなるGRUB2のトラブルシューティングについては、[[GRUB2/Troubleshooting|Troubleshooting]]サブ記事を参照してください。

== 参考 ==

There are a few specific GRUB2 resources available:

* In [[GRUB2/Chainloading|Chainloading]] the use of GRUB2 to boot other boot loaders is described. This is important to read when dual-booting systems, or when GRUB2 needs to be configured to boot ISO files.
* In [[GRUB2/AdvancedStorage|Advanced storage]] the necessary steps are documented on how to install and use GRUB2 on more advanced storage situations, such as software RAID, logical volumes or encrypted file systems.
* In [[GRUB2/Config_Variables|Configuration variables]] an exhaustive list of GRUB2 configuration variables, as used by {{Path|/etc/default/grub}}, is documented.
* In [[GRUB2/Troubleshooting|Troubleshooting]] a list of common GRUB2 errors (with their solutions) is presented.
* In [[Hybrid_partition_table|Hybrid partition table]] the use of a mixed MBR/GPT setup is documented, as well as how to use such hybrid partition layout with GRUB2.

== 外部の情報 ==

さらなる情報については、以下を参照してください:

* [https://www.gnu.org/software/grub/manual/grub.html GNU GRUB 2 manual page]
** [https://www.gnu.org/software/grub/manual/grub.html#Network Network (PXE) section of GRUB2]
* [http://www.rodsbooks.com/gdisk/bios.html Legacy BIOS issues with GPT article]
* [http://www.rodsbooks.com/gdisk/hybrid.html GPT and Hybrid MBR article]
* [http://www.rodsbooks.com/gdisk/ GPT fdisk utility page]
* [https://wiki.archlinux.org/index.php/GRUB2 Arch Linux GRUB2 wiki article]
* [https://fedoraproject.org/wiki/GRUB_2?rd=Grub2#Encountering_the_dreaded_GRUB_2_boot_prompt Fedora GRUB2 wiki article : Encountering the dreaded GRUB2 boot prompt]
* [https://help.ubuntu.com/community/UEFIBooting ubuntu UEFI booting help]
* [http://unix.stackexchange.com/questions/109272/dualboot-freebsd-gentoo-with-grub2-mbr http://unix.stackexchange.com/questions/109272/dualboot-freebsd-gentoo-with-grub2-mbr]


[[Category:Bootloaders]]
