<languages />

{{Metadata|abstract=Apache HTTP Server è un server web espandibile ed efficiente, uno dei più popolari utilizzati su Internet.}}

{{InfoBox stack
|{{InfoBox homepage|http://httpd.apache.org|header=true}}
|{{InfoBox wikipedia|Apache HTTP Server}}
|{{InfoBox github|apache/httpd}}
 	+	
|{{InfoBox project|Apache}}
}}

'''Apache HTTP Server''' è un [[:Category:Web Servers|web server]] efficiente ed espandibile, uno dei più popolari utilizzati in Internet.

== Installazione ==

{{Note/it|Quando si aggiorna la versione di Apache, vedere la  [http://www.gentoo.org/proj/it/apache/doc/upgrading.xml guida].}}

=== USE flags ===

{{USEflag|package=www-servers/apache}}

=== Emerge ===

Se si vuole utilizzare l'evento Apache MPM, bisogna aggiungere al file make.conf la seguente riga:
{{FileBox|filename=/etc/portage/make.conf|title=Apache event MPM|lang=bash|1=
APACHE2_MPMS="event"
}}

Se si vuole utilizzare Il worker apache MPM, bisogna aggiungere al file make.conf la seguente riga:
{{FileBox|filename=/etc/portage/make.conf|title=Apache worker MPM|lang=bash|1=
APACHE2_MPMS="worker"
}}

Ed attivare la USE flag threads su Apache:
{{FileBox|filename=/etc/portage/package.use|title=Apache threads support|lang=bash|1=
www-servers/apache threads
}}

Quindi "emergere" Apache:
{{Emerge|{{Package|www-servers/apache}}}}

=== Supporto globale ===

Abilitare la USE flag globale <code>apache2</code> da il supporto per Apache in altri pacchetti. Questo può determinare che il pacchetto {{Package|www-servers/apache}} sarà installato automaticamente se viene emerso un pacchetto dipendente da Apache.

{{FileBox|filename=/etc/portage/make.conf|title=Adding Apache to system USE flags|lang=bash|1=
USE="apache2"
}}

Dopo aver settato le variabili USE, aggiornare il sistema in modo che le modifiche abbiano effetto:

{{Emerge|params+=--changed-use --deep|@world}}

== Configurazione ==

=== Files ===

Ci sono due files principali che configurano il comportamento di Apache2 sul sistema: 

* Il file di configurazione per lo script di init Apache2 di Gentoo {{Path|/etc/conf.d/apache2 }}

* Apache2 server's conventional configuration file {{Path|/etc/apache2/httpd.conf}}

==== {{Path|/etc/conf.d/apache2}} ====

Il file {{Path|apache2}} situato in {{Path|/etc/conf.d}} è un file di configurazione dello script init di Gentoo. La sola linea attiva in questo file è la linea di variabile <var>APACHE2_OPTS</var>:

{{FileBox|filename=/etc/conf.d/apache2|lang=bash|1=
APACHE2_OPTS="-D DEFAULT_VHOST -D INFO -D SSL -D SSL_DEFAULT_VHOST -D LANGUAGE"
}}

Questa riga definisce le opzioni che saranno interpretate dai vari file di configurazione utilizzando l'istruzione <code><IfDefine option-name></code> per attivare o disattivare alcune parti dell'intera configurazione. Questo argomento sarà ripreso più avanti nell'articolo.

==== {{Path|/etc/apache2/httpd.conf}} ====

Il file {{Path|httpd.conf}} è il file di configurazione convenzionale del server Apache. Infatti esso è solo un '''entry point''' per la configurazione. L'intera configurazione è divisa in molti files nella directory {{Path|/etc/apache2/}}, i quali sono assemblati insieme utilizzando la direttiva <code>Include</code>. Per esempio, l'istruzione <code>Include /etc/apache2/modules.d/*.conf</code>, sul file {{Path|httpd.conf}}, mira ad includere tutti i files in {{Path|/etc/apache2/modules.d/}} il cui nome finisce con {{Path|.conf}}. 

Tenendo conto di ciò che è stato detto nella sezione precendente, e di come la configurazione dei moduli (files in /etc/apache2/modules.d) diviene attiva con l' <code><IfDefine module-name></code>, il contenuto di un file dentro {{Path|/etc/apache2/modules.d}}, sarà assemblato con il resto della configurazione SOLO se l'opzione corrispondente è impostata utilizzando un flag <code>-D module-name</code> nella variabile <var>APACHE2_OPTS<var>, all'interno del file {{Path|/etc/conf.d/apache2}}. Il file di configurazione {{Path|00_default_settings.conf}} è un'eccezione a questa regola dato che non parte con un'istruzione <code>IfDefine</code> e quindi è sempre incluso nella configurazione risultante.

=== Configurazione di defaults ===

Dopo una nuova installazione di Apache, la configurazione risultante dall'assemblaggio dei diversi file di configurazione risulta come segue. Iniziamo dall'entry point {{Path|/etc/apache2/httpd.conf}}.

{{Warning/it| Quanto segue è dato ''soltanto'' come un riferimento rapido e come overview generale. Siete caldamente invitati a riguardare i commenti inclusi nei vari file in modo da comprendere i pro e i contro della configurazione. Fate riferimento al manuale Apache per una comprensione più approfondita della configurazione.}}

{{FileBox|filename=/etc/apache2/httpd.conf|lang=apache|1=
ServerRoot "/usr/lib64/apache2"
  
#Module loaded unconditionally, assuming the USE flag is no unset in
# /etc/portage/make.conf or in /etc/portage/package.use
LoadModule actions_modulemodules/mod_actions.so
...
#other modules loaded that way : alias_module, auth_basic_module, authn_alias_module,
# authn_anon_module, authn_dbm_module, authn_default_module, authn_file_module, 
# authz_dbm_module, authz_default_module, authz_groupfile_module, authz_host_module, 
# authz_owner_module, authz_user_module, autoindex_module,  cgi_module,  cgid_module, 
# deflate_module, dir_module, env_module, expires_module, ext_filter_module, filter_module,
#  headers_module, include_module,  log_config_module, logio_module, mime_module,  
# mime_magic_module, negotiation_module, rewrite_module, setenvif_module, 
# speling_module,ssl_module, status_module, unique_id_module, usertrack_module, host_alias_module
  
  
#Modules loaded conditionally, assuming matching USE flag is not unset in
# /etc/portage/make.conf or in /etc/portage/package.use (flag to be set in )
<IfDefine AUTHNZ_LDAP>
LoadModule authnz_ldap_module modules/mod_authnz_ldap.so
</IfDefine>
#other modules loaded that way : cache_module, dav_module, dav_fs_module,
# dav_lock_module,disk_cache_module,  file_cache_module, info_module, ldap_module,
# mem_cache_module, userdir_module
  
  
User apache
Group apache
  
# Supplemental configuration
#**************************************************************************************vvv
#this part is included via Include /etc/apache2/modules.d/*.conf 
  
#included from /etc/apache2/modules.d/00_default_settings.conf-------------v
#this is always included as there is not option to deactivate it.
Timeout 300
KeepAlive On
MaxKeepAliveRequests 100
KeepAliveTimeout 15
UseCanonicalName Off
AccessFileName .htaccess
ServerTokens Prod
TraceEnable off
ServerSignature On 
HostnameLookups Off
EnableMMAP On
EnableSendfile On
FileEtag INode MTime Size
ContentDigest Off
ErrorLog /var/log/apache2/error_log
LogLevel warn
  
<Directory />
	Options FollowSymLinks
	AllowOverride None
	Require all denied
</Directory>
  
<IfModule dir_module>
	DirectoryIndex index.html index.html.var
</IfModule>
<FilesMatch "^\.ht">
	Require all denied
</FilesMatch>
#--------------------------------------------------------------------------^
  
#included from 00_mod_info.conf--------------------------------------------v
<IfDefine INFO>
<Location /server-info>
	SetHandler server-info
	Require host 127.0.0.1
</Location>
</IfDefine>
#--------------------------------------------------------------------------^
  
#--------------------------------------------------------------------------v
#included from 00_languages.conf
# Settings for hosting different languages.
<IfDefine LANGUAGE>
  
	AddLanguage ca .ca
	...
	AddLanguage zh-TW .zh-tw
  
	LanguagePriority en ca cs da de el eo es et fr he hr it ja ko ltz nl nn no pl pt pt-BR ru sv zh-CN zh-TW
  
	ForceLanguagePriority Prefer Fallback
  
	AddCharset us-ascii.ascii	.us-ascii
	AddCharset <nowiki>ISO-8859-1		.iso8859-1 .latin1</nowiki>
	...
	AddCharset shift_jis		.shift_jis .sjis
</IfDefine>
#---------------------------------------------------------------------------^
#**************************************************************************************^^^
  
  
#***************************************************************************************vvv
#this part is included via Include /etc/apache2/vhosts.d/*.conf 
#from 00_default_ssl_vhost.conf-----------------------------------------------------vv
<IfDefine SSL>
	<IfDefine SSL_DEFAULT_VHOST>
		<IfModule ssl_module>
			Listen 443
  
			<VirtualHost _default_:443>
				ServerName localhost
                                #------------------------------------------v
				# this part is included via Include /etc/apache2/vhosts.d/default_vhost.include
				ServerAdmin root@localhost
				DocumentRoot "/var/www/localhost/htdocs"
  
  	
				<Directory "/var/www/localhost/htdocs">
	   				Options Indexes FollowSymLinks
	   				AllowOverride All
	   				Require all granted
				</Directory>
  
				<IfModule alias_module>
	   				ScriptAlias /cgi-bin/ "/var/www/localhost/cgi-bin/"
				</IfModule>
  
				<Directory "/var/www/localhost/cgi-bin">
	   				AllowOverride None
	   				Options None
	   				Require all granted
				</Directory>
        			#end of Include ---------------------------^
  	
				ErrorLog /var/log/apache2/ssl_error_log
  
				<IfModule log_config_module>
					TransferLog /var/log/apache2/ssl_access_log
				</IfModule>
				SSLEngine on
				SSLCipherSuite ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP:+eNULL
				SSLCertificateFile /etc/ssl/apache2/server.crt
				SSLCertificateKeyFile /etc/ssl/apache2/server.key
  
				<FilesMatch "\.(cgi{{!}}shtml{{!}}phtml{{!}}php)$">
					SSLOptions +StdEnvVars
				</FilesMatch>
  
				<Directory "/var/www/localhost/cgi-bin">
					SSLOptions +StdEnvVars
				</Directory>
  
				<IfModule setenvif_module>
					BrowserMatch ".*MSIE.*" \
					nokeepalive ssl-unclean-shutdown \
					downgrade-1.0 force-response-1.0
				</IfModule>
  
  
				<IfModule log_config_module>
					CustomLog /var/log/apache2/ssl_request_log \
					"%t %h %{SSL_PROTOCOL}x %{SSL_CIPHER}x \"%r\" %b"
					</IfModule>
			</VirtualHost>
		</IfModule>
	</IfDefine>
</IfDefine>
#---------------------------------------------------------------------------------^^
#from 00_default_vhost.conf-------------------------------------------------------vv
<IfDefine DEFAULT_VHOST>
	Listen 80
	NameVirtualHost *:80
  
	<VirtualHost *:80>
		ServerName localhost
  
		#---------------------------------------------------------------v
		# this part is included via Include /etc/apache2/vhosts.d/default_vhost.include
		ServerAdmin root@localhost
		DocumentRoot "/var/www/localhost/htdocs"
  
  	
		<Directory "/var/www/localhost/htdocs">
	   		Options Indexes FollowSymLinks
	   		AllowOverride All
	   		Require all granted
		</Directory>
  
		<IfModule alias_module>
	   		ScriptAlias /cgi-bin/ "/var/www/localhost/cgi-bin/"
		</IfModule>
  
		<Directory "/var/www/localhost/cgi-bin">
	   		AllowOverride None
	   		Options None
	   		Require all granted
		</Directory>
        	#end of Include -----------------------------------------------^
  
		<IfModule mpm_peruser_module>
			ServerEnvironment apache apache
		</IfModule>
	</VirtualHost>
</IfDefine>
#-----------------------------------------------------------------------------------^^
# end of include ****************************************************************************************^^^
}}

=== Primi segni di vita ===

Come si vede nella configurazione iniziale sopra, la directory <code>DocumentRoot</code>  pre-installata nel virtual host è {{Path|/var/www/localhost/htdocs}}, il suo server name è ''localhost''. In aggiunta un file index.html è provvisto nella directory <code>DocumentRoot</code>, in modo da poter verificare che tutto sia correttamente installato collegandosi con un browser a [http://localhost http://localhost].

Dovreste vedere un messaggio "It works!" nella pagina.

{{Warning|Fuori dal box, [[Firefox]] ha una caratteristica creata per aiutare gli utenti che sbagliano a digitare l'URL nella barra del browser. Se l'URL non viene risolto, Firefox cerca una coppia di alternative all'URL per trovare quella che l'utente intendeva veramente digitare, aggiungendo <code>.com</code> oppure anteponendo <code>www.</code> alla porzione del nome host dell'URL per vedere se questi possono risolverlo.

Questa caratteristica, che è stata introdotta nelle prime versioni di Firefox, è un pò fastidiosa per gli sviluppatori. La caratteristica significa che quando un server posto su un host locale fallisce la risposta, Firefox decide di cercare <code>localhost.com</code> o <code>www.localhost.com</code>. Questo spesso risolve una pagina non trovata.

Per disabilitare questa caratteristica:

# Inserire <code>about:config</code> in the browser bar
# Cliccare su "I'll be careful" ed entrare nella pagina di configuratione speciale
# Inserire <code>browser.fixup.alternate.enabled</code> nella barra di ricerca che appare
# Click destro su <code>browser.fixup.alternate.enabled</code> che appare nella lista filtrata sotto e scegliere toggle per impostare il valore su false.}}

=== Abilitare mod_security ===

Installare {{Package|www-apache/mod_security}}:

{{Emerge|www-apache/mod_security}}

Abilitare il modulo <code>SECURITY</code> nella variabile <var>APACHE2_OPTS</var> del file {{Path|apache2}}:

{{FileBox|filename=/etc/conf.d/apache2|title=Abilitare il modulo di sicurezza|lang=bash|1=
APACHE2_OPTS="... -D SECURITY"
}}

Controllare questo modulo editando {{Path|/etc/apache2/modules.d/79_modsecurity.conf}} e {{Path|/etc/apache2/modules.d/80_modsecurity-crs.conf}} e riavviando Apache.

=== Abilitazione del supporto PHP ===

Installare [[PHP]] con il flag USE <code>apache2</code> ed abilitare il modulo:

{{Importante|1=Con >=[https://packages.gentoo.org/packages/app-eselect/eselect-php app-eselect/eselect-php-0.8.1], la variabile <var>APACHE2_OPTS</var> è cambiata in <code>-D PHP</code> invece che <code>-D PHP5</code>. Questo consente alle future versioni di procedere senza intoppi.}}

{{FileBox|filename=/etc/conf.d/apache2|title=Abilitare il modulo PHP|lang=bash|1=
APACHE2_OPTS="... -D PHP"
}}

Prima di testare se il modulo PHP funziona, controllare che il file {{Path|/etc/apache2/modules.d/70_mod_php.conf}} esista e contenga la seguente definizione:

{{FileBox|filename=/etc/apache2/modules.d/70_mod_php.conf|title=Verificare che il modulo PHP sarà caricato|lang=apache|1=
<IfDefine PHP>
	# The mod_php.so symlink is controlled by
	# eselect-php. However, the module name changed from
	# php5_module to php7_module so we can't blindly load whatever
	# is there. Instead we let eselect-php manage a small
	# configuration file that loads the appropriate module.
	#
	# This is relative to ServerRoot (see httpd.conf).
	Include ../../../var/lib/eselect-php/mod_php.conf
 
	# Tell apache that mod_php should handle PHP files.
	#
	# NOTE: Avoiding AddHandler/AddType for security (bug
	# #538822). Please read the related news item!
	<FilesMatch "\.(php{{!}}php[57]{{!}}phtml)$">
		SetHandler application/x-httpd-php
	</FilesMatch>
 
	# PHP source files which are meant to be displayed as
	# syntax-highlighted source code.
	<FilesMatch "\.phps$">
		SetHandler application/x-httpd-php-source
	</FilesMatch>
 
	DirectoryIndex index.php index.phtml
</IfDefine>
}}

Se esso non esistesse crearlo.

Per verificare se il modulo PHP funziona, creare una pagina di test:

{{FileBox|filename=/var/www/localhost/htdocs/index.php|title=PHP test page|lang=php|1=
<html>
 <body>
  <?php phpinfo(); ?>
 </body>
</html>
}}

Adesso, rimuovere o rinominare {{Path|/var/www/localhost/htdocs/index.html}} ed aprire la pagina di test: <code>http://localhost/</code>

Dovrebbe essere visibile una tabella che descrive le impostazioni di PHP.

==== Modificare le versioni di PHP ==== 

Per cambiare la versione di PHP gestita da Apache, per prima cosa elencare le versioni disponibili per il Server Application Programming Interface (SAPI) di <code>apache2</code>:

{{RootCmd|eselect php list apache2|output=<pre>
 [1]   php5.3
 [2]   php5.4 *
 [3]   php5.5
</pre>}}

Selezionare la versione scelta:

{{RootCmd|eselect php set apache2 N}}

Sostituire <code>N</code> nell'esempio sopra con il numero nell'output di {{c|eselect php list apache2}} come visualizzato in precedenza.

=== Hosts virtuali ===

Per ogni virtual host, fornire una directory <code>DocumentRoot</code> che sia raggiungibile ed accessibile dal demone Apache. Aggiungere un file di configurazione ({{Path|VirtualHost.conf}}) nella directory {{Path|/etc/apache2/vhosts.d}} che utilizzi questa <code>DocumentRoot</code> ed il Server Name dell'host virtuale. Non dimanticarsi di aggiungere un'entry per questo dominio in {{Path|/etc/hosts}}.

Per assegnare ai files dell'host virtuale i permessi necessari ad utente e gruppo di Apache, utilizzare <code>chown</code> come nell'esempio seguente:

{{RootCmd|chown apache:apache /var/www/sitename}}

Di seguito due esempi di definizione di Virtual Host, uno per domainname1.com ed uno per domainname2.com. Da notare le differenti direttive <code>DocumentRoot</code> e <code>ServerName</code> anche se l'host in sè (<code>*:80</code>) rimane invariato

{{CodeBox|title=Example virtual host definitions|lang=apache|1=
<VirtualHost *:80>
    ServerAdmin email@site.com
    DocumentRoot /var/www/website1
    ServerName domainname1.com
</VirtualHost>
  
<VirtualHost *:80>
    ServerAdmin email@site.com
    DocumentRoot /var/www/website2
    ServerName domainname2.com
</VirtualHost>
}}

E'raccomandato anche definire un virtual host IP based. Questo permette all'amministratore di mettere messaggi per quegli utenti che cercano di raggiungere il sito attraverso il suo indirizzo IP:

{{CodeBox|title=IP-based virtual host|lang=apache|1=
<VirtualHost *:80>
    ServerAdmin email@site.com
    DocumentRoot /var/www/html
    ServerName xxx.xxx.xxx.xxx
</VirtualHost>
}}

Dopo aver inserito i virtual hosts, affinchè questi divention attivi il server deve essere restartato (anche con graceful).

=== Abilitare PHP attraverso fcgid ===

Install {{Package|www-apache/mod_fcgid}} and {{Package|dev-lang/php}}. The PHP package requires <code>cgi</code> to be set as a USE flag:

{{Emerge|www-apache/mod_fcgid dev-lang/php}}

Editare il file {{Path|mod_fcgid.conf}}:

{{FileBox|filename=/etc/apache2/modules.d/20_mod_fcgid.conf|lang=apache|1=
<IfDefine FCGID>
LoadModule fcgid_module modules/mod_fcgid.so
SocketPath /var/run/fcgidsock
SharememPath /var/run/fcgid_shm
  
AddHandler php-fcgid .php
AddType application/x-httpd-php .php
Action php-fcgid /fcgid-bin/php-fcgid-wrapper
# max request 128mb
FcgidMaxRequestLen 134217728
<Location /fcgid-bin/>
        SetHandler fcgid-script
        Options +ExecCGI
</Location>
</IfDefine>
}}

Create le directory necessarie: 

{{RootCmd|mkdir /var/www/localhost/htdocs/fcgid-bin}}

Creare un link simbolico per il wrapper PHP:

{{RootCmd|ln -s /usr/bin/php-cgi /var/www/localhost/htdocs/fcgid-bin/php-fcgid-wrapper}}

Abilitare il modulo <code>FCGID</code>:

{{FileBox|filename=/etc/conf.d/apache2|title=Abilitare il modulo fcgid|lang=bash|1=
APACHE2_OPTS="... -D FCGID"
}}

Alla fine, riavviare Apache e controllare il sito <code>phpinfo()</code> creato precedentemente. Il valore di <code>Server API</code> dovrebbe essere ''CGI/FastCGI''

=== Abilitare PHP-FPM attraverso il mod_proxy_fcgi in Apache 2.4 ===

I seguenti pre-requisiti devono essere soddisfatti per abilitare PHP-FPM, attraverso mod_proxy_fcgi:
* >= PHP 5.3
* >= Apache 2.4

Inoltre, ci sono alcune restrizioni nella disponibilità di funzionalità all'interno di Apache 2.4:
* >= Apache 2.4.9, se si vuole [https://wiki.apache.org/httpd/PHP-FPM#Performance_and_Pitfalls comunicare con PHP-FPM attraverso i sockets UNIX]
* >= Apache 2.4.10, se si vuole utilizzare [https://github.com/php/php-src/pull/694 SetHandler] invece di [https://wiki.apache.org/httpd/PHP-FPM#Example ProxyPassMatch].

La seguente configurazione funzionerà solo con Apache 2.4.10 e versioni successive. Essa si basa sulla direttiva <code>FilesMatch</code> e può essere collocata all'interno della configurazione del server principale o <code>VirtualHosts</code>. La posizione del socket UNIX è determinata dalla direttiva <code>listen</code> nel file di configurazione {{Path|php-fpm.conf}}, consentendo di specificare recipienti separati per ogni sito o funzione.

Nell'esempio seguente, <code>FilesMatch</code> è collocato all'interno del file di configurazione del modulo PHP di Apache:

{{FileBox|filename=/etc/apache2/modules.d/70_mod_php.conf|title=Utilizzare PHP-FPM (raccomandato per Apache 2.4.10 e versioni superiori)|lang=apache|1=
 <IfDefine PHP>
        <FilesMatch "\.php$">
                SetHandler "proxy:unix:/var/run/php-fpm/www.sock{{!}}fcgi://localhost"
        </FilesMatch>
  
	# Set it to handle the files
	<IfModule mod_mime.c>
		AddHandler application/x-httpd-php .php .php5 .phtml
		AddHandler application/x-httpd-php-source .phps
	</IfModule>
  
	DirectoryIndex index.php index.phtml
 </IfDefine>
}}

Oppure si può utilizzare ProxPassMatch -- la sola opzione utile se la versione di Apache è compresa tra 2.4.0 e 2.4.8, incluse.

{{FileBox|filename=/etc/apache2/modules.d/70_mod_php.conf|title=Utilizzare PHP-FPM (raccomandato per Apache 2.4.8 e versioni prcedenti)|lang=apache|1=
 <IfDefine PHP>
        # Send all requested PHP files to PHP-FPM via fcgi://PHP_FPM_LISTEN_ADDRESS:PHP_FPM_LISTEN_PORT/DOCUMENT_ROOT/$1
        ProxyPassMatch ^/(.*\.php)$ fcgi://127.0.0.1:9000/var/www/localhost/htdocs/$1
  
	# Set it to handle the files
	<IfModule mod_mime.c>
		AddHandler application/x-httpd-php .php .php5 .phtml
		AddHandler application/x-httpd-php-source .phps
	</IfModule>
  
	DirectoryIndex index.php index.phtml
 </IfDefine>
}}

In serie la direttiva <code>listen</code> non è impostata ad un socket. Per prima cosa bisogna creare la directory per il file socket:

{{RootCmd|mkdir /var/run/php-fpm}}

Successivamente, aggiornare il file {{Path|php-fpm.conf}} come segue:

{{FileBox|filename=php-fpm.conf|title=Aggiornare la direttiva listen|lang=apache|1=
; Set permissions for unix socket, if one is used. In Linux, read/write
; permissions must be set in order to allow connections from a web server. Many
; BSD-derived systems allow connections regardless of permissions.
; Default Values: user and group are set as the running user
;                 mode is set to 0666
listen.owner = nobody
listen.group = nobody
;listen.mode = 0666
 
 ; The address on which to accept FastCGI requests.
 ; Valid syntaxes are:
 ;   'ip.add.re.ss:port'    - to listen on a TCP socket to a specific address on
 ;                            a specific port;
 ;   'port'                 - to listen on a TCP socket to all addresses on a
 ;                            specific port;
 ;   '/path/to/unix/socket' - to listen on a unix socket.
 ; Note: This value is mandatory.
 ;listen = 127.0.0.1:9000
listen = /var/run/php-fpm/www.sock
}}

Quindi abilitare entrambi i moduli <code>PHP</code> e <code>PROXY</code>:

{{FileBox|filename=/etc/conf.d/apache2|title=Abilitare i moduli PHP e proxy|lang=bash|1=
APACHE2_OPTS="... -D PHP -D PROXY"
}}

== Utilizzo ==

=== Servizi ===

==== OpenRC ====

Avviare il server Apache:

{{RootCmd|/etc/init.d/apache2 start}}

Aggiungere Apache al runlevel default:

{{RootCmd|rc-update add apache2 default}}

Riavviare il servizio Apache:

{{RootCmd|/etc/init.d/apache2 restart}}

Ricaricare i file di configurazione:

{{RootCmd|/etc/init.d/apache2 reload}}

==== systemd ====

Avviare il server Apache:

{{RootCmd|systemctl start apache2}}

Aggiungere Apache al runlevel default: 

{{RootCmd|systemctl enable apache2}}

Riavviare il servizio Apache: 

{{RootCmd|systemctl restart apache2}}

== Troubleshooting ==

=== Risorse ===

Il server Apache può essere difficoltoso da configurare. Di seguito alcune risorse utili in caso di problemi:

* [[Project:Apache/Troubleshooting|Guida al Troubleshooting]]
* {{Bug|www-servers/apache|search=package}}

=== Testare ===

Verificare quali siano le interfaccie IP e le porte sulle quali il server Apache attivo è in ascolto:

{{RootCmd|netstat -tulpen {{!}} grep apache|output=<pre>
tcp     0     0 0.0.0.0:80      0.0.0.0:*     LISTEN     0     10932720     4544/apache2        
tcp     0     0 0.0.0.0:443     0.0.0.0:*     LISTEN     0     10932716     4544/apache2        
</pre>}}

Testare se una connessione verso un server Apache funziona in localhost:

{{Cmd|telnet localhost 80|output=<pre>
Trying 127.0.0.1...
Connected to localhost.
Escape character is '^]'.
</pre>}}

Interrompere la connessione con {{Key|Ctrl}}+{{Key|c}} e {{Key|Invio}}.

=== Errore "apr_sockaddr_info_get() failed for <System_Hostname>" ===

'''Errore:'''

<pre>apache2: apr_sockaddr_info_get() failed for System_Hostname</pre>

'''Risoluzione:'''

Quando questo succede, aggiungete il vostro hostname al file {{Path|/etc/hosts}}

{{FileBox|filename=/etc/hosts|title=Aggiunta di un Hostname per Apache|1=
127.0.0.1 localhost System_Hostname
}}

== Vedere anche ==

* [[Lighttpd]] - un web server leggero e veloce.
* [[Nginx]] - un HTTP server piccolo, robusto e ad alte prestazioni, con funzionalità Reverse Proxy

== Risorse esterne ==

* [http://articles.slicehost.com/2010/12/2/installing-apache-on-gentoo Slicehost article: Installing Apache on Gentoo]
* [http://articles.slicehost.com/2010/12/3/apache-configuration-files-on-gentoo Slicehost article: Apache configuration files on Gentoo]
* [http://articles.slicehost.com/2010/12/3/configuring-the-apache-mpm-on-gentoo Slicehost article: Configuring the Apache MPM on Gentoo]
* [http://articles.slicehost.com/2010/12/3/apache-configuration-on-gentoo-part-1 Slicehost article: Apache configuration on Gentoo]
* [http://articles.slicehost.com/2010/12/3/apache-virtual-hosts-on-gentoo-part-1 Slicehost article: Apache Virtual Hosts on Gentoo]
* [http://articles.slicehost.com/2010/12/3/enabling-and-using-apache-s-mod_status-on-gentoo Slicehost article: Enabling and using apache's mod_status on Gentoo]
* [http://httpd.apache.org/docs/ apache.org documentation]
* [http://gentoo-en.vfose.ru/wiki/Apache2_mod_pagespeed Apache2 mod_pagespeed]


[[Category:Web Servers]]
