==Preparing The Disks==

Prior to installing Gentoo on a Raspberry Pi 3 Model B, the SD card must be prepared first. We can use either fdisk or Parted to accomplish this. But before we go into that, we must first figure out what the SD card identifies as on your Gentoo system. We can do this using lsblk -
{{RootCmd| lsblk}}

If your SD card still has NOOBS installed on it, the output from lsblk should look something like this -
{{ContentBox|Example lsblk output - NOOBS SD Card|<pre>
NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda    8:0      0 74.5G  0 disk
sda1   8:1      0    2M  0 part
sda2   8:2      0  128M  0 part
sda3   8:3      0    4G  0 part [SWAP]
sda4   8:4      0 70.4G  0 part /
sdb    8:16     1 29.7G  0 disk
sdb1   8:17     1  1.5G  0 part
sdb2   8:18     1    1K  0 part
sdb5   8:21     1   32M  0 part
sdb6   8:22     1   66M  0 part
sdb7   8:23     1 28.1G  0 part
</pre>}}

In this example, this Gentoo system uses /dev/sda as the Gentoo system block device. /dev/sdb is the NOOBS SD card. We'll use that for our example throughout this article.

If you're using a brand new pre-formatted SD card, the output from lsblk would look like this -

{{ContentBox|Example lsblk output - new/blank pre-formatted SD Card|<pre>
NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda      8:0    0 74.5G  0 disk
tqsda1   8:1    0    2M  0 part
tqsda2   8:2    0  128M  0 part
tqsda3   8:3    0    4G  0 part [SWAP]
mqsda4   8:4    0 70.4G  0 part /
sdb      8:16   1 29.7G  0 disk
</pre>}}

For our partition table, our boot partition must be a primary partition and it must be a FAT32 partition for the Raspberry Pi to boot. For the swap and root partitions, we can use standard Linux formats. Optionally, we can create an extended partition and make the swap and root partitions as logical partitions if we wish. For this installation example, all partitions will be primary partitions.

===fdisk===
{{RootCmd| fdisk -w always /dev/sdb}}

The -w always switch will wipe all signatures as we create partitions. Once fdisk starts, pass the 'p' option to see the partitions currently present on the SD card.

{{ContentBox|Start fdisk and print partitions with 'p' command|<pre>
Welcome to fdisk (util-linux 2.30).
Changes will remain in memory only, until you decide to write them.
Be careful before using the write command.


Command (m for help): p
Disk /dev/sdb: 29.7 GiB, 31914983424 bytes, 62333952 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0x00058ec2

Device     Boot   Start      End  Sectors  Size Id Type
/dev/sdb1          8192  3140625  3132434  1.5G  e W95 FAT16 (LBA)
/dev/sdb2       3140626 62333951 59193326 28.2G  5 Extended
/dev/sdb5       3145728  3211261    65534   32M 83 Linux
/dev/sdb6       3211264  3346431   135168   66M  c W95 FAT32 (LBA)
/dev/sdb7       3350528 62333951 58983424 28.1G 83 Linux

</pre>}}

First we will pass the o command to create a new MS-DOS disk label. This will delete all partitions currently in the table.

{{ContentBox|Create New MS-DOS Label and print partitions with 'p' command|<pre>
Welcome to fdisk (util-linux 2.30).
Changes will remain in memory only, until you decide to write them.
Be careful before using the write command.


Command (m for help): o
Created a new DOS disklabel with disk identifier 0x67d2396a.

Command (m for help): p
Disk /dev/sdb: 29.7 GiB, 31914983424 bytes, 62333952 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0x67d2396a

Command (m for help):</pre>}}

As you can see, the o command created our new DOS disklabel and deleted all partitions.

Next, we're going to make the boot partition. First, we'll use the 'n' command to make a new partition. Then, press enter for the following three prompts. This gives you the default options of -

p - Primary Partition<br />Partition number 1<br />First sector at 2048

For the last sector, we'll set it at +128M. This gives us a boot partition size of 128MiB. 

Then, we'll use the 't' command to change the partition type. Select hex code 'c' to change it to a 'W95 FAT32 (LBA)' partition type. Finally, use the 'a' command to toggle on the bootable flag on partition 1.

{{ContentBox|Make the boot partition|<pre>
Command (m for help): n
Partition type
   p   primary (0 primary, 0 extended, 4 free)
   e   extended (container for logical partitions)
Select (default p):

Using default response p.
Partition number (1-4, default 1):
First sector (2048-62333951, default 2048):
Last sector, +sectors or +size{K,M,G,T,P} (2048-62333951, default 62333951): +128M

Created a new partition 1 of type 'Linux' and of size 128 MiB.

Command (m for help): t
Selected partition 1
Hex code (type L to list all codes): c
Changed type of partition 'Linux' to 'W95 FAT32 (LBA)'.

Command (m for help): a
Selected partition 1
The bootable flag on partition 1 is enabled now.

Command (m for help):</pre>}}

Using the 'P' command, print the partition table to verify that the boot partition has been made correctly -

{{ContentBox|Print partition table with 'p' command|<pre>
Disk /dev/sdb: 29.7 GiB, 31914983424 bytes, 62333952 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0xfce09755

Device     Boot Start    End Sectors  Size Id Type
/dev/sdb1  *     2048 264191  262144  128M  c W95 FAT32 (LBA)
</pre>}}

As we can see, we have created a bootable partition starting at sector 2048 that is 128MiB in size and is a FAT32 partition type.

Next, we'll create the swap partition. Pass the 'n' command again to create a new partition. Again, we'll press enter for the next 3 prompts to get the following default options -

p - Primary Partition<br />Partition number 2<br />First sector at sector 264192<br />

Then we will set a swap size of 2GiB by passing +2G for the last sector/size. Finally, once the second partition is created, we'll use the 't' command to change the partition type, and select hex code 82 to change our partition type to 'Linux swap / Solaris'.

{{ContentBox|Create the swap partition|<pre>
Command (m for help): n
Partition type
   p   primary (1 primary, 0 extended, 3 free)
   e   extended (container for logical partitions)
Select (default p):

Using default response p.
Partition number (2-4, default 2):
First sector (264192-62333951, default 264192):
Last sector, +sectors or +size{K,M,G,T,P} (264192-62333951, default 62333951): +2G

Created a new partition 2 of type 'Linux' and of size 2 GiB.

Command (m for help): t
Partition number (1,2, default 2): 2
Hex code (type L to list all codes): 82

Changed type of partition 'Linux' to 'Linux swap / Solaris'.

Command (m for help):
</pre>}}

Now print your partition table using the 'p' command and it should look like this -

{{ContentBox|Print the partition table|<pre>
Command (m for help): p
Disk /dev/sdb: 29.7 GiB, 31914983424 bytes, 62333952 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0xfce09755

Device     Boot  Start     End Sectors  Size Id Type
/dev/sdb1  *      2048  264191  262144  128M  c W95 FAT32 (LBA)
/dev/sdb2       264192 4458495 4194304    2G 82 Linux swap / Solaris

Command (m for help):
</pre>}}

Now for the root partition. Use the 'n' command for a new partition. Then press Enter 3 more times to go with all default options. This will set us up with a primary partition on partition 3 with the rest of the available space as the root partition.

{{ContentBox|Create the /root partition|<pre>
Command (m for help): n
Partition type
   p   primary (2 primary, 0 extended, 2 free)
   e   extended (container for logical partitions)
Select (default p):

Using default response p.
Partition number (3,4, default 3):
First sector (4458496-62333951, default 4458496):
Last sector, +sectors or +size{K,M,G,T,P} (4458496-62333951, default 62333951):

Created a new partition 3 of type 'Linux' and of size 27.6 GiB.

Command (m for help):
</pre>}}

And finally, print the partition table once more and your table should look like this -
{{ContentBox|Final partition table|<pre>
Command (m for help): p
Disk /dev/sdb: 29.7 GiB, 31914983424 bytes, 62333952 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0xfce09755

Device     Boot   Start      End  Sectors  Size Id Type
/dev/sdb1  *       2048   264191   262144  128M  c W95 FAT32 (LBA)
/dev/sdb2        264192  4458495  4194304    2G 82 Linux swap / Solaris
/dev/sdb3       4458496 62333951 57875456 27.6G 83 Linux

Command (m for help):
</pre>}}

If your partition table looks like the above, pass the 'w' command to write the table to the SD card and exit fdisk.

{{ContentBox|Save table to SD Card and exit fdisk with the 'w' command|<pre>
Command (m for help): w
The partition table has been altered.
Calling ioctl() to re-read partition table.
Syncing disks.

root ~ $
</pre>}}

If all is good, skip down to Create Filesystems.

===Create Filesystems===
