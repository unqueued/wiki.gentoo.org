Munin is a networked resource monitoring tool that can help analyze resource trends and "what just happened to kill our performance?" problems.

Munin implements a master and slave node structure; one master node with many slave nodes. The master node gathers data from the slave nodes, and produces HTML output. Generally these will be placed in the directory accessible via a web server, and can be viewed with a web browser.

== USE flags ==
{{USEflag|package=net-analyzer/munin
|asterisk
|irc
|java
|memcached
|minimal
|mysql
|postgres
|ssl
|cgi
|ipv6
|syslog
}}

== Installation ==

The installation of Munin is easy enough, as it only requires to install the one package {{Package|net-analyzer/munin}}, and contains no extra plugins or anything, by default.

{{Emerge|params=--ask --verbose| net-analyzer/munin}}

But since Munin is fundamentally made of two components – the ''node'' and the ''master'' – you should first decide which of the two configurations you want to set up for any given box.

=== Node setup ===

Munin nodes have the task of reporting the results of a series of scripts (called plugins), which report data in a structured format so that the master can log the values and generate a report. Usually you set up one node for each box you intend to monitor, including the master.

To set up a simple node, which only has to gather data and does not have to produce the reports, you're recommended to enable the '''minimal''' USE flag — by doing so, you're avoiding a number of extra dependencies that only involve the master, namely {{Package|net-analyzer/rrdtool}}. Disabling '''minimal''' it's also necessary to disable '''cgi''' which is a default starting from version 2.0.2.

{{File|/etc/portage/package.use||<pre>
net-analyzer/munin minimal -cgi
</pre>}}

The ebuild has a few USE flags that can be enabled to add dependencies for monitoring some given services. See the '''metadata.xml''' file for more information.

=== Master setup ===

The Munin master has the task of fetching the values reported by the nodes and producing a report, composed of HTML pages and PNG graphs. This can be done either within the cron job (so that the pages are generated statically) or via the CGI scripts that come installed by default. In either case you're likely going to need a web server, such as [[Apache2]], [[Lighttpd]], or [[nginx]], to display the reports.

When setting up a Munin master you have to make sure the '''minimal''' USE flag is not enabled.

{{File|/etc/portage/package.use||<pre>
net-analyzer/munin -minimal
</pre>}}

== Single node configuration ==
Install the munin cronjob
{{Emerge|params=--config| net-analyzer/munin}}

The htmldir needs to be set up, the default should be fine {{Path|/var/www/localhost/munin/}}. You have to do nothing if you want to use this path, so the next two instructions are only needed if only if you decided to change this path.

Configure a path where munin should saves generated pages and graphs:
{{File|/etc/munin/munin.conf||<pre>
htmldir /var/www/localhost/htdocs/munin
</pre>}}

This htmldir has to be writeable for the user <code>munin</code>
{{RootCmd|chown munin:munin /var/www/localhost/htdocs/munin}}
{{RootCmd|chmod 755 /var/www/localhost/htdocs/munin}}

Enable <code>crontab</code> for <code>munin</code>, by adding <code>munin</code> to the <code>cron</code> group.
{{RootCmd|gpasswd -a munin cron}}

Configure munin which statistics to gather
{{RootCmd|sudo -u munin munin-node-configure --shell}}

This command checks your system for statistics that can be gathered and creates symlinks in the {{Path|/etc/munin/}} directory. 
You should check this list as it will only show shell commands. Once you are happy you can do it for real!
{{RootCmd|sudo -u munin munin-node-configure --shell | /bin/bash}}

Configure munin to start up at boot time
{{RootCmd|rc-update add munin-node default}}

Start the munin daemon
{{RootCmd|/etc/init.d/munin-node start}}

== Complete ==
Wait a while for munin to output the first set of graphs, the cronjob is run once every 5 minutes by default. Once the graphs have been generated they will be accessible at your web server, usually at <code>http://localhost/munin/</code>, and are saved at the <code>htmldir</code> path (as set in {{Path|/etc/munin/munin.conf}}.

== Troubleshooting ==
The most common problem is graphs are not generated. 
Check for problems by executing <code>/usr/bin/munin-cron</code>
{{RootCmd|sudo -u munin /usr/bin/munin-cron}}

Common errors include not restarting <code>munin-node</code> after adding plugins.

== See Also ==

* [[Munin maintenance]] notes from the Munin maintainers for Gentoo Linux.

== External resources ==
* [http://www.munin-monitoring.org/ Munin Homepage]
* [http://munin-monitoring.org/wiki/FAQ_no_graphs Missing graphs]

[[Category:Software]]
[[Category:Monitoring]]
