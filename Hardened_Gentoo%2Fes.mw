<languages />
{{InfoBox stack
|{{InfoBox gdoc|Hardened|header=true}}
}}
Gentoo Hardened es un proyecto de Gentoo que ofrece características de seguridad adicionales encima de la ya conocida instalación de Gentoo Linux. Aunque pueden ser seleccionadas en forma separada, Gentoo Hardened activa múltiples herramientas para la mitigación de riesgos en la cadena de herramientas, soporta PaX, grSecurity, SELinux, TPE y otros.

Ya sea que usted maneje un servidor o una estación de trabajo, cuando lidia con múltiples amenazas, probablemente querrá fortalecer el sistema en lugar de solamente aplicar los últimos parches de seguridad. "''Fortalecer''" un sistema significa tomar contramedidas adicionales frente a ataques y otros riesgos, y aquello se traduce usualmente en un conjunto combinado de actividades que usted realizará en el sistema.

Dentro de Gentoo Hardened, muchos proyectos estan inmersos y nos ayudaran a fortalecer un sistema Gentoo a través de:

*La activación de opciones específicas en la cadena de herramientas (compilador, enlazador, ...) tales como forzar ejecutables de posición independiente (PIE), protección contra el desbordamiento de pila y comprobación de búfer en tiempo de compilación.
*Activación de la extensiones PaX del núcleo Linux, que ofrece medidas de protección adicionales como la asignación aleatoria de direcciones en memoria y memoria no ejecutable.
*Activación de la extensiones SELinux del núcleo Linux, que ofrece un sistema con Mandatory Access Control (MAC) que mejora las restricciones estándar de permisos en Linux.
*Activación de tecnologías relacionadas con Integrity tal como Integrity Measurement Architecture, para hacer sistemas más resistentes a la manipulación.

Por supuesto que se incluye las correspondientes utilidades en espacio de usuario para el manejo de estas extensiones.

== Cambiándo a un perfil ''Fortalecido'' ==

Seleccione un [[profile (Portage)/es|perfil]] ''Fortalecido'' para que la administración de paquetes se realice de modo ''fortalecido''.

{{RootCmd|eselect profile list}}
{{RootCmd|eselect profile set [numero del perfil ''fortalecido'']}}
{{RootCmd|source /etc/profile}}

Al escoger el perfil ''fortalecido'', ciertas configuraciones del gestor de paquetes (enmascaramiento de paquetes, ajustes USE, etc) se tornan por defecto en el sistema. Esto se aplica a muchos paquetes, incluida la cadena de herramientas. La cadena de herramientas es usada para compilar tus programas, e incluye: la GNU Compiler Collection (GCC), binutils (enlazador, etc), y la GNU C library (glibc). Al reinstalar la cadena de herramientas, aquellas nuevos ajustes por defecto se aplicaran a la cadena de herramientas, lo que permitirá que toda compilación de paquetes posterior se haga de "modo '''fortalecido'''".

{{emerge|params=--oneshot|gcc}}
{{emerge|params=--oneshot|binutils virtual/libc}}

The above commands rebuilt GCC, which can now be used to compile hardened software.  Make sure that the hardened option is selected for GCC.

{{RootCmd|gcc-config -l
|output=<pre>
[1] i686-pc-linux-gnu-4.5.3 *
[2] i686-pc-linux-gnu-4.5.3-hardenednopie
[3] i686-pc-linux-gnu-4.5.3-hardenednopiessp
[4] i686-pc-linux-gnu-4.5.3-hardenednossp
[5] i686-pc-linux-gnu-4.5.3-vanilla
</pre>}}

In the example output above, the hardened GCC profile is the one without a suffix. If you want to disable PIE or SSP, choose the relevant '''hardenedno'''('''pie'''|'''ssp''') or both, '''hardenednopiessp'''. The '''vanilla''' profile is of course the one with hardening disabled. Finally source your new profile settings:

{{RootCmd|source /etc/profile}}

If you use the "prelink" package, remove it, since it isn't compatible with the hardened profile:

{{emerge|params=--depclean|prelink}}

Now you can reinstall all packages with your new hardened toolchain:

{{emerge|params=--emptytree --verbose|@world}}

Install hardened kernel sources, so that the kernel will *manage your running system* in a hardened way (especially using PaX):

{{emerge|hardened-sources}}

Now configure/compile the sources and add the new kernel to your boot manager (ie., GRUB).

== Tips and tricks ==

=== Hardened Gentoo/Grsecurity chroot ===

If you want to chroot to a copied environment where the <var>CONFIG_GRKERNSEC_CHROOT</var> is enabled you must use the cd grub and change the root(cd) kernel(cd) initrd(cd) setting to from (cd) to (hdx,y).

Now you can install the grub environment.

=== Per package hardening settings ===

{{Warning|This method is not supported by Gentoo.}}

Changing the GCC profile to deal with specific packages can be a pain. A way to avoid this is to set per-package C(XX)FLAGS using [[:/etc/portage/env|package.env]]. Create the file {{Path|/etc/portage/env/nossp}} and add to that:

{{FileBox|filename=/etc/portage/env/nossp|title=Disable SSP|lang=bash|1=
CFLAGS="${CFLAGS} -fno-stack-protector"
CXXFLAGS="${CXXFLAGS} -fno-stack-protector"
}}

To allow for disabling PIE, create and add to {{Path|/etc/portage/env/nopie}}:

{{FileBox|filename=/etc/portage/env/nopie|title=Disable PIE|lang=bash|1=
CFLAGS="${CFLAGS} -no-pie"
CXXFLAGS="${CXXFLAGS} -no-pie"
LDFLAGS="${LDFLAGS} -no-pie"
}}

{{Note|GCC version 4.x uses {{c|-nopie}} instead of {{c|-no-pie}}.}} 

Finally add the package you want to disable either PIE or SSP for to {{Path|/etc/portage/package.env}} and the relevant {{Path|/etc/portage/env/<filename>}}, for this example {{Package|sys-libs/zlib}} is used here:

{{FileBox|filename=/etc/portage/package.env|title=Disable PIE for sys-libs/zlib|1=
sys-libs/zlib nopie
}}

== See also ==

For more information, check out the following resources:

* [[Project:SELinux|Gentoo Hardened SELinux Project]]
* [[Project:Hardened/Grsecurity2_Quickstart]]
* [[Project:Hardened/PaX_Quickstart]]

== External resources ==

* http://www.rockfloat.com/howto/gentoo-hardened.html#kernel


[[Category:Security]]
