<span>{{DISPLAYTITLE:wpa_supplicant}}</span> <!-- {{Lowercase title}} loses the underscore, please stop changing it. -->

{{InfoBox stack
|{{InfoBox homepage|http://hostap.epitest.fi/wpa_supplicant/|header=true}}
|{{InfoBox wikipedia}}
}}

'''wpa_supplicant''' is a Wifi supplicant to handle authentication.

== Installation ==

=== USE flags ===

{{USEflag|package=net-wireless/wpa_supplicant|desc=Optional USE flags for {{Package|net-wireless/wpa_supplicant}}:
|ap
|dbus+yes
|eap-sim
|fasteap
|gnutls
|hs2-0+++Add support for 802.11u and Passpoint for HotSpot 2.0
|p2p
|ps3
|qt4+yes
|qt5
|readline+yes
|selinux
|smartcard
|ssl+yes
|tdls+++Add support for Tunneled Direct Link Setup (802.11z)
|uncommon-eap-types+++Add support for Wi-Fi Protected Setup
|wimax
|wps
}}

=== Emerge ===

After USE flags have been reviewed, install {{Package|net-wireless/wpa_supplicant}} using Portage's <tt>emerge</tt> command:

{{Emerge|wpa_supplicant}}

== Configuration ==

The necessary [[Wifi|wireless device drivers]] need to be installed.
For usage with a single wireless interface only one configuration file will be needed:

{{FileBox|filename=/etc/wpa_supplicant/wpa_supplicant.conf|1=# Allow users in the 'wheel' group to control wpa_supplicant
ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=wheel

# Make this file writable for wpa_gui / wpa_cli
update_config=1}}

To allow unprivileged users to control the connection using wpa_gui / wpa_cli, make sure <code>GROUP=wheel</code> and <code>update_config=1</code>.

=== Setup for dhcpcd as network manager ===

No special setup is needed for [[Network_management_using_DHCPCD|operating wpa_supplicant with dhcpcd]].  However, in dhcpcd-6.10.0, the 10-wpa_supplicant hook is no longer installed in {{Path|/lib/dhcpcd/dhcpcd-hooks}} by default.<ref>[https://gentoo.org/support/news-items/2016-01-08-some-dhcpcd-hooks-are-now-examples.html News Items -  Some dhcpcd hooks are now examples] [https://gentoo.org/ Welcome â€“ Gentoo Linux], January 8th, 2016. Retrieved on January 11th, 2016.</ref>  So it needs to be copied there manually:

{{RootCmd|cp /usr/share/dhcpcd/hooks/10-wpa_supplicant /lib/dhcpcd/dhcpcd-hooks}}

{{Important|Do not add wpa_supplicant to any runlevel. It will be controlled by dhcpcd.}}

=== Setup for Gentoo net.* scripts ===

Tell the [[Netifrc|network script]] to use wpa_supplicant:

{{FileBox|filename=/etc/conf.d/net|lang=bash|1=
modules_wlan0="wpa_supplicant"
config_wlan0="dhcp"
}}

After configuration below it is a good idea change the permissions to ensure that WiFi passwords can not be viewed in plaintext by anyone using the computer:<ref>{{Bug|264000}}</ref>

{{RootCmd|chmod 600 /etc/wpa_supplicant/wpa_supplicant.conf}}

== Usage ==
=== Using wpa_gui ===

The simplest way to use wpa_supplicant is by using its interface called {{c|wpa_gui}}. To enable it, build wpa_supplicant with the the [https://packages.gentoo.org/useflags/qt4 <code>qt4</code>] or [https://packages.gentoo.org/useflags/qt5 <code>qt5</code>] flag enabled.

=== Using wpa_cli ===

Wpa_supplicant also has a command-line user interface. Typing <tt>wpa_cli</tt> starts its interactive mode with tab-completion.

{{Cmd|wpa_cli
wpa_cli v2.3
Copyright (c) 2004-2014, Jouni Malinen <j@w1.fi> and contributors

This software may be distributed under the terms of the BSD license.
See README for more details.


Selected interface 'wlp8s0'

Interactive mode

> }}

Typing <tt>help</tt> at this prompt will list the commands available. More details on how to connect can be found in the Arch Linux wiki.<ref>https://wiki.archlinux.org/index.php/WPA_supplicant#Connecting_with_wpa_cli</ref>

=== Editing manually ===

Of course, the configuration file {{Path|/etc/wpa_supplicant/wpa_supplicant.conf}} could also be edited manually. This works well if the computer does not need to connect to many different access points.

Examples can be found in <kbd>man 5 wpa_supplicant.conf</kbd> and {{Path|/usr/share/doc/wpa_supplicant-2.4-r3/wpa_supplicant.conf.bz2}}.

==== WPA2 with wpa_supplicant ====

Connecting to any wireless access point serving ''YourSSID''

{{FileBox|filename=/etc/wpa_supplicant/wpa_supplicant.conf|1=
ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=wheel
#ap_scan=0
#update_config=1

network={
        ssid="YourSSID"
        psk="your-secret-key"
        scan_ssid=1
        proto=RSN
        key_mgmt=WPA-PSK
        group=CCMP TKIP
        pairwise=CCMP TKIP
        priority=5
}
}}

Using ''bssid'' to specify which access point it should connect to using its MAC address, in case there are repeaters in place. Remember to use wpa_passphrase <ssid> [passphrase] to generate the psk

{{FileBox|filename=/etc/wpa_supplicant/wpa_supplicant.conf|1=
ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=wheel
ap_scan=1

network={
        bssid=00:50:17:31:1a:11
        ssid="YourSSID"
        psk="your-secret-key"
        scan_ssid=1
        proto=RSN
        key_mgmt=WPA-PSK
        group=CCMP TKIP
        pairwise=CCMP TKIP
        priority=5
}
}}

==== Auto-connect to any unsecured network ====

{{FileBox|filename=/etc/wpa_supplicant/wpa_supplicant.conf|1=
network={
        key_mgmt=NONE
        priority=-999
}
}}

== Troubleshooting ==

In case it does not work as expected try some of the following and analyze the output.

=== Run wpa_supplicant in debug mode ===

{{RootCmd|wpa_supplicant -Dnl80211 -iwlan0 -C/var/run/wpa_supplicant/ -c/etc/wpa_supplicant/wpa_supplicant.conf -dd|output=<pre>wpa_supplicant v2.2
random: Trying to read entropy from /dev/random
Successfully initialized wpa_supplicant
Initializing interface 'wlp8s0' conf '/etc/wpa_supplicant/wpa_supplicant.conf' driver 'nl80211' ctrl_interface '/var/run/wpa_supplicant' bridge 'N/A'
Configuration file '/etc/wpa_supplicant/wpa_supplicant.conf' -> '/etc/wpa_supplicant/wpa_supplicant.conf'
Reading configuration file '/etc/wpa_supplicant/wpa_supplicant.conf'
ctrl_interface='DIR=/var/run/wpa_supplicant GROUP=wheel'
update_config=1
Line: 6 - start of a new network block
</pre>}}

* {{Bug|wpa_supplicant|search=package}}

=== Enable Logging ===

By default, wpa_supplicant performs very little debugging without the <code>debug</code> flag enabled.

{{RootCmd|USE{{=}}"debug" emerge --ask wpa_supplicant}}

{{FileBox|filename=/etc/conf.d/net|title=for usage with the [[#Setup_for_Gentoo_net..2A_scripts|Setup for Gentoo net.* scripts]]|lang=bash|1=
modules_wlan0="wpa_supplicant"
wpa_supplicant_wlan0="-Dnl80211 -d -f /var/log/wpa_supplicant.log"
config_wlan0="dhcp"
}}

Now, within one terminal issue a <tt>tail</tt> command to monitor output and restart the net.wlan0 device in another:

{{RootCmd|tail -f /var/log/wpa_supplicant.log
|/etc/init.d/net.wlan0 restart}}

== References ==

{{reflist}}
[[Category:Network management]]

== See also ==

== External resources ==

* [http://forums.gentoo.org/viewtopic-t-1007254-highlight-.html HOWTO: Remote access point with wpa_supplicant (Gentoo Forums)]
* https://en.wikipedia.org/wiki/Extensible_Authentication_Protocol - Extensible Authentication Protocol (Link to en.wikipedia.org)
* http://wiki.freeradius.org/protocol/EAP - Extensible Authentication Protocol (Link to wiki.freeradius.org)
