<languages />
<translate>
<span>{{DISPLAYTITLE:wpa_supplicant}}</span> <!-- {{Lowercase title}} loses the underscore, please stop changing it. -->

{{InfoBox stack
|{{InfoBox homepage|http://hostap.epitest.fi/wpa_supplicant/|header=true}}
|{{InfoBox wikipedia}}
|{{InfoBox gitweb|http://w1.fi/cgit/hostap/|raw=true}}
}}

'''wpa_supplicant''' is a Wifi supplicant to handle authentication.

== Installation ==

As a precondition, wireless support needs to be activated in the kernel as described in [[Wifi/IEEE_802.11]].

=== USE flags ===

{{USEflag|package=net-wireless/wpa_supplicant}}

=== Emerge ===

After USE flags have been reviewed, install {{Package|net-wireless/wpa_supplicant}} using Portage's {{c|emerge}} command:

{{Emerge|net-wireless/wpa_supplicant}}

== Configuration ==

The necessary [[Wifi|wireless device drivers]] need to be installed.
For usage with a single wireless interface only one configuration file will be needed:

{{FileBox|filename=/etc/wpa_supplicant/wpa_supplicant.conf|lang=ini|1=# Allow users in the 'wheel' group to control wpa_supplicant
ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=wheel

# Make this file writable for wpa_gui / wpa_cli
update_config=1}}

To allow unprivileged users to control the connection using wpa_gui / wpa_cli, make sure the users are in the [[Knowledge_Base:Adding_a_user_to_a_group|<code>wheel</code> group]].

=== Setup for dhcpcd as network manager ===

Emerge {{c|wpa_supplicant}} version >=2.6-r1 in order to get the [https://forums.gentoo.org/viewtopic-t-1036958-start-4.html CONFIG_MATCH_IFACE] option [https://gitweb.gentoo.org/repo/gentoo.git/commit/net-wireless/wpa_supplicant?id=423af2686b225f76bb8ae52221690581a56a9625 added in April 2017],

{{RootCmd|emerge -1 --ask ">{{=}}net-wireless/wpa_supplicant-2.6-r1"}}

complete its conf.d file with the new <code>-M</code> option

{{FileBox|filename=/etc/conf.d/wpa_supplicant|lang=bash|1=wpa_supplicant_args="-B -M -c/etc/wpa_supplicant/wpa_supplicant.conf"}}

and run it as a service:

{{RootCmd|rc-update add wpa_supplicant default|/etc/init.d/wpa_supplicant start}}

=== Setup for Gentoo net.* scripts ===

Tell the [[Netifrc|network script]] to use wpa_supplicant:

{{FileBox|filename=/etc/conf.d/net|lang=bash|1=
modules_wlan0="wpa_supplicant"
config_wlan0="dhcp"
}}

After configuration below it is a good idea to change the permissions to ensure that WiFi passwords can not be viewed in plaintext by anyone using the computer:<ref>{{Bug|264000}}</ref>

{{RootCmd|chmod 600 /etc/wpa_supplicant/wpa_supplicant.conf}}

== Usage ==
=== Using wpa_gui ===

The simplest way to use wpa_supplicant is by using its interface called {{c|wpa_gui}}. To enable it, build wpa_supplicant with the [https://packages.gentoo.org/useflags/qt4 <code>qt4</code>] or [https://packages.gentoo.org/useflags/qt5 <code>qt5</code>] flag enabled.

=== Using wpa_cli ===

Wpa_supplicant also has a command-line user interface. Typing {{c|wpa_cli}} starts its interactive mode with tab-completion. Typing <code>help</code> at this prompt will list the commands available.

{{RootCmd| <nowiki>echo "update_config=1" >>/etc/wpa_supplicant/wpa_supplicant.conf</nowiki>}}
{{RootCmd| wpa_cli}}
{{CodeBox|<nowiki> wpa_cli v2.5
 Copyright (c) 2004-2015, Jouni Malinen <j@w1.fi> and contributors

 This software may be distributed under the terms of the BSD license.
 See README for more details.


 Selected interface 'wlan0'

 Interactive mode

 > scan
 OK
 > scan_results
 bssid / frequency / signal level / flags / ssid
 01:23:45:67:89:ab       2437    0       [WPA-PSK-CCMP+TKIP][WPA2-PSK-CCMP+TKIP][ESS]    hotel-free-wifi
 > add_network
 0
 > set_network 0 ssid "hotel-free-wifi"
 OK
 > set_network 0 psk "password"
 OK
 > enable_network 0
 OK
 <3>CTRL-EVENT-SCAN-RESULTS 
 <3>WPS-AP-AVAILABLE 
 <3>Trying to associate with 01:23:45:67:89:ab (SSID='hotel-free-wifi' freq=2437 MHz)
 <3>Associated with 01:23:45:67:89:ab
 <3>WPA: Key negotiation completed with 01:23:45:67:89:ab [PTK=CCMP GTK=TKIP]
 <3>CTRL-EVENT-CONNECTED - Connection to 01:23:45:67:89:ab completed [id=0 id_str=]
 > save_config 
 OK
 > quit</nowiki>}}
More details on how to connect can be found in the Arch Linux wiki.<ref>https://wiki.archlinux.org/index.php/WPA_supplicant#Connecting_with_wpa_cli</ref>

=== Using wpa_passphrase ===

wpa_supplicant includes a tool to quickly write a network block from the command line for Preshared-Key (PSK aka password) networks, {{c|wpa_passphrase}}.

{{RootCmd|wpa_passphrase <ssid> [passphrase]}}

The SSID is required. If omitted, the passphrase can be entered when prompted.

The resulting output can then be copied or piped to {{Path|/etc/wpa_supplicant/wpa_supplicant.conf}}.

=== Editing manually ===

Of course, the configuration file {{Path|/etc/wpa_supplicant/wpa_supplicant.conf}} could also be edited manually. However this can be very laborious if the computer needs to connect to many different access points.

Examples can be found in {{c|man 5 wpa_supplicant.conf}} and {{Path|/usr/share/doc/wpa_supplicant-2.4-r3/wpa_supplicant.conf.bz2}}.

==== WPA2 with wpa_supplicant ====

Connecting to any wireless access point serving ''YourSSID''

{{FileBox|filename=/etc/wpa_supplicant/wpa_supplicant.conf|lang=ini|1=
ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=wheel
#ap_scan=0
#update_config=1

network={
        ssid="YourSSID"
        psk="your-secret-key"
        scan_ssid=1
        proto=RSN
        key_mgmt=WPA-PSK
        group=CCMP TKIP
        pairwise=CCMP TKIP
        priority=5
}
}}

Using ''bssid'' to specify which access point it should connect to using its MAC address, in case there are repeaters in place. Remember to use wpa_passphrase <ssid> [passphrase] to generate the [[wikipedia:Pre-shared_key|psk]]

{{FileBox|filename=/etc/wpa_supplicant/wpa_supplicant.conf|lang=ini|1=
ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=wheel
ap_scan=1

network={
        bssid=00:50:17:31:1a:11
        ssid="YourSSID"
        psk="your-secret-key"
        scan_ssid=1
        proto=RSN
        key_mgmt=WPA-PSK
        group=CCMP TKIP
        pairwise=CCMP TKIP
        priority=5
}
}}

==== Auto-connect to any unsecured network ====

{{FileBox|filename=/etc/wpa_supplicant/wpa_supplicant.conf|lang=ini|1=
network={
        key_mgmt=NONE
        priority=-999
}
}}

== Troubleshooting ==

In case it does not work as expected try some of the following and analyze the output.

=== Run wpa_supplicant in debug mode ===

{{RootCmd|killall wpa_supplicant|wpa_supplicant -Dnl80211 -iwlan0 -C/var/run/wpa_supplicant/ -c/etc/wpa_supplicant/wpa_supplicant.conf -dd|output=<pre>wpa_supplicant v2.2
random: Trying to read entropy from /dev/random
Successfully initialized wpa_supplicant
Initializing interface 'wlp8s0' conf '/etc/wpa_supplicant/wpa_supplicant.conf' driver 'nl80211' ctrl_interface '/var/run/wpa_supplicant' bridge 'N/A'
Configuration file '/etc/wpa_supplicant/wpa_supplicant.conf' -> '/etc/wpa_supplicant/wpa_supplicant.conf'
Reading configuration file '/etc/wpa_supplicant/wpa_supplicant.conf'
ctrl_interface='DIR=/var/run/wpa_supplicant GROUP=wheel'
update_config=1
Line: 6 - start of a new network block
</pre>}}

* {{Bug|wpa_supplicant|search=package}}

=== Enable Logging ===

By default, wpa_supplicant performs very little debugging without the <code>debug</code> flag enabled.

{{RootCmd|USE{{=}}"debug" emerge --ask wpa_supplicant}}

{{FileBox|filename=/etc/conf.d/net|title=for usage with the [[#Setup_for_Gentoo_net..2A_scripts|Setup for Gentoo net.* scripts]]|lang=bash|1=
modules_wlan0="wpa_supplicant"
wpa_supplicant_wlan0="-Dnl80211 -d -f /var/log/wpa_supplicant.log"
config_wlan0="dhcp"
}}

Now, within one terminal issue a {{c|tail}} command to monitor output and restart the net.wlan0 device in another:

{{RootCmd|tail -f /var/log/wpa_supplicant.log
|/etc/init.d/net.wlan0 restart}}

== References ==

{{reflist}}

== See also ==

== External resources ==

* [http://forums.gentoo.org/viewtopic-t-1007254-highlight-.html HOWTO: Remote access point with wpa_supplicant (Gentoo Forums)]
* https://en.wikipedia.org/wiki/Extensible_Authentication_Protocol - Extensible Authentication Protocol (Link to en.wikipedia.org)
* http://wiki.freeradius.org/protocol/EAP - Extensible Authentication Protocol (Link to wiki.freeradius.org)
* Forums post https://forums.gentoo.org/viewtopic-t-1036958-start-4.html - wpa_supplicant upstream just accepted patch to allow interface matching

</translate>
[[Category:Network management]]
