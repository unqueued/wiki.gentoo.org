<languages />


{{Metadata|abstract=AIDE означает Advanced Intrusion Detection Environment (расширенная система обнаружения вторжений) и является приложением, которое сканирует файлы и другие источники и сохраняет информацию об этих файлах в базе данных. Повторное сканирование системы может затем обнаружить (возможно нежелательные) изменения и о них сообщить.}}

== AIDE ==

AIDE означает "Advanced Intrusion Detection Environment" (расширенная система обнаружения вторжений) и является приложением, которое сканирует файлы и другие источники и сохраняет информацию об этих файлах в базе данных. Эта информация может быть их хэшем, размером файла, информацией о владельце, и т.д. Приложение может затем, как только эта база данных доступна, просканировать систему снова и сравнить результаты со значениями сохраненными ранее. Если значения различаются, то файл изменен, и об этом изменении сообщается.

=== Установка и конфигурация ===

В Gentoo довольно просто установить <tt>aide</tt> после соответствующей настройки USE-флагов. На время написания, поддерживаемыми USE-флагами являются:

{{USEflag|package=app-forensics/aide
|acl
|audit++yes
|curl
|mhash++yes
|nls++yes
|postgres
|prelink
|selinux
|static
|xattr++yes
|zlib++yes
}}

Затем, это вопрос установки программы:

{{Emerge|app-forensics/aide}}

Файл настроек <tt>aide</tt> не настолько устрашающий, как это может показаться с первого взгляда. Файл по умолчанию хранится в {{Path|/etc/aide/aide.conf}}, но если это необходимо, администраторы легко могут создать множественные отдельные файлы настроек. Кроме нескольких переменных, файл настроек содержит несколько кратких обозначений для того, какие аспекты файлов нужно сканировать (только хэш-суммы, или также информацию об индексных дескрипторах (inodes), и т.д.) и затем, какие файлы нужно сканировать.

Давайте сначала рассмотрим переменные.

{{FileBox|filename=aide.conf|title=Переменные|1=
database=file:/var/lib/aide/aide.db
database_out=file:/var/lib/aide/aide.db.new
}}

Эти параметры определяют где хранить базу данных, которая содержит уже известные значения (<code>database</code>), и где хранить новую базу данных при ее создании (<code>database_out</code>). В основном, рекомендуется, чтобы эти переменные не указывали на одно и то же. Вместо этого рекомендуется ручное копирование сгенерированной базы данных из одного места в другое.

А сейчас, оставьте эти переменные как есть, мы вернемся к ним позже.

{{FileBox|filename=aide.conf|title=Сокращенные обозначения|lang=ini|1=
Binlib = p+i+n+u+g+s+b+m+c+md5+sha1
Logs = p+i+n+u+g+S
...
}}

Это краткие обозначения того, что нужно измерять. Эти буквы описаны в файле {{Path|aide.conf}} по умолчанию, но в следующей таблице дан обзор самых частоиспользуемых из них.

{| class="table"
! Короткое обозначение
! Описание
|-
| <code>p</code>
| Разрешения
|-
| <code>i</code>
| Номер индексного дескриптора
|-
| <code>n</code>
| Число (жестких) ссылок
|-
| <code>u</code>
| Информация о пользователе
|-
| <code>g</code>
| Информация о группе
|-
| <code>s</code>
| Размер
|-
| <code>S</code>
| Размер (сообщать только если размер стал меньше, расти можно)
|-
| <code>b</code>
| Количество блоков
|-
| <code>m</code>
| Время изменения</code>
|}

Кроме того, достаточно очевидно, что <code>md5</code> и <code>sha1</code> означают вычисление контрольных сумм MD5 и SHA-1.

Эти краткие обозначения затем используются для идентификации того, что сканировать и в каких файлах. 

{{FileBox|filename=aide.conf|title=Задачи сканирования|1=
/bin Binlib
/sbin Binlib
/var/log Logs
...
}}

Это является представлением того, какие каталоги нужно сканировать, и что нужно сканировать в них. В приведенном выше примере из трех строк, мы сообщаем AIDE, что нужно сканировать места {{Path|/bin}} и {{Path|/sbin}} и принять меры, обозначенные ранее в кратком обозначении <code>Binlib</code>. Место {{Path|/var/log}} должно использовать меры сканирования <code>Logs</code>.

AIDE поддерживает регулярные выражения и пользователям разрешено ''удалять'' совпадения. Например, чтобы просканировать {{Path|/var/log}}, но не {{Path|/var/log/portage}}, включите набор исключений вроде такого:

{{FileBox|filename=aide.conf|title=Другие задачи сканирования|1=
/var/log Logs
!/var/log/portage
}}

=== Инициализация и частое сканирование ===

Сначала нам нужно инициализировать базу данных один раз. 

{{RootCmd|aide --init --config{{=}}/etc/aide/aide.conf|output=<pre>
AIDE, version 0.14.2
  
### AIDE database at /var/lib/aide/aide.db.new initialized.
</pre>}}

Как только база данных инициализирована, мы можем скопировать файл базы данных.

{{RootCmd|cd /var/lib/aide; cp aide.db.new aide.db}}

Теперь, с доступной базой данных, мы можем просканировать записи снова для обнаружения потенциальных изменений:

{{RootCmd|aide --check --config{{=}}/etc/aide/aide.conf|output=<pre>
AIDE, version 0.14.2
  
### All files match AIDE database. Looks okay!
</pre>}}

Когда произошло изменение файла, будет послано уведомление:

{{RootCmd|aide --check --config{{=}}/etc/aide/aide.conf|output=<pre>
AIDE found differences between database and filesystem!!
Start timestamp: 2013-04-11 15:31:02
  
Summary:
  Total number of files:        318
  Added files:                  0
  Removed files:                0
  Changed files:                2
  
  
---------------------------------------------------
Changed files:
---------------------------------------------------
  
changed: /etc/pam.d
changed: /etc/pam.d/run_init
  
---------------------------------------------------
Detailed information about changes:
---------------------------------------------------
  
  
Directory: /etc/pam.d
  Mtime    : 2013-04-09 22:11:18              , 2013-04-11 15:31:01
  Ctime    : 2013-04-09 22:11:18              , 2013-04-11 15:31:01
  
File: /etc/pam.d/run_init
  Size     : 205                              , 208
  Mtime    : 2013-04-09 22:11:18              , 2013-04-11 15:31:00
  Ctime    : 2013-04-09 22:11:18              , 2013-04-11 15:31:01
  Inode    : 394203                           , 394053
  MD5      : Mm0KPzpPt63eqGClTJ/KaQ==         , eLUrP2BsIq25f3AZX+dlBA==
  SHA1     : NrQtsUeOsXS4RHUq+ejYBne5V6E=     , 5A6ef6VJCcMiqEjKQ7e9xkBNZB8=
</pre>}}

== Лучшие Практики ==

=== Ясно определите что нужно сканировать ===

Файл конфигурации AIDE по умолчанию полезен, но требуется его тонкая настройка для соответствия требованиям пользователей. Важно знать какие файлы нужно сканировать и почему.

Например, для сканирования всех файлов, связанных с аутентификацией, и никаких других файлов, используйте следующие настройки:

{{FileBox|filename=aide.conf|title=Задачи сканирования, связанные с аутентификацией|1=
# Политики SELinux и настройки
/etc/selinux ConfFiles
# Базы данных аутентификации
/etc/passwd ConfFiles
/etc/shadow ConfFiles
/etc/nsswitch.conf ConfFiles
# Конфигурация аутентификации
/etc/pam.d ConfFiles
/etc/securetty ConfFiles
/etc/security ConfFiles
# Библиотеки PAM
/lib(64)?/security Binlib
}}

=== Храните базу данных на внешнем носителе и в режиме только для чтения ===

Вторым важным аспектом является то, что полученную в результате базу данных нужно хранить на внешнем носителе, когда она Вам не нужна, и использовать режим только для чтения, когда эта база данных понадобилась. Это дает некоторую защиту от злоумышленника, который уже мог скомпрометировать компьютер, чтобы модифицировать базу данных с результатами сканирования. Например, храните конечную базу данных на смонтированном каталоге NFS в режиме только для чтения (для серверов), или на носителе данных с доступом только для чтения (если возможен физический доступ к компьютеру), таком как CD/DVD или USB-флеш-накопитель с переключателем в режим "только чтение".

After storing the database on such location, update the {{Path|aide.conf}} file to have <code>database=</code> point to this new location.

=== Делайте автономное сканирование ===

If applicable, try using offline scanning methods for the system. In case of virtual platforms, it might be possible to take a snapshot of the system, mount this snapshot (read-only) and then run the aide scan on the mounted file system.

{{RootCmd|losetup /dev/loop0 /srv/virt/gentoo.img
|vgscan
|vgchange -ay
|mount -o ro /dev/volgrpX/volumeY /mnt/image
|chroot /mnt/image
|aide --check --config{{=}}/path/to/aide.conf
|exit
|umount /mnt/image
|vgchange -an /dev/volgrpX
|losetup -d /dev/loop0}}

The above approach uses a chroot. This is only needed when the initial file system has been scanned from the live system and the administrator wants to perform an offline validation. If the initial scan was done offline, then the {{Path|aide.conf}} file will point to the mount point already and the database will use these paths immediately, so then there is no need for chrooting.

== See also ==

* [[Integrity/Concepts]] повествует об идеях связанных с целостностью системы


[[Category:Server and Security]]
