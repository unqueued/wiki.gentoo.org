<languages />


{{Metadata|abstract=AIDE означает Advanced Intrusion Detection Environment (расширенная система обнаружения вторжений) и является приложением, которое сканирует файлы и другие источники и сохраняет информацию об этих файлах в базе данных. Повторное сканирование системы может затем обнаружить (возможно нежелательные) изменения и о них сообщить.}}

== AIDE ==

AIDE означает "Advanced Intrusion Detection Environment" (расширенная система обнаружения вторжений) и является приложением, которое сканирует файлы и другие источники и сохраняет информацию об этих файлах в базе данных. Эта информация может быть их хэшем, размером файла, информацией о владельце, и т.д. Приложение может затем, как только эта база данных доступна, просканировать систему снова и сравнить результаты со значениями сохраненными ранее. Если значения различаются, то файл изменен, и об этом изменении сообщается.

=== Установка и конфигурация ===

На Gentoo, Вы можете легко установить '''aide''' после соответствующей настройки USE-флагов. На время написания, поддерживаемыми USE-флагами являются:

{{USEflag|package=app-forensics/aide
|acl
|audit++yes
|curl
|mhash++yes
|nls++yes
|postgres
|prelink
|selinux
|static
|xattr++yes
|zlib++yes
}}

Затем, это вопрос установки программы:

{{Emerge|app-forensics/aide}}

Файл конфигурации ''aide'' не настолько устрашающий, как это может показаться с первого взгляда. Файл по умолчанию хранится в {{Path|/etc/aide/aide.conf}}, но Вы легко можете создавать множественные отдельные файлы конфигурации если захотите. Кроме нескольких переменных, файл конфигурации содержит несколько кратких обозначений для того, какие аспекты файлов нужно сканировать (только хэш-суммы, или также информацию об индексных дескрипторах (inodes), и т.д.) и затем, какие файлы нужно сканировать.

Давайте сначала рассмотрим переменные.

{{File|aide.conf|переменнные|<pre>
database=file:/var/lib/aide/aide.db
database_out=file:/var/lib/aide/aide.db.new
</pre>}}

Эти параметры определяют где хранить базу данных, которая содержит уже известные значения (''database'') и где хранить новую база данных если Вы ее создали (''database_out''). В основном рекомендуется, чтобы эти переменные не указывали на одно и то же. Вместо этого рекомендуется ручное копирование сгенерированной базы данных из одного места в другое.

А сейчас, оставьте эти переменные как есть, мы вернемся к ним позже.

{{File|aide.conf|сокращенные обозначения|<pre>
Binlib = p+i+n+u+g+s+b+m+c+md5+sha1
Logs = p+i+n+u+g+S
...
</pre>}}

Это краткие обозначения того, что нужно измерять. Эти буквы описаны в файле {{Path|aide.conf}} по умолчанию, поэтому вместо того, чтобы документировать их здесь, я просто дам информацию о некоторых из них: '''p'''ermissions (разрешения), '''i'''node number (номер индексного дескриптора), '''n'''umber of hardlinks (число жестких ссылок), '''u'''ser information (информация о пользователе), '''g'''roup information (информация о группе), '''s'''ize (или '''S''', если размеру разрешается расти, но никогда не сокращаться), '''b'''lock count (количество блоков), '''m'''odification time (время изменения), и т.д. Также, Вы возможно уже догадались, что '''md5''' и '''sha1''' означают контрольные суммы MD5 и SHA-1.

These short-hand notations are then used to identify what to scan for which files. 

{{File|aide.conf|цели сканирования|<pre>
/bin Binlib
/sbin Binlib
/var/log Logs
...
</pre>}}

This is the overview of which directories to scan, and what to scan for. In the above three lines example, we tell AIDE to scan the {{Path|/bin}} and {{Path|/sbin}} locations and take the measures identified earlier in the ''Binlib'' short-hand notation. The {{Path|/var/log}} location should use the ''Logs'' scan measures.

AIDE supports regular expressions and you are allowed to "remove" matches. For instance, if you want to scan {{Path|/var/log}} but not {{Path|/var/log/portage}} then you can include an exclusion set as well:

{{File|aide.conf|other scan targets|<pre>
/var/log Logs
!/var/log/portage
</pre>}}

=== Initialization and frequent scanning ===

First we need to initialize the database once. 

{{RootCmd|aide --init --config{{=}}/etc/aide/aide.conf|output=<pre>
AIDE, version 0.14.2
  
### AIDE database at /var/lib/aide/aide.db.new initialized.
</pre>}}

Once initialized, we can copy over the database file.

{{RootCmd|cd /var/lib/aide; cp aide.db.new aide.db}}

With the database now available, we can scan the entries again for potential modifications:

{{RootCmd|aide --check --config{{=}}/etc/aide/aide.conf|output=<pre>
AIDE, version 0.14.2
  
### All files match AIDE database. Looks okay!
</pre>}}

When a file modification is occurred, you will get a notification:

{{RootCmd|aide --check --config{{=}}/etc/aide/aide.conf|output=<pre>
AIDE found differences between database and filesystem!!
Start timestamp: 2013-04-11 15:31:02
  
Summary:
  Total number of files:        318
  Added files:                  0
  Removed files:                0
  Changed files:                2
  
  
---------------------------------------------------
Changed files:
---------------------------------------------------
  
changed: /etc/pam.d
changed: /etc/pam.d/run_init
  
---------------------------------------------------
Detailed information about changes:
---------------------------------------------------
  
  
Directory: /etc/pam.d
  Mtime    : 2013-04-09 22:11:18              , 2013-04-11 15:31:01
  Ctime    : 2013-04-09 22:11:18              , 2013-04-11 15:31:01
  
File: /etc/pam.d/run_init
  Size     : 205                              , 208
  Mtime    : 2013-04-09 22:11:18              , 2013-04-11 15:31:00
  Ctime    : 2013-04-09 22:11:18              , 2013-04-11 15:31:01
  Inode    : 394203                           , 394053
  MD5      : Mm0KPzpPt63eqGClTJ/KaQ==         , eLUrP2BsIq25f3AZX+dlBA==
  SHA1     : NrQtsUeOsXS4RHUq+ejYBne5V6E=     , 5A6ef6VJCcMiqEjKQ7e9xkBNZB8=
</pre>}}

== Best Practices ==

=== Be clear with what to scan ===

The default AIDE configuration is useful, but you'll need to fine-tune it to suit your needs. It is important to know which files to scan and why.

For instance, if you want to scan for all authentication-related files but not for other files, you can use a configuration like so:

{{File|aide.conf|authentication-related scan targets|<pre>
# SELinux policy and settings
/etc/selinux ConfFiles
# Authentication databases
/etc/passwd ConfFiles
/etc/shadow ConfFiles
/etc/nsswitch.conf ConfFiles
# Authentication configuration
/etc/pam.d ConfFiles
/etc/securetty ConfFiles
/etc/security ConfFiles
# PAM libraries
/lib(64)?/security Binlib
</pre>}}

=== Keep the database offline and read-only ===

A second important aspect is that you really want the result database to be stored off-line when you don't need it, and use it in read-only modus when you do. This gives some protection against a malicious user, that might already have compromised the machine, to also modify the results database. For instance, you can provide the result database on a read-only NFS mount (for servers) or read-only medium (when you have physical access to the machine) such as CD/DVD or read-only USB sticks.

When you have the database on such location, update the {{Path|aide.conf}} file to have ''database='' point to this new location.

=== Do offline scanning ===

If you can, try using offline scanning methods for the system. In case of virtual platforms, you might be able to take a snapshot of the system, mount this snapshot (read-only) and then run the aide scan on the mounted file system.

{{RootCmd|losetup /dev/loop0 /srv/virt/gentoo.img
|vgscan
|vgchange -ay
|mount -o ro /dev/volgrpX/volumeY /mnt/image
|chroot /mnt/image
|aide --check --config{{=}}/path/to/aide.conf
|exit
|umount /mnt/image
|vgchange -an /dev/volgrpX
|losetup -d /dev/loop0}}

The above approach uses a chroot. This is only needed when the initial file system has been scanned from the live system and you want to perform an offline validation. If you did your initial scan offline, then your {{Path|aide.conf}} will point to the mount point already and the database will use these paths immediately, so then you do not have the need for chrooting.

== More information ==

* [[Integrity/Concepts]] talks about the concepts related to system integrity


[[Category:Server and Security]]
