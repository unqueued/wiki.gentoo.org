<languages />


{{Metadata|abstract=AIDE означает Advanced Intrusion Detection Environment (расширенная система обнаружения вторжений) и является приложением, которое сканирует файлы и другие источники и сохраняет информацию об этих файлах в базе данных. Повторное сканирование системы может затем обнаружить (возможно нежелательные) изменения и о них сообщить.}}

== AIDE ==

AIDE означает "Advanced Intrusion Detection Environment" (расширенная система обнаружения вторжений) и является приложением, которое сканирует файлы и другие источники и сохраняет информацию об этих файлах в базе данных. Эта информация может быть их хэшем, размером файла, информацией о владельце, и т.д. Приложение может затем, как только эта база данных доступна, просканировать систему снова и сравнить результаты со значениями сохраненными ранее. Если значения различаются, то файл изменен, и об этом изменении сообщается.

=== Установка и конфигурация ===

На Gentoo, Вы можете легко установить '''aide''' после соответствующей настройки USE-флагов. На время написания, поддерживаемыми USE-флагами являются:

{{USEflag|package=app-forensics/aide
|acl
|audit++yes
|curl
|mhash++yes
|nls++yes
|postgres
|prelink
|selinux
|static
|xattr++yes
|zlib++yes
}}

Затем, это вопрос установки программы:

{{Emerge|app-forensics/aide}}

Файл конфигурации ''aide'' не настолько устрашающий, как это может показаться с первого взгляда. Файл по умолчанию хранится в {{Path|/etc/aide/aide.conf}}, но Вы легко можете создавать множественные отдельные файлы конфигурации если захотите. Кроме нескольких переменных, файл конфигурации содержит несколько кратких обозначений для того, какие аспекты файлов нужно сканировать (только хэш-суммы, или также информацию об индексных дескрипторах (inodes), и т.д.) и затем, какие файлы нужно сканировать.

Давайте сначала рассмотрим переменные.

{{File|aide.conf|переменнные|<pre>
database=file:/var/lib/aide/aide.db
database_out=file:/var/lib/aide/aide.db.new
</pre>}}

Эти параметры определяют где хранить базу данных, которая содержит уже известные значения (''database'') и где хранить новую база данных если Вы ее создали (''database_out''). В основном рекомендуется, чтобы эти переменные не указывали на одно и то же. Вместо этого рекомендуется ручное копирование сгенерированной базы данных из одного места в другое.

А сейчас, оставьте эти переменные как есть, мы вернемся к ним позже.

{{File|aide.conf|сокращенные обозначения|<pre>
Binlib = p+i+n+u+g+s+b+m+c+md5+sha1
Logs = p+i+n+u+g+S
...
</pre>}}

Это краткие обозначения того, что нужно измерять. Эти буквы описаны в файле {{Path|aide.conf}} по умолчанию, поэтому вместо того, чтобы документировать их здесь, я просто дам информацию о некоторых из них: '''p'''ermissions (разрешения), '''i'''node number (номер индексного дескриптора), '''n'''umber of hardlinks (число жестких ссылок), '''u'''ser information (информация о пользователе), '''g'''roup information (информация о группе), '''s'''ize (или '''S''', если размеру разрешается расти, но никогда не сокращаться), '''b'''lock count (количество блоков), '''m'''odification time (время изменения), и т.д. Также, Вы возможно уже догадались, что '''md5''' и '''sha1''' означают контрольные суммы MD5 и SHA-1.

Эти краткие обозначения затем используются для идентификации того, что сканировать и в каких файлах. 

{{File|aide.conf|задачи сканирования|<pre>
/bin Binlib
/sbin Binlib
/var/log Logs
...
</pre>}}

Это является представлением того, какие каталоги нужно сканировать, и что нужно сканировать в них. В приведенном выше примере из трех строк, мы сообщаем AIDE, что нужно сканировать места {{Path|/bin}} и {{Path|/sbin}} и принять меры, обозначенные ранее в кратком обозначении ''Binlib''. Место {{Path|/var/log}} должно использовать меры сканирования ''Logs''.

AIDE поддерживает регулярные выражения и Вам разрешено ''удалять'' совпадения. Например, если Вы хотите сканировать {{Path|/var/log}}, но не {{Path|/var/log/portage}}, то Вы также можете включить набор исключений:

{{File|aide.conf|другие задачи сканирования|<pre>
/var/log Logs
!/var/log/portage
</pre>}}

=== Инициализация и частое сканирование ===

Сначала нам нужно инициализировать базу данных один раз. 

{{RootCmd|aide --init --config{{=}}/etc/aide/aide.conf|output=<pre>
AIDE, version 0.14.2
  
### AIDE database at /var/lib/aide/aide.db.new initialized.
</pre>}}

Как только база данных инициализирована, мы можем скопировать файл базы данных.

{{RootCmd|cd /var/lib/aide; cp aide.db.new aide.db}}

Теперь, с доступной базой данных, мы можем просканировать записи снова для обнаружения потенциальных изменений.

{{RootCmd|aide --check --config{{=}}/etc/aide/aide.conf|output=<pre>
AIDE, version 0.14.2
  
### All files match AIDE database. Looks okay!
</pre>}}

Когда произошло изменение файла, Вы получите уведомление:

{{RootCmd|aide --check --config{{=}}/etc/aide/aide.conf|output=<pre>
AIDE found differences between database and filesystem!!
Start timestamp: 2013-04-11 15:31:02
  
Summary:
  Total number of files:        318
  Added files:                  0
  Removed files:                0
  Changed files:                2
  
  
---------------------------------------------------
Changed files:
---------------------------------------------------
  
changed: /etc/pam.d
changed: /etc/pam.d/run_init
  
---------------------------------------------------
Detailed information about changes:
---------------------------------------------------
  
  
Directory: /etc/pam.d
  Mtime    : 2013-04-09 22:11:18              , 2013-04-11 15:31:01
  Ctime    : 2013-04-09 22:11:18              , 2013-04-11 15:31:01
  
File: /etc/pam.d/run_init
  Size     : 205                              , 208
  Mtime    : 2013-04-09 22:11:18              , 2013-04-11 15:31:00
  Ctime    : 2013-04-09 22:11:18              , 2013-04-11 15:31:01
  Inode    : 394203                           , 394053
  MD5      : Mm0KPzpPt63eqGClTJ/KaQ==         , eLUrP2BsIq25f3AZX+dlBA==
  SHA1     : NrQtsUeOsXS4RHUq+ejYBne5V6E=     , 5A6ef6VJCcMiqEjKQ7e9xkBNZB8=
</pre>}}

== Лучшие Практики ==

=== Ясно определите что нужно сканировать ===

Файл конфигурации AIDE по умолчанию полезен, но Вам потребуется его тонкая настройка для соответствия Вашим нуждам. Важно знать какие файлы нужно сканировать и почему.

Например, если Вы хотите сканировать все файлы, связанные с аутентификацией, но никакие из других файлов, Вы можете использовать следующие настройки:

{{File|aide.conf|задачи сканирования, связанные с аутентификацией|<pre>
# SELinux policy and settings
/etc/selinux ConfFiles
# Authentication databases
/etc/passwd ConfFiles
/etc/shadow ConfFiles
/etc/nsswitch.conf ConfFiles
# Authentication configuration
/etc/pam.d ConfFiles
/etc/securetty ConfFiles
/etc/security ConfFiles
# PAM libraries
/lib(64)?/security Binlib
</pre>}}

=== Храните базу данных на внешнем носителе и в режиме только для чтения ===

Вторым важным аспектом является то, что Вам на самом деле нужно хранить полученную в результате базу данных на внешнем носителе, когда она Вам не нужна, и использовать режим только для чтения, когда Вы это делаете. Это дает некоторую защиту от злоумышленника, который уже мог скомпрометировать компьютер, для модификации базы данных с результатами сканирования. Например, Вы можете предоставить конечную базу данных на смонтированном каталоге NFS (для серверов), или на носителе данных с доступом только для чтения (когда Вы имеете физический доступ к машине), таком как CD/DVD или USB-флеш-накопитель с переключателем в режим "только чтение".

Когда Вы размещаете базу данных в таком местоположении, обновите файл {{Path|aide.conf}}, чтобы ''database='' указывала на новое место.

=== Делайте автономное сканирование ===

Если можете, попытайтесь использовать автономные методы сканирования системы. В случае с виртуальными платформами, Вы могли бы сделать снимок системы, смонтировать этот снимок (с доступом только на чтение) и затем запустить aide сканирование на примонтированной файловой системе.

{{RootCmd|losetup /dev/loop0 /srv/virt/gentoo.img
|vgscan
|vgchange -ay
|mount -o ro /dev/volgrpX/volumeY /mnt/image
|chroot /mnt/image
|aide --check --config{{=}}/path/to/aide.conf
|exit
|umount /mnt/image
|vgchange -an /dev/volgrpX
|losetup -d /dev/loop0}}

Подход, представленный выше, использует chroot. Это требуется только тогда, когда исходная файловая система сканируется с действующей системы, и Вы хотите выполнить автономную проверку. Если Вы сделали первоначальное сканирование в автономном режиме, то Ваш {{Path|aide.conf}} уже будет указывать на точку монтирования и база данных будет пользоваться этими путями незамедлительно, поэтому в данном случае Вам не требуется использование chroot.

== Более подробная информация ==

* [[Integrity/Concepts]] повествует об идеях связанных с целостностью системы


[[Category:Server and Security]]
