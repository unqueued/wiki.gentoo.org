<languages />

{{Metadata|abstract=La orden sudo ofrece una forma simple y segura de permitir a los usuarios normales lanzar algunas o todas las órdenes como el usuario root o como cualquier otro usuario, posiblemente sin facilitar una contraseña.}}

{{Lowercase title}}
{{InfoBox stack
|{{InfoBox homepage|http://www.sudo.ws/|header=true}}
|{{InfoBox wikipedia|sudo}}
|{{InfoBox gitweb|http://www.sudo.ws/repos/sudo|raw=true}}
}}

La orden {{c|sudo}} ofrece una forma sencilla y segura de escalar los privilegios de un usuario, esto es, permite que los usuarios normales lancen algunas (o incluso todas) las órdenes como el usuario {{c|root}} o como otro usuario, bien facilitando una contraseña o no.

Cuando quiera que varias personas realicen ciertas tareas administrativas en su sistema sin que tenga que concederles un acceso total como [[Wikipedia:Superuser|root]], el uso de {{c|sudo}} es la mejor opción. Con {{c|sudo}} puede controlar quién puede hacer según qué. Esta guía le ofrece una pequeña introducción a esta potente herramienta.

Este artículo pretende ser una introducción rápida. El paquete {{Package|app-admin/sudo}} es mucho más potente que lo que aquí se describe. Tiene características especiales para la edición de ficheros con un usuario distinto ({{c|sudoedit}}), se puede lanzar desde un guión (por lo que puede estar en segundo plano, leer la contraseña desde la entrada estándar en lugar del teclado, ...), etc.

Por favor, lea las páginas del manual de {{c|sudo}} y de {{c|sudoers}} para obtener más información.

== Instalación ==

=== Ajustes USE ===

{{USEflag|package=app-admin/sudo}}

=== Emerge ===

{{Emerge|app-admin/sudo}}

== Configuración ==

=== Registrar la actividad ===

Una ventaja adicional de {{c|sudo}} es que puede registrar cualquier intento (satisfactorio o no) de lanzar una aplicación. Esto es de gran utilidad si le quiere seguir la pista al que cometió ese error fatal que le llevó diez horas arreglar :&#41;

=== Conceder permisos ===

El paquete {{Package|app-admin/sudo}} permite al administrador del sistema otorgar permiso a otros usuarios para lanzar una o más aplicaciones sobre las que, normalmente, no tendría permiso. A diferencia de usar el bit <code>setuid</code> en estas aplicaciones, {{c|sudo}} proporciona un control más fino acerca de ''quién'' puede lanzar cierta orden y ''cuándo'' puede hacerlo.

With {{c|sudo}} you can make a clear list of ''who'' can execute a certain application. If you set the [[wikipedia:setuid|setuid]] bit on an executable, any user would be able to run the application (or any user of a certain group, depending on the permissions used). With {{c|sudo}} you can (and probably should) require the user to provide a password in order to execute the application.

The {{c|sudo}} configuration is managed by the {{Path|/etc/sudoers}} file. This file should never be edited through {{c|nano /etc/sudoers}} or {{c|vim /etc/sudoers}}, or any other editor you would normally use. When you want to alter the {{Path|/etc/sudoers}} file, you should always use {{c|visudo}}. This tool makes sure that no two system administrators are editing this file at the same time, preserves the permissions on the file, and performs some syntax checking to make sure you make no fatal mistakes in the file.

=== Sintaxis básica ===

The most difficult part of {{c|sudo}} is the {{Path|/etc/sudoers}} syntax. The basic syntax is as follows:

{{CodeBox|title=Sintaxis básica de /etc/sudoers|1=
usuario nombre_de_equipo = orden
}}

This line tells {{c|sudo}} that the user, identified by <code>user</code> and logged in on the system <code>host</code>, can execute the command <code>command</code> (which can also be a comma-separated list of allowed commands).

Un ejemplo más cercano a una situación real podría clarificar esto: Para permitir que el usuario {{c|larry}} lance {{c|emerge}} cuando está en {{c|localhost}}:

{{CodeBox|title=Ejemplo real del fichero /etc/sudoers|1=
larry localhost = /usr/bin/emerge
}}

{{Note|El nombre del equipo debe coincidir con el que devuelve la orden {{c|hostname}}.}}

{{Note|En el caso más sencillo, las órdenes deben ser rutas completas cualificadas a los ejecutables: Por ejemplo: <code>/usr/bin/emerge</code> no solo <code>emerge</code>. Las rutas pueden también contener caracteres comodín y pueden hacer referencia a directorios enteros. Leer la página del manual para obtener más detalles.}}

{{Warning|Do not allow a normal user to run an application that can enable them to elevate privileges. For instance, allowing users to execute {{c|[[emerge]]}} as root can grant them full root access to the system because {{c|emerge}} can be manipulated to change the live file system to the user's advantage. If you do not trust your {{c|sudo}} users, don't grant them any additional rights.}}

The user name can also be substituted with a group name, in which case the name is prefaced by a <code>%</code> sign. For instance, to allow any one in the {{c|wheel}} group to execute {{c|emerge}}:

{{CodeBox|title=Permitir a cualquier miembro del grupo {{c|wheel}} lanzar {{c|emerge}}|1=
%wheel localhost = /usr/bin/emerge
}}

To enable more than one command for a given user on a given machine, multiple commands can be listed on the same line. For instance, to allow {{c|larry}} to not only run {{c|emerge}} but also {{c|ebuild}} and {{c|emerge-webrsync}} as root:

{{CodeBox|title=Multiples órdenes|1=
larry localhost = /usr/bin/emerge, /usr/bin/ebuild, /usr/sbin/emerge-webrsync
}}

You can also specify a precise command line (including parameters and arguments) not just the name of the executable. This is useful to restrict the use of a certain tool to a specified set of command options. The {{c|sudo}} tool allows [[shell]]-style [[Wikipedia:Wildcard character|wildcards]] (AKA meta or glob characters) to be used in path names as well as command-line arguments in the sudoers file. Note that these are ''not'' regular expressions.

Here is an example of {{c|sudo}} from the perspective of a first-time user of the tool who has been granted access to the full power of {{c|emerge}}:

{{Cmd|sudo emerge -uDN world|output=<pre>
Confiamos en que haya recibido las indicaciones normales del Administrador del Sistema Local. Normalmente consisten en estas tres cosas:

    #1&#41; Respect the privacy of others (Respete la privacidad del resto).
    #2&#41; Think before you type (Piense antes de escribir).
    #3&#41; With great power comes great responsibility (Grandes poderes conllevan grandes responsabilidades).

Contraseña: ## (Introduzca la contraseña del usuario ¡No la de root!)
</pre>
}}

La contraseña solicitada por {{c|sudo}} es la del propio usuario. Esto es para asegurarse de que ninguna terminal abierta accidentalmente a otros por error sea utilizada con fines dañinos.

{{Important|{{c|sudo}} does not alter the <code>${PATH}</code> variable: any command placed after {{c|sudo}} is executed within ''the user's own environment''. Thus if a user wants to run a tool in {{Path|/sbin}}, for instance, the user must provide {{c|sudo}} with the full path of the command, like so:

{{Cmd|sudo /usr/sbin/emerge-webrsync}}

=== Sintaxis básica con LDAP ===

Los ajustes USE <code>ldap</code> y <code>pam<code> son necesarios para ofrecer soporte LDAP.

Cuando se utiliza sudo con LDAP, sudo también leerá la configuración del servidor LDAP, por lo que necesitará editar estos dos ficheros.

{{FileBox|filename=/etc/ldap.conf.sudo|title=Please chmod 400 when done|1=
# See ldap.conf(5) and README.LDAP for details
# This file should only be readable by root
 
# supported directives: host, port, ssl, ldap_version
# uri, binddn, bindpw, sudoers_base, sudoers_debug
# tls_{checkpeer,cacertfile,cacertdir,randfile,ciphers,cert,key
 
host ldap.example.com
port 389
 
base dc=example,dc=com
 
uri ldap://ldap.example.com/
#uri ldapi://%2fvar%2frun%2fopenldap%2fslapd.sock
 
ldap_version 3
#ssl start_tls
 
sudoers_base ou=SUDOers,dc=example,dc=com
#sudoers_debug 2
 
bind_policy soft
}}

{{FileBox|filename=/etc/nsswitch.conf|title=Por favor, añada la línea sudoers|1=
sudoers: ldap files
}}

También necesitará añadir la siguiente entrada LDAP para sudo.

{{Note|Debido al diseño, la rama Sudoers está encima del árblo por razones de seguridad. Puede tener distintos derechos de acceso desde ldap para leer o escribir en esta rama}}

{{CodeBox|title=Ldap Entry for Sudo|lang=ldif|1=
version: 1
DN: ou=SUDOers,dc=example,dc=com
objectClass: organizationalUnit
objectClass: top
objectClass: domainRelatedObject
associatedDomain: example.com
ou: SUDOers
 
DN: cn=defaults,ou=SUDOers,dc=example,dc=com
objectClass: top
objectClass: sudoRole
cn: defaults
description: Default sudoOption's go here
sudoOption: env_reset
 
DN: cn=root,ou=SUDOers,dc=example,dc=com
objectClass: top
objectClass: sudoRole
cn: root
sudoCommand: ALL
sudoHost: ALL
sudoUser: root
 
DN: cn=%wheel,ou=SUDOers,dc=example,dc=com
objectClass: top
objectClass: sudoRole
cn: %wheel
sudoCommand: ALL
sudoHost: ALL
sudoOption: !authenticate
sudoUser: %wheel
}}

{{CodeBox|title=Ldap Entry for wheel Group|lang=ldif|1=
version: 1
DN: cn=wheel,ou=Group,dc=example,dc=com
objectClass: top
objectClass: posixGroup
cn: wheel
description: Grupo Wheel
gidNumber: 10
memberUid: useradmin1
memberUid: root
}}

Las configuraciones del sudoer en LDAP son similares a los ficheros con algunas diferencias. Por favor, lea más sobre sudo con LDAP en el enlace de abajo [http://www.sudo.ws/sudo/sudoers.ldap.man.html página del manual de Sudoers LDAP]

<references />

=== Utilizar alias ===

En entornos más extensos que tengan que dar acceso a todos los usuarios una y otra vez (o equipos u órdenes) las tareas pueden ser más costosas de realizar. Para facilitar la administración de {{Path|/etc/sudoers}}, puede definir "alias". El formato para declarar los alias es muy fácil:

{{CodeBox|title=Declararar alias en /etc/sudoers|1=
Host_Alias hostalias = equipo1, equipo2, ...
User_Alias useralias = usario1, usuario2, ...
Cmnd_Alias cmndalias = orden1, orden2, ...
}}

Un alias que siempre funciona, en cualquier posición, es <code>ALL</code> (para distinguir correctamente entre lo que son y no son alias, se recomienda utilizar mayúsculas para los alias). Como indudablemente habrá deducido, el alias <code>ALL</code> sirve para todas los valores posibles.

Un ejemplo de uso del alias <code>ALL</code> para permitir a "cualquier" usuario lanzar la orden {{c|shutdown}} si ha accedido al sistema local es:

{{CodeBox|title=Permitir que cualquier usuario puede ejecutar shutdown|lang=bash|1=
ALL localhost = /sbin/shutdown
}}

Otro ejemplo es permitir al usuario {{c|larry}} lanzar la orden {{c|emerge}} como root, independientemente del equipo donde haya iniciado sesión:

{{CodeBox|title=Permitir al usuario lanzar una aplicación independientemente de su localización|1=
larry ALL = /usr/bin/emerge
}}

Más interesante es definir un conjunto de usuarios que puedan correr aplicaciones de software administrativo (como por ejemplo {{c|emerge}} y {{c|ebuild}}) en el sistema y un grupo de administradores que puedan cambiar la contraseña de cualquier usuario, excepto la de root:

{{CodeBox|title=Utilizar un alias para usuarios y órdenes|1=
User_Alias  SOFTWAREMAINTAINERS = larry, john, danny
User_Alias  PASSWORDMAINTAINERS = larry, sysop
Cmnd_Alias  SOFTWARECOMMANDS    = /usr/bin/emerge, /usr/bin/ebuild
Cmnd_Alias  PASSWORDCOMMANDS    = /usr/bin/passwd [a-zA-Z0-9_-]*, !/usr/bin/passwd root
 
SOFTWAREMAINTAINERS  localhost = SOFTWARECOMMANDS
PASSWORDMAINTAINERS  localhost = PASSWORDCOMMANDS
}}

=== Ejecución como no root ===

También es posible que un usuario lance una aplicación como otro usuario distinto que no sea root. Esto puede ser muy interesante si corre aplicaciones como un usuario diferente (por ejemplo, {{c|apache}} para el servidor web) y desea permitir que ciertos usuarios realicen labores administrativas (por ejemplo, acabar con procesos zombi) como ese usuario.

Dentro de {{Path|/etc/sudoers}} se lista el o los usuarios entre <code>&#40;</code> y <code>&#41;</code> antes del listado de órdenes:

{{CodeBox|title=Sintaxis de ejecución para usuarios no root|1=
usuarios  equipos = (lanzar-cómo) órdenes
}}

Por ejemplo, para permitir a {{c|larry}} lanzar la herramienta {{c|kill}} como el usuario {{c|apache}} o el usuario {{c|gorg}}:

{{CodeBox|title=Ejemplo de ejecución como usuario no root|1=
Cmnd_Alias KILL = /bin/kill, /usr/bin/pkill
 
larry   ALL = (apache, gorg) KILL
}}

Con esta configuración definida, el usuario puede lanzar {{c|sudo -u}} para seleccionar al usuario con el que desea lanzar la aplicación:

{{Cmd|sudo -u apache pkill apache}}

Mediante la directiva <code>Runas_Alias</code> se puede establecer un alias para el usuario con el que se va a lanzar una aplicación. Su uso es idéntico al de otras directivas <code>_Alias</code> mostradas anteriormente.

=== Contraseñas y configuraciones por defecto ===

Por defecto, {{c|sudo}} pide al usuario que se identifique con su propia contraseña. Una vez que la introduce, {{c|sudo}} la recuerda durante cinco minutos permitiendo al usuario centrarse en sus tareas sin tener que escribir su contraseña cada vez.

Este comportamiento, por supuesto, se puede cambiar: se puede establecer la directiva <code>Defaults:</code> en  {{Path|/etc/sudoers}} para cambiar el comportamiento por defecto para un usuario.

Por ejemplo, para cambiar los cinco minutos preestablecidos a cero (no recordarla nunca):

{{CodeBox|title=|1=Cambiar el valor para el tiempo de expiración|1=
Defaults:larry  timestamp_timeout=0
}}

Definiendo la opción a <code>-1</code> permite recordar la contraseña indefinidamente (hasta que se reinicie el sistema).

Una configuración diferente consistiría en solicitar la contraseña del usuario con el que se ejecutaría la orden y no la propia contraseña personal de los usuarios. Esto se puede conseguir mediante <code>runaspw</code>. En el siguiente ejemplo, también definiremos el número de intentos (cuántas veces puede el usuario introducir de nuevo la contraseña antes de que {{c|sudo}} falle) a <code>2</code>, en el lugar del valor 3 predeterminado:

{{CodeBox|title=Solicitar la contraseña de root en lugar de la del usuario|1=
Defaults:john   runaspw, passwd_tries=2
}}

Otra característica interesante es mantener definida la variable <code>DISPLAY</code> de modo que se puedan lanzar herramientas gráficas:

{{CodeBox|title=Mantener viva la variable DISPLAY|1=
Defaults:john env_keep=DISPLAY
}}

Puede cambiar muchas de las opciones predeterminadas mediante la directiva <code>Defaults:</code>. Abra la página del manual de {{c|sudoers}} y busque <code>Defaults</code>.

Si, no obstante, desea permitir a cierto usuario lanzar un conjunto de órdenes sin proporcionar ningún tipo de contraseña, necesita entonces lanzar las órdenes con <code>NOPASSWD:</code>, así:

{{CodeBox|title=Permitir lanzar emerge como root sin solicitar la contraseña|1=
larry     localhost = NOPASSWD: /usr/bin/emerge
}}

=== Completado de órdenes en bash ===

Los usuarios que quieran tener completado de órdenes en bash con sudo, tendrán que lanzar esto una sola vez.

{{Cmd|sudo echo "complete -cf sudo" >> $HOME/.bashrc}}

=== Completado de órdenes en zshell ===

Los usuarios que deseen completado de órdenes en zsh para sudo pueden definir lo siguiente en {{Path|.zprofile}} y en {{Path|.zshrc}} respectivamente.

{{FileBox|filename=.zprofile|title=Añadir completado de órdenes en zshell|lang=bash|1=
if [[ $EUID != 0 ]]; then
    typeset -xT SUDO_PATH sudo_path
    typeset -U sudo_path
    sudo_path=({,/usr/local,/usr}/sbin(N-/))
    alias sudo="sudo env PATH=\"SUDO_PATH:$PATH\""
fi
}}

{{FileBox|filename=.zshrc|title=Añadir completado de órdenes en zshell|lang=bash|1=
zstyle ':completion:*:sudo:*' environ PATH="$SUDO_PATH:$PATH"
}}

Con el cambio de arriba, todas las órdenes en las localizaciones {{Path|/sbin}}, {{Path|/usr/sbin}} y {{Path|/usr/local/sbin}} estarán disponibles al intérprete de órdenes para completado cuando a la orden se le anteponga 'sudo'.

== Utilización ==

=== Listar privilegios ===

Ejecute {{c|sudo -l}} para informarse de cuáles son sus capacidades:

{{Cmd|sudo -l|output=<pre>
El usuario larry puede lanzar las siguiente órdenes en este equipo:
  (root) /usr/libexec/xfsm-shutdown-helper
  (root) /usr/bin/emerge
  (root) /usr/bin/passwd [a-zA-Z0-9_-]*
  (root) !/usr/bin/passwd root
  (apache) /usr/bin/pkill
  (apache) /bin/kill
</pre>
}}

Si tiene cualquier orden en {{Path|/etc/sudoers}} que no le pida que introduzca una contraseña, tampoco se le pedirá una contraseña para listar las
entradas. De no ser así, se le podría pedir su contraseña si no se recuerda.

=== Prolongar la caducidad de la contraseña ===

Por defecto, si un usuario introdujo su contraseña para autenticarse ante {{c|sudo}}, ésta se recuerda durante cinco minutos. Si el usuario quiere prolongar este periodo, puede ejecutar {{c|sudo -v}} para reiniciar la marca de tiempo de modo que pasen otros cinco minutos antes de que {{c|sudo}} pregunte de nuevo por la contraseña.

{{Cmd|sudo -v}}

Lo contrario es quitar la marca de tiempo con {{c|sudo -k}}.


[[Category:Software]]
