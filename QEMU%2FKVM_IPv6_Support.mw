== Overview ==

You have rented a whole server in a data centre somewhere and are running a few Kernel Virtual Machines (KVMs).
Your provider gives you a single IPv4 address and a IPv6 /64 subnet.
Its a nusciance to use IPv4 with non stanadard ports on the KVMs and you are too parsimonious to invest in more IPv4 addresses, its a hobby server after all.  You get a single IPv4 address and a whole IPv6 /64 subnet, since your provider cannot give you any less.

Lets put the KVMs onto IPv6 so that they have global scope IPv6 addresses.

This guide is written around the use of libvirtd 

== Prerequsites ==

: A working Gentoo host with IPv6 Support
: One or more Gentoo KVM Guests with IPv6 Support
: A IPv6 /64 prefix, like  2001:db8:dead:beef::/64
: IPv6 working on the host

IPv6 support means USE="ipv6" in make.conf, kernel IPv6 support and packages like iproute2 installed.
Other than iproute2, this is the Gentoo default.

== Getting Started ==

emerge iproute2 -pv on the hosts and KVM.

== The Host Setup ==

Your KVM setup will have created an interface called virbr0.  The settings for this are stored in
etc/libvirt/qemu/networks/default. You might want to backup this file before you start.

Stop the network, so you can edit the settings file.  Don't even think of using $EDITOR
virsh net-destroy default
virsh net-edit default

Add the following three lines above the closing <pre></network></pre> tag

<pre>  </ip>
  <ip family='ipv6' address='2001:db8:dead:beef:fe::' prefix='96'>
  </ip>
</pre>

virsh will syntax check your edit and complain loudly if you mess up.

Restart the network
virsh net-start default

Notice that the interface virbr0 has aquirred a /96 from your /64.  That's as many IP addresses 
as there is in the entire IPv$ address space. 
<pre>virbr0: flags=4099<UP,BROADCAST,MULTICAST>  mtu 1500
        inet 192.168.122.1  netmask 255.255.255.0  broadcast 192.168.122.255
        inet6 2001:db8:dead:beef:fe::  prefixlen 96  scopeid 0x0<global>
</pre>



2001:db8::/32 â€” This prefix is used in documentation
