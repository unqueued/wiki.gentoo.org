<languages/>
{{InfoBox stack
|{{InfoBox github|rhinstaller/efibootmgr|header=true}}
}}

{{Metadata|abstract=efibootmgr は、システム上の UEFI ファームウェアを操作します。Linux (およびそのほかの EFI 対応 OS)の起動を可能にするためのブートエントリを作成したり管理したりするために EFI の設定を操作するツールとして、広く知られています。}}

{{c|efibootmgr}} は、システム上の UEFI ファームウェアを操作します。Linux (およびそのほかの EFI 対応 OS)の起動を可能にするためのブートエントリを作成したり管理したりするために EFI の設定を操作するツールとして、広く知られています。

{{Package|sys-boot/efibootmgr}} は、ブートローダでは'''ありません'''。ブートローダとして動作するのはシステムの EFI ファームウェアそれ自体です。{{c|efibootmgr}}は、これを操作するためのツールです。{{c|efibootmgr}} を用いることで、ブートエントリを作成したり順序を変えたり編集したり削除したりすることが可能になります。

== インストール ==

=== カーネル ===

<var>CONFIG_EFI_VARS</var> support needs to be enabled:

{{KernelBox|title=Enable EFI variable support|1=
Firmware Drivers  --->
   EFI (Extensible Firmware Interface) Support  --->
       <*> EFI Variable Support via sysfs
}}

=== Emerge ===

{{Package|sys-boot/efibootmgr}} には USE フラグがありませんから、ただ単にインストールすればよいです:

{{Emerge|sys-boot/efibootmgr}}

== 設定 ==

=== EFI 変数 ===

{{c|efibootmgr}} が正しく動作するには、 EFI 変数ファイルシステムにアクセス可能になっていなければなりません。そのためには、システムが（ファームウェア(BIOS)の MBR モードではなく）EFI モードでブートされている必要があります。そうでないと EFI 変数へのアクセス自体が不可能です。システムが MBR モードになっていたら、再起動して、システムのファームウェアに EFI モードで起動するように指示する必要があります。大概は、ファームウェアの設定オプションを変えたり、システムのブートメニューで EFI ブートエントリを選んだりすることで解決します。

When the system is in EFI mode, run the following command to check for the existence of [[Filesystem#Disk_filesystems|efivarfs]]:

{{RootCmd|mount {{!}} grep efivars|output=<pre>
efivarfs on /sys/firmware/efi/efivars type efivarfs (rw,nosuid,nodev,noexec,relatime)
</pre>}}

（{{Path|sysfs}} init スクリプトによってマウントされているべきなのですが）もしもマウントされていなかったら、次のコマンドでマウントすることが可能です。

{{RootCmd|mount -t efivarfs efivarfs /sys/firmware/efi/efivars}}

See [https://github.com/OpenRC/openrc/commit/3fd3bfc76dccc3752f4af949ad4076dab26357fb#diff-8312ad0561ef661716b48d09478362f3R6 OpenRC-0.28 news].

== Preconditions ==

If an EFI System Partition (ESP) does not exist, one needs to be created, see [[EFI System Partition]]

== Usage ==

=== Listing boot entries ===

現在のブートエントリのリストを表示させるには <code>--verbose (-v)</code> オプションを使用します:

{{RootCmd|efibootmgr -v|output=<pre>
BootCurrent: 0002
Timeout: 3 seconds
BootOrder: 0003,0003,0002,0000,0004
Boot0000* CD/DVD Drive  BIOS(3,0,00)
Boot0001* Hard Drive    BIOS(2,0,00)
Boot0002* Gentoo        HD(1,800,61800,6d98f360-cb3e-4727-8fed-5ce0c040365d)File(\EFI\boot\bootx64.efi)
Boot0003* Hard Drive    BIOS(2,0,00)P0: ST1500DM003-9YN16G
</pre>}}

=== Creating a boot entry ===

EFI のブートエントリを作成するには、{{c|efibootmgr}} に対していくつかのオプションを与えます:

* <code>--create (-c)</code> to create a new entry;
* <code>--part (-p)</code> followed by the partition number on which the [[EFI System Partition]] is hosted;
* <code>--disk (-d)</code> followed by the disk on which the EFI System Partition is hosted;
* <code>--label (-L)</code> followed by the label to use as the boot entry;
* <code>--loader (-l)</code> followed by the path of the EFI image to boot

{{Important/ja|EFI イメージのパスでは、{{Key|/}}(スラッシュ)ではなく ''{{Key|\}}(バックスラッシュ)を使用しなければなりません''。}}

例えば:

{{RootCmd|efibootmgr -c -d /dev/sda -p 2 -L "Gentoo" -l "\efi\boot\bootx64.efi"}}

Optionally, additional kernels can be installed and made known to the UEFI firmware. This is especially useful when wanting to test more kernels or to dual-boot with another operating system. These will be shown in the boot selection prompt, normally after a keyboard hotkey is pressed at the right time during system initialization. The latest added entry always gets highest boot priority, so it will be default. If the hotkey combination is unknown, search for official documentation from the computer manufacturer. This information is usually not difficult to find.

=== Deleting a boot entry ===

エントリを削除するにはまず、そのエントリのID番号を見つけなければなりません。

例えば Gentoo のエントリが前記のようであれば（"Boot0002" がID であれば）、{{c|efibootmgr}} に対して <code>--bootnum (-b)</code> でID番号を指定し <code>--delete-bootnum (-B)</code> でエントリの削除を命令します。

{{RootCmd|efibootmgr -b 2 -B}}

== 削除 ==

=== Unmerge ===

{{Unmerge|sys-boot/efibootmgr}}

== 参考 ==

* {{See also|rEFInd}} 
* [[EFI_stub_kernel|EFI stub kernel]] explains how to configure the Linux kernel to be able to be booted from EFI directly
* [[Handbook:AMD64/Installation/Bootloader#Alternative_2:_efibootmgr|Alternative 2: efibootmgr]] in the Gentoo Handbook
