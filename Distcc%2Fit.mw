<languages />

{{Metadata|abstract=Distcc è un programma progettato per distribuire i processi di compilazione, attraverso una rete, a degli host partecipanti. È composto da un server, distccd, e da un client, distcc. Distcc funziona in modo trasparente con ccache, Portage e perfino Automake, con un po di lavoro.}}

[http://distcc.samba.org Distcc] è un programma progettato per distribuire i processi di compilazione, attraverso una rete, a degli host partecipanti. È composto da un server, <code>distccd</code>, e da un client, <code>distcc</code>. Distcc funziona in modo trasparente con [http://ccache.samba.org ccache], Portage e perfino Automake, con un po di lavoro. 

Se stai pensando di usare distcc per facilitare il bootstrap di una installazione di Gentoo, assicurati di leggere la sezione [[#Using_Distcc_to_Bootstrap|Usare Distcc per il Bootstrap]]. 

== Configurazione ==

=== Dipendenze ===

Per poter usare Distcc, tutti i computer sulla rete devono avere la stessa versione di GCC. Ad esempio, mescolare GCC 3.3.x (dove la x è variabile) non è un problema, ma mescolare 3.3.x e 3.2.x '''potrebbe''' generare errori in fase di compilazione o di esecuzione. 

=== Installazione di Distcc ===

Ci sono un paio di opzioni che dovresti conoscere prima di cominciare a installare distcc. 

Distcc viene distribuito con un monitor grafico per controllare i task che il computer destina alla compilazione. Se si usa Gnome, occorre inserire 'gnome' tra le flag USE. Nel caso in cui non si usi Gnome ma si volesse comunque avere il monitor grafico, allora la flag USE da inserire sarebbe 'gtk'. 

{{Emerge|distcc}}

{{Important/it|Assicurarsi di aver installato distcc su tutte le macchine che partecipano alla compilazione.}}

=== Configurare portage all'uso di Distcc ===

Far usare distcc a Portage è semplice. Eseguire i passaggi seguenti su tutti i sistemi che partecipano alla compilazione distribuita: 

{{Emerge|distcc}}

Adesso, impostare le variabili <code>MAKEOPTS</code> e <code>FEATURES</code> come mostrato sotto. Una strategia comune consiste nell'impostare N al doppio del numero totale delle CPU (locali+remote)+1, ed M al numero delle CPU locali. NEl caso in cui non siano disponibili host distcc, o che l'ebuild richieda una compilazione esplicitamente locale (ad esempio, gcc), la flag <code>-lM</code> preverrà l'apertura di troppi task.

{{RootCmd|nano -w /etc/portage/make.conf|output=<pre>
MAKEOPTS="-jN -lM"
FEATURES="distcc"
</pre>
}}

=== Specificare gli host partecipanti ===

Utilizzare il comando <code>distcc-config</code> per impostare una lista di host. Ecco un esempio degli host che potrebbero essere nella tua lista: 

{{Code|Examples of host definitions|<pre>
192.168.0.1          192.168.0.2                       192.168.0.3
192.168.0.1/2        192.168.0.2                       192.168.0.3/10
192.168.0.1:4000/2   192.168.0.2/1                     192.168.0.3:3632/4
@192.168.0.1         @192.168.0.2:/usr/bin/distccd     192.168.0.3
</pre>
}}

Ci sono anche altri modi per impostare gli host. Consultare la manpage di distcc per ulteriori dettagli.

Se si vuole compilare anche in locale, occorre inserire 'localhost' nella lista degli host. Di contro, se si vuole evitare di usare la macchina locale per compilare (caso d'uso comune), bisogna ometterlo dalla lista. Inserire 'localhost' su una macchina lenta potrebbe addirittura rallentare le cose. È consigliabile effettuare dei test per raggiungere le performance migliori.

Può sembrare complicato, ma nella maggior parte dei casi una variante della riga 1 o 2 sarà sufficiente a far funzionare tutto. 

Visto che la maggior parte delle persone non usa le righe 3 e/o 4, [http://distcc.samba.org/man/distcc_1.html fare riferimento] alla documentazione di distcc (man distcc) per ulteriori informazioni, incluso il come far funzionare distcc attraverso una connessione SSH. 

Ad esempio, per impostare la prima riga dell'esempio precedente: 

{{RootCmd|/usr/bin/distcc-config --set-hosts "192.168.0.1 192.168.0.2 192.168.0.3"}}

Modificare {{Path|/etc/conf.d/distccd}} sulla base delle proprie esigenze ed assicurarsi di aver impostato la direttiva <code>--allow</code> di modo da accettare solo host fidati. Per aumentare la sicurezza, si può usare la direttiva <code>--listen</code> per indicare al demone distcc quale IP ascoltare (per sistemi multi-homed). Ulteriori informazioni su distcc sono presenti alla pagina  [http://distcc.samba.org/security.html Distcc Security Design] . 

{{Important/it|È importante usare --allow e --listen. Assicurarsi di leggere la manpage di distcc o la sezione sulla sicurezza qui sopra.}}

Adesso, lanciare il demone di distcc su tutti i computer partecipanti: 

{{RootCmd|rc-update add distccd default
|/etc/init.d/distccd start}}

=== Configurare Distcc per funzionare con Automake ===

In molti casi, questa procedura è anche più semplice della parte riguardante Portage. Ciò che bisogna fare è aggiornare la propria variabile <code>PATH</code> per farle includere {{Path|/usr/lib/distcc/bin}} di fronte alla directory che contiene <code>gcc</code>  ( {{Path|/usr/bin}} ). In ogni caso, c'è da fare attenzione. Se si usa ccache bisogna inserire distcc dopo ccache: 

{{RootCmd|export PATH{{=}}"/usr/lib/ccache/bin:/usr/lib/distcc/bin:${PATH}"}}

Si può inserire tutto questo dentro il proprio {{Path|~/.bashrc}} o equivalente, di modo da impostare PATH ogni volta che si esegue il login.

Then, as you would normally type <code>make</code> , you would type <code>make -jN</code> (where N is an integer). The value of N depends on your network and the types of computers you are using to compile. Test your own settings to find the number that yields the best performance. 

== Cross-Compilazione ==

La cross-compilazione consiste nell'utilizzare un'architettura per costruire software che verranno eseguiti su un'altra architettura. La cosa può essere semplice come ad esempio usare un Athlon (i686) per compilare un programma per K6-2(i586), o usare uno Sparc per compilare un programma per ppc. Tutto ciò è documentato nella nostra  [[Distcc/Cross-Compiling|Guida a DistCC per la Cross-compilazione]] .

== Usare Distcc per il Bootstrap ==

=== Fase 1: Configurare Portage ===

Avviare il computer con un Gentoo Linux LiveCD e seguire le  [http://www.gentoo.org/doc/en/handbook/handbook-x86.xml?part=1 istruzioni di installazione] fino alla parte riguardante il bootstrap (consultare le [http://www.gentoo.org//doc/en/faq.xml#stage12 Gentoo FAQ] per ulteriori informazioni riguardo il bootstrap.). In seguito, configurare Portage per l'uso di Distcc 

{{RootCmd|nano -w /etc/portage/make.conf|output=<pre>
FEATURES="distcc"
MAKEOPTS="-jN"
</pre>
}}

{{RootCmd|export PATH{{=}}"/usr/lib/ccache/bin:/usr/lib/distcc/bin:${PATH}"}}

=== Fase 2: Procurarsi Distcc ===

Installare distcc: 

{{RootCmd|USE{{=}}'-*' emerge --nodeps sys-devel/distcc}}

Fase 3: Configurare Distcc ===

Lanciare <code>distcc-config --install</code> per configurare distcc; sostituire <code>host*</code> con gli indirizzi IP o con gli hostname delle macchine partecipanti.

{{RootCmd|/usr/bin/distcc-config --set-hosts "localhost host1 host2 host3 ..."}}

Distcc è configurato per il bootstrap! Continuare con le istruzioni di installazioni ufficiali e '''non dimenticare''' di ri-emergere Distcc dopo aver lanciato <code>emerge system</code>, per assicurarsi che tutte le dipendenze desiderate vengano installate. 

{{Note/it|Durante il bootstrap e l'<code>emerge system</code> distcc potrebbe dare l'impressione di non essere usato. Questo è un comportamento normale in quanto alcune ebuild non funzionano correttamente con distcc, e di conseguenza lo disabilitano intenzionalmente.}}

== Risoluzione dei problemi ==

=== Alcuni pacchetti non usano Distcc ===

Man mano che si emergono pacchetti, si può notare come alcuni di essi non vengano compilati in modalità distribuita (e neanche in parallelo). Questo è possibile quando il Makefile del pacchetto in questione non supporta le operazioni parallele, o quando il manutentore dell'ebuild le ha esplicitamente disabilitate, spesso a causa di problemi noti. 

A volte distcc può causare fallimenti nelle compilazioni. Se succede, si è pregati di [http://bugs.gentoo.org comunicarlo] nel bugtracker. 

=== Versioni di GCC differenti ===

Se si hanno diverse versioni di gcc nei propri host, molto probabilmente si manifesteranno problemi di varia natura. La soluzione consiste nell'installare in tutti gli host la stessa versione di GCC. 

Gli aggiornamenti più recenti di Portage usano <code>${CHOST}-gcc</code> invece di <code>gcc</code>. Questo significa che se si stanno usando macchine i686 insieme ad altre di diverso tipo (i586,i386) si incontreranno problemi. Una soluzione può essere quella di specificare <code>export CC='gcc' CXX='c++'</code> o di inserirlo direttamente in  {{Path|/etc/portage/make.conf}}. 

{{Important/it|Effettuare questa modifica cambia alcuni comportamenti di Portage, il che potrebbe portare a strani risultati in futuro. Effettuare tutto ciò solo nel caso in cui si stiano usando CHOST differenti.}}

=== -march=native ===

A partire da GCC 4.3.0, il compilatore supporta l'opzione <code>-march=native</code>, che abilita il rilevamento automatico della CPU e le conseguenti ottimizzazioni che val la pena utilizzare. L'uso di questa opzione rappresenta un problema per <code>distcc</code> in quanto abilita il mix di codice ottimizzato per processori differenti (come AMD Athlon e Intel Pentium). ''NON'' usare <code>-march=native</code> o <code>-mtune=native</code> nelle proprie <code>CFLAGS</code> o <code>CXXFLAGS</code> durante le compilazioni con <code>distcc</code>.

Per sapere quali flag GCC abiliterebbe quando eseguito con <code>-march=native</code>, lanciare il seguente comando:

{{Cmd|gcc -march{{=}}native -E -v - &lt;/dev/null 2&gt;&amp;1 {{!}} grep cc1|output=<pre>
/usr/libexec/gcc/x86_64-pc-linux-gnu/4.7.3/cc1 -E -quiet -v - -march=corei7-avx \
  -mcx16 -msahf -mno-movbe -mno-aes -mpclmul -mpopcnt -mno-abm -mno-lwp -mno-fma \
  -mno-fma4 -mno-xop -mno-bmi -mno-bmi2 -mno-tbm -mavx -mno-avx2 -msse4.2 -msse4.1 \
  -mno-lzcnt -mno-rdrnd -mno-f16c -mno-fsgsbase --param l1-cache-size=32 \
  --param l1-cache-line-size=64 --param l2-cache-size=6144 -mtune=corei7-avx
</pre>}}

== Gli extra di Distcc ==

=== Distcc Monitor ===

Distcc viene distribuito con due monitor. Quello testuale è sempre incluso, e viene lanciato con <code>distccmon-text</code>. La prima volta può apparire confusionario, ma è molto semplice da usare. Se si lancia il comando senza parametri aggiuntivi verrà eseguito solo una volta, mentre se gli si passa un numero N, verrà aggiornato ogni N secondi. 

L'altro monitor viene attivato solo se è stata abilitata la <code>USE</code> flag <code>gtk</code> o <code>gnome</code> . Questo monitor è basato su gtk+, gira dentro l'ambiente X ed è molto bello. Per Gentoo il monitor con interfaccia grafica risponde al comando <code>distccmon-gui</code>. In altri ambienti dovrebbe rispondere al nome di <code>distccmon-gnome</code>. 

{{RootCmd|distccmon-text N}}

or run <code>distccmon-gui</code>:

{{RootCmd|distccmon-gui}}

To monitor Portage's distcc usage you can use:
{{RootCmd|DISTCC_DIR{{=}}"/var/tmp/portage/.distcc/" distccmon-text N
|DISTCC_DIR{{=}}"/var/tmp/portage/.distcc/" distccmon-gui}}

{{Important|If your distcc directory is elsewhere, change the DISTCC_DIR variable accordingly.}}

== Acknowledgements ==

We would like to thank the following authors and editors for their contributions to this guide:

* Lisa Seelye
* Mike Frysinger
* Erwin
* Sven Vermeulen
* Lars Weiler
* Tiemo Kieft
* nightmorph
