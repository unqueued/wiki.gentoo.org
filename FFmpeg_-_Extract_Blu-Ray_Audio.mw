=== Introduction ===
Some music audio only titles are just becoming available on Blu-Ray, and music lovers may need to extract the audio to another portable medium.  Since the Blu-Ray audio is usually one big file, the file chapters need to be found and split.  Most portable media requires VFAT filesystem preventing larger files sizes, and further splitting is essential.

This article will only discuss unencrypted Blu-Ray Audio media, and merrily point users to MakeMKV (media-video/makemkv) for handling encrypted Blu-Ray media.

{{Warning|Copying copy righted material not purchased by you or material you do not hold a license is a crime.  Some Countries may be more strict, and consider simply tampering with encrypted material a crime.  Funny things may also occur if you tinker with encrypted Blu-Rays, such as blacklisting. ;-)}}

{{Note|Audio ranges greater than 24 bits or 480000 Hz are frequently stated as being indistinguishable to the human ear.  As for me, I notice little difference between 16 and 24 bit, or 44100 and 48000 Hz of noisy music.}}

{{Note|Encrypted (or commercial) Blu-ray media is extremely difficult to enjoy within Linux, as MPlayer's libaacs rarely works when playing encrypted Blu-ray media.  Also anything higher than the common 16 bit 44100 Hz (CD Audio Quality), and you will require a Home Theater or 5.1/7.1 Dolby/DTS Audio Reciever with more than five quality speakers to decode and be able to notice a difference above CD audio quality.  Recievers also have the ability to copy stereo two channel into five or more channel audio, sounding extremely similar to 5.1 PCM.  If you're an older person and dislike having to always buy additional equipment to be able to enjoy these newer proprietary formats, it has been quite common when considering Blu-ray media, to continue using only the tried and well tested CD and DVD media!}}

=== Install Required Packages ===
Although MPlayer can also be used, FFmpeg seems more refined when dumping or clipping specific audio chapters from DVD or Blu-Ray media.

{{RootCmd|emerge media-video/ffmpeg}}

(If somebody successfully uses MPlayer to dump PCM specified chapters, feel free to add it to this Wiki page and retitle appropriately.  I've only experienced MPlayer seeking to the beginnning chapter and, not recognizing or stopping at the specified end chapter. ie. "mplayer -ao pcm:fast:file=audio.wav -chapter 2-2 -vo null -vc null input_file")

=== Mount Blu-Ray Disc ===
Blu-Rays use UDF, and require to be mounted as such.  Probably best to edit the following file to provide mount points as such.  (I use AutoFS, so incorporate as needed.)
{{File|/etc/fstab||<nowiki>
/dev/sr0       /mnt/dvd        iso9660         noauto,user,ro  0 0
/dev/sr0       /mnt/dvd-udf    udf             noauto,user,rw  0 0</nowiki>}}

Or the following will automatically decide with little to no additional access time difference,
{{File|/etc/fstab||<nowiki>
/dev/sr0       /mnt/dvd        auto            noauto,user,ro  0 0</nowiki>}}

Create the mount folders if you don't have them already,
{{RootCmd|mkdir /mnt/dvd /mnt/dvd-udf}}

Mount the disc,
{{Cmd|sudo mount /mnt/dvd-udf}}

=== Find Available Stream Types ===
You've likely found your main large meda stream file on your Blu-Ray, something similar to "./BDMV/STREAM/0000.m2ts".

Using ffplay, you'll likely see something like this within stdout,

<nowiki>Stream #0:0[0x1011]: Video: h264 (High) (HDMV / 0x564D4448), yuv420p, 1920x1080 [SAR 1:1 DAR 16:9], 29.97 fps, 29.97 tbr, 90k tbn, 59.94 tbc</nowiki><br>
<nowiki>Stream #0:1[0x1100]: Audio: pcm_bluray (HDMV / 0x564D4448), 48000 Hz, stereo, s32, 2304 kb/s</nowiki><br>
<nowiki>Stream #0:2[0x1101]: Audio: pcm_bluray (HDMV / 0x564D4448), 48000 Hz, 5.1(side), s32, 6912 kb/s</nowiki><br>
<nowiki>Stream #0:3[0x1102]: Audio: dts (DTS-HD MA) ([134][0][0][0] / 0x0086), 48000 Hz, 5.1(side), s16, 1536 kb/s</nowiki><br>

<nowiki>Stream #0 on this audio only Blu-Ray is only a black screen with song titles.  We'll skip this stream since we want audio only PCM WAV</nowiki><br>
<nowiki>Stream #1 is the PCM two channel stereo mix.</nowiki><br>
<nowiki>Stream #2 is the PCM 5.1 high resolution mix.</nowiki><br>
<nowiki>Stream #2 is the DTS mix.</nowiki><br>

Keep an eye on the Hz, s16/s24/s32 and kb/s, as they're indicators of audio quality.

=== Extract Audio Streams ===
==== Extract Full Audio Streams ====
To extract the three individual stream types into one large file, you can use FFmpeg.  (Although this is likely undesirable due to file size limitations on VFAT filesystems.)

{{Cmd|ffmpeg -i ./BDMV/STREAM/00000.m2ts -map 0:1 -acodec pcm_s24le music.wav}}
{{Cmd|ffmpeg -i ./BDMV/STREAM/00000.m2ts -map 0:2 -acodec pcm_s24le music-pcm51.wav}}
{{Cmd|ffmpeg -i ./BDMV/STREAM/00000.m2ts -map 0:3 -acodec copy music.dts}}

Verify you have successfully extracted the streams using ffplay or mplayer.  Monitor the stdout messages to ensure proper drivers and codecs are used for the stream types specified.

(For DTS playback using MPlayer, you'll likely need to specify ac=hwdts for MPlayer for passing through DTS to your HDMI/SPDIF audio receiver.  MPlayer uses the following for specifying streams, "mplayer -aid 1 -demuxer lavf ./BDMV/STREAM/00000.m2ts".)

==== Extract Individual Chapters ====
===== Find Chapters =====
FFprobe will display the chapters to stdout, if they are preserved within the media file.

{{Cmd|ffprobe ./music.mkv}}

{{Note|If you use MakeMKV, make sure you extract to a format preserving Chapters with using "makemkvcon mkv".  Using "makemkvcon backup" does not preserve chapter information as of this writing!}}

(MPlayer can also identify chapters using "mplayer -indentify", however the chapter times do not appear comptabile with FFmpeg.)

===== Extract a Chapter =====
At this point, we'll assume we want Stream #1 for standard two stereo PCM WAV files (ie. map 0:1) and the second (#0.2) chapter.

FFprobe's snipped output:
<br><nowiki>Chapter #0.2: start 534.934400, end 888.087200</nowiki><br>

The incanatation of FFmpeg we'll use for exacting this individual chapter, using seconds for start and duration indicators.
{{Cmd|ffmpeg -ss [start] -i in.dts -t [duration] -c:v copy -c:a copy out.wav}}

With this example, the start time will be 534.934400 and duration will be 888.087200 minus 534.934400.

For example,
{{Cmd|ffmpeg -ss 534.934400 -i ./BDMV/STREAM/00000.m2ts -t 353.152800 -c:v copy -c:a copy out.wav}}

===== Extract Multiple Chapters =====
I have only piped the message stdout of the CLI tools to a series of text files, utilizing grep and bc (CLI Calculator), along side VI/VIM for line duplication and clipping for creating one time scripts for extracting multiple files at once.

Someday, this will likely be automated and integrated into abcde.sh.

=== Cover Art ===
Cover art is usually found within the /mnt/dvd/BDMV/META/DL folder. For example,
{{Cmd|cp /mnt/dvd/BDMV/META/DL/discinfo_640x360.jpg ${HOME}/Music/My_Album/cover.jpg}}

=== Additional Tools===
Additional tools which might be useful, but not utilized within this Wiki.

<nowiki>media-sound/shntool A multi-purpose WAVE data processing and reporting utility, ie. splitting WAV files.</nowiki><br>
<nowiki>media-video/mplayer Media Player for Linux, as an option to FFmpeg</nowiki><br>
<nowiki>media-video/tsmuxer Utility to create and demux TS and M2TS files</nowiki><br>
