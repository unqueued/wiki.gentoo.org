<languages/>

== 관리 인터페이스 ==

이 문서는 이 장에서 언급한 프로그램에 의존하지 않습니다. 설치하고 사용할 수 있지만, 멀쩡한 시스템이라면 이들 없이도 돌아가야 합니다. 하지만 예외가 있다면, {{Package|www-apps/postfixadmin}} 꾸러미입니다. postfixadmin은 초기 테이블을 만들 때 사용하므로 예외로 두었습니다. 이유는 간단한데, postfixadmin은 데이터베이스를 관리할 때 사용할 수 있으며 테이블 배치에 전적으로 만족하지 않으면 잘못될 수 있습니다. 따라서 postfixadmin이 테이블을 만들도록 하고 그대로 쓰도록 하는게 낫습니다.

== Apache, PHP, PostgreSQL ==

Apache, PHP, PostgreSQL은 확장 꾸러미입니다. Apache를 설치 방법을 찾아보려면 [[Apache/ko|Apache]] 게시물을 보십시오. 이 설치에 관련있는 [[PHP]] 위키 페이지도 있습니다. PHP에서 모든 기능을 쓸 수 있어야 하며, 계속하기 전에 Apache가 동작해야합니다. 따라서 웹 메일과 통계 프리젠테이션을 사용하려면 이들 과정이 중요합니다.

설치 핵심 구성요소중 하나는 [[PostgreSQL]]입니다. 계속 진행하기 전에 PostgreSQL 기반을 설정하는 위키 게시글을 따라 쭉 읽어내려가십시오. 대신 [[MySQL]] 또는 [[LDAP]]도 있습니다.

PostgreSQL과 Apache(및 기타)은 여러가지 방식으로 연결할 수 있는데, 예를 들자면 네트워크를 통해서라거나 유닉스 소켓을 통한 방법이 있습니다. 유닉스 소켓은 매우 빠르고 더 안전하지만 다중(가상) 서버를 연결할 경우 TCP/IP 연결을 고려할지도 모릅니다.

유닉스 소켓을 사용한다면, 일반 파일 시스템 권한을 사용하므로 apache와 postfix를 <tt>postgres</tt> 그룹에 넣어주는게 중요하긴 합니다.

{{RootCmd|gpasswd -a apache postgres}}

== Postfixadmin ==

도입부에 이미 이야기했듯이, postfixadmin은 테이블을 만들 떄 사용합니다. 이 과정에서 postfixadmin은 메일 계정 등을 관리할 때 사용할 지를 확인하며, 테이블 형식을 이해할 것입니다.

끝내지 않았다면, {{Package|www-apps/postfixadmin}} 꾸러미를 이머지해야합니다:

{{Emerge|postfixadmin}}

postfixadmin은 웹 프로그램이므로, {{Path|localhost/postfixadmin}}에 postfixadmin을 설치할 때 <tt>webapp-config</tt>를 사용합니다. 외부 도메인을 선호하며 필요로 한다면, Apache를 적절하게 설정하여 https로만 접근할 수 있게 해야합니다.

{{RootCmd|webapp-config -I -h localhost -d postfixadmin postfixadmin 2.3.4}}

Postfixadmin은 데이터를 저장할 데이터베이스와 이 데이터베이스에 접근할 사용자가 필요합니다. postfixadmin이 데이터베이스에 접근하도록 <tt>postfixadmin</tt> 사용자를 만들고 이 데이터베이스를 읽을 다른 사용자를 만들겠습니다. 이 방식대로라면, 관리 권한과 일반 읽기 권한은 논리적으로 나뉩니다.

{{RootCmd|createuser -U postgres -D -P -R -S postfixadmin|output=<pre>
Enter password for new role: $password
Enter it again: $password
</pre>}}

A database for this user will also be needed. It will be owned by <tt>postfixadmin</tt>:

{{RootCmd|createdb -U postgres postfix -O postfixadmin}}

PHP will be accessing the database through apache and thus requires access to the database:

{{RootCmd|gpasswd -a apache postgres}}

Next the postfixadmin configuration file needs to be edited to point to this database amongst other things.

{{Note|Postfixadmin wants a hashed password in its config file, this will be generated by visiting http://localhost/postfixadmin/setup.php. However to actually get the password, the config file needs to be setup properly beforehand. As such, filling in the password in {{Path|config.inc.php}} can only be done after having edited it properly.}}

{{FileBox|filename=/var/www/localhost/htdocs/postfixadmin/config.inc.php|title=Diff of postfixadmin configuration|lang=diff|1=
-$CONF['configured'] = false;
+$CONF['configured'] = true;
 
-$CONF['postfix_admin_url'] = '';
+$CONF['postfix_admin_url'] = 'http://localhost/postfixadmin';
-$CONF['database_type'] = 'mysql';
+$CONF['database_type'] = 'pgsql';
 $CONF['database_host'] = 'localhost';
-$CONF['database_user'] = 'postfix';
-$CONF['database_password'] = 'postfixadmin';
+$CONF['database_user'] = 'postfixadmin';
+$CONF['database_password'] = '$password';
 $CONF['database_name'] = 'postfix';
 $CONF['database_prefix'] = '';
 
-$CONF['admin_email'] = 'postmaster@change-this-to-your.domain.tld';
+$CONF['admin_email'] = 'postmaster@example.com';
 
 
-    'abuse' => 'abuse@change-this-to-your.domain.tld',
-    'hostmaster' => 'hostmaster@change-this-to-your.domain.tld',
-    'postmaster' => 'postmaster@change-this-to-your.domain.tld',
-    'webmaster' => 'webmaster@change-this-to-your.domain.tld'
+    'abuse' => 'abuse@example.com',
+    'hostmaster' => 'hostmaster@example.com',
+    'postmaster' => 'postmaster@example.com',
+    'webmaster' => 'webmaster@example.com'
 
-$CONF['domain_path'] = 'NO';
+$CONF['domain_path'] = 'YES';
 
-$CONF['domain_in_mailbox'] = 'YES';
+$CONF['domain_in_mailbox'] = 'NO';
 
-$CONF['transport'] = 'NO';
+$CONF['transport'] = 'YES';
 
-$CONF['vacation_domain'] = 'autoreply.change-this-to-your.domain.tld';
+$CONF['vacation_domain'] = 'autoreply.example.com';
 
-$CONF['user_footer_link'] = "http://change-this-to-your.domain.tld/main";
+$CONF['user_footer_link'] = "http://example.com/";
 
-$CONF['footer_text'] = 'Return to change-this-to-your.domain.tld';
-$CONF['footer_link'] = 'http://change-this-to-your.domain.tld';
+$CONF['footer_text'] = 'Return to http://example.com/';
+$CONF['footer_link'] = 'http://example.com/';
 
-// $CONF['mailbox_postcreation_script']='sudo -u courier /usr/local/bin/postfixadmin-mailbox-postcreation.sh';
+$CONF['mailbox_postcreation_script']='sudo -u vmail /usr/local/bin/postfixadmin-mailbox-postcreation.sh';
 
-// $CONF['mailbox_postdeletion_script']='sudo -u courier /usr/local/bin/postfixadmin-mailbox-postdeletion.sh';
+$CONF['mailbox_postdeletion_script']='sudo -u vmail /usr/local/bin/postfixadmin-mailbox-postdeletion.sh';
 
-// $CONF['domain_postdeletion_script']='sudo -u courier /usr/local/bin/postfixadmin-domain-postdeletion.sh';
+$CONF['domain_postdeletion_script']='sudo -u vmail /usr/local/bin/postfixadmin-domain-postdeletion.sh';
}}

{{Note|The last three entries are completely optional, but make adding and deleting of mailboxes and domains possible. When not using postfixadmin these can be omitted. Otherwise the noted scripts can be copied from {{Path|/usr/share/doc/postfixadmin-2.3.7/ADDITIONS}}. For the scripts to work [[sudo]] needs to be installed and configured. Remember to make any used scripts executable (chmod +x), and to change the <code>basedir</code> and <code>trashbase</code> variables at the top of the scripts to the [[Complete Virtual Mail Server/Linux vmail user|storage space]].
{{RootCmd|visudo|output=<pre>
apache ALL=(vmail) NOPASSWD: /usr/local/bin/postfixadmin-domain-postdeletion.sh
apache ALL=(vmail) NOPASSWD: /usr/local/bin/postfixadmin-mailbox-postcreation.sh
apache ALL=(vmail) NOPASSWD: /usr/local/bin/postfixadmin-mailbox-postdeletion.sh
</pre>}}
This will allow apache (via postfixadmin) to run the above mentioned scripts as the <tt>vmail</tt> user.
}}

Having postfixadmin generate the required tables, go to http://localhost/postfixadmin/setup.php and follow the instructions. Also any configuration errors or missing packages will be noted here. At this point a password hash will also be generated and can be edited into the config file. After that, super-admin users can be added to the database from this page. To log into the administrative page, go to http://localhost/postfixadmin/.

{{Warning|The mailsystem should end up being fully postfixadmin compatible. It should not matter if users/domains are added manually or via the postfixadmin GUI. Note however, that there are some user -> domain dependencies.}}

{{Note|If postfixadmin is not desired on the system, it can be removed after the tables have been created. Another option is to have postfixadmin create the tables on some other test system, and export/import the tables.}}

[[Category:Mail Servers]]
