{{InfoBox stack
|{{InfoBox package|media-sound/snapcast}}
|{{InfoBox github|Project/SoftwarePackage}}
}}

'''Snapcast''' ('''S'''y'''n'''chronous '''a'''udio '''p'''layer) plays audio streams time sychronized on multiple devices over network using a server and a client component. The server picks up an audio stream from a fifo pipe, thus it can be combined with any audio source that is able to write to a pipe. The Snapserver is able to handle multiple streams at once. The assignment of clients to streams and their volume is controlled via a JSON-API.

== Installation ==

=== USE flags ===

{{USEflag|package=media-sound/snapcast}}

=== Emerge ===

{{Emerge|media-sound/snapcast}}

== Basic Configuration ==

=== Server ===

The Snapserver can run as its own user:group e.g. snapserver:snapserver (created during emerge).

A sample config that makes snapserver pick up an audio stream from the named pipe /tmp/snapcast looks like this:

{{FileBox|filename=/etc/conf.d/snapserver|1=
USER_OPTS="--user snapserver:snapserver"
SNAPSERVER_OPTS="-s pipe:///tmp/snapcast"
}}

To start snapserver now run:

{{RootCmd|rc-service snapserver start}}

To start snapserver at boot time run:

{{RootCmd|rc-update add snapserver default}}

== Client ==

First get the number of the soundcard snapclient should use for audio output

{{Cmd|snapclient -l
0: null
Discard all samples (playback) or generate zero samples (capture)

1: pulse
PulseAudio Sound Server
...}}

To start snapclient on soundcard 1 (pulseaudio in this case) from command line run

{{Cmd|snapclient -s 1}}

Within a desktop environment (to make it use the users pulseaudio) we might run snapclient just like this.

To run snapclient as a system service (headless, Raspberry PI, etc.) a basic config looks like this:

{{FileBox|filename=/etc/conf.d/snapclient|1=
USER_OPTS="--user snapclient:snapclient"
SNAPCLIENT_OPTS="-s 1"
}}

To start snapclient now run:

{{RootCmd|rc-service snapclient start}}

To start snapclient at boot time run:

{{RootCmd|rc-update add snapclient default}}

== Audio source ==

To make some testing noise, random bytes can be shoved into the snapservers pipe

{{RootCmd|cat /dev/urandom > /tmp/snapcast}}

Snapcast can basically be used with anything that is able to write PCM audio to a fifo.

=== MPlayer example ===

To make mplayer play something over snapcast use

{{RootCmd|1=mplayer <input> -novideo -channels 2 -srate 48000 -af format=s16le -ao pcm:file=/tmp/snapcast}}

=== MPD Example ===

To hear music with MPD over snapcast create a new audio_output in the mpd.conf using the fifo module

{{CodeBox|1=audio_output {
    type            "fifo"
    name            "Snapcast"
    path            "/tmp/snapcast"
    format          "48000:16:2"
    mixer_type      "software"
}
}}

The samplerate setting is the default one used by snapcast. Different samplerates can be used but must be set in the snapserver config file first.

=== Environment variables ===

* <var>VAR1</var>
* <var>VAR2</var>

=== Files ===

* {{Path|/etc/global_file_example}} - Global (system wide) configuration file.
* {{Path|~/.local_file_example}} - Local (per user) configuration file.

=== Service ===

(Provide instructions on starting/stopping and enabling/disabling the software's service. This is only really necessary if it if the software includes a daemon for certain tasks.)

==== OpenRC ====

==== runit ====

==== systemd ====

== Usage ==

(Explain how to use the package/software/tool/utility in this section.)

=== Invocation ===

(Remove this section if not applicable.)

== Troubleshooting ==

No AVAHI: use -h $host
[Err] Exception: BrowseAvahi - Failed to create client: Daemon not running

=== Issue 1 ===

When X happens, Y is how you fix it.

== Removal ==

(Explain how to properly remove the software. If this section needs more than an 'emerge -C' command each step should be explained in detail so that no trace of the software remains on the system.)

=== Unmerge ===

{{Unmerge|category/package}}

== See also ==

* {{See also|Article_name}}

== External resources ==

* (Link to external resources (outside the Wiki) using bullet points in this section. It is common for the information in this section to full sentences that are links.)

== References ==

(Optional section. Remove this section if references are not used. This section is used to cite factual information. This information is found outside the Gentoo Wiki and used to back up truth claims. The actual references themselves still be littered throughout the main article.)

{{reflist}}

[[Category:Software]]
