{{Stub}}

{{InfoBox stack|{{InfoBox homepage|http://roy.marples.name/projects/dhcpcd/|header=true}}}}

== Abstract ==
With dhcpcd<ref>[http://roy.marples.name/projects/dhcpcd/index dhcpcd homepage]</ref><ref>[http://packages.gentoo.org/package/net-misc/dhcpcd net-misc/dhcpcd]</ref> it is possible<ref>[http://forums.gentoo.org/viewtopic-t-965190.html TIP: Complete network stack without net.* scripts]</ref> to have a working network stack without resorting to Gentoo net.* scripts at all on simple configuration.

*Only hardware interfaces are needed, i.e. no virtual interfaces;
*IP addresses delivered through DHCP (eventually APIPA)

In such conditions all hardware interfaces can be configured, even the loopback interface, lo. 

== Basic configuration ==
Install dhcpcd
{{RootCmd|emerge  --ask net-misc/dhcpcd}}
Remove all network scripts from all runlevels
{{RootCmd|rc-update del net.lo
|rc-update del net.eth0
|rc-update del net.wlan0}}
<br />
Add dhcpcd to the default runlevel: 
{{RootCmd|rc-update add dhcpcd default}}

== Wireless ==
When you need wireless support also install wpa_supplicant,<ref>[[wpa_supplicant]]</ref><ref>[http://hostap.epitest.fi/wpa_supplicant/ wpa_supplicant homepage]</ref> and set up and test the necessary drivers<ref>[[Wifi|Setup of a Wifi network device]]</ref> in your kernel.
{{RootCmd|emerge  --ask net-wireless/wpa_supplicant}}

In case it's already installed and sits in a runlevel remove it from there.
{{RootCmd|rc-update del wpa_supplicant}}

Check the configuration for the correct ctrl_interface.
{{File|/etc/wpa_supplicant/wpa_supplicant.conf||<pre>ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=wheel</pre>}}

The presently stable dhcpcd-6.4.3 will need wireless extensions compatibility in the kernel.<ref>[[Wifi#WEXT|WEXT Kernel option]]</ref><ref>[http://forums.gentoo.org/viewtopic-p-7611394.html#7611394 dhcpcd-6.4.3 needs kernel with wireless extensions]</ref> 
{{File|/usr/src/linux/.config||<pre>CONFIG_CFG80211_WEXT=y</pre>}}
In the development tree this is already fixed.<ref>[http://forums.gentoo.org/viewtopic-p-7617004.html#7617004 Roy Marples: In summary, dhcpcd fully works with WEXT disabled now]</ref>

There is no need for having wpa_supplicant in the runlevel as dhcpcd will detect the interface, whatever it is called and set its IP address automatically. Also note a nice thing Linux does when having wired and wireless interfaces together on the same network is that the one with the lowest metric takes precedence over existing connections. 
<br />
Suppose for instance you have an ongoing transfer of a very large file over your wireless interface to an existing network mountpoint. Plug the cable and wait for dhcpcd to set the IP address of the ethernet interface and you'll see the network activity switch to the fastest interface. You don't even need to interrupt and restart the transfer. That feature comes handy when you cannot bond interfaces, especially with wireless.

== Cleanup ==
When the net setup is working well you might want to remove the old netifrc setup.  So disable the netifrc useflag and reemerge openrc.
{{File|/etc/portage/package.use||<pre>sys-apps/openrc -netifrc</pre>}}
{{RootCmd|emerge --ask --newuse --oneshot sys-apps/openrc}}
Now you can remove netifrc.
{{RootCmd|emerge -C net-misc/netifrc}}
<br />
Also the old config files and symlinks can be removed
{{RootCmd|rm /etc/conf.d/net
|rm /etc/init.d/net.eth0
|rm /etc/init.d/net.wlan0
|rm /etc/init.d/net.lo}}

== Network dependant services ==
Starting/stopping network dependant services is still in development.<ref>[https://bugs.gentoo.org/show_bug.cgi?id=522206#c5 Bug 522206 net-misc/dhcpcd-6.4.3 fails to start/stop network dependant services like ntpd, sshd, fetchmail]</ref><ref>[http://forums.gentoo.org/viewtopic-p-7614066.html#7614066 TIP: Complete network stack without net.* scripts]</ref> Services having "need net" in their init.d scripts like fetchmail will start after dhcpcd is started.
{{File|/etc/init.d/fetchmail||<pre>#!/sbin/runscript

piddir=${pid_dir:-/var/run/fetchmail}
pid_file=${piddir}/${RC_SVCNAME}.pid
rcfile=/etc/${RC_SVCNAME}rc

depend() {
        need net
        use mta
}</pre>}}

{{File|/var/log/messages||<pre>
Sep 10 08:38:41 localhost /etc/init.d/fetchmail[10675]: WARNING: fetchmail is scheduled to start when dhcpcd has started
</pre>}}

They will be stopped when dhcpcd turns inactive and will be restarted when dhcpcd is back.
{{File|rc-config show default||<pre>
  dhcpcd                    [inactive]
  fetchmail                 [stopped]
</pre>}}

In case there is only "use net" in the init.d script the "need" can be put in the conf.d file.
{{File|/etc/conf.d/rpcbind||<pre># /etc/conf.d/rpcbind
 
# Options for `rpcbind`.
#RPCBIND_OPTS="-l"

rc_need="net"</pre>}}

== References ==
{{reflist}}

[[Category:Network_management]]
