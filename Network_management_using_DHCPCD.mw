{{Stub}}

{{InfoBox stack|{{InfoBox homepage|http://roy.marples.name/projects/dhcpcd/|header=true}}}}

== Abstract ==
Gentoo is about choice and also {{Package|sys-apps/openrc}} can be used with one of several network managers or even with none.<ref>[http://sources.gentoo.org/cgi-bin/viewvc.cgi/gentoo-x86/sys-apps/openrc/openrc-0.12.4.ebuild sys-apps/openrc-0.12.4]</ref>  This is about using OpenRC with DHCPCD<ref>[http://roy.marples.name/projects/dhcpcd/index DHCPCD homepage]</ref><ref>[http://packages.gentoo.org/package/net-misc/dhcpcd net-misc/dhcpcd]</ref> as networkmanager. It is based on a posting in Gentoo Forums.<ref>[http://forums.gentoo.org/viewtopic-t-965190.html TIP: Complete network stack without net.* scripts]</ref><br />
With DHCPCD it is possible to have a working network stack without resorting to Gentoo net.* scripts at all on simple configuration.

*Only hardware interfaces are needed, i.e. no virtual interfaces;
*IP addresses delivered through DHCP (eventually APIPA)

In such conditions all hardware interfaces can be configured, even the loopback interface, lo. 

== Basic configuration ==
Install dhcpcd
{{RootCmd|emerge  --ask net-misc/dhcpcd}}
Remove all network scripts from all runlevels
{{RootCmd|rc-update del net.lo
|rc-update del net.eth0
|rc-update del net.wlan0}}
<br />
Add dhcpcd to the default runlevel: 
{{RootCmd|rc-update add dhcpcd default}}

== Wireless ==
When you need wireless support also install wpa_supplicant,<ref>[[wpa_supplicant]]</ref><ref>[http://hostap.epitest.fi/wpa_supplicant/ wpa_supplicant homepage]</ref> Also note that older versions (< 6.4.4) of dhcpcd need wireless extensions compatibility in the kernel.<ref>[http://forums.gentoo.org/viewtopic-p-7611394.html#7611394 dhcpcd-6.4.3 needs kernel with wireless extensions]</ref>
<ref>[[Wifi#WEXT|WEXT Kernel option]]</ref>
<ref>[http://forums.gentoo.org/viewtopic-p-7617004.html#7617004 Roy Marples: In summary, dhcpcd fully works with WEXT disabled now]</ref>
{{RootCmd|emerge  --ask net-wireless/wpa_supplicant}}

In case it's already installed and sits in a runlevel remove it from there.
{{RootCmd|rc-update del wpa_supplicant}}
<br />
Don't forget to set up and test the necessary wireless device drivers<ref>[[Wifi|Setup of a Wifi network device]]</ref> in your kernel. Check the configuration for the correct ctrl_interface. 
{{File|/etc/wpa_supplicant/wpa_supplicant.conf||<pre>ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=wheel</pre>}}

There is no need for having wpa_supplicant in the runlevel as dhcpcd will detect the interface, whatever it is called and set its IP address automatically. Also note a nice thing Linux does when having wired and wireless interfaces together on the same network is that the one with the lowest metric takes precedence over existing connections. 

Suppose for instance you have an ongoing transfer of a very large file over your wireless interface to an existing network mountpoint. Plug the cable and wait for dhcpcd to set the IP address of the ethernet interface and you'll see the network activity switch to the fastest interface. You don't even need to interrupt and restart the transfer. That feature comes handy when you cannot bond interfaces, especially with wireless.

== Static IP address ==
In case the network interface card should be configured with a static IP address, put their data in the configuration file.<ref>[http://forums.gentoo.org/viewtopic-p-7356550.html#7356550 TIP: Complete network stack without net.* scripts]</ref>
{{File|/etc/dhcpcd.conf||<pre># Configure loopback adapter here 
interface eth0
static ip_address=192.168.0.10/24
static routers=192.168.0.1
static domain_name_servers=192.168.0.1</pre>}}

== Cleanup ==
When the network setup is working well you might want to remove the old<ref>[[Complete_Handbook/Configuring_the_system#Networking_information]]</ref><ref>[http://www.gentoo.org/doc/en/handbook/handbook-amd64.xml?full=1#book_part1_chap9__chap6 Gentoo Linux AMD64 Handbook]</ref> netifrc setup.  So disable the netifrc useflag and reemerge OpenRC.
{{File|/etc/portage/package.use||<pre>sys-apps/openrc -netifrc</pre>}}
{{RootCmd|emerge --ask --newuse --oneshot sys-apps/openrc}}
Now you can remove netifrc.
{{RootCmd|emerge -C net-misc/netifrc}}

Also the old config files and symlinks can be removed
{{RootCmd|rm /etc/conf.d/net
|rm /etc/init.d/net.eth0
|rm /etc/init.d/net.wlan0
|rm /etc/init.d/net.lo}}

== Network dependant services ==
Starting/stopping network dependant services is still in development.<ref>{{Bug|522206}}</ref>  Services having "need net"
{{File|/etc/init.d/fetchmail||<pre>#!/sbin/runscript

piddir=${pid_dir:-/var/run/fetchmail}
pid_file=${piddir}/${RC_SVCNAME}.pid
rcfile=/etc/${RC_SVCNAME}rc

depend() {
        need net
        use mta
}</pre>}}

in their init.d scripts like fetchmail would then start after dhcpcd is started. 
{{File|/var/log/messages||<pre>
Sep 10 08:38:41 localhost /etc/init.d/fetchmail[10675]: WARNING: fetchmail is scheduled to start when dhcpcd has started
</pre>}}

They will be stopped when dhcpcd turns inactive and will be restarted when dhcpcd is back.
{{Cmd|rc-config show default|output=<pre>
  dhcpcd                    [inactive]
  fetchmail                 [stopped]
</pre>}}

== References ==
{{reflist}}

[[Category:Network_management]]
