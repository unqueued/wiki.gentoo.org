{{InfoBox stack
|{{InfoBox wikipedia|DualShock|header=true}}
}}

This article describes the use of Sony DualShock 3 / [[Wikipedia:Sixaxis|Sixaxis]] and DualShock 4 [[Wikipedia:PlayStation|PlayStation]] controllers via USB and Bluetooth.

== Prerequisites ==

This article presumes the system has been configured to use [[USB]] and [[Bluetooth]]. If these communication buses have not been configured, please take time to do so now.

== Hardware ==

The following devices can be queried when connected via USB with the {{c|lsusb}} command (available via the {{Package|sys-apps/usbutils}} package).

{| class="table table-condensed table-striped" style="width: auto;"
! scope="col" width="15%" | Device
! scope="col" width="10%" | Vendor ID / Product ID
! scope="col" width="10%" | Vendor Name
! scope="col" width="15%" | Product Name
! scope="col" width="10%" | Supported
! scope="col" width="10%" | Kernel Version
! scope="col" width="30%" | Notes
|-
| DualShock 3 / Sixaxis
| <code>054c:0268</code>
| Sony Corp.
| Batoh Device / PlayStation 3 Controller
| {{Yes}}
| >{{=}}3.15<ref name="ds4-support"/>
|
|-
| DualShock 4
| <code>054c:05c4</code>
| Sony Corp.
| DualShock 4 [CUH-ZCT1E]
| {{Yes}}
| >{{=}}3.15<ref name="ds4-support"/>
| New revisions have a modified HID descriptor that require Linux 4.5+<ref name="ds4-revision"/>.
|-
| DualShock 4 (2nd Gen)
| <code>054c:09cc</code>
| Sony Corp.
| DualShock 4 [CUH-ZCT2E]
| {{Yes}}
| >{{=}}4.10<ref name="ds4v2-support"/>
|
|-
|}

== Installation ==

=== Kernel ===

The recommended minimum version of Linux to use is 3.15. This release adds full support for the DualShock 4. This release also fixes the DualShock 3 blinking LED issue when connected via Bluetooth<ref name="ds4-support">Jiri Kosina. [https://lkml.org/lkml/2014/4/2/264 <nowiki>[</nowiki>GIT<nowiki>]</nowiki> HID], [https://lkml.org/ LKML], April 2nd, 2014. Retrieved on October 24th, 2014.</ref>. New revisions of the DualShock 4 have a modified HID descriptor and require Linux 4.5<ref name="ds4-revision">Frank Praznik. [https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git/commit/?h=v4.5&id=b71b5578a84d297954e4812ba0ca2d466e61cf42 HID: sony: Remove the size check for the Dualshock 4 HID Descriptor], [https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git/ Linux kernel stable tree], November 19th, 2015. Retrieved on July 8th, 2016.</ref>. The 2nd generation DualShock 4 included with the PlayStation 4 Slim and Pro requires Linux 4.10<ref name="ds4v2-support">Roderick Colenbrander. [https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git/commit/?h=v4.10&id=cf1015d65d7c8a5504a4c03afb60fb86bff0f032 HID: sony: Update device ids], [https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git/ Linux kernel stable tree], October 10th, 2016. Retrieved on March 21st, 2017.</ref>.

Enable the following configuration options: <var>CONFIG_INPUT_JOYDEV</var>, <var>CONFIG_INPUT_EVDEV</var>, <var>CONFIG_HID_BATTERY_STRENGTH</var>, <var>CONFIG_HIDRAW</var>, <var>CONFIG_HID_SONY</var>, <var>CONFIG_SONY_FF</var>, <var>CONFIG_HID_GENERIC</var>, <var>CONFIG_USB_HID</var>, <var>NEW_LEDS</var>, <var>LEDS_CLASS</var>:

{{KernelBox|title=Enabling Sony DualShock support|1=<nowiki />
    Device Drivers --->
          Input device support --->
            <*>   Joystick interface
            <*>   Event interface
          HID support --->
            [*]   Battery level reporting for HID devices
            [*]   /dev/hidraw raw HID device support
            <*>   Generic HID driver
                  Special HID drivers --->
                    <*> Sony PS2/3/4 accessories
                    [*]   Sony PS2/3/4 accessories force feedback support
                USB HID support --->
                  <*> USB HID transport layer
      [*] LED Support --->
            <*>   LED Class Support
}}

=== Xorg ===

To have the DualShock 4 touchpad behave as a mouse using the kernel driver, the [[Xorg]] input driver should be set to <code>libinput</code>, and {{Package|sys-fs/eudev}}-9999 should be used for libinput to recognize the touchpad correctly; The gyro can be set as a joystick, but that will confuse some games:

{{FileBox|filename=/etc/X11/xorg.conf.d/30ds4.conf|1=
Section "InputClass"
        Identifier "ds4-touchpad"
        Driver "libinput"
        MatchProduct "Sony Interactive Entertainment Wireless Controller Touchpad"
        Option "Mode" "Relative"
EndSection
Section "InputClass"
        Identifier "ds4-gyro"
        Driver "joystick"
        MatchProduct "Sony Interactive Entertainment Wireless Controller Motion Sensors"
        Option "Ignore" "True" #comment out this line to use the gyro as a joystick
EndSection
}}

== Usage ==

=== USB ===

* Connect the DualShock to the system using a USB cable and press the {{Key|PlayStation}} button on the controller.

* Turn the DualShock off when it's no longer in use by pressing and holding the {{Key|PlayStation}} button for 10 seconds.

* Press the {{Key|PlayStation}} button to use the DualShock again.

=== Bluetooth ===

{{Note|It is recommended to use a Bluetooth controller that supports at least [[Wikipedia:Bluetooth#Bluetooth_v2.1_.2B_EDR|Bluetooth 2.1+EDR]].}}

The recommended minimum version of BlueZ to use is 5.14. This release adds full support for the DualShock 4<ref name="bluez-5.14">Johan Hedberg. [http://www.bluez.org/bluez-5-14/ Release of BlueZ 5.14], [http://www.bluez.org/ BlueZ], January 21st, 2014. Retrieved on October 24th, 2014.</ref>. This release also incorporates DualShock 3 setup and pairing support which was added in BlueZ 5.12<ref name="bluez-5.12>Johan Hedberg. [http://www.bluez.org/release-of-bluez-5-12/ Release of BlueZ 5.12], [http://www.bluez.org/ BlueZ], December 10th, 2013. Retrieved on October 24th, 2014.</ref>.

==== DualShock 3 ====

Start {{c|bluetoothctl}}:

{{Cmd|bluetoothctl}}

Enable the agent and set it as default:

{{Cmd
|agent on
|default-agent
|prompt=[bluetooth]#|color=lightblue
}}

Power on the Bluetooth controller, and set it as discoverable and pairable:

{{Cmd
|power on
|discoverable on
|pairable on
|prompt=[bluetooth]#|color=lightblue
}}

Connect the DualShock 3 to the system using a USB cable and press the {{Key|PlayStation}} button.

Discover the DualShock 3 MAC address:

{{Cmd|devices|prompt=[bluetooth]#|color=lightblue}}

Disconnect the USB cable from the DualShock 3:

Allow the service authorization request:

{{Cmd|Authorize service ''service_uuid'' (yes/no): yes|prompt=[agent]|color=red}}

Trust the DualShock 3:

{{Cmd|trust ''device_mac_address''|prompt=[bluetooth]#|color=lightblue}}

The DualShock 3 is now paired:

{{Cmd|quit|prompt=[bluetooth]#|color=lightblue}}

Turn the DualShock 3 off when it's no longer in use by pressing and holding the {{Key|PlayStation}} button for 10 seconds.

Press the {{Key|PlayStation}} button to use the DualShock 3 again.

==== DualShock 4 ====

Start {{c|bluetoothctl}}:

{{Cmd|bluetoothctl}}

Enable the agent and set it as default:

{{Cmd
|agent on
|default-agent
|prompt=[bluetooth]#|color=lightblue
}}

Power on the Bluetooth controller, and set it as discoverable and pairable:

{{Cmd
|power on
|discoverable on
|pairable on
|prompt=[bluetooth]#|color=lightblue
}}

Scan for devices:

{{Cmd|scan on|prompt=[bluetooth]#|color=lightblue}}

Put the DualShock 4 into pairing mode by pressing and holding the {{Key|PlayStation}} and {{Key|Share}} buttons until the light bar starts flashing.

Discover the DualShock 4 MAC address:

{{Cmd|devices|prompt=[bluetooth]#|color=lightblue}}

Pair with the DualShock 4:

{{Cmd|pair ''device_mac_address''|prompt=[bluetooth]#|color=lightblue}}

Allow the service authorization request:

{{Cmd|Authorize service ''service_uuid'' (yes/no): yes|prompt=[agent]|color=red}}

Trust the DualShock 4:

{{Cmd|trust ''device_mac_address''|prompt=[bluetooth]#|color=lightblue}}

The DualShock 4 is now paired:

{{Cmd|quit|prompt=[bluetooth]#|color=lightblue}}

Turn the DualShock 4 off when it's no longer in use by pressing and holding the {{Key|PlayStation}} button for 10 seconds, or by disconnecting it from {{c|bluetoothctl}} or any GUI Bluetooth device manager.

Press the {{Key|PlayStation}} button to use the DualShock 4 again.

=== Battery charge level ===

The DualShock battery charge level can checked with [[sysfs]]:

{{Cmd
|cat "/sys/class/power_supply/sony_controller_battery_04:76:6e:9a:98:fc/capacity"
|output=<pre>
25
</pre>}}

The battery charge level for the DualShock 3 will reported as either 100%, 75%, 50% or 25% remaining. These values correspond to 3, 2, 1, and 0 bars respectively when checked with the PlayStation 3. The battery charge level for the DualShock 4 will be reported in the range of 100% to 0% remaining, at intervals of 10%.

The battery charge level can also be checked with {{Package|sys-power/upower}}. First, list available devices:

{{Cmd
|upower -e
|output=<pre>
/org/freedesktop/UPower/devices/battery_sony_controller_battery_04o76o6eo9ao98ofc
/org/freedesktop/UPower/devices/DisplayDevice
</pre>}}

Next, display the DualShock power information:

{{Cmd
|upower -i /org/freedesktop/UPower/devices/battery_sony_controller_battery_04o76o6eo9ao98ofc
|output=<pre>
  native-path:          sony_controller_battery_04:76:6e:9a:98:fc
  power supply:         no
  updated:              Tue 01 Dec 2015 00:00:00 UTC (1 seconds ago)
  has history:          yes
  has statistics:       yes
  battery
    present:             yes
    rechargeable:        yes
    state:               discharging
    warning-level:       none
    energy:              0 Wh
    energy-empty:        0 Wh
    energy-full:         0 Wh
    energy-full-design:  0 Wh
    energy-rate:         0 W
    percentage:          25%
    capacity:            100%
    icon-name:          'battery-full-symbolic'
  History (charge):
    1449283773	25.000	discharging
    1449283773	0.000	unknown
  History (rate):
    1449283773	0.000	unknown
</pre>}}

== Troubleshooting ==

* Imitation DualShock 3 controllers are not supported by BlueZ and will ''not'' work via Bluetooth<ref name="ds3-imitation">DjMadness. [https://forums.gentoo.org/viewtopic-p-7712574.html#7712574 Sixaxis via bluetooth], [https://forums.gentoo.org/ Gentoo Forums], March 4th, 2015. Retrieved on March 12th, 2015.</ref>. However, Linux 4.15<ref name="ds3-imitation-4.15">Bastien Nocera. [https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?h=v4.15-rc1&id=492ca83c3d19fba1622164f07cd7b775596a7db2 HID: sony: Fix SHANWAN pad rumbling on USB], [https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git/ Linux kernel stable tree], November 9th, 2017. Retrieved on December 20th, 2017.</ref> and BlueZ 5.48<ref name="bluez-5.48">Bastien Nocera. [https://git.kernel.org/pub/scm/bluetooth/bluez.git/commit/?h=5.48&id=1629c39ededef07988a5403b27331e0e317f1e08 plugins/sixaxis: Provide DualShock 3 SDP record while adding new device], [https://git.kernel.org/pub/scm/bluetooth/bluez.git/ Bluetooth protocol stack for Linux], November 9th, 2017. Retrieved on December 20th, 2017.</ref> will have full support for imitation DualShock 3 controllers via USB and Bluetooth.

== External resources ==

* [https://forums.gentoo.org/viewtopic-t-1001344.html Sixaxis via bluetooth]

== References ==

{{reflist}}

[[Category:Input_devices]]
