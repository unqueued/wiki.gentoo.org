<languages />

Эта статья описывает шаги необходимые для обновления [[kernel/ru|ядра]].

== Установка ==

Обновление ядра может потребоваться когда после обновления системы установлены новые исходные тексты ядра, или в случае если Вы сами их установили.

== Конфигурация ==

Конфигурация повторяет шаги описанные в [[Kernel/Configuration/ru|конфигурации ядра вручную]], так как используется заново только конфигурационный файл. Все шаги упоминаются здесь заново для полноты, для более подробного описания смотри другую статью.

=== Установка символьной ссылки ===

Символьная ссылка {{Path|/usr/src/linux}} всегда должна указывать на исходные коды используемого в настоящий момент ядра. Это может быть сделано одним из трех способов:

;1. Установка исходных кодов ядра с активным [[USE flag|USE-флагом]] "symlink"
:Это заставит {{Path|/usr/src/linux}} указывать на исходный код заново устанавливаемого ядра. Если необходимо, символьная ссылка может быть изменена позже двумя следующими методами:

;2. Настройка символьной ссылки с помощью '''eselect''':

: {{RootCmd| eselect kernel list |
  |output=Available kernel symlink targets:<br /> &nbsp; [1] linux-3.3.8-gentoo *<br /> &nbsp; [2]   linux-3.4.9-gentoo}}

:Эта команда выводит доступные исходные коды ядра. Звездочкой отмечены выбранные исходные коды. Для того чтобы изменить исходные коды ядра, например выбрать второй пункт, сделайте следующее:

: {{RootCmd|eselect kernel set 2}}

;3. Установка символьной ссылки вручную:

: {{RootCmd|ln -sf /usr/src/linux-3.4.9 /usr/src/linux |
  |ls -l /usr/src/linux |
  |output=lrwxrwxrwx 1 root root 11 Aug 29 22:10 /usr/src/linux -> /usr/src/linux-3.4.9-gentoo}}

=== Очистка исходных кодов ===
Если Вы просто хотите перекомпилировать используемое ядро, Вам иногда нужно очищать исходный код:
{{RootCmd|make distclean}}

=== Копирование предыдущей конфигурации ядра ===
Конфигурацию работающего в данный момент ядра необходимо скопировать в новую. Ее можно найти в нескольких местах:

* В файловой системе [[procfs]], если параметр ядра ''Kernel .config support'' был включен в ядре работающем в данный момент.

: {{RootCmd|zcat /proc/config.gz > /usr/src/linux/.config}}

* В каталоге {{Path|/boot}}, если Вы установили файл конфигурации туда:

: {{RootCmd|cp /boot/config-3.3.8-gentoo /usr/src/linux/.config}}

* В каталоге ядра, которое работает в данный момент:

: {{RootCmd|cp /usr/src/linux-3.3.8-gentoo/.config /usr/src/linux/}}

=== make oldconfig ===
Now update the previous config file for your new kernel:

{{RootCmd|cd /usr/src/linux
|make oldconfig}}

The following configuration parallels that of the text based configuration with '''make config'''. For every difference between the kernel versions, it asks if you want to activate the driver or feature. An example:

{{RootCmd|make oldconfig
|output=Anticipatory I/O scheduler (IOSCHED_AS) [Y/n/m/?] (NEW)
}}

The string ''(NEW)'' at the end of the line marks this option as new. Left to the string in square brackets are the possible answers: ''Y''es, ''n''o, ''m''odule or ''?'' to show the help. The recommend answer is capitalized (here ''Y''). The help explains the option or driver.

Unfortunately '''make oldconfig''' doesn't show - next to the help - a lot more information for each option, like the context, so that it is sometimes difficult to give the right answer. In this case the best way to go is to remember the option name and revise it afterwards through one of the [[Kernel/Configuration#Configuration tools|graphical kernel configuration tools]].

== Reinstall external kernel modules ==

Any external kernel modules, such as [[:Category:Binary kernel modules|binary kernel modules]], need to be rebuilt for each new kernel. If the kernel hasn't been built yet, it has to first be prepared for the building of the external kernel modules:

{{RootCmd|make modules_prepare}}

You can rebuild the packages using the ''@module-rebuild'' set:

{{Emerge|@module-rebuild}}

== Build ==

For this step, follow the steps in the [[Kernel/Configuration#Build|manual configuration]] article.

== Removing old kernels ==

See the [[Kernel/Removal|kernel removal]] article. 

== External resources ==

* [http://kernelnewbies.org/LinuxChanges kernel changelog with some explanations of new features]

[[Category:Kernel]]
