<languages />


{{Metadata|abstract=Esta guia tiene como objetivo explicar el funcionamiento de Java con Gentoo Linux.}}

Esta guia tiene como objetivo explicar el funcionamiento de Java con Gentoo Linux.

== ¿Que es Java? ==

=== Visión general ===

Java es un lenguaje de programación desarrollado por ingenieros de Sun Microsystems. El lenguaje es totalmente orientado a objetos y diseñado para ser ejecutado en multiples plataformas sin la necesidad de recompilar el codigo para cada una de ellas. Aunque Java puede ser compilado como un lenguaje nativo, mucha de la popularidad de Java se atribuye a su portabilidad, junto con otras caracteristicas como recolección de basura. Para hacer posible esta independencia de plataforma, el compilador de Java compila el codigo Java hacia una representación intermedia denominada "Java bytecode" que es ejecutado en un JRE (Java Runtime Environment) y no directamente sobre el sistema operativo. 

Para ejecutar Java bytecode, es necesario tener un entorno JRE (Java Runtime Environment) instalado. Un JRE proporciona bibliotecas centrales, una maquina virtual de Java dependiente de plataforma, y extensiones para navegadores web entre otras cosas. Por otro lado un JDK (Java Development Kit) agrega herramientas de programación, tales como compilador de bytecode y un depurador de codigo. 

== Instalando una Máquina Virtual ==

=== Opciones ===

Gentoo proporciona una variedad de entornos de ejecución (JREs) y kits de desarrollo (JDKs). Entre las opciones actuales, existen: 

{| class="wikitable" style="text-align: left;" 
|- 
! Vendor
! JDK
! JRE
|- 
| Open Java SE de IcedTea (anteriormente icedtea6-bin)
| dev-java/icedtea-bin
| 
|- 
| Java 7 SE de Oracle
| dev-java/oracle-jdk-bin
| dev-java/oracle-jre-bin
|- 
| Java 6 SE de Sun
| dev-java/sun-jdk
| dev-java/sun-jre-bin
|- 
| Java SE de IBM
| dev-java/ibm-jdk-bin
| dev-java/ibm-jre-bin
|-
|}

=== Instalando un JRE/JDK ===

Para instalar el JDK por defecto en el perfil instalado, basta con ejecutar <code>emerge virtual/jdk</code>. O para instalar el JRE por defecto se puede ejecutar <code>emerge virtual/jre</code>. 

Algunos JDKs y JREs, incluyendo los paquetes de Sun, requieren que el usuario acepte un Acuerdo de Licencia de Usuario o Eula. En el caso que esta licencia (por ejemplo dlj-1.1) no este incluida en ACCEPT_LICENSE dentro de {{Path|/etc/portage/make.conf}} no sera posible instalar el JDK/JRE. Para mayor información de como agregar licencias aceptadas en {{Path|make.conf}} pude consultarse el [http://www.gentoo.org//doc/es/handbook/handbook-x86.xml?part=2&chap=1#doc_chap4 Manual de Portage]. 

Para evitar cualquier restriccion de licencias, considerese instalar <code>icedtea-bin</code>, el cual es una implementación abierta de Java del proyecto OpenJDK. 

{{Note|JDK incluye tambien un JRE, por lo tanto si un JDK es instalado no es necesario instalar tambien un JRE.}}

=== Instalando maquinas virtuales con descarga restringida ===

Algunos JDKs y JREs requieren que el usuario siga algunos links antes de ser instalados. En este caso el emerge debe ser ejecutado de forma normal. Asi, los ebuils proveeran las instrucciones necesarias acerca de donde ir y realizar las descargas. 

Los archivos indicados deben ser colocados en {{Path|/usr/portage/distfiles}}. Luego, el comando emerge puede ser ejecutado nuevamente y es en este punto que la instalación de JRE/JDK iniciara. 

== Configurando la máquina virtual ==

=== Visión general ===

Gentoo posee la habilidad de instalar multiples JDKs y JREs sin causar conflictos. 

Utilizando la herramienta <code>java-config</code> es posible establecer una configuración para todo el sistema (requiere acceso como root). Los usuarios normales tambien pueden utilizar <code>java-config</code> para establecer su propia preferencia. 

{{Note|Es posible tambien utilizar ''eselect'' para cambiar la máquina virtual del sistema y del usuario. Mayor información con <code>eselect java-vm help</code>.}}

=== Estableciendo una maquina virtual por defecto ===

Al ejecutar el comando <code>java-config --list-available-vms</code> es posible obtener un listado de todas las JREs y JDKs instaladas en el sistema. La salida es similar a la siguiente: 

{{RootCmd|java-config --list-available-vms|output=<pre>
The following VMs are available for generation-2:
1)      IcedTea-bin 1.10.4 [icedtea-bin]
2)      Sun JDK 1.5.0.20 [sun-jdk-1.5] (Build Only)
*)      Sun JDK 1.6.0.16 [sun-jdk-1.6]
</pre>
}}


{{Note| Las maquinas virtuales marcadas como Build Only pueden contener vulnerabilidades y/o estar en el final de su ciclo de vida. Gentoo recomienda no utilizar ninguna de estas, tanto para usuario como para sistema. Puede verificarse [http://www.gentoo.org/java.xml#build-only Build Only VM] para más información.}}

El "*" indica cual es la maquina virtual activa (system-vm o user-vm cuando ha sido configurada). El nombre dentro de las llaves  (''[]'') es el identificador de la maquina virtual en particular. Puede ser utilizado el ID o el numero en <code>java-config --set-system-vm</code>. Por ejemplo, para establecer la maquina virtual del sistema. 

Estableciendo la maquina virtual manualmente (modo preferido):

{{RootCmd|java-config --set-system-vm sun-jdk-1.6|output=<pre> Now using sun-jdk-1.6 as your generation-2 system JVM </pre>}}

La misma puede ser seleccionada también por numero:

{{RootCmd|java-config --set-system-vm 3|output=<pre> Now using sun-jdk-1.6 as your generation-2 system JVM </pre> }}

Así también, como usuario regular puede utilizarse <code>java-config --set-user-vm</code>. 

{{Note|Actualmente ya no es necesario ejecutar <code>source</code> sobre el perfil para que la actualización de maquina virtual sea realizada.}}

=== Maquina virtual marcada como Build Only ===

Algunas maquinas virtuales estar marcadas como build-only ya sea por estar en el fin de su ciclo de vida de soporte y/o por contener vulnerabilidades de seguridad. Estas máquinas virtuales no serán utilizadas automáticamente por Gentoo para aquellas aplicaciones en ejecución utilizando los lanzadores de Gentoo, sin embargo seguirán disponibles para los entornos de compilación de Gentoo ya que algunos paquetes pueden necesitarlas para ser compiladas. Configurar estas maquinas virtuales tanto para usuario como para el sistema es no recomendada ya que en este caso serán utilizadas al ejecutar los ejecutables {{Path|/usr/bin/{java,javac,..}}} y serán utilizadas por cualquier otro paquete que no utilice los lanzadores de Gentoo. 

=== Maquina virtual preferida para compilación ===

Al instalar paquetes Java, la máquina virtual utilizada puede ser diferente de la configurada actualmente como máquina virtual del sistema. 

Esta máquina virtual puede ser necesaria en diversas situaciones, por ejemplo si la máquina virtual del sistema esta configurada en nivel de código 1.6 y el paquete que esta siendo instalado requiere la versión 1.5. Al compilar, esta máquina sera seleccionada dejando la selección de system-vm intacta. 

Para definir qué máquina virtual está seleccionada cuando un cambio es requerido, se ha creado un listado de maquinas virtuales predefinidas por arquitectura. Este listado puede ser encontrado en {{Path|/usr/share/java-config-2/config/jdk-defaults.conf}}. 

Estas opciones pueden ser redefinidas (incluyento tambien la máquina virtual seleccionada) en {{Path|/etc/java-config-2/build/jdk.conf}}, teniendo así un completo control de cual máquina virtual sera utilizada durante las instalaciones.

Por ejemplo, para utilizar por defecto <code>sun-jdk</code>:

{{File|/etc/java-config-2/build/jdk.conf|Requiring sun-jdk|<pre>
*=sun-jdk
</pre>
}}

O por ejemplo, utilizar siempre <code>sun-jdk-1.5</code> donde sea posible, excepto cuando 1.4 o 1.3 sean requeridos explícitamente:

{{File|/etc/java-config-2/build/jdk.conf|Requiring sun-jdk-1.5 for 1.5 VMs|<pre>
*=sun-jdk-1.5
</pre>
}}

O por ejemplo, para utilizar diferentes proveedores para diferentes versiones, como <code>sun-jdk-1.4</code> si una versión 1.3 es requerida, y utilizar <code>ibm-jdk-bin</code> para otros casos:

{{File|/etc/java-config-2/build/jdk.conf|Using multiple expressions|<pre>
1.3=sun-jdk-1.4 ibm-jdk-bin
1.5=sun-jdk
</pre>
}}


{{Warning|Este cambio no es explícitamente ''requerido''. Si las opciones son cambiadas para utilizar una máquina virtual no soportada, es probable que algunas cosas dejen de funcionar. A causa de la amplia disponibilidad de máquinas virtuales, el proyecto Gentoo no tiene todos los recursos para verificar cada paquete en todas las máquinas virtuales. Así, reportes de errores en máquinas virtuales no soportadas no tendrán prioridad sobre errores presentes en máquinas virtuales soportadas.}}

== Compiladores ==

El compilador predeterminado utilizado para la compilación es <code>javac</code>, el cual se encuentra incluido en cada JDK. Adicionalmente a configurar la máquina virtual utilizada en tiempo de compilación, también existe la posibilidad de seleccionar cual compilador sera utilizado. Así, es posible definir un listado de preferencias mediante el archivo {{Path|/etc/java-config-2/build/compilers.conf}}. 

{{File|/etc/java-config-2/build/compilers.conf|Setting compiler preferences|<pre>
COMPILERS="ecj-X.Y jikes javac"
</pre>
}}

Es posible que algunos compiladores no soporten las opciones -target y -source. Por lo tanto, cada compilador dentro de la lista es probado para ver si soporta las opciones -source/-target deseadas, javac funcionara en todos los casos. Así pues si ninguno otro compilador es encontrado, sera el compilador por defecto. 

Más detalles acerca de los compiladores son descritos a seguir: 

{| class="wikitable" style="text-align: left;" 
|- 
! Nombre
! Ejecutable
! Paquete
! Descripción
|- 
| javac
| javac
| N/A
| Este es el compilador por defecto a ser utilizado y es parte de cada JDK.
|- 
| jikes
| jikes
| dev-java/jikes
| Jikes fue desarrollado originalmete por IBM. Como anecdota, este compilador es generalmente más rapido que javac, sin embargo es posible que falle en circunstancias donde javac no, además aun no presenta soporte para sintaxis Java 1.5 o superior.
|- 
| Compilador Java de Eclipse
| ecj
| dev-java/eclipse-ecj
| ECJ es el compilador utilizado por el kit de desarrollo de eclipse. Soporta muchas características y es considerablemente rápido. Además tiene soporte para sintaxis Java 1.5.
|-
|}

== Estableciendo un CLASSPATH por defecto ==

{{Warning|Las opciones explicadas en esta sección debe ser consideradas como obsoletas y es probable que sean removidas en el futuro. Se recomienda evitarlas ya que cada proyecto o aplicación Java debe administrar su propio classpath. Así, si se elige especificar un CLASSPATH por defecto, algunas aplicaciones podrían comportarse de forma inesperada a causa de código no esperado en el classpath.}}

<code>java-config</code> también puede ser utilizado para establecer un CLASSPATH por defecto para todo el sistema, así como para especificar un CLASSPATH especifico para un usuario. 

Primero, deben listarse todas las bibliotecas Java disponibles en el sistema que pueden ser incluidas en el CLASSPATH. Acá un ejemplo de la salida: 

{{RootCmd|java-config --list-available-packages|output=<pre>
[xerces-2] The next generation of high performance, fully compliant XML parsers in the Apache Xerces family (/usr/share/xerces-2/package.env)
[junit] Simple framework to write repeatable tests (/usr/share/junit/package.env)
[bsh] BeanShell: A small embeddable Java source interpreter (/usr/share/bsh/package.env)
[bcel] The Byte Code Engineering Library: analyze, create, manipulate Java class files (/usr/share/bcel/package.env)
[log4j] A low-overhead robust logging package for Java (/usr/share/log4j/package.env)
...
</pre>
}}

Los nombres dentro de las llaves (''[]'') son los identificadores que deben ser pasados como parámetro para <code>java-config --set-system-classpath</code>. Acá un ejemplo: 


{{RootCmd|java-config --set-system-classpath log4j,xerces-2}}

{{Note|El directorio actual ({{Path|.}}) no sera parte del classpath del sistema, ya que el mismo debe ser agregado en el perfil de inicio de sesión del sistema.}}

Es necesario actualizar el entorno reiniciando sesion o ejecutando <code>source /etc/profile</code>. 

Para usuarios, la instrucción <code>java-config --set-user-classpath</code> creara el archivo {{Path|~/.gentoo/java-env-classpath}} sobre el cual debe ejecutarse <code>source</code>, preferencialmente desde el perfil del shell. 

{{Code|Ejecutando source en el classpath especifico del usuario|<pre>
if [[ -f "${HOME}/.gentoo/java-env-classpath" ]]; then
       source ${HOME}/.gentoo/java-env-classpath
fi
</pre>
}}

If you really want a system wide or user default classpath you can add something like the following to your shell's profile. But we would advise against it. 

{{RootCmd|export CLASSPATH{{=}}"${CLASSPATH}:$(java-config --classpath log4j,xerces-2)"}}

== Java Browser Plugins ==

=== Installing a plugin ===

You can install a Java plugin for your web browser by emerging a Java VM with the <code>nsplugin</code> USE flag set.

{{Note|<code>nsplugin</code> is not available for all architectures. Check for available plugins on your arch before trying to install a VM by running<code>emerge -pv <java-vm></code>.}}

Portage will allow you to install multiple versions of Java plugins, though only one will be used by your browser. You can check the list of available plugins by running: 

{{RootCmd|eselect java-nsplugin list|output=<pre>
   [1]   sun-jre-bin-1.6
   [2]   icedtea-bin
</pre>
}}

In this example, <code>sun-jre-bin</code> is selected for the browser plugin. 

{{RootCmd|eselect java-nsplugin set sun-jre-bin-1.6}}

Verify that the correct plugin was selected: 

{{RootCmd|eselect java-nsplugin list|output=<pre>
   [1]   sun-jre-bin-1.6  current
   [2]   icedtea-bin
</pre>
}}

Java.com also provides a link to [http://java.com/en/download/installed.jsp verify your installed plugin]. Additionally, if you are using a Mozilla-based browser, you can verify your Java plugin by typing <code>about:plugins</code> into the address bar. 

=== Plugins on multilib systems ===

If you are running a mixed 64-bit and 32-bit multilib system (for example, on AMD64), you can use 64-bit and 32-bit Java plugins. Unless you have a pressing need to run 32-bit Java applications, we recommend using native 64-bit plugins on 64-bit web browsers. 

There are several native 64-bit browser plugins available. The default JDK/JRE pair, <code>sun-jdk</code> and <code>sun-jre-bin</code>, both include browser plugins. Just emerge one of them with the <code>nsplugin</code> USE flag enabled. 

{{RootCmd|echo "dev-java/sun-jre-bin nsplugin" >> /etc/portage/package.use
|emerge sun-jre-bin}}

To use a 32-bit plugin on a 32-bit browser, you will need to emerge <code>emul-linux-x86-java</code> with the <code>nsplugin</code> USE flag enabled. 

{{RootCmd|echo "app-emulation/emul-linux-x86-java nsplugin" >> /etc/portage/package.use
|emerge emul-linux-x86-java}}

Next, check which plugins are available: 

{{RootCmd|eselect java-nsplugin list|output=<pre>
Available 32-bit Java browser plugins
  [1]   emul-linux-x86-java-1.5
  [2]   emul-linux-x86-java-1.6
Available 64-bit Java browser plugins
  [1]   icedtea-bin
  [2]   sun-jre-bin-1.6
</pre>
}}

Now select the right plugin for your browsers: 

{{RootCmd|eselect java-nsplugin set 32bit emul-linux-x86-java-1.6
|eselect java-nsplugin set 64bit sun-jre-bin-1.6}}

Verify the correct plugin was selected: 

{{RootCmd|eselect java-nsplugin list|output=<pre>
Available 32-bit Java browser plugins
  [1]   emul-linux-x86-java-1.5
  [2]   emul-linux-x86-java-1.6  current
Available 64-bit Java browser plugins
  [1]   icedtea-bin
  [2]   sun-jre-bin-1.6  current
</pre>
}}

== USE flags for use with Java ==

=== Setting USE flags ===

For more information regarding USE flags, refer to the [http://www.gentoo.org//doc/en/handbook/handbook-x86.xml?part=2&chap=2 USE flags] chapter from the Gentoo Handbook. 

=== The flags ===

* The '''java''' flag adds support for Java in a variety of programs
* The '''nsplugin''' flag adds support for Mozilla-like browsers (including Firefox). You will need this for viewing Java applets in your Mozilla-like browser.
* The '''source''' flag installs a zip of the source code of a package. This is traditionally used for IDEs to 'attach' source to the libraries you are using.
* The '''jce''' flag adds support for the Java Cryptography Engine
* For Java packages, the '''doc''' flag will build API documentation using javadoc.

== Additional resources ==

=== Off-line resources ===

* java-config man page
* <code>java-config --help</code>

=== Online resources ===

* The [http://www.gentoo.org/proj/en/java/ Java Project Page] 
* The [http://news.gmane.org/gmane.linux.gentoo.java gentoo-java], [http://news.gmane.org/gmane.linux.gentoo.user gentoo-user], and [http://news.gmane.org/gmane.linux.gentoo.devel gentoo-dev] mailing list archives
* [http://www.gentoo.org/irc://irc.gentoo.org/gentoo #gentoo] and [http://www.gentoo.org/irc://irc.gentoo.org/gentoo-java #gentoo-java] on IRC
* [http://en.wikipedia.org/wiki/Java_programming_language Wikipedia's entry for Java] 
* If you have suggestions or questions regarding this document, please email the Gentoo Java team: {{Mail|java@gentoo.org}}

== Acknowledgements ==

We would like to thank the following authors and editors for their contributions to this guide:


* Joshua Nichols
* Karl Trygve Kalleberg
* Joshua Saddler
