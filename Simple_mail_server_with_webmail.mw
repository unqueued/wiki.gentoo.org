Simple mail server by using postfix MTA, dovecot IMAP + SASL and SquirrelMail webmail. This guide is for getting basic mail server working in small amount of time. You can always add more features later.

== postfix MTA ==
Remove ssmtp. (Blocks postfix)<br />
{{RootCmd|emerge -C ssmtp}}

Install postfix. Enable use flags : dovecot-sasl ipv6 pam ssl
{{Emerge|mail-mta/postfix}}

Configure postfix.
{{File|/etc/postfix/main.cf||<pre>
# basic config
myhostname = example.com
mydomain = example.com
myorigin = example.com
inet_interfaces = all
mynetworks_style = host
mydestination = $myhostname, localhost, $mydomain, mail.$mydomain, www.$mydomain
home_mailbox = .maildir/

# sasl config
smtpd_sasl_type = dovecot
smtpd_sasl_path = private/auth
smtpd_sasl_auth_enable = yes
smtpd_recipient_restrictions = permit_mynetworks, permit_sasl_authenticated, reject_unauth_destination
</pre>}}

Edit aliases. Redirect root mails to webmaster, add line "root: webmaster"<br />
{{RootCmd|nano /etc/mail/aliases}}

Generate aliases database.<br />
{{RootCmd|newaliases}}

Redirect root mails to webmaster. Add line : "webmaster@localhost"<br />
{{RootCmd|nano /root/.forward}}

Check for errors.<br />
{{RootCmd|postfix check}}

Start postfix.<br />
{{RootCmd|/etc/init.d/postfix start}}

Check /var/log/mail.log for errors.<br />
{{RootCmd|cat /var/log/mail.log}}

== dovecot IMAP, POP & SASL ==
Install dovecot. Enable use flags : bzip2 ipv6 maildir pam ssl zlib
{{Emerge|net-mail/dovecot}}

Configure dovecot.
{{File|/etc/dovecot/dovecot.conf||<pre>
protocols = imap pop3

# sasl config
service auth {
  unix_listener /var/spool/postfix/private/auth {
    mode = 0660
    user = postfix
    group = postfix
  }
}
</pre>}}

Start dovecot.<br />
{{RootCmd|/etc/init.d/dovecot start}}

== SquirrelMail webmail ==
Change dir to webserver root.<br />
{{Cmd|cd /home/webmaster/htdocs}}

Unpack squirrelmail.<br />
{{Cmd|tar xjf squirrelmail-webmail-1.4.22.tar.bz2}}

Configure squirrelmail.<br />
{{Cmd|cd squirrelmail-webmail-1.4.22/config}}
{{Cmd|cp config_default.php config.php}}
{{Cmd|nano config.php}}

{{File|config.php||<pre>
$data_dir = '/home/webmaster/.squirrelmail/data/';<br />
$attachment_dir = '/home/webmaster/.squirrelmail/attach/';<br />
$domain = 'example.com';<br />
</pre>}}

Create data dirs and set permissions.<br />
{{Cmd|mkdir -p /home/webmaster/.squirrelmail/data/}}
{{Cmd|mkdir -p /home/webmaster/.squirrelmail/attach/}}
{{RootCmd|chown -R webmaster:lighttpd /home/webmaster/.squirrelmail/}}
{{Cmd|chmod -R 770 /home/webmaster/.squirrelmail/}}

Debug squirrelmail by opening url : http://example.com/squirrelmail-webmail-1.4.22/src/configtest.php<br />
<br />
You can access webmail by opening url : http://example.com/squirrelmail-webmail-1.4.22/. Everything should be working now.

[[Category:Server]]
[[Category:Security]]
[[Category:Software]]
