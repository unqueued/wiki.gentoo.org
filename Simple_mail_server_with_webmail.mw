Simple mail server by using postfix MTA, dovecot IMAP + SASL and SquirrelMail webmail. This guide is for getting basic mail server working in small amount of time. You can always add more features later.

== postfix MTA ==

Remove ssmtp. (Blocks postfix)<br />
{{RootCmd|emerge -C ssmtp}}

Install postfix. Enable use flags : dovecot-sasl ipv6 pam ssl
{{Emerge|mail-mta/postfix}}

Configure postfix :
{{File|/etc/postfix/main.cf||<pre>
myhostname = example.com
mydomain = example.com
myorigin = example.com
inet_interfaces = all
mynetworks_style = host
mydestination = $myhostname, localhost, $mydomain, mail.$mydomain, www.$mydomain
home_mailbox = .maildir/

# sasl
smtpd_sasl_type = dovecot
smtpd_sasl_path = private/auth
smtpd_sasl_auth_enable = yes
smtpd_recipient_restrictions = permit_mynetworks, permit_sasl_authenticated, reject_unauth_destination
</pre>}}


Edit aliases. Redirect root mails, add line "root: user"<br />
{{RootCmd|nano /etc/mail/aliases}}

generate aliases<br />
{{RootCmd|newaliases}}

redirect root mails to user. Add line : "user@localhost"<br />
{{RootCmd|nano /root/.forward}}

check for errors<br />
{{RootCmd|postfix check}}

start postfix<br />
{{RootCmd|/etc/init.d/postfix start}}

Check /var/log/mail.log for any errors.<br />
{{RootCmd|cat /var/log/mail.log}}



== dovecot IMAP, POP & SASL ==

install dovecot. enable use flags : bzip2 ipv6 maildir pam ssl zlib
{{Emerge|net-mail/dovecot}}

Configure dovecot :
{{File|/etc/dovecot/dovecot.conf||<pre>
# sasl
service auth {
  unix_listener /var/spool/postfix/private/auth {
    mode = 0660
    # Assuming the default Postfix user and group
    user = postfix
    group = postfix
  }
}
</pre>}}

Start dovecot<br />
{{RootCmd|/etc/init.d/dovecot start}}



== SquirrelMail webmail ==

Change dir to webserver root<br />
{{Cmd|cd /home/webmaster/htdocs}}

Unpack squirrelmail<br />
{{Cmd|tar xjf squirrelmail-webmail-1.4.22.tar.bz2}}

configure squirrelmail<br />
{{Cmd|cd squirrelmail-webmail-1.4.22/config}}
{{Cmd|cp config_default.php config.php}}
{{Cmd|nano config.php}}

edit following :<br />
{{File|config.php||<pre>
$data_dir = '/home/user/.squirrelmail/data/';<br />
$attachment_dir = '/home/user/.squirrelmail/attach/';<br />
$domain = 'example.com';<br />
</pre>}}


Create data dirs and set permissions<br />
{{Cmd|mkdir -p /home/user/.squirrelmail/data/}}
{{Cmd|mkdir -p /home/user/.squirrelmail/attach/}}
<br />
{{RootCmd|chown -R user:lighttpd /home/user/.squirrelmail/}}
{{Cmd|chmod -R 770 /home/user/.squirrelmail/}}

Test config.<br />
Open url on web browser : http://example.com/squirrelmail-webmail-1.4.22/src/configtest.php<br />

Everything sould be working now :)
