Chroot (Change Root) is a Unix system utility used to change the apparent root directory to create a new environment logically separate from the main system. This new environment is known as a "chroot jail". A user operating inside the jail can not see or access files outside of the environment they have been locked into.

One of the main uses for chrooting is to create a separate Linux system on top of a the current one for the purpose of testing or software compatibility. It is often seen as a lightweight alternative to virtualization because it is able to run without the overhead of a hypervisor.

==Setting up the environment==
The first thing that you need to do is create a directory for your chroot to reside, for example in "/mnt/mychroot"

{{Cmd
|mkdir /mnt/mychroot
|cd /mnt/mychroot
}}

==Unpacking system files & portage tree==
The next step is to download the stage3 and portage tarballs and set them up in the chroot location. For more information on this process please see sections 5a and 5b in the [http://www.gentoo.org/doc/en/handbook/handbook-amd64.xml?part=1&chap=5 Gentoo Handbook].

{{Cmd
|links http://distfiles.gentoo.org/releases/amd64/current-stage3/
|tar xvjpf stage3-*.tar.bz2 -C /mnt/mychroot
|links http://distfiles.gentoo.org/snapshots/
|tar xvjf portage-*.tar.bz2 -C /mnt/mychroot/usr
}}

==Configuration==
Before entering the chroot we need to mount a number of directories.

{{Cmd
|mount -o bind /dev /mnt/mychroot/dev
|mount -t proc none /mnt/mychroot/proc
|mount -o bind /sys /mnt/mychroot/sys
|mount -o bind /tmp /mnt/mychroot/tmp
}}

And will also need to copy over some basic configuration file from the host.

{{Cmd
|cp /etc/portage/make.conf /mnt/mychroot/etc/portage
|cp /etc/resolv.conf /mnt/mychroot/etc
}}

Once done we can then enter the chroot environment.

{{Cmd
|chroot /mnt/mychroot /bin/bash
|env-update
|source /etc/profile
}}

Finally we should sync portage to make sure everything is up to date.

{{Cmd
|emerge --sync
}}

The system is now ready. You can install software, mess with settings, test experimental packages and configurations without having any effect on your main system. To leave the chroot simply type "exit" or press Ctrl-D, this will return you back to your normal environment.

==Init scripts==
To speed up the mounting of the directories needed for a chroot you can use an init script.

{{File|/etc/init.d/mychroot||
 #!/sbin/runscript

 depend() {
   need localmount
   need bootmisc
 }

 start() {
   do
     ebegin "Mounting chroot directories"
     mount -o bind /dev /mnt/mychroot/dev > /dev/null &
     mount -t proc none /mnt/mychroot/proc > /dev/null &
     mount -o bind /sys /mnt/mychroot/sys > /dev/null &
     mount -o bind /tmp /mnt/mychroot/tmp > /dev/null &
     eend $? "An error occurred while mounting chroot directories"
   done
 }

 stop() {
   do
     ebegin "Unmounting chroot directories"
     umount -f /mnt/mychroot/dev > /dev/null &
     umount -f /mnt/mychroot/proc > /dev/null &
     umount -f /mnt/mychroot/sys > /dev/null &
     umount -f /mnt/mychroot/tmp > /dev/null &
     eend $? "An error occurred while unmounting chroot directories"
   done
 }
 
}}

==See also==
* [http://www.gentoo.org/proj/en/base/x86/chroot.xml Gentoo x86 Chroot Setup Guide]
* [http://www.gentoo.org/proj/en/base/amd64/howtos/index.xml?part=1&chap=2 32Bit Chroot Guide for Gentoo/AMD64]

[[Category:Core system]]
