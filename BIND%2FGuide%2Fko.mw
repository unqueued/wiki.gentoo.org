<languages />

{{Metadata|abstract=이 안내서에서는 도메인과 로컬 네트워크에 대해 BIND를 설치하고 설명하는 방법을 알려드리도록 하겠습니다.}}

이 안내서에서는 도메인과 로컬 네트워크에 대해 BIND를 설치하고 설명하는 방법을 알려드리도록 하겠습니다.

== 도입부 ==

This tutorial will show you how to install and configure BIND, the most used DNS server on Internet. We will configure <code>bind</code> for your domain using different configurations, one for your local network and one for the rest of the world. We will use views to do that. One view for your internal zone (your local network) and other view for the external zone (rest of the world). 

== 예제에서 사용하는 데이터 ==

{| class="wikitable" style="text-align: left;" 
|- 
! 키워드
! 설명
! 예제
|- 
| YOUR_DOMAIN
| Your domain name
| gentoo.org
|- 
| YOUR_PUBLIC_IP
| The public ip that ISP gives to you
| 204.74.99.100
|- 
| YOUR_LOCAL_IP
| The local ip address
| 192.168.1.5
|- 
| YOUR_LOCAL_NETWORK
| The local network
| 192.168.1.0/24
|- 
| SLAVE_DNS_SERVER
| The ip address of the slave DNS server for your domain.
| 209.177.148.228
|- 
| ADMIN
| The DNS server administrator's name.
| root
|- 
| MODIFICATION
| The modification date of the file zone, with a number added
| 2009062901
|-
|}

== BIND 설정 ==

=== 설치 ===

먼저, <code>net-dns/bind</code>를 설치하십시오. 

{{Emerge|net-dns/bind}}

=== /etc/bind/named.conf 설정 ===

The first thing to configure is {{Path|/etc/bind/named.conf}} . The first part of this step is specifying bind's root directory, the listening port with the IPs, the pid file, and a line for ipv6 protocol.

{{Code|options 섹션|<pre>
options {
        directory "/var/bind";
  
        listen-on-v6 { none; };
        listen-on port 53 { 127.0.0.1; YOUR_LOCAL_IP; };
  
        pid-file "/var/run/named/named.pid";
};
</pre>
}}

The second part of {{Path|named.conf}} is the internal view used for our local network. 

{{Code|"internal" 뷰|<pre>
view "internal" {
        match-clients { YOUR_LOCAL_NETWORK; localhost; };
        recursion yes;
  
        zone "YOUR_DOMAIN" {
                type master;
                file "pri/YOUR_DOMAIN.internal";
                allow-transfer { any; };
        };
};
</pre>
}}

The third part of {{Path|named.conf}} is the external view used to resolve our domain name for the rest of the world and to resolve all other domain names for us (and anyone who wants to use our DNS server). 

{{Code|"external" 뷰|<pre>
view "external" {
        match-clients { any; };
        recursion no;
  
        zone "." IN {
                type hint;
                file "named.ca";
        };
  
        zone "127.in-addr.arpa" IN {
                type master;
                file "pri/127.zone";
                allow-update { none; };
                notify no;
        };
  
        zone "YOUR_DOMAIN" {
                type master;
                file "pri/YOUR_DOMAIN.external";
                allow-query { any; };
                allow-transfer { SLAVE_DNS_SERVER; };
        };
};
</pre>
}}

The final part of {{Path|named.conf}} is the logging policy. 

{{Code|"external" 뷰|<pre>
logging {
        channel default_syslog {
                file "/var/log/named/named.log" versions 3 size 5m;
                severity debug;
                print-time yes;
                print-severity yes;
                print-category yes;
        };
       category default { default_syslog; };
};
</pre>
}}

{{Path|/var/log/named/}} 디렉터리가 존재해야 하며 <code>named</code>의 소유여야 합니다: 

{{RootCmd|mkdir -p /var/log/named/
|chmod 770 /var/log/named/
|touch /var/log/named/named.log
|chmod 660 /var/log/named/named.log
|chown -R named /var/log/named/
|chgrp -R named /var/log/named/}}

=== 내부 구역 파일 만들기 ===

We use the hostnames and IP adresses of the picture network example. Note that almost all (not all) domain names finish with "." (dot). 

{{Code|/var/bind/pri/YOUR_DOMAIN.internal|<pre>
$TTL 2d
@	IN SOA	ns.YOUR_DOMAIN.	ADMIN.YOUR_DOMAIN. (
	MODIFICATION	; serial
	3h	; refresh
	1h	; retry
	1w	; expiry
	1d )	; minimum
  
YOUR_DOMAIN.		IN MX	0 mail.YOUR_DOMAIN.
YOUR_DOMAIN.		IN TXT	"v=spf1 ip4:YOUR_PUBLIC_IP/32 mx ptr mx:mail.YOUR_DOMAIN ~all"
YOUR_DOMAIN.		IN NS	ns.YOUR_DOMAIN.
YOUR_DOMAIN.		IN NS	SLAVE_DNS_SERVER
www.YOUR_DOMAIN.	IN A	192.168.1.3
ns.YOUR_DOMAIN.		IN A	192.168.1.5
mail.YOUR_DOMAIN.	IN A	192.168.1.3
router.YOUR_DOMAIN.	IN A	192.168.1.1
hell.YOUR_DOMAIN.	IN A	192.168.1.3
heaven.YOUR_DOMAIN.	IN A	192.168.1.5
desktop.YOUR_DOMAIN.	IN A	192.168.1.4
</pre>
}}

=== 외부 구역 파일 만들기 ===

Here we only have the subdomains we want for external clients (www, mail and ns). 

{{Code|/var/bind/pri/YOUR_DOMAIN.external|<pre>
$TTL 2d
@	IN SOA	ns.YOUR_DOMAIN.	ADMIN.YOUR_DOMAIN. (
	MODIFICATION	;serial
	3h	;refresh
	1h	;retry
	1w	;expiry
	1d )	;minimum
  
YOUR_DOMAIN.		IN MX	0 mail.YOUR_DOMAIN.
YOUR_DOMAIN.		IN TXT	"v=spf1 ip4:YOUR_PUBLIC_IP/32 mx ptr mx:mail.YOUR_DOMAIN ~all"
YOUR_DOMAIN.		IN NS	ns.YOUR_DOMAIN.
YOUR_DOMAIN.		IN NS	SLAVE_DNS_SERVER
www.YOUR_DOMAIN.	IN A	YOUR_PUBLIC_IP
ns.YOUR_DOMAIN.		IN A	YOUR_PUBLIC_IP
mail.YOUR_DOMAIN.	IN A	YOUR_PUBLIC_IP
</pre>
}}

=== 설정 마무리 ===

<code>named</code>를 기본 런레벨에 추가해야 합니다: 

{{RootCmd|rc-update add named default}}

== 클라이언트 설정 ==

Now you can use your own DNS server in all machines of your local network to resolve domain names. Modify the {{Path|/etc/resolv.conf}} file of all machines of your local network. 

{{Code|Editing /etc/resolv.conf|<pre>
search YOUR_DOMAIN
nameserver YOUR_DNS_SERVER_IP
</pre>
}}

Note that YOUR_DNS_SERVER_IP is the same as YOUR_LOCAL_IP we used in this document. In the picture the example is 192.168.1.5. 

== 시험 ==

새 DNS 서버를 시험할 수 있게 되었습니다. 먼저, 서비스를 시작해야 합니다. 

{{RootCmd|/etc/init.d/named start}}

Now, we are going to make some <code>host</code> commands to some domains. We can use any computer of our local network to do this test. If you don't have <code>net-dns/host</code> installed you can use <code>ping</code> instead. Otherwise, first run <code>emerge host</code> . 

{{Cmd|host www.gentoo.org|output=<pre>
www.gentoo.org has address 209.177.148.228
www.gentoo.org has address 209.177.148.229
</pre>}}

{{Cmd|host hell|output=<pre>
hell.YOUR_DOMAIN has address 192.168.1.3
</pre>}}

{{Cmd|host router|output=<pre>
router.YOUR_DOMAIN has address 192.168.1.1
</pre>}}


== iptables로 서버 보호하기 ==

서버를 보호하려 iptables를 사용한다면 DNS 서비스에 대한 규칙을 추가할 수 있습니다. 

{{Code|Iptables 규칙|<pre>
iptables -A INPUT -p udp --sport 53 -m state --state ESTABLISHED,RELATED -j ACCEPT
iptables -A INPUT -p udp --dport 53 -j ACCEPT
iptables -A INPUT -p tcp --sport 53 -j ACCEPT
iptables -A INPUT -p tcp --dport 53 -j ACCEPT
</pre>
}}

== 감사문 ==

이 안내서에 제공한 노고에 대해 다음 작성자와 편집자분들께 감사의 말을 전하고자 합니다:

* Vicente Olivert Riera
* nightmorph


[[Category:Server]]
[[Category:Daemons]]
