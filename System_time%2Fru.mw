<languages />
{{InfoBox stack
|{{InfoBox wikipedia|text=System time|header=true}}
|{{InfoBox wikipedia|Real-time clock|text=Real-time clock}}
|{{InfoBox wikipedia|Time zone|text=Time zone}}
}}


'''Системное время''' использует системные часы и используется в Unix системах для слежения за временем. Его можно установить с помощью аппаратных часов или с помощью внешнего сервера времени.

== Предисловие ==

=== Программные или аппаратные часы ===

Системные часы, предоставляемые ядром, реализуются простым подсчетом числа секунд, прошедших с 1 января 1970 года 00:00:00 UTC по настоящее время. Это число называется [[Wikipedia:Unix time|Unix-время]].

Аппаратные часы, также известные как часы реального времени (real-time clock или RTC), обычно представляют из себя элемент материнской платы. Они работают все время, независимо от состояния операционной системы, даже когда компьютер выключен.

=== UTC или местное время ===

Настройка времени аппаратных часов может быть осуществлена исходя из двух стандартов: локальное время или [[Wikipedia:Coordinated Universal Time|время UTC]]. Локальное время — это реальное время часового пояса, учитывающее переход на [[Wikipedia:Daylight saving time|DST]]. Предпочтительно использовать UTC, поскольку системное время вычисляется посредством прибавления к нему разницы времени часового пояса с учётом летнего времени. Благодаря этому перевод часов на летнее время учитывается автоматически, а изменение часового пояса возможно без изменения значения аппаратных часов. Исключение может быть сделано при использовании систем с двойной загрузкой, когда одна операционная система не поддерживает или не настроена для аппаратных часов с UTC (по умолчанию Windows настроена на использование локального времени).

== Часовой пояс ==

Для поддержания правильного исчисления времени необходимо выбрать соответствующий часовой пояс, чтобы системе было известно её текущее местоположение.

=== OpenRC ===

Поищите необходимый часовой пояс в {{Path|/usr/share/zoneinfo}}. Пожалуйста, не используйте часовые пояса {{Path|/usr/share/zoneinfo/Etc/GMT*}}, так как их имена не означают ожидаемый пояс. Например, {{Path|/usr/share/zoneinfo/Etc/GMT-8}} на самом деле является GMT+8. Для местного времени следует указывать часовой пояс «localtime».

После выбора нужного часового пояса укажите его в файле {{Path|/etc/timezone}}. Например, для Германии, следует добавить следующее:

{{FileBox|filename=/etc/timezone|1=Europe/Berlin}}

При каждом обновлении пакета {{Package|sys-libs/timezone-data}} информация из этого файла будет использоваться для копирования выбранного часового пояса в файл {{Path|/etc/localtime}}. Чтобы настроить этот файл вне обновления, запустите следующую команду:

{{Emerge|params=--config|timezone-data}}

=== systemd ===

В [[systemd/ru|systemd]] существует команда {{c|timedatectl}} для настройки часового пояса:

Проверка текущего часового пояса:

{{Cmd|timedatectl}}

Вывод доступных часовых поясов:

{{Cmd|timedatectl list-timezones}}

Чтобы изменить часовой пояс, пример для Германии:

{{RootCmd|timedatectl set-timezone Europe/Berlin}}

== LC_TIME ==

Эта [[Localization/Guide/ru#Переменное окружение локали|переменная окружения]] определяет форматирование даты и времени. Для более детальной информации смотрите [http://www.gnu.org/software/libc/manual/html_node/Locale-Categories.html#index-LC_005fTIME The GNU C Library]

== Системные часы ==

Обычно время системных часов устанавливается аппаратными часами во время загрузки системы. Также системные часы возможно установить вручную либо с помощью сервера сетевого времени.

Для изменения системного времени можно воспользоваться командой {{c|date}}:

Вывод текущего времени программных часов:

{{Cmd|date}}

To set the system clock, e.g. 12:34, May. 6, 2016:

{{RootCmd|date 050612342016}}

=== Сервер времени ===

Смотрите статью [[Ntp|NTP]], чтобы получить информацию по использованию сервера времени.

=== systemd ===

systemd существует команда {{c|timedatectl}} для управления системным временем:

Вывод текущего времени программных часов:

{{Cmd|timedatectl}}

Установка системного времени:

{{RootCmd|timedatectl set-time "2012-12-17 12:30:59"}}

== Аппаратные часы ==

Чтобы получить доступ к аппаратным часам, нужно собрать ядро со следующими включенными параметрами:

{{KernelBox|title=Necessary kernel options for a hardware clock|1=
Device Drivers  --->
    [*] Real Time Clock  --->
        [ ]   Set system time from RTC on startup and resume
        [ ]   Set the RTC time based on NTP synchronization
        [*]   /sys/class/rtc/rtcN (sysfs)
        [*]   /proc/driver/rtc (procfs for rtc0)
        [*]   /dev/rtcN (character devices)
        <*>   PC-style 'CMOS'
}}

Следующая команда выводит текущее на данный момент время аппаратных часов:

{{RootCmd|hwclock --show}}

Следующая команда устанавливает время аппаратных часов в соответствии с системным временем:

{{RootCmd|hwclock --systohc}}

=== Синхронизация аппаратных часов и системного времени ===

Обычно аппаратные часы используются при загрузке для установки системного времени. Это может быть осуществлено ядром самостоятельно, либо с помощью сценария инициализации при загрузке. Завершение работы ядра или службы также может вызвать сохранение времени системных часов в аппаратные часы. Благодаря этому система сохранит правильное время при следующей загрузке.

==== Синхронизация с помощью ядра ====

В свежих версиях (3.9 и выше) ядро Linux можно сконфигурировать таким образом, чтобы оно устанавливало системное время автоматически. Чтобы добиться этого, необходимо включить параметры '''Set system time ...''' и '''Set the RTC time ...''':

{{KernelBox|title=Letting the kernel sync the system clock|1=
Device Drivers  --->
    [*] Real Time Clock  --->
        [*]   Set system time from RTC on startup and resume
        [*]   Set the RTC time based on NTP synchronization
        [*]   /sys/class/rtc/rtcN (sysfs)
        [*]   /proc/driver/rtc (procfs for rtcN)
        [*]   /dev/rtcN (character devices)
        <*>   PC-style 'CMOS'
}}

Please note that '''Set the RTC time based on NTP synchronization''' is not used by some NTP implementations. Supported NTP implementations include: {{Package|net-misc/chrony}} (more information [http://chrony.tuxfamily.org/comparison.html here]) and {{Package|net-misc/ntp}} (more information in the [[Ntp|NTP article]]). OpenNtpd ({{Package|net-misc/openntpd}}) does '''not''' support setting the hardware time and therefore should be avoided.

Чтобы убедиться, что время аппаратных часов обновилось, запустите следующую команду:

{{RootCmd|adjtimex --print {{!}} grep status}}

Выведенное число 64 бит должно быть не задано (0). Более подробная информация в man-странице hwclock (ищите '11 minute mode').

==== OpenRC ====

При использовании OpenRC для установки системного времени во время загрузки и синхронизации аппаратных часов во время завершения работы можно воспользоваться сценарием инициализации {{Path|hwclock}}. Данная служба включена по умолчанию и ''отключать'' её следует только при использовании вышеуказанного способа синхронизации ядром. Сценарий {{Path|hwclock}} ''не следует'' запускать при использовании часов реального времени ядра. 

{{RootCmd|rc-update del hwclock}}

Однако, если необходимо синхронизировать время с помощью OpenRC, в файле {{Path|/etc/conf.d/hwclock}} для <code>clock_hctosys</code> и <code>clock_systohc</code> следует установить значение в <code>YES</code>. По умолчанию служба настроена на стандарт UTC. Чтобы изменить её на использование стандарта местного времени (localtime) необходимо добавить <code>clock="local"</code>.

{{FileBox|filename=/etc/conf.d/hwclock|title=Синхронизация аппаратных часов|lang=bash|1=
clock_hctosys="YES" 
clock_systohc="YES"
# clock="local"
}}

Перезапустите службу {{Path|hwclock}} и добавьте сценарий инициализации в уровень запуска boot:

{{RootCmd
|rc-service hwclock restart
|rc-update add hwclock boot
}}

==== Systemd ====

Для установки системного времени во время загрузки можно использовать [[systemd/ru|systemd]]. Для управления аппаратными часами используйте команду {{c|timedatectl}}:

Вывод текущего времени аппаратных часов:

{{Cmd|timedatectl {{!}} grep "RTC time"}}

Следующая команда устанавливает аппаратные часы в соответствии с системным временем (в стандарте времени UTC):

{{RootCmd|timedatectl set-local-rtc 0}}

Следующая команда устанавливает аппаратные часы в соответствии с системным временем в стандарте времени localtime (местное время):

{{RootCmd|timedatectl set-local-rtc 1}}

== Смотрите также ==

* [[Ntp|NTP]] - Another way to manage system time is through the network time protocol.
* [[OpenNTPD|OpenNTPD]] - Lightweight NTP server ported from OpenBSD

== Ссылки ==

* http://lifehacker.com/5742148/fix-windows-clock-issues-when-dual-booting-with-os-x — двойная загрузка с MS Windows, установка RealTimeIsUniversal. Также работает с [[UEFI_Dual_boot_with_Windows_7/8|Windows 10]].
* http://tldp.org/HOWTO/Clock-2.html — The Clock Mini-HOWTO.


[[Category:Localization]]
