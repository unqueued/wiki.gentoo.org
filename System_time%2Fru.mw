<languages />
{{InfoBox stack
|{{InfoBox wikipedia|text=System time|header=true}}
|{{InfoBox wikipedia|Real-time clock|text=Real-time clock}}
|{{InfoBox wikipedia|Time zone|text=Time zone}}
}}


The '''system time''' backed by the system clock is used in Unix systems to keep track of time. It can be set by a hardware clock or by an external time server.

== Предисловие ==

=== Программные и аппаратные часы ===

Системные часы, предоставляемые ядром, реализуются простым подсчетом числа секунд, прошедших с 1 января 1970 года 00:00:00 UTC по настоящее время. Это число называется [[Wikipedia:ru:UNIX-время|Unix-время]].

Аппаратные часы, также известные как часы реального времени (real-time clock или RTC), обычно представляют из себя элемент материнской платы. Они работают все время, независимо от состояния операционной системы, даже когда компьютер выключен.

=== UTC или местное время ===

Настройка времени аппаратных часов отображать время одного из двух стандартов: локальное время или  [[Wikipedia:ru:Всемирное координированное время|Всемирное координированное время]] (UTC). Локальное время — это реальное время часового пояса, учитывающее переход на [[Wikipedia:ru:Летнее время|летнее время]]. Предпочтительно использовать UTC, поскольку системное время вычисляется посредством прибавления к нему разницы времени часового пояса с учётом летнего времени. Благодаря этому перевод часов на летнее время учитывается автоматически, а изменение часового пояса возможно без изменения значения аппаратных часов. Исключение может быть сделано при использовании систем с двойной загрузкой, когда одна операционная система не поддерживает или не настроена на аппаратные часы с UTC (по умолчанию Windows настроена на использование локального времени).

== Часовой пояс ==

Для поддержания правильного исчисления времени необходимо выбрать соответствующий часовой пояс, чтобы системе было известно её текущее местоположение.

=== OpenRC ===

Часовые пояса находятся в каталоге в {{Path|/usr/share/zoneinfo}}. Не используйте часовые пояса {{Path|/usr/share/zoneinfo/Etc/GMT*}}, так как их имена не означают ожидаемый пояс. Например, {{Path|/usr/share/zoneinfo/Etc/GMT-8}} на самом деле является GMT+8. Для местного времени следует указывать часовой пояс «localtime».

После выбора нужного часового пояса укажите его в файле {{Path|/etc/timezone}}. Например, для Германии, следует добавить следующее:

{{FileBox|filename=/etc/timezone|1=Europe/Berlin}}

При каждом обновлении пакета {{Package|sys-libs/timezone-data}} информация из этого файла будет использоваться для копирования выбранного часового пояса в файл {{Path|/etc/localtime}}. Чтобы настроить этот файл вне обновления, запустите следующую команду:

{{Emerge|params=--config|timezone-data}}

=== systemd ===

В [[systemd/ru|systemd]] существует команда {{c|timedatectl}} для настройки часового пояса:

Проверка текущего часового пояса:

{{Cmd|timedatectl}}

Чтобы увидеть список доступных часовых поясов:

{{Cmd|timedatectl list-timezones}}

Чтобы изменить часовой пояс, пример для Германии:

{{RootCmd|timedatectl set-timezone Europe/Berlin}}

== LC_TIME ==

This [[Localization/Guide#Environment_variables_for_locales|environment variable]] defines formatting of dates and times. For more details see [http://www.gnu.org/software/libc/manual/html_node/Locale-Categories.html#index-LC_005fTIME The GNU C Library]

== Системный часы ==

Typically the system clock time is set up by the hardware clock on boot. Alternatively it is possible to manually set the system clock or use a network time server.

Можно использовать команду {{c|date}} для настройки системного времени:

Для проверки текущего времени программных часов:

{{Cmd|date}}

Чтобы установить системные часы например в 12:30, Dec. 17, 2012:

{{RootCmd|date 121712302012}}

=== Сервер времени ===

Смотрите статью [[Ntp|NTP]] для информации по использованию сервера времени.

=== systemd ===

systemd предоставляет команду {{c|timedatectl}} для настройки системного времени:

Для проверки текущего времени программных часов:

{{Cmd|timedatectl}}

Чтобы установить системное время:

{{RootCmd|timedatectl set-time "2012-12-17 12:30:59"}}

== Аппаратные часы ==

To have a hardware clock, the following kernel options must be activated:

{{KernelBox|title=Необходимые опции ядра для аппаратных часов|1=
Device Drivers  --->
        [*] Real Time Clock  --->
        [ ]   Set system time from RTC on startup and resume
        [ ]   Set the RTC time based on NTP synchronization
[*]   /sys/class/rtc/rtcN (sysfs)
        [*]   /proc/driver/rtc (procfs for rtc0)
        [*]   /dev/rtcN (character devices)
<*>   PC-style 'CMOS'
}}

Чтобы узнать время аппаратных часов:

{{RootCmd|hwclock --show}}

Чтобы установить время аппаратных часов в соответствии с системным временем:

{{RootCmd|hwclock --systohc}}

=== Синхронизация аппаратных часов и системного времени ===

Typically the hardware clock is used to setup the system clock on boot. This can be done by the kernel itself or by a boot service (init script). Also on shutdown the kernel or a service can write the software clock to the hardware clock. This aids the system in having the correct time on boot.

==== In-kernel method ====

On a sufficiently modern kernel (3.9 or newer), Linux can be configured to handle setting the system time automatically. To do so, also the '''Set system time ...''' and '''Set the RTC time ...''' drivers need to be activated:

{{KernelBox|title=Letting the kernel sync the system clock|1=
Device Drivers  --->
        [*] Real Time Clock  --->
        [*]   Set system time from RTC on startup and resume
        [*]   Set the RTC time based on NTP synchronization
[*]   /sys/class/rtc/rtcN (sysfs)
        [*]   /proc/driver/rtc (procfs for rtc0)
        [*]   /dev/rtcN (character devices)
<*>   PC-style 'CMOS'
}}

Please not that '''Set the RTC time based on NTP synchronization''' is not used by some NTP implementations. Supported NTP implementations include: {{Package|net-misc/chrony}} (more information [http://chrony.tuxfamily.org/comparison.html here]) and {{Package|net-misc/ntp}} (more information in the [[NTP|NTP article]]). OpenNtpd ({{Package|net-misc/openntpd}}) does '''not''' support setting the hardware time and therefore should be avoided.

To check if the hardware time is updated, run:

{{RootCmd|adjtimex --print {{!}} grep status}}

The 64 bit of the reported number should be unset (0). More information in hwclock man pages (search '11 minute mode').

==== OpenRC ====

When using OpenRC the {{Path|hwclock}} init script can set the system clock on boot and sync system time to the hardware clock on shutdown. The service is enabled by default and should be ''disabled'' in favor of the above mentioned in-kernel method. The {{Path|hwclock}} script should ''not'' be run when using the kernel's real time clock. 

{{RootCmd|rc-update del hwclock}}

Однако, если есть необходимость синхронизации времени с помощью OpenRC, то установите <code>YES</code> напротив <code>clock_hctosys</code> и <code>clock_systohc</code>   в файле {{Path|/etc/conf.d/hwclock}}. По умолчанию служба настроена на стандарт UTC. Чтобы изменить на стандарт местного времени (localtime) необходимо добавить <code>clock="local"</code>.

{{FileBox|filename=/etc/conf.d/hwclock|title=Adding hardware clock sync|lang=bash|1=
clock_hctosys="YES" 
clock_systohc="YES"
# clock="local"
}}

Restart the {{Path|hwclock}} service and have the hardware clock init script run on system boot:

{{RootCmd
|rc-service hwclock restart
|rc-update add hwclock boot
}}

==== Systemd ====

[[systemd]] can be used to set the system clock on boot. Use {{c|timedatectl}} to manage the hardware clock:

To check the current hardware clock time:

{{Cmd|timedatectl {{!}} grep "RTC time"}}

To set the hardware clock to the current system clock (UTC time standard):

{{RootCmd|timedatectl set-local-rtc 0}}

To set the hardware clock to the current system clock (localtime time standard):

{{RootCmd|timedatectl set-local-rtc 1}}

== Смотрите также ==

* [[NTP]] - Another way to manage system time is through the network time protocol.

== Ссылки ==

* http://lifehacker.com/5742148/fix-windows-clock-issues-when-dual-booting-with-os-x - Dual booting with MS Windows, set RealTimeIsUniversal. Also tested with [[UEFI_Dual_boot_with_Windows_7/8|Windows 10]].
* http://tldp.org/HOWTO/Clock-2.html - The Clock Mini-HOWTO.


[[Category:Localization]]
