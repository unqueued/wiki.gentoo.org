This article provides information on how to get up and running with grub:2 in the simplest configurations. For more comprehensive information, see [[GRUB2]].

== Gentoo GRUB Legacy (0.97) to GRUB2 Migration Guide ==

The guide is available at: http://www.gentoo.org/doc/en/grub2-migration.xml

== GRUB slots ==
The {{Package|sys-boot/grub}} package is slotted; both grub-0.97 and grub-2.00 may be installed at the same time.

'''If you want to install grub-0.97 or keep it installed after an upgrade''', call emerge with the "0" slot on the end of the package atom. This will add sys-boot/grub:0 to your world file. For example:
{{emerge|params=--noreplace|sys-boot/grub:0}}

Only one version may be installed in your MBR at one time.

== Installing the software ==
Set GRUB_PLATFORMS in make.conf (optional). If unset, grub will guess which platform you want. It guesses "pc" for x86/amd64.
{{File|/etc/portage/make.conf||<pre>
# Standard PC (BIOS)
GRUB_PLATFORMS="pc"

# UEFI on amd64
GRUB_PLATFORMS="efi-64"

# UEFI and PC
GRUB_PLATFORMS="efi-64 pc"
</pre>}}

Run emerge.
{{emerge|sys-boot/grub:2}}

== Installing a bootable image ==
Mount your /boot volume if you have one.
{{RootCmd|mount /boot}}

If you are using an EFI platform, mount your EFI system volume at /boot/efi. This should be a FAT volume containing an EFI subdirectory.
{{RootCmd|mount /boot/efi}}

Run the grub2-install utility to copy the relevant files to /boot/grub2. On the PC platform, this also installs a boot image to the master boot record (MBR) or a partition's boot sector.

grub2-install accepts a --target option to specify which CPU/Platform to install. If unspecified, grub2-install will make a guess; on amd64/x86 it will use "i386-pc" by default.

Installing to the MBR:
{{RootCmd|grub2-install /dev/sda
|output=Installation finished. No error reported.}}

Installing to a partition (not recommended):
{{RootCmd|grub2-install /dev/sda1
|output=Installation finished. No error reported.}}

Installing on EFI:
{{RootCmd|grub2-install --target<nowiki>=</nowiki>x86_64-efi
|output=Installation finished. No error reported.}}

== Automatic Configuration ==
GRUB2 is traditionally configured by using the grub2-mkconfig program to generate a config file.

grub2-mkconfig generates the config file based on template sections in /etc/grub.d. The default templates should cover most common boot setups.

{{Cmd|ls /etc/grub.d
|output=00_header  10_linux  20_linux_xen  30_os-prober  40_custom  41_custom  README}}

The behavior of these templates may be controlled by setting variables in /etc/default/grub. See the [http://www.gnu.org/software/grub/manual/html_node/Simple-configuration.html GRUB manual] for reference.

=== Kernel naming ===
In order for grub2-mkconfig to detect your Linux kernel(s), they must be named vmlinuz-''version'' or kernel-''version''. For example:
 /boot/vmlinuz-3.4.3
 /boot/kernel-2.6.39-gentoo

If you use an [[initramfs]], it should be named initramfs-''version''.img or initrd-''version''.img. File names generated by genkernel will also work.
 /boot/initramfs-3.4.3.img
 /boot/initramfs-genkernel-x86_64-2.6.39-gentoo

Generate the grub.cfg file:
{{RootCmd|mount /boot
|grub2-mkconfig -o /boot/grub2/grub.cfg
|output=Generating grub.cfg ...
Found linux image: /boot/vmlinuz-3.2.9
done}}

=== SystemD ===

to boot systemd with grub2 make your line look like this

{{File|/etc/default/grub||<pre>
GRUB_CMDLINE_LINUX_DEFAULT="init=/usr/bin/systemd"</pre>}}

=== loading windows 7 ===

{{RootCmd|emerge os-prober ntfs3g}}

then run your grub2-mkconfig -o /boot/grub2/grub.cfg commands

if you just fixed your kernel to accept fuse then reboot to load your new kernel and rerun grub2-mkconfig

=== Automating Installs ===
install this script

{{File|/usr/sbin/grub||<pre>
#!/bin/bash
#this script requires /etc/mtab
#mount boot drive
mount | grep "/boot" /etc/mtab > /dev/null
if [ $? -ne 0 ]; then
sudo mount /boot
echo "mounting and installing grub to /boot"
else
echo "installing grub to /boot"
fi
#find boot drive and set it
DRIVE=$(cat /etc/mtab | grep boot | awk '{print $1}' | sed 's/[0-9]*//g')
#make /boot/grub2 directory if it is missing
if [ ! -d "/boot/grub2" ]; then
   mkdir /boot/grub2
   exit 1;
fi
#grub make config to generate configuration file
/usr/sbin/grub2-mkconfig -o /boot/grub2/grub.cfg
#install grubcfg settings
/usr/sbin/grub2-install $DRIVE</pre>}}

make it executable

{{RootCmd|chmod +x /usr/sbin/grub}}

drop your new kernel into /boot and simply run

{{RootCmd|grub}}

== Manual Configuration ==
Instead of using <code>grub2-mkconfig</code>, a typical simple <code>grub.conf</code> can easily be converted to be suitable for use in <code>grub.cfg</code>.
{|
! style="text-align: left;" | <code>grub.conf</code> (GRUB Legacy)
|
! style="text-align: left;" | <code>grub.cfg</code> (GRUB 2)
|-
| style="background: rgb(250,250,250); vertical-align: top; border: 1px solid black; padding: 5px 7px;" | <code style="color: gray; margin: 0; padding: 0; border: 0; background: transparent; line-height: normal;">timeout 5<br />
<br />
<span style="font-weight: bold; color: maroon;">title</span> Gentoo Linux 3.2.12<br />
root <span style="font-weight: bold; color: maroon;">(</span>hd0,<span style="font-weight: bold; color: maroon;">0)</span><br />
<span style="font-weight: bold; color: maroon;">kernel</span> /boot/kernel-3.2.12-gentoo root=/dev/sda3</code>
| style="vertical-align: middle; font-size: 50px; color: gray;" | â‡¨
| style="background: rgb(250,250,250); vertical-align: top; border: 1px solid black; padding: 5px 7px;" | <code style="color: gray; margin: 0; padding: 0; border: 0; background: transparent; line-height: normal;">timeout<span style="font-weight: bold; color: green;">=</span>5<br />
<br />
<span style="font-weight: bold; color: green;">menuentry</span> <span style="font-weight: bold; color: green;">'</span>Gentoo Linux 3.2.12<span style="font-weight: bold; color: green;">'</span> <span style="font-weight: bold; color: green;">{</span><br />
<span style="display: inline-block; width: 4ex; overflow: hidden;">	</span>root<span style="font-weight: bold; color: green;">=</span>hd0,<span style="font-weight: bold; color: green;">1</span><br />
<span style="display: inline-block; width: 4ex; overflow: hidden;">	</span><span style="font-weight: bold; color: green;">linux</span> /boot/kernel-3.2.12-gentoo root=/dev/sda3<br />
<span style="font-weight: bold; color: green;">}</span>
|}

[[Category:Bootloaders]]
