{{InfoBox stack
|{{InfoBox homepage|https://github.com/gentoo/gentoo/pulls|header=true}}
}}

==GitHub pull requests for Users and Proxied Maintainers (please shorten this)==
[[File:Cycle of usercontributions.png|300px|thumbnail|right|Workflow of a user contribution. The green arrows show the path of contribution. Grey arrows are optional, possible access directions.]]

The most efficient way of submitting your contributions is through [https://github.com/gentoo/gentoo/pulls pull requests on our GitHub repository]. At the moment, it gives the best response time, the widest audience for reviews and some nice scripting (including CI) to help.

{{Tip|Once you push your new branch, visit the GitHub page of your fork. GitHub will show you a banner suggesting creating a pull request. Using it, you can avoid the necessity of specifying the fork and branch manually.}}

Once the pull request is created, our tooling will automatically CC the relevant people (maintainers and/or proxy-maint team) and perform basic QA checks via [https://github.com/pkgcore/pkgcheck pkgcheck]. If any issues are reported, please fix them or explicitly ask for help. Our reviewers may skip pull requests which are marked as not passing CI.

Afterwards, follow the suggestions given by reviewers and push updates until the pull request is fully approved. If you do not receive a reply within a reasonable time, please make sure to ping us on the pull request. When it's ready and approved, we'll merge it.

Please keep the same commit structure as you would use when committing straight to Gentoo as a developer, and follow the best git practices (atomic changes, proper commit messages). For smaller changes, we can squash and reword the commits for you. However, if you are going to actively maintain multiple packages or submit larger changes, we will require you to squash, split and word your commits appropriately. Please see the git documentation on [https://git-scm.com/book/en/v2/Git-Tools-Rewriting-History rewriting history]. Once you've got updated commit set, use <code>git push --force</code> to overwrite your previous commits on the pull request branch.

=== Step 0: User configures the local repository ===
Clone the github mirror of the Gentoo repository under the remote name "upstream".
{{Cmd|git clone -o upstream git@github.com:gentoo/gentoo.git}}
Fork the [https://github.com/gentoo/gentoo Gentoo repository on GitHub] and then add it under the remote name "github" to your local repository. [[File:Github fork.png|frameless|right]]

{{Cmd|git remote add github <YOURURLHERE>}}

=== OR ===

=== Step 0: using git as the main portage tree ===
{{rootCmd|mkdir /etc/portage/repos.conf/}}
{{rootCmd|vim /etc/portage/repos.conf/gentoo.conf}}
Add the folowing to the file:
    [gentoo]
    location = /usr/portage
    sync-type = git
    sync-uri = https://github.com/gentoo/gentoo.git
    auto-sync = yes
    sync-user = portage:portage

{{rootCmd|vim /etc/portage/repo.postsync.d/99-user-dev-perms}}
Add the following, changing <dev_user_name>.
    #!/bin/bash
    USER_NAME=<dev_user_name>
    find /usr/portage/ -type d -exec setfacl -m u:$USER_NAME:rwx {} \;
    find /usr/portage/ -type f -exec setfacl -m u:$USER_NAME:rw {} \;
    find /usr/portage/.git -type d -exec setfacl -m u:$USER_NAME:rwx {} \;
    find /usr/portage/.git -type f -exec setfacl -m u:$USER_NAME:rw {} \;
{{rootCmd|chmod +x /etc/portage/repo.postsync.d/99-user-dev-perms}}

Then sync the tree.
{{rootCmd|emerge --sync}}

Fork the [https://github.com/gentoo/gentoo Gentoo repository on GitHub] and then add it under the remote name "github" to your local repository. [[File:Github fork.png|frameless|right]]

Add your remote fork you created under the remote name "github" to your local repository.

=== Step 1: set up the repo's config ===
{{Cmd
|cd <overlay_path>
|git remote add github <YOURURLHERE>
|git config --local user.name "Your Full Name"
|git config --local user.email "example@domain.tld"
|git config --local pull.ff only
|git config --local pull.rebase preserve
|git config --local push.default simple}}

=== Step 2: GPG Configuration ===
{{Cmd|vim ~/.gnupg/gpg.conf}}
Add the following:
    keyserver hkps://hkps.pool.sks-keyservers.net
    keyserver-options ca-cert-file=/usr/share/gnupg/sks-keyservers.netCA.pem
    keyserver-options no-honor-keyserver-url
    cert-digest-algo SHA512
    default-preference-list SHA512 SHA384 SHA256 SHA224 AES256 AES192 AES CAST5 ZLIB BZIP2 ZIP Uncompressed
Now to generate the key:
{{Cmd|gpg --full-generate-key}}
    Select the algorithm
    Set the key size
    Specify how long the key should be valid (No more then 5 years)
    Confirm the information is correct
    Set your name
    set your email
    Set your passphrase, and confirm it.
It might take some time if you've chosen a high bit length key.<br>
<br>
Upload your key to the keyserver.
{{Cmd|gpg --keyserver pool.sks-keyservers.net --send-key example@domain.tld}}
To get your GPG key run this command.  It should be the top line (starting with pub).  If you have more than one key with the UID you will need to select the correct key yourself (from the list of returned keys).

{{Cmd|gpg --list-public-keys --keyid-format 0xlong example@domain.tld}}

You want the keyID from the line that starts with 'pub' and what is after the algorithm and the / eg:
     pub   rsa4096/0x000000000000000

{{Cmd|git config --local user.signingkey 0x000000000000000
|git config --local commit.gpgsign 1
|git config --local push.gpgsign 0}}

=== Step 3: User updates the local repository ===
[[File:Circular workflow step1.png|200px|frameless|right]]
Say you are making changes to package app-foo/bar.  Create a local branch with your changes:
{{Cmd|git checkout -b app-foo/bar master}}
Make your changes and make sure to run [[repoman]] to check for basic errors:
{{Cmd|repoman -dx full}}
Then commit your changes (if you're closing some bugs on Bugzilla, you can mention them here as suggested by [https://www.gentoo.org/glep/glep-0066.html#commit-messages GLEP66]):
{{cmd|repoman ci}}

=== Step 4: User makes a pull request ===
[[File:Circular workflow step2.png|200px|frameless|right]]
Now that you've made your changes and updated your local branch, it's time to send it off to GitHub and make a PR (Pull Request) to the Gentoo Developers.

Start by pushing the branch with your changes to your GitHub repository:
{{Cmd|git push github app-foo/bar}}
Then [https://help.github.com/articles/creating-a-pull-request/ create a pull request] from your GitHub repository's local branch to the Gentoo repository's master branch.
When your changes have been merged, you may delete your local repository's branch with:
{{Cmd|git branch -d app-foo/bar}}

=== Step 5: Developer fetches the PR and reviews ===
[[File:Circular workflow step3.png|200px|frameless|right]]

{{Cmd|curl -s -L "https://github.com/gentoo/gentoo/pull/1.patch" &#124; git am -s -S|prompt=dev $}}
{{Cmd|repoman full -x|prompt=dev $}}
{{Cmd| # tests|prompt=dev $}}

=== Step 6: Developer merges to the tree ===
[[File:Circular workflow step4.png|200px|frameless|right]]

{{Cmd|git push --signed origin master|prompt=dev $}}

=== References ===
https://www.gentoo.org/glep/glep-0066.html<br>
https://wiki.gentoo.org/wiki/Gentoo_git_workflow<br>
https://wiki.gentoo.org/wiki/Gentoo_GitHub<br>
https://www.gentoo.org/glep/glep-0063.html<br>
https://wiki.gentoo.org/wiki/Project:GitHub/Pull_requests<br>
