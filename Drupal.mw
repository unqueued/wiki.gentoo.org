{{InfoBox stack
|{{InfoBox homepage|http://drupal.org|header=true}}
|{{InfoBox wikipedia}}
|{{InfoBox ohloh}}
}}

'''Drupal''' is a powerful [[PHP]] content management system (CMS).

== Preinstall ==

The Drupal package installs everything you need except a database server. 
However, some configuration is best done before installing. And some 
packages might be used for more things than Drupal and hence should be 
installed separately.

=== USE flags ===

If you plan to use the default webserver, Apache 2, edit {{Path|/etc/portage/make.conf}} 
and add "apache2" to your USE flags.
{{FileBox|filename=/etc/portage/make.conf|title=Portage configuration file|1=
USE="... apache2 ..."
}}

Then add the needed USE flags for PHP. Edit {{Path|/etc/portage/package.use}} and 
add "gd mysql mysqli pdo" to the PHP specific USE flags.
{{FileBox|filename=/etc/portage/package.use|title=Portage configuration file|1=
dev-lang/php gd mysql mysqli pdo
}}
If you plan to use PostgreSQL instead of the default MySQL / MariaDB, add "postgres.

=== Packages === 

You must install a database server unless you are planning to use an already existing
(remote) server. Use [[MariaDB]] (or [[MySQL]]) 
{{Emerge|dev-db/mariadb}}

If you plan to use a webserver for other things than Drupal, install it separately.
{{Emerge|www-servers/apache}}
if you want to use [[Apache]]. 

If you need [[PHP]] for other web applications, install it separately too.
{{Emerge|dev-lang/php}}

PS! To enable PHP in Apache, edit {{Path|/etc/conf.d/apache2}} and add 
<code>-D PHP</code> to your <code>APACHE2_OPTS</code> line. You might 
also want to check out PHP_TARGETS

=== Controlling your LAMP stack ===

Start up your LAMP stack
{{RootCmd|rc-service mysql start}}
{{RootCmd|rc-service apache2 start}}

Set the LAMP stack to start upon boot
{{RootCmd|rc-update add mysql default}}
{{RootCmd|rc-update add apache2 default}}

If you use systemd, modify the commands above.

== Install ==
=== Unmask ===

At the time of writing, {{Package|www-apps/drupal}} is masked as experimental only. If you run a "stable" system, you'll have to add it to your {{Path|/etc/portage/package.keywords}}.
{{FileBox|filename=/etc/portage/package.keywords|title=Portage configuration file|1=
www-apps/drupal
}}

=== Emerge ===
Now we can get on with emerging:

{{Emerge|drupal}}

You will have to run webapp-config manually.

{{RootCmd|webapp-config -h localhost -u root -d / -I drupal 8.4.2}}

you may change localhost to the hostname of your virtual host/website.

== Database ==
=== Mysql ===

{{important|change the dbpass to your own password}}

{{RootCmd
|mysql -u root -p
|output=<pre>
mysql> CREATE DATABASE IF NOT EXISTS `drupal` DEFAULT CHARACTER SET `utf8` COLLATE `utf8_unicode_ci`;
mysql> CREATE USER 'drupal'@'localhost' IDENTIFIED BY 'dbpass!!! change me';
mysql> GRANT LOCK TABLES, SELECT, INSERT, UPDATE, DELETE, CREATE, DROP, INDEX, ALTER ON `drupal`.* TO 'drupal'@'localhost' IDENTIFIED BY 'dbpass!!! change me';
mysql> \q
</pre>}}

== Web Install ==

if you are using apache 2.4 or newer run this sed command once.

{{RootCmd|sed -i 's\Order allow,deny\Require all granted\' /var/www/localhost/htdocs/drupal/.htaccess}}

point your browser to http://localhost/drupal/install.php

== Maintenance Mode Access ==
If you suddenly find your self locked out of your drupal cms because it is in maintenence mode:

http://localhost/drupal/user

=== Cron ===
Many Drupal modules have periodic tasks that must be triggered by a cron job. To activate these tasks, you must call the cron page. This will pass control to the modules and the modules will decide if and what they must do.

The following example crontab line will activate the cron script on the hour (you can edit the crontab with crontab -e:

<pre>0 * * * * wget -O - -q http://localhost/drupal/cron.php</pre>

Note: If anyone is having problem with cron job settings, using online cron job like https://www.easycron.com as an alternative is a good idea.

== Installing Drupal modules ==

Installing and configuring modules for Drupal is a lot of fun. You can browse the list at http://drupal.org/project/Modules . Untar the packages to drupal/modules but remember, you have to update the database manually for most modules! Installation instructions come with the tar package.

For example, if you want to install the Daily module, and your user for mysql is drupal:

{{RootCmd|mysql -u drupal -ppassword drupal < daily.mysql}}

[[Category:Web application]]
