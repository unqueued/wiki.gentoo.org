{{InfoBox stack
|{{InfoBox homepage|http://www.samba.org|header=true}}
|{{InfoBox wikipedia|Samba (software)}}
|{{InfoBox gitweb|https://git.samba.org/|raw=true}}
|{{InfoBox guide|Samba}}
|{{InfoBox odoc|https://www.samba.org/samba/docs/man/Samba-HOWTO-Collection/}}
}}

'''Samba''' is a re-implementation of the [[Smbnetfs|SMB/CIFS]] networking protocol, a Microsoft Windows alternative to Network File System ([[NFS]]).

== Installation ==

=== Kernel ===

Activate the following kernel options:
{{KernelBox|title=Enable CIFS|1=
File Systems --->
    [*] Network File Systems --->
        [*] CIFS support (advanced network filesystem, SMBFS successor)--->
            [*] CIFS Statistics
                [*] Extended Statistics
            [*] CIFS Extended Attributes
                [*] CIFS POSIX Extentions
}}

=== Samba ===

==== USE flags ====

{{USEflag|package=net-fs/samba}}

==== Emerge ====

Emerge Samba:

{{Emerge|net-fs/samba}}

Samba can also be installed by setting the global <var>USE</var> flag <code>samba</code> and updating the system:

{{RootCmd|emerge -avtDNu world}}

=== CIFS ===

==== USE flags ====

If the full Samba package is not needed, the {{Package|net-fs/cifs-utils}} package is available:

{{USEflag|package=net-fs/cifs-utils}}

==== Emerge ====

Emerge CIFS:

{{Emerge|cifs-utils}}

== Usage ==

=== Services ===

==== OpenRC ====

When using OpenRC, adding Samba to the default runlevel will enable the Samba service to start when the system boots:

{{RootCmd|rc-update add samba default}}

To start the Samba service now issue:

{{RootCmd|service samba start}}

==== Systemd ====

For systemd users, the Samba service can be configuired to start during boot using {{c|systemctl}}:

{{RootCmd|systemctl enable smbd.service}}

To start the service immediately issue:

{{RootCmd|systemctl start smbd.service}}

=== CIFS share ===

==== Mount the shared content ====

Once the client is fully configured, the shares can soon be accessed.

Create the mount point:

{{RootCmd|mkdir -p /mnt/My-Disk/{Media,Shared} }}

Mount the exported folders:

{{RootCmd|mount.cifs //O2-Foobar/Media /mnt/My-Disk/Media -o guest}}

{{RootCmd|mount.cifs //O2-Foobar/Shared /mnt/My-Disk/Shared -o guest}}

To automatically mount shares on every boot, edit [[fstab|/etc/fstab]] to look like this:

{{FileBox|filename=/etc/fstab|1=
//O2-Foobar/Media  /mnt/My-Disk/Media  cifs guest
//O2-Foobar/Shared /mnt/My-Disk/Shared cifs guest
}}

{{Note|
* In the case of permission problems are encountered when trying to create files and folders on the disk, try to use <code>gid{{=}}<user's_gid>, uid{{=}}<user's_uid></code>
* Be sure to replace <code><user's_gid></code> with the user ID of choice.}}

== Troubleshooting ==

Some problems may occur when trying to mount new CIFS shares. The following sections attempt to provide resolutions to common problems.

=== Cannot resolve <server-name> ===

More specifically, the actual error:

{{RootCmd|mount.cifs ...|output=<pre>
"mount error: could not find target server. TCP name foo/bar not found. No ip
address specified and hostname not found"
</pre>}}

This can easily be fixed by editing {{Path|/etc/nsswitch}} and appending <code>wins</code> next to the <code>hosts</code> entry:

{{FileBox|filename=/etc/nsswitch|1=
hosts: files dns wins
}}

If this does not work, use the NFS server's IP address instead of the O2-Foobar hostname. The <tt>nmblookup</tt> utility (provided by {{Package|net-fs/samba}}) comes in handy when trying to find the IP address of an NFS host:

{{RootCmd|nmblookup O2-Foobar}}

=== Shutdown process hangs when trying to unmount CIFS shares ===
<!-- If you make any changes to this section, please consider changing the appropriate section in [[NFS]] as well. -->

If the system shutdown hangs at 
<div class="cmd-box"><div><code> <span style="color:#54ff54">*</span> Unmounting network filesystems ...</code></div></div>
then users must make sure the CIFS shares are unmounted properly before [[udev]] tries to stop. One way to work around this is to create [[local.d]] scripts to unmount the CIFS filesystems:

{{RootCmd
|echo "umount -a -t cifs -f" > /etc/local.d/cifs.stop
|chmod a+x /etc/local.d/cifs.stop}}

=== Windows asking for passwords ===

<pre>
security = share
</pre>

=== Windows without password ===

When you can't start samba and get this errors ( in my case after upgrade from samba-4.2.9 to samba-4.2.11) :

<pre>
../lib/param/loadparm.c:1082(lp_set_enum_parm)
WARNING: Ignoring invalid value 'share' for parameter 'security'
../source3/smbd/server.c:1256(main)
error opening config file '/etc/samba/smb.conf'
</pre>

Change global security to:

<pre>
security = user 
</pre>

To keep windows users access without username/password:

<pre>
map to guest = bad user
</pre>

=== Emerge wants to downgrade to Samba 3 because of FFmpeg dependency ===

This is probably caused by enabling <code>abi_x86_32</code> on {{Package|media-video/ffmpeg}}, which isn't supported on Samba 4. Since Samba support is rarely needed by {{Package|media-video/ffmpeg}} (in the typical use case, the media player itself handles media files served over smb), the <code>samba</code> USE flag can be disabled for {{Package|media-video/ffmpeg}} without losing essential functionality.

== See also ==

* [[Security Handbook/Securing_services#Samba|Samba (Security Handbook)]] - The Security Handbook's entry on how to secure a system running Samba.
* [[Samba/Samba 4 Migration|Samba 3 migration to Samba 4 guide]] - A well written guide on migrating from Samba 3 to Samba 4.
* [[Smbnetfs]]
* [[SSHFS]]

== External resources ==

* [http://www.samba.org/samba/docs/man/Samba-Guide/ Practical Exercises in Successful Samba Deployment]
* [http://www.samba.org/samba/docs/man/Samba-HOWTO-Collection/ Samba Howto Collection]
* [http://www.samba.org/samba/GUI/ Samba GUI]

[[Category:Software]]
[[Category:Daemons]]
