{{InfoBox stack
|{{InfoBox homepage|http://www.freedesktop.org/wiki/Software/PulseAudio|header=true}}
|{{InfoBox wikipedia}}
|{{InfoBox gitweb|http://cgit.freedesktop.org/pulseaudio/pulseaudio/|raw=true}}
}}

'''PulseAudio''' (or '''PA''' for short) is a sound server that provides a number of features on top of the low-level audio interface [[ALSA]] on Linux, such as:

* Networking support (P2P and server mode);
* Per-application volume controls;
* Better cross-platform support;
* Dynamic latency adjustment, which can be used to save power

__TOC__

== Installation ==

=== Prerequisites ===

PulseAudio uses:

* [[Udev|sys-fs/udev]] and [[ConsoleKit|sys-auth/consolekit]] or
* [[Systemd|sys-apps/systemd]]

=== Kernel ===

For motherboards containing Intel HDA sound cards, use the following kernel option for improved power-saving:
{{KernelBox|1=
Device Drivers  --->
    <*> Sound card support  --->
        <*> Advanced Linux Sound Architecture  --->
            HD-Audio  --->
                (2048) Pre-allocated buffer size for HD-audio driver
}}

=== Software ===

Portage knows the <code>pulseaudio</code> as a global USE flag for enabling support for PulseAudio in other packages. Enabling this USE flag will pull in {{Package|media-sound/pulseaudio}} automatically:

{{FileBox|filename=/etc/portage/make.conf|lang=bash|1=
USE="pulseaudio"
}}

{{USEflag|package=media-sound/pulseaudio}}

=== Emerge ===

After setting USE flags be sure to update the system so the changes take effect:
{{Emerge|params+=--changed-use --deep|@world}}

=== Addons ===

* {{Package|media-sound/pavucontrol}} - Pulseaudio Volume Control, a GTK+ based mixer for PulseAudio.
* {{Package|media-sound/paprefs}} - PulseAudio Preferences, a configuration dialogue for PulseAudio.
* [[KDE]]'s Phonon integrated PulseAudio configuration and mixing, but it is not as powerful as pavucontrol or paprefs.

== Configuration ==

=== Permissions ===

{{Note|This is the only supported configuration by upstream and Gentoo developers.}}

PulseAudio uses [[udev]] and [[ConsoleKit]] to dynamically give access to the soundcards to the currently "active" nr. When running [[Systemd]] this will be handled without needing [[ConsoleKit]]. 

To make this possible, ACLs (Access Control  Lists) are required:

{{KernelBox|1=
File systems  --->
   Pseudo filesystems  --->
      [*] Virtual memory file system support (former shm fs)
      [*]   Tmpfs POSIX Access Control List
}}

If a ''desktop'' [[Profile (Portage)|profile]] is not being used, check that {{Package|sys-auth/consolekit}} or {{Package|sys-apps/systemd}} are installed with the <code>acl</code> USE flag enabled. ConsoleKit should be running on systems using [[OpenRC]] as the init system:

{{RootCmd|/etc/init.d/consolekit status|output=<pre>
* status: started
</pre>}}

If not, enable it at boot time:

{{RootCmd|rc-update add consolekit default}}

When finished, verify the permissions are working correctly:
{{Cmd|getfacl /dev/snd/controlC0 {{!}} grep -Eo "user:.+:"  {{!}} cut -d: -f2|output=
<YOUR_USERNAME>
}}

{{Important|For ConsoleKit/Systemd Logind managed permissions to be respected, '''no one may be part of the ''audio'' group''' (not even even the user pulse). Remove any and all users from the audio group:
{{RootCmd|gpasswd -d <user> audio}}
}}

=== Configuring other applications ===

Some applications need to be configured to output to PulseAudio by default. A detailed list of these can be found on the PulseAudio wiki's [http://www.freedesktop.org/wiki/Software/PulseAudio/Documentation/User/PerfectSetup PerfectSetup page].

;ALSA

{{Note|If you previous had followed this article, upon upgrade to a fixed version (there should also be an einfo reminder), please remove the {{Path|asound.conf}} file.}}

The {{Package|media-plugins/alsa-plugins}} must be installed with the <code>pulseaudio</code> USE flag enabled:

{{Emerge|media-plugins/alsa-plugins}}

;[[OSS]]
You need to enable the following module in {{Path|/etc/pulse/default.pa}}:

{{FileBox|filename=/etc/pulse/default.pa|1=
load-module module-oss
}}

;GStreamer
Several GConf keys must be set:

* You can use the graphical tool gstreamer-properties (part of {{Package|gnome-extra/gnome-media}}). Select under '''Audio Input''' and '''Audio Output''' each '''PulseAudio Sound Server'''.
* Manual with {{c|gconftool}}:

{{Cmd
|gconftool-2 -t string --set /system/gstreamer/0.10/default/audiosink pulsesink
|gconftool-2 -t string --set /system/gstreamer/0.10/default/audiosrc pulsesrc
}}

{{Note|Some programs might still require GStreamer output plugin to be manually set to PulseAudio Audio Sink.}}

;ESD
Enable the following module in {{Path|/etc/pulse/default.pa}}:

{{FileBox|filename=/etc/pulse/default.pa|1=
load-module module-protocol-esound-unix
}}

Also {{c|eselect}} the PulseAudio implementation:

{{RootCmd|eselect esd set esdcompat}}

;libao
Set the following in {{Path|/etc/libao.conf}}:

{{FileBox|filename=/etc/libao.conf|1=
default_driver=pulse
}}

;OpenAL
Set the following in {{Path|/etc/openal/alsoft.conf}}:

{{FileBox|filename=/etc/openal/alsoft.conf|1=
drivers = pulse
}}

;[[MPlayer]]
Set the following in {{Path|/etc/mplayer/mplayer.conf}}:

{{FileBox|filename=/etc/mplayer/mplayer.conf|1=
ao=pulse
}}

=== Without udev/systemd ===

{{Warning|Using PulseAudio without udev/systemd is '''not''' recommended. It should be noted that this not only breaks auto-detection but hot-plugging as whole needlessly making your life harder as well as disabling use of ConsoleKit essentially voiding the article. Please, if you have the possibility to use udev (and you most certainly have), just use it.}}

In case that you are using ALSA as a PulseAudio sink (output) and routing ALSA apps to PA but not using udev, you must make sure to have set a specific device to be used. Else, PulseAudio will use ALSA device "default" as sink which may be routed back to PulseAudio, forming a loop. To avoid this, add the parameter ''device=hw:0,0'' (you can find the correct IDs by running ''aplay -l''). In the following example, we use two soundcards, of which card 0, device 0 is used as a sink (audio output, e.g. speakers) and card 1, device 0 as a source (audio input, e.g. microphone). PulseAudio will still be able to access other cards than these but it needs these settings to avoid looping the ''default'' device in this setup.

{{FileBox|filename=/etc/pulse/default.pa|title=Using a specific ALSA device as PulseAudio sink/source|1=
load-module module-alsa-sink device=hw:0,0
load-module module-alsa-source device=hw:1,0
}}

{{Note|If you forget to specify this when using the ALSA sink/source modules, you may not notice any problems until you restart PulseAudio (e.g. by logging out and back in or rebooting). You will be left with (obviously) no audio and a slowed down desktop environment and hanging applications until you resolve the loop, restart alsasound and kill all running pulseaudio processes.}}

=== Headless server ===
 	
{{Dated|section}}

These instructions are for setting up a headless pulse audio server. Meaning a server which has no display on it but does have speakers. This provides the ability to use the remote server's speakers for audio output.

You will get warned in a dozen places for doing this, but it is the proper method.

==== Server ====

First configure USE flags and emerge the package. The system-wide USE flag is masked, so we have to unmask it.

{{RootCmd|mkdir -p /etc/portage/profile|echo "-system-wide" >> /etc/portage/profile/use.mask|echo "media-sound/pulseaudio system-wide" >> /etc/portage/package.use}}

{{Emerge|params+=--oneshot|pulseaudio}}

Add the following two lines somewhere in the system.pa file:

{{FileBox|filename=/etc/pulse/system.pa|1=
load-module module-native-protocol-tcp auth-ip-acl=1.2.3.0/24
load-module module-alsa-sink
}}

''Replace 1.2.3.0/24 with the network mask that you want to be able to access the server.''

{{Note|If you have multiple ALSA devices, you will need to specify the device to use by adding <u>device</u> or <u>device_id</u> to the module-alsa-sink module}}

Tell the init script that we really do want to do this, and then start it up:

{{RootCmd
|echo "PULSEAUDIO_SHOULD_NOT_GO_SYSTEMWIDE{{=}}1" >> /etc/conf.d/pulseaudio
|rc-update add pulseaudio default|rc-service pulseaudio start
}}

==== Client ====

{{Cmd|pacmd load-module module-tunnel-sink server{{=}}1.2.3.4|output=server (1.2.3.4) is the IP of the server.}}

For a more permanent solution you can add the following to your default.pa file
{{FileBox|filename=/etc/pulse/default.pa|1=
load-module module-tunnel-sink server=1.2.3.4
}}

Now in the pulse audio volume control you should see the remote server listed under <u>Output Devices</u>. Under playback you should have a button next to the ''Mute audio'' button that when clicked will let you switch that audio stream to whichever output you want.

=== Equalizer ===

{{Note|The equalizer module is considered unstable and might be removed from pulseaudio. For more, see [http://lists.freedesktop.org/archives/pulseaudio-discuss/2014-March/020174.html the mailing list].}}

Make sure you installed pulseaudio with the <code>equalizer</code> USE flag enabled.

==== Enabling the required modules ====

Add the following two lines somewhere in the default.pa file :

{{FileBox|filename=/etc/pulse/default.pa|1=
load-module module-dbus-protocol
load-module module-equalizer-sink
}}

Restart the pulseaudio instance. This should be as easy as:

{{cmd|pulseaudio -k |pulseaudio --start}}

==== Choosing the equalizer sink ====

The command should list the index and name of the equalizer sink:

{{cmd|pacmd list-sinks <nowiki>|</nowiki> grep -B1 -e "name:.*equalizer"}}

Use {{c|pavucontrol}} or a similar program to select the equalizer sink for sound output. It may be listed as a device starting with ''FFT based equalizer''.

==== Control the equalizer levels ====

The equalizer levels can now be controlled with the Qt GUI called {{c|qpaeq}}.

==== Known issues ====

* Short sound events (e.g. the terminal bell) distort ongoing sound streams (e.g. music)

== Troubleshooting ==

* {{Bug|pulseaudio|search=package}}
* {{Bug|PulseAudio|site=fdo|search=product}}

=== No sound after installation ===

If you have no sound while using ALSA, consider unmute the sound card. Launch alsamixer and make sure each column has a green 00 under it (Use m to toggle mute/unmute). Install pavucontrol and check if there is any output on the pavucontrol panel when playing an audio.

=== Enable debug mode ===

To get more informations you need to set the following in {{Path|/etc/pulse/daemon.conf}}:

{{FileBox|filename=/etc/pulse/daemon.conf|1=
log-level=debug
}}

Afterward restart the daemon:

{{Cmd|pulseaudio -k}}

=== Audio/Video out of sync ===

When using PulseAudio over your local network, you can experience out-of-sync problems. Solve this by adding '''tsched=0''':

{{FileBox|filename=/etc/pulse/default.pa|1=
load-module module-udev-detect tsched=0
}}

This disables time scheduling. Afterwards restart the daemon:

{{Cmd|pulseaudio -k}}

=== Dummy output ===

If the only playback device is the '''Dummy Output''', PulseAudio can not access your sound devices. Either the user has no permissions (see section [[#Permissions|Permissions]] or another program blocks the access. Try:

{{Cmd|fuser -v /dev/snd/*}}

It shows the relevant program. Close the program and reconfigure it to use PulseAudio.

=== No guarantees on actual latencies ===

Currently PA provides whatever latency at that moment is possible be it some milliseconds to hundreds of milliseconds without regard to what applications ask for.

=== In case of buffer under-run latencies are never decreased ===

Currently, if a buffer under-run occurs, PA buffers for longer increasing latency, but it then never tries to buffer for less until restart.

=== Re-sampling using up a lot of CPU time ===

Re-sampling can require quite a lot of computational power, PA defaults are rather conservative but in certain cases can still take a significant toll, in such cases edit {{Path|/etc/pulse/daemon.conf}} and consider changing ''resample-method'' to something less CPU intensive, ''default-sample-format'' and ''default-sample-rate'' can also affect CPU utilization with higher bit-depth and larger difference in sample-rate generally needing more resources (e.g. re-sampling 44.1 kHz to 48 kHz is faster than re-sampling either to 192 kHz). Since re-sampling is done per each channel per input, channel configuration and number of applications can affect performance as well.

Starting with version 7.0 there is also soxr resamplers made available by enabling the ''sox'' USE flag. In particular ''resample-method = soxr-mq'' should provide acceptable quality while even the higher quality and hence slower soxr-hq is still cheaper than the default speex-float-1. But be warned that the soxr resamplers have roughly 5-20 times higher latency than speex-float, in terms of time the worst case for soxr-mq/hq can be as high as 20 ms while soxr-vhq latency can in few specific setups reach over 27 ms. In terms of feeling 20 ms can range from unnoticeable to irritating depending on person and use case (the usual PA latency's lower bound is around 20-25 ms and more commonly often around 70-90 ms, for comparison).

{{Note|Using a version of PA with Orc support can noticeably decrease CPU usage, too. Also PA has the ability, if certain conditions are met, to automatically switch sinks between common sampling rates, this effectively can avoid some re-sampling.}}

=== FAQ ===

See [http://www.freedesktop.org/wiki/Software/PulseAudio/FAQ#Troubleshooting PulseAudio's Frequently Asked Questions].

== External resources ==

* [http://www.freedesktop.org/wiki/Software/PulseAudio/Documentation/User/PerfectSetup PulseAudio: The Perfect Setup]
* [http://www.linux.com/news/hardware/drivers/8100-why-you-should-care-about-pulseaudio-and-how-to-start-doing-it Why you should care about PulseAudio (and how to start doing it)]
* [https://wiki.archlinux.org/index.php/PulseAudio#Troubleshooting More general troubleshooting tips]

[[Category:Multimedia]]
[[Category:Daemons]]
