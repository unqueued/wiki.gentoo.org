<languages />
{{InfoBox stack
|{{InfoBox homepage|https://www.cups.org/|header=true}}
|{{InfoBox wikipedia|CUPS}}
|{{InfoBox github|apple/cups}}
}}
{{Metadata|abstract=このドキュメントでは、CUPSとSambaを用いたプリンタのインストールとメンテナンスをカバーしています。これは、ローカルインストールやネットワークインストールをカバーし、他のオペレーティングシステムから共有プリンタを使用する手順が含まれています。}}

このドキュメントでは、CUPSとSambaを用いたプリンタのインストールとメンテナンスをカバーしています。これは、ローカルインストールやネットワークインストールをカバーし、他のオペレーティングシステムから共有プリンタを使用する手順が含まれています。印刷文書のための{{c|lp}}または{{c|lpr}}コマンドを使用しての詳細については、[https://www.cups.org/doc/options.html CUPS' 優れた上流のマニュアル]を参照してください。

== 印刷と Gentoo Linux ==

=== 適切なツールを使う ===

Linuxは、プリンタの素晴らしいサポートを持っています。仕事のための適切なツールはCUPSと呼ばれている([http://www.cups.org Common Unix Printing System])。プロジェクトが始まった1999年から、CUPSのインストールとメンテナンスは劇的に改善されました。 

この文書では、セットアップにローカルまたはネットワークプリンタをCUPSを使用する方法を説明します。プロジェクトがより進んだ使用法に関する
[http://www.cups.org/documentation.php 素晴らしいドキュメント]を持っているので、それはあまりにも多くの詳細を行くことはありません。 

== インストール ==

=== カーネル ===

ユーザーがシステムにプリンタをインストールしたい場合、最初のステップは、プリンタがシステムに接続する方法を知ることです。それは、LPTやUSBなどのローカルポートを介して接続されていますか？それがネットワーク接続されている場合は、それがインターネット印刷プロトコル（IPP）またはMicrosoft Windows CIFSプロトコル（Microsoft Windowsの共有）を使用していますか？ 

次のいくつかのセクションでは、最小限のカーネルコンフィギュレーションは、Gentooに接続されたプリンタを取得するために必要なものについて説明します。もちろん、これは''どのように''プリンタは便宜のための命令が分離されているので、システムに接続されようとしているに依存します。

{{Path|/usr/src/linux}}に移動し、カーネルコンフィグに入るために{{c|make menuconfig}}を実行します。カーネルの設定に{{c|genkernel}}を使用した場合でも、誤りがないか確認するため、これらのステップを行うべきです。genkernelにシステム全体を自動的に設定させて頼らないようにしてください;印刷は、構成設定を自動的に設定することが難しい分野です。

次の設定例では、必要なサポートをモジュールではなくカーネルの''中に''追加しています。カーネルをこの方法で構築することは必須ではありません;もしモジュールでのサポートを簡単に追加できると判断したならば、適切なモジュールを読み込むのを忘れないようにしましょう！ 

それでは、カーネルを設定(あるいはチェック)するため、適切な項に移動してください。

==== ローカルで接続されたプリンタ (LPT) ====

LPTポートは、パラレルプリンターポートを表すために一般的に使用されています。まず、パラレルポートのサポートを有効化し、それから(SPARCシステムを使っているのでなければ)PC形式のパラレルポートのサポートを有効化する必要があります。そしてその後、パラレルプリンターサポートを有効にします。 

{{KernelBox|title=パラレルポートプリンタの設定|<pre>
Device Drivers -->
  <*> Parallel port support
  <*> PC-style hardware
  [*] IEEE 1284 transfer modes
  Character Devices -->
    <*> Parallel printer support
</pre>
}}

{{Note|ユーザーによっては、<code>Parallel port support</code>セクションの中の、その他のオプションを有効化するかもしれません。詳しくは、カーネルコンフィグの<code>Help</code>機能をチェックしてください。}}

これで終わりです！ カーネルコンフィグを終了して、[[Kernel/Rebuild|カーネルを再ビルドしてください]]。

CUPSの設定を続けて行いましょう。

==== ローカルで接続されたプリンタ (USB) ====

USBでの印刷は、[[#インストール|USB USEフラグが有効化された]]CUPSでサポートされています。これは、libusbライブラリをユーザースペースでのUSBサポートのため使用しています。

いくつかの古いソフトウェアは、今でもカーネル内でのUSBプリンターサポートを要求します。モジュールとしてビルドされた場合、そのモジュールは{{Path|usblp}}と呼ばれます:

{{KernelBox|title=USB プリンタサポート|1=
Symbol: USB_PRINTER [=n]
Type  :tristate
Prompt: USB Printer support
  Location:
    -> Device Drivers
      -> USB support (USB_SUPPORT [=y])
(1)     -> Support for Host-side USB (USB [=y])
  Defined at drivers/usb/class/Kconfig:21
  Depends on: USB_SUPPORT [=y] && USB [=y]
}}

しかしながら、カーネル内でのUSBプリンターサポートは、[https://forums.gentoo.org/viewtopic-t-1053530-start-10.html obsolete扱い]です。必要な場合に限り、使用を続けてください。

==== リモートで接続されたプリンタ (IPP と LPD) ====

Internet Printing Protocol、あるいは[[wikipedia:Line_Printer_Daemon_protocol|Line Printer Daemon protocol]]を通じてリモートで接続されたプリンターに接続可能にするには、カーネルのネットワークサポートが必要です。カーネルには既にそれがあると仮定して、CUPSの設定を続けます。

==== リモートで接続されたプリンタ (CIFS) ====

カーネルが[[Samba/Guide#Mounting_a_Windows_or_Samba_share_in_GNU.2FLinux|CIFSをサポート]]している必要があります: 

{{KernelBox|title=CIFS プリンタの設定|<pre>
File systems -->
  Network File Systems -->
    <*> CIFS support (advanced network filesystem, SMBFS successor) 
</pre>
}}

CIFSの設定が完了したら、カーネルコンフィグを終了してカーネルを再ビルドします。システムを再起動する前に、(必要なら{{Path|/boot}}をマウントしてから)新しいカーネルイメージを{{Path|/boot}}へコピーし、ブートローダーの設定を更新するのを忘れないようにしましょう。これらのステップをどのように実行するかについては、上の'''LPTプリンターの設定'''にあるrootコマンドを参照してください。

それでは、CUPSのインストールにおける次のステップに進みましょう。

==== USE フラグ ====

CUPSには、いくつかの関心を持つかもしれない任意の機能があります。それらの機能を有効化あるいは無効化するには、それらに関連付けられたUSEフラグを利用します。

{{USEflag|package=net-print/cups}}

現在のUSEフラグの設定を確認します。CUPSのみについて現在のUSEの設定から外すには、適切なUSEフラグを{{Path|/etc/portage/package.use}}ファイルに追加します。 

{{RootCmd|emerge -pv net-print/cups|output=<pre>
[ebuild N     ] net-print/cups-1.7.3  USE="X acl dbus pam ssl threads usb -debug -gnutls -java -kerberos -lprng-compat -python (-selinux) -static-libs -systemd -xinetd -zeroconf" ABI_X86="(64) (-32) (-x32)" LINGUAS="ca es fr it ja pt_BR ru" PYTHON_SINGLE_TARGET="python2_7" PYTHON_TARGETS="python2_7" 0 kB
</pre>}}

=== Emerge ===

結果に満足したら、PortageにCUPSをインストールするよう要求します:

{{Emerge|net-print/cups}}

=== 追加のソフトウェア ===

SAMBAサポートを有効にするには、{{Package|net-fs/samba}}がCUPSサポートとともにインストールされている必要があります。{{Path|/etc/portage/package.use}}ファイルまたはディレクトリを更新して、<code>cups</code> USEフラグを有効にします:

{{FileBox|filename=/etc/portage/package.use|title=samba で、cups の USE フラグを有効にする|1=
net-fs/samba cups
}}

そして、Sambaを(再)インストールします:

{{Emerge|net-fs/samba}}

== 設定 ==

=== 印刷グループ ===

印刷をする必要があるすべてのユーザーは、<code>lp</code>グループに追加されていなければなりません:

{{RootCmd|gpasswd -a username lp}}

CUPSのウェブインターフェースを使ってプリンターを追加したり編集したりするためには、これらの設定を編集することが許可されているすべてのシステムユーザーがlpadminグループに所属していなければなりません:

{{RootCmd|gpasswd -a username lpadmin}}

=== サービス ===

==== OpenRC ====

プリンターがシステムにローカルで接続されており、かつプリンターがブートの度に利用可能でなければならない場合には、CUPSデーモンが起動時に自動的に読み込まれる必要があります。CUPSデーモンを開始する前に、プリンターが接続され、電源が入っていることを確認してください。 

{{RootCmd
|service cupsd start
|rc-update add cupsd default
}}

==== systemd ====

CUPSデーモンを直ちに開始し、またシステムが起動したときに開始されるようにするには:

{{RootCmd
|systemctl start cups.service
|systemctl enable cups.service
}}

=== HTTP インターフェース ===

サービスがいったん開始されると、認証されたユーザーはプリンターを追加することができます。root(デフォルト)およびlpadminグループのすべてのユーザーが利用可能です。ウェブブラウザーで以下のURLを開いてください:

http://localhost:631/

=== ファイル ===

{{Path|/etc/cups/cupsd.conf}}にあるデフォルトのCUPSサーバー設定は、ほとんどのユーザーにとって十分です。しかしながら、一部のユーザーはCUPSの設定に変更を加える必要があるでしょう。

次の項では、しばしば必要になるいくつかの変更を扱います: 

* 他のシステムに、このLinuxワークステーションに接続されているプリンターの使用を許可する。
* リモートシステムからCUPS管理へのアクセスを許可する。
* CUPSを、Windows PCLドライバーをサポートするように設定する。これは、WindowsシステムがSAMBAで共有されたプリンターを使用する場合に推奨されます。WindowsのドライバーのほとんどはPCLドライバーです。
* このシステムを、他のシステムに接続されたプリンターを(Windows共有でなく)使用するように設定する。

=== リモートでのプリンターアクセス ===

IPPを通じて他のシステムにプリンターを使用させるには、{{Path|/etc/cups/cupsd.conf}}ファイルでプリンターへの明示的なアクセスを許可する必要があります。SAMBAを使用してプリンターを共有する場合には、この変更は不要です。 

お好みのテキストエディターで{{Path|/etc/cups/cupsd.conf}}を開き、プリンターに到達できる必要があるシステムについて<code>Allow</code>行を追加します。次の例では、localhostおよびIPアドレスが<code>192.168.0</code>で始まるすべてのシステムからプリンターへのアクセスを許可しています。 

{{FileBox|filename=/etc/cups/cupsd.conf|title=プリンターへのリモートアクセスを許可する|lang=apache|1=
<Location />
  Order allow,deny
  Allow localhost
  Allow from 192.168.0.*
</Location>
}}

この行は、ネットワークのクライアントに対してブラウジング情報をブロードキャストします;これにより、プリンターが利用可能な時にネットワークユーザーに通知がなされます:

{{FileBox|filename=/etc/cups/cupsd.conf|title=情報をブロードキャストする|lang=apache|1=
BrowseAddress 192.168.0.*:631
}}

ネットワーク上の他のマシンからの印刷リクエストに反応するため、CUPSがリッスンするポートも指定する必要があります:

{{FileBox|filename=/etc/cups/cupsd.conf|title=ポートの設定|lang=apache|1=
Listen *:631
#Listen localhost:631
}}

{{Note|CUPS 1.1(現在は非推奨)を使用している場合、リモートの印刷リクエストのためには異なる構文が必要です:
{{CodeBox|title=非推奨のCUPS 1.1での設定|1=
Port 631
(以下の2行がコメントアウトされていることを確認してください)
#Listen 127.0.0.1:631
#Listen localhost:631
}}
}}

=== CUPSのリモート管理 ===

リモートでの管理が必要なら、localhostだけでなく、それ以外のシステムからCUPSの管理画面へのアクセスを許可する必要があるでしょう。{{Path|/etc/cups/cupsd.conf}}を編集し、アクセスを必要とする各システムに対して明示的にアクセスを許可します。たとえば、IPアドレスが192.168.0.3であるシステムに対してアクセスを許可するには: 

{{FileBox|filename=/etc/cups/cupsd.conf|title=リモートアクセスを許可する|lang=apache|1=
<Location /admin>
(...)
  Encryption Required
  Order allow,deny
  Allow localhost
  Allow 192.168.0.3
</Location>
}}

{{Path|/etc/cups/cupsd.conf}}に変更を加えた後、{{c|/etc/init.d/cupsd restart}} コマンドを実行してCUPSデーモンを再起動することを忘れないでください。 

=== Windows PCLドライバーのサポートを有効化する ===

PCLドライバーは、生の(raw)データをプリントサーバーに送信します。CUPSでraw印刷を有効にするには、{{Path|/usr/share/cups/mime/mime.types}}を編集して、もしまだアンコメントされていなければ、<code>application/octet-stream</code>という行をアンコメントします。そして、{{Path|/usr/share/cups/mime/mime.convs}}を編集して、もしまだアンコメントされていなければ、同じようにします。 

{{FileBox|filename=/usr/share/cups/mime/mime.types|title=raw 印刷サポートを有効にする|1=
application/octet-stream
}}

{{FileBox|filename=/usr/share/cups/mime/mime.convs|1=
application/octet-stream     application/vnd.cups-raw    0    -
}}

これらの変更を加えたら、{{c|/etc/init.d/cupsd restart}}を実行してCUPSデーモンを再起動することを忘れないでください。 

=== リモートのプリンターをセットアップする ===

プリンターがCUPSを使用しているリモートサーバーに接続されている場合、{{Path|/etc/cups/client.conf}}を変更することによってシステムをリモートプリンターを使用するように簡単に設定できます。 

プリンターが<code>printserver.mydomain</code>というシステムに接続されているとすると、お好みのテキストエディターで{{Path|/etc/cups/client.conf}}を開き、<code>ServerName</code>ディレクティブをセットします: 

{{FileBox|filename=/etc/cups/client.conf|1=
# (printserver.mydomain を、あなたのプリントサーバー名に置き換えてください)
ServerName printserver.mydomain
}}

リモートシステムには、使用されるデフォルトのプリンター設定があります。デフォルトのプリンターを変更するには、{{c|lpoptions}}コマンドを使用します。

まず、使用可能なプリンターをリストします:

{{RootCmd|lpstat -a|output=<pre>
hpljet5p accepting requests since Jan 01 00:00
hpdjet510 accepting requests since Jan 01 00:00
</pre>}}

HP LaserJet 5Pをデフォルトのプリンターとしてセットします:

{{RootCmd|lpoptions -d hpljet5p}}

=== プリンターを設定する ===

==== はじめに ====

設定しようとしているプリンターが(CUPSを実行している)異なるプリントサーバーを介して利用可能ならば、以下の説明は不要です。代わりに、[[#リモートのプリンターをセットアップする|リモートのプリンターをセットアップする]]を読んでください。 

==== プリンターの検出 ====

Linuxシステムが起動した時にUSBプリンターやパラレルポートプリンターの電源が入っていれば、カーネルからプリンターを正常に検知したことを表す情報を得ることができるでしょう。これは単にプリンターが検出されたことを表すものに過ぎず、必要条件ではありません。 

{{Cmd|dmesg {{!}} grep -i print|output=<pre>
parport0: Printer, Hewlett-Packard HP LaserJet 2100 Series
</pre>}}

USBプリンターの場合:

{{Cmd|lsusb|output=<pre>
(...)
Bus 001 Device 007: ID 03f0:1004 Hewlett-Packard DeskJet 970c/970cse
</pre>
}}

===== lpinfo =====

{{:Printing/lpinfo}}

利用可能なドライバーをリストするには、以下のコマンドを実行します:

{{RootCmd|lpinfo -m}}

{{c|lpinfo}}は饒舌ではなく、やや使いこなすのが難しいかもしれません。何か問題が起こったら、{{c|man lpinfo}}を見てより詳細な情報を確認してください。

==== プリンターをインストールする ====

プリンターをシステムにインストールするには、ブラウザーを起動して[http://localhost:631 http://localhost:631]を表示してください。あらゆる管理作業が行える、CUPSのウェブインターフェースが表示されるはずです。 

{{Note|インターフェースにアクセスする際に初めてHTTPS接続を使用した場合、ページが表示されるまでに非常に長い時間がかかる''ことがあります''。これは、最初のリクエストによって、時間のかかる処理であるCUPSのSSL証明書の生成が引き起こされるためです。}}

{{Path|Administration}}に移動し、ボックスにrootログインおよびパスワード情報を入力してください。そして、管理インターフェースに入ったら、{{Path|Add Printer}}をクリックします。新しい画面が表示され、以下の情報が入力できるようになります: 

* ''spooler name'' システムでプリンターを識別するのに使われる、短く、しかしわかりやすい名前。この名前には、スペースやあらゆる特殊文字を含めないようにすべきです。たとえば、HP LaserJet 5Pは<code>hpljet5p</code>のように名付けることができます。
* ''location'' プリンターが物理的に設置されている場所の説明(たとえば、"bedroom"(寝室)あるいは"in the kitchen right next to the dish washer"(キッチンの食器洗い機の右隣)など)。これは、複数のプリンターを保守する場合に役立ちます。
* ''description'' プリンターの完全な説明。一般的な使用法は、("HP LaserJet 5P"のような)プリンターのフルネームです。

次の画面では、プリンターがリッスンするデバイスを尋ねられます。複数のデバイスの選択肢が提供されるでしょう。次の表はいくつかの考えられるデバイスを示していますが、リストは網羅的ではありません。

{| class="table table-condensed table-striped" style="text-align: left;" 
|- 
! デバイス
! 説明
|- 
| AppSocket/HP JetDirect
| この特殊なデバイスは、ネットワークプリンターを、HP JetDirectソケットを通じてアクセス可能にします。特定のプリンターのみがこのオプションへのサポートを含みます。
|- 
| Internet Printing Protocol (IPPまたはHTTP)
| 直接(IPP)、あるいはHTTP経由でのIPPプロトコルを使用してリモートプリンターへ到達します。
|- 
| LPD/LPR Host or Printer
| プリンターがリモートで、かつLPD/LPRサーバーに接続されている場合にはこのオプションを選択します。
|- 
| Parallel Port #1
| プリンターがローカルのパラレルポート(LPT)に接続されている場合に選択します。プリンターが自動的に検知されたら、その名前がデバイスに追加されます。
|- 
| USB Printer #1
| プリンターがローカルのUSBポートに接続されている場合に選択します。プリンターの名前が、デバイス名に自動的に追加されます。
|-
|}

リモートプリンターをインストールする場合には、プリンターへのURLを尋ねられます: 

* LPDプリンターサーバーは、<code>lpd://hostname/queue</code>という構文を必要とします。
* HP JetDirectプリンターは、<code>socket://hostname</code>と言う構文を必要とします。
* IPPプリンターは、<code>ipp://hostname/printers/printername</code>または<code><nowiki>http://hostname:631/printers/printername</nowiki></code>という構文を必要とします。

そして、次の画面でプリンターの製造元を、その後の画面でモデルタイプとナンバーを選択します。多くのプリンター向けに、複数のドライバーが利用可能です。一つを選択するか、あるいは[http://www.openprinting.org/printer_list.cgi OpenPrinting Printer List]で適切なドライバーを検索してください。ドライバーは後で簡単に変更できます。 

ドライバーが選択されたら、CUPSはプリンターが正常に追加されたことをシステムに通知します。プリンターの設定(解像度、ページフォーマットなど…)を変更するには、管理インターフェースのプリンター管理ページに移動して、{{Path|Configure Printer}}を選択してください。

==== プリンターをテスト・再設定する ====

プリンターが正しく動作しているか確認するには、プリンター管理ページに行き、プリンターを選択して{{Path|Print Test Page}}をクリックします。 

プリンターが正しく動作していないと思われる場合、{{Path|Modify Printer}}をクリックしてプリンターを再設定します。最初のインストールの時と同じ画面が表示されますが、デフォルト値は現在の設定になっています。 

プリンターが機能しない場合、{{Path|/var/log/cups/error_log}}にあるCUPSのエラーログを見ることで手がかりが見つかるかもしれません。次の例ではパーミッションエラーが見つかっており、これはおそらく{{Path|/etc/cups/cupsd.conf}}ファイルで間違った{{Path|Allow}}の設定をしているためです。

{{RootCmd|tail /var/log/cups/error_log|output=<pre>
(...)
E [11/Jun/2005:10:23:28 +0200] [Job 102] Unable to get printer status (client-error-forbidden)!
</pre>
}}

==== 最適なドライバーをインストールする ====

数多くのプリンタードライバーがあります;最適なパフォーマンスで仕事をするものを探すには、[http://www.openprinting.org/printer_list.cgi OpenPrinting Printer List]を参照してください。そのサイトがどのドライバーを推奨しているか調べるには、プリンターのブランド名とタイプ/モデルを選択します。たとえば、HP LaserJet 5Pについては、そのサイトは<code>ljet4</code>ドライバーを推奨しています。 

PPDファイルをサイトからダウンロードし、それを{{Path|/usr/share/cups/model}}に配置してから、rootで{{c|/etc/init.d/cupsd restart}}を実行します。これにより、CUPSウェブインターフェースでドライバーが利用可能になります。そうしたら、プリンターを上で説明したように再設定しましょう。

=== 特別なプリンタードライバーを使用する ===

==== はじめに ====

いくつかのプリンターは、特定のドライバーを必要としたり、(上で説明したような)通常の設定作業では有効にならない追加機能を提供していたりします。この章では、プリンターの選択とそれらがGentoo Linuxで動くようにする方法を説明します。 

==== Gutenprint ドライバー ====

[http://gutenprint.sourceforge.net gutenprint]ドライバーは、さまざまなキヤノン、エプソン、HP、Lexmark、ソニー、オリンパス、PCLのCUPSをサポートするプリンター向けの、高品質でオープンソースなプリンタードライバーです。ghostscript、The Gimpやその他のアプリケーションもサポートしています。 

GentooのPortageツリーはgutenprintドライバーのebuildを含んでいます。それらをインストールするには{{c|emerge gutenprint}}を実行してください。このebuildはきわめて少数のUSEフラグを要求することに注意してください。gutenprintドライバーが正しく動作するためには、少なくとも<code>cups</code>および<code>ppds</code>が有効になっていなければなりません。

{{Emerge|net-print/gutenprint}}

emergeの作業が終了すると、gutenprintドライバーがCUPSウェブインターフェースを通じて利用可能になります。

==== HPLIP ドライバー ====

[[HPLIP|HPLIP Driver]]を参照してください。

==== PNM2PPA ドライバー ====

PPAは、低レベルな処理をプリンターではなくシステムに送信することに焦点を置き、プリンターをより安価に、しかしより資源を消費するようにするHPの技術です。 

[http://www.openprinting.org/printer_list.cgi OpenPrinting]のサイトが[http://pnm2ppa.sourceforge.net/ pnm2ppa]ドライバーが最適な選択肢であると伝えている場合、{{Package|net-print/pnm2ppa}}フィルターをシステムにインストールする必要があるでしょう: 

{{Emerge|net-print/pnm2ppa}}

インストールされたら、そのプリンター用のPPDファイルを[http://www.openprinting.org/printer_list.cgi OpenPrinting]からダウンロードし、それを{{Path|/usr/share/cups/model}}フォルダーに配置します。それから、上で説明した方法でプリンターを設定してください。

==== SpliX ドライバー ====

[http://splix.ap2c.org/ SpliX]は、SPL(Samsung Printer Language)プリンター用のCUPSプリンタードライバーのセットです。SpliXドライバーは、同様に[http://www.openprinting.org/printer_list.cgi OpenPrinting]から利用可能ですが、{{Package|net-print/splix}}パッケージを使うとこれらのドライバーを簡単にportageの管理下でインストールすることができます。インストールするには:

{{Emerge|net-print/splix}}

を実行し、{{c|cupsd}}を再起動します。

==== Brother プリンタードライバー ====

[[Brother networked printer]]を参照してください。

==== キヤノン CAPT ドライバー ====

[[Canon_CAPT_Printer|Canon CAPT Driver]]を参照してください。

=== Microsoft Windowsへ/から印刷する ===

{{Note|CUPSをSambaとともにセットアップする場合のより詳細な情報については、[[Samba/Guide|Samba/CUPS Guide]]を参照してください。}}

==== WindowsクライアントをIPPのために設定する ====

Microsoft WindowsはIPPをサポートしています(Windows 9x および ME のユーザーは、個別に[http://support.microsoft.com/default.aspx?scid=kb;en-us;294439 インストール]する必要があります)。Linuxコンピューターに接続されたプリンターをWindowsにインストールするには、{{Path|プリンターの追加}}ウィザードを立ち上げ、{{Path|ネットワークプリンター}}を選択します。URIを尋ねられた時は、<code><nowiki>http://hostname:631/printers/queue</nowiki></code>という構文を使用してください。 

==== WindowsクライアントをSamba共有されたプリンターのために設定する ====

CIFSネットワークでプリンターを共有するには、SAMBAがインストールされ、正しく設定されていなければなりません。これはこの文書の範囲を超えていますが、共有プリンターのための簡単なSAMBAの設定についてはこの文書で扱います。 

お好みのテキストエディターで{{Path|/etc/samba/smb.conf}}を開き、<code>[printers]</code>セクションを書き加えます: 

{{CodeBox|title=[printers] セクション|1=
[printers]
  comment      = All printers
  path         = /var/spool/samba
  browseable   = no
  guest ok     = no
  writable     = no
  printable    = yes
  public       = yes
  printer name = hpljet5p
}}

<code>[global]</code>セクションの内側になるまで{{Path|smb.conf}}ファイルの先頭の方へ移動し、<code>printcap name</code>と<code>printing</code>という設定を探してそれぞれ<code>cups</code>に設定します(以下の例を見てください):

{{CodeBox|title=smb.confの[global]セクションを変更する|1=
[global]
  (...)
  printcap name = cups
  printing      = cups
}}

CUPSの[[#Windows_PCLドライバーのサポートを有効化する|windows pcl]]サポートが有効になっているか確認してください。それから、変更を有効化するためにsmbサービスを再起動します。

==== LinuxクライアントをWindowsプリンターサーバーのために設定する ====

最初に、Windowsシステムでプリンターが共有されており、また{{Package|net-fs/samba}}が(上で説明したように)<code>cups</code> USEフラグを有功にしてemergeされていることを確認してください。

使いたいプリンターのURIを探すには、以下のコマンドを、<code>server</code>をSamba共有されているプリンターを探すコンピューターに置き換えた上で実行してください:

{{Cmd|smbclient -N '\\server\'}}

CUPSウェブインターフェースで、前に説明したようにしてプリンターを設定します。CUPSに<code>Windows Printer via SAMBA</code>という名前のもう一つのドライバーが追加されていることに気付くでしょう。それを選択し、URIには <code>smb://username:password@workgroup/server/printername</code> あるいは <code>smb://server/printername</code> という構文を使用します。

{{Important|上のURIの中にあるすべての特殊文字は適切にエスケープされている必要があります。例:
 
<code>smb://BEN-DESKTOP/HP Color LaserJet CP1510 series PCL6</code>
  
は以下のようになります:
  
<code>smb://BEN-DESKTOP/HP%20Color%20LaserJet%20CP1510%20series%20PCL6</code>
  
この結果の文字列は以下のコマンドを実行することで得ることができます:
 
{{Cmd|python2 -c 'import urllib; print "smb://" + urllib.quote("BEN-DESKTOP/HP Color LaserJet CP1510 series PCL6")'}}
}}

=== 印刷関連のアプリケーション ===

==== はじめに ====

プリンター設定の補助、追加の印刷フィルターの使用、印刷能力への機能追加などのための多くのツールが存在しています。この章では、それらのうちのほんの幾つかを挙げます。リストは網羅的ではなく、またそれぞれのツールについて細部にわたって論じているものでもないことに注意してください。 

==== Gtk-LP - GTKベースのプリンター設定ツール ====

{{Package|net-print/gtklp}}を使うと、プリンターのインストール、変更、設定をスタンドアローンのGtkアプリケーションから行うことができます。CUPSを利用しており、また標準的なCUPSの機能をすべて提供しています。CUPSウェブインターフェースが気に入らない、あるいは日常的な印刷ルーチンのためにスタンドアローンアプリケーションが欲しい場合は、もちろんこれを試してみる価値があります。 

以下のようにインストールします: 

{{Emerge|net-print/gtklp}}

==== KDE 4 向けのプリンター設定ツール ====

KDE4にも、{{Package|kde-apps/print-manager}}と呼ばれるプリンター設定ツールがあります。CUPSとともに動作し、プリンターを設定するためのユーザーフレンドリーなインターフェースを提供します。以下のようにしてインストールします:

{{Emerge|kde-apps/print-manager}}

== 削除 ==

=== USE フラグ ===

<code>cups</code> USE フラグを有功にして現在インストールされているパッケージについては、変更する必要があります。{{Path|/etc/portage/package.use}}を検索して<code>cups</code> フラグが明示的にセットされているパッケージを見つけ、そのフラグを除去します。

次に、以前セットした場合、{{Path|/etc/portage/make.conf}}の<var>USE</var>変数から<code>cups</code>という値を除去する必要があるでしょう。

=== Unmerge ===

{{Unmerge|net-print/cups}}

Finally, clean the system of any packages that are no longer needed as a result of CUPS being removed. 

{{Emerge|--depclean}}

== トラブルシューティング ==

=== Error: Unable to convert file 0 to printable format ===

While having printing troubles and {{Path|/var/log/cups/error_log}} shows this message: 

{{CodeBox|title=エラーログ|1=
Unable to convert file 0 to printable format
}}

Re-emerge {{Package|app-text/ghostscript-gpl}} with the <code>cups</code> USE flag. You can either add <code>cups</code> to the system USE flags in {{Path|/etc/portage/make.conf}} or enable it only for ghostscript-gpl as shown: 

{{RootCmd|echo "app-text/ghostscript-gpl cups" >> /etc/portage/package.use}}

Then run {{c|emerge app-text/ghostscript-gpl}}. When it has finished compiling, be sure to restart {{c|cupsd}} afterward.

When using OpenRC:

{{RootCmd|service cupsd restart}}

When using systemd:

{{RootCmd|systemctl restart cups}}

== External resources ==

* [https://www.cups.org/doc/network.html Using Network Printers] - Documentation at CUPS.org.
* [https://www.cups.org/doc/options.html Command-Line Printing and Options] - Documentation at CUPS.org.

{{Migrated|originalauthors=swift, nightmorph}}
