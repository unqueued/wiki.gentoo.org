<languages />
{{InfoBox stack
|{{InfoBox project|Overlays|header=true}}
}}

У пользователей Gentoo Linux есть [https://gitweb.gentoo.org/repo/gentoo.git/tree/ "основной" репозиторий пакетов], который в прошлом назывался [https://devmanual.gentoo.org/general-concepts/tree/ "дерево Portage"]. Однако, этот термин следовало бы вывести из употребления, поскольку [[Package Manager Specification|пакетные менеджеры]], отличные от [[Portage]], также могут работать с репозиториями пакетов в Gentoo. [https://gitweb.gentoo.org/repo/gentoo.git/tree/ Основной репозиторий] содержит все пакеты программ (называемые файлами ebuild), которые курируются разработчиками Gentoo. Остальные деревья пакетов обычно доступны посредством ''репозиториев''. Пользователи могут добавлять дополнительные репозитории, которые "накладываются" ("laid over") на основное дерево — отсюда название "оверлей" (overlay).

== Репозитории ==

Package repositories are nothing more (or less) than a [[Repository format|set of files]] (ebuilds, metadata files, ChangeLog entries ...). These can be pulled in from public repositories ([[Project:Portage/Sync#Portage_configuration|git, CVS, SVN ...]]) or downloaded as tarballs and extracted manually onto the system. It is advised to use managed repositories by [https://overlays.gentoo.org trusted] third parties; any installed overlay will cause Portage to look through the overlaid files when deciding which software to install. If compromised code is in the overlay, then compromised packages could be installed on the system.

В настоящее время, по умолчанию работа с репозиториями осуществляется посредством {{Path|[[:/etc/portage/repos.conf/ru|/etc/portage/repos.conf]]}}. Как и в других случаях при работе с Portage, это может быть файл или каталог.

Определения репозиториев в {{Path|/etc/portage/repos.conf/}} также сообщают Portage, следует ли обновлять тот или иной репозиторий, и если следует, то каким образом. Все репозитории, которые следует обновлять, автоматически обновляются при вызове команды {{c|emerge --sync}}.

Устаревший и не рекомендуемый к использованию, но все еще поддерживаемый способ работы с репозиториями — посредством переменной <var>PORTDIR_OVERLAY</var> в файле {{Path|/etc/portage/make.conf}}. Эта переменная может указывать на одно или более мест в файловой системе, где расположены репозитории. Настоятельно рекомендуется использовать каталог {{Path|[[:/etc/portage/repos.conf/ru|/etc/portage/repos.conf]]/}}.

Для более подробной информации ознакомьтесь с [[:/etc/portage/repos.conf/ru|/etc/portage/repos.conf]] и [[Project:Portage/Sync#Operation|статью Portage/Sync]].

=== Приоритеты ===

У каждого оверлея есть уникальный приоритет. Таким образом реализуется недвусмысленное разрешение пакетов, даже если одна и та же версия пакета находится в нескольких оверлеях. Файлы ebuild из оверлеев с более высоким приоритетом (например, 60) предпочитаются файлам ebuild из оверлеев с более низким приоритетом (например, 50).

Список оверлеев и их приоритетов можно получить из вывода следующих команд (найдите строку "Repositories"):

{{Cmd|emerge --info --verbose}}

{{Cmd|portageq repos_config /}}

Основное дерево Gentoo Portage имеет приоритет -1000. Это означает, что другие оверлеи имеют старшинство, поскольку им присвоен более высокий приоритет. Это поведение используется по умолчанию, так как идея оверлеев заключается в том, чтобы "накладываться/перекрывать" дерево Portage.

== Доступное программное обеспечение ==

Некоторые утилиты поддерживают или специально создавались для оверлеев.

=== Layman ===

Приложение {{c|layman}} облегчает управление и обновление дополнительных оверлеев. Это приложение для командной строки, с помощью которого можно выводить список, подписываться и отписываться, а также обновлять общедоступные оверлеи. 

Оно поддерживает как метод {{Path|[[Layman#Using_.27make.conf.27_method_.28older_method.29|make.conf]]}}, так и метод {{Path|[[Layman#Using_.27repos.conf.27_method_.28default_method_for_app-portage.2Flayman-2.3.0_or_later_.29|repos.conf]]}}.
* При использовании метода {{Path|[[Layman#Using_.27make.conf.27_method_.28older_method.29|make.conf]]}}, {{c|layman}} работает с отдельным конфигурационным файлом, который читается файлом {{Path|make.conf}}
* При использовании метода {{Path|[[Layman#Using_.27repos.conf.27_method_.28default_method_for_app-portage.2Flayman-2.3.0_or_later_.29|repos.conf]]}}, {{c|layman}} работает непосредственно с файлом {{Path|[[Layman#Using_.27repos.conf.27_method_.28default_method_for_app-portage.2Flayman-2.3.0_or_later_.29|/etc/portage/repos.conf/layman.conf]]}}

Для более подробной информации ознакомьтесь с [[Layman]] и [[Project:Portage/Sync#Layman_configuration]].

=== emaint ===

Смотрите статью [[Project:Portage/Sync#Operation Sync (из проекта Portage)]] и {{c|man 1 emaint}}.

=== eix ===

{{c|eix-sync}} — обертка, запускающая команду {{c|emerge --sync}} (которая в свою очередь запускает команду {{c|emaint sync --auto}}) и затем {{c|eix-update}}. Подробнее читайте в статье [[Eix]] и в {{c|man 1 eix}}.

== Использование ==

=== Установка пакета, имеющего дубликаты ===

В процессе работы с оверлеями может возникнуть ситуация, когда несколько версий одного и того же пакета доступны в нескольких оверлеях. Сообщите [[Portage]] о том, что необходимо установить определенный пакет из определенного оверлея с помощью <code>::</code> нотации:

{{Emerge|category/atom::overlay-name}}

== Лучшие практики ==

=== Создание кэша ===

Если в системе установлены крупные оверлеи, то выполнение таких операций, как разрешение зависимостей, может занять у portage много времени. Это происходит по той причине, что оверлеи, как правило, не содержат кэш метаданных.

Сгенерируйте локальный кэш метаданных, запустив команду {{c|emerge --regen}} после синхронизации оверлеев:

{{RootCmd
|layman -S
|( ulimit -n 4096 && emerge --regen )}}

Будьте осторожны, поскольку выполнение команды {{c|emerge --regen}} занимает много времени, и ее не рекомендуется использовать пользователям rsync, поскольку rsync обновляет кэш с помощью кэша на сервере (большинство пользователей portage являются пользователями rsync). Пользователям rsync следует просто запустить {{c|emerge --sync}} (или {{c|eix-sync}}), чтобы повторно сгенерировать кэш. Скорее всего, использовать {{c|emerge --regen}} следует только пользователям очень больших оверлеев.

=== Маскировка при использовании небезопасных оверлеев ===

При использовании крупных оверлеев, а также оверлеев неизвестного или низкого качества, лучше всего замаскировать оверлей жесткой маской.

{{FileBox|filename=/etc/portage/package.mask|title=Маскировка всех пакетов в оверлеи|lang=bash|1=
*/*::overlay-name
}}

После этого размаскируйте пакеты, которые необходимо установить.

{{FileBox|filename=/etc/portage/package.unmask|title=Размаскировка некоторых пакетов из оверлея|lang=bash|1=
foo/bar::overlay-name
}}

== Смотрите также ==

* [[Project:Overlays|Overlays project]] — Официальный проект Gentoo, осуществляющий поддержу оверлеев.
* [[Project:Overlays/Overlays_guide|Overlays guide (Overlay project)]] — Руководство пользователя, составленное проектом Overlay.
* [[Project:Overlays/Dev_Guide|Руководство разработчика оверлеев Gentoo]]

== Внешние ресурсы ==

* https://overlays.gentoo.org
* https://github.com/gentoo/


[[Category:Portage]]
