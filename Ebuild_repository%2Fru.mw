<languages />
{{InfoBox stack
|{{InfoBox project|Overlays|header=true}}
}}

У пользователей Gentoo Linux есть [https://gitweb.gentoo.org/repo/gentoo.git/tree/ "основной" репозиторий пакетов], который в прошлом назывался [https://devmanual.gentoo.org/general-concepts/tree/ "дерево Portage"]. Однако, этот термин следовало бы вывести из употребления, поскольку [[Package Manager Specification|пакетные менеджеры]], отличные от [[Portage]], также могут работать с репозиториями пакетов в Gentoo. [https://gitweb.gentoo.org/repo/gentoo.git/tree/ Основной репозиторий] содержит все пакеты программ (называемые файлами ebuild), которые курируются разработчиками Gentoo. Остальные деревья пакетов обычно доступны посредством ''репозиториев''. Пользователи могут добавлять дополнительные репозитории, которые "накладываются" на основное дерево — отсюда название "оверлей".

== Репозитории ==

Репозитории пакетов являются не более (и не менее) чем [[Repository format|наборами файлов]] (файлов ebuild, файлов метаданных, записей ChangeLog ...). Эти файлы можно установить из публичных репозиториев ([[Project:Portage/Sync#Portage_configuration|git, cvs, svn ...]]) или загрузить в виде файлов tarball и распаковать вручную. Рекомендуется использовать managed репозитории trusted третьих сторон. Любой установленный оверлей заставит Portage просматривать "наложенные" оверлеем файлы, чтобы решить, какой пакет следует установить. Если оверлей содержит скомпрометированный код, то скомпрометированные пакеты могут быть установлены в системе.

В настоящее время, по умолчанию работа с репозиториями осуществляется посредством {{Path|[[:/etc/portage/repos.conf/ru|/etc/portage/repos.conf]]}}. Как и в других случаях при работе с Portage, это может быть файл или каталог.

Repository definitions inside {{Path|/etc/portage/repos.conf/}} also inform Portage if and how the repository can be updated. With it, calling {{c|emerge --sync}} will automatically update the repositories as well.

A deprecated, yet still supported method is to use the <var>PORTDIR_OVERLAY</var> variable inside {{Path|/etc/portage/make.conf}}. This variable can point to one or more additional locations on the file system where repositories are available. The use of the {{Path|[[:/etc/portage/repos.conf]]/}} directory is highly preferred.

Для более подробной информации ознакомьтесь с [[:/etc/portage/repos.conf|/etc/portage/repos.conf]] и [[Project:Portage/Sync#Operation|Portage/Sync article]].

=== Приоритеты ===

Each overlay has its unique priority. This makes sure that in the case of a specific version being found in several overlays, the resolution is unambiguous. Ebuilds from overlays with higher priority numbers (for example 60) take precedence over ebuilds from overlays with lower priorities (such as 50).

The list of overlays with their priorities can be obtained through the output of the following commands (look for the "Repositories" string):

{{Cmd|emerge --info --verbose}}

{{Cmd|portageq repos_config /}}

The default Gentoo Portage tree will have a priority of -1000. That means that all other overlays generally take precedence as they are assigned a higher priority. That is the default behavior, because overlays are designed to "lay over/on top" of the portage tree.

== Available software ==

Некоторые утилиты поддерживают или специально создавались для оверлеев.

=== Layman ===

The {{c|layman}} application makes it easier to manage and update multiple additional overlays. It is a command-line application 
through which publicly available overlays can be listed, subscribed to and unsubscribed from, as well as update those repositories. 

It supports both the {{Path|[[Layman#Using_.27make.conf.27_method_.28older_method.29|make.conf]]}} as well as {{Path|[[Layman#Using_.27repos.conf.27_method_.28default_method_for_app-portage.2Flayman-2.3.0_or_later_.29|repos.conf]]}} method.
* When using the {{Path|[[Layman#Using_.27make.conf.27_method_.28older_method.29|make.conf]]}} method, {{c|layman}} manages a dedicated configuration file which should be sourced in by {{Path|make.conf}}
* When using {{Path|[[Layman#Using_.27repos.conf.27_method_.28default_method_for_app-portage.2Flayman-2.3.0_or_later_.29|repos.conf]]}}, {{c|layman}} manages the {{Path|[[Layman#Using_.27repos.conf.27_method_.28default_method_for_app-portage.2Flayman-2.3.0_or_later_.29|/etc/portage/repos.conf/layman.conf]]}} file directly

Для более подробной информации ознакомьтесь с [[Layman]] и [[Project:Portage/Sync#Layman_configuration]].

=== emaint ===

Смотрите статью [[Project:Portage/Sync#Operation Sync (из проекта Portage)]] и {{c|man 1 emaint}}.

=== eix ===

{{c|eix-sync}} is a wrapper starting {{c|emerge --sync}} (which in turn starts {{c|emaint sync --auto}}) followed by {{c|eix-update}}.  For further details see the [[Eix]] article and {{c|man 1 eix}}.

== Usage ==

=== Emerging a duplicate package ===

When working with overlays it is possible to encounter a situation where multiple versions of the same package are available from different overlays. Instruct [[Portage]] to install a specific package from a specific overlay with the <code>::</code> notation:

{{Emerge|category/atom::overlay-name}}

== Лучшие практики ==

=== Создание кэша ===

When large overlays are installed, portage may take a long time to perform operations like dependency resolution. This is because overlays do not usually contain a metadata cache.

Generate a local metadata cache by running {{c|emerge --regen}} after syncing the overlays:

{{RootCmd
|layman -S
|( ulimit -n 4096 && emerge --regen )}}

Be careful, because {{c|emerge --regen}} takes a lot of time and it's not recommended for rsync users as rsync updates the cache using server-side caches (most of users of portage are rsync users). Rsync users should simply run {{c|emerge --sync}} (or {{c|eix-sync}}) to regenerate the cache. It's probably only users of very large overlays should try {{c|emerge --regen}}.

=== Masking when using unsafe overlays ===

When using huge overlays or those with unknown/low quality it is best practice to hardmask the whole overlay.

{{FileBox|filename=/etc/portage/package.mask|title=Маскировка всех пакетов в оверлеи|lang=bash|1=
*/*::overlay-name
}}

После этого размаскируйте пакеты, которые необходимо установить.

{{FileBox|filename=/etc/portage/package.unmask|title=Размаскировка некоторых пакетов из оверлея|lang=bash|1=
foo/bar::overlay-name
}}

== Смотрите также ==

* [[Project:Overlays|Overlays project]] - The official Gentoo project for overlays support.
* [[Project:Overlays/Overlays_guide|Overlays guide (Overlay project)]] - A user guide written by the Overlay project.
* [[Project:Overlays/Dev_Guide|Developer's guide to Gentoo overlays]]

== Внешние ресурсы ==

* https://overlays.gentoo.org
* https://github.com/gentoo/


[[Category:Portage]]
