<languages />
{{InfoBox stack
|{{InfoBox project|Overlays|header=true}}
}}

'''Репозиторий ebuild-файлов''', в просторечии известный как '''overlay''', это [[Article description::структура файлов и каталогов, используемая для добавления пакетов, которые будут доступны для Gentoo системного пакетного менеджера.]] Репозитории могут содержать ebuild-файлы c одним или более [[EAPI]].

The main repository on a Gentoo system is known as the [https://gitweb.gentoo.org/repo/gentoo.git/tree/ Gentoo ebuild repository]. It contains [[ebuild]]s maintained by official Gentoo developers and members of the community (through the [[Project:Proxy Maintainers|Proxy Maintainers]] project). System administrators can add additional ebuild repositories to the system using various utilities and methods described below.

== Репозитории ==

Репозитории ebuild-файлов являются не более (и не менее) чем [[Repository format|наборами файлов]] (файлов ebuild, файлов метаданных, ...). Эти файлы можно установить из публичных репозиториев ([[Project:Portage/Sync#Portage_configuration|git, CVS, SVN ...]]) или загрузить в виде файлов tarball и распаковать вручную. Рекомендуется использовать управляемые репозитории от [https://repos.gentoo.org доверенных] третьих сторон. Любой установленный репозиторий ebuild-файлов заставит Portage просматривать "наложенные" файлы, чтобы решить, какой пакет следует установить. Если репозиторий ebuild-файлов содержит скомпрометированный код, то скомпрометированные пакеты могут быть установлены в системе.

В настоящее время, по умолчанию работа с репозиториями осуществляется посредством {{Path|[[:/etc/portage/repos.conf/ru|/etc/portage/repos.conf]]}}. Как и в других случаях при работе с Portage, это может быть файл или каталог.

Определения репозиториев в {{Path|/etc/portage/repos.conf/}} также сообщают Portage, следует ли обновлять тот или иной репозиторий, и если следует, то каким образом. Все репозитории, которые следует обновлять, автоматически обновляются при вызове команды {{c|emerge --sync}}.

Устаревший и не рекомендуемый к использованию, но все еще поддерживаемый способ работы с репозиториями — посредством переменной <var>PORTDIR_OVERLAY</var> в файле {{Path|/etc/portage/make.conf}}. Эта переменная может указывать на одно или более мест в файловой системе, где расположены репозитории. Настоятельно рекомендуется использовать каталог {{Path|[[:/etc/portage/repos.conf/ru|/etc/portage/repos.conf]]/}}.

Для более подробной информации ознакомьтесь с [[:/etc/portage/repos.conf/ru|/etc/portage/repos.conf]] и [[Project:Portage/Sync#Operation|статью Portage/Sync]].

=== Приоритеты ===

Each ebuild repository has a unique priority to the package manager. This ensures that in the case of a specific version being found in several ebuild repositories, the resolution is unambiguous. Ebuilds from repositories with higher priority numbers (for example 60) will take precedence over ebuilds from repositories with lower priorities (such as 50).

Список репозиториев ebuild-файлов и их приоритеты можно получить из вывода следующих команд (найдите строку "Repositories"):

{{Cmd|emerge --info --verbose}}

{{Cmd|portageq repos_config /}}

The Gentoo ebuild repository will have a priority of -1000 which means that all other repositories generally take precedence if they are assigned a higher priority. This is the default behavior, because ebuild repositories are designed to "lay over" or "on top" of the Gentoo repository.

== Доступное программное обеспечение ==

Некоторые утилиты поддерживают или специально создавались для репозиториев ebuild-файлов.

=== Layman ===

Приложение {{c|layman}} облегчает управление и обновление дополнительных ebuild репозиториев. Это приложение для командной строки, с помощью которого можно выводить список, подписываться и отписываться, а также обновлять общедоступные ebuild репозитории. 

Оно поддерживает как метод {{Path|[[Layman#make.conf_method_.28force_old_method.29|make.conf]]}}, так и метод {{Path|[[Layman#repos.conf_method_.28default.29|repos.conf]]}}.
* При использовании метода {{Path|[[Layman#make.conf_method_.28force_old_method.29|make.conf]]}}, {{c|layman}} работает с отдельным конфигурационным файлом, который читается файлом {{Path|make.conf}}
* При использовании метода {{Path|[[Layman#repos.conf_method_.28default.29|repos.conf]]}}, {{c|layman}} работает непосредственно с файлом {{Path|[[Layman#repos.conf_method_.28default.29|/etc/portage/repos.conf/layman.conf]]}}

Для более подробной информации ознакомьтесь с [[Layman]] и [[Project:Portage/Sync#Layman_configuration]].

=== emaint ===

Смотрите статью [[Project:Portage/Sync#Operation|Sync (из проекта Portage)]] и {{c|man 1 emaint}}.

=== eix ===

{{c|eix-sync}} — обертка, запускающая команду {{c|emerge --sync}} (которая в свою очередь запускает команду {{c|emaint sync --auto}}) и затем {{c|eix-update}}. Подробнее читайте в статье [[Eix]] и в {{c|man 1 eix}}.

=== eselect-repository ===

{{c|eselect repository}} maintains {{Path|/etc/portage/repos.conf}} entries for Portage to access and synchronize.  See [[Eselect/Repository]] article for details.

== Использование ==

=== Установка пакета, имеющего дубликаты ===

В процессе работы с репозиторием ebuild-файлов может возникнуть ситуация, когда несколько версий одного и того же пакета доступны в нескольких репозиториях ebuild-файлов. Сообщите [[Portage]] о том, что необходимо установить определенный пакет из определенного репозитория ebuild-файлов с помощью <code>::</code> нотации:

{{Emerge|category/atom::repository-name}}

Похожий синтаксис может применяться и при других вариантах использования команды emerge, включая удаление пакета через опцию <code>--depclean</code>.

== Лучшие практики ==

=== Создание кэша ===

Если в системе установлены крупные репозитории ebuild-файлов, то выполнение таких операций, как разрешение зависимостей, может занять у Portage много времени. Это происходит потому что репозитории ebuild-файлов, как правило, не содержат кэш метаданных.

Сгенерируйте локальный кэш метаданных, запустив команду {{c|emerge --regen}} после синхронизации репозиториев ebuild-файлов:

{{RootCmd
|emaint sync --allrepos
|( ulimit -n 4096 && emerge --regen )}}

Будьте осторожны, поскольку выполнение команды {{c|emerge --regen}} занимает много времени, и ее не рекомендуется использовать пользователям rsync, поскольку rsync обновляет кэш с помощью кэша на сервере (большинство пользователей portage являются пользователями rsync). Пользователям rsync следует просто запустить {{c|emerge --sync}} (или {{c|eix-sync}}), чтобы повторно сгенерировать кэш. Скорее всего, использовать {{c|emerge --regen}} следует только пользователям очень больших репозиториев ebuild-файлов.

=== Маскировка установленных, но небезопасных репозиториев ebuild-файлов ===

When using large ebuild repositories or those with unknown/low quality it is best practice to hardmask the whole ebuild repository and only accept specific ebuilds on a case-by-case basis:

{{FileBox|filename=/etc/portage/package.mask|title=Маскировка всех пакетов в репозитории ebuild-файлов|lang=bash|1=
*/*::repository-name
}}

После этого размаскируйте пакеты, которые необходимо установить.

{{FileBox|filename=/etc/portage/package.unmask|title=Размаскировка некоторых пакетов из репозитория ebuild-файлов|lang=bash|1=
foo/bar::repository-name
}}

== Смотрите также ==

* [[Project:Overlays|Overlays project]] — Официальный проект Gentoo, осуществляющий поддержу репозиториев ebuild-файлов.
* [[Project:Overlays/Overlays guide|Overlays guide (Overlay project)]] — Руководство пользователя, составленное проектом Overlay.
* [[Project:Overlays/Old Dev Guide|Руководство разработчика оверлеев Gentoo]] — Этот документ храниться только в исторических целях. Текущее руководство находиться здесь [[Project:Overlays/Overlays guide]].
* [[Handbook:Parts/Portage/CustomTree/ru#Определение пользовательского репозитория|Определение пользовательского репозитория]] — Раздел в Gentoo Handbook.

== Внешние ресурсы ==

* https://repos.gentoo.org
* https://github.com/gentoo/
* https://gpo.zugaina.org/Overlays


[[Category:Portage]]
