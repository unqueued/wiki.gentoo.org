<languages />
{{InfoBox stack
|{{InfoBox project|Overlays|header=true}}
}}

Within Gentoo Linux, users already have one [https://devmanual.gentoo.org/general-concepts/tree/ "main" package repository]. The [https://gitweb.gentoo.org/repo/gentoo.git/tree/ main repository] contains all the software packages (called ebuilds) maintained by Gentoo developers. Additional package trees are usually hosted by ''repositories''. Users can add such additional repositories to their system.

== Репозитории ==

Package repositories are nothing more (or less) than a [[Repository format|set of files]] (ebuilds, metadata files, ChangeLog entries ...). These can be pulled in from public repositories ([[Project:Portage/Sync#Portage_configuration|git, CVS, SVN ...]]) or downloaded as tarballs and extracted manually onto the system. It is advised to use managed repositories by [https://overlays.gentoo.org trusted] third parties; any installed ebuild repository will cause Portage to look through the overlaid files when deciding which software to install. If compromised code is in the ebuild repository, then compromised packages could be installed on the system.

В настоящее время, по умолчанию работа с репозиториями осуществляется посредством {{Path|[[:/etc/portage/repos.conf/ru|/etc/portage/repos.conf]]}}. Как и в других случаях при работе с Portage, это может быть файл или каталог.

Определения репозиториев в {{Path|/etc/portage/repos.conf/}} также сообщают Portage, следует ли обновлять тот или иной репозиторий, и если следует, то каким образом. Все репозитории, которые следует обновлять, автоматически обновляются при вызове команды {{c|emerge --sync}}.

Устаревший и не рекомендуемый к использованию, но все еще поддерживаемый способ работы с репозиториями — посредством переменной <var>PORTDIR_OVERLAY</var> в файле {{Path|/etc/portage/make.conf}}. Эта переменная может указывать на одно или более мест в файловой системе, где расположены репозитории. Настоятельно рекомендуется использовать каталог {{Path|[[:/etc/portage/repos.conf/ru|/etc/portage/repos.conf]]/}}.

Для более подробной информации ознакомьтесь с [[:/etc/portage/repos.conf/ru|/etc/portage/repos.conf]] и [[Project:Portage/Sync#Operation|статью Portage/Sync]].

=== Приоритеты ===

У каждого оверлея есть уникальный приоритет. Таким образом реализуется недвусмысленное разрешение пакетов, даже если одна и та же версия пакета находится в нескольких оверлеях. Файлы ebuild из оверлеев с более высоким приоритетом (например, 60) предпочитаются файлам ebuild из оверлеев с более низким приоритетом (например, 50).

Список оверлеев и их приоритетов можно получить из вывода следующих команд (найдите строку "Repositories"):

{{Cmd|emerge --info --verbose}}

{{Cmd|portageq repos_config /}}

The Gentoo repository will have a priority of -1000. That means that all other ebuild repositories generally take precedence as they are assigned a higher priority. That is the default behavior, because ebuild repositories are designed to "lay over/on top" of the Gentoo repository.

== Доступное программное обеспечение ==

Некоторые утилиты поддерживают или специально создавались для оверлеев.

=== Layman ===

Приложение {{c|layman}} облегчает управление и обновление дополнительных оверлеев. Это приложение для командной строки, с помощью которого можно выводить список, подписываться и отписываться, а также обновлять общедоступные оверлеи. 

It supports both the {{Path|[[Layman#make.conf_method_.28force_old_method.29|make.conf]]}} as well as {{Path|[[Layman#repos.conf_method_.28default.29|repos.conf]]}} method.
* When using the {{Path|[[Layman#make.conf_method_.28force_old_method.29|make.conf]]}} method, {{c|layman}} manages a dedicated configuration file which should be sourced in by {{Path|make.conf}}
* When using {{Path|[[Layman#repos.conf_method_.28default.29|repos.conf]]}}, {{c|layman}} manages the {{Path|[[Layman#repos.conf_method_.28default.29|/etc/portage/repos.conf/layman.conf]]}} file directly

Для более подробной информации ознакомьтесь с [[Layman]] и [[Project:Portage/Sync#Layman_configuration]].

=== emaint ===

Смотрите статью [[Project:Portage/Sync#Operation Sync (из проекта Portage)]] и {{c|man 1 emaint}}.

=== eix ===

{{c|eix-sync}} — обертка, запускающая команду {{c|emerge --sync}} (которая в свою очередь запускает команду {{c|emaint sync --auto}}) и затем {{c|eix-update}}. Подробнее читайте в статье [[Eix]] и в {{c|man 1 eix}}.

== Использование ==

=== Установка пакета, имеющего дубликаты ===

В процессе работы с оверлеями может возникнуть ситуация, когда несколько версий одного и того же пакета доступны в нескольких оверлеях. Сообщите [[Portage]] о том, что необходимо установить определенный пакет из определенного оверлея с помощью <code>::</code> нотации:

{{Emerge|category/atom::overlay-name}}

== Лучшие практики ==

=== Создание кэша ===

Если в системе установлены крупные оверлеи, то выполнение таких операций, как разрешение зависимостей, может занять у portage много времени. Это происходит по той причине, что оверлеи, как правило, не содержат кэш метаданных.

Generate a local metadata cache by running {{c|emerge --regen}} after syncing the ebuild repositories:

{{RootCmd
|layman -S
|( ulimit -n 4096 && emerge --regen )}}

Будьте осторожны, поскольку выполнение команды {{c|emerge --regen}} занимает много времени, и ее не рекомендуется использовать пользователям rsync, поскольку rsync обновляет кэш с помощью кэша на сервере (большинство пользователей portage являются пользователями rsync). Пользователям rsync следует просто запустить {{c|emerge --sync}} (или {{c|eix-sync}}), чтобы повторно сгенерировать кэш. Скорее всего, использовать {{c|emerge --regen}} следует только пользователям очень больших оверлеев.

=== Маскировка при использовании небезопасных оверлеев ===

При использовании крупных оверлеев, а также оверлеев неизвестного или низкого качества, лучше всего замаскировать оверлей жесткой маской.

{{FileBox|filename=/etc/portage/package.mask|title=Маскировка всех пакетов в оверлеи|lang=bash|1=
*/*::overlay-name
}}

После этого размаскируйте пакеты, которые необходимо установить.

{{FileBox|filename=/etc/portage/package.unmask|title=Размаскировка некоторых пакетов из оверлея|lang=bash|1=
foo/bar::overlay-name
}}

== Смотрите также ==

* [[Project:Overlays|Overlays project]] - The official Gentoo project for ebuild repositories' support.
* [[Project:Overlays/Overlays guide|Overlays guide (Overlay project)]] - A user guide written by the Overlay project.
* [[Project:Overlays/Dev Guide|Developer's guide to Gentoo overlays]] - This document is kept only for historical purposes. The current guide is maintained as [[Project:Overlays/Overlays guide]].
* [[Handbook:Parts/Portage/CustomTree#Defining_a_custom_repository|Defining a custom repository]] - Section in the Gentoo Handbook

== Внешние ресурсы ==

* https://overlays.gentoo.org
* https://github.com/gentoo/


[[Category:Portage]]
