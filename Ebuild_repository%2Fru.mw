<languages />
{{InfoBox stack
|{{InfoBox project|Overlays|header=true}}
}}

У пользователей Gentoo Linux есть [https://devmanual.gentoo.org/general-concepts/tree/ "main" (основной) репозиторий пакетов]. [https://gitweb.gentoo.org/repo/gentoo.git/tree/ Основной репозиторий] содержит все пакеты программ (называемые файлами ebuild), которые поддерживаются разработчиками Gentoo. Остальные деревья пакетов обычно доступны посредством ''репозиториев''. Пользователи могут добавлять дополнительные репозитории (традиционно известные как ''оверлеи'' (overlay)).

== Репозитории ==

Репозитории пакетов являются не более (и не менее) чем [[Repository format|наборами файлов]] (файлов ebuild, файлов метаданных, записей ChangeLog ...). Эти файлы можно установить из публичных репозиториев ([[Project:Portage/Sync#Portage_configuration|git, CVS, SVN ...]]) или загрузить в виде файлов tarball и распаковать вручную. Рекомендуется использовать управляемые репозитории от [https://overlays.gentoo.org доверенных] третьих сторон. Любой установленный репозиторий ebuild-файлов заставит Portage просматривать "наложенные" файлы, чтобы решить, какой пакет следует установить. Если репозиторий ebuild-файлов содержит скомпрометированный код, то скомпрометированные пакеты могут быть установлены в системе.

В настоящее время, по умолчанию работа с репозиториями осуществляется посредством {{Path|[[:/etc/portage/repos.conf/ru|/etc/portage/repos.conf]]}}. Как и в других случаях при работе с Portage, это может быть файл или каталог.

Определения репозиториев в {{Path|/etc/portage/repos.conf/}} также сообщают Portage, следует ли обновлять тот или иной репозиторий, и если следует, то каким образом. Все репозитории, которые следует обновлять, автоматически обновляются при вызове команды {{c|emerge --sync}}.

Устаревший и не рекомендуемый к использованию, но все еще поддерживаемый способ работы с репозиториями — посредством переменной <var>PORTDIR_OVERLAY</var> в файле {{Path|/etc/portage/make.conf}}. Эта переменная может указывать на одно или более мест в файловой системе, где расположены репозитории. Настоятельно рекомендуется использовать каталог {{Path|[[:/etc/portage/repos.conf/ru|/etc/portage/repos.conf]]/}}.

Для более подробной информации ознакомьтесь с [[:/etc/portage/repos.conf/ru|/etc/portage/repos.conf]] и [[Project:Portage/Sync#Operation|статью Portage/Sync]].

=== Приоритеты ===

Each ebuild repository has its unique priority. This makes sure that in the case of a specific version being found in several ebuild repositories, the resolution is unambiguous. Ebuilds from ebuild repositories with higher priority numbers (for example 60) take precedence over ebuilds from ebuild repositories with lower priorities (such as 50).

The list of ebuild repositories with their priorities can be obtained through the output of the following commands (look for the "Repositories" string):

{{Cmd|emerge --info --verbose}}

{{Cmd|portageq repos_config /}}

The Gentoo repository will have a priority of -1000. That means that all other ebuild repositories generally take precedence as they are assigned a higher priority. That is the default behavior, because ebuild repositories are designed to "lay over/on top" of the Gentoo repository.

== Доступное программное обеспечение ==

A number of tools support or integrate with ebuild repositories.

=== Layman ===

The {{c|layman}} application makes it easier to manage and update multiple additional ebuild repositories. It is a command-line application 
through which publicly available ebuild repositories can be listed, subscribed to and unsubscribed from, as well as update those repositories. 

It supports both the {{Path|[[Layman#make.conf_method_.28force_old_method.29|make.conf]]}} as well as {{Path|[[Layman#repos.conf_method_.28default.29|repos.conf]]}} method.
* When using the {{Path|[[Layman#make.conf_method_.28force_old_method.29|make.conf]]}} method, {{c|layman}} manages a dedicated configuration file which should be sourced in by {{Path|make.conf}}
* When using {{Path|[[Layman#repos.conf_method_.28default.29|repos.conf]]}}, {{c|layman}} manages the {{Path|[[Layman#repos.conf_method_.28default.29|/etc/portage/repos.conf/layman.conf]]}} file directly

Для более подробной информации ознакомьтесь с [[Layman]] и [[Project:Portage/Sync#Layman_configuration]].

=== emaint ===

Смотрите статью [[Project:Portage/Sync#Operation Sync (из проекта Portage)]] и {{c|man 1 emaint}}.

=== eix ===

{{c|eix-sync}} — обертка, запускающая команду {{c|emerge --sync}} (которая в свою очередь запускает команду {{c|emaint sync --auto}}) и затем {{c|eix-update}}. Подробнее читайте в статье [[Eix]] и в {{c|man 1 eix}}.

== Использование ==

=== Установка пакета, имеющего дубликаты ===

When working with ebuild repositories it is possible to encounter a situation where multiple versions of the same package are available from different ebuild repositories. Instruct [[Portage]] to install a specific package from a specific ebuild repository with the <code>::</code> notation:

{{Emerge|category/atom::ebuild repository-name}}

== Лучшие практики ==

=== Создание кэша ===

When large ebuild repositories are installed, portage may take a long time to perform operations like dependency resolution. This is because ebuild repositories do not usually contain a metadata cache.

Generate a local metadata cache by running {{c|emerge --regen}} after syncing the ebuild repositories:

{{RootCmd
|layman -S
|( ulimit -n 4096 && emerge --regen )}}

Be careful, because {{c|emerge --regen}} takes a lot of time and it's not recommended for rsync users as rsync updates the cache using server-side caches (most of users of portage are rsync users). Rsync users should simply run {{c|emerge --sync}} (or {{c|eix-sync}}) to regenerate the cache. It's probably only users of very large ebuild repositories should try {{c|emerge --regen}}.

=== Masking when using unsafe ebuild repositories ===

When using huge ebuild repositories or those with unknown/low quality it is best practice to hardmask the whole ebuild repository.

{{FileBox|filename=/etc/portage/package.mask|title=Mask all packages in an ebuild repository|lang=bash|1=
*/*::ebuild repository-name
}}

После этого размаскируйте пакеты, которые необходимо установить.

{{FileBox|filename=/etc/portage/package.unmask|title=Unmask a specific package in an ebuild repository|lang=bash|1=
foo/bar::ebuild repository-name
}}

== Смотрите также ==

* [[Project:Overlays|Overlays project]] - The official Gentoo project for ebuild repositories' support.
* [[Project:Overlays/Overlays guide|Overlays guide (Overlay project)]] - A user guide written by the Overlay project.
* [[Project:Overlays/Dev Guide|Developer's guide to Gentoo overlays]] - This document is kept only for historical purposes. The current guide is maintained as [[Project:Overlays/Overlays guide]].
* [[Handbook:Parts/Portage/CustomTree#Defining_a_custom_repository|Defining a custom repository]] - Section in the Gentoo Handbook

== Внешние ресурсы ==

* https://overlays.gentoo.org
* https://github.com/gentoo/


[[Category:Portage]]
