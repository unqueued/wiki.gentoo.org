<languages />
{{InfoBox stack
|{{InfoBox project|Overlays|header=true}}
}}

У пользователей Gentoo Linux есть [https://devmanual.gentoo.org/general-concepts/tree/ "main" (основной) репозиторий пакетов]. [https://gitweb.gentoo.org/repo/gentoo.git/tree/ Основной репозиторий] содержит все пакеты программ (называемые файлами ebuild), которые поддерживаются разработчиками Gentoo. Остальные деревья пакетов обычно доступны посредством ''репозиториев''. Пользователи могут добавлять дополнительные репозитории (традиционно известные как ''оверлеи'' (overlay)).

== Репозитории ==

Package repositories are nothing more (or less) than a [[Repository format|set of files]] (ebuilds, metadata files, ...). These can be pulled in from public repositories ([[Project:Portage/Sync#Portage_configuration|git, CVS, SVN ...]]) or downloaded as tarballs and extracted manually onto the system. It is advised to use managed repositories by [https://overlays.gentoo.org trusted] third parties; any installed ebuild repository will cause Portage to look through the overlaid files when deciding which software to install. If compromised code is in the ebuild repository, then compromised packages could be installed on the system.

В настоящее время, по умолчанию работа с репозиториями осуществляется посредством {{Path|[[:/etc/portage/repos.conf/ru|/etc/portage/repos.conf]]}}. Как и в других случаях при работе с Portage, это может быть файл или каталог.

Определения репозиториев в {{Path|/etc/portage/repos.conf/}} также сообщают Portage, следует ли обновлять тот или иной репозиторий, и если следует, то каким образом. Все репозитории, которые следует обновлять, автоматически обновляются при вызове команды {{c|emerge --sync}}.

Устаревший и не рекомендуемый к использованию, но все еще поддерживаемый способ работы с репозиториями — посредством переменной <var>PORTDIR_OVERLAY</var> в файле {{Path|/etc/portage/make.conf}}. Эта переменная может указывать на одно или более мест в файловой системе, где расположены репозитории. Настоятельно рекомендуется использовать каталог {{Path|[[:/etc/portage/repos.conf/ru|/etc/portage/repos.conf]]/}}.

Для более подробной информации ознакомьтесь с [[:/etc/portage/repos.conf/ru|/etc/portage/repos.conf]] и [[Project:Portage/Sync#Operation|статью Portage/Sync]].

=== Приоритеты ===

У каждого репозитория ebuild-файлов есть уникальный приоритет. Таким образом реализуется недвусмысленное разрешение пакетов, даже если одна и та же версия пакета находится в нескольких репозиториях ebuild-файлов. Файлы ebuild из репозитория ebuild-файлов с более высоким приоритетом (например, 60) предпочитаются файлам ebuild из репозитория ebuild-файлов с более низким приоритетом (например, 50).

Список репозиториев ebuild-файлов и их приоритеты можно получить из вывода следующих команд (найдите строку "Repositories"):

{{Cmd|emerge --info --verbose}}

{{Cmd|portageq repos_config /}}

Gentoo репозиторий имеет приоритет -1000. Это означает, что другие репозиториии ebuild-файлов имеют старшинство, поскольку им присвоен более высокий приоритет. Это поведение используется по умолчанию, так как идея репозиториев ebuild-файлов заключается в том, чтобы "накладываться/перекрывать" Gentoo репозиторий.

== Доступное программное обеспечение ==

Некоторые утилиты поддерживают или специально создавались для репозиториев ebuild-файлов.

=== Layman ===

The {{c|layman}} application makes it easier to manage and update multiple additional ebuild repositories. It is a command-line application through which publicly available ebuild repositories can be listed, subscribed to and unsubscribed from, as well as update those repositories. 

Оно поддерживает как метод {{Path|[[Layman#make.conf_method_.28force_old_method.29|make.conf]]}}, так и метод {{Path|[[Layman#repos.conf_method_.28default.29|repos.conf]]}}.
* При использовании метода {{Path|[[Layman#make.conf_method_.28force_old_method.29|make.conf]]}}, {{c|layman}} работает с отдельным конфигурационным файлом, который читается файлом {{Path|make.conf}}
* При использовании метода {{Path|[[Layman#repos.conf_method_.28default.29|repos.conf]]}}, {{c|layman}} работает непосредственно с файлом {{Path|[[Layman#repos.conf_method_.28default.29|/etc/portage/repos.conf/layman.conf]]}}

Для более подробной информации ознакомьтесь с [[Layman]] и [[Project:Portage/Sync#Layman_configuration]].

=== emaint ===

Смотрите статью [[Project:Portage/Sync#Operation|Sync (из проекта Portage)]] и {{c|man 1 emaint}}.

=== eix ===

{{c|eix-sync}} — обертка, запускающая команду {{c|emerge --sync}} (которая в свою очередь запускает команду {{c|emaint sync --auto}}) и затем {{c|eix-update}}. Подробнее читайте в статье [[Eix]] и в {{c|man 1 eix}}.

== Использование ==

=== Установка пакета, имеющего дубликаты ===

В процессе работы с репозиторием ebuild-файлов может возникнуть ситуация, когда несколько версий одного и того же пакета доступны в нескольких репозиториях ebuild-файлов. Сообщите [[Portage]] о том, что необходимо установить определенный пакет из определенного репозитория ebuild-файлов с помощью <code>::</code> нотации:

{{Emerge|category/atom::repository-name}}

== Лучшие практики ==

=== Создание кэша ===

When large ebuild repositories are installed, Portage may take a long time to perform operations like dependency resolution. This is because ebuild repositories do not usually contain a metadata cache.

Сгенерируйте локальный кэш метаданных, запустив команду {{c|emerge --regen}} после синхронизации репозиториев ebuild-файлов:

{{RootCmd
|emaint sync --allrepos
|( ulimit -n 4096 && emerge --regen )}}

Будьте осторожны, поскольку выполнение команды {{c|emerge --regen}} занимает много времени, и ее не рекомендуется использовать пользователям rsync, поскольку rsync обновляет кэш с помощью кэша на сервере (большинство пользователей portage являются пользователями rsync). Пользователям rsync следует просто запустить {{c|emerge --sync}} (или {{c|eix-sync}}), чтобы повторно сгенерировать кэш. Скорее всего, использовать {{c|emerge --regen}} следует только пользователям очень больших репозиториев ebuild-файлов.

=== Маскировка при использовании небезопасных репозиториев ebuild-файлов ===

При использовании крупных репозиториев ebuild-файлов, а также неизвестных репозиториев или низкого качества, лучше всего замаскировать репозиторий ebuild-файлов жесткой маской.

{{FileBox|filename=/etc/portage/package.mask|title=Mask all packages in an ebuild repository|lang=bash|1=
*/*::repository-name
}}

После этого размаскируйте пакеты, которые необходимо установить.

{{FileBox|filename=/etc/portage/package.unmask|title=Unmask a specific package in an ebuild repository|lang=bash|1=
foo/bar::repository-name
}}

== Смотрите также ==

* [[Project:Overlays|Overlays project]] - The official Gentoo project for ebuild repositories' support.
* [[Project:Overlays/Overlays guide|Overlays guide (Overlay project)]] - A user guide written by the Overlay project.
* [[Project:Overlays/Dev Guide|Developer's guide to Gentoo overlays]] - This document is kept only for historical purposes. The current guide is maintained as [[Project:Overlays/Overlays guide]].
* [[Handbook:Parts/Portage/CustomTree#Defining_a_custom_repository|Defining a custom repository]] - Section in the Gentoo Handbook

== Внешние ресурсы ==

* https://overlays.gentoo.org
* https://github.com/gentoo/


[[Category:Portage]]
