<languages />
{{InfoBox stack
|{{InfoBox project|Overlays|header=true}}
}}

У пользователей Gentoo Linux есть [https://gitweb.gentoo.org/repo/gentoo.git/tree/ "основной" репозиторий пакетов], который в прошлом назывался [https://devmanual.gentoo.org/general-concepts/tree/ "дерево Portage"]. Однако, этот термин следовало бы вывести из употребления, поскольку [[Package Manager Specification|пакетные менеджеры]], отличные от [[Portage]], также могут работать с репозиториями пакетов в Gentoo. [https://gitweb.gentoo.org/repo/gentoo.git/tree/ Основной репозиторий] содержит все пакеты программ (называемые файлами ebuild), которые курируются разработчиками Gentoo. Остальные деревья пакетов обычно доступны посредством ''репозиториев''. Пользователи могут добавлять дополнительные репозитории, которые "накладываются" ("laid over") на основное дерево — отсюда название "оверлей" (overlay).

== Репозитории ==

Репозитории пакетов являются не более (и не менее) чем [[Repository format|наборами файлов]] (файлов ebuild, файлов метаданных, записей ChangeLog ...). Эти файлы можно установить из публичных репозиториев ([[Project:Portage/Sync#Portage_configuration|git, cvs, svn ...]]) или загрузить в виде файлов tarball и распаковать вручную. Рекомендуется использовать managed репозитории trusted третьих сторон. Любой установленный оверлей заставит Portage просматривать "наложенные" оверлеем файлы, чтобы решить, какой пакет следует установить. Если оверлей содержит скомпрометированный код, то скомпрометированные пакеты могут быть установлены в системе.

В настоящее время, по умолчанию работа с репозиториями осуществляется посредством {{Path|[[:/etc/portage/repos.conf/ru|/etc/portage/repos.conf]]}}. Как и в других случаях при работе с Portage, это может быть файл или каталог.

Определения репозиториев в {{Path|/etc/portage/repos.conf/}} также сообщают Portage, следует ли обновлять тот или иной репозиторий, и если следует, то каким образом. Все репозитории, которые следует обновлять, автоматически обновляются при вызове команды {{c|emerge --sync}}.

Устаревший и не рекомендуемый к использованию, но все еще поддерживаемый способ работы с репозиториями — посредством переменной <var>PORTDIR_OVERLAY</var> в файле {{Path|/etc/portage/make.conf}}. Эта переменная может указывать на одно или более мест в файловой системе, где расположены репозитории. Настоятельно рекомендуется использовать каталог {{Path|[[:/etc/portage/repos.conf/ru|/etc/portage/repos.conf]]/}}.

Для более подробной информации ознакомьтесь с [[:/etc/portage/repos.conf|/etc/portage/repos.conf]] и [[Project:Portage/Sync#Operation|Portage/Sync article]].

=== Приоритеты ===

Каждый оверлей имеет уникальный приоритет. Таким образом реализуется недвусмысленное разрешение пакетов, даже если одна и та же версия пакета находится в нескольких оверлеях. Файлы ebuild из оверлеев с более высоким приоритетом (например, 60) предпочитаются файлам ebuild из оверлеев с более низким приоритетом (например, 50).

Список оверлеев и их приоритетов можно получить из вывода следующих команд (найдите строку "Repositories"):

{{Cmd|emerge --info --verbose}}

{{Cmd|portageq repos_config /}}

Основное дерево Gentoo Portage имеет приоритет -1000. Это означает, что другие оверлеи имеют старшинство, поскольку им присвоен более высокий приоритет. Это поведение используется по умолчанию, так как идея оверлеев заключается в том, чтобы "накладываться/перекрывать" дерево Portage.

== Доступное программное обеспечение ==

Некоторые утилиты поддерживают или специально создавались для оверлеев.

=== Layman ===

Приложение {{c|layman}} облегчает управление и обновление дополнительных оверлеев. Это приложение для командной строки, с помощью которого можно выводить список, подписываться и отписываться, а также обновлять общедоступные оверлеи. 

Оно поддерживает как метод {{Path|[[Layman#Using_.27make.conf.27_method_.28older_method.29|make.conf]]}}, так и метод {{Path|[[Layman#Using_.27repos.conf.27_method_.28default_method_for_app-portage.2Flayman-2.3.0_or_later_.29|repos.conf]]}}.
* При использовании метода {{Path|[[Layman#Using_.27make.conf.27_method_.28older_method.29|make.conf]]}}, {{c|layman}} работает с отдельным конфигурационным файлом, который читается файлом {{Path|make.conf}}
* При использовании метода {{Path|[[Layman#Using_.27repos.conf.27_method_.28default_method_for_app-portage.2Flayman-2.3.0_or_later_.29|repos.conf]]}}, {{c|layman}} работает непосредственно с файлом {{Path|[[Layman#Using_.27repos.conf.27_method_.28default_method_for_app-portage.2Flayman-2.3.0_or_later_.29|/etc/portage/repos.conf/layman.conf]]}}

Для более подробной информации ознакомьтесь с [[Layman]] и [[Project:Portage/Sync#Layman_configuration]].

=== emaint ===

Смотрите статью [[Project:Portage/Sync#Operation Sync (из проекта Portage)]] и {{c|man 1 emaint}}.

=== eix ===

{{c|eix-sync}} — обертка, запускающая команду {{c|emerge --sync}} (которая в свою очередь запускает команду {{c|emaint sync --auto}}) и затем {{c|eix-update}}. Подробнее читайте в статье [[Eix]] и в {{c|man 1 eix}}.

== Использование ==

=== Установка пакета, имеющего дубликаты ===

When working with overlays it is possible to encounter a situation where multiple versions of the same package are available from different overlays. Instruct [[Portage]] to install a specific package from a specific overlay with the <code>::</code> notation:

{{Emerge|category/atom::overlay-name}}

== Лучшие практики ==

=== Создание кэша ===

When large overlays are installed, portage may take a long time to perform operations like dependency resolution. This is because overlays do not usually contain a metadata cache.

Generate a local metadata cache by running {{c|emerge --regen}} after syncing the overlays:

{{RootCmd
|layman -S
|( ulimit -n 4096 && emerge --regen )}}

Be careful, because {{c|emerge --regen}} takes a lot of time and it's not recommended for rsync users as rsync updates the cache using server-side caches (most of users of portage are rsync users). Rsync users should simply run {{c|emerge --sync}} (or {{c|eix-sync}}) to regenerate the cache. It's probably only users of very large overlays should try {{c|emerge --regen}}.

=== Masking when using unsafe overlays ===

When using huge overlays or those with unknown/low quality it is best practice to hardmask the whole overlay.

{{FileBox|filename=/etc/portage/package.mask|title=Маскировка всех пакетов в оверлеи|lang=bash|1=
*/*::overlay-name
}}

После этого размаскируйте пакеты, которые необходимо установить.

{{FileBox|filename=/etc/portage/package.unmask|title=Размаскировка некоторых пакетов из оверлея|lang=bash|1=
foo/bar::overlay-name
}}

== Смотрите также ==

* [[Project:Overlays|Overlays project]] - The official Gentoo project for overlays support.
* [[Project:Overlays/Overlays_guide|Overlays guide (Overlay project)]] - A user guide written by the Overlay project.
* [[Project:Overlays/Dev_Guide|Developer's guide to Gentoo overlays]]

== Внешние ресурсы ==

* https://overlays.gentoo.org
* https://github.com/gentoo/


[[Category:Portage]]
