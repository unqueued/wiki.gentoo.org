<languages />
{{InfoBox stack
|{{InfoBox project|Overlays|header=true}}
}}

An ebuild repository, historically known as ''overlay'', is [[Article description::a structure of directories and files used to add and extend packages available to the system's package manager.]] Ebuild repositories are also used by Gentoo developers as training ground and staging area for new ebuilds. Ebuild repositories can contain ebuilds of one or more [[EAPI]]s.

Systems that have Gentoo installed typically have a single ebuild repository available on the system. This main repository, known as the [https://gitweb.gentoo.org/repo/gentoo.git/tree/ Gentoo ebuild repository], contains [[ebuild]]s maintained by official Gentoo developers and members of the community (through the [[Project:Proxy Maintainers|Proxy Maintainers]] project). System administrators can add additional ebuild repositories to the system using various utilities and methods described below.

== Репозитории ==

Репозитории ebuild-файлов являются не более (и не менее) чем [[Repository format|наборами файлов]] (файлов ebuild, файлов метаданных, ...). Эти файлы можно установить из публичных репозиториев ([[Project:Portage/Sync#Portage_configuration|git, CVS, SVN ...]]) или загрузить в виде файлов tarball и распаковать вручную. Рекомендуется использовать управляемые репозитории от [https://overlays.gentoo.org доверенных] третьих сторон. Любой установленный репозиторий ebuild-файлов заставит Portage просматривать "наложенные" файлы, чтобы решить, какой пакет следует установить. Если репозиторий ebuild-файлов содержит скомпрометированный код, то скомпрометированные пакеты могут быть установлены в системе.

В настоящее время, по умолчанию работа с репозиториями осуществляется посредством {{Path|[[:/etc/portage/repos.conf/ru|/etc/portage/repos.conf]]}}. Как и в других случаях при работе с Portage, это может быть файл или каталог.

Определения репозиториев в {{Path|/etc/portage/repos.conf/}} также сообщают Portage, следует ли обновлять тот или иной репозиторий, и если следует, то каким образом. Все репозитории, которые следует обновлять, автоматически обновляются при вызове команды {{c|emerge --sync}}.

Устаревший и не рекомендуемый к использованию, но все еще поддерживаемый способ работы с репозиториями — посредством переменной <var>PORTDIR_OVERLAY</var> в файле {{Path|/etc/portage/make.conf}}. Эта переменная может указывать на одно или более мест в файловой системе, где расположены репозитории. Настоятельно рекомендуется использовать каталог {{Path|[[:/etc/portage/repos.conf/ru|/etc/portage/repos.conf]]/}}.

Для более подробной информации ознакомьтесь с [[:/etc/portage/repos.conf/ru|/etc/portage/repos.conf]] и [[Project:Portage/Sync#Operation|статью Portage/Sync]].

=== Приоритеты ===

У каждого репозитория ebuild-файлов есть уникальный приоритет. Таким образом реализуется недвусмысленное разрешение пакетов, даже если одна и та же версия пакета находится в нескольких репозиториях ebuild-файлов. Файлы ebuild из репозитория ebuild-файлов с более высоким приоритетом (например, 60) предпочитаются файлам ebuild из репозитория ebuild-файлов с более низким приоритетом (например, 50).

Список репозиториев ebuild-файлов и их приоритеты можно получить из вывода следующих команд (найдите строку "Repositories"):

{{Cmd|emerge --info --verbose}}

{{Cmd|portageq repos_config /}}

Gentoo репозиторий имеет приоритет -1000. Это означает, что другие репозиториии ebuild-файлов имеют старшинство, поскольку им присвоен более высокий приоритет. Это поведение используется по умолчанию, так как идея репозиториев ebuild-файлов заключается в том, чтобы "накладываться/перекрывать" Gentoo репозиторий.

== Доступное программное обеспечение ==

Некоторые утилиты поддерживают или специально создавались для репозиториев ebuild-файлов.

=== Layman ===

Приложение {{c|layman}} облегчает управление и обновление дополнительных ebuild репозиториев. Это приложение для командной строки, с помощью которого можно выводить список, подписываться и отписываться, а также обновлять общедоступные ebuild репозитории. 

Оно поддерживает как метод {{Path|[[Layman#make.conf_method_.28force_old_method.29|make.conf]]}}, так и метод {{Path|[[Layman#repos.conf_method_.28default.29|repos.conf]]}}.
* При использовании метода {{Path|[[Layman#make.conf_method_.28force_old_method.29|make.conf]]}}, {{c|layman}} работает с отдельным конфигурационным файлом, который читается файлом {{Path|make.conf}}
* При использовании метода {{Path|[[Layman#repos.conf_method_.28default.29|repos.conf]]}}, {{c|layman}} работает непосредственно с файлом {{Path|[[Layman#repos.conf_method_.28default.29|/etc/portage/repos.conf/layman.conf]]}}

Для более подробной информации ознакомьтесь с [[Layman]] и [[Project:Portage/Sync#Layman_configuration]].

=== emaint ===

Смотрите статью [[Project:Portage/Sync#Operation|Sync (из проекта Portage)]] и {{c|man 1 emaint}}.

=== eix ===

{{c|eix-sync}} — обертка, запускающая команду {{c|emerge --sync}} (которая в свою очередь запускает команду {{c|emaint sync --auto}}) и затем {{c|eix-update}}. Подробнее читайте в статье [[Eix]] и в {{c|man 1 eix}}.

== Использование ==

=== Установка пакета, имеющего дубликаты ===

В процессе работы с репозиторием ebuild-файлов может возникнуть ситуация, когда несколько версий одного и того же пакета доступны в нескольких репозиториях ebuild-файлов. Сообщите [[Portage]] о том, что необходимо установить определенный пакет из определенного репозитория ebuild-файлов с помощью <code>::</code> нотации:

{{Emerge|category/atom::repository-name}}

== Лучшие практики ==

=== Создание кэша ===

Если в системе установлены крупные репозитории ebuild-файлов, то выполнение таких операций, как разрешение зависимостей, может занять у Portage много времени. Это происходит потому что репозитории ebuild-файлов, как правило, не содержат кэш метаданных.

Сгенерируйте локальный кэш метаданных, запустив команду {{c|emerge --regen}} после синхронизации репозиториев ebuild-файлов:

{{RootCmd
|emaint sync --allrepos
|( ulimit -n 4096 && emerge --regen )}}

Будьте осторожны, поскольку выполнение команды {{c|emerge --regen}} занимает много времени, и ее не рекомендуется использовать пользователям rsync, поскольку rsync обновляет кэш с помощью кэша на сервере (большинство пользователей portage являются пользователями rsync). Пользователям rsync следует просто запустить {{c|emerge --sync}} (или {{c|eix-sync}}), чтобы повторно сгенерировать кэш. Скорее всего, использовать {{c|emerge --regen}} следует только пользователям очень больших репозиториев ebuild-файлов.

=== Маскировка установленных, но небезопасных репозиториев ebuild-файлов ===

При использовании крупных репозиториев ebuild-файлов, а также неизвестных репозиториев или низкого качества, лучше всего замаскировать репозиторий ebuild-файлов жесткой маской.

{{FileBox|filename=/etc/portage/package.mask|title=Маскировка всех пакетов в репозитории ebuild-файлов|lang=bash|1=
*/*::repository-name
}}

После этого размаскируйте пакеты, которые необходимо установить.

{{FileBox|filename=/etc/portage/package.unmask|title=Размаскировка некоторых пакетов из репозитория ebuild-файлов|lang=bash|1=
foo/bar::repository-name
}}

== Смотрите также ==

* [[Project:Overlays|Overlays project]] — Официальный проект Gentoo, осуществляющий поддержу репозиториев ebuild-файлов.
* [[Project:Overlays/Overlays guide|Overlays guide (Overlay project)]] — Руководство пользователя, составленное проектом Overlay.
* [[Project:Overlays/Old Dev Guide|Руководство разработчика оверлеев Gentoo]] — Этот документ храниться только в исторических целях. Текущее руководство находиться здесь [[Project:Overlays/Overlays guide]].
* [[Handbook:Parts/Portage/CustomTree/ru#Определение пользовательского репозитория|Определение пользовательского репозитория]] — Раздел в Gentoo Handbook.

== Внешние ресурсы ==

* https://overlays.gentoo.org
* https://github.com/gentoo/
* https://gpo.zugaina.org/Overlays


[[Category:Portage]]
