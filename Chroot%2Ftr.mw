<languages />

Chroot('''Ch'''ange '''root''' - Kökü değiştir), var olan kök dizinden farklı bir dizini kök dizin kabul ederek, ana sistemden mantıken bağımsız bir izole ortama geçiş yapmayı sağlayan bir Unix sistem aracıdır. Bu ortam "chroot hapishanesi" diye de anılır. Bu hapishanede çalışan kullanıcı, kendisine kök olarak tanımlanmış dizinin dışarısını göremez.

Chroot'un ana kullanım alanlarından birisi Linux sistemi içerisinde test veya uyumluluk amaçlı farklı bir sistem ortamı yaratmaktır. Sanallaştırma yazılımı gerektirmediği için genelde sanallaştırmaya hafif bir alternatif olarak görülür.

==Ortamın ayarlanması==

Yeni bir kuruluma başlarken ilk olarak yapmanız gereken işlem chroot olarak kullanılacak dizinin oluşturulmasıdır, örneğin {{Path|/mnt/chrootdizini}}

{{Cmd
|mkdir /mnt/chrootdizini
|cd /mnt/chrootdizini
}}

Farklı bir disk bölümünde zaten var olan bir kurulumu bağlamak isterseniz aşağıdaki komutu çalıştırabilirsiniz. <code><AYGIT></code> yerine kurulumun yapıldığı disk bölümün girdiğinize emin olun:

{{Cmd
|mkdir /mnt/chrootdizini
|mount /dev/AYGIT /mnt/chrootdizini
}}

Zaten bulunduğunuz kök dizinin altında bir kurulum var ise, yukarıdaki adımları uygulamanıza gerek yok.

==Yeni kurulum için sistem ve Portage dosyalarını açma==

Yeni bir kurulum yapıyorsanız, sonraki adım stage3 ve Portage sıkıştırılmış dosyalarını indirip chroot dizini içerisine açmaktır. Detaylı bilgi için [http://www.gentoo.org/doc/en/handbook/handbook-amd64.xml?part=1&chap=5 kurulum dökümanı]nın 5a ve 5b bölümlerine göz atınız.

{{RootCmd
|links http://distfiles.gentoo.org/releases/amd64/current-stage3/
|tar xvjpf stage3-*.tar.bz2 -C /mnt/chrotdizini
|links http://distfiles.gentoo.org/snapshots/
|tar xvjf portage-*.tar.bz2 -C /mnt/chrotdizini/usr
}}

==Yapılandırma==

Chroot'a giriş yapmadan önce bazı dizinleri bağlamamız (mount etmemiz) gerekmekte:

{{RootCmd
|mount -o bind /dev /mnt/chrootdizini/dev
|mount -t proc none /mnt/chrootdizini/proc
|mount -o bind /sys /mnt/chrootdizini/sys
|mount -o bind /tmp /mnt/chrootdizini/tmp
}}

Ayrıca ana sistemden bazı temel yapılandırma dosyalarını da kopyalamalısınız. Bu aşamada {{Path|make.conf}} dosyasını kopyalamayın:

{{Cmd
|cp /etc/portage/make.conf /mnt/mychroot/etc/portage # Yeni kurulum değilse bu adımı es geçin.
|cp /etc/resolv.conf /mnt/mychroot/etc
}}

Once done enter the chroot environment by executing the following commands:

{{RootCmd
|chroot /mnt/mychroot /bin/bash
|env-update
|source /etc/profile
|<nowiki>export PS1="(chroot) $PS1"</nowiki>
}}

When creating a new installation Portage should be synced to make sure everything is up to date.

{{RootCmd
|emerge --sync
}}

The system is now ready; feel free to install software, mess with settings, test experimental packages and configurations without having any effect on the main system. To leave the chroot simply type <kbd>exit</kbd> or press {{Key|Ctrl}}+{{Key|D}}. Doing so will return the console back to the normal environment. Do not forget to umount the directories that have been mounted.

== Init scripts ==

If setting up chroots is a task that is needed to be performed often, it is possible to speed up the mounting of the directories by using an init script:

{{FileBox|filename=/etc/init.d/mychroot|lang=bash|1=
#!/sbin/runscript
 
depend() {
   need localmount
   need bootmisc
}
 
start() {
     ebegin "Mounting chroot directories"
     mount -o rbind /dev /mnt/mychroot/dev > /dev/null &
     mount -t proc none /mnt/mychroot/proc > /dev/null &
     mount -o bind /sys /mnt/mychroot/sys > /dev/null &
     mount -o bind /tmp /mnt/mychroot/tmp > /dev/null &
     eend $? "An error occurred while mounting chroot directories"
}
 
stop() {
     ebegin "Unmounting chroot directories"
     umount -f /mnt/mychroot/dev > /dev/null &
     umount -f /mnt/mychroot/proc > /dev/null &
     umount -f /mnt/mychroot/sys > /dev/null &
     umount -f /mnt/mychroot/tmp > /dev/null &
     eend $? "An error occurred while unmounting chroot directories"
}
}}

When using a different directory or partition, add the necessary mounting commands in the <code>start()</code> function and change {{Path|/mnt/chroot}} to the appropriate name.

== See also ==

* [[Project:X86/Chroot Guide|Chroot Guide]]


[[Category:Core system]]
