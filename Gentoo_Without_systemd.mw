{{Dirty}}

Having trouble with {{Package|sys-apps/systemd}} being pulled in your emerges for no apparent reason? Read this article in order to find out how to resolve this problem.

== Why is systemd pulled in? ==

Most packages depending on systemd, actually depend on systemd '''''or''''' OpenRC '''''or''''' some other init system. Portage will attempt to install the first in the list, which might be systemd.

Portage cannot magically guess which init system the user prefers. USE flags defined user preferences.

== Permanently blocking systemd ==

=== systemd USE flag ===

Add <code>-systemd</code> to the system's USE variable in {{Path|/etc/portage/make.conf}}.

=== Mask systemd and udev ===

In order to explicitly inform Portage to ''never'' install {{Package|sys-apps/systemd}}, a mask is required. 

Masks can be created a two different ways. Either create a directory called {{Path|package.mask}} in {{Path|/etc/portage}} then create individual text files containing lists of packages to be masked ''or'' create a file called {{Path|package.mask}} and organize it all in one big file. Portage will be happy with either method. The choice is left up to the system administrator. Why two ways? Well, it would appear two methods continue to exist for organizational purposes. Some users like having everything defined in one file, while other users like having each set of packages masked in separate directories.

{{FileBox|title=package.mask directory example|filename=/etc/portage/package.mask/systemd|1=
sys-apps/systemd
sys-fs/udev
}}

'''''OR'''''

{{FileBox|title=package.mask FILE example|filename=/etc/portage/package.mask|1=
sys-apps/systemd
sys-fs/udev
}}

Masking udev will not result in a broken system; Portage is smart enough to automatically replace udev by {{Package|sys-fs/eudev}}: the systemd-free fork of udev.

== Troubleshooting ==

=== Packages requiring systemd ===

Some packages have systemd as a non-optional dependency (see: [[Hard_dependencies_on_systemd#A_Systemd_free_system|Hard dependencies_on_systemd]]), as long as systemd is masked, it's impossible to install them, so removing those packages is the only option.

To solve this it is strongly advised to file a bug report to the upstream developer team.
Sometimes alternative packages can be found.

=== How to check whether systemd is installed or not? ===

Portage does '''not''' activate systemd when installing it. Whenever systemd is not activated, the system remains on OpenRC (or whatever init selected).

To remove systemd, it is possible to follow the steps above and update the @world set, or remove it manually:

{{Unmerge|sys-apps/systemd}}

== Remove systemd related files automatically ==

According to the [https://wiki.gentoo.org/wiki/Project:Systemd/Ebuild_policy#General_guidelines official ebuild policy for systemd], unit files are installed unconditionally to the USE flag.

To get around this, we can install a hook for portage to delete these files.

The ebuild for this package can be found in the now defunct [https://github.com/gentoo-sunrise/sunrise/tree/master/app-portage/portage-hooks sunrise-overlay].

{{emerge|app-portage/portage-hooks}}

{{RootCmd|mkdir -p /etc/portage/hooks/pkg_postinst.d}}

{{FileBox|filename=/etc/portage/hooks/pkg_postinst.d/10systemd|1=
rm -rf /etc/systemd/ \
       /usr/lib/systemd/ \
       /run/systemd
}}

[[Category:Init systems]]
