<languages />

Данная статья [[Article description::описывает, как применить обновление BIOS в системе Gentoo]].

Производители оборудования часто предоставляют обновления для своих [[BIOS]] и других типов встроенного ПО. Способ обновления (часто упоминается как "перепрошивка") иногда не так хорош на GNU/Linux системах. Для этого иногда требуется некоторая дополнительная работа.

{{Warning|Если оборудование работает, зачастую нет необходимости в обновлении BIOS. Если что-то пойдет не так, это может привести к неисправимому повреждению BIOS или прошивки, что приведет к потери гарантии. Будьте осторожны!}}

== Сбор информации о прошивке ==

Сперва нужно найти производителя и модель материнской платы. Проверьте пользовательское руководство, которое поставляются вместе с компьютером. Множество нужной информации можно найти в пользовательском руководстве.

Можно использовать пакет {{Package|sys-apps/dmidecode}} для получения дополнительной информации о системном оборудовании. {{c|dmidecode}} смотрит в DMI таблицу материнской платы для того, чтобы найти более подробную информацию о программно-аппаратных и аппаратных компонентах.

{{RootCmd|dmidecode -t bios -t baseboard}}

Наконец, если возможен непосредственный доступ к материнской плате, то можно найти необходимую информацию на самой материнской плате.

{{Warning|Прямой доступ к материнской плате может привести к потере гарантии!}}

После поиска прошивки от производителя, загрузите пакет необходимый для прошивки. Производители могут хранить пакет с обновленной прошивкой в .zip, .exe, или .iso формате. 

{{Cmd|unzip 7235v1A.zip
|output=<pre>Archive:  7235v1A.zip
   creating: 7235v1A/
inflating: 7235v1A/7235v1x.txt
inflating: 7235v1A/AWFL865.EXE
inflating: 7235v1A/How to flash the BIOS.DOC
inflating: 7235v1A/W7235IMS.1A0
</pre>}}

== Вариант с BIOS ==

Многие BIOS имеют возможность прочитать новый образ (в двоичном формате) с внешнего флеш-накопителя или дискеты. Войдите в настройки BIOS и поищите эту возможность в меню. Если BIOS не поддерживает такую возможность, то продолжайте чтение статьи.

== Загрузочный CD ==

Производители зачастую предлагают образ загрузочного CD-ROM. Файл должен быть с расширением {{Path|.iso}}, чтобы надлежащим образом записать на пустой CD-R(W). Один из инструментов, который может это сделать - {{c|cdrecord}}:

{{RootCmd|cdrecord BOOT-CD.iso}}

{{Note|{{c|cdrecord}} предоставляется сразу двумя пакетами. Выберите  один из них: {{Package|app-cdr/cdrtools}} и {{Package|app-cdr/cdrkit}}.}}

Выберите в BIOS загрузку с компакт-диска и выполните инструкции с веб-сайта производителя или из руководства для пользователя.

== Окружение FreeDOS ==

{{Note|В SystemRescueCD присутствует удобный загрузчик FreeDOS, который отлично подойдёт для этого и сохранит много усилий, позволив читателям пропустить данный раздел. Для подробностей см. примечание в конце раздела "Использование SystemRescueCD для загрузки FreeDOS".}}

Можно использовать FreeDOS для запуска основанной на DOS утилиты для обновления BIOS. Сначала нужно создать свой образ FreeDOS, который будет содержать необходимые программы для перепрошивки. После создания образа, загрузите образ с помощью одного из методов, которые описаны ниже.

Скачайте FreeDOS и необходимые программы:

* [https://www.ibiblio.org/pub/micro/pc-stuff/freedos/files/distributions/1.0/ FreeDOS] - скачайте файл {{Path|fdboot.img}}
* [https://www.ibiblio.org/pub/micro/pc-stuff/freedos/files/dos/sys/sys-freedos-linux/ Загрузочный сектор FreeDOS] - скачайте файл {{Path|sys-freedos-linux.zip}}
* Программа перепрошивки и новый BIOS с сайта производителя оборудования

=== Создание пользовательского образа FreeDOS ===

Сперва загрузите необходимое программное обеспечение и включите поддержку устройств обратной петли в ядре:

{{KernelBox|title=Поддержка loopback устройств|1=
Device Drivers  --->
    [*] Block devices  --->
        <M>   Loopback device support
}}

Если модуль не был загружен, то загрузите его с помощью {{c|modprobe}}:

{{RootCmd|modprobe loop}}

Установите необходимые программы:

{{Emerge|dev-lang/nasm app-arch/unzip sys-fs/dosfstools}}

Создайте файл образа размером около 20МБ, используя команду {{c|dd}}. Имя должно быть {{Path|freedos.img}}, если будете заменять файл, который находится на SystemRescueCD:

{{RootCmd|dd if{{=}}/dev/null of{{=}}freedos.img bs{{=}}1024 seek{{=}}20480}}

Создайте файловую систему в образе:

{{RootCmd|mkfs.fat freedos.img}}

Запишите загрузочный сектор в файл с образом:

{{RootCmd|unzip sys-freedos-linux.zip && ./sys-freedos.pl --disk{{=}}freedos.img}}

Теперь скопируйте файлы FreeDOS в новый образ.

Создайте точки монтирования:

{{RootCmd|mkdir -p /mnt/freedos /mnt/freedos_new}}

Смонтируйте изначальный образ:

{{RootCmd|mount -o loop fdboot.img /mnt/freedos}}

Смонтируйте новый образ:

{{RootCmd|mount -o loop freedos.img /mnt/freedos_new}}

Скопируйте файлы системы FreeDOS на новый образ:

{{RootCmd|cp -ar /mnt/freedos/* /mnt/freedos_new/}}

Теперь скопируйте программу для перепрошивки и новый BIOS в файл образа:

{{RootCmd|cp -ar FLASH-PROGRAM BIOS-UPDATE /mnt/freedos_new}}

Размонтируйте оба образа:

{{RootCmd|umount /mnt/freedos_new /mnt/freedos}}

{{Note|DOS может отобразить имена длиной только до 8 символов. Поэтому, возможно, неплохо будет переименовать некоторые из файлов, если длина имен файлов больше этого лимита.}}

== Использование SystemRescueCD для загрузки FreeDOS ==

SystemRescueCD включает в себя версию из FreeDOS. Эта версия может заменить оригинальный образ и создать загрузочное устройство, которое содержит необходимые программы для прожига прошивки.

==== Скачивание SystemRescueCD и подготовка LiveUSB ====

* [https://www.sysresccd.org/Download SystemRescueCD] - скачайте обычный ISO-образ.

=== Создание загрузочного флэш накопителя ===

Используя стандартный метод для создания загрузочного диска SystemRescueCD, скрипт {{Path|usb_inst.sh}} содержит руководство по установке.

{{Warning|Будут удалены все данные на устройстве! Будьте уверены, что важные данные были скопированы перед использованием устройства!}}

Создайте директорию в {{Path|/mnt}}:

{{RootCmd|mkdir /mnt/SysRescueCD}}

Примонтируйте образ CD:

{{RootCmd|mount -o loop systemrescuecd-x86-VERSION.iso /mnt/SysRescueCD}}

Запустите установочный скрипт:

{{RootCmd|/mnt/SysRescueCD/usb_inst.sh}}

Отмонтируйте образ CD:

{{RootCmd|umount /mnt/SysRescueCD}}

{{Note|Если вы просто хотите обновить bios, нет необходимости возиться с образом FreeDOS в SystemRescueCD. После создания загрузочного SystemRescueCD описанным выше способом, примонтируйте usb-устройство. Скопируйте туда обновление bios. Всё сделано! Загрузитесь с usb-устройства и выберете Dos tools ---> FREEDOS в стартовом меню systemrescuecd. Вы найдёте короткое dos-имя вашего файла с обновлением bios в каталоге A:. Если вы его не увидите, попробуйте C:. Я не думаю, что это повредит установку systemrescuecd на usb-устройстве, но, если это произойдёт, достаточно легко создать образ заново, когда всё будет готово.
}}

=== Замена образа FreeDOS ===

Мы собираемся заменить исходный образ FreeDOS на флэш-накопителе с SystemRescueCD.

Смонтируйте флэш-накопитель SystemRescueCD ({{Path|/dev/sdX1}} - имя должно соответствовать имени устройства флэш-накопителя):

{{RootCmd|mount /dev/sdX1 /mnt/SysRescueCD}}

Замените файл {{Path|freedos.img}}:

{{RootCmd|cp freedos.img /mnt/SysRescueCD/bootdisk/}}

Размонтируйте накопитель SystemRescueCD:

{{RootCmd|umount /mnt/SysRescueCD}}

=== Загрузка образа FreeDOS прямо из GRUB ===

Для загрузки FreeDOS без всяких внешних носителей, можно использовать утилиту {{c|memdisk}} из syslinux для того, чтобы позволить grub (или другому загрузчику) загрузить образ FreeDOS.

{{Emerge|sys-boot/syslinux}}

Смонтируйте раздел {{Path|/boot}} (если это необходимо)

{{RootCmd|mount /boot}}

Скопируйте бинарный файл {{c|memdisk}} и созданный образ FreeDOS в {{Path|/boot}}:

{{RootCmd|cp /usr/share/syslinux/memdisk /boot}}
{{RootCmd|cp freedos.img /boot}}

Отредактируйте {{Path|/boot/grub/grub.conf}} и добавьте пункт меню для FreeDOS:

{{FileBox|filename=/boot/grub/grub.conf|title=Пример пункта меню в grub.conf|1=
title FreeDOS (BIOS update)
kernel /boot/memdisk floppy
initrd /boot/freedos.img
}}

=== Обновление BIOS ===

Перезагрузитесь и выберите загрузку с USB накопителя ''или'' новую запись grub. Если используется SystemRescueCD, в приглашении GRUB введите:

{{GenericCmd|freedos}}

Это должно загрузить в новый образ FreeDOS. Должно появиться приглашение DOS:

{{CodeBox|C:\}}

Теперь можно начать перепрошивку BIOS, выполняя инструкции от производителя. Некоторые полезные команды DOS:

;{{c|cd <dir>}}
: Сменить каталог

;{{c|dir}}
: Список файлов в текущем каталоге.

; {{c|type [drive][path]filename}}
: Отображает содержимое файла.

== Flashrom ==

Некоторые материнские платы, возможно, поддерживает перепрошивку (с помощью пакета {{package|sys-apps/flashrom}}) напрямую из системы. В таком случае вам потребуется только образ BIOS. Пожалуйста, сначала проверьте список [https://www.flashrom.org/Supported_hardware поддерживаемого оборудования].

Если железо поддерживается, то проверьте новый образ BIOS:

{{RootCmd|flashrom -v W7235IMS.1A0}}

Если все впорядке, то перепрошейте его:

{{RootCmd|flashrom -vw W7235IMS.1A0}}

== Смотрите также ==

* {{See also|BIOS}}
* {{See also|Bootable DOS USB stick}}

[[Category:Core system]]
[[Category:Firmware]]
