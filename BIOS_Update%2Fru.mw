<languages />
Производители оборудования часто предоставляют обновления для своих BIOS и других типов встроенного ПО. Способ обновления (часто упоминается как "перепрошивка") иногда не так хорош на GNU/Linux системах. Для этого иногда требуется некоторая дополнительная работа.

{{Warning|Если оборудование работает, зачастую нет необходимости в обновлении BIOS. Если что-то пойдет не так, это может привести к неисправимому повреждению BIOS или прошивки, что приведет к потери гарантии. Будьте осторожны!}}

== Сбор информации о прошивке ==

Сперва нужно найти производителя и модель материнской платы. Проверьте пользовательское руководство, которое поставляются вместе с компьютером. Множество нужной информации можно найти в пользовательском руководстве.

Можно использовать пакет {{Package|sys-apps/dmidecode}} для получения дополнительной информации о системном оборудовании. {{c|dmidecode}} смотрит в DMI таблицу материнской платы для того, чтобы найти более подробную информацию о программно-аппаратных и аппаратных компонентах.

{{RootCmd|dmidecode -t bios -t baseboard}}

Наконец, если возможен непосредственный доступ к материнской плате, то можно найти необходимую информацию на самой материнской плате.

{{Warning|Прямой доступ к материнской плате может привести к потере гарантии!}}

После поиска прошивки от производителя, загрузите пакет необходимый для прошивки. Производители могут хранить пакет с обновленной прошивкой в .zip, .exe, или .iso формате. 

{{Cmd|unzip 7235v1A.zip
|output=<pre>Archive:  7235v1A.zip
   creating: 7235v1A/
inflating: 7235v1A/7235v1x.txt
inflating: 7235v1A/AWFL865.EXE
inflating: 7235v1A/How to flash the BIOS.DOC
inflating: 7235v1A/W7235IMS.1A0
</pre>}}

== Вариант с BIOS ==

Многие BIOS имеют возможность прочитать новый образ (в двоичном формате) с внешнего флеш-накопителя или дискеты. Войдите в настройки BIOS и поищите эту возможность в меню. Если BIOS не поддерживает такую возможность, то продолжайте чтение статьи.

== Загрузочный CD ==

Производители зачастую предлагают образ загрузочного CD-ROM. Файл должен быть с расширением {{Path|.iso}}, чтобы надлежащим образом записать на пустой CD-R(W). Один из инструментов, который может это сделать - {{c|cdrecord}}:

{{RootCmd|cdrecord BOOT-CD.iso}}

{{Note|{{c|cdrecord}} предоставляется сразу двумя пакетами. Выберите  один из них: {{Package|app-cdr/cdrtools}} и {{Package|app-cdr/cdrkit}}.}}

Выберите в BIOS загрузку с компакт-диска и выполните инструкции с веб-сайта производителя или из руководства для пользователя.

== Окружение FreeDOS ==

Можно использовать FreeDOS для запуска основанной на DOS утилиты для обновления BIOS. Сначала нужно создать свой образ FreeDOS, который будет содержать необходимые программы для перепрошивки. После создания образа, загрузите образ с помощью одного из методов, которые описаны ниже.

Скачайте FreeDOS и необходимые программы:

* [http://www.ibiblio.org/pub/micro/pc-stuff/freedos/files/distributions/1.0/ FreeDOS] - скачайте файл {{Path|fdboot.img}}
* [http://www.ibiblio.org/pub/micro/pc-stuff/freedos/files/dos/sys/sys-freedos-linux/ Загрузочный сектор FreeDOS] - скачайте файл {{Path|sys-freedos-linux.zip}}
* Программа перепрошивки и новый BIOS с сайта производителя оборудования

=== Создание пользовательского образа FreeDOS ===

Сперва загрузите необходимое программное обеспечение и включите поддержку устройств обратной петли в ядре:

{{KernelBox|title=Поддержка loopback устройств|1=
Device Drivers  --->
    [*] Block devices  --->
        <M>   Loopback device support
}}

Если модуль не бы загружен, то загрузите его с помощью {{c|modprobe}}:

{{RootCmd|modprobe loop}}

Установите необходимые программы:

{{Emerge|dev-lang/nasm app-arch/unzip sys-fs/dosfstools}}

Create an image file of ~20MB using the {{c|dd}} command. The name needs to be {{Path|freedos.img}} when replacing the one on the SystemRescueCD):

{{RootCmd|dd if{{=}}/dev/null of{{=}}freedos.img bs{{=}}1024 seek{{=}}20480}}

Создайте файловую систему в образе:

{{RootCmd|mkfs.msdos freedos.img}}

Запишите загрузочный сектор в файл с образом:

{{RootCmd|unzip sys-freedos-linux.zip && ./sys-freedos.pl --disk{{=}}freedos.img}}

Now copy the FreeDOS files to the new image.

Create the mountpoints:

{{RootCmd|mkdir -p /mnt/freedos /mnt/freedos_new}}

Mount the original image:

{{RootCmd|mount -o loop fdboot.img /mnt/freedos}}

Mount the new image:

{{RootCmd|mount -o loop freedos.img /mnt/freedos_new}}

Copy the FreeDOS system files to the new image:

{{RootCmd|cp -ar /mnt/freedos/* /mnt/freedos_new/}}

Now copy the flash program and the new BIOS to the image file:

{{RootCmd|cp -ar FLASH-PROGRAM BIOS-UPDATE /mnt/freedos_new}}

Unmount both images:

{{RootCmd|umount /mnt/freedos_new /mnt/freedos}}

{{Note|DOS может отобразить имена длиной только до 8 символов. Поэтому, возможно, неплохо будет переименовать некоторые из файлов, если длина имен файлов больше этого лимита.}}

== Использование SystemRescueCD для загрузки FreeDOS ==

The SystemRescueCD comes with a version of FreeDOS. This version can replace the original image and create a bootable memory stick which contains the needed programs to flash the firmware.

==== Скачивание SystemRescueCD и подготовка LiveUSB ====

* [http://www.sysresccd.org/Download SystemRescueCD] - скачайте обычный ISO-образ.

=== Создание загрузочного флэш накопителя ===

Use the default method to create the SystemRescueCD boot medium, the script {{Path|usb_inst.sh}} will provide guidance through the installation.

{{Warning|This will delete any data on the memory stick! Be sure all data has been properly backed up before using the memory stick for this task!}}

Создайте директорию в {{Path|/mnt}}:

{{RootCmd|mkdir /mnt/SysRescueCD}}

Примонтируйте образ CD:

{{RootCmd|mount -o loop systemrescuecd-x86-VERSION.iso /mnt/SysRescueCD}}

Запустите установочный скрипт:

{{RootCmd|/mnt/SysRescueCD/usb_inst.sh}}

Отмонтируйте образ CD:

{{RootCmd|umount /mnt/SysRescueCD}}

=== Замена образа FreeDOS ===

Мы собираемся заменить исходный образ FreeDOS на флэш-накопителе с SystemRescueCD.

Смонтируйте флэш-накопитель SystemRescueCD ({{Path|/dev/sdX1}} - имя должно соответствовать имени устройства флэш-накопителя):

{{RootCmd|mount /dev/sdX1 /mnt/SysRescueCD}}

Замените файл {{Path|freedos.img}}:

{{RootCmd|cp freedos.img /mnt/SysRescueCD/bootdisk/}}

Размонтируйте накопитель SystemRescueCD:

{{RootCmd|umount /mnt/SysRescueCD}}

=== Загрузка образа FreeDOS прямо из GRUB ===

To boot FreeDOS without any external media use the {{c|memdisk}} tool from syslinux to allow grub (or another bootloader) to boot the FreeDOS image directly.

{{Emerge|sys-boot/syslinux}}

Смонтируйте раздел {{Path|/boot}} (если это необходимо)

{{RootCmd|mount /boot}}

Скопируйте бинарный файл {{c|memdisk}} и созданный образ FreeDOS в {{Path|/boot}}:

{{RootCmd|cp /usr/share/syslinux/memdisk /boot}}
{{RootCmd|cp freedos.img /boot}}

Отредактируйте {{Path|/boot/grub/grub.conf}} и добавьте пункт меню для FreeDOS:

{{FileBox|filename=/boot/grub/grub.conf|title=Пример пункта меню в grub.conf|1=
title FreeDOS (BIOS update)
kernel /boot/memdisk floppy
initrd /boot/freedos.img
}}

=== Обновление BIOS ===

Перезагрузитесь и выберите загрузку с USB накопителя ''или'' новую запись grub. Если используется SystemRescueCD, в приглашении GRUB введите:

{{GenericCmd|freedos}}

Это должно загрузить в новый образ FreeDOS. Должно появиться приглашение DOS:

{{CodeBox|C:\}}

Теперь можно начать перепрошивку BIOS, выполняя инструкции от производителя. Некоторые полезные команды DOS:

; {{c|cd <dir>}}
: Change to the directory.

; {{c|dir}}
: List the files in the current directory.

; {{c|type [drive][path]filename}}
: Display the contents of a file.

== Flashrom ==

Некоторые материнские платы, возможно, поддерживает перепрошивку (с помощью пакета {{package|sys-apps/flashrom}}) напрямую из системы. В таком случае вам потребуется только образ BIOS. Пожалуйста, сначала проверьте список [http://www.flashrom.org/Supported_hardware поддерживаемого оборудования].

Если железо поддерживается, то проверьте новый образ BIOS:

{{RootCmd|flashrom -v W7235IMS.1A0}}

Если все впорядке, то перепрошейте его:

{{RootCmd|flashrom -vw W7235IMS.1A0}}

== Смотрите также ==

* [[Bootable DOS USB stick]]

[[Category:Core system]]
