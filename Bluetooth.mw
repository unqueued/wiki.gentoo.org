{{InfoBox stack
|{{InfoBox wikipedia|header=true}}
}}
This article describes the setup of '''bluetooth''' controllers.

== Installing ==

=== Prerequisites ===
Bluez uses [[udev]], so set it up first.

=== Kernel ===
You need [[USB]] and/or [[PC-Card]] support. Also you need to activate the following kernel options:
{{Kernel||<pre>
[*] Networking support  --->
    <*> Bluetooth subsystem support  --->
        
        Select options for Bluetooth applications, see table below:
        <*>   ...

            Bluetooth device drivers  --->

               Select a Bluetooth HCI driver, e.g.:
               <*> HCI USB driver (btusb)
</pre>}}

{| class="wikitable"
|+ Bluetooth applications
|-
! Option
! Driver
! Description
|-
| RFCOMM protocol support || rfcomm || [[Wikipedia:RFCOMM|RFCOMM]] is a requirement of the [[Wikipedia:OBEX|OBEX]]-file transfer, dialup connections and more bluetooth applications.
|-
| RFCOMM TTY support || - || Enables [[terminal emulator]] connections over RFCOMM.
|-
| BNEP protocol support || bnep || Enables network support, e.g. for the [[Wikipedia:Personal Area Network|PAN]] profile.
|-
| Multicast filter support || - || Enables multicast filter support.
|-
| Protocol filter support || - || Enables protocoll filter support.
|-
| HIDP protocol support || hidp || Enables input device support. See the [[Bluetooth Input devices]] article.
|}

=== Software ===
Portage knows the global USE flag ''bluetooth'' for enabling support for Bluetooth in other packages. Enabling this USE flag will pull in {{Package|net-wireless/bluez}} automatically:
{{File|/etc/portage/make.conf||
USE{{=}}"... bluetooth ..."
}}
The USE flags of bluez are:
{{USEflag|package=net-wireless/bluez
|alsa+yes
|consolekit+yes
|cups+yes
|debug
|gstreamer
|pcmcia
|readline+yes
|selinux++no
|test-programs
|usb+yes
}}

After setting this you want to update your system so the changes take effect:
{{Emerge|params+=--changed-use --deep|@world}}

== Configuration ==

=== Service ===
You can now start bluetooth:
{{RootCmd|/etc/init.d/bluetooth start}}
To start bluetooth at boot time, add it your default runlevel:
{{RootCmd|rc-update add bluetooth default}}

=== Permissions ===
If you have the USE flag '''''acl''''' enabled globally and are using [[ConsoleKit]] (i.e you're using a ''desktop'' [[profile]]) permissions to bluetooth devices will be handled automatically.

A broader solution is to add the user you want to be able to access bluetooth devices to the ''plugdev'' group:
{{RootCmd|gpasswd -a larry plugdev}}

== Usage ==

=== Device Attach/Pairing ===
Before a device can be used, it must be attached (''paired'' in Bluetooth-lingo). This is done by entering a PIN (or other code) on both devices.

{{Note|Some simple devices like headsets do not allow entering an arbitrary PIN, they always use the same one (usually 0000 or 9999). Check the manual of your device which is to be used.}}

In order to pair, you must first have the interaction agent active. Most desktop environments have bluetooth integration so will automatically support the interaction agent. For example, KDE has {{Package|net-wireless/bluedevil}}. 

=== Using the simple-agent ===
Configuration can either be performed using the BlueZ test programs (available if you enable the test-programs USE flag for bluez), or by using the D-Bus API. The first way is described here.

The first step to do is to retrieve the address of the mouse. Most of the devices need you to press a special button, possibly for several seconds, to render them discoverable. 
{{RootCmd|hcitool scan|output=<pre>
Scanning ...
	00:1F:20:1D:1B:4B	Bluetooth Laser Travel Mouse
</pre>}}
Where 00:1F:20:1D:1B:4B is the MAC address for your device.


The second step to do is to pair the device:
{{RootCmd|simple-agent hci0 00:1F:20:1D:1B:4B|output=<pre>
RequestPinCode (/org/bluez/1664/hci0/dev_00_1F_20_1D_1B_4B)
Enter PIN Code: 0000
Release
New device (/org/bluez/1664/hci0/dev_00_1F_20_1D_1B_4B)
</pre>}}
Enter a PIN and press {{Key|Enter}}, then enter the same PIN at the device. If you don't know the PIN, then it is probably 0000. It could be 1234.

If you get the following output, it means that you already have an interaction agent running on your system:
{{RootCmd|simple-agent|output=<pre>
dbus.exceptions.DBusException: org.bluez.Error.AlreadyExists: Already Exists
</pre>}}



The third step is to mark the device as trusted so it can connect automatically: 
{{RootCmd|bluez-test-device trusted 00:1F:20:1D:1B:4B yes|output=<pre>

</pre>}}
That should return you to a prompt with no output. To test if it's trusted issue "bluez-test-device trusted 00:1F:20:1D:1B:4B" without yes:
{{RootCmd|bluez-test-device trusted 00:1F:20:1D:1B:4B|output=<pre>
1
</pre>}}
If you get 1 then it is trusted. 0 is the default value (not trusted) - you want that to change to 1 (trusted).



The fourth step is to connect the device (this only needs to be done once, it will be done automatically after that): 
{{RootCmd|bluez-test-input connect 00:1F:20:1D:1B:4B|output=<pre>

</pre>}}
This should also return you to a prompt, and the device should now be paired and working.

You are now ready to proceed.

== Desktop integration ==
* {{Package|net-wireless/bluedevil}} for [[KDE]]
* {{Package|net-wireless/blueman}} for [[GNOME]], [[Xfce]], GTK+

== See also ==
* [[Bluetooth Input devices]]
* [[Bluetooth Headset]]

[[Category:Interfaces]]
