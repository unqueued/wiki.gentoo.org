{{InfoBox stack
  |{{InfoBox wikipedia|Bluetooth|header=true}}
}}
This article describes the setup of a bluetooth controller.

== Installing ==

=== Kernel ===
You need [[USB]] and/or [[PC-Card]] support. Also you need to activate the following kernel options:
{{Kernel||
[*] Networking support  --->
    <*> Bluetooth subsystem support  --->
{{User:Astaecker/Kernel table|level=3
  |{{User:Astaecker/Kernel table row|RFCOMM protocol support|rfcomm|[[Wikipedia:RFCOMM|RFCOMM]] is a requirement of the [[Wikipedia:OBEX|OBEX]]-file transfer, dialup connections and more bluetooth applications.}}
  |{{User:Astaecker/Kernel table row|RFCOMM TTY support|sub|Enables [[terminal]] connections over RFCOMM.}}
  |{{User:Astaecker/Kernel table row|BNEP protocol support|bnep|Enables network support, e.g. for the [[Wikipedia:Personal Area Network|PAN]] profile.}}
  |{{User:Astaecker/Kernel table row|Multicast filter support|sub|Enables multicast filter support.}}
  |{{User:Astaecker/Kernel table row|Protocol filter support|sub|Enables protocoll filter support.}}
  |{{User:Astaecker/Kernel table row|HIDP protocol support|hidp|Enables input device support. See the [[Bluetooth Input devices]] article.}}
}}
{{Clear}}


            Bluetooth device drivers  --->
{{User:Astaecker/Kernel table|level=4
  |{{User:Astaecker/Kernel table row|HCI USB driver|btusb|Generic bluetooth USB controller driver.}}
}}
{{Clear}}
}}

=== Software ===
Portage knows the global USE flag ''bluetooth'' for enabling support for Bluetooth in other packages. Enabling this USE flag will pull in {{Package|net-wireless/bluez}} automatically:
{{File|/etc/make.conf||
USE{{=}}"... bluetooth ..."
}}
The USE flags of bluez are:
{{USEflag|package=net-wireless/bluez
|alsa+yes
|consolekit+yes
|cups+yes
|debug
|gstreamer
|pcmcia
|readline+yes
|test-programs
|usb+yes
}}

After setting this you want to update your system so the changes take effect:
{{RootCmd|emerge --ask --changed-use --deep world}}

== Configuration ==

=== Service ===
You can now start bluetooth:
{{RootCmd|/etc/init.d/bluetooth start}}
To start bluetooth at boot time, add it your default runlevel:
{{RootCmd|rc-update add bluetooth}}

=== Permissions ===
If you have the USE flag '''''acl''''' enabled globally and are using ConsoleKit (i.e you're using a Desktop profile) permissions to bluetooth devices will be handled automatically.

A broader solution is to add the user you want to be able to access bluetooth devices to the ''plugdev'' group:
{{RootCmd|gpasswd -a larry plugdev}}

== Usage ==

=== Device Attach/Pairing ===
Before a device can be used, it must be attached (''paired'' in Bluetooth-lingo). This is done by entering a PIN (or other code) on both devices.

{{Note|Some simple devices like headsets do not allow entering an arbitrary PIN, they always use the same one (usually 0000 or 9999). Check the manual of your device which is to be used.}}

In order to pair, you must first have the interaction agent active. Most desktop environments have bluetooth integration so will automatically support the interaction agent. For example, KDE has {{Package|net-wireless/bluedevil}}. 

=== Using the simple-agent ===
To help debugging bluetooth interaction (without the overhead of desktop environment libraries), the bluez package provides the '''simple-agent''' application. It is installed if the ''test-programs'' USE flag is set.

{{RootCmd
|simple-agent
|output=<pre>
Agent registered
</pre>}}

If you get the following output, it means that you already have an interaction agent running on your system:
 
{{GenericCmd|<pre>
dbus.exceptions.DBusException: org.bluez.Error.AlreadyExists: Already Exists</pre>
}}

To scan for devices, use the '''hcitool''':

{{RootCmd|hcitool scan|output=<pre>
Scanning ...
        00:24:7C:2F:92:7C       orange Nokia E71
</pre>}}

The '''hcitool''' can also be used to attach a device:

{{RootCmd|hcitool cc 00:24:7C:2F:92:7C && hcitool auth 00:24:7C:2F:92:7C}}

Any interaction requirement is handled through the '''simple-agent''' application (or the interaction agent of your preferred desktop environment).

{{GenericCmd|<pre>RequestPinCode (/org/bluez/13983/hci0/dev_00_24_7C_2F_92_7C)
 Enter PIN Code: 1234</pre>
}}

Enter a PIN and press {{Key|Enter}}, then enter the same PIN at the device.

You are now ready to proceed.

== Desktop integration ==
* {{Package|net-wireless/bluedevil}} for [[KDE]]
* {{Package|net-wireless/blueman}} for [[GNOME]], [[Xfce]], GTK+

== Compatible Devices ==
A few guides and resources have been written to help with enabling particular bluetooth devices:
* [[Bluetooth Input devices|Input devices]]
* [[Bluetooth Headset|Headset]]
* [[Bluetooth Modem|Modem]]

[[Category:Interfaces]]
