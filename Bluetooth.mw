{{InfoBox stack
|{{InfoBox wikipedia|header=true}}
}}
This article describes the setup of Bluetooth controllers.

== Installing ==

=== Prerequisites ===
This article assumes that [[udev]] (if using BlueZ 4), [[USB]] and/or [[PC-Card]] have been previously configured.

=== Kernel ===
Use the table below to determine which Bluetooth subsystem you need to enable. In most cases enabling RFCOMM, HIDP, HCI USB and/or HCI UART will be sufficient. 
{{Kernel||<pre>
[*] Networking support --->
      <*>   Bluetooth subsystem support --->
              <*>   RFCOMM protocol support
              [ ]     RFCOMM TTY support
              < >   BNEP protocol support
              [ ]     Multicast filter support
              [ ]     Protocol filter support
              <*>   HIDP protocol support
                    Bluetooth device drivers --->
                      <*> HCI USB driver
                      <*> HCI UART driver
                      [ ]   UART (H4) protocol support
                      [ ]   BCSP protocol support
                      [ ]   Atheros AR300x serial support
                      [ ]   HCILL protocol support
                      [ ]   Three-wire UART (H5) protocol support
      <*>   RF switch subsystem support --->
</pre>}}
{| class="wikitable"
|+ Bluetooth subsystem support
|-
! Option
! Driver
! Description
|-
| RFCOMM protocol support || rfcomm || [[Wikipedia:RFCOMM|RFCOMM]] is a requirement of the [[Wikipedia:OBEX|OBEX]] file transfer, dialup connections and more Bluetooth applications.
|-
| RFCOMM TTY support || - || Enables [[terminal emulator]] connections over RFCOMM.
|-
| BNEP protocol support || bnep || Enables network support, e.g. for the [[Wikipedia:Personal Area Network|PAN]] profile.
|-
| Multicast filter support || - || Enables multicast filter support.
|-
| Protocol filter support || - || Enables protocol filter support.
|-
| HIDP protocol support || hidp || Enables input device support. See the [[Bluetooth Input devices]] article.
|-
| HCI USB driver || btusb || Enables USB Bluetooth device support.
|-
| HCI UART driver || hci_uart || Enables UART based PCMCIA and CF Bluetooth device support.
|}

=== Software ===
The Bluetooth userspace utilities are provided by BlueZ ({{Package|net-wireless/bluez}}). Portage provides ebuilds for BlueZ 4 (deprecated) and BlueZ 5.

You can enable Bluetooth support globally by adding ''bluetooth'' to the USE variable:
{{File|/etc/portage/make.conf||<pre>
USE="bluetooth"
</pre>}}

Portage will prefer BlueZ 5 over BlueZ 4. If you require BlueZ 4 you can mask BlueZ 5.
{{File|/etc/portage/package.mask||<pre>
net-wireless/bluez:0/3
</pre>}}

You should update your system if you enabled the ''bluetooth'' USE flag globally. This will automatically install BlueZ.
{{Emerge
|@world
|params+=--changed-use --deep}}

You will need to manually install BlueZ if you didn't enable the ''bluetooth'' USE flag globally.
{{Emerge|net-wireless/bluez}}

== Configuration ==

=== Boot service ===
You can now start Bluetooth:
{{RootCmd|/etc/init.d/bluetooth start}}
To start Bluetooth at boot time, add it your default runlevel:
{{RootCmd|rc-update add bluetooth default}}

=== Permissions ===
If you have the ''acl'' USE flag enabled globally and are using [[ConsoleKit]] (i.e. you're using a desktop [[profile]]), then permissions for Bluetooth devices will be handled automatically.

A broader solution is to add the user you want to be able to access Bluetooth devices to the ''plugdev'' group:
{{RootCmd|gpasswd -a ''user'' plugdev}}

=== Adapter Information ===
Check that your Bluetooth adapter is working.
{{Cmd|hcitool dev|output=<pre>
Devices:
	hci1	00:02:72:2F:A9:33
	hci0	60:D8:19:B6:C3:1F
</pre>}}
Where hci0 is the first device ID and 60:D8:19:B6:C3:1F is the MAC address.
{{Note|In this case there are two adapters but only one is required.}}
{{Note|If no adapters are found. Check that your Bluetooth adapter is enabled. This may be a physical switch or keyboard function key. {{Package|net-wireless/rfkill}} is helpful for determining and setting the state of wireless adapters.}}

=== Bring interface up at bootup time ===
In case you need to use trusted Bluetooth devices before a GUI is up and running, you can use an udev rule:
{{File|/etc/udev/rules.d/10-local.rules||
# Set bluetooth power up
ACTION{{=}}{{=}}"add", KERNEL{{=}}{{=}}"hci0", RUN+{{=}}"/usr/bin/hciconfig hci0 up"
}}

== Usage ==
===BlueZ 4 ===
==== Device Attach/Pairing ====
Before a device can be used, it must be attached (''paired'' in Bluetooth terminology). This is done by entering a PIN (or other code) on both devices.

{{Note|Some simple devices like headsets do not allow entering an arbitrary PIN, they always use the same one (usually 0000 or 9999). Check the manual of your device which is to be used.}}

In order to pair, you must first have the interaction agent active. Most desktop environments have Bluetooth integration so will automatically support the interaction agent. For example, KDE has {{Package|net-wireless/bluedevil}}.

After an upgrade to BlueZ 5, pairing has to be redone.

==== Using simple-agent ====
Configuration can either be performed using the BlueZ test programs (available if you enable the test-programs USE flag for {{Package|net-wireless/bluez}}), or by using the D-Bus API. The first way is described here.


* Retrieve the address of the mouse. Most of the devices need you to press a special button, possibly for several seconds, to render them discoverable. 
{{Cmd|hcitool scan|output=<pre>
Scanning ...
	00:1F:20:1D:1B:4B	Bluetooth Laser Travel Mouse
</pre>}}
: Where 00:1F:20:1D:1B:4B is the MAC address for your device.


* Pair the device:
{{Cmd|simple-agent hci0 00:1F:20:1D:1B:4B|output=<pre>
RequestPinCode (/org/bluez/1664/hci0/dev_00_1F_20_1D_1B_4B)
Enter PIN Code: 0000
Release
New device (/org/bluez/1664/hci0/dev_00_1F_20_1D_1B_4B)
</pre>}}
: Enter a PIN and press {{Key|Enter}}, then enter the same PIN at the device. If you don't know the PIN, then it is probably 0000. It could be 1234.

{{Note|<br />
{{Cmd|simple-agent hci0 00:1F:20:1D:1B:4B|output=<pre>
dbus.exceptions.DBusException: org.bluez.Error.AlreadyExists: Already Exists
</pre>}}
: Means that you already have an interaction agent running on your system.}}


* Mark the device as trusted so it can connect automatically: 
{{Cmd|bluez-test-device trusted 00:1F:20:1D:1B:4B yes}}


* Devices are not trusted by default. You can check trust status by leaving off the "yes" from the previous command.
{{Cmd|bluez-test-device trusted 00:1F:20:1D:1B:4B|output=<pre>
1
</pre>}}
: "1" is trusted, "0" is not trusted.


* Connect the device (this only needs to be done once, it will be done automatically after that): 
{{Cmd|bluez-test-input connect 00:1F:20:1D:1B:4B}}


* Your device should now be paired. You are now ready to proceed.

=== BlueZ 5 ===

* Start bluetoothctl.
{{Cmd|bluetoothctl}}

==== Controller setup ====

* List the available controllers.
{{Cmd|list|prompt=[bluetooth]#|color=blue}}

* Display information about a controller.
{{Cmd|show ''controller_mac_address''|prompt=[bluetooth]#|color=blue}}

* Set the default controller.
{{Cmd|select ''controller_mac_address''|prompt=[bluetooth]#|color=blue}}

* Power on the controller.
{{Cmd|power on|prompt=[bluetooth]#|color=blue}}

==== Device pairing ====

* Enable the agent and set it as default.
{{Cmd
|agent on
|default-agent
|prompt=[bluetooth]#|color=blue}}

* Set the controller as discoverable (temporarily for 3 minutes) and pairable.
{{Cmd
|discoverable on
|pairable on
|prompt=[bluetooth]#|color=blue}}

* Scan for devices.
{{Cmd|scan on|prompt=[bluetooth]#|color=blue}}

* Put the device into pairing mode.

* Discover the device MAC address.
{{Cmd|devices|prompt=[bluetooth]#|color=blue}}

* Pair with the device.
{{Cmd|pair ''device_mac_address''|prompt=[bluetooth]#|color=blue}}

* If requested enter the PIN code.
{{Cmd|PIN code: ####|prompt=[agent]|color=red}}

* Trust the device.
{{Cmd|trust ''device_mac_address''|prompt=[bluetooth]#|color=blue}}

* Connect to the device.
{{Cmd|connect ''device_mac_address''|prompt=[bluetooth]#|color=blue}}

* Display information about the device.
{{Cmd|info ''device_mac_address''|prompt=[bluetooth]#|color=blue}}

== Desktop integration ==
* {{Package|net-wireless/bluedevil}} for [[KDE]]
* {{Package|net-wireless/blueman}} for [[GNOME]], [[Xfce]], GTK+

== See also ==
* [[Bluetooth Headset]]
* [[Bluetooth Input devices]]
* [[Bluetooth Network Aggregation Point]]
* [http://www.elstel.org/MobilePhone.html Bluetooth Pairing and Applications for Synchronizing Phone Numbers, SMS-messages, Phone Call Entries, your Calendar and Time; Tethering]
[[Category:Interfaces]]
