== Background ==
 oVirt project is a complete open sourced virtualization management platform working with kvm.
 More can be found here: http://www.ovirt.org/
 Additional information (including presentations) from a Workshop held early this November is
 available here: http://www.ovirt.org/wiki/Workshop_November_2011

 The Project is made of an Engine core, which is the backend server.
 Every hypervisor should have a VDSM agent installed, which is the agent the core will use to manage that host.
 Additionally there's a client side which is UI (GWT based) and/or RESTful API.

== Description ==
 This article will try to explain how to install oVirt on Gentoo system using instructions from ovirt.org.
== Important ==
 This manual is what I did on my Gentoo server. If you have different install, which you probably do, you might not strictly do copy/paste and some additional steps might be necessary!!!
== Install procedure ==
=== Step 1: vdsm ===
 <nowiki>
$> emerge dev-python/pyflakes (needed by vdsm)</nowiki>

* Install vdsm
** Get srpm 
 <nowiki>
$> wget -c http://fsimonce.fedorapeople.org/vdsm/fedora-16/SRPMS/vdsm-4.9.0-0.200.g2fc4e63.fc16.src.rpm</nowiki>
** Turn it to tgz
 <nowiki>
$> rpm2tgz vdsm-4.9.0-0.200.g2fc4e63.fc16.src.rpm</nowiki>
** Unpack
 <nowiki>
$> tar zxvf vdsm-4.9.0-0.200.g2fc4e63.fc16.src.tgz</nowiki>

and install it from source code.

=== Step 2: JDK ===
- Sun JDK >=1.6.0.24 should work well
 <nowiki>
$> emerge -DuNavt sun-jdk</nowiki>

=== Step 3: J2EE server- JBoss ===
* For now, simply put JBoss' upstream server binaries.
* TODO: create a wrapping ebuild.
* TODO2: (for the bold): try compiling JBoss from source and create the ultimate ebuild ;)

 <nowiki>
$> wget http://sourceforge.net/projects/jboss/files/JBoss/JBoss-5.1.0.GA/jboss-5.1.0.GA-jdk6.zip/download
$> unzip jboss-5.1.0.GA-jdk6.zip
$> mv jboss-5.1.0.GA /usr/local/jboss-5.1.0.GA</nowiki>

* Folder should be owned by the developer user, so you'll be able to deploy build products into JBoss.
* Test that JBoss is working
** Run /usr/local/jboss-5.1.0.GA/bin/run.sh

* Run with -b 0.0.0.0 to have it bind to all IP addresses; 
* Troubleshooting... when you're being attacked by exceptions, follow this list;
** Verify folder owner....
** For external connections, make sure your FW allows 8080 incoming traffic
** If your machine has and selinux policy installed, make sure it will not block JBoss 
** Used TCP ports: 8080/8443/8083/1090/4457/...
*** May be used by other applications. Either close other application or change JBoss configuration<BR> (check /usr/local/jboss-5.1.0.GA/server/default/deploy/jbossweb.sar/server.xml)
** Since JBoss binds to the hostname, your hostname should be resolvable, or you may add it to /etc/hosts for local resolution.
 <nowiki>
127.0.0.1       localhost engine-dev</nowiki>

=== Step 4: Build tools ===

* git
 <nowiki>
$> emerge -DuNavt git</nowiki>

* Maven: current supported version is 2.2.1(!)
 <nowiki>
$> emerge -DuNavt =dev-java/maven-bin-2.2.1</nowiki>

* Setup the needed repositories for Maven
** Copy paste the content of the file below into ~/.m2/settings.xml 
 <nowiki>
<?xml version="1.0"?>

<settings xmlns="http://maven.apache.org/POM/4.0.0"
          xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
          xsi:schemaLocation="http://maven.apache.org/POM/4.0.0
          http://maven.apache.org/xsd/settings-1.0.0.xsd">

<!--**************************** PROFILES ****************************-->

        <activeProfiles>
                <activeProfile>oVirtEnvSettings</activeProfile>
        </activeProfiles>

        <profiles>
                <profile>
                        <id>oVirtEnvSettings</id>
                        <properties>
                                <jbossHome>/usr/local/jboss-5.1.0.GA</jbossHome>
                                <JAVA_1_6_HOME>/usr/lib/jvm/sun-jdk-1.6</JAVA_1_6_HOME>
                        </properties>
                        <repositories>
                                 <repository>
                                    <id>jboss-public-repository-group</id>
                                    <name>JBoss Public Maven Repository Group</name>
                                    <url>https://repository.jboss.org/nexus/content/groups/public</url>
                                    <layout>default</layout>
                                    <releases>
                                       <enabled>true</enabled>
                                       <updatePolicy>never</updatePolicy>
                                    </releases>
                                    <snapshots>
                                       <enabled>true</enabled>
                                       <updatePolicy>never</updatePolicy>
                                    </snapshots>
                                </repository>
                                <repository>
                                    <id>repository.jboss.org</id>
                                    <url>http://repository.jboss.org/maven2</url>
                                    <releases>
                                    </releases>
                                    <snapshots>
                                       <enabled>false</enabled>
                                    </snapshots>
                                </repository>

                                <repository>
                                    <id>jboss-deprecated-repository-group</id>
                                    <name>JBoss Deprecated Maven Repository Group</name>
                                    <url>https://repository.jboss.org/nexus/content/repositories/deprecated/</url>
                                    <releases>
                                       <enabled>true</enabled>
                                       <updatePolicy>never</updatePolicy>
                                    </releases>
                                    <snapshots>
                                       <enabled>true</enabled>
                                       <updatePolicy>never</updatePolicy>
                                    </snapshots>
                                </repository>
                        </repositories>

                        <pluginRepositories>
                                <pluginRepository>
                                   <id>jboss-public-repository-group</id>
                                   <name>JBoss Public Maven Repository Group</name>
                                   <url>https://repository.jboss.org/nexus/content/groups/public-jboss/</url>
                                   <layout>default</layout>
                                   <releases>
                                      <enabled>true</enabled>
                                      <updatePolicy>never</updatePolicy>
                                   </releases>
                                   <snapshots>
                                      <enabled>true</enabled>
                                      <updatePolicy>never</updatePolicy>
                                   </snapshots>
                                </pluginRepository>
                        </pluginRepositories>
                </profile>
        </profiles>
</settings>
</nowiki>

=== Step 5: Installing DB ===
* oVirt Engine works with postgresql 8.4.x or 9.1.x

 <nowiki>
$> emerge -DuNavt dev-db/postgresql-server:9.1 jdbc-postgresql</nowiki>

* Make sure the jdbc installed is 9.1_XXX (you may need to unmask it).
* Once emerged, run the relevant config: emerge --config ...
* TODO: make sure /etc/postgresql-9.1/pg_hba.conf is set to trust.

=== Step 6: Building from source ===
TBD.

=== Step 7: Testing current setup ===
TBD.

=== Step 8: How to contribute ===

TODO: explain oVirt Gerrit
