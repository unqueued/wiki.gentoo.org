<languages />
{{Lowercase title}}
{{InfoBox stack
|{{InfoBox homepage|http://freedesktop.org/wiki/Software/systemd|header=true}}
|{{InfoBox wikipedia}}
|{{InfoBox gitweb|http://cgit.freedesktop.org/systemd/systemd/|raw=true}}
}}

'''systemd''' is a modern SysV-style init and rc (run command)<ref>Eric S. Raymond. http://www.catb.org/jargon/html/R/rc-file.html Retrieved on June 27th, 2015</ref> replacement for Linux systems. It is supported in Gentoo as an alternate init system.
<!--
The following configuration directories are both used by OpenRC and systemd:
* {{Path|/etc/modules-load.d}},
* {{Path|/etc/sysctl.d}},
* {{Path|/etc/binfmt.d}}
-->

== Configuración previa a la instalación ==

{{Note/es|Al actualizar desde <{{=}}sys-apps/systemd-203 compruebe la [[systemd/upgrade|subpágina de actualización]].}}

=== El núcleo de línux===

systemd makes use of many modern Linux kernel features. Right now, the lower bound on kernel version is set in the ebuild to 2.6.39. In recent versions of {{Package|sys-kernel/gentoo-sources}}, there is a convenient way of selecting the mandatory and optional kernel options for systemd:

{{KernelBox|title=Configuración rápida usando gentoo-sources|<pre>
Gentoo Linux --->
        Support for init systems, system and service managers --->
                [*] systemd
</pre>}}

Para configurar las opciones del núcleo manualmente (que es la única opción cuando no utilice {{Package|sys-kernel/gentoo-sources}}), se requieren o recomiendan las siguientes opciones de configuración del núcleo:

<!-- See http://cgit.freedesktop.org/systemd/systemd/plain/README -->
{{KernelBox|title=Opciones obligatorias|<pre>
General setup  --->
	[*] Control Group support
	[*] open by fhandle syscalls
	[ ] Enable deprecated sysfs features to support old userspace tools
	[*] Configure standard kernel features (expert users)  --->
		[*] Enable eventpoll support
		[*] Enable signalfd() system call
		[*] Enable timerfd() system call
[*] Networking support --->
Device Drivers  --->
	Generic Driver Options  --->
		[*] Maintain a devtmpfs filesystem to mount at /dev
File systems  --->
	[*] Inotify support for userspace
	Pseudo filesystems  --->
		[*] /proc file system support
		[*] sysfs file system support
</pre>}}

{{KernelBox|title=Opciones recomendadas|<pre>
General setup  --->
	[*] Namespaces support  --->
		[*] Network namespace
[*] Enable the block layer  --->
	[*] Block layer SG support v4
Processor type and features  --->
	[*] Enable seccomp to safely compute untrusted bytecode
Networking support --->
	Networking options --->
		<*> The IPv6 protocol
Device Drivers  --->
	Generic Driver Options  --->
		()  path to uevent helper
		[ ] Fallback user-helper invocation for firmware loading
Firmware Drivers  --->
	[*] Export DMI identification via sysfs to userspace
File systems --->
	<*> Kernel automounter version 4 support (also supports v3)
	Pseudo filesystems --->
		[*] Tmpfs virtual memory file system support (former shm fs)
		[*]   Tmpfs POSIX Access Control Lists
		[*]   Tmpfs extended attributes
</pre>}}

Para un sistema UEFI active también las siguientes opciones:

{{KernelBox|title=Soporte para UEFI|<pre>
[*] Enable the block layer  --->
	Partition Types  --->
		[*] Advanced partition selection
		[*]   EFI GUID Partition support
Processor type and features  --->
	[*] EFI runtime service support
Firmware Drivers  --->
        EFI (Extensible Firmware Interface) Support -->
	        <*> EFI Variable Support via sysfs
</pre>}}

Si el sistema está utilizando el planificador BFQ, se recomienda, por los desarrolladores de BFQ, activar «BFQ hierarchical scheduling support» bajo «Enable the block layer -> IO Schedulers».

Para obtener una lista actualizada, consulte la sección «REQUIREMENTS» en el archivo [http://cgit.freedesktop.org/systemd/systemd/tree/README README].

===El directorio {{Path|/run}}===

The {{Path|/run}} directory is used by systemd and other applications as a non-persistent storage for runtime data like {{Path|pid}} files, sockets and state files.

El paquete systemd creará él mismo el directorio {{Path|/run}}. Sin embargo, tenga en cuenta que este cambio provocará el montaje automático del mismo en [[OpenRC]], y puede desencadenar su uso por los diferentes paquetes de software.

==={{Path|/etc/mtab}}===

Los desarrolladores solo dan soporte al archivo {{Path|/etc/mtab}} siendo este un enlace simbólico de {{Path|/proc/self/mounts}}. Si no se crea este enlace simbólico también causará problemas con <tt>mount</tt> ({{bug|434090}}) y <tt>df</tt> ({{bug|477240}}). En el pasado algunas utilidades escribieron información (como opciones de montaje) en {{Path|/etc/mtab}} y, por lo tanto, se dio por hecho que era un archivo normal. Hoy en día todo el software tiene en cuenta esto que para evitar dicho problema. Sin embargo, antes de cambiar el archivo para convertirse en un vínculo simbólico, revise {{bug|477498}} para asegurarse de que el sistema no está afectado por ninguna regresión reportada.

Para crear el enlace simbólico, ejecute:

{{RootCmd|ln -sf /proc/self/mounts /etc/mtab}}

=== Asegurarse de que /usr está presente en el arranque ===

Para una configuración separada de {{Path|/usr}}, utilice un [[initramfs]] para que monte {{Path|/usr}} antes de iniciar systemd. Consulte la [[Initramfs/Guide|Initramfs Gentoo Guide]] para obtener instrucciones al respecto.

=== Utililizar LVM2 y initramfs ===

Cuando se utiliza [[LVM|sys-fs/lvm2]] y el sistema se arranca usando un initramfs, dicho initramfs tendrá que ser creado con {{Package|sys-kernel/genkernel-next}}, ejecutando:

{{RootCmd|genkernel --udev --lvm <target>}}

<code><target></code> es, o bien <code>initramfs</code>, o bien algún otro objetivo de genkernel que implique la creación de un initramfs. Para obtener más información, mire la salida de <tt>genkernel --help</tt>:

{{Cmd|genkernel --help}}

Cuando se utiliza LVM, el demonio <tt>lvmetad</tt> debe iniciarse también. De lo contrario systemd será incapaz de montar volúmenes LVM. <tt>lvmetad</tt> se puede activar en {{Path|/etc/lvm/lvm.conf}}:

{{FileBox|filename=/etc/lvm/lvm.conf|title=Fragmento del cambio necesario en lvm.conf|lang=ini|1=
# Ajustar use_lvmetad a '1' para systemd
use_lvmetad {{=}} 1
}}

{{Note/es|En lugar de modificar {{Path|/etc/lvm/lvm.conf}}, esto, probablemente, podría lograrse a través de una unidad {{Path|lvmetad.socket}} que active un servicio {{Path|lvmetad.service}}, pero las versiones actuales de {{Package|sys-fs/lvm2}} no contienen dichas opciones aún.}}

== Instalación ==

{{Package|sys-apps/systemd}} contiene udev. Una vez instalado, {{Package|sys-fs/udev}} puede retirarse, dado que systemd será asistido por {{Package|virtual/udev}}.

Active el parámetro global de USE <code>systemd</code> (en {{Path|make.conf}}). Al mismo tiempo, el parámetro USE <code>consolekit</code> debe ser desactivado para evitar conflictos con el servicio <tt>systemd-logind</tt>. También es posible cambiar a un subperfil systemd para utilizar parámetros USE por defecto más coherentes, en cuyo caso no es necesario cambiar {{Path|make.conf}}:

{{RootCmd|eselect profile list}}

Finalmente, actualice el sistema con los nuevos parámetros:

{{RootCmd|emerge -avDN @world}}

Cuando se producen problemas de dependencias (como {{Package|sys-fs/udev}} bloqueando {{Package|sys-apps/systemd}}), {{Package|sys-fs/udev}} podría ser que estuviera registrado en el archivo word. Trate de resolver esto desmarcándolo:

{{RootCmd|emerge --deselect sys-fs/udev}}

== Arrancar con systemd ==

Para poder arrancar systemd, hay que cambiar el <tt>init</tt> que el núcleo (o initramfs) utiliza como ejecutable.

{{Warning/es|Los servicios que se establecen para el gestor de servicios previo no se inician automáticamente (en el otro). Esto se debe a que el sistema ha cambiado a un gestor de servicios diferente. Con el fin de obtener de nuevo la funcionalidad de dichos servicios, como la conexión de redes o el gestor de inicio de sesión, estos servicios tendrán que ser activados nuevamente. Más información sobre esto se proporciona más adelante en la sección [[#Servicios|«Servicios»]] de este artículo.}}

{{Note/es|Si la migración produce un estado inoperativo, siempre es posible arrancar de nuevo con el gestor de servicios por defecto (OpenRC) desandando los pasos para cambiar el init. Esto permite un retorno seguro y una manera de conseguir solucionar el problema a través de la sección [[#Solución de problemas|«Solución de problemas»]] del final de este artículo.}}

Las siguientes subsecciones documentan cómo intercambiar el <tt>init</tt> en uno de los gestores de arranque o en el núcleo.

=== Grub Legacy (0.x) ===

El argumento <code>init=/usr/lib/systemd/systemd</code> debe ser añadido a la línea de órdenes del núcleo. Un extracto de ejemplo de {{Path|grub.conf}} se vería así:

{{FileBox|filename=/boot/grub/grub.conf|title=Ejemplo de configuración de GRUB para systemd|1=
title=Gentoo con systemd
root (hd0,0)
kernel /vmlinuz root=/dev/sda2 init=/usr/lib/systemd/systemd
}}

Si a pesar de esto el sistema arranca usando OpenRC, pruebe utilizando <code>real_init</code> en lugar de <code>init</code>.

=== Grub 2 ===

When {{c|grub2-mkconfig}} is used, add the init option to <var>GRUB_CMDLINE_LINUX</var>:

{{Note|This is not needed when using an initramfs generated by {{c|dracut}} with systemd inside as the initramfs already starts systemd.}}

{{FileBox|filename=/etc/default/grub|title=Configure GRUB 2 for systemd|lang=bash|1=
# Append parameters to the linux kernel command line
GRUB_CMDLINE_LINUX="init=/usr/lib/systemd/systemd"
}}

Cuando el archivo de configuración de GRUB 2 esté hecho a mano (solo expertos), añada el parámetro <code>init=</code> a la orden <code>linux</code> o <code>linux16</code>.

{{FileBox|filename=/boot/grub/grub.cfg|title=Ejemplo de fragmento de configuración de GRUB2|1=
linux /vmlinuz-3.10.9 root=UUID=508868e4-54c6-4e6b-84b0-b3b28b1656b6 init=/usr/lib/systemd/systemd
}}

Cuando utilice initrd obtenido con genkernel-next, use <code>real_init</code> en lugar de <code>init</code>.

{{Note|This use of the deprecated <code>real_init</code> should not be needed for stable versions of genkernel-next.}}

=== En la configuración del núcleo ===

The init configuration can also be hard-coded in the kernel configuration. See {{Path|Processor type and features -> Built-in kernel command line}}. Note that this technique works for both {{c|grub}} and {{c|grub2}}.

=== Definir la contraseña de root ===

En este punto no se olvide de establecer la contraseña root del sistema. Si algo sale mal, systemd pedirá la contraseña de root para entrar en modo de mantenimiento.

== Post-installation configuration ==

systemd soporta algunos archivos de configuración del sistema para ajustar los detalles más básicos del sistema.

{{Note/es|Si bien algunos parámetros de configuración del sistema se pueden actualizar mediante la modificación de los archivos de configuración apropiados, la mayoría de los ajustes se gestionan mediante utilidades que exigen que systemd esté corriendo. En este último caso, es seguro reiniciar el ordenador con systemd y utilizar las utilidades <tt>hostnamectl</tt>, <tt>localectl</tt> y <tt>timedatectl</tt> para hacer los ajustes que se necesiten.}}

=== Nombre del equipo ===

Para establecer el nombre del equipo, cree/edite el archivo {{Path|/etc/hostname}} y simplemente ponga el nombre deseado para el equipo.

When booted using systemd, a tool called {{c|hostnamectl}} exists for editing {{Path|/etc/hostname}} and {{Path|/etc/machine-info}}. To change the hostname, run:

{{RootCmd|hostnamectl set-hostname <NOMBREDELEQUIPO>}}

Refer to {{c|man hostnamectl}} for more options.

<!--
{{FileBox|filename=/etc/machine-info|title=Archivo de configuración para la información de la máquina local.|lang=bash|1=
PRETTY_NAME="Larry's Computer"
ICON_NAME="computer-laptop"
}}
-->

=== Idioma del sistema ===

Por lo general, los locales migrarán correctamente desde OpenRC al instalar systemd. Cuando sea necesario, el idioma se puede ajustar en {{Path|/etc/locale.conf}}, según las instrucciones dadas por el manual de Gentoo:

{{FileBox|filename=/etc/locale.conf|title=Configuración del idioma del sistema|lang=bash|1=
LANG="es_ES.utf8"
}}

Una vez arrancado el sistema con systemd, la herramienta <tt>localectl</tt> se puede utilizar para establecer la configuración regional y el mapa de teclas de la consola o de X11. Para cambiar la configuración regional del sistema, ejecute la siguiente orden:

{{RootCmd|localectl set-locale LANG<nowiki>=</nowiki><LOCALE>}}

Para cambiar el mapa de teclado de la consola virtual:

{{RootCmd|localectl set-keymap <KEYMAP>}}

Y, por último, para configurar la distribución del teclado en X11:

{{RootCmd|localectl set-x11-keymap <LAYOUT>}}

Si es necesario el modelo, variante y opciones pueden especificarse así:

{{RootCmd|localectl set-x11-keymap <LAYOUT> <MODEL> <VARIANT> <OPTIONS>}}

=== Time and date ===

La fecha y hora del sistema se pueden ajustar mediante la utilidad <tt>timedatectl</tt>. Esto también permitirá a los usuarios configurar la sincronización horaria del sistema sin necesidad de depender de {{Package|net-misc/ntp}} o de otros proveedores que implementa el propio systemd.

To learn how to use {{c|timedatectl}} simply run:

{{RootCmd|timedatectl --help}}

=== Cargar módulos automáticamente ===

La carga automática de un módulo está configurada en un archivo diferente, o mejor dicho, en un directorio de archivos. Los archivos de configuración se almacenan en el directorio {{Path|/etc/modules-load.d}}. Al arranque, se carga cada archivo que contiene una lista de módulos. El formato del archivo es una lista de módulos separados por saltos de línea, y dicho archivo puede tener cualquier nombre, siempre y cuando termine en {{Path|.conf}}. La carga del módulo se puede separar por programa, servicio o cualquier forma que se adapte a sus preferencias personales. Un ejemplo para los módulos de <tt>virtualbox.conf</tt> se enumeran a continuación:

{{FileBox|filename=/etc/modules-load.d/virtualbox.conf|title=Archivo de ejemplo para los módulos de virtualbox|1=
vboxdrv
vboxnetflt
vboxnetadp
vboxpci
}}

=== Network ===

==== systemd-networkd ====

systemd-networkd es útil para realizar una configuración sencilla de las interfaces de red cableada. Está desactivado por defecto.

To configure systemd-networkd, create a {{Path|*.network}} file under {{Path|/etc/systemd/network}}. See [http://www.freedesktop.org/software/systemd/man/systemd.network.html systemd.network(5)] for reference. A simple DHCP configuration is given below:

{{FileBox|filename=/etc/systemd/network/50-dhcp.network
|1=[Match]
Name=en*
 
[Network]
DHCP=yes}}

{{RootCmd|systemctl enable systemd-networkd.service
|systemctl start systemd-networkd.service}}

Advierta que systemd-networkd no actualiza {{Path|resolv.conf}} de forma predeterminada. Para tener systemd administrando la configuración de DNS, sustituya {{Path|resolv.conf}} con un enlace simbólico y ponga en marcha systemd-resolved.

{{RootCmd|ln -snf /run/systemd/resolve/resolv.conf /etc/resolv.conf
|systemctl enable systemd-resolved.service
|systemctl start systemd-resolved.service}}

==== NetworkManager ====

A menudo NetworkManager se utiliza para configurar los ajustes de red. Para ello, solo tiene que ejecutar la siguiente orden cuando se utiliza un escritorio corriendo con X11:

{{RootCmd|nm-connection-editor}}

Si ese no es el caso y la red necesita ser configurada desde consola, dele a [https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Networking_Guide/sec-Using_the_NetworkManager_Command_Line_Tool_nmcli.html nmcli] una oportunidad, o siga un proceso de configuración asistida por <tt>nmtui</tt>:

{{RootCmd|nmtui}}

[https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Networking_Guide/sec-Networking_Config_Using_nmtui.html nmtui] es una interfaz [http://es.wikipedia.org/wiki/Curses curses] que guiará al usuario en el proceso de configuración mientras se ejecuta en modo consola.

=== Manejar los archivos de registo ===

systemd has its own way of handling log files without needing to rely on any external log system (like {{Package|app-admin/syslog-ng}} or {{Package|app-admin/rsyslog}}). Messages can now be read with {{c|journalctl}}. It can still be configured to use a preferred external tool for handling them. See {{c|man journald.conf}} to learn how to configure journald to suit personal needs.

Some common {{c|journalctl}} options:

{| class="table table-striped table-condensed"
|-
! Command line options for {{c|journalctl}} !! Result
|-
| {{c|journalctl}} without options || Show all log entries, starting with earliest.
|-
| <code>-b</code>, <code>--boot</code> || Show all log entries from this boot.
|-
| <code>-r</code>, <code>--reverse</code> || Newest entries first.
|-
| <code>-f</code>, <code>--follow</code> || Show the last few entries and display new log entries as they're being produced.
|-
| <code>-p</code>, <code>--priority=</code> || Specify (minimum) priority to display messages, with a choice from: "emerg" (0), "alert" (1), "crit" (2), "err" (3), "warning" (4), "notice" (5), "info" (6), "debug" (7).
|-
| <code>--since=</code>, <code>--until=</code> || Restrict entries by time. Accepts the format "YYYY-MM-DD hh:mm:ss" or the strings "yesterday", "today" and "tomorrow".
|-
| <code>-n</code>, <code>--lines=</code> || Restrict to a number of entries.
|-
| <code>-k</code>, <code>--dmesg</code> || Restrict to kernel messages.
|-
| <code>-u</code>, <code>--unit=</code> || Restrict to a certain Systemd unit.
|}

For more information and many more options, look at {{c|man journalctl}}.

=== /tmp está ahora en tmpfs ===

A menos que algún otro sistema de archivos esté montado de forma explícita para {{Path|/tmp}} en {{Path|/etc/fstab}}, systemd montará {{Path|/tmp}} como tmpfs. Eso significa que se vacía en cada arranque y su tamaño se limitará a 50% del tamaño de la memoria RAM del sistema. Para saber por qué este se comporta así y cómo modificarlo, eche un vistazo a [http://www.freedesktop.org/wiki/Software/systemd/APIFileSystems/ Sistemas de archivos API].

=== Configurar la verbosidad de proceso de arranque ===

When migrating to systemd users usually notice differences regarding verbosity of boot process:

* The boot option <code>quiet</code> not only influences the kernel output, but also that of systemd itself. Then, while setting up systemd for the machine, drop the option to see any errors could arise more easily. After that, add it back to get a quiet (and faster) boot.
* Even passing the <code>quiet</code> boot option, systemd can still be configured to show its status by also passing <code>systemd.show_status=1</code>.
* When not using the <code>quiet</code> boot option, some messages might be overwriting consoles. That is caused by the kernel configuration (see {{c|man 5 proc}} and look for {{Path|/proc/sys/kernel/printk}}). To tweak it pass the <code>loglevel=5</code> boot parameter to the kernel (and update the value according to preference, for instance set a lower value like 1).

== Servicios ==

En algún momento el sistema tendrá que ser reiniciado para que systemd se ponga marcha (en modo de sistema). Procure leer todo el presente documento para asegurarse de que systemd se configura tan completamente como sea posible antes de reiniciar (el equipo). Tenga en cuenta que, así como la utilidad <tt>journalctl</tt> funciona con systemd mientras este no está ejecutándose, por el contrario la utilidad <tt>systemctl</tt> no hará nada útil sin que systemd esté ejecutándose. Complete la configuración de los servicios (activación e iniciación de los servicios) después de entrar en el sistema que ejecuta systemd.

=== Servicios OpenRC ===

Aunque originalmente systemd intentó dar soporte a los antiguos scripts de init.d en ejecución, este apoyo no se adapta bien para un RC basado en dependencias como OpenRC y, por lo tanto, se desactiva por completo en Gentoo. OpenRC ofrece medidas adicionales para garantizar que los scripts de init.d no se ejecuten cuando no se utilice OpenRC para arrancar el sistema (de lo contrario los resultados serían impredecibles).

=== Listar servicios disponibles ===

Todas las unidades de servicios disponibles se pueden enumerar usando el argumento <code>list-units</code> con <tt>systemctl</tt>:

{{RootCmd|systemctl list-units|output=<pre>
UNIT                               LOAD   ACTIVE SUB       DESCRIPTION
boot.automount                     loaded active waiting   EFI System Partition Automount
proc-sys-fs-binfmt_misc.automount  loaded active waiting   Arbitrary Executable File Formats File System Automount Point
...
</pre>}}

Los siguientes sufijos de archivos son de interés:

{| class="table"
! Sufijo
! Descripción
|-
| {{Path|.service}}
| archivos de servicio normal (por ejemplo, aquellos que se limitan a ejecutar un demonio directamente),
|-
| {{Path|.socket}}
| servicios que escuchan socket   (como ''inetd''),
|-
| {{Path|.path}}
| sistema de archivos que desencadenan servicios (servicios que se ejecutan cuando cambian los archivos, etc.).
|}

Alternatively the {{c|systemctl}} tool can be used to list all services (including implicit ones):

{{RootCmd|systemctl --all --full}}

Y, por último, para comprobar los servicios que fallaron al iniciar:

{{RootCmd|systemctl --failed}}

=== Enabling, disabling, starting, and stopping services ===

La forma habitual de activar un servicio es usando la siguiente orden:

{{RootCmd|systemctl enable foo.service}}

Los servicios pueden ser igualmente desactivados:

{{RootCmd|systemctl disable foo.service}}

Estas órdenes activan los servicios utilizando el nombre por defecto en el target por defecto (ambos especificados en la sección «Install» del archivo de servicio). Sin embargo, algunos servicios, o bien no proporcionan esta información, o bien los usuarios prefieren tener otro nombre/target.

Tenga en cuenta que estas órdenes solo activan o desactivan el servicio en cuestión cuando el sistema se inicie de nuevo en un próximo arranque; para iniciar el servicio inmediatamente (si necesidad de reinicio del sistema), utilice:

{{RootCmd|systemctl start foo.service}}

Los servicios también pueden ser detenidos:

{{RootCmd|systemctl stop foo.service}}

=== Instalar archivos de unidad personalizados ===

Custom unit files can be placed in {{Path|/etc/systemd/system}}, where they will be recognized after running {{c|systemctl daemon-reload}}:

{{RootCmd|systemctl daemon-reload}}

{{Path|/usr/lib/systemd/system}} está reservado para los archivos de servicios instalados por el gestor de paquetes.

=== Personalizar archivos de unidad ===

Cuando solo se necesitan cambios menores en una unidad, no hay necesidad de crear una copia completa del archivo de unidad original en {{Path|/etc/systemd/system}}. Sobrescribir la configuración en una unidad proporcionada por el gestor de paquetes se puede lograr mediante archivos colocados en un directorio llamado {{Path|*.d}} precedido con el nombre de la unidad original (por ejemplo {{Path|apache2.d}}) en {{Path|/etc/systemd/system/}}.

{{FileBox|filename=/etc/systemd/system/apache2.d/mem-limit.conf|title=Ejemplo de adición/modificación de la configuración de un archivo de servicio|lang=ini|1=
[Service]
MemoryLimit{{=}}1G
}}

Se necesita una recarga de los servicios para informar a systemd de los cambios:

{{RootCmd|systemctl daemon-reload}}

A continuación, es necesario reiniciar el servicio para aplicar los cambios:

{{RootCmd|systemctl restart apache2}}

Compruebe que la propiedad cambiada se ha aplicado al servicio:

{{RootCmd|systemctl show --property{{=}}MemoryLimit apache2|output=<pre>MemoryLimit=1074000000</pre>}}

=== Activar un servicio bajo un nombre personalizado ===

Cuando el nombre proporcionado por «Alias» en la sección «[Install]» de la unidad no cumple con sus expectativas y proporciona un nuevo valor permanente para este a través de una [[#Personalizar archivos de unidad|personalización]] que no es el valor deseado, se puede crear manualmente un enlace simbólico en {{Path|/etc/systemd/system/*.wants/}} (que apunte a otro servicio/target). El nombre del directorio {{Path|*.wants}} puede especificar un target u otro servicio que dependerá de otro nuevo.

Por ejemplo, para instalar el servicio  {{Path|mysqld.service}} como {{Path|db.service}} en el target {{Path|multi-user.target}}:

{{RootCmd|ln -s /usr/lib/systemd/system/mysqld.service /etc/systemd/system/multi-user.target.wants/db.service}}

Para desactivar el servicio, basta con retirar el enlace simbólico:

{{RootCmd|rm /etc/systemd/system/multi-user.target.wants/db.service}}

=== Servicios nativos ===

Algunos de los paquetes de Gentoo ya instalan archivos de unidad de systemd. Para estos servicios, no se necesita mas que activarlos. Un breve resumen de los archivos de unidad que instalan los paquetes, se puede ver en [http://qa-reports.gentoo.org/output/eclass-usage/systemd.txt systemd eclass users list].

La siguiente tabla, lista las coincidencias de los servicios de systemd con los de OpenRC:

{| class="table" style="text-align: center;"
|+ Migration chart
|-
! scope="col" | Gentoo package
! scope="col" | OpenRC service
! scope="col" | systemd unit 
! scope="col" | Notes
|-
! scope="row" rowspan="28" | {{Package|sys-apps/openrc}}
| bootmisc || systemd-tmpfiles-setup.service || always enabled, uses {{Path|tmpfiles.d}}
|-
| consolefont || systemd-vconsole-setup.service || always enabled, uses {{Path|vconsole.conf}}
|-
| devfs ||  || 
|-
| dmesg ||  || 
|-
| fsck || fsck*.service || pulled in implicitly by mounts
|-
| functions.sh || See note || {{Bug|373219}}
|-
| hostname || (builtin) || {{Path|/etc/hostname}}
|-
| hwclock || See note || always enabled as part of systemd (ie It is baked in and is not a unit)
|-
| keymaps || systemd-vconsole-setup.service || always enabled, uses {{Path|vconsole.conf}}
|-
| killprocs ||  || 
|-
| local ||  || 
|-
| localmount || local-fs.target || actual units are created implicitly from fstab
|-
| modules || systemd-modules-load.service || always enabled, uses {{Path|/etc/modules-load.d/*.conf}}
|-
| mount-ro ||  || 
|-
| mtab ||  || 
|-
| netmount || remote-fs.target || 
|-
| numlock ||  || 
|-
| procfs || (builtin) || 
|-
| root || remount-rootfs.service || 
|-
| savecache || n/a || OpenRC internals
|-
| staticroute ||  || 
|-
| swap || swap.target || actual units are created implicitly from fstab
|-
| swclock ||  || 
|-
| sysctl || systemd-sysctl.service || {{Path|sysctl.conf}} and {{Path|sysctl.d/}}
|-
| sysfs || (builtin) || 
|-
| termencoding || systemd-vconsole-setup.service || always enabled, uses {{Path|vconsole.conf}}
|-
| scope="row" rowspan="2" | urandom
| systemd-random-seed-load.service || 
|-
| systemd-random-seed-save.service || 
|-
! scope="row" | {{Package|app-admin/rsyslog}}
| rsyslog || rsyslog.service || 
|-
! scope="row" | {{Package|app-admin/syslog-ng}}
| syslog-ng || syslog-ng.service || 
|-
! scope="row" rowspan="2" | {{Package|media-sound/alsa-utils}}
| scope="row" rowspan="2" | alsasound
| alsa-store.service || (enabled by default)
|-
| alsa-restore.socket || (enabled by default)
|-
! scope="row" | {{Package|net-misc/dhcpcd}}
| dhcpcd || dhcpcd.service || 
|-
! scope="row" rowspan="5" | {{Package|net-misc/netifrc}} 
| scope="row" rowspan="5" | net.*
| net@.service || systemd wrapper for net.* scripts (comes with net-misc/netifrc)
|-
| netctl@.service || net-misc/netctl is originally an Arch Linux tool.
|-
| NetworkManager.service || For &lt;networkmanager-0.9.8.4 : enable NetworkManager-dispatcher.service for dispatcher.d scripts to work. <br/> Enable NetworkManager-wait-online.service to detect that the system has a working internet connection.<br/>Disable all other managers (e.g., wicd, dhcpcd) and wpa_supplicant.
|-
| dhcpcd.service || Provided by net-misc/dhcpcd
|-
| systemd.networkd.service || Part of systemd
|-
! scope="row" | {{Package|net-misc/openntpd}}
| ntpd || ntpd.service ||
|-
! scope="row" rowspan="2" | {{Package|net-misc/openssh}}
| scope="row" rowspan="2" | sshd
| sshd.service || runs sshd as a daemon
|-
| sshd.socket || runs sshd on a inetd-like basis (for each incoming connection)
|-
! scope="row" rowspan="2" | {{Package|net-misc/wpa_supplicant}}
| scope="row" rowspan="2" | wpa-supplicant
| wpa_supplicant.service || D-Bus controlled daemon (e.g. for NetworkManager)
|-
| wpa_supplicant@.service || interface-specific wpa_supplicant (used like {{Path|wpa_supplicant@wlan0.service}})
|-
! scope="row" rowspan="3" | {{Package|net-print/cups}}
| scope="row" rowspan="3" | cupsd
| cups.service || classic on-boot start up service
|-
| cups.socket
| scope="row" rowspan="2" | socket and path activation (cups only started on-demand)
|-
| cups.path
|-
! scope="row" | {{Package|net-wireless/bluez}}
| bluetooth || bluetooth.service || 
|-
! scope="row" rowspan="2" | {{Package|sys-apps/dbus}}
| scope="row" rowspan="2" | dbus
| dbus.service || 
|-
| dbus.socket || 
|-
! scope="row" | {{Package|sys-apps/irqbalance}}
| irqbalance || irqbalance.service || supports daemon mode only
|-
! scope="row" | {{Package|sys-apps/microcode-ctl}}
| microcode_ctl ||  || Configure ''microcode'' as a '''module''' to let it load the microcode itself. Go to "Processor type and features" -> "CPU microcode loading support" and remember to add the option you need depending on you having intel or amd processor.
|-
! scope="row" rowspan="4" | {{Package|sys-fs/udev}}
| udev || udev.service || 
|-
| udev-mount || (builtin) || {{Path|/dev}} is mounted as tmpfs
|-
| udev-postmount || udev-trigger.service || 
|-
| || udev-settle.service || 
|-
! scope="row" | {{Package|sys-power/acpid}}
| acpid || acpid.service || Most of its functionality is done by systemd itself, then, maybe you could consider to stop enabling this
|-
! scope="row" | {{Package|x11-apps/xdm}}
| (xdm) || xdm.service || OpenRC uses common xdm init.d installed by {{Package|x11-base/xorg-server}}. With systemd you will need to enable corresponding unit file for each DM (gdm.service, kdm.service...)
|-
! scope="row" rowspan="2" | {{Package|net-firewall/iptables}}
| scope="row" rowspan="2" | iptables
| iptables-store.service || 
|-
| iptables-restore.service || 
|-
|}

=== Servicios con temporizador ===

Desde la versión 197, systemd soporta temporizadores, haciendo de cron un programa innecesario en un sistema systemd. Desde la versión 212, se da soporte a los servicios persistentes, reemplazando, incluso, a anacron. Los temporizadores persistentes se ejecutan en la próxima oportunidad, si el sistema se apaga cuando se programó el temporizador.

El siguiente es un ejemplo de cómo hacer un temporizador simple que se ejecuta en el contexto de un usuario. Será ejecutado incluso si el usuario no inicia sesión. Cada servicio con temporizador necesita un temporizador, y un archivo de servicio que se activa por el temporizador de la siguiente manera:

{{FileBox|filename=~/.local/share/systemd/user/backup-work.timer|title=Ejemplo de un temporizador que se ejecuta todos los días laborables|lang=ini|1=
[Unit]
Description=daily backup work
RefuseManualStart=no
RefuseManualStop=no
 
[Timer]
Persistent=false
OnCalendar=Mon-Fri *-*-* 11:30:00
Unit=backup-work.service
 
[Install]
WantedBy=default.target
}}

{{FileBox|filename=~/.local/share/systemd/user/backup-work.service|title=Ejemplo de un servicio que ejecuta una copia de seguridad|lang=ini|1=
[Unit]
Description=daily backup work
RefuseManualStart=no
RefuseManualStop=yes
 
[Service]
Type=oneshot
ExecStart=/home/<nombredeusuario>/scripts/backup-work.sh
}}

En primer lugar, hay que decirle a systemd que recargue los archivos de servicio:

{{Cmd|systemctl --user daemon-reload}}

Es posible realizar la copia de seguridad manualmente ejecutando la siguiente orden:

{{Cmd|systemctl --user start backup-work.service}}

Se puede iniciar y detener el temporizador manualmente de la siguiente manera:

{{Cmd|systemctl --user start backup-work.timer}}
{{Cmd|systemctl --user stop backup-work.timer}}

Por último, para activar el temporizador en cada inicio del sistema, ejecute:

{{Cmd|systemctl --user enable backup-work.timer}}

Para comprobar los últimos resultados de la ejecución del servicio:

{{Cmd|systemctl --user list-timers}}

==== Correos electrónicos para comunicar fallos ====

Si un servicio programado se ejecuta y falla, se puede enviar un correo electrónico al usuario o administrador para informarle. Esto es posible con la línea «onfailure» que especifica lo que debería suceder si un servicio falla. Un fallo es detectado cuando el script invocado devuelve un código distinto de cero.

Habrá que cambiar el script de la siguiente manera:

{{FileBox|filename=~/.local/share/systemd/user/backup-work.service|title=Ejemplo de un servicio que ejecuta una copia de seguridad|lang=ini|1=
[Unit]
Description=daily backup work
RefuseManualStart=no
RefuseManualStop=yes
OnFailure=failure-email@%i.service
 
[Service]
Type=oneshot
ExecStart=/home/<nombredeusuario>/scripts/backup-work.sh
}}

Esto requiere que tenga el servicio {{Path|failure-email@.service}} instalado, que se puede encontrar en 
[https://github.com/kylemanna/systemd-utils/tree/master/onfailure kylemanna's systemd-utils repository].

==== Sustituir cron ====

Los archivos con temporizador y de servicios vistos antes también se pueden añadir a {{Path|/usr/lib/systemd/system}} para hacerlos disponibles a todo el sistema. La sección «install» debería decir entonces <code>WantedBy=multi-user.target</code> para activar el servicio al iniciar el sistema.

However, cron also runs the scripts in {{Path|/etc/cron.daily}} and other locations. Several packages place scripts there that they expect to be run daily. This behavior can be emulated with systemd by installing {{Package|sys-process/systemd-cron}}. Then activate the new cron replacement with the following commands:

{{RootCmd|systemctl enable cron.target}}
{{RootCmd|systemctl start cron.target}}

== Solución de problemas == <!--T:176-->

* {{Bug|systemd|search=package}}
* {{Bug|systemd|search=product|site=fdo}}
* [http://freedesktop.org/wiki/Software/systemd/Debugging Upstream debugging guide]

=== Graphical sessions opened in random places ===

By default systemd only launches a {{c|getty}} process when it's going to be used. This causes some display managers (like GDM) to use the remaining TTYs for opening graphical sessions on demand, which can result in having consoles and graphical sessions placed randomly depending on the order they were used.

To stick with a more "classical" behavior (i.e, consoles placed from {{Path|tty1}} to {{Path|tty6}} and graphical sessions using the remaining TTYs) force it to always launch {{c|getty}} on those:

{{RootCmd|systemctl enable getty@tty{2,3,4,5,6}.service}}

=== lvm ===

Cuando se cambia de OpenRC a systemd y se necesita lvm para montar correctamente los volúmenes del sistema, hay que activar el servicio lvm:

{{RootCmd|systemctl enable lvm2-monitor.service}}

A pesar de que este servicio podría no ser necesario para la activación del volumen raíz (si lvm está integrado en initramfs), podrían no funcionar sin él otros volúmenes LVM, a menos que se active el servicio.

=== systemd-bootchart ===

{{KernelBox|title=Soporte para systemd-bootchart|1=<pre>
File systems  --->
	Pseudo filesystems --->
	[*] /proc file system support
Kernel hacking  --->
	[*] Kernel debugging
	[*] Collect scheduler debugging info
	[*] Collect scheduler statistics
</pre>}}

Como systemd-bootchart podría intentar iniciar {{Path|/sbin/init}}, reconfigúrelo para invocar systemd en su lugar:

{{FileBox|filename=/etc/systemd/bootchart.conf|lang=bash|1=
...
Init=/usr/lib/systemd/systemd
...
}}

El resultado de [http://es.wikipedia.org/wiki/Bootchart bootchart] es un informe en formato SVG ubicado en {{Path|/run/log/}}.

=== syslog-ng en conflicto con systemd ===

systemd crea {{Path|/dev/log}} como socket de datagramas <ref>Jose Pedro Oliveira. [https://bugzilla.redhat.com/show_bug.cgi?id=770810#c10 Note about custom syslog-ng configurations files], [https://bugzilla.redhat.com/ Bugzilla Red Hat], 11 de enero 2012. Consultado el 12 de enero 2015</ref> <ref>[https://fedoraproject.org/wiki/Common_F16_bugs#systemd-syslog-ng-problems Systemd and syslog-ng interaction problems: system freezes / syslog-ng fails to start], [https://fedoraproject.org/wiki/Fedora_Project_Wiki Fedora Project Wiki]. Consultado el 12 de enero 2015</ref> de modo que syslog-ng necesita ser leído desde un ''unix-dgram'' en lugar de un ''unix-stream'', de lo contrario syslog-ng utiliza una transmisión «mala»:

{{FileBox|filename=/etc/syslog-ng/syslog-ng.conf|1=
#  Por defecto syslog-ng utiliza unix-stream. Comentar esta línea y añadir unix-dgram en su lugar.
# unix-stream('/dev/log');
unix-dgram('/dev/log');
}}

=== Configuración de sys-fs/cryptsetup ===

systemd does not seem to respect {{Path|/etc/conf.d/dmcrypt}} (see {{bug|429966}}) so it needs to be configured through the {{Path|/etc/crypttab}} file:

{{FileBox|filename=/etc/crypttab|title=Archivo de configuración para dispositivos de bloque cifrado|1=
crypt-home UUID=c25dd0f3-ecdd-420e-99a8-0ff2eaf3f391 -
}}

You may need to create a new service file from your {{Path|/etc/crypttab}} file.
To do this, enable the <code>cryptsetup</code> USE flag for {{Package|sys-apps/systemd}}. It will install {{Path|/usr/lib/systemd/system-generators/systemd-cryptsetup-generator}}. Executing it will create a service file in {{Path|/tmp/}}, which you can now copy to {{Path|/etc/systemd/system}}, adjust manually and add to the desired runlevel.

=== Comprobar la unidades que fallan al inicio ===

Compruebe si hay unidades que no pudieron comenzar con:

{{RootCmd|systemctl --failed}}

=== Activar modalidad de depuración de errores ===

Para obtener más información estableca lo siguiente en {{Path|/etc/systemd/system.conf}}:

{{FileBox|filename=/etc/systemd/system.conf|lang=bash|1=
LogLevel=debug
}}

O, active la depuración de errores en consola, que abre una terminal en tty9. Esto ayuda a depurar errores de los servicios durante el proceso de arranque.

{{RootCmd|systemctl enable debug-shell.service}}

=== La utilización de e4rat ===

Recuerde editar {{Path|/etc/e4rat.conf}} para configurar 'init' para {{Path|/usr/lib/systemd/systemd}}, de lo contrario se mantendrá el arranque de OpenRC.

=== Rigidez de GRSecurity ===

Con grsecurity activado, systemd-networkd podría registrar el error siguiente:

{{CodeBox|title=systemd-networkd error|1=could not find udev device: Permission denied}}

El error aumenta debido a que cuando systemd-networkd trabaja bajo un usuario no root, grsecurity denegará el acceso a la estructura completa de {{Path|/sys}} para dichos usuarios. Para desactivar esta opción, desactive la opción del núcleo  <code>CONFIG_GRKERNSEC_SYSFS_RESTRICT</code>.

== See also ==

* [[Comparison of init systems]] - An article comparing and contrasting the differences in Gentoo init systems.
* [[Sakaki's_EFI_Install_Guide|Sakaki's EFI Install Guide]] - Particularly look at the chapter entitled [[Sakaki's_EFI_Install_Guide/Configuring_systemd_and_Installing_Necessary_Tools|Configuring systemd and installing necessary tools]]
* [[OpenRC to Systemd Cheatsheet]]

== Recursos externos ==

* [http://www.freedesktop.org/wiki/Software/systemd/FrequentlyAskedQuestions FAQ]
* [http://www.freedesktop.org/wiki/Software/systemd/TipsAndTricks Tips and tricks]

== Referencias ==

{{reflist}}

[[Category:Init systems]]
