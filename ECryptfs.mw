{{stub}}
{{InfoBox stack
|{{InfoBox homepage|http://ecryptfs.org|header=true}}
|{{InfoBox wikipedia|ECryptfs}}
|{{InfoBox ohloh|eCryptfs}}
}}

'''eCryptfs''' is [[Article description::an in-kernel file encryption suite.]]

== Installation ==

=== Kernel ===

{{KernelBox|title=Enable eCryptfs support|1=
File systems  --->
    [*] Miscellaneous filesystems  --->
        <M>   eCrypt filesystem layer support
Security options  --->
    [*] Enable access key retention support
}}

=== USE flags ===

{{USEflag|package=sys-fs/ecryptfs-utils}}

=== Emerge ===

Install {{Package|sys-fs/ecryptfs-utils}}:

{{Emerge|sys-fs/ecryptfs-utils}}

Note: The USE flags above are not up to date. {{Package|sys-fs/ecryptfs-utils}} must be compiled with the <code>suid</code> USE flag in order to use the auto-mount capabilities of PAM as described below.

{{Cmd|USE{{=}}"suid" emerge sys-fs/ecryptsfs-utils}}

== Configuration ==

=== Files ===

==== /etc/pam.d ====

See the below diff for the {{path|system-auth}} file.

{{GenericCmd|diff -u /etc/pam.d/system-auth.orig /etc/pam.d/system-auth|lang=diff|output=<pre>
--- /etc/pam.d/system-auth	2017-12-28 23:59:48.048839950 +0100
+++ pam.d/system-auth	2018-08-30 20:47:20.100012146 +0200
@@ -1,12 +1,15 @@
 auth		required	pam_env.so 
 auth		required	pam_unix.so try_first_pass likeauth nullok 
+auth            optional        pam_ecryptfs.so unwrap
 auth		optional	pam_permit.so
 account		required	pam_unix.so 
 account		optional	pam_permit.so
 password	required	pam_cracklib.so difok=2 minlen=8 dcredit=2 ocredit=2 retry=3 
+password        optional        pam_ecryptfs.so unwrap
 password	required	pam_unix.so try_first_pass use_authtok nullok sha512 shadow 
 password	optional	pam_permit.so
 session		required	pam_limits.so 
 session		required	pam_env.so 
 session		required	pam_unix.so 
+session         optional        pam_ecryptfs.so unwrap
 session		optional	pam_permit.so
</pre>}}

== Encrypting your SWAP ==

Ecryptfs-utils has a utitlity <code>ecryptfs-setup-swap</code> which depends on {{Package|sys-fs/cryptsetup}}. However, this utility
is currently Ubuntu centric. You should setup an encrypted swap by installing {{Package|sys-fs/cryptsetup}} and edit  <code>/etc/conf.d/dmcrypt</code> which has an example of an ecrypted swap in it.
Also note, you need to add dm-crypt to the boot run level with: 
{{GenericCmd|rc-config add dmcrypt boot}}

== See also ==

[[Mount_Encrypted_Ubuntu_Home/Guide]]

== External resources ==

* [https://wiki.archlinux.org/index.php/ECryptfs eCryptfs on the Arch wiki]

[[Category:Filesystems]]
[[Category:Security]]
