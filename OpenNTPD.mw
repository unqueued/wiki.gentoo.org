{{InfoBox stack
|{{InfoBox homepage|http://www.openntpd.org/|header=true}}
|{{InfoBox wikipedia|OpenNTPD|text=OpenNTPD}}
|{{InfoBox ohloh|ntpd}}
}}

OpenNPTD - Lightweight NTP server ported from OpenBSD

== Installation ==

=== USE flags ===

{{USEflag|package=net-misc/openntpd}}

=== Emerge ===

Install OpenNTPD:

{{Emerge|net-misc/openntpd}}

=== Service ===

Start the ntp daemon:

{{RootCmd|/etc/init.d/ntpd start}}

Add the ntp daemon to the default runlevel:

{{RootCmd|rc-update add ntpd default}}

== Configuration ==

The default configuration file for OpenNTPD:

{{FileBox|filename=/etc/ntpd.conf|title=Gentoo's default configuration|1=
# Addresses to listen on (ntpd does not listen by default)
#listen on *

# sync to a single server
#server ntp.example.org

# use a random selection of NTP Pool Time Servers
# see http://support.ntp.org/bin/view/Servers/NTPPoolServers
#servers pool.ntp.org

# use a specific local timedelta sensor (radio clock, etc)
#sensor nmea0

# use all detected timedelta sensors
#sensor *

# get the time constraint from a well-known HTTPS site
#constraints from "https://www.google.com/search?q=openntpd"

# Choose servers announced from Gentoo NTP Pool
servers 0.gentoo.pool.ntp.org
servers 1.gentoo.pool.ntp.org
servers 2.gentoo.pool.ntp.org
servers 3.gentoo.pool.ntp.org
}}

For further information see {{c|man ntpd.conf}}:

{{Cmd|man ntpd.conf}}

=== Server ===

{{FileBox|filename=/etc/ntpd.conf|title=OpenNTPD listening on 192.168.0.1 address while syncing with multiple servers|1=
# Addresses to listen on (ntpd does not listen by default)
listen on 192.168.0.1

# Choose servers announced from Gentoo NTP Pool
servers 0.gentoo.pool.ntp.org
servers 1.gentoo.pool.ntp.org
servers 2.gentoo.pool.ntp.org
servers 3.gentoo.pool.ntp.org
}}

{{RootCmd|/etc/init.d/ntpd restart}}

=== Client ===

{{FileBox|filename=/etc/ntpd.conf|title=OpenNTPD syncing with multiple servers|1=
# Choose servers announced from Gentoo NTP Pool
servers 0.gentoo.pool.ntp.org
servers 1.gentoo.pool.ntp.org
servers 2.gentoo.pool.ntp.org
servers 3.gentoo.pool.ntp.org
}}

Alternatively sync the client to a server on the local network:

{{FileBox|filename=/etc/ntpd.conf|title=OpenNTPD syncing with a single server on the local network|1=
# sync to a single server on the local network
server 192.168.0.1
}}

{{RootCmd|/etc/init.d/ntpd restart}}

=== systemd / timedatectl ===

systemd comes with {{c|timedatectl}} to manage the system clock time. 

The {{c|timedatectl}} manpage explains how {{c|ntpd}} and {{c|timedatectl}} can work together:

{{Cmd|man timedatectl|output=<pre>
 Enable an NTP daemon (chronyd):

           $ timedatectl set-ntp true
           ==== AUTHENTICATING FOR org.freedesktop.timedate1.set-ntp ===
           Authentication is required to control whether network time synchronization shall be enabled.
           Authenticating as: user
           Password: ********
           ==== AUTHENTICATION COMPLETE ===

           $ systemctl status chronyd.service
           chronyd.service - NTP client/server
                     Loaded: loaded (/usr/lib/systemd/system/chronyd.service; enabled)
                     Active: active (running) since Fri, 2012-11-02 09:36:25 CET; 5s ago
           ...
</pre>}}

However, it also seems to work if {{c|ntpd.service}} is enabled ('''DEPRECATED''', please use {{c|systemd-timesyncd}} instead as described below)

{{RootCmd
|systemctl enable ntpd
|systemctl enable ntpd ln -s '/usr/lib64/systemd/system/ntpd.service' '/etc/systemd/system/multi-user.target.wants/ntpd.service'
}}

{{RootCmd|systemctl status ntpd|output=<pre>
ntpd.service - OpenNTP Daemon
   Loaded: loaded (/usr/lib64/systemd/system/ntpd.service; disabled)
   Active: active (running) since Mi 2014-04-23 13:46:28 CEST; 3s ago
 Main PID: 27243 (ntpd)
   CGroup: /system.slice/ntpd.service
           ├─27243 /usr/sbin/ntpd -s -d
           └─27244 /usr/sbin/ntpd -s -d

Apr 23 13:46:28 lapslave systemd[1]: Started OpenNTP Daemon.
Apr 23 13:46:28 lapslave ntpd[27243]: ntp_adjtime adjusted frequency by 0.000000ppm
Apr 23 13:46:28 lapslave ntpd[27243]: ntp engine ready
Apr 23 13:46:28 lapslave ntpd[27243]: reply from 85.214.52.61: offset 0.004787 delay 0.063980, next query 7s
Apr 23 13:46:28 lapslave ntpd[27243]: reply from 83.137.98.96: offset 0.006781 delay 0.070009, next query 6s
Apr 23 13:46:28 lapslave ntpd[27243]: reply from 83.170.1.42: offset 0.004661 delay 0.074198, next query 6s
</pre>}}

The time is synced despite the fact that {{c|timedatectl}} says NTP sync is off:

{{RootCmd|timedatectl|output=<pre>
      Local time: Mi 2014-04-23 13:47:54 CEST
  Universal time: Mi 2014-04-23 11:47:54 UTC
        RTC time: Mi 2014-04-23 12:48:50
        Timezone: Europe/Berlin (CEST, +0200)
     NTP enabled: n/a
NTP synchronized: no
 RTC in local TZ: no
      DST active: yes
 Last DST change: DST began at
                  So 2014-03-30 01:59:59 CET
                  So 2014-03-30 03:00:00 CEST
 Next DST change: DST ends (the clock jumps one hour backwards) at
                  So 2014-10-26 02:59:59 CEST
                  So 2014-10-26 02:00:00 CET
</pre>}}

But in systemd 213 new feature arrived - {{c|systemd-timesyncd}}. It is a built-in NTP client designed as a part of {{c|systemd-networkd}}, and the recommended way to sync time with systemd.

{{RootCmd
|systemctl enable systemd-timesyncd
|systemctl start systemd-timesyncd
}}

{{RootCmd|timedatectl|output=<pre>
      Local time: Mi 2014-04-23 13:47:54 CEST
  Universal time: Mi 2014-04-23 11:47:54 UTC
        RTC time: Mi 2014-04-23 12:48:50
        Timezone: Europe/Berlin (CEST, +0200)
     NTP enabled: '''yes'''
NTP synchronized: '''yes'''
 RTC in local TZ: no
      DST active: yes
 Last DST change: DST began at
                  So 2014-03-30 01:59:59 CET
                  So 2014-03-30 03:00:00 CEST
 Next DST change: DST ends (the clock jumps one hour backwards) at
                  So 2014-10-26 02:59:59 CEST
                  So 2014-10-26 02:00:00 CET
</pre>}}

== See also ==

* [[ntp]]

[[Category:Server]]
[[Category:Daemons]]
