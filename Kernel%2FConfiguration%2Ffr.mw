<languages />

{{Metadata|abstract=Cet article décrit la configuration manuelle et l'installation du noyau Linux. Pour une méthode automatisée reportez-vous à l'article sur  genkernel.}}

Cet article décrit la configuration et l'installation du [[Kernel|Noyau Linux]].

== Mettre en place le lien symbolique ==

Le lien symbolique {{Path|/usr/src/linux}} devrait toujours pointer sur les sources du noyau en cours d'utilisation. Ceci peut être obtenu de trois manières différentes :

; 1. Installer les sources du noyau avec  l'[[option de la variable USE]] ''symlink'' activée.
: Ceci fera que le lien {{Path|/usr/src/linux}} pointera sur vos sources du noyau nouvellement installées. Si nécessaire, il peut encore être modifié avec l'une des deux méthodes suivantes :

; 2. Mettre en place le lien symbolique avec  '''eselect''':

{{RootCmd|eselect kernel list|output=<pre>
Available kernel symlink targets:
[1] linux-3.3.8-gentoo
[2] linux-3.4.9-gentoo
</pre>}}

: Ceci affiche les sources du noyau disponibles. L'astérisque indique les sources sélectionnées. Pour les changer, par exemple pour choisir celles correspondant à la deuxième entrée, faites :

{{RootCmd|eselect kernel set 2}}

; 3. Mettre en place le lien symbolique à la main :

{{RootCmd|ln -sf /usr/src/linux-3.4.9-gentoo /usr/src/linux |
|ls -l /usr/src/linux |
|output=lrwxrwxrwx 1 root root 11 Aug 29 22:10 /usr/src/linux -> /usr/src/linux-3.4.9-gentoo
}}

<!-- The output is the same as the target file in the ln command. -->

== Outils de configuration ==

The kernel offers several tools to configure itself.

{| class="table"
|-
! Command
! Description
|-
| <tt>make config</tt>
| Text based configuration. The options are prompted one after another. All options need to be answered, and out-of-order access to former options is not possible.
|-
| <tt>make menuconfig</tt>
| An ncurses-based graphical menu (only text input). Navigate through the menu to modify the desired options.
|-
| <tt>make defconfig</tt>
| Generates a new config with default from the ARCH supplied defconfig file. Use this option to get back the default configuration file that came with the sources.
|-
| <tt>make nconfig</tt>
| Graphical menu based on ncurses. Requires {{Package|sys-libs/ncurses}} to be installed.
|-
| <tt>make xconfig</tt>
| Graphical menu using Qt4. Requires {{Package|dev-qt/qtgui}} to be installed.
|-
| <tt>make gconfig</tt>
| Graphical menu using GTK+. Requires {{Package|x11-libs/gtk+}}, {{Package|dev-libs/glib}}, and {{Package|gnome-base/libglade}} to be installed.
|-
| <tt>make oldconfig</tt>
| Review changes between kernel versions and update to create a new {{Path|.config}} for the kernel.
|-
| <tt>make allyesconfig</tt>
| Enables all configuration options in the kernel. target will set ''all'' kernel options to <code>*</code>. Make sure a backup of the current kernel configuration is acquired before experimentally using it!
|}

Il existe aussi plusieurs scripts pour créer diverses configuration par défaut. Reportez-vous à :

{{RootCmd|make help}}

== Configuration ==

Cet aricle décrit la configuration à partir de '''make menuconfig''', mais la procédure est similaire à celle des autres menus.

{{RootCmd|cd /usr/src/linux
|make menuconfig}}

=== Utilisation ===

In the shown menu the blue bar indicates the position of the cursor. With the {{Key|↑}} and {{Key|↓}} arrow keys change the position of the cursor. The {{Key|←}} and {{Key|→}}  arrow keys traverse the menu bar in the bottom and define what happens when the {{Key|Enter}} key is pressed. For the menu bar below, '''Select''' switches to a sub menu for the menu entries ending with <tt>---></tt> while '''Exit''' exits a sub menu. As an alternative the {{Key|Esc}} key can be pressed twice to exit the application.

Pressing an associated letter key {{Key|A}}-{{Key|Z}} will move the position of the cursor lines that have characters in bold. The {{Key|Y}}, {{Key|M}}, {{Key|N}} keys are excluded from navigation in this way; they are sanctified for other purposes. If a line begins with a Y, M, or N, the next character will be bold and capable of being jumped to. For example, relative to the cursor's current position, if the next line reads "N'''e'''twork Device Support --->" pressing the {{Key|E}} key will move the cursor to that line.

Les entrées de menu qui commencent par des parenthèses, crochets, accolades ou similaires, sont des pilotes ou des fonctionnalités que peuvent être activées :

De plus, certaines entrées du menu possèdent une marque à la fin :

{| class="table"
|-
! Tag
! Description
|-
| <code>(NEW)</code>
| This driver is new in the kernel and is maybe not stable enough.
|-
| <code>(EXPERIMENTAL)</code>
| This driver is experimental and most likely not stable enough.
|-
| <code>(DEPRECATED)</code>
| This driver is deprecated and not needed for most systems.
|-
| <code>(OBSOLETE)</code>
| This driver is obsolete and should not be activated.
|}

La plupart des options possèdent une description, que l'on peut obtenir en pressant la touche {{Key|H}} ou en choisissant  '''Help''' dans la barre de menu.

=== Sélection du pilote===

Reportez-vous à l'article [[hardware detection]] et aux articles de la catégorie [[:Category:Hardware|Hardware]].

=== Search modules ===

Within <tt>menuconfig</tt>, use the {{Key|/}} key to search modules by name.

As shown below, the search result will show numbers in front of the matches. Pressing {{Key|1}} in the example below would make <tt>menuconfig</tt> jump straight to the option ''Bluetooth device drivers'' in the menu structure.

{{KernelBox|title=Example output after searching for HCIBTUSB|1=
Symbol: BT_HCIBTUSB [{{=}}m]                       
Type  : tristate                               
Prompt: HCI USB driver                         
  Location:                                    
    -> Networking support (NET [{{=}}y])           
      -> Bluetooth subsystem support (BT [{{=}}y]) 
(1)     -> Bluetooth device drivers            
  Defined at drivers/bluetooth/Kconfig:5       
  Depends on: NET [{{=}}y] && BT [{{=}}y] && USB [{{=}}m]
}}

=== Activer la configuration ordinaire de Gentoo Linux ===

Il existe une option de configuration du noyau appelée  <code>CONFIG_GENTOO_LINUX</code>  qui est seulement présente dans  {{Package|sys-kernel/gentoo-sources}}  et dans d'autres noyaux maintenus  ([[Project:Kernel|Kernel Project]]). Elle ne fait rien par elle-même, mais définit un jeu d'options de configuration nécessaires pour des installations typiques.

Ce paramètre sélectionne automatiquement la prise en charge de tmpfs et devtmpfs qui sont nécessaires pour gérer  {{Path|/dev}} sur Gentoo Linux, mais pourrait être étendu dans le futur pour activer d'autres paramètres obligatoires dans un système Gentoo Linux. Pour une plus ample information, lisez l'aide disponible dans la configuration du noyau telle que décrite plus haut dans ce guide.

== Compilation/construction ==

Après avoir configuré le noyau, vous devez le compiler :

{{RootCmd|make}}

Si vous disposez d'un processeur à plusieurs cœurs, vous pouvez laisser tous les cœurs faire le travail. Pour cela ajoutez le paramètre  '''-j(NUMBER_CORES +1)'''. Pour un processeur à deux cœurs :

{{RootCmd|make -j3}}

== Installation ==

If drivers are activated as modules, they must be installed:

{{RootCmd|make modules_install}}

Les modules seront copiés dans un sous-répertoire de  {{Path|/lib/modules}}.

Pour installer le noyau réel :

{{RootCmd|make install}}

Cette commande exécute '''/sbin/installkernel''', qui fait partie du paquet {{Package|sys-apps/debianutils}}. 
« Le nouveau noyau est installé dans {{Path|/boot//vmlinuz-{version}}}. Si un lien symbolique {{Path|/boot/vmlinuz}} existe déjà, il est rafraîchi en faisant un lien de  {{Path|/boot/vmlinuz}} vers le nouveau noyau, et le noyau précédemment installé est disponible en tant que {{Path|/boot/vmlinuz.old}}. »
(''installkernel'' [[man page]]). C'est la même chose pour les fichiers  {{Path|config}} et {{Path|System.map}}. Ces liens symboliques sont pratiques, car ils pointent toujours sur le noyau le plus récent sans changer le chemin vers  le fichier (par exemple, vous pouvez les utiliser dans la configuration du chargeur de démarrage).

== Chargeur de démarrage ==

Changez la configuration de  votre [[bootloader|chargeur de démarrage]] pour sélectionner le nouveau noyau au démarrage.

Pour finir, redémarrez votre système avec le nouveau noyau.

== Comparing current kernel configuration with default configuration ==

Use the following procedure to get an overview over the kernel configurations that deviate from the default. Keep in mind that the modification of configuration setting may entail additional configuration settings.

{{RootCmd
|cd /usr/src/linux
|cp .config ../.config.working
|make defconfig
|mv .config ../.config.default
|cp ../.config.working .config
|cd ..
|diff .config.working .config.default {{!}} sed --quiet '/^\([<{{!}}>] CONFIG\)/ p' > .config.diff
}}

The search function in <tt>make menuconfig</tt> can be used to look up the flags and their interpretation.
When you're done, clean up:

{{RootCmd
|cd /usr/src/
|rm .config.working .config.default .config.diff
}}

== See also ==
* [[Genkernel]]
* [[Kernel/Configuration/Kernel_Seeds|Kernel Seeds]]

== External resources ==

[[Category:Kernel]]
