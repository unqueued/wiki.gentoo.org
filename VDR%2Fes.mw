<languages />

{{Dated|date=12 de marzo de 2015}}

{{Metadata|abstract=Este artículo contiene instruciones acerca de cómo preparar Gentoo Linux para DVB y VDR.}}

Este artículo contiene instruciones acerca de cómo preparar Gentoo Linux para DVB y VDR.

== Información general de DVB ==

=== ¿Qué es DVB? ===

''DVB'' es el acrónimo de ''Digital Video Broadcasting'' (Difusión de Vídeo Digital). DVB describe métodos para transferir información digital de TV, radio, servicios interactivos como MHP, EPG y teletexto. Usando compresión de datos MPEG-2 o H.264 para HDTV es posible transferir varios canales en la misma frecuencia. A mayor compresión de datos, mayor número de canales que se pueden transferir, sin embargo se paga una pérdida de la calidad. 

DVB puede transferirse de varias formas. La última letra identifica el
método de transferencia, por ejemplo, DVB-''T<'' para transmisiones terrestres. Existen otros tipos: 

* DVB-S para transmisión vía satélite.
* DVB-C para transmisión por cable.
* DVB-H para transmisión a dispositivos móviles (terrestres).
* DVB-IPI para transmisión sobre redes IP, por ejemplo Internet.
* DVB-RC(S/C/T) canal de retorno para la transmisión de servicios de datos, por ejemplo Internet de banda ancha.

=== Tipos y requerimientos de tarjetas DVB ===

Además de los diferentes métodos existentes para recibir un stream DVB, las tarjetas se clasifican por el tipo de salida producida. Hay tarjetas con decodificador implementado que ofrece acceso directo al stream por medio del dispositivo {{Path|/dev/video}}. Estas tarjetas son ''tarjetas completas'' (full featured). Otras tarjetas no tienen decodificador, requieren un software instalado en el ordenador y son ''de bajo coste''. Esto implica mayores requisitos del sistema. La CPU del ordenador debe funcionar al menos a 600 MHz y disponer de al menos de 256MB de RAM. [http://linuxtv.org/wiki/index.php/DVB_Card_Vendors Esta lista] puede ser útil para identificar la tarjeta. 

== Preparar el sistema ==

=== Configurar el núcleo ===

En primer lugar, debe asegurarse de que el núcleo ofrece soporte para DVB y el dispositivo DVB instalado. Desde la versión 2.6 los controladores
necesarios están incluidos. Compruebe la configuración del núcleo y asegúrese de seleccionar las siguientes opciones como controladores
estáticos o como módulos. 

{{KernelBox|title=Opciones necesarias del núcleo|1=
Input Device Support --->
* Event Interface
Device Drivers --->
<M> Multimedia Support --->
  [*] Digital TV support
   M  [Habilitar controlador(es)]
}}

Adicionalmente seleccione el controlador adecuado para el hardware del sistema. Para encontrar el módulo adecuado para la tarjeta, se deben marcar todos los controladores como módulos. Se se utiliza una tarjeta PCI, entonces instale el paquete {{Package|sys-apps/pciutils}} si no se ha instalado aún. Esto ofrecerá una herramienta útil llamada <tt>lspci</tt>. Para los controladores integrados o si no se dispone de una tarjeta PCI en el sistema, se debe saltar este paso y continuar en [[VDR/es#Comprobar_la_salida_del_n.C3.BAcleo|comprobar la salida del núcleo]]. 

{{Emerge|sys-apps/pciutils}}

Después de arrancar desde el nuevo núcleo, lance <tt>pcimodules</tt> para listar los módulos requeridos.

{{RootCmd|pcimodules|output=<pre>
ohci-hcd
ehci-hcd
sis900
snd-emu10k1
b2c2-flexcop-pci
nvidia nvidiafb
</pre>
}}

En este caso se necesita cargar el módulo <code>b2c2-flexcop-pci</code>. Añada el nombre del módulo al fichero {{Path|/etc/conf.d/modules}}: 

{{FileBox|filename=/etc/conf.d/modules|1=
modules="b2c2-flexcop-pci"
}}

=== Comprobar la salida del núcleo ===

Se recomienda marcar cada controlador como módulo de modo que el módulo necesario se pueda añadir dinámicamente, especialmente si no está claro que módulo se debe añadir. Si se conoce el nombre del módulo, entonces se debe seleccionar como un controlador integrado en el núcleo. A continuación se debe compilar el núcleo, instalar los módulos y reiniciar el nuevo módulo. Se puede verificar que el núcleo ha detectado correctamente la tarjeta PCI mediante la utilidad <tt>dmesg</tt>. 

Si el sistema tiene una tarjeta TerraTec Cinergy T2 la salida debería parecerse en algo a la siguiente:

{{RootCmd|dmesg {{!}} grep DVB|output=<pre>
DVB: registering new adaptor (TerraTec/qanu USB2.0 Highspeed DVB-T Receiver).
input: TerraTec/qanu USB2.0 Highspeed DVB-T Receiver remote control as /class/input/input2
</pre>
}}

== Instalar VDR ==

Para instalar VDR simplemente se hace emerge:

{{Emerge|media-video/vdr}} 

== Instalar el mando a distancia ==

Hay al menos dos formas de controlar VDR usando un mando a distancia infrarrojo. Si la tarjeta de televisión tiene un receptor IR integrado entonces se puede usar <code>vdr-remote</code>. De lo contrario se debe usar LIRC. 

=== Instalar vdr-remote ===

Instalar el plugin mediante una orden <tt>emerge</tt>: 

{{Emerge|media-plugins/vdr-remote}}
{{RootCmd|eselect vdr-plugin enable remote}}

When using the remote plugin for the IR port on a DVB card everything should be fine with the default configuration. It automatically uses the input device which has "dvb" in its name. For more advanced uses take a look at {{Path|/etc/conf.d/vdr.remote}} file.

=== Alternativa: instalar LIRC ===

If the card can be remotely controlled but managing it via <code>vdr-remote</code> is not desired, then LIRC should be configured. LIRC interprets the pressed keys and returns a name for each one. A program that supports LIRC waits for key events and runs the action configured in the configuration file, mostly stored in the configuration directory of the executing program (e.g. <tt>mplayer</tt> loads the file {{Path|~/.mplayer/lircrc}}). Before LIRC is installed add <code>lirc</code> as a USE flag and add a special variable called <code>LIRC_DEVICES</code> to {{Path|/etc/portage/make.conf}} Use [http://www.lirc.org/html/table.html this list] to find the proper arguments for the new {{Path|make.conf}} variable. 

{{FileBox|filename=/etc/portage/make.conf|lang=bash|1=
# (Reemplace "devinput" por el controlador apropiado) LIRC_DEVICES="devinput"
USE="lirc"}}

{{Emerge|app-misc/lirc}}

At start each key code must be defined with a name. Most supported remote controls are configured already, so take a look at the [http://lirc.sourceforge.net/remotes/ remote list]. Download the required file and save it as {{Path|/etc/lircd.conf}}. Now find out where to access the remote control. Run the following command to get a list of the current input devices (make sure the device is running). 

{{RootCmd|cat /proc/bus/input/devices|output=<pre>
I: Bus=0000 Vendor=0000 Product=0000 Version=0000
N: Name="TerraTec/qanu USB2.0 Highspeed DVB-T Receiver remote control"
P: Phys=usb-0000:00:1d.7-1/input0
S: Sysfs=/class/input/input2
H: Handlers=kbd event1 B: EV=100003
B: KEY=108fc210 2043 0 0 0 0 8000 2080 1 9e1680 0 0 ffc
</pre>
}}

In this case the Terratec Cinergy T2 device plugged in, so the device can be accessed over {{Path|/dev/input/<event1>}}. Replace <code><event1></code> with the matching device listed in the output. 

<tt>lircd</tt> needs to know the device to use. Add the following line to the {{Path|/etc/conf.d/lircd}} file. Remember to replace <code><devinput></code> with the name of the driver and <code><event1></code> with the actual device:

{{FileBox|filename=/etc/conf.d/lircd|lang=bash|1=
LIRCD_OPTS="-H <devinput> -d /dev/input/<event1>"
}}

Es el momento de arrancar <tt>lircd</tt>: 

{{RootCmd|/etc/init.d/lircd start}}

Now it should be possible to watch <tt>lircd</tt> capturing and decoding key presses. Run the <tt>irw</tt> command. Stop it by pressing {{Key|Ctrl}}+{{Key|C}} when enough keys have been pressed. 

{{RootCmd|irw|output=<pre>
0000000000001aa2 00 Exit Technisat_TTS35AI.conf 
0000000000001a8d 00 Mute Technisat_TTS35AI.conf 
0000000000000a97 00 OK Technisat_TTS35AI.conf 
0000000000000a97 01 OK Technisat_TTS35AI.conf 
0000000000000a92 00 Menu Technisat_TTS35AI.conf
</pre>
}}

Next, add it to the default runlevel so that it starts automatically at boot time:

{{RootCmd|rc-update add lircd default}}

To be able to use the remote control, LIRC support must be enabled in VDR. Add the following line to the {{Path|/etc/conf.d/vdr}} file: 

{{FileBox|filename=/etc/conf.d/vdr|lang=bash|1=
IR_CTRL="lirc"
}}

== Video output methods ==

Now decide on one (and only one) of the following video output devices which show the picture and the overlayed On Screen Display (OSD). 

=== Decodificación Hardware: Tarjetas DVB completas (full featured) ===

Install {{Package|media-plugins/vdr-dvbhddevice}} when using an TechnoTrend Premium S2-6400 Twin HD, or general hardware decoding for SDTV and HDTV (MPEG2 and MPEG4 AVC/H.264):

{{Emerge|media-plugins/vdr-dvbhddevice}}

Para Fujitsu_Siemens, Hauppage WinTV, TechnoTrend Premium S2300 y tarjetas basadas en este diseño de referencia o hardware de decodificación general para SDTV (MPEG1 y MPEG2): 

{{Emerge|vdr-dvbsddevice}}

=== Decodificación Hardware: Tarjetas DXR3/Hollywood+ ===

To use a DXR3 card for VDR output the <code>vdr-dxr3</code> plugin is needed: 

{{Emerge|vdr-dxr3}}

{{FileBox|filename=/etc/conf.d/modules|lang=bash|1=
modules="em8300"
}}

El módulo em8300 necesita alguna configuración que depende de la revisión exacta de la tarjeta. 

=== Decodificación Hardware: Tarjetas PVR350 ===

Since PVR350 cards have an onboard MPEG-Decoder chip it should be used to its full potential. In order for this to happen the <code>vdr-pvr350</code> plugin is needed. If <code>ivtv-driver</code> is not yet installed emerge should automatically install it. To have the <code>ivtv</code> module loaded at boot time add it to the {{Path|/etc/conf.d/modules}} list: 

{{Emerge|media-plugins/vdr-pvr350}}

{{FileBox|filename=/etc/conf.d/modules|lang=bash|1=
modules="ivtv"
}}

=== Decodificación Software: vdr-xineliboutput ===

Some people prefer to use <code>vdr-xineliboutput</code>, because it can work remotely. Follow the next set of instructions to configure <code>vdr-xineliboutput</code> on a host and client. First, the host setup: 

{{Emerge|media-plugins/vdr-xineliboutput}}

{{RootCmd|eselect vdr-plugin enable xineliboutput}}

Adding command line options at this point is crucial for xineliboutput to work. For more options, see <tt>vdr --help</tt>. 

{{FileBox|filename=/etc/conf.d/vdr.xineliboutput|lang=bash|1=
_EXTRAOPTS="--local=none --remote=37890"
}}

El siguiente paso es editar {{Path|/etc/vdr/svdrphosts.conf}}. Este fichero describe un número de direcciones de servidor a las cuales está permitido conectarse al puerto SVDRP del grabador del disco de vídeo que se está ejecutando en el sistema servidor. 

{{FileBox|filename=/etc/vdr/svdrphosts.conf|lang=bash|1=
# (La sintaxis correcta es: Dirección-[/Máscara de red])
127.0.0.1 (aceptar siempre localhost)
192.168.1.0/24 (cualquier máquina de la red local)
#204.152.189.113 (una máquina específica)
#0.0.0.0/0 (cualquier máquina en cualquier red. ¡ÚSELO CON CUIDADO!)
}}

When using <code>vdr-xineliboutput</code> to view the picture on the same computer as the one running VDR it is now possible to continue with [[#creating the channel list]]. 

Otherwise, simply <tt>emerge</tt> {{Package|media-plugins/vdr-xineliboutput}} on the client: 

{{Emerge|media-plugins/vdr-xineliboutput}}

Later (after having started VDR) the <tt>vdr-sxfe xvdr://hostname</tt> command can be used to connect to the VDR and view its picture and OSD. 

{{Note|There is also a plugin which simulates the existence of a real output device (<code>vdr-dummydevice</code>) for some fancy uses like record-only servers, but that is more advanced than a normal VDR setup.}}

== Creating a channel list ==

To make VDR really useful an appropriate channel list must be created. There is more than one way to get a working list of channels (besides downloading one). The channel list installed by default is for DVB-S reception on Astra on 19.2° E. 

=== Usar dvbscan desde linuxtv-dvb-apps ===

{{Emerge|media-tv/linuxtv-dvb-apps}}

Find the correct frequency list for region and type of reception of interest. These files are stored under {{Path|/usr/share/dvb}}. For reception with DVB-T in Germany, Berlin {{Path|/usr/share/dvb/dvb-t/de-Berlin}} should be used:

{{Cmd|dvbscan -o vdr /usr/share/dvb/scan/dvb-t/de-Berlin > /etc/vdr/channels.conf}}

=== Usar vdr-reelchannelscan ===

First, delete the contents of the existing channel list:

{{RootCmd|rm /etc/vdr/channels.conf}}

{{Emerge|vdr-reelchannelscan}}

{{RootCmd|eselect vdr-plugin enable reelchannelscan}}

=== Canales para sistemas con vdr-analogtv ===

It is a good idea to configure channels at this point. The VDR project provides users with some examples which can be found at {{Path|/usr/share/doc/vdr-analogtv-$version/examples/}}, as long as <code>media-plugins/vdr-analogtv-1.0.00-r1</code> and up has been installed. 

== Arrancar VDR ==

After having all basic software parts ready on the system the VDR with its OSD must be configured. 

If a hardware decoder for picture output is used, then the connected TV should be turned on. When using software output the client for this must be started after VDR. 

First, learn the key definitions; that is, connecting keys on the remote control to VDR's internal commands. 

{{Note|To edit the keyboard configuration, or (more likely) to delete it to go back to learning the keys the special configuration file can be modified. VDR stores its key-definitions in {{Path|/etc/vdr/remote.conf}}.}}

Comenzamos arrancando VDR: 

{{RootCmd|/etc/init.d/vdr start|output=<pre>
* Preparing start of vdr:
* config files ... [ ok ]
* Waiting for prerequisites (devices nodes etc.) ... [ ok ]
* Starting vdr ... [ ok ]
* First start of vdr: No check for running vdr possible
* until control device (remote/keyboard) keys are learnt!
</pre>
}}

{{Note/es|Los usuarios de decodificadores software deben arrancar ahora el programa cliente que abre la ventana para mostrar la imagen de TV y el OSD.}}

Para los usuarios de vdr-softdevice:

{{RootCmd|ShmClient}}

Para los usuarios de vdr-xineliboutput:

{{RootCmd|vdr-sxfe xvdr://nombre_de_máquina}}

Las teclas más útiles para VDR son: 

* Teclas del cursor (Izquierda/Derecha/Arriba/Abajo)
* Menu/Salir/Ok
* Colores (Rojo/Verde/Amarillo/Azul)
* Teclas numéricas (0-9)

{{Important|If not many keys exist on the remote be sure to assign these. Some remotes have Play/Pause/etc. on the same keys as the colors, so use them for the colors.}}

Now that the basic installation is over it is time to configure VDR. Switch to the output screen and follow the on-screen instructions. VDR asks the user to press various keys on the remote control so it can learn the correct key codes. If a remote control is not present, then the keyboard can be used as an alternative. 

Now add the VDR init script to the default runlevel to get it started each time the computer boots:

{{RootCmd|rc-update add vdr default}}

== Solución de problemas ==

If help is needed feel free to ask someone in [http://www.gentoo.org/irc://irc.gentoo.org/gentoo-vdr #gentoo-vdr], or look around on the [http://forums.gentoo.org/ Gentoo forums]
{{Migrated|originalauthors=Norman Golisz, Dimitry Bradt, Matthias Schwarzott, Joshua Saddler}}
