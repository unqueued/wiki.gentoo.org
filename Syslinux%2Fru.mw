<languages />

{{Metadata|abstract=Syslinux - это пакет, который содержит семейство загрузчиков. Пакет включает SYSLINUX (для файловых систем FAT), EXTLINUX (для файловых систем Linux), PXELINUX (для сетевой загрузки PXE) и ISOLINUX (ISO-9660) для загрузки с CD/DVD.}}

{{InfoBox stack
|{{InfoBox homepage|http://www.syslinux.org|header=true}}
|{{InfoBox wikipedia|SYSLINUX}}
|{{InfoBox ohloh}}
|{{InfoBox gitweb|http://git.kernel.org/cgit/boot/syslinux/syslinux.git|raw=true}}
}}

'''Syslinux''' — это пакет, который содержит семейство [[:Category:Bootloaders|загрузчиков]]. Пакет включает SYSLINUX (загрузчик для файловых систем FAT), EXTLINUX (загрузчик файловых систем [[ext4|ext2/3/4]],  [[btrfs/ru|btrfs]] и [[XFS|xfs]]), PXELINUX (сетевой загрузчик PXE) и ISOLINUX (ISO-9660) для загрузки CD/DVD.

Поддержка EFI была добавлена в версиях 6.00 и выше.<ref>Команда разработчиков Syslinux. [http://www.syslinux.org/wiki/index.php/Syslinux_6_Changelog#Changes_in_6.00 Журнал изменений Syslinux 6], [http://www.syslinux.org syslinux.org]. Выпущен 20 июня 2013. Обновлено 27 марта 2016.</ref>

== Установка ==

Установка пакета Syslinux предоставит программное обеспечение для системы, но не установит или активирует любой загрузчик, которые содержатся в пакете.

=== USE-флаги ===

{{USEflag|package=sys-boot/syslinux}}

=== Emerge ===

{{Emerge|sys-boot/syslinux}}

== Настройка на системах с BIOS ==

{{Note|Эти инструкции предназначены для систем BIOS. Если используется (U)EFI, читайте [[#Установка на системах с EFI|установка на системах с EFI]].}}

В оставшейся части раздела будем считать, что загрузочный раздел находится на {{Path|/dev/sda1}} (часто исполузуемое  место). Если это не так, обязательно внесите правки по мере необходимости.

Чтобы использовать EXTLINUX , убедитесь, что установлен подходящий ''загрузочный сектор''. Затем установите загрузчик на раздел. EXTLINUX может не работать, если эти шаги пропущены. Такая настройка загрузочного сектора не требуется в случае установки SYSLINUX, PXELINUX и ISOLINUX.

=== Настройка загрузочного сектора ===

==== Настройка MBR (msdos) ====

{{Note|Эти инструкции предназначены для разметки разделов MBR (msdos). Для GPT, перейдите к разделу [[#Настройка GPT|настройка GPT]].}}

Сначала, установите загрузочный сектор, предусмотренный Syslinux. Примите необходимые предосторожности при использовании этой команды; если пропущен <code>count=1</code>, она перезапишет весь диск, вместо только первых 440 байт:

{{RootCmd|dd bs{{=}}440 conv{{=}}notrunc count{{=}}1 if{{=}}/usr/share/syslinux/mbr.bin of{{=}}/dev/sda}}

Отметьте загрузочный раздел как активный. В столбце "Boot" появится <code>*</code> :

{{RootCmd|fdisk /dev/sda|output=<pre>
Command (m for help): a
Partition number (1-3): 1
Command (m for help): p
 ...
   Device Boot      Start         End      Blocks   Id  System
/dev/sda1   *        2048      133119       65536   83  Linux
/dev/sda2          133120     4327423     2097152   82  Linux swap / Solaris
/dev/sda3         4327424  1953525167   974598872   83  Linux
  
Command (m for help): w
</pre>}}

==== Настройка GPT ====

{{Note|Эти инструкции предназначены для разметки GPT. Для MBR (msdos), прочтите [[#Настройка MBR (msdos)|настройка MBR (msdos)]].}}

Сначала установите загрузочный сектор, предусмотренный Syslinux. Примите необходимые предосторожности при использовании этой команды; если пропущен <code>count=1</code>, она перезапишет весь диск, вместо только первых 440 байт:

{{RootCmd|dd bs{{=}}440 conv{{=}}notrunc count{{=}}1 if{{=}}/usr/share/syslinux/gptmbr.bin of{{=}}/dev/sda}}

Затем запустите утилиту {{c|gdisk}} из {{Package|sys-apps/gptfdisk}} и включите атрибут ''legacy BIOS bootable'' (унаследованный загрузчик BIOS) на том разделе, где хранится {{Path|/boot/extlinux}}.

{{RootCmd|gdisk /dev/sda|output=<pre>
Command (? for help): x
 
Expert command (? for help): a
Partition number (1-3): 1
Known attributes are:
0: system partition
1: hide from EFI
2: legacy BIOS bootable
60: read-only
62: hidden
63: do not automount
 
Attribute value is 0000000000000000. Set fields are:
  No fields set
 
Toggle which attribute field (0-63, 64 or <Enter> to exit): 2
Have enabled the 'legacy BIOS bootable' attribute.
Attribute value is 0000000000000004. Set fields are:
2 (legacy BIOS bootable)
 
Toggle which attribute field (0-63, 64 or <Enter> to exit): 
 
Expert command (? for help): w
</pre>}}

=== Установка загрузчика ===

==== Настройка EXTLINUX ====

Используйте команду {{c|extlinux}} для установки необходимых файлов в {{Path|/boot/extlinux}}

{{RootCmd
|mkdir /boot/extlinux
|extlinux --install /boot/extlinux
|ln -snf . /boot/boot
}}

{{Note|Символьная ссылка "boot-> ." не является сама по себе необходимой, но в целях связности, она приведена, так чтобы примеры конфигурации были одни и те же для пользователей с {{Path|/boot}} на одном разделе и тех, кто пользуется отдельными разделами.}}

Пакет Syslinux содержит различные модули для включения дополнительных функций. Начиная с Syslinux версии 5, некоторые модули зависят от других, поэтому хорошей идеей будет скопировать большинство основных модулей независимо от варианта использования. Смотрите [[#Проверка динамических ссылок|проверка динамических ссылок]], чтобы удостовериться, что сохранены все зависимости.

{{RootCmd|cd /usr/share/syslinux
|cp menu.c32 memdisk libcom32.c32 libutil.c32 /boot/extlinux}}

==== Настройка ISOLINUX ====

Чтобы установить ISOLINUX, начните с основного каталога, в котором располагаются все файлы, которые необходимо переместить на CD или DVD. В основном каталоге, создайте подкаталог {{Path|isolinux}} и скопируйте файл {{Path|isolinux.bin}} из пакета Syslinux в папку {{Path|isolinux}}:

{{RootCmd|mkdir isolinux
|cp /usr/share/syslinux/isolinux.bin isolinux/}}

Создайте файл {{Path|isolinux.cfg}} в соответствии с инструкциями приведенными ниже.

Затем создайте два дополнительных каталога {{Path|kernel}} и {{Path|images}} в основном каталоге:

{{RootCmd|mkdir kernel images}}

Скопируйте двоичный файл {{Path|memdisk}} в каталог {{Path|kernel}}:

{{RootCmd|cp /usr/share/syslinux/memdisk kernel/}}

{{Note|Для использования команды mkisofs нужно установить пакет {{Package|app-cdr/cdrtools}}. Производится это запуском:
{{Emerge|app-cdr/cdrtools}}
}}

Когда конфигурация завершена, следующая команда {{c|mkisofs}} может быть использована для создания конечного образа ISO (не забудьте замените <var>${BASEDIR}</var> на тот же основной каталог, который использовался в предыдущих командах):

{{RootCmd|mkisofs -o output.iso -b isolinux/isolinux.bin -c isolinux/boot.cat -no-emul-boot -boot-load-size 4 -boot-info-table ${BASEDIR} }}

Файл {{Path|boot.cat}} будет создан автоматически.

==== Настройка PXELINUX ====

С PXELINUX возможна загрузка по сети с использованием образов, которые распределяются через TFTP-сервер. В этой статье предполагается, что TFTP-сервер установлен, и его TFTP корневым каталогом является {{Path|/var/lib/tftpboot}}. С этими настройками, скопируйте загрузчик PXELINUX в загрузочный каталог TFTP и создайте каталог с конфигурацией.

{{RootCmd|cp /usr/share/syslinux/pxelinux.0 /var/lib/tftpboot/pxelinux.0
|mkdir /var/lib/tftpboot/pxelinux.cfg}}

{{Note|При копировании новейшего {{Path|lpxelinux.0}} вместо {{Path|pxelinux.0}}, можно загрузить ядро и ramdisk через HTTP и сделать использование DNS имён в конфигурационном файле.}}

Каталог с конфигурацией может быть использован для хранения различных настроек для клиентов, загружающихся по сети. Когда клиент пытается загрузиться, MAC- или IP-адрес используются для определения подходящего файла конфигурации клиента. Сначала он пытается найти MAC-адрес, сопровождаемый шестнадцатеричным представлением клиентского IP. Затем с конца шестнадцатеричного представления убирается символ, до тех пор пока больше не остается символов, или пока не найден файл конфигурации. Если не подходит ни одна из попыток, используется файл конфигурации по умолчанию - ''default''. 

Шестнадцатеричное представление IP может быть найдено с помощью {{c|gethostip}} команды:

{{Cmd|gethostip -x 192.168.0.50|output=<pre>
C0A80032
</pre>}}

Пример подходящей последовательности в файле конфигурации выглядит так:

{{CodeBox|1=
01-88-99-aa-bb-cc-dd
C0A80032
C0A8003
C0A800
C0A80
C0A8
C0A
C0
C
default
}}

{{Note|Для облегчения поддержки, создайте файлы конфигурации с именем хоста и символьной ссылкой на представление IP. Для переключения по умолчанию, просто удалите или переименуйте символьную ссылку.}}

==== Настройка SYSLINUX ====

Используйте команду {{c|syslinux}} для установки загрузчика SYSLINUX на файловую систему (FAT):

{{RootCmd
|syslinux --install /dev/sda1
}}

== Установка на системах с EFI ==

{{Note|EFI поддерживается начиная с Syslinux 6.00.}}

=== Системный раздел EFI ===

Создайте раздел с типом <code>EF</code> (MBR) или <code>EF00</code> (GPT) и файловую систему FAT32 на этом разделе. Также можно использовать существующий [[EFI_stub_kernel|системный раздел EFI]], если такой есть. Желательно смонтировать этот раздел в {{Path|/boot/efi/}}.

{{Note|Далее подразумевается что система загружена в режиме EFI, и что системный раздел EFI находится на {{Path|/dev/sda1}}.}}

=== Установка загрузчика ===

На системном разделе EFI создайте каталог для файлов Syslinux. Этот каталог также будет содержать конфигурационные файлы, который будут созданы позже.

{{RootCmd|mkdir -p /boot/efi/EFI/syslinux}}

Copy the {{Path|syslinux.efi}} and {{Path|ldlinux.e64}} files along with the other desired {{Path|.c32}} files from {{Path|/usr/share/syslinux/efi64/}} to the new syslinux directory. For example:

{{RootCmd|cd /usr/share/syslinux/efi64
|cp syslinux.efi ldlinux.e64 menu.c32 libcom32.c32 libutil.c32 /boot/efi/EFI/syslinux}}

Если система не была загружена в режиме EFI, то файлы Syslinux необходимо скопировать в каталог {{Path|/boot/efi/EFI/Boot}}, а файл {{Path|syslinux.efi}} необходимо переименовать в {{Path|bootx64.efi}}. Если это так, то пропустите следующий раздел, касающийся утилиты {{c|efibootmgr}}.

=== Указание Syslinux на EFI ===

Убедитесь, что <var>CONFIG_EFI_VARS</var> включена в ядре. Если она была включена как модуль, убедитесь, что модуль загружен в память. Это можно сделать, воспользовавшись утилитой {{c|modprobe}}. После того как модули были загружены, создайте новую загрузочную запись используя {{c|efibootmgr}}:

{{RootCmd|modprobe efivars
|efibootmgr -c -l '\EFI\syslinux\syslinux.efi' -L SYSLINUX -p 1}}

{{c|efibootmgr}} автоматически отрегулирует порядок загрузки EFI и поместит недавно созданную запись в верхнюю часть списка. Измените порядок загрузки параметром <code>-o</code>, если такое поведение не желательно.

{{Note|In order for the {{c|efibootmgr}} command to work {{Package|sys-boot/efibootmgr}} must be emerged. If needed, do so using the following command:
{{Emerge|sys-boot/efibootmgr}}
}}

== Конфигурация ==

Конфигурационный файл для Syslinux называется {{Path|syslinux.cfg}}. Для совместимости с существующими установками, следующие устаревшие имена файлов конфигурации все еще поддерживаются:
* EXTLINUX: {{Path|extlinux.conf}}
* ISOLINUX: {{Path|isolinux.cfg}}

''Формат'' конфигурации также одинаков. Конфигурационный файл должен быть представлен в каталоге, с установленным Syslinux.

=== Простая конфигурация ===

Это отобразит простую строку "{{Path|boot:}}", подобную той, которая используется в Gentoo Minimal LiveCD:

{{FileBox|filename=syslinux.cfg|1=
DEFAULT gentoo
  
LABEL gentoo
      LINUX /boot/kernel-3.6.11-gentoo
}}

=== Конфигурация меню ===

Следующая конфигурация предоставляет пример простого текстового меню. Это достигается с помощью модуля <code>vesamenu</code>. В некоторых случаях, когда <code>vesa</code> не совместима, модуль простого меню будет работать. Скопируйте модуль меню VESA в файловую систему boot или системный раздел EFI. Системы BIOS должны использовать следующий пример:

{{RootCmd|cp /usr/share/syslinux/vesamenu.c32 /boot/extlinux/}}

Для EFI систем следует использовать:

{{RootCmd|cp /usr/share/syslinux/efi64/vesamenu.c32 /boot/efi/EFI/syslinux/}}

{{FileBox|filename=/boot/extlinux/extlinux.conf|1=
TIMEOUT 30
ONTIMEOUT gentoo
  
UI vesamenu.c32
MENU TITLE Boot
  
LABEL gentoo
      MENU LABEL Gentoo Linux
      LINUX /boot/kernel-3.6.11-gentoo
  
LABEL gentoo-old
      MENU LABEL Gentoo Linux (previous kernel)
      LINUX /boot/kernel-3.5.7-gentoo
}}

{{Note|Избегайте использования параметр <var>KERNEL</var> для выбора образов Linux ядра, вместо этого используйте параметр <var>LINUX</var>. Если используется <var>KERNEL</var> и имя образа оканчивается на {{Path|.0}}, то extlinux неправильно это истолкует и попытается использовать PXE для загрузки по сети, завершившись экраном полным графических артефактов и ничем другим. Для большей информации смотрите [http://www.syslinux.org/wiki/index.php/SYSLINUX#KERNEL_file раздел "KERNEL file"] на вики SYSLINUX.}}

{{Note|В конфигурационном файле, абсолютные пути будут считаться относительно файловой системы root, не-относительные пути будут считаться относительно каталога установки Syslinux.}}

=== Передача параметров ядра ===

Если только параметры ядра не закодированы жестко в образ ядра и не встроен initramfs, их нужно передать ядру через загрузчик. Чтобы это сделать, используйте параметр <var>APPEND</var> и/или <var>INITRD</var>, как показано здесь:

{{FileBox|filename=syslinux.cfg|title=Добавление параметров ядра|1=
DEFAULT gentoo
  
LABEL gentoo
      LINUX /boot/kernel-3.6.11-gentoo
      INITRD /boot/initramfs-3.6.11-gentoo
      APPEND root=/dev/sda1
}}

=== Проверка динамических ссылок ===

Начиная с syslinux-5.00, модули {{Path|.c32}} используют динамическую линковку. Чтобы проверить, что эти зависимости были установлены, войдите в каталог Syslinux и воспользуйтесь командой {{c|ldd}}:

{{RootCmd|LD_LIBRARY_PATH{{=}}. ldd *.c32}}

Если любые {{Path|.c32}} модули отсутствуют, убедитесь, что скопировали их в каталог.

== Смотрите также ==

* [[GRUB|GRUB Legacy]]
* [[GRUB2/ru|GRUB2]]

== Ссылки ==

{{reflist}}


[[Category:Bootloaders]]
