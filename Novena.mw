{{InfoBox stack
|{{InfoBox homepage|http://www.kosagi.com/w/index.php?title{{=}}Novena_Main_Page|header=true}}
}}

This document describes the Gentoo installation on Novena, an open hardware and FOSS-friendly computing platform (see Novena main page [http://www.kosagi.com/w/index.php?title=Novena_Main_Page www.kosagi.com]).

== Prerequisites ==

The easiest way for installing Gentoo without initial bootstrapping
is using the already shipped and working Debian installation, following a stage3 standard-installation on a second drive e.g. connected via USB. This guide focuses on the more complicated/Novena-unique parts and references to the original documentation whenever possible.

A Second hard disk has to be connected to USB (using the USB directly connected to the mainboard). This disk is further on referred to be found at {{Path|/dev/sdb}} in the booted Novena/Debian system. After successfully booting the new Gentoo system later on, {{Path|/dev/sdb}} will become {{Path|/dev/sda}}.

{{Warning|Make sure the CPU is sufficient cooled e.g. using a fan. Long compilations can lead to an overheating.}} 

== Installation ==

=== Base system ===

Follow the standard installation for the {{Keyword|x86}} architecture found in the [[Handbook:X86/Full/Installation|x86 Handbook]] with the following differences:

==== Partitioning ====

The bootloader and Linux kernel is stored on the internal SD-card of the Novena platform. After loading the kernel, the standard procedure is to mount the root partition by searching for an unique disk-ID 0x4e6f7653 (see http://www.kosagi.com/w/index.php?title=Novena_Main_Page#Bootloader). The boot process is as follows: SD-card (u-boot → Linux kernel) → hard drive (root filesystem). Because of this, the disk-ID of the new hard drive has to be changed accordingly, e.g. using {{c|fdisk}}:

{{RootCmd|fdisk /dev/sdb|output=<pre>

Command (m for help): x

Expert command (m for help): i

Enter the new disk identifier: 0x4e6f7653

Disk identifier changed from 0x00000000 to 0x4e6f7653.

Expert command (m for help): r

Command (m for help): w
</pre>}}

The partition layout on the hard disk for the new installation is as follows:

{| class="table table-striped table-condensed"
|-
! Device !! Filesystem type !! Description
|-
| /dev/sdb1 || fat32 || Boot (Not needed as boot files and kernel are placed on the SD-card but it doesn't hurt)
|-
| /dev/sdb2 || swap ||
|-
| /dev/sdb3 || ext4 || Root filesystem
|}

The present partition on the SD-card is:

{| class="table table-striped table-condensed"
|-
! Device !! Filesystem type !! Description
|-
| /dev/mmcblk0p1 || fat32 || Boot (contains u-boot and kernel files)
|-
| /dev/mmcblk0p2 || swap ||
|-
| /dev/mmcblk0p3 || ext4 || Root filesystem
|}


The device naming has become confusing in the Gentoo handbook. The translation from partition used in this guide to the on in the handbook is:

{| class="table table-striped table-condensed"
|-
! Novena guide !! Handbook
|-
| [not present] || {{Path|/dev/sda1}}
|-
| {{Path|/dev/sdb1}} || {{Path|/dev/sda2}}
|-
| {{Path|/dev/sdb2}} || {{Path|/dev/sda3}}
|-
| {{Path|/dev/sdb3}} || {{Path|/dev/sda4}}
|}

==== Installing a stage tarball ====

The following information can be used to find the correct stage3 archive:

* Architecture = arm
* Subarchitecture = armv7a_hardf
* Common subdirectory on mirror: [host][prefix]/releases/arm/autobuilds/current-stage3-armv7a_hardfp/

==== Configuring compile options ====

Save CFLAGS for Novena can be found at: https://wiki.gentoo.org/wiki/Safe_CFLAGS#ARMv7-A.2FCortex-A9_MPCore. The following changes in {{Path|/etc/portage/make.conf}} work for Novena:

{{FileBox|filename=/etc/portage/make.conf|lang=text|1=
CHOST="armv7a-hardfloat-linux-gnueabi"
CFLAGS="-O2 -march=armv7-a -mtune=cortex-a9 -mfpu=vfpv3-d16 -mfloat-abi=hard -pipe -fomit-frame-pointer"
CXXFLAGS="${CFLAGS}"
FEATURES="parallel-fetch ccache"
CCACHE_SIZE="2G"
}}

==== Choosing the right profile ====

Choose: default/linux/arm/10.0 (or newer)

==== Configuring the USE variable ====

Depends on individual needs, when in doubt leave it unchanged.

==== systemd ====

Nope, nobody needs it.

==== Installing the sources ====

The kernel is installed independent from the portage version, so no need to emerge it. See: https://github.com/xobs/novena-linux

==== Additional notes ====

Installing ccache is a good idea as compiling on Novena can take some time.

After finishing the installation, shut down the system and connect the drive containing the newly installed gentoo installation to the SATA port. Gentoo should boot up successfully. If not, you still have Debian to check for errors (;

== Bootloader update ==

{{Warning|Make a backup of the original SD-card! You have been warned.}}

A configuration and installation guide can be found at: http://www.kosagi.com/w/index.php?title=U-boot-novena

== Kernel update ==

{{Warning|Make a backup of the original SD-card! You have been warned.}}

Novena uses the original Linux kernel extended by custom patches. Sources:

*Kernel sources: https://github.com/xobs/novena-linux
*Kernel modules: https://github.com/xobs/gpu-viv

A configuration and installation guide can be found at: http://www.kosagi.com/w/index.php?title=Novena_linux-kernel. The new kernel is installed by mounting the SD-card copying the resulting kernel:

{{RootCmd|cd [kernel source directory]
|mount /dev/mmcblk0p1 /boot
|cp arch/arm/boot/zImage /boot}}

== MyriadRF ==

This is a Software Defined Radio (SDR) module which is plugable to the high speed interface of the Novena board. The following guide describes the installation of the drivers and simple usage demonstrations.

Further installation information:

*Myriadrf driver for Novena: https://github.com/myriadrf/Novena-RF/tree/master/driver
*Myriadrf info: https://myriadrf.org/blog/installing-the-novena-rf-driver-and-gnu-radio/
*Soapy: https://github.com/pothosware/SoapySDR/wiki/
*Importand: Install UHD and SoapySDR, SoapySDR allone is not enough!
[TODO: detailed description]

[[Category:Embedded_systems]]
