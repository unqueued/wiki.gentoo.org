<languages />
{{InfoBox stack
|{{InfoBox wikipedia|text=System time|header=true}}
|{{InfoBox wikipedia|Real-time clock|text=Real-time clock}}
|{{InfoBox wikipedia|Time zone|text=Time zone}}
}}


Unix システムは、システムクロックによって裏付けられるシステム時刻を時刻の把握に使用しています。これは、ハードウェアクロックまたは外部タイム・サーバーによって設定することができます。

== 序文 ==

=== ソフトウェアクロックとハードウェアクロック ===

カーネルによって提供される[[#システムクロック|システムクロック]]は、1970年 1月 1日 00時00分00秒から行われたティック(訳註: タイマーの刻み)数の単純なカウントとして実装されています。これは [[Wikipedia:Unix time|Unix 時間]] と呼ばれます。

[[#Hardware clock|ハードウェアクロック]]（また、リアルタイムクロックやRTCとして知られる）は、典型的には、メインボード上のコンポーネントです。オペレーティングシステムの状態に関係なく、コンピュータがシャットダウンしても常に実行されます。

=== UTC時間とローカルタイム ===

ハードウェアクロックの時刻は次の2つの標準を示すように変更できます: ローカルタイムまたは [[Wikipedia:Coordinated Universal Time|UTC 時間]]です。ローカルタイムは [[Wikipedia:Daylight saving time|DST]] (訳註: 夏時間)も含めたタイムゾーンにおける実際の時刻です。推奨されるのは UTC 時間です。なぜなら、システム時刻はタイムゾーンの時差と DST を加算して算出されるからです。そうすれば夏時間の変更は自動的に適用されますし、またハードウェアクロックを変更することなくタイムゾーンを変更することができます。デュアルブートのシステムを使用する場合は例外かもしれません; 他のオペレーティングシステムが UTC のハードウェアクロックをサポートしていないか、またはそのように設定されていない場合です(デフォルトでは、Windows はローカルタイムを使用します)。

== タイムゾーン ==

時刻を適切に保つには、あなたのタイムゾーン（標準時）を選び、システムがどの地域にあるのかを知らせる必要があります。

=== OpenRC ===

ローカルタイムゾーンは {{Path|/usr/share/zoneinfo}} から探してください。{{Path|/usr/share/zoneinfo/Etc/GMT*}} は名前が期待されるゾーンを表していないため避けてください。たとえば {{Path|/usr/share/zoneinfo/Etc/GMT-8}} は実際は GMT+8 です。ローカルタイムにする場合は "ローカルタイム" のタイムゾーンを選択します。

ゾーン情報を選択したら、{{Path|/etc/timezone}} でタイムゾーンをセットします。たとえばドイツの場合:

{{FileBox|filename=/etc/timezone|1=Europe/Berlin}}

このファイルの情報は、パッケージのアップデートのたびに選択したゾーン情報ファイルを {{Path|/etc/localtime}} にコピーするため、{{Package|sys-libs/timezone-data}} によって使用されます。このファイルをこの手順以外でセットアップするには以下を実行します:

{{Emerge|params=--config|timezone-data}}

=== systemd ===

[[systemd]] にはタイムゾーンを管理するための {{c|timedatectl}} が含まれています:

現在のゾーンを確認するには:

{{Cmd|timedatectl}}

利用可能なゾーンをリストアップするには:

{{Cmd|timedatectl list-timezones}}

タイムゾーンをたとえばドイツに変更するには:

{{RootCmd|timedatectl set-timezone Europe/Berlin}}

== LC_TIME ==

日付や時刻のフォーマットはこの[[Localization/Guide#Environment_variables_for_locales|環境変数]] で定義されています。詳細については [http://www.gnu.org/software/libc/manual/html_node/Locale-Categories.html#index-LC_005fTIME The GNU C Library] を参照してください。

== システムクロック ==

通常、システムクロックの時刻は起動時にハードウェアクロックによって設定されます。代替的には、システムクロックを手動で設定するか、ネットワークタイムサーバを使用することが可能です。

{{c|date}} コマンドを使ってシステムクロックの時刻を管理できます:

現在のソフトウェアクロックの時刻を確認するには:

{{Cmd|date}}

システムクロックをたとえば2016年5月6日12時34分にセットするには:

{{RootCmd|date 050612342016}}

=== タイムサーバー ===

タイムサーバーの使用に関する情報については [[Ntp|NTP]] の記事をご覧ください。

=== systemd ===

systemd にはシステムクロックの時刻を管理するための {{c|timedatectl}} コマンドが含まれています:

現在のソフトウェアクロックの時刻を確認するには:

{{Cmd|timedatectl}}

システムクロックをセットするには:

{{RootCmd|timedatectl set-time "2012-12-17 12:30:59"}}

== ハードウェアクロック ==

ハードウェアクロックを得るには、以下のカーネルオプションが有効化されていなければなりません:

{{KernelBox|title=ハードウェアクロックに必要なカーネルオプション|1=
Device Drivers  --->
    [*] Real Time Clock  --->
        [ ]   Set system time from RTC on startup and resume
        [ ]   Set the RTC time based on NTP synchronization
        [*]   /sys/class/rtc/rtcN (sysfs)
        [*]   /proc/driver/rtc (procfs for rtc0)
        [*]   /dev/rtcN (character devices)
        <*>   PC-style 'CMOS'
}}

実行中に現在のハードウェアクロックの時刻を確認するには:

{{RootCmd|hwclock --show}}

ハードウェアクロックを現在のシステムクロックに合わせて設定するには:

{{RootCmd|hwclock --systohc}}

=== Syncing Hardware clock and System time ===

Typically the hardware clock is used to setup the system clock on boot. This can be done by the kernel itself or by a boot service (init script). Also on shutdown the kernel or a service can write the software clock to the hardware clock. This aids the system in having the correct time on boot.

==== In-kernel method ====

On a sufficiently modern kernel (3.9 or newer), Linux can be configured to handle setting the system time automatically. To do so, also the '''Set system time ...''' and '''Set the RTC time ...''' drivers need to be activated:

{{KernelBox|title=Letting the kernel sync the system clock|1=
Device Drivers  --->
    [*] Real Time Clock  --->
        [*]   Set system time from RTC on startup and resume
        [*]   Set the RTC time based on NTP synchronization
        [*]   /sys/class/rtc/rtcN (sysfs)
        [*]   /proc/driver/rtc (procfs for rtcN)
        [*]   /dev/rtcN (character devices)
        <*>   PC-style 'CMOS'
}}

Please note that '''Set the RTC time based on NTP synchronization''' is not used by some [[Network Time Protocol|NTP implementations]]. Supported NTP implementations include: {{Package|net-misc/chrony}} (more information [http://chrony.tuxfamily.org/comparison.html here]) and {{Package|net-misc/ntp}} (more information in the [[Ntp|NTP article]]). OpenNtpd ({{Package|net-misc/openntpd}}) does '''not''' support setting the hardware time and therefore should be avoided.

To check if the hardware time is updated, run:

{{RootCmd|adjtimex --print {{!}} grep status}}

The 64 bit of the reported number should be unset (0). More information in hwclock man pages (search '11 minute mode').

==== OpenRC ====

When using OpenRC the {{Path|hwclock}} init script can set the system clock on boot and sync system time to the hardware clock on shutdown. The service is enabled by default and should be ''disabled'' in favor of the above mentioned in-kernel method. The {{Path|hwclock}} script should ''not'' be run when using the kernel's real time clock. 

{{RootCmd|rc-update delete hwclock boot}}

If however there is a need for using the OpenRC, set both <code>clock_hctosys</code> and <code>clock_systohc</code> to <code>YES</code> in {{Path|/etc/conf.d/hwclock}}. By default the service is configured for UTC time standard. To change to localtime add <code>clock="local"</code>.

{{FileBox|filename=/etc/conf.d/hwclock|title=Adding hardware clock sync|lang=bash|1=
clock_hctosys="YES" 
clock_systohc="YES"
# clock="local"
}}

Restart the {{Path|hwclock}} service and have the hardware clock init script run on system boot:

{{RootCmd
|rc-service hwclock restart
|rc-update add hwclock boot
}}

==== Systemd ====

[[systemd]] can be used to set the system clock on boot. Use {{c|timedatectl}} to manage the hardware clock:

To check the current hardware clock time:

{{Cmd|timedatectl {{!}} grep "RTC time"}}

To set the hardware clock to the current system clock (UTC time standard):

{{RootCmd|timedatectl set-local-rtc 0}}

To set the hardware clock to the current system clock (localtime time standard):

{{RootCmd|timedatectl set-local-rtc 1}}

== See also ==

* [[Network Time Protocol]]
* [[Ntp|NTP]] - An implementation of the network time protocol.
* [[OpenNTPD|OpenNTPD]] - Lightweight NTP server ported from OpenBSD

== External resources ==

* http://lifehacker.com/5742148/fix-windows-clock-issues-when-dual-booting-with-os-x - Dual booting with MS Windows, set RealTimeIsUniversal. Also tested with [[UEFI_Dual_boot_with_Windows_7/8|Windows 10]].
* http://tldp.org/HOWTO/Clock-2.html - The Clock Mini-HOWTO.


[[Category:Localization]]
