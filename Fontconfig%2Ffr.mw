<languages />
{{InfoBox stack
|{{InfoBox wikipedia|header=true}}
|{{InfoBox homepage|http://www.freedesktop.org/wiki/Software/fontconfig/}}
}}

La bibliothèque {{c|fontconfig}} ({{package|media-libs/fontconfig}}) a pour but de permettre une uniformisation de la configuration entre les différents GUI. Bien qu'il soit commun de pouvoir configurer les polices dans un [[Desktop environment]], {{c|fontconfig}} reste une bibliothèque sous-jacente.

== Installation ==

Le paquet {{c|fontconfig}} est souvent installé automatiquement. Si ce n'est pas le cas, assurez vous que le système graphique (comme [[X]] ou [[Wayland]]) et un [[desktop environment]] sont installés.

=== Options de la variable USE ===

{{c|fontconfig}} n'utilise pas beaucoup d'option USE.

{{USEflag|package=media-libs/fontconfig}}

== Configuration ==

{{Note|Les changements apportés aux configurations de  {{c|fontconfig}} ne prendront effet sur les applications démarrés qu'après qu'elles soient redémarrés.}}

=== Generique ===

{{c|fontconfig}} utilise des fichiers XML dans le dossier {{Path|/etc/fonts/}} pour sa configuration. Il utilise par défaut {{Path|/etc/fonts/fonts.conf}} (les utilisateurs ne doivent pas éditer ce fichier !) qui met en place des configurations par défaut et contient du code renvoyant vers {{Path|/etc/fonts/conf.d/}} pour la configuration. Le dossier {{Path|/etc/fonts/conf.avail/}} contient différents fichiers de configuration qui couvrent chacun différents aspects de {{c|fontconfig}}. Il y a généralement des liens symboliques allant des fichiers nécessaires vers {{Path|/etc/fonts/conf.d/}}. Ces fichier sont exécutés dans l'ordre de leur nom. C'est pour cela que leur noms commencent par un nombre à deux chiffres. Le premier chiffre (les dizaines) indique à quoi le fichier s'applique (on l'appelle la classe).

=== Ressources spécifiques à Gentoo ===

Gentoo propose le module [[eselect]] ({{c|eselect fontconfig}}) qui fait exactement ce qui a été décrit de façon simple : il gère les liens symboliques dans le dossier{{Path|/etc/fonts/conf.d}}. Changer les configurations avec ce module requiert les permissions appropriées.

La sous section suivante explique comment se servir du module {{c|fontconfig}} de eselect.

==== Lister les fichiers disponibles ====

La commande {{c|list}} montre les fichiers de configuration de {{c|fontconfig}} disponibles, et marque les fichiers activés avec une astérisque (<code>*</code>).

{{RootCmd|eselect fontconfig list
|output=<pre>
Available fontconfig .conf files (* is enabled):
  [1]   10-autohint.conf *
  [2]   10-no-sub-pixel.conf
  [3]   10-sub-pixel-bgr.conf
  [4]   10-sub-pixel-rgb.conf
  [5]   10-sub-pixel-vbgr.conf
  [6]   10-sub-pixel-vrgb.conf
  [7]   10-unhinted.conf
  [8]   11-lcdfilter-default.conf
  [9]   11-lcdfilter-legacy.conf
  ...
</pre>}}

{{Warning|Différents systèmes peuvent affecter différentes valeurs pour chaque police dans le dossier {{Path|fonts.avail}}. Ainsi, les sorties peuvent être différentes. Faites attention à ne pas utiliser aveuglément cette commandes (comme dans le cas des commandes proposées dans les blogs ou de wiki).}}

==== Activer une police ====

Les polices peuvent être activées soit en indiquant le chemin du fichier, soit en utilisant le nombre entre crochets. Ainsi, les deux commandes suivantes font la même chose :

{{RootCmd
|eselect fontconfig enable 10-sub-pixel-rgb.conf
|eselect fontconfig enable 4
}}

==== Désactiver une police ====

Les polices peuvent être désactivées comme suit :

{{RootCmd
|eselect fontconfig disable 10-sub-pixel-rgb.conf
|eselect fontconfig disable 4
}}

=== Configuration avancées du système ===

Pour faire une fichier {{c|fontconfig}} spécial, activez {{Path|51-local.conf}} et créez  le fichier XML {{Path|/etc/fonts/local.conf}}.

{{FileBox|filename=/etc/fonts/local.conf|title=Example file that sets preferred font fallback order for sans-serif font|lang=xml|1=
<?xml version="1.0"?>
<!DOCTYPE fontconfig SYSTEM "fonts.dtd">
<fontconfig>
  <alias>
    <family>sans-serif</family>
    <prefer>
      <family>Ubuntu</family>
      <family>TakaoPGothic</family>
      <family>Droid Sans</family>
    </prefer>
    <default><family>DejaVu Sans</family></default>
  </alias>
</fontconfig>
}}

Pour être clair, cela signifie qu'on indique au système qu'on "préfère" utiliser Ubuntu en tant que police sans-serif, ensuite (par ordre d'utilisation) TakaoPGothic, et Droid Sans, puis DejaVu Sans.  choix peuvent être faits ici. On peut bien sûr choisir différentes polices dans un ordre différent.

=== Configuration pour un utilisateur ===

Pour faire une configuration par utilisateur des fichiers de {{c|fontconfig}}, il faut activer le fichier {{Path|50-user.conf}} (normalement activé par défaut), et configurer le fichier {{Path|~/.config/fontconfig/fonts.conf}}. Ce fichier utilise le même format XML que {{Path|local.conf}}.

{{Note|Les environnements de bureau devraient essayer d'affecter les différentes polices de cette façon. Il pourrait néanmoins être plus prudent de désactiver cela de façon à être sûr que ce qui va être affiché dépend de la configuration système lorsqu'on cherche à la modifier. Désactiver cette option permet d'avoir un rendu uniforme entre les différents comptes utilisateurs.}}

{{Note|Le fichier {{Path|~/.font.conf}} utilisé auparavant est n'est plus supporté. Il faut maintenant utiliser les dossiers basés sur <var>$XDG_CONFIG_HOME</var>. Cette variable est {{Path|~/.config}} par défaut.}}

=== Vérification de la configuration ===

Vérifiez la police de remplacement par défaut. Par exemple, pour Arial, en tapant :

{{Cmd|fc-match Arial}}

=== Anti crénelage, optimisation, et rendu sous-pixel ===

Le rendu peut être modifié lui aussi. Nous allons ici modifier l'"Anti crénelage" et le "rendu sous-pixel".

{| class="table table-striped table-condensed"
|-
! scope="col" width="25%" | Feature
! Description
|-
| Anti crénelage
| est activé par défaut et permet d'obtenir une police moins pixelisée.
|-
| Optimisation
| est une tentative de faire face au faible nombre de pixel par unité d'aire des systèmes d'affichage actuel. Une bonne optimisation permet d'avoir des caractères plus nette sans changer la longueur d'une chaîne de caractère. Cela affecte donc uniquement l'apparence du texte. 
|-
| Rendu sous-pixel
| utilises le fait que les grilles LCD utilisent trois LED par pixel pour tripler la résolution du texte. Les caractère peuvent ne pas apparaître entièrement noir. Pour combattre cela, {{c|lcdfilter}} peut être utilisé avec l'option "rendu sous-pixel" (disponible pour les dernière versions de {{c|fontconfig}}), mais il peut trop flouter un caractère. En fin de compte, cela dépend entièrement de comment quelqu'un aime son texte.
|}

=== Optimisation forcée ===

The default {{c|fontconfig}} behavior regarding hinting is rather undocumented, but it can be made deterministically sub-optimal by making a system wide default.

# [[#Configuration personnalisée|D'abord activez {{Path|/etc/fonts/local.conf}}]]
# Ensuite, éditez le fichier {{Path|local.conf}} pour inclure l'optimisation par défaut. 

Cet extrait de code de {{Path|local.conf}} active toutes les options d'optimisation :

{{FileBox|filename=/etc/fonts/local.conf|title=Setting hinting to full|lang=xml|1=
<match target="font">
  <edit mode="assign" name="hintstyle">
    <const>hintfull</const>
  </edit>
</match>
}}

{{Note|La plupart des polices ont l'air plus belles avec les optimisations, mais certaines ont besoins de quelques changements ou plus rarement d'autres options d'optimisation. Certaines polices pour une raison ou une autre restent toujours laides.}}

=== Utilisation du rendu sous-pixel ===

It's important to determine the sub-pixel layout of the LCD matrix. It's usually RGB ({{Path|10-sub-pixel-rgb.conf}}) but the only way to be sure is to either consult display specification or use this [http://www.lagom.nl/lcd-test/subpixel.php sub-pixel layout test] to determine it.

Once determined, enable the appropriate {{Path|10-sub-pixel-''<matrix type>''.conf}} file.

{{RootCmd|eselect fontconfig enable 10-sub-pixel-rgb.conf}}

It's strongly advised that {{c|lcdfilter}}, if available, is used with sub-pixel rendering. It comes in different varieties but the default ({{Path|11-lcdfilter-default.conf}}) should be appropriate for all common fonts.

{{RootCmd|eselect fontconfig enable 11-lcdfilter-default.conf}}

{{Warning|The <code>bindist</code> USE flag in {{Package|media-libs/freetype}} disables sub-pixel rendering altogether due to potential patenting issues. In order to use sub-pixel rendering, the USE flag must be disabled (i.e., <code>-bindist</code>) for this package.}}

=== Regarding autohinter ===

Autohinter attempts to do automatic hinting disregarding any existing hinting information. Until recently it was the default because TrueType2 was covered by patents but now that they have expired there's very little reason to use it. From technical point of view it does better than broken or no hinting information but it will be strongly sub-optimal for fonts with good hinting information. Generally system fonts are of the second kind so autohinter should not be used.

{{Warning|Autohinter is not compatible with sub-pixel rendering, do not use the two together!}}

== Infinality ==

Infinality is a (somewhat controversial) set of patches for FreeType and accompanying {{c|fontconfig}} files. The goal of Infinality is to provide higher quality font rendering including emulation of other OS font rendering styles.

{{Note|As usual with software still in development it is prudent to always use only the latest version available unless there are known problems with it.}}

=== Enabling Infinality ===

Enable the 'infinality' USE flag by editing {{Path|make.conf}} either manually or by using the {{c|[[euse]]}} tool.

{{RootCmd|euse -E infinality}}

Next, rebuild the affected programs.

{{Emerge|params+=-uvDU|@world}}

Unless messages shown after rebuild tell otherwise, enable {{Path|52-infinality.conf}}.

{{RootCmd|eselect fontconfig enable 52-infinality.conf}}

=== Configuring Infinality ===

Infinality can be configured in various ways including custom configurations, but easiest is to use pre-made profiles shipped in {{Package|media-libs/fontconfig-infinality}} that along with eselect modules should have been installed as dependencies of the <code>infinality</code> USE flag.

==== Quick and reasonable config ====

{{RootCmd|eselect infinality set infinality
|eselect lcdfilter set infinality}}

{{Note|As always, {{c|fontconfig}} changes affect only applications started after changes have been made.}}

It's also recommended to disable all {{c|fontconfig}} settings except for {{Path|52-infinality.conf}} as they interfere with the rendering of infinality styles:

{{RootCmd|eselect fontconfig disable <number>}}

Certain {{c|fontconfig}} settings do not interfere with how the fonts are rendered, but rather determine the default fonts for font-types (such as Monospace, sans-serif, etc.). Such settings (for example the {{Path|62-croscore-*.conf}} configurations) can be left enabled.

==== Explanation ====

Infinality provides FreeType environment variables that can be used to configure features introduced with its patches as well as {{c|fontconfig}} files to be used with these changes. {{c|fontconfig}} file sets are administrated on Gentoo via {{c|eselect infinality}} while the FreeType behaviour is set using {{c|eselect lcdfilter}}.

These eselect modules function as usual:

* Listing available {{c|fontconfig}} file sets.
: {{RootCmd|eselect infinality list}}
* Listing available FreeType variable sets.
: {{RootCmd|eselect lcdfilter list}}
* Both sets should match of course except when there are multiple matches possible such as shown below.
: {{RootCmd|eselect infinality set win7|eselect lcdfilter set windows-7-light}}

== Picking fonts ==

Choosing the right font can be trickier than deciding on the right hinting type. For one reason or another, some fonts will never be perfect — but it's certainly possible to make them look better than, say, the Windows 7 default font configuration. 

Here are some recommendations regarding well known fonts in Gentoo:

{| class="table table-striped table-condensed"
|-
! scope="col" width="25%" |Font family
! Pros
! Cons
|-
|Liberation<br>{{Package|media-fonts/liberation-fonts}}
| [[Wikipedia:Red Hat|Red Hat's]] fonts, which are metric-compatible with MS TrueType [[Wikipedia:Corefonts|corefonts]], have a decent, modern look. This is the [[Project:Fonts|Gentoo Fonts team]] recommendation for default Latin fonts. Covers about 2,600 code points.
| Latin, Greek, Cyrillic, and Hebrew only. A few glyphs may have hinting trouble.
|-
|Linux Libertine<br>{{Package|media-fonts/libertine}}
| Very similar to Liberation, covering about 2,700 code points. Linux Libertine itself is proportional serif only, but the package contains less extensive sans and mono fonts, as well. Can be used as a fallback for some glyphs not in Liberation.
| Latin, Greek, Cyrillic, and Hebrew only. Sans and mono fonts are limited.
|-
|Noto<br>{{Package|media-fonts/noto}}
| Google's font family that aims to support all the world's languages (so, well over 60,000 code points). It goes well with Liberation or Droid. Adobe's Source Han Sans fonts are included for [[Wikipedia:CJK|CJK]]. Recommended as a fallback for many glyphs not covered by Liberation.
| Big download.
|-
|DejaVu<br>{{Package|media-fonts/dejavu}}
| Many styles and covers a lot of code points (about 6,100 for sans).
| Exceptionally wide — even condensed is wider than same-height monospace. Overall second to [[Wikipedia:Verdana|Verdana]] (an MS font) in width. Sans-serif font is only average.
|-
|Droid<br>{{Package|media-fonts/droid}}
| Covers a lot of code points and scripts.
| Very dry, wide yet thin glyphs. Clearly designed with handheld devices and their small screens in mind.
|-
|Gentium Plus<br>{{Package|media-fonts/sil-gentium}}
| Fairly distinctive; might appeal to people who like narrow fonts.
| Serif only. As with other [[Wikipedia:SIL International|SIL]] fonts, the hinting is questionable.
|-
|Ubuntu<br>{{Package|media-fonts/ubuntu-font-family}}
| Used in [[Wikipedia:Ubuntu (operating system)|Ubuntu]] (obviously). A distinctive font family with a style which might not appeal to everyone. Overall looks good and covers a fair number of code points.
| Only the sans-serif font is truly polished; narrow and monospaced versions are unfinished. No known serif font that would accompany it well.
|-
|URW<br>{{Package|media-fonts/urw-fonts}}
| Metric compatible with popular Adobe fonts (among others?).
| Seem to require slight hinting.
|-<!--Keep these below the open-source fonts.-->
|MS TrueType corefonts<br>{{Package|media-fonts/corefonts}}
| Includes most fonts used in documents and on the web.
| MS does not distribute them nowadays, so the available fonts are from many years ago and do not reflect their current state (not to mention the state of the art). Obviously, lacks fonts introduced more recently. Require full hinting.
|-<!--Always keep this entry at the bottom as the only reason it's included is to warn people against using it!-->
|Unifont<br>{{Package|media-fonts/unifont}}
| Covers a lot of code points.
| In addition to being ''ugly as sin'', it also fails some basic requirements to be considered a typeface. Is it sans-serif? Is it serif? ''Please never use this.''
|}

== External resources ==

* In-depth articles from Arch Linux wiki on:
** [https://wiki.archlinux.org/index.php/Font_configuration Font configuration]
** [https://wiki.archlinux.org/index.php/Infinality Infinality]
* [http://freedesktop.org/software/fontconfig/fontconfig-user.html Official {{c|fontconfig}} documentation for users]
* [[Wikipedia:Hinting|Wikipedia article on font hinting]]

[[Category:Desktop]]
