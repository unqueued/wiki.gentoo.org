<languages/>

== Развертывание системы ==

Поскольку мульти-системы (комплекс взаимосвязанных программ, которые могут быть разнесены на несколько машин) больше не являются экзотикой и есть множество способов такой реализации, хотя также можно держать вообще всё в одной «коробке».

=== Дополнительные пакеты ===

Поскольку веб-сервер (Apache рекомендуется) требуется для таких вещей, как веб почта и postfixadmin, то хотя бы один из них должен быть установлен. Инструкции по установке [[Apache/ru|Apache]] и [[PHP|PHP]] можно найти на вики.

{{Note|Для нетерпеливых, установка Apache с PHP - это так же просто, как настройка соответствующих USE-флагов и инсталляция пакета {{Package|dev-lang/php}}, который подтянет {{Package|www-servers/apache}}.}}

Как минимум следующие USE-флаги должны быть установлены:

{{FileBox|filename=/etc/portage/package.use|1=
dev-lang/php apache2 imap postgres mysql
}}

{{Note|Если нужна ясность, установите один требуемый USE-флаг для базы данных.}}

Далее просто установите {{Package|dev-lang/php}}:

{{Emerge|dev-lang/php}}

=== Необходимые пакеты ===

В отличии от упомянутых выше apache/php, установка следующих пакетов обязательна. Конечно, если стоит выбор между разными пакетами, то устанавливать следует нужные. Например, не устанавливайте и mysql, и postgres (если, конечно, они оба не используются для разных целей). Некоторые пакеты могут быть затянуты как зависимости других пакетов из-за установленных USE-флагов.

Также, если пакеты были обновлены и опции изменены, пожалуйста, обновите этот документ в требующих этого разделах.

Ниже представлены все пакеты, установленные и настроенные в этом документе.

На веб сервер необходимо установить следующие пакеты:
* {{Package|app-admin/webmin}} (optional)
* {{Package|www-apps/postfixadmin}}
* {{Package|mail-client/roundcube}}
* {{Package|www-misc/awstats}}

На почтовый необходимо установить эти пакеты:
* {{Package|dev-db/postgresql}} или {{Package|dev-db/mysql}}
* {{Package|net-mail/courier-imap}}
* {{Package|net-libs/courier-authlib}}
* {{Package|dev-libs/cyrus-sasl}}
* {{Package|mail-filter/amavisd-new}}
* {{Package|mail-filter/spamassassin}}
* {{Package|app-antivirus/clamav}}
* {{Package|mail-mta/postfix}}
* {{Package|mail-filter/gld}}

== Предварительные требования ==

В этом пункте большинство пользователей просто ожидают получить хороший материал. До того, как закопаться в него, настоятельно рекомендуется ознакомится со следующим:
# ПРОЧИТАЙТЕ ЭТОТ ДОКУМЕНТ. Он объемный и дает множество поводов «съехать с рельс». Выделите время для ознакомления со всеми шагами и поймите роль каждого пакета, и восстановление после ошибок будет куда проще.
# Не все пакеты, требуемые для работы базового почтового сервера, включены в этот HOWTO. Авторизация SMTP, средства управления веб, фильтрация спама, и т. д., не являются предметами первой необходимости для почтовых сервисов, но будут хорошим дополнением. Читая это, во-первых, следует определится, какие из этих средств требуются, а какие нет.
# Как и все HOWTO, это предполагает, что все в системе появляется в результате необходимости, и это все работает правильно на каждом шаге. В действительности, такое предположение ошибочно, и в который раз веб утверждает бесценный ресурс в разрешение любой, могущей случится, проблемы.
# Ключ для проверки всего этого имеет как минимум один домен (для тестирования виртуальных доменов лучше подойдут два) с соответствующей установкой MX записей. Он имеет множество параметров DNS, поэтому пара доменов и поддержка сервисов DNS не должна стоить больше $10 в год. Сейчас не время гнаться за дешевизной. Вложите деньги и сделайте жизнь гораздо проще.
# Обратите особое внимание на сообщения после установки любых пакетов. В зависимости от состояния машины до начала установки, она может привести к необходимости обновления некоторых конфигурационных файлов. Для разрешения этого используйте {{c|dispatch-conf}} или {{c|etc-update}}. В этом HOWTO нет инструкций, раскрывающих этот зависящий от системы момент.
# Будьте уверены в актуальности системы. Для начала выполните {{RootCmd|emerge --sync}} и {{RootCmd|emerge -uDNva @world}}. Ряд проблем могут возникать в связи с отсутствием поддержки новых средств у старых приложений.

Наконец, что бы избежать множество переделок, проверьте переменные USE-флаги в файле {{Path|/etc/portage/make.conf}} перед тем, как начать что-то компилировать. Если установлены неправильные флаги, это, скорее всего, означает необходимость в пересборке для гарантии того, что все переменные будут поддерживаться.

{| class="table table-condensed table-striped"
|-
! USE-флаг
! Описание
|-
| <code>authdaemond</code>
| Нужен для courier-imap.
|-
| <code>bzip2</code>
| Требуется для вирусного сканера.
|-
| <code>clamdtop</code>
| Инструмент ClamAV наподобие 'top'. Если почтовый сервер сильно загружен запущенным clamav, clamdtop поможет отладить его.
|-
| <code>crypt</code>
| Функции шифрования для PHP. Используются для паролей в веб-интерфейсе.
|-
| <code>geoip</code>
| Нахождение месторасположения по IP-адресу, что необходимо для spamassasin  и т.д.
|-
| <code>imap</code>
| Один из главных интерфейсов, предложенный в этом HOWTO для доступа клиентов к электронной почте.
|-
| <code>ipv6</code>
| Если в системе имеется связь по IPv6, то включите эту опцию. Хорошо протестировано и отменно работает в Postfix, Courier и Apache.
|-
| <code>maildir</code>
| Выбор формата maildir, поддерживаемый Postfix (одна из причин выбрать Postfix).
|-
| <code>mbox</code>
| Ни в коем случае не используйте mbox.
|-
| <code>mysql</code>
| Если поддержка mysql желательна, включите эту опцию.
|-
| <code>postgres</code>
| Если поддержка postgres желательна, включите эту опцию.
|-
| <code>sasl</code>
| Простой уровень аутентификации и безопасности. Настоятельно рекомендуется.
|-
| <code>spamassassin</code>
| Рекомендуется, если требуется фильтрация спама.
|- 
| <code>spell</code>
| Проверка орфографии для PHP. Используется в webmail.
|-
| <code>ssl</code>
| SSL соединения. Настоятельно рекомендуется.
|-
| <code>urandom</code>
| Используется в cyrus-sasl. Настоятельно рекомендуется.
|-
| <code>vda</code>
| Поддержка квот для postfix. Обеспечивает поддержку квот для виртуального агента доставки. Не поддерживается в Postfix 3.0, который сейчас имеет статус стабильного в portage.
|-
| <code>vhosts</code>
| Поддержка виртуальных хостов. Настоятельно рекомендуется.
|}

С корректным набором USE-флагов, простая установка {{Package|mail-mta/postfix}} затянет большинство, если не все, нужные пакеты.

{{Emerge|postfix}}

[[Category:Mail Servers]]
