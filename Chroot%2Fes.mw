<languages />

Chroot ('''Ch'''ange '''root''') es una utilidad del sistema Unix que se emplea para cambiar el directorio raíz aparente de modo que se pueda crear un nuevo entorno separado lógicamente del directorio raíz del sistema principal. Este nuevo entorno se conoce como una "jaula chroot". Un usuario que opere dentro de la jaula no puede ver ni acceder ficheros fuera del entorno en el que se le ha confinado.

Uno de los usos principales usos del enjaulamiento es crear un sistema Linux independiente encima del actual para realizar pruebas o compatibilidad del software. Chroot se ve a menudo como una alternativa ligera a la virtualización, ya que se puede correr sin la sobrecarga de un supervisor.

== Setting up the environment ==

When creating a new chroot setup, the first thing needed is a directory for the chroot to reside in. For example, a chroot could be created in {{Path|/mnt/mychroot}}:

{{Cmd
|mkdir /mnt/mijaula
|cd /mnt/mijaula
}}

To mount an existing installation from a partition the following command can be ran. Be sure to replace the <code><DEVICE></code> string in the example below with the drive and partition of the existing installation:

{{Cmd
|mkdir /mnt/mijaula
|mount /dev/DISPOSITIVO /mnt/mijaula
}}

If an installation has been previously created in a sub directory of the current root file system the above steps can be skipped.

== Unpacking system files and the Portage tree (new installations) ==

When building a new install, the next step is to download the stage3 and Portage tarballs and set them up in the chroot location. For more information on this process please see sections 5a and 5b in the [http://www.gentoo.org/doc/en/handbook/handbook-amd64.xml?part=1&chap=5 Gentoo Handbook].

{{RootCmd
|links http://distfiles.gentoo.org/releases/amd64/current-stage3/
|tar xvjpf stage3-*.tar.bz2 -C /mnt/mijaula
|links http://distfiles.gentoo.org/snapshots/
|tar xvjf portage-*.tar.bz2 -C /mnt/mijaula/usr
}}

== Configuración ==

Antes de introducirse en la jaula se necesita montar algunos directorios:

{{RootCmd
|mount -o bind /dev /mnt/mijaula/dev
|mount -t proc none /mnt/mijaula/proc
|mount -o bind /sys /mnt/mijaula/sys
|mount -o bind /tmp /mnt/mijaula/tmp
}}

Some basic configuration files will need to be copied from the host, do not copy over {{Path|make.conf}} when using an existing installation:

{{Cmd
|cp /etc/portage/make.conf /mnt/mijaula/etc/portage # Si está usando una instalación ya existente, no lance esta orden.
|cp /etc/resolv.conf /mnt/mijaula/etc
}}

Once done enter the chroot environment by executing the following commands:

{{RootCmd
|chroot /mnt/mijaula /bin/bash
|env-update
|source /etc/profile
|<nowiki>export PS1="(chroot) $PS1"</nowiki>
}}

When creating a new installation Portage should be synced to make sure everything is up to date.

{{RootCmd
|emerge --sync
}}

The system is now ready; feel free to install software, mess with settings, test experimental packages and configurations without having any effect on the main system. To leave the chroot simply type <kbd>exit</kbd> or press {{Key|Ctrl}}+{{Key|D}}. Doing so will return the console back to the normal environment. Do not forget to umount the directories that have been mounted.

== Guiones de inicio ==

If setting up chroots is a task that is needed to be performed often, it is possible to speed up the mounting of the directories by using an init script:

{{File|/etc/init.d/mijaula||
 #!/sbin/runscript
 
 depend() {
    need localmount
    need bootmisc
 }

 start() {
    ebegin "Montando directorios jaula"
    mount -o bind /dev /mnt/mijaula/dev > /dev/null &
    mount -t proc none /mnt/mijaula/proc > /dev/null &
    mount -o bind /sys /mnt/mijaula/sys > /dev/null &
    mount -o bind /tmp /mnt/mijaula/tmp > /dev/null &
    eend $? "Ocurrió un error cuando se montaban los directorios jaula"
 }

 stop() {
    ebegin "Desmontando directorios jaula"
    umount -f /mnt/mijaula/dev > /dev/null &
    umount -f /mnt/mijaula/proc > /dev/null &
    umount -f /mnt/mijaula/sys > /dev/null &
    umount -f /mnt/mijaulat/tmp > /dev/null &
    eend $? "Ocurrió un error cuando se desmontaban los directorios jaula"
 }
}}

When using a different directory or partition, add the necessary mounting commands in the <code>start()</code> function and change {{Path|/mnt/chroot}} to the appropriate name.

== Vea también ==

* [http://www.gentoo.org/proj/en/base/x86/chroot.xml Guía de configuración Chroot en x86 de Gentoo]


[[Category:Core system]]
