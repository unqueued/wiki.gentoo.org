<languages />

Chroot ('''Ch'''ange '''root''') es una utilidad del sistema Unix que se emplea para cambiar el directorio raíz aparente de modo que se pueda crear un nuevo entorno separado lógicamente del directorio raíz del sistema principal. Este nuevo entorno se conoce como una "jaula chroot". Un usuario que opere dentro de la jaula no puede ver ni acceder ficheros fuera del entorno en el que se le ha confinado.

Uno de los usos principales usos del enjaulamiento es crear un sistema Linux independiente encima del actual para realizar pruebas o compatibilidad del software. Chroot se ve a menudo como una alternativa ligera a la virtualización, ya que se puede correr sin la sobrecarga de un supervisor.

== Configurar el entorno ==

Cuando se crea una nueva configuración de chroot, lo primero que se necesita es un directorio para que resida chroot. Por ejemplo, se podría crear un chroot en {{Path|/mnt/mijaula}}:

{{Cmd
|mkdir /mnt/mijaula
|cd /mnt/mijaula
}}

Para montar una instalación ya existente desde una partición, se puede lanzar la siguiente orden. Asegúrese de reemplazar la cadena <code><DISPOSITIVO></code> en el ejemplo de abajo por el disco y partición de la instalación existente:

{{Cmd
|mkdir /mnt/mijaula
|mount /dev/DISPOSITIVO /mnt/mijaula
}}

Si ya se ha creado una instalación previamente en un subdirectorio del sistema de ficheros raíz actual, se pueden omitir los pasos indicados arriba.

== Desempaquetar los ficheros de sistema y el árbol Portage (nuevas instalaciones) ==

Cuando se está construyendo una nueva instalación, el siguiente paso es descargar el stage3 y los ficheros tarball de Portage para colocarlos en la localización chroot. Para obtener más información sobre este proceso, lea las secciones 5a y 5b en el [http://www.gentoo.org/doc/es/handbook/handbook-amd64.xml?part=1&chap=5 Manual de Gentoo].

{{RootCmd
|links http://distfiles.gentoo.org/releases/amd64/current-stage3/
|tar xvjpf stage3-*.tar.bz2 -C /mnt/mijaula
|links http://distfiles.gentoo.org/snapshots/
|tar xvjf portage-*.tar.bz2 -C /mnt/mijaula/usr
}}

== Configuración ==

Antes de introducirse en la jaula se necesita montar algunos directorios:

{{RootCmd
|mount -o bind /dev /mnt/mijaula/dev
|mount -t proc none /mnt/mijaula/proc
|mount -o bind /sys /mnt/mijaula/sys
|mount -o bind /tmp /mnt/mijaula/tmp
}}

Se necesitarán copiar algunos ficheros de configuración básica desde el anfitrión, no sobrescriba {{Path|make.conf}} cuando se esté utilizando una instalación ya existente.

{{Cmd
|cp /etc/portage/make.conf /mnt/mijaula/etc/portage # Si está usando una instalación ya existente, no lance esta orden.
|cp /etc/resolv.conf /mnt/mijaula/etc
}}

Una vez hecho esto, nos podemos introducir en el entorno jaula lanzando las siguientes órdenes:

{{RootCmd
|chroot /mnt/mijaula /bin/bash
|env-update
|source /etc/profile
|<nowiki>export PS1="(chroot) $PS1"</nowiki>
}}

Cuándo se esté realizando una instalación nueva, se debería sincronizar Portage para asegurarse de que todo está actualizado.

{{RootCmd
|emerge --sync
}}

The system is now ready; feel free to install software, mess with settings, test experimental packages and configurations without having any effect on the main system. To leave the chroot simply type <kbd>exit</kbd> or press {{Key|Ctrl}}+{{Key|D}}. Doing so will return the console back to the normal environment. Do not forget to umount the directories that have been mounted.

== Guiones de inicio ==

If setting up chroots is a task that is needed to be performed often, it is possible to speed up the mounting of the directories by using an init script:

{{File|/etc/init.d/mijaula||
 #!/sbin/runscript
 
 depend() {
    need localmount
    need bootmisc
 }

 start() {
    ebegin "Montando directorios jaula"
    mount -o bind /dev /mnt/mijaula/dev > /dev/null &
    mount -t proc none /mnt/mijaula/proc > /dev/null &
    mount -o bind /sys /mnt/mijaula/sys > /dev/null &
    mount -o bind /tmp /mnt/mijaula/tmp > /dev/null &
    eend $? "Ocurrió un error cuando se montaban los directorios jaula"
 }

 stop() {
    ebegin "Desmontando directorios jaula"
    umount -f /mnt/mijaula/dev > /dev/null &
    umount -f /mnt/mijaula/proc > /dev/null &
    umount -f /mnt/mijaula/sys > /dev/null &
    umount -f /mnt/mijaulat/tmp > /dev/null &
    eend $? "Ocurrió un error cuando se desmontaban los directorios jaula"
 }
}}

When using a different directory or partition, add the necessary mounting commands in the <code>start()</code> function and change {{Path|/mnt/chroot}} to the appropriate name.

== Vea también ==

* [http://www.gentoo.org/proj/en/base/x86/chroot.xml Guía de configuración Chroot en x86 de Gentoo]


[[Category:Core system]]
