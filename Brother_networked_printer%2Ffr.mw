<languages />
Ce document traite de l'installation d'une imprimante réseau Brother. Il ne couvre que l'installation en réseau en prenant comme exemple le modèle DCP-750CW. Il s'applique néanmoins à d'autres modèles.

{{Important| Bien que cette page soit autosuffisante pour l'installation d'une imprimante, il est conseillé de lire, outre cette page, la page  [[Printing|Impression]] dans son intégralité avant de commencer cette installation.}} 

== Retour d'expérience des utilisateurs ==

Après avoir appliqué ce guide, merci de mettre le tableau suivant à jour de manière à ce que les autres utilisateurs puissent facilement savoir si une installation réussie a déjà eu lieu avec le modèle de leur choix.

{| class="table"
|-
!Modèle de l'imprimante
!Arch.
! Configuration Gentoo
!Imprimante?
!Scanner?
!Remarques
|-
|DCP-750CW
|X86_64
|gnome3.8 systemd & gnome OpenRC
|Marche!
|Marche!
|Pas de remarque
|-
|DCP-7055W
|X86_64
|3.15.9-gentoo, KDE 4.14.3
|Marche!
|Marche!
|Pas de remarque
|-
|DCP-J140W
|X86_64
|3.14.14-gentoo & genkernel
|Marche!
|Marche!
|Le scanner ne fonctionne qu'après installation du paquet {{Package|dev-libs/libusb-compat}}. Merci à  i92guboj pour cette découverte et pour l'avoir posté sur Gentoo forums.
|-
|DCP-J925DW
|x86_64
|Xfce OpenRC
|Marche!
|Marche!
|Paquets ''net-print/brother-dcpj925dw'' et ''media-gfx/brscan4'' dans [https://gitweb.gentoo.org/dev/ulm.git/ dev/ulm overlay]
|-
|HL-L2340DW
|amd64
|OpenRC
|Marche!
|n/a
|Utilisez [https://github.com/stefan-langenmaier/brother-overlay/tree/master/net-print/brother-genml1-bin net-print/brother-genml1-bin] depuis [https://github.com/stefan-langenmaier/brother-overlay/tree/master/ brother-overlay]
|-
|MFC-J4410DW
|x86_64
|KDE SC 4.11.5 OpenRC
|Marche!
|Marche!
|Le filtre à copier est  {{Path|/opt/brother/Printers/mfcj4410dw/lpd/filtermfcj4410dw}} mais le  scanner n'est pas détecté par  xsane bien que l'installation soit OK.
|-
|MFC-J870DW
|x86_64
|Xfce OpenRC
|Marche!
|Marche!
|Paquets ''net-print/brother-mfcj870dw'' et ''media-gfx/brscan4'' dans [https://gitweb.gentoo.org/dev/ulm.git/ dev/ulm overlay]
|-
|MFC-J5910DW
|x86_64
|Gnome 3.12 Systemd
|Marche!
|Marche!
|Le filtre à copier est {{Path|/usr/lib64/cups/filter/brother_lpdwrapper_mfcj5910dw}}. Le paquet {{Package|dev-libs/libusb-compat}} est nécessaire pour la détection du scanner (voir section ''Problèmes fréquents') 
|-
|MFC-J6920DW
|x86_64
|XFce
|Marche!
|Marche!
|[http://support.brother.com/g/b/downloadlist.aspx?c=us&lang=en&prod=mfcj6920dw_us_eu_as&os=127&flang=English download page], filtre {{Path|/usr/lib64/cups/filter/brother_lpdwrapper_mfcj6920dw}}, commande de configuration du scanner <tt>brsaneconfig4</tt>
|-
|MFC-9320CW
|x86_64
|Gnome 3.10
|Marche!
|Marche!
| [https://github.com/stefan-langenmaier/brother-overlay arbre alternatif]
|-
|HL-4570CDW
|x86_64
|Gnome 3.10
|Marche!
|n/a
| [https://github.com/stefan-langenmaier/brother-overlay arbre alternatif]
|-
|MFC-7460DN
|x86_64,x86
|
|Marche!
|inconnu
| [https://github.com/stefan-langenmaier/brother-overlay arbre alternatif]
|-
|DCP-7060D, DCP-7065DN, DCP-8080DN, DCP-L2520DW, DCP-L2540DW, HL-2230, HL-2240, HL-2240D, HL-2270DW, HL-2280DW, HL-5370DW/HL-5370DWT, HL-5440D, HL-5450DN, HL-5470DW, HL-6180DW, HL-L2320D, HL-L2360DW, HL-L2380DW, MFC-7360N, MFC-7460DN, MFC-7860DW, MFC-8480DN, MFC-8510DN, MFC-8710DW, MFC-8890DW, MFC-8910DW, MFC-8950DW, MFC-L2700DW, MFC-L2720DW, MFC-L2740DW
|x86_64,x86
|
|Marche!
|inconnu
| [https://github.com/stefan-langenmaier/brother-overlay arbre alternatif]
|-
|MFC-8950DW
|x86_64
|KDE 4.12.5
|Marche!
|Marche!
| Le filtre à copier est : {{Path|/opt/brother/Printers/MFC8950DW/lpd/filter_MFC8950DW}}
|-
|MFC-5890CN
|x86_64
|Pas de dépendance
|Marche!
|Marche!
|commande de configuration du scanner <tt>brsaneconfig3</tt>
|-
|MFC-9970CDW
|x86_64
|n/a
|Marche!
|inconnu
|
|}

== Prérequis ==

=== cups ===

Assurez-vous que  {{Package|net-print/cups}} est installé:

{{Emerge|net-print/cups}}

Le service  cups service doit être démarré avant d'installer l'imprimante.

===== OpenRC =====

Si vous utilisez OpenRC, la commande suivante vous permet de démarrer le service  ''cups''.

{{RootCmd|/etc/init.d/cupsd start}}  

Pour que le démarrage du servie ait lieu automatiquement au démarrage, utilisez <tt>rc-update</tt>:

{{RootCmd|rc-update add cupsd default}}

===== Systemd  =====

Si vous utilisez systemd, vous pouvez démarrer le service ''cups'' avec la commande suivante:

{{RootCmd|systemctl start cups.service}}  

Pour que le service soit lancé au démarrage:

{{RootCmd|systemctl enable cups.service}}

== Installer les pilotes ==

=== Solution préférée : utilisation d'un arbre alternatif pour les pilotes ===

Si l'imprimante est prise en charge par un ''ebuild'' dans [https://github.com/stefan-langenmaier/brother-overlay/tree/master/ brother-overlay] ou quelque  [http://gpo.zugaina.org/Search?search=brother autre arbre alternatif], alors utilisez le, car il inclut les prérequis mentionnés ici. Il devrait vous permettre de sauter la section "Alternative : installation par rpm".

Pour activer cet  [[Overlay|arbre alternatif]], créez le fichier   {{Path|repos.conf}}  adéquat :

{{:/etc/portage/repos.conf/brother-overlay.conf/en}}

{{RootCmd|emaint sync -r brother-overlay && eix-update}}

Le paquet {{Package|dev-vcs/git}} doit être installé pour utiliser cet arbre alternatif. Une alternative consiste à utiliser [[layman#Adding_custom_overlays|layman]] pour ajouter cet arbre alternatif.

==== Brother BrGenML1 pour CUPS ====

L'''ebuild'' [https://github.com/stefan-langenmaier/brother-overlay/tree/master/net-print/brother-genml1-bin net-print/brother-genml1-bin] de [https://github.com/stefan-langenmaier/brother-overlay/tree/master/ l'arbre alternatif brother] contient les  pilotes d'impression génériques tels qui mis à disposition sur [http://support.brother.com/g/b/downloadlist.aspx?c=us&lang=en&prod=hll2340dw_us_eu_as&os=127 support.brother.com] pour une large plage de modèles compatibles (cliquez le lien ''Compatible Model'' sur [http://support.brother.com/g/b/downloadend.aspx?c=us&lang=en&prod=hll2340dw_us_eu_as&os=127&dlid=dlf101124_000&flang=4&type3=10034#pane3 BrGenML1 Compatible Models]): 
* Generic LPR printer driver (rpm package)
* Generic CUPSwrapper printer driver (rpm package)

{{Emerge|net-print/brother-genml1-bin}}

Dans cups le pilote apparaît comme  '''Brother BrGenML1 for CUPS'''.

[[File:Brother_BrGenML1_for_CUPS.png|border]]

=== Alternative: installation par rpm  ===

Comme les pilotes sont disponibles depuis le site de Brother sous la forme d'archives rpm le paquet {{Package|app-arch/rpm}} doit être installé.

{{Emerge|app-arch/rpm}}

==== Répertoires manquants ====

Veuillez créer ces répertoires; cela vous évitera pas mal de tracas par la suite.

{{RootCmd| mkdir -p /var/spool/lpd}}
{{RootCmd| mkdir -p /usr/lib64/cups/filter}}

==== Téléchargez les pilotes depuis le site de Brother ====

Les pilotes pour les imprimantes Brother sont disponibles sur la page [http://welcome.solutions.brother.com/bsc/public_s/id/linux/en/index.html Brother solutions'].

Suivez les instructions de pages pour trouver votre modèle. Choisissez les pilotes rpm pour linux.

Après avoir sélectionné votre modèle, quatre pilotes vous sont présentés pour téléchargement. Choisissez les pilotes dont le nom se termine par {{Path|.rpm}} pour  ''LPR driver'' et ''cupswrapper driver''.

==== Installer les pilotes ====

L'installation des pilotes peut se faire en plusieurs étapes ou en une seule selon que les repertoires nécessaires existent ou pas.

Pour installer les pilotes rendez-vous dans le repertoire où se trouvent les fichiers {{Path|.rpm}}.

Utilisez la commande suivante pour voir le nom exact de vos pilotes:

{{RootCmd|ls -a |output=<pre>
.  ..  dcp750cwcupswrapper-1.0.1-1.i386.rpm  dcp750cwlpr-1.0.1-1.i386.rpm
</pre>}}

Bien entendu, les noms des pilotes varient selon le modèle de votre imprimante. La sortie de la commande précédente est utile pour copier/coller les noms de fichiers et éviter les fautes de frappe.

Commencez par installer le pilote LPR.

{{RootCmd|rpm -i --nodeps dcp750cwlpr-1.0.1-1.i386.rpm}}

L'installation peut donner des avertissements, vous disant que certains repertoires manquent. Dans ce cas, ajoutez les repertoires manquants et ré-installez le pilote avec la commande suivante :

{{RootCmd|rpm -i --nodeps --replacepkgs dcp750cwlpr-1.0.1-1.i386.rpm}}

Installez ensuite le pilote ''cupswrapper'' de la même manière :

{{RootCmd|rpm -i --nodeps dcp750cwcupswrapper-1.0.1-1.i386.rpm}}

De la même manière l'installation peut se plaindre de repertoires manquants. Ajoutez les et ré-installez le pilote avec la commande suivante :

{{RootCmd|rpm -i --nodeps --replacepkgs dcp750cwcupswrapper-1.0.1-1.i386.rpm}}

{{Note|Pensez à ajouter l'option --replacepkgs pour forcer la ré-installation de tous les fichiers requis.}}

==== Copier le filtre à la bonne place ====

Copiez le filtre à la bonne place avec la commande suivante :

{{RootCmd|cp /usr/lib64/cups/filter/brlpdwrapperdcp750cw /usr/libexec/cups/filter/}}

== Installer l'imprimante ==

=== Connectez l'imprimante au réseau ===

Connect the printer to the network as described in the network section of the printer model's [http://support.brother.com/g/b/manuallist.aspx?c=us&lang=en&prod=hll2340dw_us_eu_as&flang=English&type3=10014&type2=5 Online User Guide]. From this step, the printer's network address can be obtained which is needed for CUPS in the next step.  When pointing the browser to the printer's network address it will go to the printer's user interface.

<gallery>
File:Myhomeprinter.png
</gallery>

=== Use cups' web interface to install the printer ===

Printer detection works much better if the printer is directly connected to the computer than via network.  So if possible connect the printer to the computer and point the browser at [http://localhost:631 localhost:631].

In the ''CUPS for Administrators'' section of the home page, click on ''Find New Printers''. It will list the available new printer(s). Then, in the printer's line item, click on  ''Add This Printer''.  On the next screen, accept or adjust name, description and location and press ''Continue''.  Complete the dialog with manufacturer Brother and the correct driver, and select ''Add Printer''.

{{Note|If the system asks for a user id and password, enter <tt>root</tt> and the root password. Regular users will not have the proper permissions to install a printer. It might be necessary to leave and re-enter the session to be able to authenticate as <tt>root</tt>.}}

Next, disconnect the printer from the computer.  In CUPS dialog, for the just installed printer, click the ''Administation'' drop down menu and select ''Modify Printer''.  On the next screens, select LPD/LPR, enter the network URL, click continue, select the previously installed "current driver" and ''modify Printer''.

<gallery>
File:Modify_printer1.png|Select LPD/LPR
File:Modify_printer2.png|Enter network URL
File:Modify_printer3.png|Continue
File:Modify_printer4.png|Press "Modify Printer"
</gallery>

{{Note|Other protocols than LPD/LPR can be used. Please refer to Brother's documentation.}}

Don't forget to set the user's default printer

{{Cmd|lpstat -a|output=<pre>
Brother_HL-L2340D_series accepting requests since Fri 29 May 2015 09:11:30 AM CEST
</pre>}}
{{Cmd|lpoptions -d Brother_HL-L2340D_series|output=<pre>
copies=1 device-uri=http://192.168.178.27:631/ipp/port1 finishings=3 job-cancel-after=10800 job-hold-until=no-hold job-priority=50 job-sheets=none,none marker-change-time=1432883490 marker-colors=#000000,none marker-high-levels=100 marker-levels=-1,95 marker-low-levels=16 marker-names='Black\ Toner\ Cartridge,Drum\ Unit' marker-types=toner number-up=1 printer-commands=AutoConfigure,Clean,PrintSelfTestPage printer-info='Brother HL-L2340D series' printer-is-accepting-jobs=true printer-is-shared=false printer-location='Local Printer' printer-make-and-model='Brother BrGenML1 for CUPS ' printer-state=3 printer-state-change-time=1432883490 printer-state-reasons=none printer-type=10522644 printer-uri-supported=ipp://localhost/printers/Brother_HL-L2340D_series
</pre>}}

== Installing the scanner  ==

=== Prerequisites ===

Make sure the {{Package|media-gfx/sane-backends}} package is installed in order to install the driver for the scanner. As most users will use <tt>xsane</tt> to scan a document, just emerge it. The {{Package|media-gfx/sane-backends}} package will be pulled in as a dependency.

{{Emerge|media-gfx/xsane}}

=== Installing the driver ===

Download the driver from the [http://welcome.solutions.brother.com/bsc/public_s/id/linux/en/download_scn.html Brother Solutions]'s download page for the scanner.

{{Important|Pay attention to the family the printer belongs to. Depending on the family, the right brscan will need to be selected (brscan, brscan2, brscan3 or brscan4) as well as the right architecture (32 bits or 64 bits depending on the system installation).}}

Change to the directory where the downloaded drivers are, and run the following command:

{{RootCmd|ls -a}}

This will show the file names of the downloaded files, allowing for easy copy/paste for the next commands.

Install the drivers using <tt>rpm</tt>:

{{RootCmd|rpm -i --nodeps brscan2-0.2.5-1.x86_64.rpm}}

{{Note|If xsane was not installed yet, install it, then add <code>--replacepkgs</code> as an option to the previous command to reinstall the driver.}}

===Configuring the scanner ===

Once the driver is correctly installed, use the following command:

{{RootCmd|brsaneconfig2 -a name{{=}}monScanner model{{=}}DCP-750CW ip{{=}}192.168.1.13}}

{{Note| ''brsaneconfig2'' should be replaced with the command corresponding to the printer's family (see above), ''monScanner'' with any name of personal choice, and ''DCP-750CW'' with the printer's model name.}}

Now check everything is correctly installed:

{{RootCmd|brsaneconfig2 -q {{!}} grep monScanner|output=<pre>
  0 monScanner          "DCP-750CW"         I:192.168.1.13</pre>}}

{{Note|Replace ''monScanner'' with the name chosen above.}}

Congratulation! The scanner is now ready for use!

== Troubleshooting ==

=== Generic LPR printer driver on amd64 ===

The [http://support.brother.com/g/b/downloadlist.aspx?c=us&lang=en&prod=hll2340dw_us_eu_as&os=127 printer driver] uses statically compiled x86 binaries. To be able to execute them the kernel needs to have the following configuration enabled: IA32_EMULATION

=== Text shifted up ===

Sometimes it happens that the text is shifted up toward the upper border of the page.

To correct this, enter the following command:

{{RootCmd| brprintconf_dcp750cw -pt A4}}

=== Scanner not detected ===

It may happen that, when xsane is launched, the scanner is not detected. This is probably due to a too recent version of libusb. In order to solve this, it might be necessary to install {{Package|dev-libs/libusb-compat}}:

{{Emerge|dev-libs/libusb-compat}}

== External resources ==

* [http://solutions.brother.com/linux/ Brother solutions, Linux page] on Brother.com
* [https://github.com/stefan-langenmaier/brother-overlay/tree/master/ brother-overlay] on Github.com


[[Category:Brother]]
