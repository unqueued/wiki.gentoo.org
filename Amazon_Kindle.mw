[[Category:Hardware]]


A quick document explaining how to use the Amazon Kindle with Gentoo.  This will detail some of the nuances I've encountered, and collecting information to a central WIKI location for users.  Feel free to add material for your device or move the material as needed as I only have a DX Graphite.

== Kindle 1 ==


== Kindle 2 ==


== Kindle DX / DX Graphite ==


=== Mounting the Removable Storage Media ===

==== Mounting using AutoFS ====
Execute blkid (sys-apps/util-linux) with the Kindle device attached.
{{Cmd|# blkid}}

Find the UUID from the blkid output and insert the following line into your /etc/autofs/auto.misc file, substituting UUID with your UUID:
{{File|/etc/autofs/auto.misc||<pre>
kindle    -fstype=vfat,gid=100,noatime,rw,umask=002,user,utf8    UUID="Your_UUID_from_blkid_Output"
</pre>}}

Edit the "/etc/conf.d/autofs" file to your liking.  Make sure you uncomment the MASTER_MAP_NAME="auto.master" line if you use the /etc/autofs/auto.master file!

For me, I use the following addition to auto.master file.  The "--ghost" option auto unmounts after five seconds:

{{File|/etc/autofs/auto.master||<pre>
/mnt/auto   /etc/autofs/auto.misc   --timeout=5 --ghost
</pre>}}

==== Mounting using UDEV ====
corrections.)

The following rule will mount your Kindle using the Volume Name (ie. "Kindle" to (/media/Kindle").  You then will need to execute the user scripts add.sh and remove.sh to tell the Linux UDEV subsystem to add (mount) and remove (unmount) the device.  In turn, the "/media/Kindle" folder is automagically created and destroyed on mount and unmount. 

{{File|/etc/udev/rules.d/11-media-by-label-auto-mount.rules||<pre> 
SUBSYSTEM!="usb", KERNEL!="sd[c-z][0-9]", GOTO="media_by_label_auto_mount_end"

# Import FS infos
IMPORT{program}="/sbin/blkid -o udev -p %N"

# Get a label if present, otherwise specify one
ENV{ID_FS_LABEL}!="", ENV{dir_name}="%E{ID_FS_LABEL}"
ENV{ID_FS_LABEL}=="", ENV{dir_name}="usbhd-%k"

# Global mount options
#ACTION=="add", ENV{mount_options}="relatime"
ACTION=="add", ENV{mount_options}="noatime"
# Filesystem-specific mount options
ACTION=="add", ENV{ID_FS_TYPE}=="vfat|ntfs", ENV{mount_options}="$env{mount_options},utf8,gid=100,umask=002"

# Mount the device
ACTION=="add", RUN+="/bin/mkdir -p /media/%E{dir_name}", RUN+="/bin/mount -o $env{mount_options} /dev/%k /media/%E{dir_name}"

# Clean up after removal
ACTION=="remove", ENV{dir_name}!="", RUN+="/bin/umount -l /media/%E{dir_name}", RUN+="/bin/rmdir /media/%E{dir_name}"

# Exit
LABEL="media_by_label_auto_mount_end"
</pre>}}

{{File|/home/user/bin/udev-add-all.sh||<pre>
#!/bin/bash - 
#===============================================================================
#
#          FILE:  udev-add.sh
# 
#         USAGE:  ./udev-add.sh 
# 
#   DESCRIPTION: udev add removable media device 
# 
#       OPTIONS:  ---
#  REQUIREMENTS:  ---
#          BUGS:  ---
#         NOTES:  ---
#        AUTHOR: Roger Zauner (rdz), rogerx (dot) oss (at) gmail (dot) com
#       COMPANY: N/A
#       CREATED: 04/10/2010 12:18:57 AM AKDT
#      REVISION:  ---
#===============================================================================

set -o nounset                              # Treat unset variables as an error
#set -o xtrace                              # Enable trace debugging

# sd[b-z][0-9]
#udevadm trigger --action="add" --sysname-match="sdb1" --verbose

if [ $HOSTNAME = "localhost1.local" ]; then
    sudo /sbin/udevadm trigger --action="add" \
      --sysname-match="sd[c-z][0-9]" --verbose
#    sudo /sbin/udevadm trigger --action="add" \
#      --sysname-match="sr[0-9]" --verbose
  
  elif [ $HOSTNAME = "localhost2.local" ]; then
    sudo /sbin/udevadm trigger --action="add" \
      --sysname-match="sd[c-z][0-9]" --verbose
#    sudo /sbin/udevadm trigger --action="add" \
#      --sysname-match="sr[0-9]" --verbose
  
  elif [ $HOSTNAME = "localhost3.local" ]; then
    sudo /sbin/udevadm trigger --action="add" \
      --sysname-match="sd[b-z][0-9]" --verbose
#    sudo /sbin/udevadm trigger --action="add" \
#      --sysname-match="sr[0-9]" --verbose
fi
</pre>}}

{{File|/home/user/bin/udev-remove.sh||<pre>
#!/bin/bash - 
#===============================================================================
#
#          FILE:  udev-remove.sh
# 
#         USAGE:  ./udev-remove.sh 
# 
#   DESCRIPTION: udev remove removable media device 
# 
#       OPTIONS:  ---
#  REQUIREMENTS:  ---
#          BUGS:  ---
#         NOTES:  ---
#        AUTHOR: Roger Zauner (rdz), rogerx (dot) oss (at) gmail (dot) com
#       COMPANY: N/A
#       CREATED: 04/10/2010 12:22:17 AM AKDT
#      REVISION:  ---
#===============================================================================

set -o nounset                              # Treat unset variables as an error
#set -o xtrace                              # Enable trace debugging

# sd[b-z][0-9]
#udevadm trigger --action="remove" --sysname-match="sdb1" --verbose

if [ $HOSTNAME = "localhost1.local" ]; then
    sudo /sbin/udevadm trigger --action="remove" \
      --sysname-match="sd[c-z][0-9]" --verbose
#    sudo /sbin/udevadm trigger --action="remove" \
#      --sysname-match="sr[0-9]" --verbose
  
  elif [ $HOSTNAME = "localhost2.local" ]; then
    sudo /sbin/udevadm trigger --action="remove" \
      --sysname-match="sd[c-z][0-9]" --verbose
#    sudo /sbin/udevadm trigger --action="remove" \
#      --sysname-match="sr[0-9]" --verbose

  elif [ $HOSTNAME = "localhost3.local" ]; then
    sudo /sbin/udevadm trigger --action="remove" \
      --sysname-match="sd[b-z][0-9]" --verbose
#    sudo /sbin/udevadm trigger --action="remove" \
#      --sysname-match="sr[0-9]" --verbose
fi
</pre>}}

Personally, I now prefer the AutoFS method is it's cleaner and I don't need to fiddle with running the above user scripts.  The main problem I seem to run in with the Kindle DX is the DX's display stating the device is plugged in.  Even though this is true, you can still unplug the device without using the "eject" command and the device is not mounted!  And, using the "eject" command at times would confuse the device and the Linux sub-system at times.  So, just unplug the device after checking the device is no longer mounted via the "mount" command.  As such, much easier to just use AutoFS, as it can be configured to auto unmount it for you using the "--ghost" option.

== Kindle Touch ==

== Kindle Fire Tablet ==


== File Format Conversions ==
I personally prefer using simple utilities for converting documents and the following will detail this.

== PDF File Format ==

Best format to read technical documents is PDF.
* You can create PDF's easily from printing them from Seamonkey or Firefox using the print to file method.
* Use ps2pdf utilities  (app-text/ghostscript-gpl)

== MOBI File Format ==

The basis of this file format is HTML, but with the feature of DRM when required by publishers.  Keep it simple, avoiding TABLE tag usage.  (See Amazon's AmazonKindlePublishingGuidelines.pdf.)

* Use VIM to convert a ASCII/UTF8 text file to HTML.  Execute VIM's ":ToHtml" command and save, then use Amazon's kindlegen binary on the saved file. (KindleGen is Amazon's version of MobiGen.)

== Notes ==
* (2011.11.14).

* I always find it best, when possible, to copy both the MOBI and PDF file formats to the device as both currently have separate pros and cons. (ie. O'Reilly publishes books into a multitude of formats.)

* Because there are so many files freely available, I find it best to create subfolders within the /mnt/kindle/documents folder even though the Kindle DX Graphite firmware doesn't display the folders, but will see the files within the folders.  I then use the Kindle firmware to create a "Collection with a similar name of the folders. (ie. Filesystem folder name "/mnt/kindle/documents/programming-c", Collection Name "Programming - C").  (I dislike the slow Java interface for the reading device, should have been designed in C/C++.)

== Free Books ==
* leaving the user less time for reading!)

* Gentoo Wiki Articles can be printed to either PDF or HTML using the "Printable version" link, located to the bottom left within the "toolbox" of the viewable version of pages.  (How about a link to download all Gentoo Wiki articles tar.gz|bz2 file?  This would make a great secondary backup option for Gentoo Wiki!)

* Many C Programming books, specifications and manuals are already freely available in PDF format. (ie. [http://www.iso-9899.info/wiki/Main_Page C on Freenode] lists many freely available recommended books)

* Many [http://www.gnu.org/manual/ FSF GNU Manuals] are also already available in HTML and PDF formats.

* Manual Pages (AKA manpages) can be easily converted to HTML, then MOBI using KindleGen.  (See References Below)

* [http://tldp.org/ TLDP] hosts many HowTo's and documents in PDF and HTML formats.

* [http://www.python.org/doc/ Python] hosts it's documentation in PDF, HTML and EPUB formats.

* Would be great to have to download only one file containing all the above, so a user would only need to download and untar one file to their reading device for their reading pleasure and/or studying.  In practice, it takes several days to weeks to download and move the above material to the reading device.

== Mobile Linux Websites ==
* [http://lxer.com/module/newswire/mobile.php Lxer News (Mobile Version)]

== References ==
* [[Autofs]]
* [http://en.wikipedia.org/wiki/Amazon_Kindle Amazon Kindle Wikipedia]  Details features and supported file formats.
* [http://www.amazon.com/gp/feature.html?ie=UTF8&docId=1000234621 Amazon Publishing Programs]  KindleGen Program and AmazonKindlePublishingGuidelines.pdf
* [http://rogerx.freeshell.org/programming/kindledxg_and_linux.html Amazon Kindle DXG and Linux]
* [http://rogerx.freeshell.org/programming/kindle-convert_txttomobi.html Amazon Kindle - Converting .txt to .html to .mobi]
* [http://rogerx.freeshell.org/programming/kindle-convert_linuxmantomobi.html Amazon Kindle - Convert Linux Manual Pages to .mobi]
* [http://rogerx.freeshell.org/programming/kindle-strip.html Amazon Kindle - Strip]
