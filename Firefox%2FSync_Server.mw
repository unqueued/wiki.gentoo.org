{{Dated|date=July 14, 2015}}

This article explains how to run a private [[Firefox]] Sync server instance.

== Installation ==

Unless using a very particular setup with registration and storage servers in different locations install the {{Package|www-misc/mozilla-sync-server-full}} package which is available through the klondike overlay.

=== USE flags ===

The meaning of these is common to all the www-misc/mozilla-sync-server-* packages:

{{USEflag|package=www-misc/mozilla-sync-server-full|desc=Optional USE flags for {{Package|www-misc/mozilla-sync-server-full}}:
|ldap+yes+yes+Allow user authentication against an LDAP server.
|memcached+yes+yes+Use memcached to cache objects and reduce load.
|mysql+yes+yes+Use mysql as storage (and if desired authentication) engine.
|sqlite+yes+yes+Use sqlite as storage (and if desired authentication) engine.
}}

The main difference amongst these is mainly the configuration files that will be installed and that dependency checks will be made to ensure the application can run on the system.

=== Emerging ===

After setting up the desired flags remove the keywords from the packages and run:

{{Emerge|www-misc/mozilla-sync-server-full}}

== Configuration ==

The package is now installed and the default configuration is in {{Path|/etc/mozilla-sync-server/}}. The configuration of the daemon can be set using the {{Path|.ini}} files whilst the configuration of sync itself is done in the {{Path|.conf}} files. All of them are {{Path|.ini}}-style files.

The first step is replacing the following line by the {{Path|.conf}} file to use on the {{Path|.ini}} file:

{{FileBox|title=Log configuration|1=
:configuration = file:%(here)s/sync.conf
}}

Then ensure logs are saved in the proper place:

{{FileBox|title=Log location|1=
class = handlers.RotatingFileHandler
args = ('/tmp/sync-error.log',)
}}

Then you may need to edit the {{Path|server.wsgi}} file so they load the proper {{Path|.ini}} files for that replace the following line by the correct file:

{{FileBox|title=ini_file|1=
:ini_file = os.path.join(_CURDIR, 'development.ini')
}}

Finally edit the {{Path|.conf}} file with the desired settings. The most important ones are the sqluri which define the path to the SQL databases and the fallback_node which defines the URL to the server as seen by the client you may also want to disable the captcha.

For a list of parameters check: http://docs.services.mozilla.com/server-devguide/configuration.html

=== Testing the server ===

Once configured test the server by following this line in {{Path|/etc/mozilla-sync-server/}}:

{{RootCmd|bin/paster serve development.ini}}

This will start the server listening on the port 5000. You will need to have paster installed. In general using this approach to run the server is a bad idea so you can run it behind a web server instead

=== Running behind a web server ===

==== Apache ====

Emerge {{Package|www-apache/mod_wsgi}}:

{{Emerge|www-apache/mod_wsgi}}

Create the <tt>mozsync</tt> user on the <tt>mozsync</tt> group if has not been created.

Merge the following with the vhost configuration (the first line may require modification):

{{FileBox|title=Vhost configuration|1=
WSGIDaemonProcess sync user=mozsync group=mozsync processes=2 threads=25 python-path=/usr/lib64/python2.7/site-packages/syncreg/

<Directory "/etc/mozilla-sync-server">
    Options None
    AllowOverride All
    Order allow,deny
    Allow from all
</Directory>

WSGIProcessGroup sync
WSGIPassAuthorization On
WSGIScriptAlias / /etc/mozilla-sync-server/server.wsgi
}}

== External resources ==

* http://docs.services.mozilla.com/howtos/run-sync.html
* http://docs.services.mozilla.com/server-devguide/configuration.html
