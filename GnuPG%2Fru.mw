<languages />


{{Metadata|abstract=Это небольшое руководство научит Вас основам использования GnuPG, инструмента для защищенной передачи сообщений.}}

Это небольшое руководство научит Вас основам использования GnuPG, инструмента для защищенной передачи сообщений.

== Введение ==

=== О чем будет рассказано в этом руководстве ===

Это руководство предполагает, что вы знакомы с криптографией с открытым ключом, шифрованием и цифровыми подписями. Если это не так, перейдите к [[#doc_chap7]] или просмотрите [http://www.gnupg.org/documentation/guides.html Настольную Книгу GnuPG], глава 2, и затем возвращайтесь обратно. 

Это руководство научит Вас как установить GnuPG, создать свою ключевую пару, добавить ключи в связку, отправить свой открытый ключ на сервер ключей, а также как подписывать, шифровать, проверять или расшифровывать сообщения, отправленные или полученные Вами. Вы также научитесь шифровать файлы на своем локальном компьютере, чтобы предотвратить чтение их содержимого посторонними людьми. 

=== Установка требуемых программ ===

На самом простом уровне, Вам потребуется запустить <code>emerge gnupg</code> . На сегодняшний день, множество приложений имеют тот или иной вид поддержки gpg, поэтому добавка ''crypt'' в список Ваших переменных USE, возможно, является хорошей идеей. Если Вы хотите иметь email client с возможностью использования gnupg, Вы можете использовать pine (<code>emerge pinepgp</code), mutt (<code>emerge mutt</code>), Mozilla Thunderbird (<code>emerge thunderbird</code>), evolution (evolution - это близнец GNOME Microsoft Outlook со схожими принципами работы) и принадлежащий KDE Kmail. 

<code>Kgpg</code> может Вас заинтересовать если Вы используете KDE. Эта небольшая программа позволяет Вам генерировать ключевые файлы, импортировать ключи из ASCII-файлов, подписывать импортированные ключи, экспортировать ключи, а также имеет еще несколько функций. 

== Генерация ключа и добавление в связку открытых ключей ==

=== Создание ключа ===

Чтобы создать Ваш ключ, просто запустите <code>gpg --gen-key</code> . При первом запуске, он создаст несколько каталогов; запустите его снова чтобы создать ключи: 

{{Cmd|gpg --gen-key|output=<pre>
gpg (GnuPG) 1.0.7; Copyright (C) 2002 Free Software Foundation, Inc.
This program comes with ABSOLUTELY NO WARRANTY.
This is free software, and you are welcome to redistribute it
under certain conditions. See the file COPYING for details.
  
Please select what kind of key you want:
   (1) RSA and RSA (default)
   (2) DSA and Elgamal
   (3) DSA (sign only)
   (4) RSA (sign only)
   Your selection? 1
</pre>
}}

Здесь Вы можете выбрать тип ключа, который Вы хотите использовать. Большинство пользователей предпочтут алгоритмы по умолчанию: RSA и RSA. Далее идет размер ключа. Запомните, что чем больше, тем лучше, но не используйте размер больший чем 2048 с ключами DSA/ElGamal. В основном, 2048 более чем достаточно для обычной почты. 

После размера следует дата истечения срока действия ключа. В этом случае, чем меньше, тем лучше, но большинство пользователей может предпочесть ключ, который не истекает, или обладает сроком действия в 2 или 3 года. 

{{Code|Choosing key size|<pre>
RSA keypair will have 1024 bits.
RSA keys may be between 1024 and 4096 bits long.
    What keysize do you want? (2048) 2048
Requested keysize is 2048 bits       
Please specify how long the key should be valid.
         0 = key does not expire
 <n>= key expires in n days
 <n>w = key expires in n weeks
 <n>m = key expires in n months
 <n>y = key expires in n years
 Key is valid for? (0) 0
Key does not expire at all
</pre>
}}

А теперь пришло время ввести личную информацию. Если Вы собираетесь отправить открытый ключ другим людям, Вам нужно использовать Ваш действительный email адрес: 

{{Code|Entering user information|<pre>
Is this correct (y/n)? y
                          
GnuPG needs to construct a user ID to identify your key.
  
Real name: John Doe
Email address: john@nowhere.someplace.flick
Comment: The Real John Doe
You selected this USER-ID:
"John Doe (The Real John Doe) <john@nowhere.someplace.flick>"
  
Change (N)ame, (C)omment, (E)mail or (O)kay/(Q)uit? O 
You need a Passphrase to protect your secret key.    
  
Enter passphrase: 
</pre>
}}

Теперь, введите Вашу парольную фразу дважды. Хорошей идеей является использование сильного пароля. Если кто-либо когда-нибудь овладеет Вашим закрытым ключом и взломает Ваш пароль, они будут способны отправлять сообщения подписанные ''Вами'', заставляя всех поверить, что письма были отправлены Вами на самом деле. 

Далее, GnuPG сгенерирует Ваш ключ. Двигание мышкой или проигрывание mp3 на заднем плане поможет ускорить процесс, потому что это генерирует случайные данные. 

=== Генерация сертификата отзыва ===

{{Important/ru|Эта часть очень важна и Вы должны сделать это ''СЕЙЧАС''.}}

После создания Ваших ключей Вы должны создать сертификат отзыва. Выполнение этого позволит Вам отозвать Ваш ключ в случае если с Вашим ключом произойдет что-то неприятное (кто-либо завладеет Вашим ключом/парольной фразой). 

{{Cmd|gpg --list-keys|output=<pre>
/home/humpback/.gnupg/pubring.gpg
---------------------------------
pub  1024D/75447B14 2002-12-08 John Doe (The Real John Doe) <john@nowhere.someplace.flick>
sub  2048g/96D6CDAD 2002-12-08
</pre>}}

{{Cmd|gpg --output revoke.asc --gen-revoke 75447B14|output=<pre>
sec  1024D/75447B14 2002-12-08   John Doe (The Real John Doe) <john@nowhere.someplace.flick>
  
Create a revocation certificate for this key? y
Please select the reason for the revocation:   
  0 = No reason specified
  1 = Key has been compromised
  2 = Key is superseded
  3 = Key is no longer used
  Q = Cancel
(Probably you want to select 1 here)
Your decision? 1
Enter an optional description; end it with an empty line:
> Someone cracked me and got my key and passphrase
>
Reason for revocation: Key has been compromised
Someone cracked me and got my key and passphrase
Is this okay? y
  
You need a passphrase to unlock the secret key for
user: "John Doe (The Real John Doe) <john@nowhere.someplace.flick>"
1024-bit DSA key, ID 75447B14, created 2002-12-08
  
ASCII armored output forced.
Revocation certificate created.
  
Please move it to a medium which you can hide away; if Mallory gets
access to this certificate he can use it to make your key unusable.
It is smart to print this certificate and store it away, just in case
your media become unreadable.  But have some caution:  The print system of
your machine might store the data and make it available to others!
</pre>
}}

Команда <code>gpg --list-keys</code> перечисляет ключи в Вашей открытой связке. Вы можете ее использовать для просмотра ID Вашего ключа, чтобы Вы могли создать сертификат отзыва. А сейчас, хорошей идеей является скопировать весь каталог .gnupg и сертификат отзыва (в ASCII - {{Path|revoke.asc}}) на какой-нибудь защищенный носитель (два гибких диска или CD-R, хранимые в безопасном месте). Запомните, что {{Path|revoke.asc}} может быть использован для того, чтобы отозвать Ваши ключи и сделать их непригодными в дальнейшем. 

{{Note/ru|Если вы имеете несколько email адресов, которые Вы хотели бы использовать с этим ключом, Вы можете запустить <code>gpg --edit-key ВАШ_ID</code> и затем использовать команду <code>adduid</code> . Она запросит имя, email и комментарий второго ID, которым Вы будете пользоваться.}}

=== Экспорт ключей ===

Для экспортирования ключа, введите <code>gpg --armor --output john.asc --export john@nowhere.someplace.flick</code> . Вы можете почти всегда использовать ID ключа или что-нибудь, что идентифицирует ключ (здесь мы использовали email адрес). Теперь John имеет файл {{Path|john.asc}}, который он может отправить своим друзьям, или разместить на своей веб-странице, чтобы люди могли с ним безопасно обмениваться информацией. 

=== Импорт ключей ===

Чтобы добавить файлы в свою открытую связку, Вы должны сперва их импортировать, а затем проверить отпечаток ключа. После того как Вы проверили отпечаток, Вы должны его подтвердить. 

{{Note/ru|Вы должны быть осторожны при проверке ключей. Это одно из слабых мест криптографии с открытым ключом.}}

Теперь, мы будем добавлять открытый ключ Луиса Пинто (моего друга) в нашу открытую связку. После звонка по телефону и запрашивания отпечатка его ключа, я сравню отпечаток с результатом команды <code>fpr</code> . В случае если ключ подлинный, я добавлю его в открытую связку. В этом частном случае, ключ Луиса истечет на 2013-12-01, поэтому у меня будет запрошено желаю ли я, чтобы моя подпись этого ключа истекла в то же время. 

{{Cmd|gpg --import luis.asc|output=<pre>
gpg: key 462405BB: public key imported
gpg: Total number processed: 1
gpg:               imported: 1
</pre>}}

{{Cmd|gpg --list-keys|output=<pre>
/home/humpback/.gnupg/pubring.gpg
---------------------------------
pub  1024D/75447B14 2002-12-08 John Doe (The Real John Doe) <john@nowhere.someplace.flick>
sub  2048g/96D6CDAD 2002-12-08
  
pub  1024D/462405BB 2002-12-01 Luis Pinto <lmpinto@student.dei.uc.pt>
uid                            Luis Pinto <lmpinto@dei.uc.pt>
sub  4096g/922175B3 2002-12-01 [expires: 2003-12-01]
</pre>}}

{{Cmd|gpg --edit-key lmpinto@dei.uc.pt|output=<pre>
gpg (GnuPG) 1.0.7; Copyright (C) 2002 Free Software Foundation, Inc.
This program comes with ABSOLUTELY NO WARRANTY.
This is free software, and you are welcome to redistribute it
under certain conditions. See the file COPYING for details.
  
gpg: checking the trustdb
gpg: checking at depth 0 signed=0 ot(-/q/n/m/f/u)=0/0/0/0/0/1
pub  1024D/462405BB  created: 2002-12-01 expires: 2003-12-01 trust: -/-
sub  4096g/922175B3  created: 2002-12-01 expires: 2003-12-01
(1)  Luis Pinto <lmpinto@dei.uc.pt>
(2). Luis Pinto <lmpinto@student.dei.uc.pt>
</pre>}}

{{Cmd|fpr|prompt=Command> |output=<pre>
pub  1024D/462405BB 2002-12-01 Luis Pinto <lmpinto@dei.uc.pt>
             Fingerprint: F056 3697 ADE3 CF98 B80B  8494 0AD3 E57B 4624 05BB
</pre>}}

{{Cmd|sign|prompt=Command> |output=<pre>
Really sign all user IDs? y
                           
pub  1024D/462405BB  created: 2002-12-01 expires: 2003-12-01 trust: -/-
             Fingerprint: F056 3697 ADE3 CF98 B80B  8494 0AD3 E57B 4624 05BB
  
     Luis Pinto <lmpinto@dei.uc.pt>
     Luis Pinto <lmpinto@student.dei.uc.pt>
  
This key is due to expire on 2003-12-01.
Do you want your signature to expire at the same time? (Y/n) Y
How carefully have you verified the key you are about to sign actually belongs
to the person named above?  If you don't know what to answer, enter "0".
  
   (0) I will not answer. (default)
   (1) I have not checked at all.
   (2) I have done casual checking.
   (3) I have done very careful checking.
  
   Your selection? 3
Are you really sure that you want to sign this key
with your key: "John Doe (The Real John Doe) <john@nowhere.someplace.flick>"
  
I have checked this key very carefully.
  
Really sign? y
              
You need a passphrase to unlock the secret key for
user: "John Doe (The Real John Doe) <john@nowhere.someplace.flick>"
1024-bit DSA key, ID 75447B14, created 2002-12-08
</pre>}}

{{Cmd|check|prompt=Command> |output=<pre>
uid  Luis Pinto <lmpinto@dei.uc.pt>
sig!3       462405BB 2002-12-01   [self-signature]
sig!3       75447B14 2002-12-08   John Doe (The Real John Doe) <john@nowhe
uid  Luis Pinto <lmpinto@student.dei.uc.pt>
sig!3       462405BB 2002-12-01   [self-signature]
sig!3       75447B14 2002-12-08   John Doe (The Real John Doe) <john@nowhe
</pre>
}}

== Обмен ключами с серверами ключей ==

=== Отправка ключей на сервер ===

Теперь, когда у нас есть ключ, возможно, хорошей идеей будет отправить его на сервер ключей. В мире существует много серверов ключей и большинство из них обмениваются ключами друг с другом. Здесь, мы собираемся отправить ключ  на сервер subkeys.pgp.net. Он использует HTTP, поэтому если Вам потребуется использование прокси для HTTP трафика, не забудьте его установить (<code>export http_proxy=http://proxy_host:port/</code>). Команда для отправки ключа: <code>gpg --keyserver subkeys.pgp.net --keyserver-options honor-http-proxy --send-key 75447B14</code>, где <code>75447B14</code> - это идентификатор ключа (key ID). Если Вам не нужен HTTP прокси, Вы можете убрать ''--keyserver-options honor-http-proxy''. 

Вы также можете отправить ключи других людей, которые Вы подписали, на сервер ключей. Мы можем отправить ключ Луиса Пинто на сервер. Таким образом, кто-нибудь кто доверяет Вашему ключу может использовать подпись, которую Вы там разместили, для того чтобы доверять ключу Луиса. 

=== Получение ключей с сервера ===

Теперь мы собираемся найти ключ Gustavo Felisberto и добавить его в связку ключей John Doe (В том случае, если Вы не заметили, Gustavo Felisberto - автор этого руководства :&#41;). 

{{Cmd|gpg --keyserver subkeys.pgp.net --keyserver-options honor-http-proxy --search-keys humpback@felisberto.net|output=<pre>
gpg: searching for "humpback@felisberto.net" from HKP server subkeys.pgp.net
Keys 1-5 of 5 for "humpback@felisberto.net"
(1)Gustavo Felisberto (apt-get install anarchy) <humpback@felisberto.net> 1024
  created 2002-12-06, key B9F2D52A
(2)Gustavo Felisberto <humpback@altavista.net> 1024
  created 1999-08-03, key E97E0B46
(3)Gustavo A.S.R. Felisberto <humpback@altavista.net> 1024
  created 1998-12-10, key B59AB043
(4)Gustavo Adolfo Silva Ribeiro Felisberto <humpback@altavista.net> 1024
  created 1998-08-26, key 39EB133D
(5)Gustavo Adolfo Silva Ribeiro Felisberto <humpback@altavista.net> 1024
  created 1998-06-14, key AE02AF87
  Enter number(s), N&#41;ext, or Q&#41;uit >1
gpg: requesting key B9F2D52A from HKP keyserver subkeys.pgp.net
gpg: key B9F2D52A: public key imported
gpg: Total number processed: 1
gpg:               imported: 1
</pre>
}}

Как видно из ответа сервера, я отослал несколько ключей на сервер, но я использую только ''B9F2D52A'' в данный момент. Теперь John Doe может его получить и подписать, если он ему доверяет. 

== Использование GPG Agent ==

=== Что такое GPG Agent? ===

Иногда, работа с определенными приложениями требует от Вас очень частого использования ключа GPG. Это означает что Вам придется вводить парольную фразу много раз. Несколько приложений поддерживали механизм кэширования парольной фразы чтобы облегчить жизнь пользователям. Однако, это не позволяло делить этот кэш между программами (насколько это было бы безопасно?) и вынуждало приложения изобретать колесо снова и снова. 

GPG агент - это отдельное приложение, используемое GPG для кэширования парольной фразы стандартным и безопасным способом. Оно позволяет приложениям использовать GPG параллельно: если Вы вводите парольную фразу работая в одном приложении, другое приложение может работать с GPG без повтора запроса парольной фразы для разблокирования ключа - если, конечно же, GPG агент настроен на то чтобы это разрешить. 

Gentoo предоставляет несколько приложений GPG агент. Пакет <code>app-crypt/gnupg</code> содержит то, что можно рассматривать как эталон, и будет тем, что мы будем использовать в этом документе. 

=== Конфигурация gpg-agent и pinentry ===

GnuPG включает <code>gpg-agent</code> и <code>pinentry</code> . <code>pinentry</code> - это вспомогательное приложение, которое gpg-agent использует для запроса парольной фразы в графическом окне. Оно бывает трех видов: отображение окна с использованием gtk+, Qt, или библиотеки curses (в зависимости от Ваших USE-флагов в {{Path|/etc/portage/make.conf}}). 

Если Вы установили <code>pinentry</code> с более чем одним типом  всплывающего окна, Вы можете выбрать среди них командой <code>eselect-pinentry</code> : 

{{RootCmd|eselect pinentry list|output=<pre>
Available pinentry implementations:
  [1]   pinentry-gtk-2 *
  [2]   pinentry-curses
  [3]   pinentry-qt4
</pre>}}

{{RootCmd|eselect pinentry set 1}}

Теперь, создайте файл с названием {{Path|~/.gnupg/gpg-agent.conf}} и введите следующие строчки, которые определят срок действия парольной фразы по умолчанию (напр., 30 минут), а также приложение, которое надо вызвать когда парольная фраза должна быть получена в первый раз (напр., gtk+ версия pinentry). 

{{File|~/.gnupg/gpg-agent.conf||<pre>
pinentry-program /usr/bin/pinentry-gtk-2
no-grab
default-cache-ttl 1800
</pre>
}}

Затем, настройте GnuPG на использование агента, когда это уместно. Отредактируйте {{Path|~/.gnupg/gpg.conf}} и добавьте следующую строчку: 

{{File|~/.gnupg/gpg.conf|Настройка GnuPG на использование GPG Agent|<pre>
use-agent
</pre>
}}

Теперь Ваша система (почти) настроена на использование GPG agent. 

=== Автоматический запуск GPG Agent ===

Если Вы используете KDE в качестве графической среды, отредактируйте {{Path|//etc/kde/startup/agent-startup.sh}} и раскомментируйте следующее (глобально) или {{Path|~/.kde4/env/gpg-agent.sh}} (для локального пользователя) и добавьте в него следующую команду, чтобы KDE автоматически запускал GPG agent: 

{{File|/etc/kde/startup/agent-startup.ksh|Автоматический запуск GPG agent в KDE|<pre>
eval "$(gpg-agent --daemon)"
</pre>
}}

Дополнительно, раскомментируйте следующее в {{Path|/etc/kde/shutdown/agent-shutdown.sh}} (глобально) или добавьте в {{Path|~/.kde4/shutdown/gpg-agent.sh}} (для локального пользователя): 

{{File|/etc/kde/shutdown/agent-shutdown.sh|Закрытие GPG agent с помощью KDE|<pre>
if [ -n "${GPG_AGENT_INFO}" ]; then
  kill $(echo ${GPG_AGENT_INFO} | cut -d':' -f 2) >/dev/null 2>&1
fi
</pre>
}}

Если Вы используете другую графическую среду, поместите эту строку (ту же, что и упомянутую выше) в {{Path|~/.xinitrc}} (если Вы используете <code>startx</code>) или {{Path|~/.xsession}} (если Вы используете XDM/GDM/KDM/...). 

== Работа с документами ==

=== Шифрование и подпись ===

Давайте предположим, что Вы имеете файл, который хотели бы отправить Луису. Вы можете его зашифровать, подписать, или зашифровать и подписать одновременно. Шифрование означает что только Луис сможет его открыть. Подпись говорит Луису о том что это действительно Вы, тот кто создал этот файл. 

Следующие три команды сделают только это: зашифруют, подпишут и зашифруют/подпишут. 

{{Cmd|gpg --output doc.gpg --encrypt --recipient lmpinto@dei.uc.pt doc_to_encrypt
|gpg --output doc.gpg --sign --recipient lmpinto@dei.uc.pt doc_to_sign
|gpg --output doc.gpg --encrypt --sign --recipient lmpinto@dei.uc.pt doc_to_encrypt_and_sign}}

Это создаст двоичные файлы. Если Вы хотите создать ASCII-файлы, просто добавьте <code>--clearsign</code> в начало команды. 

=== Расшифровка и проверка подписей ===

Предположим, Вы получили файл, который зашифрован Вашим ключом. Командой для расшифровки является <code>gpg --output document --decrypt encrypted_doc.gpg</code> . Это расшифрует документ и проверит подпись (если таковая имеется). 

=== Шифрование и расшифровка без ключей ===

Также возможно шифрование файлов с использованием паролей вместо ключей. Пароль, сам по себе, будет функционировать как ключ - он будет использован в качестве ''симметричного шифра''. Вы можете зашифровать файл, используя аргумент <code>--symmetric</code> команды <code>gpg</code>; расшифровка использует ту же команду, которую мы обсуждали ранее. 

{{Cmd|gpg --output document.gpg --symmetric document}}

GnuPG запросит парольную фразу и ее подтверждение.


=== Расширенные функции ===

В GnuPG есть несколько приятных расширенных функций. Чтобы их найти, откройте файл {{Path|~/.gnupg/gpg.conf}} . 

{{File|~/.gnupg/gpg.conf||<pre>
#keyserver x-hkp://subkeys.pgp.net
#keyserver-options auto-key-retrieve include-disabled include-revoked
</pre>
}}

Найдите две линии выше и раскомментируйте их. С ними, всякий раз когда GnuPG потребуется проверить подпись и он не найдет открытый ключ в локальной связке, GnuPG соединится с сервером ключей по адресу [http://subkeys.pgp.net:11371/subkeys.pgp.net] и попытается получить их оттуда. 

Другой удобной командой является <code>gpg --refresh-keys</code> . Она соединиться с сервером, определенном в файле параметров, и обновит открытые ключи в Вашей локальной связке ключей оттуда, находя отозванные ключи, новые ID, и новые подписи ключей. Вы, возможно, должны запускать ее один или два раза в месяц, на тот случай, что если кто-то отзовет свой ключ, Вы были об этом уведомлены. 

== Интерфейсы GnuPG ==

=== О подписях электронной почты ===

95% времени, Вы будете использовать GnuPG в электронной почте, подписывая/шифруя Ваши исходящие сообщения и читая подписанные/зашифрованные сообщения, отправленные Вам. Поэтому будет честно, если я расскажу об этом сначала. 

Есть два способа подписать/зашифровать почту с GnuPG, старый способ и новый способ &#41;. В старом способе, сообщения появляются в виде текста, без возможного форматирования, а любые вложенные файлы были бы не подписаны/не зашифрованы. Здесь приведен пример сообщения, подписанного старым способом: 

{{Code|A plain text signature|<pre>
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
  
Test message
  
-----BEGIN PGP SIGNATURE-----
Version: PGPfreeware 6.5.8 for non-commercial use
  
iQA/AwUBP8461jMX0745gR7AEQIEOwCg011GbufXO3ED3FkLWXmfzg7xm1cAoJD0
0EU3Kd2EKNCqataEqM5qjpPs
=LchZ
-----END PGP SIGNATURE-----
</pre>
}}

Сообщения этого рода не имеют смысла в сегодняшнем мире, где мы имеем удобные графические интерфейсы пользователя и программы чтения электронной почты, которые понимают html. 

Для того, чтобы это решить к протоколу MIME (Multipurpose Internet Mail Extensions) было создано дополнение. Оно добавило поле в email сообщение, которое говорит программе чтения почты, что все содержимое этого сообщения подписано и/или зашифровано. Проблема заключается в том, что не все программы чтения почты это поддерживают. И некоторые даже портят содержимое; Microsoft Outlook знаменит своими отказами с этим работать. 

=== Kgpg ===

Kgpg - отличный графический интерфейс пользователя для GnuPG. На главном экране вы можете вставить текст, который Вы хотите подписать или зашифровать, и Вы также можете вставить защищенный текст ASCII, который Вы хотите расшифровать. 

На главном экране Вы можете расшифровать текст (Вам потребуется ввести пароль), зашифровать другие файлы, вставить новый текст для подписи.... 

=== Seahorse ===

Seahorse aims to be a GnuPG GUI interface for the Gnome desktop. The software has been evolving fast, but it still lacks many important features that can be found in Kgpg or the command line version. 

=== KMail ===

If you have the <code>crypt</code> USE flag set, KMail will be compiled with gpg support, and will be able to encrypt and decrypt inline PGP mails automatically as well as encrypting OpenPGP/MIME mails. If you want to decrypt OpenPGP/MIME mails as well (which you probably want) you need to have a running GPG agent. 

You can verify if KMail is properly configured by going to <code>Settings</code>, <code>Configure KMail</code>, <code>Security</code>, <code>Crypto Backends</code>. You should see a GpgME-based backend listed and you should be able to fill the OpenPGP checkbox. If it is listed but grayed out, click on <code>Rescan</code> . If the GpgME-based backend remains grayed out, KMail is not working properly. 

If you still are unable to get KMail to behave, please see the [http://kmail.kde.org/kmail-pgpmime-howto.html KMail PGP HowTo] page for more information. 

=== Claws-Mail ===

This mail reader is ''very'' fast with big mailboxes, has all the nice features one wants in mail readers and works pretty well with gpg. The only problem is that it does not work with the old PGP signatures, so when you receive those kind of mails you have to hand check the signatures. 

To use your gpg key with Claws-Mail just go to the account configuration and select the privacy tab. Once there just choose which key to use, probably most users will go with the default key. 

== Public Key Cryptography ==

=== Basic Public Key Cryptography ===

The concept of public key cryptography was originally devised by Whitfield Diffie and Martin Hellman in 1976. When I first heard the words "public key" and "cryptography" in the same sentence back in '93 I thought to myself that it would be impossible to do such a thing. In those days there was no Internet (well there was, but not for me) so I went to the public library and asked for books on Cryptography. I must say that I was 16 at the time so the clerk there looked to me in astonishment and brought me a book for children on substitution cyphers (those where you change a letter for another like the famous Caesar Cypher or ROT-13 (Tragbb Ebpxf, naq lbh xabj vg vf tbbq orpnhfr lbh ner ernqvat guvf qbp.), ( <code>emerge rotix</code> if you cannot read the preceding text)). I was very upset with this and started to search for more info. It is good to have mathematicians in the family, because as soon as I talked to one of them I was introduced to a new world. 

And now a bit of mathematics: 

{{Code|Mathematical Concepts|<pre>
Definitions:
  
1- A prime number is a positive integer number greater than one that is only
divisible by 1 and itself (the remainder of the division is 0).
The first 8 prime numbers are 2,3,5,7,11,13,17,19
  
Theorem (No proof here)
1- For any non prime positive integer it is possible to break it as the product
of prime numbers, and that product is unique.
4=2*2
6=2*3
8=2*4=2*2*2
10=2*5
12=2*6=2*2*3
  
"Facts":
1- It is mathematically easy to multiply two large integers
2- It is hard to find the prime factors of a given positive integer.
</pre>
}}

If I give you the number 35 and I tell you that this number is the product of two prime numbers it is easy to find that it was 5 and 7. But if I tell you the same for 1588522601 you will spend alot of time (or CPU cycles) to find it was 49811*31891. And if this number is really really big this task becomes "impossible". So now if I give the world my large number that is the product of two primes I know something about that number that no one else knows. 

This is the basis for Public Key Cryptography (PKC) implementations today. As an (unrealistic) example, I give anyone my number and that someone will use if for cyphering a message to me. Anyone can see the cyphered message, because I am the only one who knows a shortcut to read it, anyone else will first have to "split" that big number to be able to read the message, and it is a "fact" that it is impossible to do that in a short amount of time (todays methods and the fastest computers in the world would take thousands of years to do that). In this setup the two large prime numbers would be called the PRIVATE KEY, and the large non prime number is the PUBLIC KEY. 

In practice this is not 100% accurate with reality, but will give a good idea to the newcomer. For more information, check Wikipedia on the [http://en.wikipedia.org/wiki/Diffie-Hellman Diffie-Hellman] protocol. For even more info go to the public library and grab a copy of the [http://www.cacr.math.uwaterloo.ca/hac/ "Handbook of Applied Cryptography"] by Alfred J. Menezes, Paul C. van Oorschot and Scott A. Vanstone. This book is also available online for free at the above site. 

One consequence of the above is that if you cypher a message to me, and you loose the original uncyphered message you will no longer be able to retrieve it from the cyphered version. 

=== Signatures ===

We already saw how someone can send us a cyphered message if they have our public key. But how do we know that the author of the message is really who he claims to be? Or in other words: If I receive an email from you how do I really know it was you and not someone else claiming to be you? 

Remember me saying that PKC was not as simple as I had said? The idea is that when you cypher a message to me you sign it with your private key so that, when I receive it, I can first use your public key to check your signature and then use my private key to decypher the message. As you can see we could not do that in the setup I described before. 

It's also very important to sign messages so that you don't have to cypher them beforehand. Now you can create messages that can be read by anyone, but that come with your "branding". And if any single character is changed in the message it can (and will) be detected. 

=== Key Servers and Signed Keys ===

But let's say that I have no previous contact with you until you send me a message: how do I get your public key, and how do I really know it is yours? 

To solve this problem public Key Servers were created. When you create your key pair (Public and Private key), you send your public key to the key server. After this everyone can retrieve your key from there. This solves the problem of finding the key. But how do I really know that that key is the author's key? For this another concept must be introduced, and that is key signing: 

Key signing means that if I have the public key of another person, and I know ''for sure'' that it is really that persons key (it is my personal friend, someone I know in real life, etc.) I can sign that public key and send it to keyservers, that way I am telling the world: "This key really belongs to the person it claims to belong.". That way persons that have my public key and trust me can use that trust to trust other keys. 

This can sometimes be confusing so let's see a real world situation. 

Let's imagine a 3 person situation: John, Mary, and Lisa. John is a good friend of Mary but does not know Lisa; Lisa is a good friend of Mary but does not know John. One day Lisa sends John a signed email. John will fetch Lisa's Public Key from the keyserver and test the message, if all went ok he will see that whoever wrote that message also created that key. But how do I know it was really the person it claims to be? 

He then sees that it is signed by Mary, which he can check because he already has Mary's key and he trusts that key. With this ring of trust he continues to conclude that the email he received was really written by Lisa. 

You are now ready to use this guide, you can go back to chapter 1 and learn how to use gpg. 

== Final thoughts and Credits ==

=== Some problems ===

I had some problems with photos in keys. Check the version you are using. If you have GnuPG 1.2.1-r1 and up you are probably OK, older versions may have problems. Also most keyservers don't like keys with photos, so you are better if you don't add photos. 

The latest versions of gnupg don't seem to work with the <code>gpg --send-keys</code> that was used so send all keys in your keyring to the public server. 

=== What is not here ===

<code>gpg</code> is a very complex tool, it lets you do much more than what I have covered here. This document is for the user who is new to GnuPG. For more information, you should check the[http://www.gnupg.org GnuPG Website] . 

I did not write about other tools like <code>pgp4pine</code> , <code>gpgpine</code> , <code>evolution</code> and maybe Windows tools, but I will probably extend this document in the future. 

=== Credits ===

John Michael Ashley's [http://www.gnupg.org GnuPG Handbook] it is a very good book for beginners. 

Swift (Sven Vermeulen) for pushing me to re-write this. 

Everyone in the #gentoo-doc team you guys rock. 

Tiago Serra for getting me back to the privacy track. 

== Acknowledgements ==

We would like to thank the following authors and editors for their contributions to this guide:


* Gustavo Felisberto
* John P. Davis
* Sven Vermeulen
* nightmorph

[[Category:Server and Security]]
