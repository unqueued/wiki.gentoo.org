<languages />

Ce guide vous explique comment installer et configurer BIND pour votre domaine et votre réseau local.

== Introduction ==

Ce tutoriel explique comment installer et configurer BIND, le serveur DNS le plus employé sur Internet. Nous allons configurer <code>bind</code>  pour votre domaine à l'aide de différentes configurations, une pour le réseau local et une pour le reste du monde. Nous allons utiliser des vues à cet effet. Une vue pour votre zone interne (votre réseau local) et une autre vue pour la zone externe (le reste du monde). 

== Données utilisées dans les exemples ==

{| class="wikitable" style="text-align: left;" 
|- 
! Mot clé
! Explication
! Exemple
|- 
| VOTRE_DOMAINE
| Votre nom de domaine
| gentoo.org
|- 
| VOTRE_AD_IP_PUBLIQUE
| L'adresse IP que vous attribue votre ISP
| 204.74.99.100
|- 
| VOTRE_AD_IP_LOCALE
| L'adresse IP locale
| 192.168.1.5
|- 
| VOTRE_RESEAU_LOCAL
| Le réseau local
| 192.168.1.0/24
|- 
| SERVEUR_DNS_ESCLAVE
|L'adresse IP de votre serveur DNS esclave pour votre domaine
| 209.177.148.228
|- 
| ADMIN
| Le nom de l'administrateur du serveur DNS.
| root
|- 
| MODIFICATION
| La date de modification du fichier zone, avec un nombre ajouté
| 2009062901
|-
|}

== Configurer BIND ==

=== Installation ===

Tout d'abord, installez <code>net-dns/bind</code> . 

{{Emerge|net-dns/bind}}

=== Configurer /etc/bind/named.conf ===

La première chose à configurer est {{Path|/etc/bind/named.conf}} . La première partie de cette étape est de spécifier le répertoire racine de bind, le port d'écoute avec les adresses IP, le fichier pid, et une ligne pour le protocole ipv6.

{{Code|section sur les options |<pre>
options {
        directory "/var/bind";
  
        listen-on-v6 { none; };
        listen-on port 53 { 127.0.0.1; YOUR_LOCAL_IP; };
  
        pid-file "/var/run/named/named.pid";
};
</pre>
}}

La deuxième partie de  {{Path|named.conf}} est la vue interne utilisée pou notre réseau local. 

{{Code|Internal view|<pre>
view "internal" {
        match-clients { VOTRE_RESEAU_LOCAL; localhost; };
        recursion yes;
  
        zone "VOTRE_DOMAINE" {
                type master;
                file "pri/VOTRE_DOMAINE.internal";
                allow-transfer { any; };
        };
};
</pre>
}}

La troisième partie de {{Path|named.conf}} est la vue externe pour résoudre votre nom de domaine pour le reste du monde et pour résoudre tous les autres noms de domaine pour vous (et pour tous ceux qui veulent utiliser  votre serveur DNS). 

{{Code|External view|<pre>
view "external" {
        match-clients { any; };
        recursion no;
  
        zone "." IN {
                type hint;
                file "named.ca";
        };
  
        zone "127.in-addr.arpa" IN {
                type master;
                file "pri/127.zone";
                allow-update { none; };
                notify no;
        };
  
        zone "VOTRE_DOMAINE" {
                type master;
                file "pri/VOTRE_DOMAINE.external";
                allow-query { any; };
                allow-transfer { SERVEUR_DNS_ESCLAVE; };
        };
};
</pre>
}}

La dernière partie de  {{Path|named.conf}} est la politique de connexion. 

{{Code|External view|<pre>
logging {
        channel default_syslog {
                file "/var/log/named/named.log" versions 3 size 5m;
                severity debug;
                print-time yes;
                print-severity yes;
                print-category yes;
        };
       category default { default_syslog; };
};
</pre>
}}

Le répertoire {{Path|/var/log/named/}} doit exister et apparteni à  <code>named</code> : 

{{RootCmd|mkdir -p /var/log/named/
|chmod 770 /var/log/named/
|touch /var/log/named/named.log
|chmod 660 /var/log/named/named.log
|chown -R named /var/log/named/
|chgrp -R named /var/log/named/}}

=== Créer le fichier de  zone interne ===

Nous utilisons les noms d'hôtes et les adresses IP de l'image exemple de réseau. Notez que presque tous (pas tous) les noms de domaines se terminent par un "." (point). 

{{Code|/var/bind/pri/VOTRE_DOMAINE.internal|<pre>
$TTL 2d
@	IN SOA	ns.VOTRE_DOMAINE.	ADMIN.VOTRE_DOMAINE. (
	MODIFICATION	; serial
	3h	; refresh
	1h	; retry
	1w	; expiry
	1d )	; minimum
  
VOTRE_DOMAINE.		IN MX	0 mail.VOTRE_DOMAINE.
VOTRE_DOMAINE.		IN TXT	"v=spf1 ip4:OTRE_AD_IP_PUBLIQUE/32 mx ptr mx:mail.VOTRE_DOMAINE ~all"
VOTRE_DOMAINE.		IN NS	ns.VOTRE_DOMAINE.
VOTRE_DOMAINE.		IN NS	SERVEUR_DNS_ESCLAVE
www.VOTRE_DOMAINE.	IN A	192.168.1.3
ns.VOTRE_DOMAINE.	IN A	192.168.1.5
mail.VOTRE_DOMAINE.	IN A	192.168.1.3
router.VOTRE_DOMAINE.	IN A	192.168.1.1
hell.VOTRE_DOMAINE.	IN A	192.168.1.3
heaven.VOTRE_DOMAINE.	IN A	192.168.1.5
desktop.VOTRE_DOMAINE.	IN A	192.168.1.4
</pre>
}}

=== Créer le fichier de zone externe ===

Ici nous avons les sous-domaines que nous voulons pour les clients externes (www, mail et ns). 

{{Code|/var/bind/pri/VOTRE_DOMAINE.external|<pre>
$TTL 2d
@	IN SOA	ns.VOTRE_DOMAINE.	ADMIN.VOTRE_DOMAINE. (
	MODIFICATION	;serial
	3h	;refresh
	1h	;retry
	1w	;expiry
	1d )	;minimum
  
VOTRE_DOMAINE.		IN MX	0 mail.VOTRE_DOMAINE.
VOTRE_DOMAINE.		IN TXT	"v=spf1 ip4:VOTRE_AD_IP_PUBLIQUE/32 mx ptr mx:mail.VOTRE_DOMAINE ~all"
VOTRE_DOMAINE.		IN NS	ns.VOTRE_DOMAINE.
VOTRE_DOMAINE.		IN NS	SERVEUR_DNS_ESCLAVE
www.VOTRE_DOMAINE.	IN A	VOTRE_AD_IP_PUBLIQUE
ns.VOTRE_DOMAINE.		IN A	VOTRE_AD_IP_PUBLIQUE
mail.VOTRE_DOMAINE.	IN A	VOTRE_AD_IP_PUBLIQUE
</pre>
}}

=== Terminer la  configuration ===

Vous devez ajouter  <code>named</code> au niveau d'exécution par défaut : 

{{RootCmd|rc-update add named default}}

== Configurer les clients ==

Maintenant vous pouvez utiliser votre propre serveur DNS dans toutes les machines de votre réseau local pour résoudre les noms de domaine. Modifiez le fichier {{Path|/etc/resolv.conf}} de toutes les machines de votre réseau local. 

{{Code|Éditer/etc/resolv.conf|<pre>
search VOTRE_DOMAINE
nameserver SERVEUR_DNS_ESCLAVE
</pre>
}}

Note that YOUR_DNS_SERVER_IP is the same as YOUR_LOCAL_IP we used in this document. In the picture the example is 192.168.1.5. 

== Testing ==

We are able to test our new DNS server. First, we need to start the service. 

{{RootCmd|/etc/init.d/named start}}

Now, we are going to make some <code>host</code> commands to some domains. We can use any computer of our local network to do this test. If you don't have <code>net-dns/host</code> installed you can use <code>ping</code> instead. Otherwise, first run <code>emerge host</code> . 

{{Cmd|host www.gentoo.org|output=<pre>
www.gentoo.org has address 209.177.148.228
www.gentoo.org has address 209.177.148.229
</pre>}}

{{Cmd|host hell|output=<pre>
hell.YOUR_DOMAIN has address 192.168.1.3
</pre>}}

{{Cmd|host router|output=<pre>
router.YOUR_DOMAIN has address 192.168.1.1
</pre>}}


== Protecting the server with iptables ==

If you use iptables to protect your server, you can add these rules for DNS service. 

{{Code|Iptables rules|<pre>
iptables -A INPUT -p udp --sport 53 -m state --state ESTABLISHED,RELATED -j ACCEPT
iptables -A INPUT -p udp --dport 53 -j ACCEPT
iptables -A INPUT -p tcp --sport 53 -j ACCEPT
iptables -A INPUT -p tcp --dport 53 -j ACCEPT
</pre>
}}

== Acknowledgements ==

We would like to thank the following authors and editors for their contributions to this guide:

* Vicente Olivert Riera
* nightmorph


[[Category:Server]]
[[Category:Daemons]]
