{{warning|These instructions install unreviewed code from Pipelight upstream.}}

Recently it has been made possible to use Netflix in linux via [[Wine]] with good performance.

Check [https://github.com/compholio/wine-compholio-daily the Wine “Compholio” github page] & [http://pipelight.net/ the Pipelight page] for the latest information. The patchset will be updated continuously until all of the necessary features are upstream in vanilla Wine. At the time of writing Wine version 1.7.21 is the latest one.
==Preconfiguring==

===xattr===
File system extended attributes are used to keep the precious DRM working, so you’ll potentially need to add support in your kernel as well as having your file system mounted explicitly with the option.

====Checking for support====
Quick check (may not be indicative with recent kernel versions):
{{cmd|grep user_xattr /etc/mtab}}

More thorough:
{{cmd|<nowiki>touch ~/.xattr_test && setfattr -n 'user.testAttr' -v 'attribute value' ~/.xattr_test &> /dev/null; getfattr ~/.xattr_test 2>&1 | grep -q user.testAttr && echo 'It works!' || echo 'No workie!'; rm ~/.xattr_test &> /dev/null</nowiki>}}

====Adding support====

In recent kernel versions there doesn’t appear to be an option for ext4 extended attributes, presumably meaning they’re always on already.

{{kernel||<pre style="font-size: inherit;">File systems  --->
    Ext3 journalling file system support
[*]     Ext3 extended attributes
    The Extended 4 (ext4) filesystem
[*]     Ext4 extended attributes</pre>}}

See [[Kernel/Upgrade]] for in-depth kernel rebuild instructions.

{{file|/etc/fstab||<pre style="font-size: inherit;"># <fs>			<mountpoint>	<type>		<opts>		<dump/pass>
/dev/sda3		/		ext4		user_xattr	0 1</pre>}}

If you were only missing the option in <code>/etc/fstab</code>:
{{rootCmd|mount / -o remount}}

===cabextract===
Some plugins (notably Silverlight) require cabextract, which is available in Portage.
{{rootCmd|emerge -av app-arch/cabextract}}

==Wine==

===Install via Portage===

Recently a USE-flag "pipelight" was added for the [http://sources.gentoo.org/cgi-bin/viewvc.cgi/gentoo-x86/app-emulation/wine/wine-9999.ebuild?view=markup Wine package], which will automatically apply the required set of patches, so normally there should be no need to compile Wine manually anymore... Except if the version of the patches is outdated in the ebuild, or you are developer and want to know how it works.

===Compiling manually===

At first make sure that you have the attr header files installed, which are required in order to compile Wine with XATTR support.
{{rootCmd|emerge -atv crossdev attr}}

As a next step grab the latest [http://sourceforge.net/projects/wine/files/?source=navbar Wine source code] (1.7.21 as of writing) and grab the wine-patches from the [https://github.com/compholio/wine-compholio-daily wine-compholio repository]:

{{Cmd
|wget http://prdownloads.sourceforge.net/wine/wine-1.7.21.tar.bz2
|wget https://github.com/compholio/wine-compholio-daily/archive/v1.7.21.tar.gz}}

Extract the archives:

{{Cmd
|tar xvjf wine-1*.tar.bz2
|cd wine-1*
|tar xvzf ../v1.7.21.tar.gz --strip-components 1
|tar xvzf ../v1.7.21.tar.gz --strip-components=1 # this line is invisible}}

and apply the patches:

{{Cmd|make -C ./patches DESTDIR{{=}}$(pwd) install}}

This command also recreates the wineserver requests and runs autoreconf, so there is no need to run this manually.

Afterwards run configure:

{{Cmd
|./configure --with-xattr}}

Before you continue you should make sure that configure doesn't show any warnings (look at the end of the output). If there are any warnings it is recommended to install the missing header files first and then run the configure step again.

Afterwards compile and install Wine.

{{Cmd|make}}
{{rootCmd|make install}}

Now move on to Pipelight.

==Pipelight==
Since most of the available Pipelight overlays are outdated the only viable way to install Pipelight itself is to compile it. To do this follow the instructions below. Please note that some additional browser configuration is required, take a look at the next section for more details.

===Compile Pipelight===
First, get the needed tarballs for the pipelight source and precompiled binary:
{{Cmd
|wget https://bitbucket.org/mmueller2012/pipelight/get/v0.2.7.1.tar.gz
|wget http://repos.fds-team.de/pluginloader/v0.2.7.1/pluginloader.tar.gz}}

Next extract the files:
{{Cmd
|tar xvzf v0.2.7.1.tar.gz
|cd mmueller2012-pipelight-*
|tar xvzf ../pluginloader.tar.gz}}

And build it:

{{Cmd
|./configure --prefix{{=}}/usr --wine-path{{=}}/usr/local/bin/wine --moz-plugin-path{{=}}/usr/lib/nsbrowser/plugins/ --win32-prebuilt
|make}}

Then install it:

{{rootCmd
|make install
|/usr/bin/pipelight-plugin --create-mozilla-plugins}}

===Initialization===

After the installation just initialize the plugin(s) you want to use. To use Netflix you have to enable Silverlight.

{{Cmd
|/usr/bin/pipelight-plugin --enable silverlight
|/usr/bin/pipelight-plugin --enable flash}}

Press Y to accept the plugin license. Then run Firefox (or your chosen web browser) from the Terminal to check if the plugin will run, i.e. for firefox-bin:

{{Cmd|firefox-bin}}

and watch the startup in the terminal for any errors. The plugin installation either starts immediately, or when visiting about:plugins in your webbrowser. If there are some errors please check again that you really installed Wine and Pipelight according to this page, if not then proceed with the following steps.

===Microsoft Corefonts (optional)===

For Wine-Compholio < 1.7.14 this step was required such that Silverlight works properly (see this [https://answers.launchpad.net/pipelight/+faq/2441 FAQ entry]). With Wine-Compholio 1.7.14 or greater the patchset already includes a [https://github.com/compholio/wine-compholio-daily/tree/master/patches/10-Missing_Fonts Arial replacement font], which seems to be sufficient for the Silverlight plugin.

To install the Corefonts you have to use Winetricks. Just download the Winetricks script (for example to your home directory):
{{Cmd|wget http://winetricks.org/winetricks}}

Mark it as executable:
{{Cmd|chmod +x winetricks}}

Then run it:
{{Cmd| WINEPREFIX{{=}}$HOME/.wine-pipelight ./winetricks}}

Then select "Select the default wineprefix" -> "Install a font" -> "corefonts" and click "Okay".

===Netflix===
Install an extension listed at http://answers.launchpad.net/pipelight/+faq/2351 such as https://addons.mozilla.org/en-US/firefox/addon/user-agent-overrider and configure a Windows UA string, such as this one:[http://answers.launchpad.net/pipelight/+faq/2351 *]
<pre>Mozilla/5.0 (Windows NT 6.1; WOW64; rv:15.0) Gecko/20120427 Firefox/15.0a1</pre>

Enjoy improved Netflix.

==Troubleshooting==
*Try different UA strings
*(Re)Move <code>~/.wine-pipelight</code>
*(Re)Move <code>pluginreg.dat</code> from <code>~/.mozilla</code> (<code>find ~/.mozilla/ -name 'pluginreg.dat'</code>)
*Check paths & other variables in <code>~/.config/pipelight-silverlight5.1</code> (or if nonexistant, <code>/usr/share/pipelight/configs/pipelight-silverlight5.1</code>)
{{rootCmd|eselect opengl list}}
{{rootCmd|eselect opengl set #}}

=== Audio ===
If you use Pulseaudio but find that wine32 is trying to load 64-bit pulseaudio drivers, consider the solution found in this [http://forums.gentoo.org/viewtopic-p-7060060.html here]

==See also==
*[http://bugs.gentoo.org/481596 Bug 481596 - use Silverlight apps in browser using Wine]

==External resources==
*[http://pipelight.net/cms/ Pipelight | News]
*[http://fds-team.de/cms/articles/2013-08/pipelight-using-silverlight-in-linux-browsers.html FDS-Team | Pipelight: using Silverlight in Linux browsers]
*[http://forums-lb.gentoo.org/viewtopic-t-951092.html Gentoo Forums :: View topic - HOWTO: Install Netflix on Gentoo]

[[Category:Software]]
