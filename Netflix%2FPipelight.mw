{{warning|These instructions install unreviewed code from Pipelight upstream.}}

Recently it has been made possible to use Netflix in linux via [[Wine]] with good performance.

Check [http://www.compholio.com/wine-compholio/ the “Compholio” Wine patches page] & [http://fds-team.de/cms/articles/2013-08/pipelight-using-silverlight-in-linux-browsers.html the FDS-Team Pipelight page] for the latest information. At the time of this writing, Wine version 1.7.5 seemed to be targeted, which is not currently in portage.

==Preconfiguring==

===xattr===
File system extended attributes are used to keep the precious DRM working, so you’ll potentially need to add support in your kernel as well as having your file system mounted explicitly with the option.

====Checking for support====
Quick check (may not be indicative with recent kernel versions):
{{cmd|grep user_xattr /etc/mtab}}

More thorough:
{{cmd|<nowiki>touch ~/.xattr_test && setfattr -n 'user.testAttr' -v 'attribute value' ~/.xattr_test &> /dev/null; getfattr ~/.xattr_test 2>&1 | grep -q user.testAttr && echo 'It works!' || echo 'No workie!'; rm ~/.xattr_test &> /dev/null</nowiki>}}

====Adding support====

In recent kernel versions there doesn’t appear to be an option for ext4 extended attributes, presumably meaning they’re always on already.

{{kernel||<pre style="font-size: inherit;">File systems  --->
    Ext3 journalling file system support
[*]     Ext3 extended attributes
    The Extended 4 (ext4) filesystem
[*]     Ext4 extended attributes</pre>}}

See [[Kernel/Upgrade]] for in-depth kernel rebuild instructions.

{{file|/etc/fstab||<pre style="font-size: inherit;"># <fs>			<mountpoint>	<type>		<opts>		<dump/pass>
/dev/sda3		/		ext4		user_xattr	0 1</pre>}}

If you were only missing the option in <code>/etc/fstab</code>:
{{rootCmd|mount / -o remount}}

===Wine===
Even when Wine 1.7.5+ is in Portage, all the patches might never be in the official Wine source code, so the way that is most maintainable is to manually compile it manually.

first off, grab the latest source code (1.7.9 as of writing)

[http://sourceforge.net/projects/wine/files/?source=navbar]

and grab the wine-patches tarball here:

[http://fds-team.de/cms/pipelight-compile-wine.html]


then extract the archives:

{{Cmd|tar xvzf wine-patches.tar.gz && tar xjvf wine-1*.tar.gz}}

and cd into the wine source code and apply the patches:

{{Cmd|cd wine-1.* && (cat ../wine/*.patch {{!}}} patch -p1) {{!}}}{{!}}} echo "FAILED TO APPLY PATCHES"}}

then build the source code and install it:

{{Cmd|make}}

{{rootCmd|make install}}

Now move onto pipelight

==Pipelight==
Since Pipelight is later than most current versions in overlays, the only viable way to install Pipelight itself is to compile it.


==emerge==
{{rootCmd|emerge -atv crossdev attr}}

==Setup crossdev==
This will take quite a while:
{{rootCmd|crossdev -S -t mingw64}}wget https://launchpad.net/pipelight/trunk/0.2/+download/pluginloader-prebuilt-v0.2.3.tar.xz}}

==Compile Pipelight==
First, get the needed tarballs for the pipelight source and precompiled binary:
{{Cmd|wget https://bitbucket.org/mmueller2012/pipelight/get/v0.2.3.tar.gz && wget https://launchpad.net/pipelight/trunk/0.2/+download/pluginloader-prebuilt-v0.2.3.tar.xz}}

Next extract the files:
{{Cmd|tar xvzf v0.2.3.tar.gz && tar xvJf pluginloader-prebuilt-v0.2.3.tar.xz}}

And move the pluginloader binary to the pipelight src/windows directory:

{{Cmd|mv pluginloader.exe mmueller2012-pipelight-4006752d5f96/src/windows}}

Then cd into the pipelight source directory configure and build it:

{{Cmd|cd ~/mmueller2012-pipelight-4006752d5f96/ && ./configure --wine-path{{=}}/usr/local/bin/wine --moz-plugin-path{{=}}/usr/lib/nsbrowser/plugins/ --win32-prebuilt && make}}

then install it:

{{rootCmd| make install}}

==Initialization==
Before you use the plugin, you have to initialize it, first run

{{rootCmd|pipelight-plugin --create-mozilla-plugins}}

Then initialize the plugin(s) you want:

{{Cmd|pipelight-plugin --enable silverlight}}
{{Cmd|pipelight-plugin --enable flash}}

Then run Firefox (or your chosen web browser) from the Terminal to check to see if the plugin will run, i.e. for firefox-bin:

{{Cmd|firefox-bin}}

and watch the startup in the terminal for any errors, if any are found, check that you properly installed Wine and Pipelight according to this page, if not, proceed.

Then you have to install corefonts in Pipelight (which isn't installed by default. To do so you have to use Winetricks, to get them, cd to your home directory and grab the script:

{{Cmd|wget http://winetricks.org/winetricks}}

Mark it as executable:
{{Cmd|chmod +x winetricks}}

Then run it:
{{Cmd| WINEPREFIX{{=}}/home/<username>/.wine-pipelight ./winetricks}}
(replace <username> with your username)

Then select Select the default wineprefix->Install a font->corefonts and click "Okay"

The next section details a bit of extra configuration needed for services such as Netflix


==Netflix==
Install an extension listed at http://answers.launchpad.net/pipelight/+faq/2351 such as http://addons.mozilla.org/en-us/firefox/addon/uacontrol/ and configure <code>netflix.com</code> to be sent a UA string, such as this one:[http://answers.launchpad.net/pipelight/+faq/2351 *]
<pre>Mozilla/5.0 (Windows NT 6.1; rv:23.0) Gecko/20131011 Firefox/23.0</pre>

Enjoy improved Netflix.

==Troubleshooting==
*Try different UA strings
*(Re)Move <code>pluginreg.dat</code> from <code>~/.mozilla</code> (<code>find ~/.mozilla/ -name 'pluginreg.dat'</code>)
*Check paths & other variables in <code>~/.config/pipelight</code> (or if nonexistant, <code>/usr/share/pipelight/pipelight</code>)
{{rootCmd|eselect opengl list}}
{{rootCmd|eselect opengl set #}}

=== Audio ===
If you use Pulseaudio but find that wine32 is trying to load 64-bit pulseaudio drivers, consider the solution found in this [http://forums.gentoo.org/viewtopic-p-7060060.html here]

==See also==
*[http://bugs.gentoo.org/481596 Bug 481596 - use Silverlight apps in browser using Wine]

==External resources==
*[http://fds-team.de/cms/articles/2013-08/pipelight-using-silverlight-in-linux-browsers.html FDS-Team | Pipelight: using Silverlight in Linux browsers]
*[http://forums-lb.gentoo.org/viewtopic-t-951092.html Gentoo Forums :: View topic - HOWTO: Install Netflix on Gentoo]

[[Category:Software]]
