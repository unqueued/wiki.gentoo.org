{{warning|These instructions install unreviewed code from Pipelight upstream.}}

Recently it has been made possible to use Netflix in linux via [[Wine]] with good performance.

Check [http://www.compholio.com/wine-compholio/ the “Compholio” Wine patches page] & [http://fds-team.de/cms/articles/2013-08/pipelight-using-silverlight-in-linux-browsers.html the FDS-Team Pipelight page] for the latest information. At the time of this writing, Wine version 1.7.5 seemed to be targeted, which is not currently in portage.

==Preconfiguring==

===xattr===
File system extended attributes are used to keep the precious DRM working, so you’ll potentially need to add support in your kernel as well as having your file system mounted explicitly with the option.

====Checking for support====
Quick check (may not be indicative with recent kernel versions):
{{cmd|grep user_xattr /etc/mtab}}

More thorough:
{{cmd|<nowiki>touch ~/.xattr_test && setfattr -n 'user.testAttr' -v 'attribute value' ~/.xattr_test &> /dev/null; getfattr ~/.xattr_test 2>&1 | grep -q user.testAttr && echo 'It works!' || echo 'No workie!'; rm ~/.xattr_test &> /dev/null</nowiki>}}

====Adding support====

In recent kernel versions there doesn’t appear to be an option for ext4 extended attributes, presumably meaning they’re always on already.

{{kernel||<pre style="font-size: inherit;">File systems  --->
    Ext3 journalling file system support
[*]     Ext3 extended attributes
    The Extended 4 (ext4) filesystem
[*]     Ext4 extended attributes</pre>}}

See [[Kernel/Upgrade]] for in-depth kernel rebuild instructions.

{{file|/etc/fstab||<pre style="font-size: inherit;"># <fs>			<mountpoint>	<type>		<opts>		<dump/pass>
/dev/sda3		/		ext4		user_xattr	0 1</pre>}}

If you were only missing the option in <code>/etc/fstab</code>:
{{rootCmd|mount / -o remount}}

===Wine===
Until wine-1.7.5 is added to Portage, it is necessary to install and patch wine manually. Up to date instructions can be found [http://fds-team.de/cms/pipelight-compile-wine.html here]

==Pipelight==
If you don’t already have a local overlay (note this can interfere with Layman stuff):
{{rootCmd|<nowiki>echo 'PORTDIR_OVERLAY=/usr/local/portage' >> /etc/portage/make.conf</nowiki>}}
{{rootCmd|mkdir -p /usr/local/portage/www-plugins/pipelight}}
{{rootCmd|<nowiki>wget -qO - 'https://481596.bugs.gentoo.org/attachment.cgi?id=356458' | sed 's/\(EGIT_REPO_URI\)/EGIT_COMMIT="v0.1-4"\n\1/' > /usr/local/portage/www-plugins/pipelight/pipelight-9999.ebuild</nowiki>}}
{{rootCmd|<nowiki>echo '~www-plugins/pipelight-9999 **' | tee -a /etc/portage/package.accept_{keywords/netflix,keywords}</nowiki>}}

Manual build instructions for pipelight can be found [http://fds-team.de/cms/pipelight-installation.html here]

==emerge==
{{rootCmd|emerge -atv crossdev attr}}

==Setup crossdev==
This will take quite a while:
{{rootCmd|crossdev -S -t mingw64}}

==emerge Pipelight==
{{rootCmd|emerge --digest -atv pipelight}}

{{note|I have found that I get a compile error in pluginloader.c regarding "_controlfp_s(&control_word, _CW_DEFAULT, MCW_PC);". I was able to simply comment that 4 line block of code out and continue compiling:
ebuild /usr/local/portage/www-plugins/pipelight/pipelight-9999.ebuild compile;
ebuild /usr/local/portage/www-plugins/pipelight/pipelight-9999.ebuild install;
ebuild /usr/local/portage/www-plugins/pipelight/pipelight-9999.ebuild qmerge;
A proper solution would be welcome.
}}

==Wine installation==
This takes a bit, and produces a lot of output:
{{cmd|<pre style="font-size: inherit;">if [ ! -d ~/.wine-pipelight ]; then
	export WINEARCH=win32 WINEPREFIX=~/.wine-pipelight

	wget -O /tmp/Silverlight-5.exe \
	-U 'Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.2; Trident/6.0)' \
	'http://www.microsoft.com/getsilverlight/handlers/getsilverlight.ashx?v=5.0'

	wine /tmp/Silverlight-5.exe /q

	export -n WINEARCH WINEPREFIX
fi</pre>}}

==Pipelight config==
Needs to be changed a bit:
{{cmd|<nowiki>cat /usr/share/pipelight/pipelight | sed -e 's@^winePath\(.*\)= .*@winePath\1= /usr/local/@' -e 's@^gccRuntimeDlls\(.*\)i686.*@gccRuntimeDlls\1mingw32/'$(ls /usr/lib/gcc/mingw32/)'/@' -e 's@^dllPath\(.*\)Silverlight\(.*\)@dllPath\1Microsoft Silverlight\2@g' > ~/.config/pipelight</nowiki>}}

At this point, double check your config "~/.config/pipelight" to make sure the paths are correct, specifically the Silverlight path. You may have have to disable the graphics driver check by setting graphicDriverCheck = /bin/true.

==Firefox, etc.==
Start Firefox (from terminal for output explaining whether pipelight is going to work or not), and go to http://bubblemark.com/silverlight2.html for a quick check for Silverlight support.

==Netflix==
Install an extension listed at http://answers.launchpad.net/pipelight/+faq/2351 such as http://addons.mozilla.org/en-us/firefox/addon/uacontrol/ and configure <code>netflix.com</code> to be sent a UA string, such as this one:[http://answers.launchpad.net/pipelight/+faq/2351 *]
<pre>Mozilla/5.0 (Windows NT 6.1; rv:23.0) Gecko/20131011 Firefox/23.0</pre>

Enjoy improved Netflix.

==Troubleshooting==
*Try different UA strings
*(Re)Move <code>pluginreg.dat</code> from <code>~/.mozilla</code> (<code>find ~/.mozilla/ -name 'pluginreg.dat'</code>)
*Check paths & other variables in <code>~/.config/pipelight</code> (or if nonexistant, <code>/usr/share/pipelight/pipelight</code>)
{{rootCmd|eselect opengl list}}
{{rootCmd|eselect opengl set #}}

=== Audio ===
If you use Pulseaudio but find that wine32 is trying to load 64-bit pulseaudio drivers, consider the solution found in this [http://forums.gentoo.org/viewtopic-p-7060060.html here]

==See also==
*[http://bugs.gentoo.org/481596 Bug 481596 - use Silverlight apps in browser using Wine]

==External resources==
*[http://fds-team.de/cms/articles/2013-08/pipelight-using-silverlight-in-linux-browsers.html FDS-Team | Pipelight: using Silverlight in Linux browsers]
*[http://forums-lb.gentoo.org/viewtopic-t-951092.html Gentoo Forums :: View topic - HOWTO: Install Netflix on Gentoo]

[[Category:Software]]
