<languages />

{{Metadata|abstract=This guide should help users localize their Gentoo Linux distribution to any known locale. It uses Germany as a case-study, since it is translated from the German doc. Includes configuration for use of the euro currency symbol.}}

== 標準時 ==

現在位置に応じて、システム時間を維持するために、時間帯を設定する必要があります。[[System_time#OpenRC|OpenRCベースのシステム]]および[[System_time#systemd|systemdベースのシステム]]のためにこれを行う方法手順は、[[System_time|システム時刻]]の記事で見つけることができます。

== ロケールシステム ==

=== ロケールとは何ですか? ===

ロケールは、国や言語に特有の設定を決定するために使う情報の集合体で、大抵のプログラムがこれを利用します。ロケールとそのデータはシステムライブラリの一部であり、ほとんどのシステムにおいて {{Path|/usr/share/i18n/locales/}} にあります。ロケール名は一般に、<code>ab_CD</code>という形式で命名されます。ここで<code>ab</code>は2 (または3) 文字の言語コード ([[wikipedia:ISO_639|ISO-639]]で規定) であり、<code>CD</code>は2文字の国コード ([[wikipedia:ISO_3166|ISO-3166]]で規定) になります。多くの場合、<code>@euro</code>または<code>@latin</code>のような変形情報 (バリアント) がロケール名に追加されます。
例えば、<code>de_DE@euro</code>や<code>nan_TW@latin</code>です。ロケールと関連する記事をもっと読むには、[[wikipedia:Locale_(computer_software)|wikipedia (英語) ]]を探してみてください。

=== ロケール関連の環境変数 ===

ロケール設定の色々な側面を制御する環境変数を以下の表に示します。
これらのすべては、上記の<code>ab_CD</code>形式で表記されたロケール名を1つだけ設定できます。 

{| class="table table-striped" style="text-align: left;" 
|- 
! scope=col width=25% | Variable name
! scope=col width=75% | Explanation
|- 
| <var>LANG</var>
| Defines all locale settings at once, while allowing further individual customization via the LC_* settings below.
|- 
| <var>LC_COLLATE</var>
| Define alphabetical ordering of strings. This affects e.g. output of sorted directory listings.
|- 
| <var>LC_CTYPE</var>
| Define the character-handling properties for the system. This determines which characters are seen as alphabetic, numeric, and so on. This also determines the character set used, if applicable.
|- 
| <var>LC_MESSAGES</var>
| Programs' localizations stored in {{Path|/usr/share/locale/}} for applications that use a message-based localization scheme (the majority of GNU programs; see the next chapters for further information on which programs do, and how to get the programs that don't to work).
|- 
| <var>LC_MONETARY</var>
| Defines currency units and formatting of currency-type numeric values.
|- 
| <var>LC_NUMERIC</var>
| Defines formatting of numeric values which aren't monetary. Affects things such as thousand separator and decimal separator.
|- 
| <var>LC_TIME</var>
| Defines formatting of dates and times.
|- 
| <var>LC_PAPER</var>
| Defines default paper size.
|- 
| <var>LC_ALL</var>
| Overrides all other settings.
|-
|}

{{Note/ja|あるロケール (特にエストニアのもの) では異なる順序付けを使用しているにも関わらず、いくつかのプログラムは、アルファベットの伝統的な英語での順序付けを期待して書かれています。そのため、システム全体の設定を行う際、明確に<var>LC_COLLATE</var>へCを設定しておくことをお勧めします。}}

{{Warning/ja|<var>LC_ALL</var>を設定するのは、(<var>LANG</var>を除く)他の全ての <var>LC_*</var>変数の設定を上書きしてしまうので、特に避けるべきです。つまり、<var>LC_ALL</var>をリセットしない限りは他の手段による変更が有効にならないということです。大概は、起動時に<var>LC_ALL</var>を設定することは最良の選択ではないでしょう。}}

最も一般的なのは、ユーザが<var>LANG</var>変数のみをグローバルに設定することです。

=== 特定のロケールの生成 ===

ほとんどのユーザは、おそらくシステムで1つ、もしかしたら2つのロケールを使用するでしょう。追加のロケールをどのように指定するかについては、ファイル{{Path|/etc/locale.gen}}の中に説明があります。 

{{CodeBox|title=ロケールを/etc/locale.genに追加する|1=
en_GB ISO-8859-1
en_GB.UTF-8 UTF-8
de_DE ISO-8859-1
de_DE@euro ISO-8859-15
}}

{{Note/ja|ユーロ通貨記号 (€) を非UTF-8ベースのロケールで使う場合、{{Path|/usr/share/i18n/SUPPORTED/}} の中の<code>@euro</code>が付いた値をロケールとして使用してください。}}

杉のステップは、{{c|locale-gen}} を実行することです。これは、{{Path|/etc/locale.gen}} ファイルの中で指定された全てのロケールを生成し、ロケールアーカイブ ({{Path|/usr/lib/locale/locale-archive}}) に書き込みます。 

{{RootCmd|locale-gen|output=<pre>
 * Generating 4 locales (this might take a while) with 1 jobs
 *  (1/4) Generating en_GB.ISO-8859-1 ...                       [ ok ]
 *  (2/4) Generating en_GB.UTF-8 ...                            [ ok ]
 *  (3/4) Generating de_DE.ISO-8859-1 ...                       [ ok ]
 *  (4/4) Generating de_DE.ISO-8859-15@euro ...                 [ ok ]
 * Generation complete
</pre>}}

{{c|locale -a}} を実行して、選択したロケールが使用可能かを確認してください。

{{Cmd|locale -a|output=<pre>
C
POSIX
de_DE
de_DE.iso88591
de_DE.iso885915@euro
de_DE@euro
deutsch
en_GB
en_GB.iso88591
en_GB.utf8
german
</pre>}}

{{Path|/usr/lib/locale/locale-archive}} ファイルは、{{c|localedef}} を使って表示できます。

{{Cmd|localedef --list-archive}}

その未加工の内容は、{{c|strings}} コマンドを使って表示可能です。

{{Cmd|strings /usr/lib/locale/locale-archive {{!}} less}}

=== ロケール設定 ===

==== OpenRC ==== 

OpenRCを使用する際、ロケール設定は環境変数に格納されます。一般的には、{{Path|/etc/env.d/02locale}} (システム全体の設定用) と {{Path|~/.bashrc}} (ユーザ固有の設定用) ファイルで設定します。詳細は記事[[UTF-8#Setting_the_locale|UTF-8]]に記載されています。システム全体の設定 ({{Path|/etc/env.d/02locale}}) は {{c|eselect locale}} を通じて管理できます。例えば、<var>LANG</var>変数を<code>C</code>という値に設定するには:

{{RootCmd|eselect locale list|output=<pre>
Available targets for the LANG variable:
  [1]   C 
  [2]   POSIX
  [3]   en_US
  [4]   en_US.iso885915
  [5]   en_US.utf8
  [ ]   (free form)
</pre>}}

{{RootCmd|eselect locale set 1}}

もちろん、手動でファイルを編集することで、ロケール変数を様々に変化させることも可能です。

{{FileBox|filename=/etc/env.d/02locale|title=/etc/env.d/02locale でシステムのデフォルトのロケールを設定|lang=bash|1=
LANG="de_DE.UTF-8"
LC_COLLATE="C"
}}

特に、より伝統的なUNIX環境ではかなり一般的なのですが、グローバル設定
を不変のまま (すなわち "<code>C</code>" ロケール) にしておくことも可能です。それでもユーザは、自分のシェルのRCファイルで自分の優先ロケールを指定することが可能です: 

{{FileBox|filename=~/.bashrc|title=ユーザ用ロケールの設定|lang=bash|1=
export LANG="de_DE.UTF-8"
export LC_COLLATE="C"
}}

システムを構成する別の方法は、既定はCロケールにしたまま、同時にUTF-8文字での表示を有効にすることです。このオプションは、{{Path|/etc/env.d/02locale}} で下記のような設定を使用することで実現できます: 

{{CodeBox|title=UTF-8を指定しながらの伝統的なCロケールの使用|lang=bash|1=
LC_CTYPE=de_DE.UTF-8
}}

上記のスニペットを使うと、ユーザは選択した言語を全面的に使用しなくとも、ローカライズされたファイル名を適切に見ることができるようになります。 

一旦、正しいロケールを設定したら、変更をシステムに認識させるため、環境変数を更新してください。

システム全体の既定ロケールならば:

{{RootCmd|env-update && source /etc/profile}}

ユーザ固有のロケールならば:

{{Cmd|source ~/.bashrc}}

その後、{{Key|Ctrl}}+{{Key|Alt}}+{{Key|Backspace}}を押してXサーバを殺し
、ログアウトしてからユーザとしてログインしてください。 

では、変更内容が反映されていることを確認してください: 

{{Cmd|locale}}

==== systemd ====

systemdの場合、ロケールの設定には {{c|localectl}} コマンドを使います。利用可能なロケール一覧を確認するには:

{{RootCmd|localectl list-locales}}

次に、目的のロケールを設定します:

{{RootCmd|<nowiki>localectl set-locale LANG=de_DE.utf8</nowiki>}}

最後に結果がうまくいっているかを確認してください:

{{RootCmd|<nowiki>localectl | grep "System Locale"</nowiki>|output=<pre>
   System Locale: LANG=de_DE.utf8
</pre>}}

== コンソール用のキーボードレイアウト ==

=== OpenRC ===

The keyboard layout used by the console is set in {{Path|/etc/conf.d/keymaps}} by the <var>keymap</var> variable. Valid values can be found in {{Path|/usr/share/keymaps/YOUR_ARCH/}}. {{Path|i386}} has further subdivisions into layout ({{Path|qwerty/}}, {{Path|azerty/}}, etc.). Some languages have multiple options - experiment with the various options to decide which one fits the needs best. 

{{FileBox|filename=/etc/conf.d/keymaps|title=Setting the console keymap|lang=bash|1=
keymap="de"
#keymap="de-latin1"
#keymap="de-latin1-nodeadkeys"
}}

=== systemd ===

With systemd the keymap layout used for the console can be set using the {{c|localectl}} command. First check the available keymap layouts:

{{RootCmd|localectl list-keymaps}}

Then set the requested console keymap layout:

{{RootCmd|localectl set-keymap it}}

Finally check if the console keymap layout was set correctly:

{{RootCmd|<nowiki>localectl | grep "VC Keymap"</nowiki>|output=<pre>
       VC Keymap: it
</pre>}}

== Keyboard layout for the X server ==

=== OpenRC ===

The keyboard layout to be used by the X server is specified in {{Path|/etc/X11/xorg.conf.d/30-keyboard.conf}} by the <var>XkbLayout</var> option. For details visit the [[Xorg/Guide#Configuring_the_keyboard|Xorg guide]] and the article about [[Keyboard_layout_switching#X11|Keyboard layout switching]].

=== systemd ===

With systemd the keymap layout for the X11 server can be set using the {{c|localectl}} command. First check the available X11 keymap layouts:

{{RootCmd|localectl list-x11-keymap-layouts}}

Then set the requested X11 keymap layout:

{{RootCmd|localectl set-x11-keymap it}}

Finally check if the X11 keymap layout was set correctly:

{{RootCmd|<nowiki>localectl | grep "X11 Layout"</nowiki>|output=<pre>
      X11 Layout: it
</pre>}}

== NLS ==

For message based localization to work in programs that support it and have the [https://packages.gentoo.org/useflags/nls <code>nls</code> (Native language support) USE flag], compile the programs with this flag set. Message strings are installed in {{Path|/usr/share/locale/<locale>/LC_MESSAGES/<package>.mo}} files. Most of the programs using nls also need the gettext library to extract and use localized messages. Of course, Portage will automatically install it when needed.

After enabling the <code>nls</code> USE flag some packages might need to be re-emerged:

{{Emerge|params+=--changed-use --deep --with-bdeps=y|@world}}

== LINGUAS ==

There is also an additional <var>USE_EXPAND</var> flag called <var>[https://packages.gentoo.org/useflags/linguas_en LINGUAS]</var> <ref>[https://devmanual.gentoo.org/general-concepts/linguas/ LINGUAS] in Gentoo Development Guide</ref>, which affects the localization files that get installed in gettext-based programs, and decides which GUI language packs should be downloaded and installed for some specific software packages, such as [[Firefox]], [[Thunderbird]], [[KDE#Localization|kde-base/kde-l10n]] or [[LibreOffice|app-office/libreoffice-l10n]]. The variable takes in ''space''-separated list of language codes, and a suggested place to set it is {{Path|[[:/etc/portage/make.conf#LINGUAS|/etc/portage/make.conf]]}}: 

{{RootCmd|nano -w /etc/portage/make.conf|output=<pre>
## (LINGUAS 変数を追加する。例えばドイツ語とフィンランド語と英語:)
LINGUAS="de fi en"
</pre>}}

With <code>LINGUAS=""</code>, most ebuilds would install only the packages' default language but none of the <code>LC_MESSAGES</code> files. They would also not download and install any of the further language packs. For instance, the currently stable [[LibreOffice|app-office/libreoffice]] receives further language support through {{Package|app-office/libreoffice-l10n}} which supports download and installation of the language packs defined in <code>LINGUAS</code>. Since the origin language of libreoffice is <code>en_US</code>, it does not have <code>en_US</code> flag in {{Package|app-office/libreoffice-l10n}}. So with <code>LINGUAS=""</code>, libreoffice still supports <code>en_US</code>.

To see the status of GUI translation, hyphenation, spell checking and other localizations on the language, please refer to the [https://translations.documentfoundation.org/ LibreOffice translation web site].

For finer grained control the <var>USE_EXPAND</var> variables can be set per package in {{Path|[[:/etc/portage/package.use]]}}: 

{{FileBox|filename=/etc/portage/package.use|lang=bash|1=
www-client/firefox linguas_de linguas_pt_BR linguas_en_GB
}}

A list of installed programs making use of the <var>[https://packages.gentoo.org/useflags/linguas_en LINGUAS]</var> <var>USE_EXPAND</var> flag and their supported languages can be shown as follows:

{{Cmd|eix -I -U linguas}}

A list of <var>LINGUAS</var> values that can be used is provided as {{Path|/usr/portage/profiles/desc/linguas.desc}}: 

{{Cmd|grep -i french /usr/portage/profiles/desc/linguas.desc|output=<pre>
fr - French locale
fr_CA - French locale for Canada
fr_FR - French locale for France
</pre>
}}

After setting the <var>[https://packages.gentoo.org/useflags/linguas_en LINGUAS]</var> <var>USE_EXPAND</var> flag it may be necessary to re-emerge some packages:

{{Emerge|params+=--changed-use --deep --with-bdeps=y|@world}}

== 参考 ==


* [[Handbook:AMD64/Installation/Base#Configure_locales|Configuring locales]] (Gentoo Handbooks)
* [[Evdev#Keyboard_layout|Keyboard layout]] inside the Evdev article
* [[X resources]]
* [[Localization/Guide/The_Euro_symbol|The Euro symbol]] ([http://unicode-table.com/en/20AC/ €]) for the console and in X

== External resources == 

* [http://www.gnu.org/software/libc/manual/html_node/Locales.html Locales and Internationalization] (gnu.org)
* [https://blogs.gentoo.org/mgorny/2016/05/16/how-linguas-are-thrice-wrong/ Michał Górny:How LINGUAS are thrice wrong!]

== References ==

{{reflist}}


[[Category:Localization]] {{Migrated|originalauthors=Alexander Holler, Steven Lucy, Benny Chuang, Lars Weiler, Tobias Scherbaum, Flammie Pirinen, nightmorph, klondike}}
