Blender is a professional free and open-source 3D computer graphics software.

== Installation ==
Installation of Blender on Gentoo is rather complicated. This page explains how to solve the most
common issues for installation of version 2.72b. Blender quickly changes, and this manual may soon become obsolete.
* unmask python 3.4 use flags by adding lines 
 -python_targets_python3_4
 -python_single_target_python3_4
to /etc/portage/profile/use.stable.mask
* use eapi 5
 cat /etc/portage/profile/eapi
 5
* setup blender use flags in /etc/portage/package.use:
 # blender
 media-gfx/blender python_targets_python3_4 python_single_target_python3_4 cycles openimageio player fftw openal
 dev-python/numpy python_targets_python3_4
 dev-python/chardet python_targets_python3_4
 dev-python/requests python_targets_python3_4
 dev-python/setuptools python_targets_python3_4
 sci-libs/hdf5 -threads # with threads we would have to disable cxx and fortran
Use flags python_targets_python3_4 and python_single_target_python3_4 are required for python, the rest here are essential
for work with blender, but not necessary:
{{UseFlag|package=media-gfx/blender
|cycles
|player
|fftw
|openal
|openimageio}}
* unmask related packages by adding to /etc/portage/package.keywords
 media-gfx/blender ~amd64
 sci-libs/ldl ~amd64
* cycles has a bug and does not compile with gcc 4.8 and 4.9, to work around it, create a file
/etc/portage/patches/media-gfx/blender/blender.redefinition.patch
with contents
<pre>diff -Nur old/intern/cycles/util/util_simd.h new/intern/cycles/util/util_simd.h 
--- old/intern/cycles/util/util_simd.h  2014-10-20 03:58:22.000000000 -0400 
+++ new/intern/cycles/util/util_simd.h  2015-02-03 13:29:26.156893414 -0500 
@@ -19,6 +19,7 @@ 
 #define __UTIL_SIMD_TYPES_H__
 
 #include <limits>
+#include <x86intrin.h> 
 
 #include "util_debug.h"
 #include "util_types.h"</pre>
(you can copy from http://pastebin.com/k20VbHjG if this wiki's layout adds some extra spaces and patch does not work)
* emerge blender {{Emerge|--verbose media-gfx/blender}}

== Cuda ==

Cycles renderer can work on GPUs, for example nvidia gtx 970 is about twice as fast as than i5 4690k on
traditional BMW benchmark. To enable graphics card rendering, install cuda
{{Emerge| --verbose dev-util/nvidia-cuda-toolkit}}
and follow blender's manuals to switch from CPU rendering to GPU.

=== nvidia GTX 900 series ===
There may be complications. At the moment of writing this (February 2015)
newer nvidia cards are not supported in blender 2.72. Fix is trivial, however:
* unmask and emerge dev-util/nvidia-cuda-toolkit of version 6.5.19 or higher
* create a file /etc/portage/patches/media-gfx/blender/blender.sm_52.patch with contents
<pre>diff --git a/intern/cycles/kernel/kernel.cu b/intern/cycles/kernel/kernel.cu
index d5b5293..9ed4592 100644
--- a/intern/cycles/kernel/kernel.cu
+++ b/intern/cycles/kernel/kernel.cu
@@ -52,8 +52,8 @@
 #define CUDA_KERNEL_MAX_REGISTERS 63
 #define CUDA_KERNEL_BRANCHED_MAX_REGISTERS 63
 
-/* 5.0 */
-#elif __CUDA_ARCH__ == 500
+/* 5.0 and 5.2 */
+#elif __CUDA_ARCH__ == 500 || __CUDA_ARCH__ == 520
 #define CUDA_MULTIPRESSOR_MAX_REGISTERS 65536
 #define CUDA_MULTIPROCESSOR_MAX_BLOCKS 32
 #define CUDA_BLOCK_MAX_THREADS 1024</pre>
and reemerge blender.

=== gcc 4.9 === 
If you use gcc 4.9, cuda may not work, complaining that it does not support 
gcc-4.9 and higher. However, gcc 4.9 happily works
after a simple dirty hack: in a file /opt/cuda/include/host_config.h
<pre>...
#if defined(__GNUC__)                                                                                                               
                                                                                                                                    
#if __GNUC__ > 4 || (__GNUC__ == 4 && __GNUC_MINOR__ > 8)                                                                           
                                                                                                                                    
#error -- unsupported GNU version! gcc 4.9 and up are not supported!                                                                
                                                                                                                                    
#endif /* __GNUC__> 4 || (__GNUC__ == 4 && __GNUC_MINOR__ > 8) */
...</pre>
replace "8" with "9".

== Other related pages ==
* [[SpaceNavigator]]    
* [[OpenCL]]
* {{package|media-gfx/blender}}
