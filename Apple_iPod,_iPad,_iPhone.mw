[[Category:Hardware]]
This is a placeholder for a more comprehensive article on how to manage an Apple device on a Gentoo system. 
The goal is to mount the iPod/iPhone/iPad somewhere so that it can be interfaced with by other tools, such as {{Package|app-pda/gtkpod}} or {{Package|media-sound/banshee}} or others.

= The idevice Software Stack =
[[File:iphonelinux-stack-2011.png]]

= Pairing = 
Pairing functionality is provided by {{Package|app-pda/libimobiledevice}}. Emerge it, then test it by running: 
{{RootCmd|idevice_id}}
This should print the device serial number which appeared in your dmesg log.

If this has been successful, run:
{{RootCmd|ideviceinfo}}
to verify that communications with the device are functioning correctly. 

Now run: 
{{RootCmd|idevicepair pair}}
to pair with the device. Check this with:
{{RootCmd|idevicepair validate}}

== Troubleshooting == 

=== QueryType failed, error code -256 ===
This error either appears on its own or followed by failed XML parsing, such as: 
{{TODO| Get the Newlines working here}}
{{MessageBox|Output|<nowiki>
QueryType failed, error code -256 ; 
Entity: line 1: parser error : Start tag expected, '<' not found ;
��w���w�8�H	8�H	.0" encoding="UTF-8"?> ;
^</nowiki>}}

In 2011-11, this was due to an Apple update, and git versions of {{Package|app-pda/libimobiledevice}} and {{Package|app-pda/ifuse}} were needed.

= Mounting = 
{{Package|app-pda/libimobiledevice}} is supported by {{Package|gnome-base/gvfs}}, so if you use Gnome, it's easy for you. If not,you will need {{Package|app-pda/ifuse}}

== {{Package|gnome-base/gvfs}} ==
Simply emerge gvfs with USE="ios", and it should auto-mount it for you. 
{{TODO|Does this require a log-out / log-in? Can gvfs be restarted some other way?}}

== {{Package|app-pda/ifuse}} ==
First, emerge ifuse, then try running it: 
{{RootCmd|emerge -av ifuse}}
{{RootCmd|ifuse /media/iphone}}

If the preceding steps worked, this should be enough to mount the device. This can be automated using udev and whatnot (see udev documentation for this). 

=== ifuse Troubleshooting === 

==== GnuTLS Error: A TLS packet with unexpected length was received ====
{{RootCmd|ifuse /media/iphone}}
{{MessageBox|Output|AES-128 test encryption failed. 
GnuTLS error: A TLS packet with unexpected length was received.}}

In 2010, this could be solved by re-merging {{Package|net-libs/gnutls}} and {{Package|dev-libs/libgcrypt}}. [http://forums.gentoo.org/viewtopic-t-783245.html Forum Thread].

= References = 
*[http://marcansoft.com/blog/2009/10/iphone-syncing-on-linux-part-2/ Marcan's Blog]
*[http://en.gentoo-wiki.com/wiki/Hfsplus HFS+ on Unofficial Gentoo Wiki]
*[http://www.hackint0sh.org/f128/62343.htm unl0cker's Hackintosh Post]
