<languages />
{{InfoBox stack
|{{InfoBox project|Overlays|header=true}}
}}

<div class="mw-translate-fuzzy">
Un "dépôt ebuild", également appelé "overlay" est [[Article description::une structure arborescente composée de répertoires et de fichiers, utilisée pour enrichir la liste des logiciels disponibles dans le gestionnaire de paquets du système]]. Ces dépôts sont également utilisés par les développeurs de Gentoo pour prototyper, en attendant la création de nouveaux ebuilds. Un tel dépôt peut contenir des ebuilds pour un ou plusieurs [[EAPI]]s.
</div>

<div class="mw-translate-fuzzy">
Au cœur de Gentoo, les utilisateurs disposent déjà d'un dépôt des paquets ''principal'', appelé ''arbre de Portage''. Ce dépôt principal contient tous les paquets logiciels (encore nommés [[Ebuild|ebuilds]]) qui sont maintenus par les développeurs de Gentoo. Les utilisateurs peuvent cependant disposer de dépôts qui, en s'y ajoutant,  constitue une alternative  à l'arbre de Portage d'où leur nom d'arbres alternatifs.
</div>

== Traitement des arbres alternatifs ==

Un arbre alternative n'est ni plus ni moins qu'un [[Repository format|ensemble de fichiers]] (ebuilds, fichiers de métadonnées principalement). Ils peuvent-être récupérés depuis des dépôts publics ([[Project:Portage/Sync#Portage_configuration|git, CVS, SVN ...]]) ou-bien téléchargés en tant qu'archives, et décompressés manuellement sur le système. Il est cependant recommandé d'utiliser les dépôts gérés par des tiers [https://repos.gentoo.org|de confiance], puisqu'installer un nouvel arbre alternatif aura comme incidence que Portage consultera cette nouvelle source avant de décider quel logiciel installer. En cas de compromission du dépot, des packets compromis pourraient alors se retrouver installés sur le système.

The now default approach for handling repositories is through {{Path|[[:/etc/portage/repos.conf]]}} which, like many other Portage related locations, can be a directory as well.

Repository definitions inside {{Path|/etc/portage/repos.conf/}} also inform Portage if and how the repository can be updated. With it, calling {{c|emerge --sync}} will automatically update the repositories as well.

A deprecated, yet still supported method is to use the <var>PORTDIR_OVERLAY</var> variable inside {{Path|/etc/portage/make.conf}}. This variable can point to one or more additional locations on the file system where repositories are available. The use of the {{Path|[[:/etc/portage/repos.conf]]/}} directory is highly preferred.

For more information, see [[:/etc/portage/repos.conf|/etc/portage/repos.conf]] and the [[Project:Portage/Sync#Operation|Portage/Sync article]].

=== Priorités des arbres alternatifs ===

<div class="mw-translate-fuzzy">
Chacun des arbres alternatifs dispose d'une priorité unique. Ceci fait que, dans le cas où une version spécifique serait trouvée dans plusieurs arbres alternatifs, la résolutions est non ambigüe. Les ''ebuilds'' des arbres alternatifs à la plus haute priorité sont prioritaires par rapport à ceux trouvés dans des arbres de priorité moindre.
</div>

La commande suivante fournit la liste des arbres alternatifs avec leur priorité :

{{Cmd|emerge --info --verbose}}

{{Cmd|portageq repos_config /}}

<div class="mw-translate-fuzzy">
Sauf si la variable  <code>PORTDIR_OVERLAY</code> a été modifiée de la manière décrite [[#Setting overlay priorities|plus bas]], l'arbre de Portage par défaut a une priorité de  -1000. Ceci signifie que tous les autres arbres alternatifs sont prioritaires par rapport à lui. Il s'agit du comportement par défaut, parce que les arbres alternatifs sont conçus, pour se situer au dessus de l'arbre de Portage.
</div>

== Logiciels disponibles ==

Il existe de nombreux outils pour supporter les arbres alternatifs.

=== Layman ===

The {{c|layman}} application makes it easier to manage and update multiple additional ebuild repositories. It is a command-line application through which publicly available ebuild repositories can be listed, subscribed to and unsubscribed from, as well as update those repositories. 

It supports both the {{Path|[[Layman#make.conf_method_.28force_old_method.29|make.conf]]}} as well as {{Path|[[Layman#repos.conf_method_.28default.29|repos.conf]]}} method.
* When using the {{Path|[[Layman#make.conf_method_.28force_old_method.29|make.conf]]}} method, {{c|layman}} manages a dedicated configuration file which should be sourced in by {{Path|make.conf}}
* When using {{Path|[[Layman#repos.conf_method_.28default.29|repos.conf]]}}, {{c|layman}} manages the {{Path|[[Layman#repos.conf_method_.28default.29|/etc/portage/repos.conf/layman.conf]]}} file directly

Pour faciliter la gestions d'arbres alternatifs multiples, un outil appelé [[Layman|layman]] a été développé. Cet outil est informé des arbres alternatifs populaires gérés par des utilisateurs et des développeurs et est capable de les installer et de les synchroniser tout autant que de les ajouter aux emplacements déclarés dans  <code>PORTDIR_OVERLAY</code>.

=== emaint ===

See the [[Project:Portage/Sync#Operation|Sync (Portage project)]] article and {{c|man 1 emaint}}.

=== Intégration dans eix ===

{{c|eix-sync}} is a wrapper starting {{c|emerge --sync}} (which in turn starts {{c|emaint sync --auto}}) followed by {{c|eix-update}}.  For further details see the [[Eix]] article and {{c|man 1 eix}}.

=== eselect-repository ===

{{c|eselect repository}} maintains {{Path|/etc/portage/repos.conf}} entries for Portage to access and synchronize.  See [[Eselect/Repository]] article for details.

== Usage ==

=== Emerging a duplicate package ===

When working with ebuild repositories it is possible to encounter a situation where multiple versions of the same package are available from different ebuild repositories. Instruct [[Portage]] to install a specific package from a specific ebuild repository with the <code>::</code> notation:

{{Emerge|category/atom::repository-name}}

The same notation can be used for different emerge instructions, including uninstalling a package through <code>--depclean</code>.

== Bonnes pratiques ==

=== Génération du cache ===

Lorsque de grands arbres alternatifs sont installés, Portage peut mettre un temps très long pour réaliser des opérations telles que la résolution des dépendances. Ceci est dû au fait, qu'en général, les arbres alternatifs ne possèdent pas de cache des méta-données.

Vous pouvez générer un cache de méta-données local en exécutant la commande <code>emerge --regen</code> après synchronisation de vos arbres alternatifs.

{{RootCmd|layman -S
|emerge --regen}}

Soyez vigilants: la commande {{c|emerge --regen}} prend beaucoup de temps, et n'est pas recommandée pour les utilisateurs de rsync; puisque rsync met à jour les caches en utilisant ceux des serveurs (et la plupart des utilisateurs de portage sont utilisateurs de rsync). Si vous utilisez rsync, utilisez simplement {{c|emerge --sync}} (ou {{c|eix-sync}}) pour reconstruire le cache. Normalement, seul les utilisateurs de très gros dépôts alternatifs devraient utiliser {{c|emerge --regen}}.

<div class="mw-translate-fuzzy">
=== Utilisation d'arbres alternatifs non sûrs ===
</div>

<div class="mw-translate-fuzzy">
Lorsque vous utilisez des arbres alternatifs importants ou des arbres dont la qualité est soit faible, soit inconnue, il est recommandé de masquer en dur tout l'arbre alternatif.
</div>

{{FileBox|filename=/etc/portage/package.mask|title=Masquer tous les paquets d'un arbre alternatif|1=
*/*::overlay-name
}}

Après cela, il ne vous reste plus qu'à démasquer les paquets que vous voulez installer.

{{FileBox|filename=/etc/portage/package.unmask|title=Démasquer un paquet donné dans un arbre alternatif|lang=bash|1=
foo/bar::overlay-name
}}

== See also ==

* [[Project:Overlays|Overlays project]] - The official Gentoo project for ebuild repositories' support.
* [[Project:Overlays/Overlays guide|Overlays guide (Overlay project)]] - A user guide written by the Overlay project.
* [[Project:Overlays/Old Dev Guide|Developer's guide to Gentoo overlays]] - This document is kept only for historical purposes. The current guide is maintained as [[Project:Overlays/Overlays guide]].
* [[Handbook:Parts/Portage/CustomTree#Defining_a_custom_repository|Defining a custom repository]] - Section in the Gentoo Handbook

== External resources ==

* https://repos.gentoo.org
* https://github.com/gentoo/
* https://gpo.zugaina.org/Overlays


[[Category:Portage]]
