{{InfoBox stack
|{{InfoBox homepage|https://www3.lenovo.com/us/en/laptops/thinkpad/thinkpad-x/Thinkpad-X1-Yoga-2nd-Generation/p/22TP2TXX12Y|header=true}}
}}

== Hardware ==

{{RootCmd|lspci -nn|output=<pre>
00:00.0 Host bridge [0600]: Intel Corporation Xeon E3-1200 v6/7th Gen Core Processor Host Bridge/DRAM Registers [8086:5904] (rev 02)
00:02.0 VGA compatible controller [0300]: Intel Corporation HD Graphics 620 [8086:5916] (rev 02) => i915
00:08.0 System peripheral [0880]: Intel Corporation Xeon E3-1200 v5/v6 / E3-1500 v5 / 6th/7th Gen Core Processor Gaussian Mixture Model [8086:1911]
00:13.0 Non-VGA unclassified device [0000]: Intel Corporation Sunrise Point-LP Integrated Sensor Hub [8086:9d35] (rev 21) => intel_ish_ipc
00:14.0 USB controller [0c03]: Intel Corporation Sunrise Point-LP USB 3.0 xHCI Controller [8086:9d2f] (rev 21) => xhci_hcd
00:14.2 Signal processing controller [1180]: Intel Corporation Sunrise Point-LP Thermal subsystem [8086:9d31] (rev 21)
00:15.0 Signal processing controller [1180]: Intel Corporation Sunrise Point-LP Serial IO I2C Controller #0 [8086:9d60] (rev 21)
00:16.0 Communication controller [0780]: Intel Corporation Sunrise Point-LP CSME HECI #1 [8086:9d3a] (rev 21) => mei_me
00:1c.0 PCI bridge [0604]: Intel Corporation Sunrise Point-LP PCI Express Root Port #1 [8086:9d10] (rev f1) => pcieport
00:1c.2 PCI bridge [0604]: Intel Corporation Sunrise Point-LP PCI Express Root Port #3 [8086:9d12] (rev f1) => pcieport
00:1c.4 PCI bridge [0604]: Intel Corporation Sunrise Point-LP PCI Express Root Port #5 [8086:9d14] (rev f1) => pcieport
00:1d.0 PCI bridge [0604]: Intel Corporation Sunrise Point-LP PCI Express Root Port #9 [8086:9d18] (rev f1) => pcieport
00:1f.0 ISA bridge [0601]: Intel Corporation Device [8086:9d4e] (rev 21)
00:1f.2 Memory controller [0580]: Intel Corporation Sunrise Point-LP PMC [8086:9d21] (rev 21)
00:1f.3 Audio device [0403]: Intel Corporation Sunrise Point-LP HD Audio [8086:9d71] (rev 21) => snd_hda_intel
00:1f.4 SMBus [0c05]: Intel Corporation Sunrise Point-LP SMBus [8086:9d23] (rev 21) => i801_smbus
00:1f.6 Ethernet controller [0200]: Intel Corporation Ethernet Connection (4) I219-LM [8086:15d7] (rev 21) => e1000e
02:00.0 Unassigned class [ff00]: Realtek Semiconductor Co., Ltd. RTS525A PCI Express Card Reader [10ec:525a] (rev 01) => rtsx_pci
04:00.0 Network controller [0280]: Intel Corporation Wireless 8265 / 8275 [8086:24fd] (rev 88) => iwlwifi
05:00.0 Non-Volatile memory controller [0108]: Lenovo Device [17aa:0004] => nvme</pre>}}

{{RootCmd|lsusb|output=<pre>
Bus 002 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub
Bus 001 Device 004: ID 138a:0097 Validity Sensors, Inc.
Bus 001 Device 003: ID 04f2:b5ce Chicony Electronics Co., Ltd
Bus 001 Device 002: ID 8087:0a2b Intel Corp.
Bus 001 Device 005: ID 056a:50b8 Wacom Co., Ltd
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub</pre>}}

=== Standard ===

{| class="table table-condensed table-striped" style="width: auto;"
! scope="col" width="20%" | Device
! scope="col" width="25%" | Make/model
! scope="col" width="10%" | Status
! scope="col" width="10%" | Vendor ID / Product ID
! scope="col" width="10%" | Kernel driver(s)
! scope="col" width="15%" | Kernel version
! scope="col" width="10%" | Notes
|-
| VGA compatible controller
| Intel Corporation HD Graphics 620
| {{Yes|Works}}
| —
| i915
| 4.15.7
| —
|-
| Ethernet network controller
| Intel Corporation Ethernet Connection (4) I219-LM (rev 21)
| {{Yes|Works}}
| 8086:15d7
| e1000e
| 4.12.12-gentoo
| —
|-
| Wireless network controller
| Intel Corporation Wireless 8265 / 8275 (rev 88)
| {{Yes|Works}}
| 8086:24fd
| [[iwlwifi]]
| 4.12.12-gentoo
| —
|-
| Bluetooth
| Intel Corporation Wireless
| {{Yes|Works}}
| 8087:0a2b
| btusb
| 4.12.12-gentoo
| —
|-
| Touchscreen
| Wacom Serial Pen and Multitouch Sensor
| {{Yes|Works}}
| 056a:50b8
| usbhid
| 4.12.12-gentoo
| —
|-
| Card Reader
| Realtek RTS525A PCI Express Card Reader
| {{Yes|Works}}
| 10ec:525a
| rtsx_pci
| 4.12.12-gentoo
| —
|-
| Audio device
| Intel Corporation Sunrise Point-LP HD Audio
| {{Yes|Works}}
| —
| snd_hda_intel
| 4.15.7
| —
|-
| Integrated Webcam
| Chicony Electronics Co.,Ltd. Webcam
| {{Yes|Works}}
| 04f2:b5ce
| uvcvideo
| 4.15.7
| —
|-
| Thunderbolt
| Intel Corporation JHL6540 Thunderbolt 3 NHI
| {{Yes|Works}}
| 2222:1111
| thunderbolt
| 4.15.7
| —
|-
| NVME Disk
| Lenovo Device
| {{Yes|Works}}
| —
| [[NVMe|nvme]]
| 4.15.7
| —
|-
| Fingerprint reader
| Validity Sensors, Inc. Fingerprint Sensor
| {{Partial|Not tested}}
| 138a:0097
| —
| 4.12.12-gentoo
| —
|-
| WWAN & GPS
| Sierra Wireless EM7455 Qualcomm Snapdragon X7 LTE-A
| {{Yes|Works}}
| 1199:9079
| cdc_mbim
| —
| 4.15.9
|-
| NFC
| ?
| {{No|Not discovered}}
| —
| —
| —
| likely a i2c device
|-
| Thunderbolt 3 Dock Ethernet
| Realtek RTL8152 USB Ethernet Adapter
| {{Yes|Works}}
| 17ef:3069
| r8152
| 4.15.7
| —
|-
|}

=== Accessories ===

{| class="table table-condensed table-striped" style="width: auto;"
! scope="col" width="15%" | Device
! scope="col" width="20%" | Make/model
! scope="col" width="10%" | Status
! scope="col" width="10%" | Vendor ID / Product ID
! scope="col" width="10%" | Kernel driver(s)
! scope="col" width="15%" | Kernel version
! scope="col" width="20%" | Notes
|-
| Dock
| ThinkPad Thunderbolt Dock
| {{Yes|Works}}
| -
| -
| -
| -
|}

== Installation ==
Apply the additional lines below to the make.conf file of Portage.

{{Note|To get up-to-date CPU_FLAGS_X86, discover the flags for your CPU with <code>cpuid2cpuflags</code>!}}

{{FileBox|filename=/etc/portage/make.conf|1=
# for i7-7600U
CPU_FLAGS_X86="aes avx avx2 fma3 mmx mmxext pclmul popcnt sse sse2 sse3 sse4_1 sse4_2 ssse3"

# for i5-7300U
CPU_FLAGS_X86="aes avx avx2 f16c fma3 mmx mmxext pclmul popcnt sse sse2 sse3 sse4_1 sse4_2 ssse3"

INPUT_DEVICES="libinput wacom"
VIDEO_CARDS="intel i965"
GRUB_PLATFORMS="efi-64"
}}
Then you should update the world to recompile all installed packages with the new flags.
{{RootCmd|emerge --ask --changed-use --deep @world}}

=== Firmware ===
Install the package {{Package|sys-kernel/linux-firmware}} which contains the wifi device driver.
{{Emerge|sys-kernel/linux-firmware}}

=== Kernel ===

{{KernelBox|title=NVME SSD|1=
Device Drivers  --->
   <*>  NVM Express block device
}}

{{KernelBox|title=ACPI|1=
Generic Driver Options  --->
   [*] X86 Platform Specific Device Drivers  --->
      <*>   ThinkPad ACPI Laptop Extras
      [*]     Console audio control ALSA interface
      [ ]     Maintainer debug facilities
      [ ]     Verbose debug mode
      [ ]     Allow control of important LEDs (unsafe)
      [*]     Video output control support
      [*]     Support NVRAM polling for hot keys
}}

{{KernelBox|title=Ethernet controller|1=
Generic Driver Options  --->
   [*] Network device support  ---
      [*]   Ethernet driver support  --->
         [*]   Intel devices
         <*>     Intel(R) PRO/1000 PCI-Express Gigabit Ethernet support
}}


Building the following device driver as module may be appropriate as it requires firmware during initialization.
{{KernelBox|title=Wireless network controller|1=
Generic Driver Options  --->
   [*] Network device support  ---
      [*]   Wireless LAN  --->
         [*]   Intel devices
         <M>     Intel Wireless WiFi Next Gen AGN - Wireless-N/Advanced-N/Ultimate-N (iwlwifi)
         <M>       Intel Wireless WiFi MVM Firmware support
}}

{{KernelBox|title=Audio device|1=
Generic Driver Options  --->
   <*> Sound card support  --->
      <*>   Advanced Linux Sound Architecture  --->
         [*]   PCI sound devices  --->
               HD-Audio  --->
                  <*> HD Audio PCI
                  <*> Build Conexant HD-audio codec support
}}

{{KernelBox|title=Bluetooth|1=
-*- Networking support  --->
   <*>   Bluetooth subsystem support  --->
            Bluetooth device drivers  --->
               <*> HCI USB driver
               [*]   Broadcom protocol support
}}

{{KernelBox|title=Touchscreen|1=
No special options needed.
}}

{{KernelBox|title=USB 3.0 & USB-C|1=
USB_PCI=y
USB_OTG=y
USB_XHCI_HCD=y
USB_STORAGE=y
TYPEC=y
TYPEC_UCSI=y
}}

{{KernelBox|title=PCIe Card reader|1=
MISC_RTSX_PCI=y
MMC_REALTEK_PCI=y
MMC_SDHCI=y
}}

{{KernelBox|title=Integrated Sensor Hub|1=
INTEL_ISH_HID=y
}}

{{KernelBox|title=Thunderbolt Dock|1=
THUNDERBOLT=y
THUNDERBOLT_NET=y
HOTPLUG_PCI_PCIE=y
HOTPLUG_PCI=y
HOTPLUG_PCI_ACPI=y
USB_USBNET=y         # dock's network card
USB_NET_CDCETHER=y   # "
USB_RTL8152=y        # "
SND_USB_AUDIO=y      # dock's usb-audio
}}

=== Emerge ===

Fingerprint reader is recognized by the following library.
{{Emerge|sys-auth/libfprint}}

== Configuration ==

(Explain any additional configuration or special customization for this hardware platform. Could be anything from BIOS settings to assigning proper media key functionality.)

=== Finger/Pen Input ===

For [[X11]] to work with finger/pen input, pull in {{Package|x11-drivers/xf86-input-wacom}} by inserting <code>wacom</code> argument into the indicated variable in the file shown below and run the following command for the configuration to emerge.
{{FileBox|filename=/etc/portage/make.conf|1=
INPUT_DEVICES="... wacom"
}}
{{RootCmd|emerge --ask --deep --newuse @world}}

=== Trackpoint scrolling ===
Add the following Xorg configuration file so that the driver is selected for the devices we want.

{{FileBox|filename=/etc/X11/xorg.conf.d/90-libinput.conf|lang=xorg.conf|1=
Section "InputClass"
        Identifier "libinput pointer catchall"
        MatchIsPointer "on"
        MatchDevicePath "/dev/input/event*"
        Driver "libinput"
EndSection

Section "InputClass"
        Identifier "libinput touchpad catchall"
        MatchIsTouchpad "on"
        MatchDevicePath "/dev/input/event*"
        Driver "libinput"
EndSection
}}
After a reboot/xorg-server restart, trackpoint scrolling should work.

=== Hotkeys ===
Most of the hotkeys are available and can be configured by an X hotkey daemon like {{Package|sxhkd}}. 
{{Note|The Audio example functions only work if using [[PulseAudio]].}}

{| class="table table-condensed table-striped" style="width: auto;"
! scope="col" width="10%" | Function key
! scope="col" width="20%" | Function name
! scope="col" width="15%" | Macro
! scope="col" width="30%" | Example function
! scope="col" width="25%" | Notes
|-
| F1
| Mute audio
| XF86AudioMute
| pactl set-sink-mute 0 toggle
| The LED works as well.
|-
| F2, F3
| Volume -/+
| XF86AudioLowerVolume, XF86AudioRaiseVolume
| pactl set-sink-volume 0 -/+5%
| —
|-
| F4
| Mute microphone
| XF86AudioMicMute
| pactl set-source-mute 1 toggle
| The LED works as well.
|-
| F5, F6
| Brightness -/+
| XF86MonBrightnessDown, XF86MonBrightnessUp
| xbacklight -dec 5 / xbacklight -inc 5
| —
|-
| F7
| Recognize Monitors
| XF86Display
| xrandr --output HDMI1 --auto --below eDP1
| —
|-
| F8
| Enable/Disable Wifi
| XF86WLAN
| —
| Works without any additional config.
|-
| F9
| Settings / Tools
| XF86Tools
| —
| —
|-
| F10
| Enable/Disable Bluetooth
| XF86Bluetooth
| —
| Works without any additional config.
|-
| F11
| Switch Keyboard layout
| {{No|Not working}}
| —
| —
|-
| F12
| Set Bookmark
| {{No|Not Working}}
| —
| —
|-
|}

== Updates ==

=== fwupd ===

Firmware of the X1 Yoga 2nd can be updated with [[fwupd]]:
https://fwupd.org/lvfs/device/9ca89fa5-ce05-47ac-bdf3-5b0b6f21d07a

You need to build [[fwupd]] with the <code>uefi</code> useflag (and boot with UEFI).

=== BIOS/UEFI ===

You can use [[#fwupd|fwupd]] to update the BIOS and other firmware.
As an alternative, you can update the X1 Yoga BIOS/UEFI from Linux with an '''USB drive'''.

* [https://pcsupport.lenovo.com/de/en/products/LAPTOPS-AND-NETBOOKS/THINKPAD-X-SERIES-LAPTOPS/THINKPAD-X1-YOGA-TYPE-20JD-20JE-20JF-20JG/downloads/DS121064 Download the .iso]
* Extract the bootable image with {{Package|app-cdr/geteltorito}}
{{Cmd|geteltorito -o image.bin downloaded.iso}}
* Flash the raw image to USB drive, make sure it's the right device...
{{RootCmd|dd if{{=}}image.bin of{{=}}/dev/sdx}}
* Boot from the USB drive and install the update

=== Thunderbolt Firmware ===

You can update the Lenovo Thunderbolt Firmware right from Linux very easily!

* [https://pcsupport.lenovo.com/de/en/products/laptops-and-netbooks/thinkpad-x-series-laptops/thinkpad-x1-yoga-type-20jd-20je-20jf-20jg/downloads/ds121630 Download the installation .exe]
* Run this program with [[Wine]] to extract its components, relevant is <code>TBT.bin</code>

View the current firmware version:
{{RootCmd|cat /sys/bus/thunderbolt/devices/0-0/nvm_version|output=<pre>
15.0</pre>}}

Upload the update:
{{RootCmd|dd if{{=}}/tmp/Thunderbolt/TBT.bin of{{=}}/sys/bus/thunderbolt/devices/0-0/nvm_non_active0/nvmem|output=<pre>
496+0 records in
496+0 records out
253952 bytes (254 kB, 248 KiB) copied, 0.00235085 s, 108 MB/s</pre>}}

Trigger the update:
{{RootCmd|echo 1 > /sys/bus/thunderbolt/devices/0-0/nvm_authenticate|output=<pre></pre>}}

The screen may flicker and hang, just wait a bit (<20s). Now you should have a newer version!

{{RootCmd|cat /sys/bus/thunderbolt/devices/0-0/nvm_version|output=<pre>
27.0</pre>}}


=== Thunderbolt Dock Firmware ===

From Linux, you can update the firmware of the USB-C Dock itself with [[Wine]]!

* [https://pcsupport.lenovo.com/de/en/products/LAPTOPS-AND-NETBOOKS/THINKPAD-X-SERIES-LAPTOPS/THINKPAD-X1-YOGA-TYPE-20JD-20JE-20JF-20JG/downloads/DS501903 Download the windows .exe]
* Run it with [[Wine]] and click the '''Check current FW''' and '''Update FW''' buttons.

{{Cmd|wine thinkpad_usb_c_dock_firmware.exe|output=<pre>

              ThinkPad USB-C Dock FW Utility v3.7
   Package including(BB:0.1.0.23 HX3:1.14.7.183 DK:1.3.40 DP:3.12.005)
======================================================================== 
Update date:Sat 04/22/2017 
Update time:02:36 PM

Checking current Dock FW version  
BillBoard Version: 0.1.0.23 
Hx3 Version: 1.14.7.183 
CCG4 Version: 1.3.40 
DP Hub FW: 3.12.005

Current Dock FW is newer, no need to update.
</pre>}}

[[Category:Laptops]]
