<languages />
{{Metadata|abstract=udev est le gestionnaire de périphériques pour le noyau Linux. Il administre les nœuds de périphériques dans /dev et prend en charge toutes les actions de l'espace utilisateur lors de l'ajout ou de la suppression de périphériques. }}

{{Lowercase title}}
{{InfoBox stack
|{{InfoBox homepage|https://www.freedesktop.org/wiki/Software/systemd/|header=true}}
|{{InfoBox wikipedia}}
|{{InfoBox gitweb|https://cgit.freedesktop.org/systemd/systemd/tree/src/udev|raw=true}}
|{{InfoBox project|Udev}}
}}

'''udev''' est le gestionnaire de périphériques pour le noyau de Linux. Il gère les nœuds de périphériques dans {{Path|/dev}} et prend en charge toutes les actions dans l'espace utilisateur lors de l'ajout ou de la suppression de périphériques. Les lecteurs de cet article devraient également lire [[Project:Eudev|eudev]], une dérivation de udev.

== Qu'est-ce que udev? ==

=== Le répertoire /dev  ===

{{:/dev/fr}}

== Installation ==

{{Important| Avant faire une mise à jour, consulter le [[Udev/Upgrade_Guide|guide de mise à jour de udev (Anglais)]] pour plus d'information afin d'éviter de se retrouver avec un système qui ne démarre plus.}}

=== Noyau ===

{{c|udev}} nécessite les options suivantes dans le noyau :

<!-- See https://git.kernel.org/?p=linux/hotplug/udev.git;a=blob_plain;f=README -->
{{KernelBox|1=
General setup  --->
    [*] Configure standard kernel features (expert users)  --->
        [ ] Enable deprecated sysfs features to support old userspace tools
        [*] Enable signalfd() system call
Enable the block layer  --->
    [*] Block layer SG support v4
Networking support  --->
    Networking options  --->
        <*> Unix domain sockets
Device Drivers  --->
    Generic Driver Options  --->
        ()  path to uevent helper
        [*] Maintain a devtmpfs filesystem to mount at /dev
    < > ATA/ATAPI/MFM/RLL support (DEPRECATED)  --->
File systems  --->
    [*] Inotify support for userspace
    Pseudo filesystems --->
        [*] /proc file system support
        [*] sysfs file system support
}}

=== Options de la variable USE ===

Portage connaît l'option globale de la variable USE <code>udev</code> pour activer la prise en charge de udev dans les autres paquets. Activer cette option de la variable USE (par défaut dans tous les [[Profile (Portage)|profiles]] Linux) provoquera l'installation du paquet {{Package|sys-fs/udev}} automatiquement.

{{FileBox|filename=/etc/portage/make.conf|lang=bash|1=
USE="udev"
}}

{{USEflag|package=sys-fs/udev}}

=== Emerge ===

Après avoir défini les options de la variable USE, mettre à jour le système  pour que les changements prennent effet :

{{Emerge|params+=--changed-use --deep|@world}}

== Configuration ==

=== Service ===

Pour démarrer udev au démarrage de la machine, l'ajouter au niveau d'exécution sysinit. Pour cela, exécuter la commande suivant en tant que root :

{{RootCmd|rc-update add udev sysinit}}

== Configuration avancée ==

=== Règles ===

udev fournit un jeu de règles qui correspondent aux valeurs exportées des uevents (événements provoqués par le noyau) et aux propriétés du périphérique découvert. Possiblement, une règle ayant une correspondance nommera et créera un nœud de périphérique et exécutera des programmes configurés pour installer et configurer le périphérique.

Les définitions des règles sont stockées à deux emplacements :

# '''{{Path|/lib/udev/rules.d/}}''' - Les règles dans ce répertoire sont installées par certains paquets, elles ne doivent en général pas être modifiées par les utilisateurs;
# '''{{Path|/etc/udev/rules.d/}}''' - Ce répertoire est pour les règles définies par les utilisateurs. Chaque nouvelle règle doit être ajoutée dans ce répertoire;;

Dans ces répertoires, de multiples fichiers de règles (avec le suffix {{Path|.rules}}) sont lus dans l'ordre alphabétique. Dans ces fichiers, udev trouvera des expressions qui peuvent correspondre à un événement uevent avec l'état correspondant (est-ce que l’événement correspond à un ajout ou une suppression de périphérique) et la commande à exécuter.

La mise en correspondance de l'événement se base sur des informations telles que :

* Le ''SOUS-SYSTÈME'' de l'uevent (pour quel type de périphérique l'événement est-il provoqué);
* L'''ACTION'' qui a lieu (ajout, changement, ou retrait);
* Un ou plusieurs attributs (via ''ATTR'' ou ''ATTRS''), tels que la classe du périphérique, le vendeur ou tout autre information du périphérique;
* Le nom fournit par le noyau (via ''KERNEL'') tel que sd* (pour les disques SCSI/ATA) ou input* (pour les périphériques d'entrée comme les souris et les claviers);
* Un ou plusieurs paramètres d'environnement (via ''ENV''), utilisés pour envoyer des informations partagées par de multiples règles

En se basant sur ces informations, la règle peut alors décider si :

# Quelques informations doivent être partagées avec des événements ultérieurs (à travers des variables d'environnement) 
# Des liens doivent être créés dans {{Path|/dev}}
# Des commandes doivent être exécutées

udev accomplit cela pour toutes les règles qui correspondent (il ne cesse donc pas après la première correspondance) pour permettre une approche flexible de la gestion des périphériques.

=== Noms de périphérique persistants ===

Le noyau détecte les périphériques de manière asynchrone, udev reflète le système de fichiers [[sysfs]] et donc les périphériques sont nommés et numérotés selon leur ordre de détection. Ainsi par défaut, udev ne fournit pas de noms persistants. Néanmoins, il existe un mécanisme pour quelques classes de périphériques pour assurer cette fonctionnalité :

* Udev crée, pour les périphériques de stockage, des liens symboliques additionnels en se basant sur l'ID du périphérique, son [[Removable_media#UUIDs_and_labels|étiquette, UUID]] et son chemin. Voir le répertoire {{Path|/dev/disk/by-*}}. Ainsi, au lieu d'utiliser, par exemple, le fichier de périphérique {{Path|/dev/sda}}, utiliser le fichier   {{Path|/dev/disk/by-label/SOME_LABEL}}.

* C'est la même chose pour les périphériques d'entrée dans le répertoire {{Path|/dev/input}}.

* En utilisant des règles personnalisées, l'utilisateur peut créer son propre fichier de périphérique.

== Utilisation ==

Quelques commandes utiles :

* Affiche tous les messages concernant un fichier de périphérique donné :
: {{RootCmd|udevadm info --query{{=}}all --name{{=}}/dev/DEVICE_FILE}}

* Surveiller les activités de udev :
: {{RootCmd|udevadm monitor}}

* Assigner un nom persistant à un périphérique ethernet:
: {{FileBox|filename=/etc/udev/rules.d/ethernet.rules|lang=bash|1=
SUBSYSTEM=="net", ACTION=="add", ATTR{address}=="01:23:45:67:89:ab", NAME="eth6789ab"
}}

Se reporter à la [[man page|page de manuel]] de ''udevadm'' pour plus d'information.

== Dépannage ==

* {{Bug|udev|search=package}}

=== Journaliser les messages de surveillance ===

Pour journaliser tous les messages quand la commande {{c|udevadm monitor}} est exécutée, modifier le fichier de configuration suivant :

{{FileBox|filename=/etc/conf.d/udev|lang=bash|1=
udev_monitor="YES"
}}

Cela créera le nouveau journal situé à {{Path|/run/udev/udevmonitor.log}}.

=== Mode de débogage ===

Activer le mode de debogage pour obtenir plus de messages journalisés :

{{FileBox|filename=/etc/conf.d/udev|lang=bash|1=
udev_debug="YES"
}}

Définir la priorité de journalisation :

{{FileBox|filename=/etc/udev/udev.conf|lang=bash|1=
udev_log="debug"
}}

Cela créera le nouveau journal {{Path|/run/udev/udevdebug.log}} mais aucun message n'y sera écrit. Les version les plus récentes de udev écrirons leurs messages dans {{c|dmesg}}.

=== Fichiers de périphériques manquants {{Path|/dev/null}} et {{Path|/dev/console}} ===

Quelques version de udev ont besoin des fichiers {{Path|/dev/null}} et {{Path|/dev/console}} pour fonctionner correctement, mais ne peuvent pas les créer elles-même. Pour créer ces fichiers manuellement pour udev, exécuter la commande suivant en tant que root :

{{RootCmd
|mkdir test
|mount --bind / test
|cd test/dev
|mknod -m 660 console c 5 1
|mknod -m 660 null c 1 3
|cd ../..
|umount test
|rmdir test
}}

=== NIC (Carte interface réseau) assignée eth0, mais a été déplacée en eth1 ===

Ceux qui ont des cartes à deux interfaces réseau sur leur carte mère peuvent se retrouver dans une situation où {{c|ifconfig}}  peut ne montrer ni eth0 ni eth1. {{c|dmesg}} peut montrer la carte interface réseau détectée comme eth0, et ensuite déplacée en eth1. Exécuter la commande {{c|ifconfig -a}}  montrerar aussi la carte réseau en tant que eth1. Ceci est dû au fait que les noms assignés par le noyau ont été utilisés en premier lieu. Les utilisateurs doivent écrire leurs propres règles comme {{Path|/etc/udev/rules.d/70-my-network.rules}} pour utiliser des noms libres comme lan0 ou wireless0, ou utiliser les noms d'interfaces prédictibles (qui ont été activés par défaut depuis la version 197 de udev).

Pensez aussi à retirer les anciens fichiers des versions antérieures de udev :

{{RootCmd|rm /etc/udev/rules.d/70-persistent-net.rules /etc/systemd/network/99-default.link}}

Also make sure not to pass <code>net.ifnames=0</code> on the kernel commandline. This setting would disable the predictable devname feature of udev altogether.

== Voir aussi ==

[[Eudev|eudev]] - Un fork de udev maintenu par Gentoo.

== Ressources externes ==

{{Bug|575718|text=Bug 575718 - Request for council decision regarding virtual/udev default provider}} - Default virtual/udev provider changed to sys-fs/eudev


[[Category:Core system]]
[[Category:Daemons]]
