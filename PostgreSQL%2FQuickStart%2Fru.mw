<languages />


{{Metadata|abstract=Это краткая инструкция к PostgreSQL. Она охватывает установку PostgreSQL и ее конфигурацию. Она является дополнением к официальной документации, но не заменяет ее.}}

Это краткая инструкция к PostgreSQL. Она охватывает установку PostgreSQL и ее конфигурацию. Она является дополнением к официальной документации, но не заменяет ее.

== Введение ==

=== Краткое описание PostgreSQL ===

[http://www.postgresql.org PostgreSQL] — это свободная система управления реляционными базами данных (RDBMS, или СУРБД) с открытым исходным кодом. Она поддерживает такие вещи как транзакции, схемы и внешние ключи, и часто позиционируется как более строго соответствующая стандартам SQL и более безопасная по умолчанию, чем любая другая база данных, коммерческая или нет. 

Посетите страницу [http://www.postgresql.org/about About] на postgresql.org для более подробной информации.

=== Что охватывает эта статья? ===

Эта статья проведет вас через специфичные для Gentoo шаги по установке СУРБД PostgreSQL. 

Ebuild-файл, охватываемый этой статьей: {{Package|dev-db/postgresql}}.

В этой статье предполагается, что вы будете устанавливать последнюю, стабильную версию PostgreSQL; на время написания, этой версией является 9.3.5. Исправьте команды в этой статье так, как это требуется для вашей определенной версии.

=== О ebuild-файлах ===

Файлы ebuild для PostgreSQL в системе Portage отличаются номерами слотов, основанными на главной версии. Это позволяет вам иметь две главных версии PostgreSQL действующих одновременно; библиотеки и сервера версий 9.0-9.4 могут устанавливаться и обслуживаться в одно и то же время. Это полезно в тех обстоятельствах, когда вам нужно перенести данные из старой базы данных в новую, или требуется иметь рабочую и тестовую базу данных на одной и той же машине. Также, это предотвращает перезаписывание баз данных, соответствующих библиотек или исполняемых файлов несовместимым обновлением. Это требует миграции, которая описана в данном руководстве. 

Вдобавок, исправления ошибок и уязвимостей безопасности, которые поставляются через обновления младших версий, могут применяться без страха повреждения базы данных или самой сборки PostgreSQL; 9.3.4 может обновляться до 9.3.5, так как гарантируется их совместимость и они не требуют от вас большего, чем установка и перезапуск серверного процесса. Ни миграция, ни повторная конфигурация, ни инициализация не являются необходимыми. 

За подробностями обратитесь к [http://www.postgresql.org/support/versioning PostgreSQL Versioning Policy] . 

=== Что эта статья не охватывает ===

Большая часть информации не будет описана. [http://www.postgresql.org/docs/ Официальная документация] содержит где-то 2000 страниц. Поэтому в этом кратком руководстве большинство подробностей будет пропущено. Будут описаны только проблемы, характерные для Gentoo, и некоторые основные рекомендации по конфигурации. 

== Установка ==

=== Устаревшие ebuild-файлы ===

Если у вас установлены какие-либо из следующих ebuild-файлов, то у вас устаревшая Gentoo-сборка PostgreSQL, и вы должны мигрировать сейчас: {{Package|dev-db/postgresql-libs}}, {{Package|dev-db/postgresql-client}}, {{Package|dev-db/libpq}} и {{Package|dev-db/postgresql}} версии старее 9.0.

The split ebuilds {{Package|dev-db/postgresql-docs}}, {{Package|dev-db/postgresql-base}}, and/or {{Package|dev-db/postgresql-server}} have been unified into a single package: {{Package|dev-db/postgresql}}. Nothing is required for you to move from the split ebuilds to the unified ebuild other than to emerge the unified ebuild.

Эта статья описывает миграцию со старых ebuild-файлов к новым. 

=== USE-флаги ===

{| class="wikitable" style="text-align: left;" 
|- 
! USE-флаг
! Значение
|- 
| doc
| Включить [http://www.postgresql.org/docs/ документацию онлайн] для хранения на Вашей системе
|- 
| kerberos
| Поддержка использования Kerberos для аутентификации.
|- 
| ldap
| Поддержка использования аутентификации LDAP и поиска параметра соединения (connection parameter lookup).
|- 
| nls
| Включить возможность отображения сообщений на языке, отличном от Английского. Используется в связке с переменной Portage LINGUAS.
|- 
| pam
| Поддержка использования Подключаемых Модулей Аутентификации (PAM) для аутентификации.
|- 
| perl
| Включение поддержки использования Perl для написания функций и триггеров.
|- 
| pg_legacytimestamp
| Использование более старого метода с плавающей запятой для форматирования временных меток вместо 64-битного целочисленного метода с высокой точностью. Если только вы не имели предыдующую сборку, которая использовала этот устаревший метод, оставьте этот USE-флаг отключенным. (См. заметку.)
|- 
| python
| Включение поддержки использования Python для написания функций и триггеров.
|- 
| readline
| Вы на самом деле хотите это включить. Отключение уберет редактирование в командной строке и историю в psql.
|- 
| selinux
| Установить подходящую политику безопасности SELinux. Это может быть включено только использованием профиля SELinux.
|- 
| ssl
| Включение поддержки SSL-соединений.
|- 
| tcl
| Включение поддержки использования Tcl для написания функций и триггеров.
|- 
| threads
| Сделать клиентские библиотеки потокобезопасными. Остальная часть системы должна быть также потокобезопасной.
|- 
| uuid
| Включение поддержки генерации 128-битного случайного уникального идентификатора. Это полезно для слияния баз данных вместе, чтобы вероятности коллизий стали чрезвычайно малы.
|- 
| xml
| Включение поддержки SQL/XML.
|- 
| zlib
| Поддержка сжатых архивов в pg_dump и pg_restore.
|-
|}

{{Note/ru|Переключение 'pg_legacytimestamp' потребует, чтобы вы сделали дамп и восстановление, если какие-нибудь из ваших баз данных используют временные метки (англ. timestamps). Два способа несовместимы друг с другом.}}

=== Начало установки ===

{{Emerge|dev-db/postgresql|output=<pre>
[ebuild N ] dev-db/postgresql-9.3.5 USE="doc -kerberos -ldap -pg_legacytimestamp
  nls perl python -pg_legacytimestamp (-selinux) readline ssl -tcl -threads
  -uuid -xml zlib" LINGUAS="-af -cs -de -es -fa -fr -hr -hu -it -ko -nb -pl
  -pt_BR -ro -ru -sk -sl -sv -tr -zh_CN -zh_TW" 0 kB
</pre>
}}

You may receive a notice regarding that any of the above packages are blocked by any or all of the following packages: {{Package|dev-db/postgresql-libs}}, {{Package|dev-db/postgresql-client}}, or {{Package|dev-db/libpq}}. These packages are '''not maintained''' and obsoleted. Refer to the section on migration from the previous ebuilds to the new ones to know how to handle this situation. 

=== Подготовка к инициализации кластера баз данных ===

Как только пакеты завершили установку, вы можете пожелать отредактировать {{Path|/etc/conf.d/postgresql-9.3}} . Существуют три строки, которые затрагивают значения сервера по умолчанию и '''не могут''' быть изменены позже без удаления каталога, который содержит кластер базы данных, и повторной инициализации. 

''PGDATA'' определяет где размещать файлы настроек. ''DATA_DIR'' определяет где создавать кластер базы данных и сопутствующие файлы. ''PG_INITDB_OPTS'' может хранить [http://www.postgresql.org/docs/current/static/app-initdb.html любые дополнительные параметры], которые вы можете пожелать установить. Установка дополнительных параметров '''не''' требуется, так как разумные значения по умолчанию, кхм, разумны. 

В следующем примере, ''PGDATA'' определяет что файлы настроек должны быть расположены в {{Path|/etc/postgresql-9.3/}} . ''DATA_DIR'' определяет, что кластер базы данных должен быть установлен в {{Path|/var/lib/postgresql/9.3/data/}} , который является каталогом по умолчанию. Если вы решите отказаться от значений по умолчанию, помните, что '''очень хорошей идеей''' будет хранить номер старшей версии в переменной PATH. ''PG_INITDB_OPTS'' определяет, что локалью по умолчанию должна быть ''en_US.UTF-8'' . То есть, будет использоваться английское упорядочивание и форматирование, и кодировка символов UTF-8. 

{{File|/etc/conf.d/postgresql-9.3|Примерное содержимое|<pre>
# Размещение файлов конфигурации
PGDATA="/etc/postgresql-9.3/"
  
# Где размещается/должен быть создан каталог с данными
DATA_DIR="/var/lib/postgresql/9.3/data"
  
# Дополнительные параметры для передачи в initdb.
# См. 'man initdb' для перечисления доступных параметров.
PG_INITDB_OPTS="--locale=en_US.UTF-8"
</pre>
}}


{{Note/ru|Это только определяет локаль и кодировку символов по умолчанию. Вы можете указать разные локали и/или кодировки символов во время создания базы данных (<code>CREATE DATABASE</code> ) в одном и том же кластере базы данных.}}

Существуют шесть параметров локали, которые могут быть установлены для переопределения ''--locale='' . Следующая таблица перечисляет шесть этих параметров, которые, если используются, должны быть отформатированы как: <code>--option=lo_LO.ENCODING</code>. 

{| class="wikitable" style="text-align: left;" 
|- 
! Параметр
! Действия
|- 
| lc-collate
| Порядок сортировки строк
|- 
| lc-ctype
| Классификация символов (Что является буквой? Ее эквивалент в верхнем регистре?)
|- 
| lc-messages
| Язык сообщений
|- 
| lc-monetary
| Форматирование количеств денежных сумм
|- 
| lc-numeric
| Форматирование чисел
|- 
| lc-time
| Форматирование даты и времени
|-
|}

Таким образом, если вы хотите в качестве языка по умолчанию взять английский, но сообщения должны быть на русском, то ''PG_INITDB_OPTS'' будут выглядеть так:

{{Code|Установка PG_INITDB_OPTS|<pre>
PG_INITDB_OPTS="--locale=en_US.UTF-8 --lc-messages=ru_RU.UTF-8"
</pre>
}}

Полный список кодировок языков и символов, поддерживаемых сервером, может быть найден в документации, но и ваша система также должна поддерживать соответственные языки и кодировки символов. Сравните вывод <code>locale -a</code> с [http://www.postgresql.org/docs/current/static/multibyte.html кодировками] в документации. 

Вы можете изменить локаль и набор кодировок во [http://www.postgresql.org/docs/currrent/static/sql-createdatabase.html время создания базы данных.] Для того, чтобы изменить локаль для базы данных после того, как вы ее создали, вам нужно удалить базу данных и начать все сначала. 

{{RootCmd|emerge --config dev-db/postgresql:9.3}}

Это создаст кластер базы данных и сохранит все принадлежащие серверу файлы в ''PGDATA'' и ''DATA_DIR'' . 

== Конфигурация ==

=== Где размещаются файлы конфигурации ===

На этот раз мы сосредоточимся на файлах в каталоге ''PGDATA'', {{Path|/etc/postgresql-9.3}}, с основным фокусом на файлах {{Path|postgresql.conf}} и {{Path|pg_hba.conf}}. 

=== postgresql.conf ===

Это основной файл конфигурации. Строкой, которая немедленно может вас заинтересовать, является ''listen-addresses''. Эта переменная определяет к каким адресам PostgreSQL будет осуществлять привязку. По умолчанию, привязаны только localhost и доменный сокет Unix. Изменения ''listen_addresses'' недостаточно для разрешения удаленных соединений. Это будет описано в следующем разделе. [http://www.postgresql.org/docs/current/static/runtime-config.html Официальная документация] довольно легка для понимания и всесторонне охватывает все доступные настройки. Вам следует прочесть ее в дополнение к тому что описано здесь, так как некоторые вещи могут измениться. 

Второстепенным вопросом является место назначения логирования. По умолчанию, все пишется в {{Path|postmaster.log}} в каталоге ''DATA_DIR''. Имеется целый подраздел {{Path|postgresql.conf}}, который охватывает большое количество вариантов того как, что и куда нужно логировать. Подраздел обозначен как: ERROR REPORTING AND LOGGING. 

Кроме ''listen_addresses'' и параметров логирования, остальная часть значений по умолчанию в {{Path|postgresql.conf}} довольно приемлема для начала. 

=== pg_hba.conf ===

Файл {{Path|pg_hba.conf}} определяет кому разрешается подключаться к серверу баз данных и какой метод аутентификации должен быть использован для установки соединения. Опять же, документация по настройкам и тому, что они означают, является довольно исчерпывающей, но несколько вещей здесь описаны для разъяснения. 

{{File|pg_hba.conf|Настройки по умолчанию|<pre>
# TYPE  DATABASE    USER        CIDR-ADDRESS          METHOD
  
# "local" - только для соединений с доменного сокета Unix
local   all         all                               trust
# локальные соединения IPv4:
host    all         all         127.0.0.1/32          trust
# Локальные соединения IPv6:
host    all         all         ::1/128               trust
</pre>
}}

As has been mentioned before, by default the server is secure. Kind of. There is only one database role that is available for log in by default: ''postgres'' . And, the only way to initiate a connection to the database is through the {{Path|/run/postgresql/.s.PGSQL.5432}} Unix socket, which is owned by the ''postgres'' system user and system group, or via localhost. Now for the "kind of" bit: Any user on the system can make a connection to the database through the localhost. Even as the ''postgres'' database superuser. 

{{Warning/ru|Никогда не отключайте доменный сокет Unix полностью. Сценарии инициализации требуют к нему доступ, чтобы функционировать должным образом. Этот метод может быть свободно изменен.}}

Метод ''trust'' — это то, что позволяет любому пользователю входить от имени любого пользователя без пароля. Он обозначает только то, что он подразумевает: доверять всем соединениям для определенного типа к определенной базе данных от определенного пользователя базы данных (но не системного пользователя) из определенного местонахождения без пароля. Это то, что изначально позволяет любому пользователю системы входить от имени любого пользователя через соединение localhost. Это не настолько опасно, как кажется, но представляет серьезный риск для безопасности в большинстве обстоятельств. 

Два метода, которые вы наиболее вероятно будете использовать, это ''password'' и ''md5'' . Метод ''password'' только указывает, что для установления соединения требуется пароль и пароль отправляется в виде простого текста. Этот метод хорош тогда, когда такого рода информация никогда не покинет машину, как, например, при соединении через доменный сокет Unix или localhost. Метод ''md5'' схож с ''password'', но защищает пароль использованием хэша md5. Это то, что вам потребуется использовать, когда бы пароль ни был отправлен через сеть. 

В данный момент автор хотел бы обратить ваше внимание на последние две строчки и четыре строчки, включающие комментарии, в файле {{Path|pg_hba.conf}} . PostgreSQL имеет нативную поддержку IPv6, независимо от того, желаете ли вы такую поддержку или нет. Вдобавок, адреса IPv4 автоматически отображаются в адреса IPv6, т.е., 127.0.0.1 будет отображен в ::FFFF:127.0.0.1 и, как ''чистый'' IPv6, ::FFFF:7F00:0001. 

Хотя, кажется, есть некоторое непонимание того как имена хостов отображаются в IP-адреса. Давайте рассмотрим файл {{Path|/etc/hosts}} . 

{{File|/etc/hosts||<pre>
# псевдонимы localhost для IPv4 and IPv6
127.0.0.1       localhost
::1             localhost
</pre>
}}

Из примера выше вы можете видеть, что оба адреса IPv4 и IPv6 отображаются на localhost. Когда <code>psql</code> обратится к этому файлу, она захватит первое совпадение и использует его в качестве адреса; в этом случае 127.0.0.1. Когда Postgresql его проанализирует, он также будет соответствовать адресу в формате IPv6, например, ::ffff:127.0.0.1. Если, однако же, адрес IPv6 появится первым, то тогда <code>psql</code> отобразит его только в один ::1; ::1 — это не то же самое, что ::ffff:127.0.0.1. Таким образом, если вы не имеете ::1 в качестве разрешенных средств доступа, <code>psql</code> не будет способна установить соединение. Кроме того, ваше ядро должно поддерживать протокол IPv6. 

Поэтому, лучше будет указать только одни IP адреса для <code>psql</code> и в файле {{Path|pg_hba.conf}}, вместо того чтобы полагаться на то, что {{Path|/etc/hosts}} упорядочен должным образом. Это устраняет любые сомнения по поводу того какие IP-адреса разрешены или к какому серверу вы будете подключаться. 

== Запуск сервера ==

=== Поехали! ===

Теперь, запустите PostgreSQL и установите пароль для суперпользователя базы данных ''postgres'' . Эти команды должны быть запущены под 'root' в следующем листинге кода. 

Измените 'trust' на 'password' для соединений с localhost.

{{RootCmd|nano -w /etc/postgresql-9.3/pg_hba.conf}}

Теперь запустите базу данных:

{{RootCmd|/etc/init.d/postgresql-9.3 start|output=<pre>
postgresql-9.3  | * Starting PostgreSQL ...                             [ ok ]
</pre>}}

Откройте соединение к серверу и установите пароль:

{{RootCmd|psql -U postgres|output=<pre>
psql (9.3.5)
Type "help" for help.
</pre>}}

{{Cmd|\password|prompt=postgres{{=}}# |output=<pre>
Enter new password:
Enter it again:
</pre>}}

{{Cmd|\q|prompt=postgres{{=}}# }}

Измените 'trust' на 'password' для локальных соединений:

{{RootCmd|nano -w /etc/postgresql-9.3/pg_hba.conf}}

Теперь перезагрузите настройки базы данных:

{{RootCmd|/etc/init.d/postgresql-9.3 reload|output=<pre>
postgresql-9.3 | * Reloading PostgreSQL configuration ...               [ ok ]
</pre>
}}

Затем, когда все работает так, как нужно, включите загрузку PostgreSQL при старте системы:
{{RootCmd|# rc-update add postgresql-9.3 default|output=<pre>
 * service postgresql-9.3 added to runlevel default
</pre>
}}

На данный момент вы готовы продолжать с официальным [http://www.postgresql.org/docs/current/static/tutorial.html Руководством PostgreSQL]. Это руководство проведет вас через создание ролей, баз данных, схем и все эти интересные и полезные вещи.

== Миграция PostgreSQL ==

=== Когда вам требуется миграция ===

Существуют только две причины по которым вам необходимо выполнить миграцию: при переходе от одной главной версии к другой, например, от PostgreSQL 8.4.7 к 9.0.3, но не от 9.0.2 к 9.0.3; или при переключении с устаревшего формата временных меток с плавающей точкой к новому 64-битному целочисленному формату временных меток. 

{{Note|You will need to migrate your database when you move from the obsolete ebuilds {{Package|dev-db/libpq}}, {{Package|dev-db/postgresql-libs}}, and {{Package|dev-db/postgresql-client}} or {{Package|dev-db/postgresql}} older than 9.0 to the new {{Package|dev-db/postgresql}} ebuild.}}


=== Миграция после версии 9.0 ===

When upgrading from a previous version of the recent ebuilds, which is any version after 8.4, follow the beginning of this guide before proceeding with this migration.

''pg_upgrade'', новая утилита, которая поставляется с версиями 9.0 и позже, радикально упрощает процесс миграции. 

However, there are two caveats with using <code>pg_upgrade</code>. Firstly, it does not support configuration files being in a different directory than where the data is stored. This can be resolved by using symbolic links. Lastly, you can only use it to migrate from a database from 8.3 or newer. If you have an older database you will need to follow the instructions to migrate from pre-9.0 deployments.

Остановите серверы с которых и на которые вы собираетесь мигрировать:

{{RootCmd|/etc/init.d/postgresql-8.4 stop
|/etc/init.d/postgresql-9.3 stop
|ln -s /etc/postgresql-8.4/*.conf /var/lib/postgresql/8.4/data/
|ln -s /etc/postgresql-9.3/*.conf /var/lib/postgresql/9.3/data/}}

Проверьте доступные версии и затем выберите вашу:

{{RootCmd|eselect postgresql list
|eselect postgresql set 9.3}}

Измените метод аутентификации пользователя базы данных 'postgres' так, чтобы доверять локальным соединениям на всех базах данных:

{{RootCmd|nano -w /etc/postgresql-8.4/pg_hba.conf
|nano -w /etc/postgresql-9.3/pg_hba.conf}}

You may need to change the permissions of {{Path|/var/lib/postgresql/}} before you perform the next step.

{{RootCmd|su - postgres}}

{{Cmd|pg_upgrade -U postgres \
-d /var/lib/postgresql/8.4/data -D /var/lib/postgresql/9.3/data \
-b /usr/lib/postgresql-8.4/bin -B /usr/lib/postgresql-9.3/bin}}

{{Note/ru|PostgreSQL до версии 9.4 использовал опцию <code>-u</code> вместо <code>-U</code>.}}

Perform the tasks <code>pg_upgrade</code> tells you to do, if any.

{{Cmd|logout}}

И вот все готово:

{{RootCmd|/etc/init.d/postgresql-9.3 start}}

=== Миграция перед версией 9.0: с помощью новых ebuild-файлов ===

По той причине, что новые ebuild-файлы предлагают более совершенный метод слоттинга, чем предыдущие, время простоя довольно мало, скорее всего это будут минуты, нежели часы. 

В следующих примерах предполагается, что вы используете местоположения и настройки портов по умолчанию, и что вы мигрируете с 8.3 на 8.4. Отрегулируйте их соответствующим образом, если вы отклонились от значений по умолчанию. 

Если вы еще этого не сделали, следуйте инструкциям по установке перед началом миграции. Такая компиляция может повлиять негативным образом на производительность сервера баз данных, но, тем не менее, она может выполняться. 

Необходимо отредактировать пару файлов перед началом миграции. Установите ''PGPORT'' в файле конфигурации {{Path|/etc/conf.d/postgresql-8.4}} на 6543. (Подойдет любой порт отличный от того, который привязан к предыдущей установке.) 

Затем, отредактируйте {{Path|/etc/postgresql-8.3/pg_hba.conf}} так, чтобы только суперпользователь базы данных ''postgres'' мог получить доступ к кластеру базы данных через доменный сокет Unix. 

{{RootCmd|cp -p /etc/postgresql-8.3/pg_hba.conf /etc/postgresql-8.4/}}

Следующие инструкции должны быть безопасны. Прочтите документацию, чтобы быть в этом уверенными.

{{RootCmd|cp -p /etc/postgresql-8.3/postgresql.conf /etc/postgresql-8.4/}}

Не забудьте скопировать те файлы конфигурации, которые могут вам понадобиться.

{{RootCmd|/etc/init.d/postgresql-8.3 reload
|/etc/init.d/postgresql-8.4 start}}

Начинайте переправлять данные со старого кластера на новый кластер.

{{RootCmd|pg_dumpall -U postgres -p 5432 {{!}} psql -U postgres -d postgres -p 6543
|/etc/init.d/postgresql-8.3 stop
|/etc/init.d/postgresql-8.4 stop}}

Установите PGPORT обратно на 5432.

{{RootCmd|nano -w /etc/conf.d/postgresql-8.4}}

Разрешите пользователям доступ еще один раз.

{{RootCmd|nano -w /etc/postgresql-8.4/pg_hba.conf
|/etc/init.d/postgresql-8.4 start
|rc-update del postgresql-8.3 && rc-update add postgresql-8.4 default}}

Надеемся, все прошло по плану и вы успешно обновили сервер, который содержит те же самые данные, точь-в-точь, как и старый сервер. 

=== Миграция перед версией 9.0: со старых ebuild-файлов ===

Вам потребуется запланировать некоторое время простоя для вашего сервера. Старые ebuild-файлы '''не могут''' быть установлены в то же самое время, что и новые. Таким образом, заранее предположите, что сервер будет остановлен в течение нескольких часов. Даже, может быть, на все выходные. 

Перед началом, вам понадобится запретить доступ к серверу, так, чтобы не сделать изменений. Вы также можете пожелать сделать резервное копирование {{Path|postgresql.conf}} и {{Path|pg_hba.conf}} и любого другого файла конфигурации, который вы считаете важным. 

{{RootCmd|pg_dumpall -U postgres > backup_file
|/etc/init.d/postgresql stop
|emerge -C dev-db/libpq dev-db/postgresql-client dev-db/postgresql-libs}}

Следуйте шагам по установке и конфигурации сервера, описанным в подробностях в этой статье.

{{RootCmd|/etc/init.d/postgresql-8.4 start
|psql -f backup_file postgres}}

You may break some packages that were built against those packages, but once you have installed {{Package|dev-db/postgresql}} you can run <code>revdep-rebuild</code> to reemerge any packages that may have been broken.

== Утилиты ==

=== pgAdmin III ===

[http://www.pgadmin.org/ pgAdmin III] — это графическая утилита для управления PostgreSQL. 

== Устранение проблем ==

=== Сообщение "Server Lacks Instrumentation Functions" ===

Эту проблему легко решить, с решением, зависящим от версии, которую вы используете. Что сложно, так это найти ответ. То, что потребуется — это импорт из файла, который уже существует на запоминающем устройстве: {{Path|adminpack.sql}}. Чтобы решить эту проблему, запустите одну из следующих команд, соответствующую имеющейся версии:

Для PostgreSQL 9.0 и более ранних версий: {{cmd|psql -U postgres --file /usr/share/postgresql-9.0/contrib/adminpack.sql}}

Для PostgreSQL 9.1 и более поздних версий: {{Cmd|psql -U postgres -c "CREATE EXTENSION adminpack;"}}

=== Отсутствующие файлы настроек в {{Path|/etc/postgresql-9.x}} и {{Path|/var/lib/postgresql/9.x/data}} ===

Вы можете попытаться переместить файлы настроек в каталог следующим образом (x - это ваша версия postgresql):

{{RootCmd|cp /var/lib/postgresql/9.x/data/*.conf /etc/postgresql-9.x/}}

Если данные файлы отсутствуют, вам нужно их инициализировать.

Сначала зайдите как пользователь postgres:

{{RootCmd|su postgres}}

Затем, как пользователь postgres, запустите <code>initdb</code> и укажите каталог с данными:

{{Cmd|initdb -D /var/lib/postgresql/9.x/data/}}

После этого будут созданы файлы настроек, и вы сможете скопировать их в каталог {{Path|/etc/postgresql-9.x/}}, как было показано в первом примере данного раздела.

=== Ошибки "ERROR: timezone directory stack overflow" или "FATAL: too many private dirs demanded"===

Это вызвано ссылающимися друг на друга символическими ссылками. Чтобы исправить данную проблему, введите следующее:

{{RootCmd|rm /usr/share/zoneinfo/posix}}

Помните, что любое обновление zoneinfo снова создаст данную символическую ссылку, и вам понадобится удалить ее снова.

=== Systemd ===

Заставьте сервис запускаться при загрузке:

{{RootCmd|systemctl enable postresql-9.4}}

Чтобы запустить сервис немедленно:

{{RootCmd|systemctl start postresql-9.4}}

Если вы получите ошибку, проверьте, что существует каталог {{Path|/run/postgresql/}}. Если он не существует, создайте его следующим образом:

{{RootCmd|systemd-tmpfiles --create}}

Проверьте разрешения для файла настроек:

{{RootCmd|ls -l /etc/postgresql-9.*/*}}
{{RootCmd|chown postgres:postgres /etc/postgresql-9.*/*}}
{{RootCmd|chmod 600 /etc/postgresql-9.*/*}}

== Ссылки ==

<references/>

{{Migrated|originalauthors=Aaron W. Swenson,Mikkel A. Clausen}}

[[Category:Database]]
