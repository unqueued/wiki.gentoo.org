<languages />
{{Metadata|abstract=udev это менеджер устройств для ядра Linux. Он обрабатывает файлы устройств в каталоге /dev и обрабатывает все действия пользователя при добавлении или удалении устройств.}}

{{InfoBox stack
|{{InfoBox homepage|https://www.freedesktop.org/wiki/Software/systemd/|header=true}}
|{{InfoBox wikipedia}}
|{{InfoBox gitweb|https://cgit.freedesktop.org/systemd/systemd/tree/src/udev|raw=true}}
|{{InfoBox project|Udev}}
}}

'''udev''' это менеджер устройств для ядра Linux. Он управляет файлами устройств в каталоге {{Path|/dev}} и обрабатывает все действия из пользовательского пространства при добавлении или удалении устройств. Читателям этой статьи следует также посмотреть на [[Eudev/ru|eudev]] форк udev.

== Что такое udev? ==

=== Каталог /dev ===

{{:/dev/ru}}

== Установка ==

{{Important|При обновлении проверьте [[Udev/Upgrade Guide|udev upgrade guide]]. Там есть информация, которая не позволит сделать систему не загружаемой.}}

=== Ядро ===

Для {{c|udev}} требуется включить следующие параметры ядра:

<!-- Смотри https://git.kernel.org/?p=linux/hotplug/udev.git;a=blob_plain;f=README -->
{{KernelBox|1=
General setup  --->
    [*] Configure standard kernel features (expert users)  --->
        [ ] Enable deprecated sysfs features to support old userspace tools
        [*] Enable signalfd() system call
Enable the block layer  --->
    [*] Block layer SG support v4
Networking support  --->
    Networking options  --->
        <*> Unix domain sockets
Device Drivers  --->
    Generic Driver Options  --->
        ()  path to uevent helper
        [*] Maintain a devtmpfs filesystem to mount at /dev
    < > ATA/ATAPI/MFM/RLL support (DEPRECATED)  --->
File systems  --->
    [*] Inotify support for userspace
    Pseudo filesystems --->
        [*] /proc file system support
        [*] sysfs file system support
}}

=== USE-флаги ===

Portage знает о глобальном <code>udev</code> USE-флаге для включения поддержки udev в остальных пакетах. Добавьте этот USE-флаг в список USE-флагов (он включен по умолчанию для всех Linux [[Profile (Portage)|профилях]]) приведет к тому, что пакет {{Package|sys-fs/udev}} автоматически установится:

{{FileBox|filename=/etc/portage/make.conf|lang=bash|1=
USE="udev"
}}

{{USEflag|package=sys-fs/udev}}

=== Emerge ===

После настройки USE-флагов обновите систему, чтобы изменения вступили в силу:

{{Emerge|params+=--changed-use --deep|@world}}

== Конфигурация ==

=== Запуск как сервис ===

Чтобы запустить udev при загрузке, добавьте его к уровню запуска sysinit. Это может быть сделано при помощи следующей команды, если она запущена с привилегиями root пользователя:

{{RootCmd|rc-update add udev sysinit}}

== Расширенная конфигурация ==

=== Правила ===

udev дает возможность создавать правила, которые проверяют uevents (события, посланные ядром) и задают свойства найденного устройства. Совпадающее правило, возможно, даст устройству имя, создаст файл устройства, и запустит программу конфигурации, чтобы настроить устройство.

Определения правил сохраняются в двух местах:

# '''{{Path|/lib/udev/rules.d}}''' - правила в этом каталоге создают некоторые установленные пакеты, они, как правило, не должны изменятся пользователями;
# '''{{Path|/etc/udev/rules.d}}''' - этот каталог для пользовательских настроек. Любое новое правило должно быть добавлено в этот каталог.

В этих каталогах, несколько файлов правил (с суффиксом {{Path|.rules}}) в буквенно-цифровом порядке имен, по возрастанию. Внутри файлов правил, udev ищет выражения, которые могут совпасть с uevent (добавляется устройство или удаляется) и команду для выполнения.

Выражения проверяются на совпадение на основании следующей информации:

* Поле ''SUBSYSTEM'' uevent (для какого типа устройства был uevent)
* Действие (поле ''ACTION''), которое было предпринято (добавление, удаление, либо изменение устройства)
* Один или более атрибутов (через поля ''ATTR'' or ''ATTRS''), например, класс устройства, производитель, либо другая информация об устройстве
* Имя, данное ядром (через поле ''KERNEL''), например, sd* (для дисков SCSI/SATA), либо input* (для устройств ввода, таких, как мыши и клавиатуры)
* Одна или более настройка окружения (через поле ''ENV''), используемая для информации, которая может использоваться несколькими правилами сразу.

На основании этой информации, правило может сделать следующее:

# определить информацию, которую необходимо будет передать более поздним событиям (через переменные окружения)
# создать ссылки в {{Path|/dev}}
# выполнить команды

Udev делает эти действия для каждого правила, для которого находит соответствие (он не останавливается после первого совпадения), позволяя организовать гибкий подход к управлению устройствами.

=== Постоянные имена устройств ===

Ядро определяет устройства асинхронно, а udev зеркалирует файловую систему [[sysfs]] ядра так, чтобы устройствам были даны названия и номера в порядке их определения. Так что, по умолчанию udev не дает постоянных имен устройств. Однако существуют механизмы для того, чтобы этого добиться (для некоторых классов устройств).

* Udev создает дополнительные символические ссылки для устройств хранения, на основании ID, [[Removable_media#UUIDs_and_label|label, UUID]] и расположения устройства. Посмотрите в каталог {{Path|/dev/disk/by-*}}. Так что, вместо того, чтобы использовать файл устройства {{Path|/dev/sda}}, используйте файл {{Path|/dev/disk/by-label/НЕКОТОРАЯ_МЕТКА}}.

* То же самое для устройств ввода в каталоге {{Path|/dev/input}}.

* Используя свои правила, пользователи могут создавать собственные файлы устройств.

== Использование ==

Некоторые полезные команды:

* Показать все сообщения о заданном файле устройства:
: {{RootCmd|udevadm info --query{{=}}all --name{{=}}/dev/DEVICE_FILE}}

* Мониторинг активности udev:
: {{RootCmd|udevadm monitor}}

* Назначение постоянного имени для интернет устройства:
: {{FileBox|filename=/etc/udev/rules.d/ethernet.rules|lang=bash|1=
SUBSYSTEM=="net", ACTION=="add", ATTR{address}=="01:23:45:67:89:ab", NAME="eth6789ab"
}}

Смотрите [[man page|man страницу]] ''udevadm'' для более детальной информации.

== Устранение проблем ==

* {{Bug|udev|search=package}}

=== Логгинг сообщений монитора ===

Чтобы начать записывать все сообщения при запущенном {{c|udevadm monitor}}, измените следующий конфигурационный файл:

{{FileBox|filename=/etc/conf.d/udev|lang=bash|1=
udev_monitor="YES"
}}

Это создаст новый файл лога {{Path|/run/udev/udevmonitor.log}}.

=== Режим отладки ===

Включение режима отладки выведет еще больше сообщений в логах:

{{FileBox|filename=/etc/conf.d/udev|lang=bash|1=
udev_debug="YES"
}}

Установите приоритет логгинга

{{FileBox|filename=/etc/udev/udev.conf|lang=bash|1=
udev_log="debug"
}}

Будет создан файл логов {{Path|/run/udev/udevdebug.log}}, однако никакие сообщения в него не будут записываться. Самые новые версии udev будут отправлять все сообщения в {{c|dmesg}}.

=== Отсутствующие файлы устройств {{Path|/dev/null}} и {{Path|/dev/console}} ===

Некоторые версии udev нуждаются {{Path|/dev/null}} и {{Path|/dev/console}} файлах для корректной работы, и не могут создать их сами. Чтобы вручную создать эти файлы для Udev выполните следующие команды с привилегиями root:

{{RootCmd
|mkdir test
|mount --bind / test
|cd test/dev
|mknod -m 660 console c 5 1
|mknod -m 660 null c 1 3
|cd ../..
|umount test
|rmdir test
}}

=== Сетевая карта определена как eth0, но изменилась на eth1 ===

Те, у кого две сетевых карты на материнской плате, могут попасть в ситуацию, когда {{c|ifconfig}} не покажет eth0 или eth1. {{c|dmesg}} может показать, что сетевая карта определена как eth0, а затем переименована в eth1. При выполнении {{c|ifconfig -a}} также будет показана сетевая карта как eth1. Это из-за того, что имена, определенные ядром используются в первую очередь. Пользователи должны написать свои правила, например, в файле {{Path|/etc/udev/rules.d/70-my-network.rules}}, и задать свои имена, вроде lan0 или wireless0, либо использовать предсказуемые имена интерфейсов (которые были включены по умолчанию начиная с udev версии 197).

Также, помните, что нужно удалить старые файлы, оставшиеся от старых версий udev:

{{RootCmd|rm /etc/udev/rules.d/70-persistent-net.rules}}

== Смотрите также ==

[[Eudev/ru|eudev]] - форк udev разрабатываемый Gentoo.

== Ссылки ==

{{Bug|575718|text=Bug 575718 - запрос на голосование относительно того, какую программу по умолчанию будет предоставлять virtual/udev}} - предоставляемая по умолчанию программа от virtual/udev изменена на sys-fs/eudev.


[[Category:Core system]]
[[Category:Daemons]]
