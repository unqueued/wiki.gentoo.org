<languages />


<div class="mw-translate-fuzzy">
{{Metadata|abstract=Cílem tohoto průvodce je poskytnout vám návod na hladký přechod z GRUB Legacy na GRUB2.}}
</div>

<div class="mw-translate-fuzzy">
Cílem tohoto průvodce je poskytnout vám návod na hladký přechod z GRUB Legacy na GRUB2.
</div>

== Na pozadí ==

<div class="mw-translate-fuzzy">
=== Co je to GRUB? ===
</div>

<div class="mw-translate-fuzzy">
Grub je jeden z nejběžněji používaných zavaděčů na ne-embeddeded strojích s Linuxem. GRUB má za úkol  nahrát linuxové jádro z disku do paměti a začít s jeho spouštěním.
</div> 

<div class="mw-translate-fuzzy">
=== Proč tedy přejít? ===
</div>

Za prvé GRUB Legacy již není udržován a jako takový proto ani není nadále aktualizován. GRUB Legacy byl vytvořen v době, kdy měli vývojáři za to, že lze bezpečně učinit určité předpoklady, které se dnes již nezakládají na pravdě. Například, GRUB Legacy neumožňuje bootovat z disků větších než 2TB a rovněž předpokládá, že se neobjeví nové souborové systémy jako náhrada za {{Path|/boot}}. 

GRUB2 má za cíl poskytnout větší robustnost, přenositelnost, více možností a rovněž je udržován s čistějším kódem. GRUB2 podporuje více hardwarových konfigurací, více souborových systémů a způsobů uspořádání zařízení, než jeho předchůdce. 

== Přechod na GRUB2 ==

<div class="mw-translate-fuzzy">
Přechod na GRUB2 je velmi přímočarý: bude přibrán správcem balíčků během během provádění běžného upgradu. Pokud by nebyl vtažen automaticky, lze kdykoli instalovat <code>sys-boot/grub:2</code>.
</div>

{{Emerge|sys-boot/grub:2}}

<div class="mw-translate-fuzzy">
=== Bootovací zařízení ===
</div>

<div class="mw-translate-fuzzy">
První důležitou částí, je určení bootovacího zařízení. Pro spoustu lidí jím bude {{Path|/dev/sda}}. Nejjednodušší cestou, jak zjistit tuto informaci, je podívat se na to jakým způsobem je nastaven současný GRUB Legacy nahlédnutím do {{Path|/boot/grub/grub.conf}}. Příklad takového souboru najdete níže.
</div> 

<div class="mw-translate-fuzzy">
{{Note/cs|Abyste mohli tyto soubory otevřít, musíte připojit {{Path|/boot}}. Připojení {{Path|/boot}} lze provést jednoduše příkazem <code>mount /boot</code>.}}
</div>

The {{Path|grub.conf}} file will look something like this:

{{FileBox|filename=/boot/grub/grub.conf|1=
default 0
timeout 30
splashimage=(hd0,0)/boot/grub/splash.xpm.gz
  
title Gentoo Linux 3.2.12
root (hd0,0)
kernel /boot/kernel-3.2.12-gentoo root=/dev/sda3 quiet dolvm
initrd /boot/initramfs-genkernel-x86_64-3.2.12-gentoo
}}

<div class="mw-translate-fuzzy">
Ve výše uvedeném souboru tak vidíme, že <code>(hd0)</code> je bootovacím diskem, avšak musíme je přiřadit k reálnému zařízení. To zjistíme pohledem do {{Path|/boot/grub/device.map}}. Příklad takového souboru je uveden níže.
</div> 

{{FileBox|filename=/boot/grub/device.map|1=
(fd0) /dev/fd0
(hd0) /dev/sda
(hd1) /dev/sdb
}}

<div class="mw-translate-fuzzy">
{{Note/cs|Jestliže máte podezření, že {{Path|/boot/grub/device.map}} není správný, můžete spustit <code>grub-install --recheck /dev/sda</code> pro znovu vytvoření souboru.}}
</div>

Na základě výše uvedeného souboru tak víme, že {{Path|/dev/sda}} je bootovacím zařízením.

<div class="mw-translate-fuzzy">
=== Instalace a konfigurace GRUB2 ===
</div>

<div class="mw-translate-fuzzy">
Dalším krokem je instalace a konfigurace na vašem {{Path|/boot}} oddíle, aniž byste odstranili GRUB Legacy z MBR. Níže uvedený příklad používá {{Path|/dev/sda}}, vy jej však musíte vyměnit za cestu vedoucí k vašemu bootovacímu zařízení. První krok nainstaluje soubory GRUB2 do {{Path|/boot/grub}}, zatímco druhý krok vyhledá dostupná jádra a vygeneruje příslušný konfigurační soubor do {{Path|/boot/grub/grub.cfg}}. Pokud hodláte provést [[GRUB2_Quick_Start#Manual_Configuration|ruční konfiguraci]], druhý krok vynechejte.
</div>

First install the necessary GRUB2 files to {{Path|/boot/grub}}.

<div class="mw-translate-fuzzy">
{{RootCmd|grub2-install --grub-setup{{=}}/bin/true /dev/sda|output=<pre>
Installation finished. No error reported.
</pre>}}
</div>

{{Warning|The <code>--grub-setup{{=}}/bin/true</code> option tells {{c|grub-install}} to ''not'' install GRUB2 in the MBR. If this option is omitted, GRUB Legacy will be overwritten and [[#Chainloading GRUB2 from GRUB Legacy to test the setup|chainloading GRUB2 from GRUB Legacy later on]] will not be possible.}}

{{Note|If GRUB2 was emerged with the <code>multislot</code> USE flag, the {{c|grub-install}} command will still refer to GRUB Legacy. In this case, use {{c|grub2-install}} instead — and use {{c|grub2-mkconfig}} in place of {{c|grub-mkconfig}} in the next step.}}

Now we can scan the available kernels and generate a suitable config file to {{Path|/boot/grub/grub.cfg}}. Skip this step when using a [[GRUB2_Quick_Start#Manual_configuration|Manual Configuration]].

<div class="mw-translate-fuzzy">
{{RootCmd|grub2-mkconfig -o /boot/grub/grub.cfg|output=<pre>
Generating grub.cfg ...
Found linux image: /boot/kernel-3.2.12-gentoo
Found initrd image: /boot/initramfs-genkernel-x86_64-3.2.12-gentoo
done
</pre>
}}
</div>

<div class="mw-translate-fuzzy">
{{Warning/cs|GRUB 2 používá konfigurační soubor {{Path|/boot/grub/grub.'''cfg'''}} zatímco GRUB Legacy používá {{Path|/boot/grub/grub.'''conf'''}} tak se prosím ujistěte, že nepoužíváte omylem starý soubor, npř. použítím tab-doplnění když zde ještě starý soubor existuje.}}
</div>

<div class="mw-translate-fuzzy">
{{Note/cs|<code>grub2-mkconfig</code> má přísné požadavky na pojmenování souborů obsahujících jádro a initramfs. Jádro musí být pojmenováno stylem <code>kernel-${verze}</code> nebo <code>vmlinuz-${verze}</code> zatímco initramfs musí být pojmenován jako <code>initramfs-${verze}.img</code> ,<code>initramfs-genkernel-${verze}</code> ,<code>initramfs-genkernel-${arch}-${verze}</code> ,<code>initrd-${verze}.img</code> ,<code>initrd.img-${verze}</code> ,<code>initrd-${verze}.gz</code> , nebo <code>initrd-${verze}</code>. Společně s  ${verzí}, musí pojmenování souboru souhlasit s pojmenováním příslušného souboru jádra, které je k dispozici v  {{Path|/boot}} .}}
</div>

<div class="mw-translate-fuzzy">
{{Note|Soubor {{Path|/etc/default/grub}} řídí chod <code>grub2-mkconfig</code>. Pokud potřebujete předat parametry jádru (například pokud používáte genkernel a bootujete z LVM nebo softwarového RAID pole), musíte upravit tento soubor před generováním {{Path|/boot/grub/grub.cfg}} tímto způsobem:
{{RootCmd|nano/etc/default/grub}}
Podívejte se na článek [[GRUB2#Configuration|Konfigurace GRUB2]] na Gentoo Wiki nebo na [http://www.gnu.org/software/grub/manual/html_node/Simple-configuration.html manuál grub2], abyste se rozhodli jak upravit tento soubor. Většina uživatelů bude muset změnit parametr <code>GRUB_CMDLINE_LINUX</code>.}}
</div>

=== Zkouška nastavení spuštěním GRUB2 skrze GRUB Legacy ===

Protože špatná konfigurace GRUB může vést k tomu, že systém se stane nespustitelným, chceme nastavení GRUB2 otestovat, než jej učiníme trvalým. Proto spustíme GRUB2 přes GRUB Legacy. To uděláme tak, že přidáme novou položku do {{Path|/boot/grub/grub.conf}}. Viz příklad níže. 

<div class="mw-translate-fuzzy">
{{Note/cs|Nezapomeňte, že hodnota root může být jiná, než <code>(hd0,0)</code> použitá v příkladu. Proto se ujistěte, že  jste použili totožnou hodnotu jako ve svém původním {{Path|/boot/grub/grub.conf}} .}}
</div>

<div class="mw-translate-fuzzy">
{{File|/boot/grub/grub.conf||<pre>
default 0
timeout 30
splashimage=(hd0,0)/boot/grub/splash.xpm.gz
  
title GRUB2 Chainload
root (hd0,0)
kernel /boot/grub/i386-pc/core.img
boot
  
title Gentoo Linux 3.2.12
root (hd0,0)
kernel /boot/kernel-3.2.12-gentoo root=/dev/sda3 quiet dolvm
initrd /boot/initramfs-genkernel-x86_64-3.2.12-gentoo
</pre>
}}
</div>

<div class="mw-translate-fuzzy">
Nyní byste měli restartovat svůj stroj a v menu GRUB vybrat možnost <code>GRUB2 Chainload</code> jakmile váš počítač začne bootovat. Zobrazí se vám další menu GRUB, které bude nahoře označené jako GRUB 2.0.0 nebo vyšší a zobrazí rovněž dostupná jádra k zavedení. Pokud by tento postup nefungoval, jednoduše restartujte systém a vyberte z menu obvyklou bootovací položku namísto <code>GRUB2 Chainload</code>.
</div> 

=== Výměna a odstranění GRUB Legacy ===

<div class="mw-translate-fuzzy">
Pokud vše úspěšně fungovalo, můžete nyní vyměnit GRUB Legacy a odstranit jej ze systému.
</div> 

<div class="mw-translate-fuzzy">
{{Note/cs|Protože jste restartovali systém, možná bude nutné opět připojit {{Path|/boot}}. Ujistěte se také, že používáte správné bootovací zařízení namísto {{Path|/dev/sda}} .}}
</div>

{{Note|As previously mentioned, if GRUB2 was emerged with the <code>multislot</code> USE flag then {{c|grub2-install}} must be used instead of {{c|grub-install}}. In this case, after GRUB Legacy is removed from the system in the next step, GRUB2 should be re-emerged without the <code>multislot</code> USE flag so that {{c|grub-install}} and {{c|grub-mkconfig}} can become GRUB2 commands.}}

<div class="mw-translate-fuzzy">
{{RootCmd|grub2-install /dev/sda|output=<pre>
Installation finished. No error reported.
</pre>
}}
</div>

<div class="mw-translate-fuzzy">
Nyní může pomocí správce balíčků odstranit <code>sys-boot/grub:0</code>. {{RootCmd|emerge -avC "{{=}}sys-boot/grub-0.97*"|}}. Přechod je hotov.
</div> 

{{RootCmd|emerge -avC "{{=}}sys-boot/grub-0.97*"}}

The migration is now complete.

== Údržba GRUB2 ==

<div class="mw-translate-fuzzy">
Pokaždé, když nainstalujete nové jádro, musíte provést následující krok, aby bylo ze strany GRUB2 rozpoznáno (pokud nepoužíváte [[GRUB2_Quik_Start#Manual_Configuration|ruční konfiguraci]]).
</div> 

<div class="mw-translate-fuzzy">
{{Note/cs|Oddíl {{Path|/boot}} musí být připojen.}}
</div>

<div class="mw-translate-fuzzy">
{{RootCmd|grub2-mkconfig -o /boot/grub/grub.cfg|output=<pre>
Generating grub.cfg ...
Found linux image: /boot/kernel-3.3.8-gentoo
Found initrd image: /boot/initramfs-genkernel-x86_64-3.3.8-gentoo
Found linux image: /boot/kernel-3.2.12-gentoo
Found initrd image: /boot/initramfs-genkernel-x86_64-3.2.12-gentoo
done
</pre>
}}
</div>


[[Category:Bootloaders]]

{{Migrated|originalauthors=Cardoe}}
