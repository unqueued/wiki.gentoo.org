<languages />

{{InfoBox stack
|{{InfoBox homepage|http://hplipopensource.com/hplip-web/index.html|header=true}}
|{{InfoBox wikipedia|HP Linux Imaging and Printing}}
}}

'''HPLIP''' ('''HP''' '''L'''inux '''I'''maging and '''P'''rinting) предоставляет драйвера для принтеров HP. Также, она включает в себя поддержку сканера и факса, а также сервисные инструменты для различных периферийных устройств различного назначения.

== Действительно ли нужен HPLIP? ==

Использование HPLIP рекомендуется для большинства принтеров HP inkjet и laserjet. Однако, бывают устройства, работающие со стандартной установкой CUPS, которая предоставляет адекватные драйвера или PPD файлы.

Некоторые устройства имеют возможности, которые можно использовать только когда включен бинарный плагин. Этот плагин должен быть установлен дополнительно к драйверам. Поэтому, он необходим, когда используются эти возможности (например, лучшее качество печати, более быстрая печать или сканирование). Для более подробной информации смотрите раздел [[#Бинарные плагины|бинарные плагины]].

== Установка ==

{{Note|Все пользователи, которым нужно управлять принтерами, используя web-интерфейс или {{c|hp-setup}}, должны быть членами группы {{c|lpadmin}}. Редактирование файлов конфигурации CUPS текстовым редактором, однако, требует root привилегий. Для пользователей, которым нужна только печатать, никаких особых привилегий или членства в группах не требуется.}}

Для поддержки печатания, рекомендуется использовать новый драйвер hpcups, который можно включить USE-флагом <code>hpcups</code>. Старый драйвер hpijs всё ещё включен, если HPLIP компилируется с USE-флагом <code>hpijs</code>.

Стандартная установка разрешает динамически генерировать PPD-файлы во время выполнения. Некоторые принтеры всё же могут требовать статические PPD-файлы. Если возникают проблемы с {{c|hp-setup}}, попробуйте активировать USE-флаг <code>static-ppds</code> и переустановить HPLIP.

Для USB-принтеров {{Package|net-print/cups}} должен быть собран с USE-флагом <code>usb</code>. Таким образом он использует инструмент пользовательского пространства {{Package|dev-libs/libusb}}, который заменяет поддержку USB-принтера в ядре (<code>CONFIG_USB_PRINTER</code>). В случае возникновения проблем отключите USE-флаг <code>usb</code> для {{Package|net-print/cups}} и заново активируйте функциональность в ядре.

Чтобы была возможность настроить сетевой принтер, {{Package|net-print/cups-1.5}} должен быть собран с USE-флагом <code>avahi</code> или <code>slp</code>. Начиная с версии 1.6 {{Package|net-print/cups}} прекратил поддержку slp, и для выбора остались только USE-флаги <code>avahi</code> и <code>zeroconf</code>. Для того, чтобы печатать на сетевом принтере HPLIP должен быть собран с USE-флагом <code>snmp</code>. 

Для некоторых сканеров требуется активировать соответствующий back-end SANE. Чтобы определить какой back-end требуется для устройства, перейдите на страницу [http://www.sane-project.org/cgi-bin/driver.pl поиска драйверов] проекта SANE и поищите "HEWLETT-PACKARD" в поле manufacturer. Появится список всех поддерживаемых устройств с требуемым back-end'ом. Например, если устройство требует back-end hp, при установке {{Package|media-gfx/sane-backends}} к конфигурации portage необходимо добавить:

{{FileBox|filename=/etc/portage/make.conf|lang=bash|1=
SANE_BACKENDS="hp"
}}

{{Note|Back-end hpaio предоставляется самим HPLIP, если включен USE-флаг <code>scanner</code>. Если не требуется дополнительной настройки этого back-end'а, то должны быть определены следующие настройки в {{Path|/etc/sane.d/dll.conf}}.}}

{{FileBox|filename=/etc/sane.d/dll.conf|lang=bash|1=
# Add support for the HP-specific backend. Needs net-print/hplip installed.
hpaio
}}

=== Ядро ===

Устройства, подключённые через USB, требуют базовой поддержки USB в ядре. При использовании старого драйвера для USB-принтера, подразумевая, что USE-флаг <code>usb</code> ''не'' использовался в {{Package|net-print/cups}}, должны быть включены следующие опции ядра:

{{KernelBox|title=Optional: USB printer support|1=
Device Drivers  --->
    [*] USB support  --->
        <*> USB Printer support
}}

Этот драйвер может быть активирован как модуль, который будет называться <code>usblp</code>. Это также делает более удобным тестирование USE-флага <code>usb</code>, поскольку можно просто переключаться между 2 методами, отключая USE-флаг и загружая модуль ядра или включая USE-флаг и выгружая модуль ядра с помощью {{c|modprobe}}. Это экономит перекомпиляции ядра и перезагрузки; требуется только переустановить HPLIP для того, чтобы изменения USE-флага произвели эффект. Если модуль должен быть постоянно отключен, он может быть добавлен в чёрный список для предотвращения автоматической загрузки во время запуска системы.

Загрузите модуль ядра <code>usblp</code>:

{{RootCmd|modprobe usblp}}

Выгрузите модуль ядра <code>usblp</code>:

{{RootCmd|modprobe -r usblp}}

Добавьте модуль ядра <code>usblp</code> в чёрный список:

{{RootCmd|echo "blacklist usblp" >> /etc/modprobe.d/blacklist.conf}}

Устройствам, подключенным через параллельный порт, необходимы следующие опций ядра:

{{KernelBox|title=Optional: Parallel port printer support|1=
Device Drivers  --->
    <*> Parallel port support  --->
        <*>   PC-style hardware
        [*]   IEEE 1284 transfer modes
    Character devices  --->
        <*> Parallel printer support
}}

Оба вышеупомянутых способа обычно уже включены в большинстве ядер.

Устройства, подключенные по сети, не требуют особых драйверов ядра, но все еще требуется базовая поддержка сети.

=== Программное обеспечение ===

Следующая таблица показывает текущие USE-флаги для {{Package|net-print/hplip}}:

{{USEflag|package=net-print/hplip}}

Установите {{Package|net-print/hplip}}:

{{Emerge|hplip}}

{{Note|Перед установкой hplip, убедитесь, что установили необходимые USE-флаги. Например, для сетевых принтеров, может понадобится флаг <code>snmp</code>. Если он не указан глобально, укажите его для пакета hplip:
{{Emerge|echo "net-print/hplip snmp" >> /etc/portage/package.use}}
}}

== Конфигурация ==

=== Принтеры и факсы ===

{{Note|Убедитесь, что USB-принтер подключен к компьютеру или сетевой принтер к сетевому сокету.}}

Если HPLIP был установлен с включенным USE-флагом <code>qt4</code>, используйте "HP Device Manager" для настройки устройств.

В качестве альтернативы выполните {{c|hp-setup}} в терминале:

{{RootCmd|hp-setup}}

Для сетевого принтера, также укажите его IP-адрес:

{{RootCmd|hp-setup -i 192.168.1.27}}

После этого, перезапустите CUPS:

{{RootCmd|rc-service cupsd restart}}

=== Сканеры ===

В итоге, сканеры должны работать и определяться в XSane и др.

== Тестирование ==

=== Принтер ===

После завершения {{c|hp-setup}}, он должен позволить распечатать тестовую страницу. Это может быть сделано позже с использованием "HP Device Manager" или web-интерфейса CUPS, который находится по адресу http://localhost:631/.

=== Сканер ===

Чтобы убедиться, что драйвер сканера установлен и правильно работает, запустите {{c|xsane}} и затем нажмите кнопку предварительного просмотра.

== Обновление ==

Каждый раз после обновления HPLIP рекомендуется выполнить <kbd>hp-setup -r</kbd>, чтобы удалить все принтеры и настроить их заново, как описано выше в разделе конфигурация.

== Бинарные плагины ==

Некоторым устройствам необходимы бинарный плагин для использования всех предлагаемых ими функций. Список таких устройств, включая причины, по которым требуется бинарный плагин, доступен на [http://hplipopensource.com/hplip-web/plugin.html домашней странице] проекта. В настоящее время Gentoo не поддерживает бинарные плагины. Однако, {{c|hp-setup}} пытается установить их автоматически.

Установленные файлы находятся за пределами контроля portage и находятся в {{Path|/usr/share/hplip/data/firmware/}}, {{Path|/usr/share/hplip/data/plugins/}} и {{Path|/usr/share/hplip/prnt/plugins/}}. Для установки плагина без настройки очередей печати доступна команда {{c|hp-plugin}}.

Если установить плагин с помощью {{c|hp-setup}} или {{c|hp-plugin}} не удалось, можно загрузить установщик [http://www.openprinting.org/download/printdriver/auxfiles/HP/plugins/ на сайте openprinting]. Для установки плагина необходимо выполнить загруженный файл {{Path|.run}} в оболочке:

{{RootCmd|sh hplip-version-plugin.run}}

Затем следуйте инструкциям установщика по аналогии с {{c|hp-setup}} или {{c|hp-plugin}}.

== Устранение проблем ==

=== Принтер не найден ===

'''Проблема''': {{c|hp-setup}} или HP Device Manager не нашел сетевой принтер.

'''Решение''': Проверьте, что у пакета {{Package|net-print/hplip}} включен USE-флаг <code>snmp</code> и SNMP включено в настройках принтера.

=== Печать приостановлена ===

'''Проблема''': Печать начинается не сразу после отправки задания печати.

'''Решение''': Проверьте административный интерфейс принтера CUPS и убедитесь что принтер не стоит в состоянии паузы.

=== Ошибка при установке "File "./plugin_install.py", line 78 except ImportError, e:" ===

'''Проблема''': Происходит следующая ошибка:

{{RootCmd|hp-setup -i 192.168.1.27|output=<pre>
[...SNIP...]
 
----------------------
| INSTALLING PLUG-IN |
----------------------
 
Verifying archive integrity... All good.
Uncompressing HPLIP 3.12.10a Plugin Self Extracting Archive.....................................................
  File "./plugin_install.py", line 78
    except ImportError, e:
                      ^
SyntaxError: invalid syntax
error: Python gobject/dbus may be not installed
</pre>}}

'''Решение''': Python 3 установлен как основной интерпретатор для python. В настоящее время HPLIP не работает корректно с Python 3. Переключитесь на Python 2 с помощью команды {{c|eselect python}}, чтобы решить эту ошибку.

Дополнительная информация на {{Bug|718069|site=launchpad}}

=== Обновление ebuild'а HPLIP не обновляет бинарные плагин(ы) ===

'''Проблема''': ebuild HPLIP не обновляет бинарные плагин(ы) после обновления ebuild'а. Признак проблемы: при запуске XSane может произойти ошибка сегментации (т.е. HP LaserJet M1522nf требует бинарный плагин для использования возможности сканирования).

'''Решение 1''': Следование инструкциям по обновлению должно решить эту проблему, поскольку {{c|hp-setup}} пытается обновить плагин. Если проблемы до сих пор остались, в HPLIP присутствует команда {{c|hp-plugin}}, которую можно использовать для установки плагина. В крайнем случае можно загрузить плагин с сайта [http://www.openprinting.org/download/printdriver/auxfiles/HP/plugins/ OpenPrinting] и установить его вручную.

'''Решение 2''': Если HPLIP был собран с USE-флагом <code>qt4</code>, выполнение {{c|hp-info}} через терминал пользователя автоматически обнаружит конфликт версии бинарной части установленного драйвера и предложит пользователю обновить его, запросив также root пароль через виджет qt4.

=== Печать необычных символов ===

'''Проблема''': Распечатка содержит странно выглядящие символы.

'''Решение''': Принтер скорее всего не может обрабатывать вывод Postscript Level 3. Чтобы обойти это ограничение, отредактируйте PPD файл принтера и замените <code>*LanguageLevel: "3"</code> на <code>*LanguageLevel: "2"</code>.

Смотрите {{Bug|277404|site=launchpad}}, который был открыт в 2008, и {{Bug|19640|site=fdo}} для более подробной информации.

{{Note|{{Bug|277404|site=launchpad}} не был исправлен в {{=}}net-print/hplip-3.13, и в установленных PPD файлах до сих пор назначен "LanguageLevel 3", несмотря на то, что конкретные принтеры HP не поддерживают 3 уровень.}}

{{Note|Даже Microsoft Windows печатает, используя Postscript Language Level 2. Хотя графический пользовательский интерфейс может отображать 3 уровень, программы всё равно будут печатать на 2 уровне.}}

{{Note|Иногда использование Infinality может вызвать неизвестные проблемы. Если ничего не работает, попробуйте отключить Infinality.}}

=== SANE/XSANE не находит сканер hpaio ===

'''Проблема''': SANE или XSANE до сих пор не может найти сканер на основе hpaio.

'''Решение''': SANE/XSANE <code>SANE_BACKENDS</code> и {{Package|media-gfx/sane-backends}} используются для того, чтобы потребовать <code>hp</code> или USE-флаг <code>hp</code>. В данный момент, 'hp' sane-backend больше не нужен для доступа к устройствам HPLIP hpaio. Также, если никакие устройства <code>SANE_BACKENDS</code> не указаны в {{Path|/etc/portage/make.conf}}, почти все устройства sane-backend компилируются по умолчанию во время установки пакета {{Package|media-gfx/sane-backends}}. Это противоречит основному принципу работы USE-флагов и замедляет очень длительную компиляцию на платформах x86.

Может быть благоразумно всё-таки установить <code>SANE_BACKENDS="hp"</code> (или, по крайней мере, нескольким драйверам, даже если они не нужны) в файле {{Path|/etc/portage/make.conf}} или в USE-флагах пакета. Также существует старый формат <code>SANE_BACKENDS="sane_backends_hp"</code>, поэтому убедитесь, что конфигурация адаптирована под новый формат.

Более актуальное и значимое направление поиска решения этой проблемы: убедиться, что пользователь находиться в группах {{c|scanner}}, {{c|usb}} и/или {{c|lp}} в файле {{Path|/etc/groups}}. Если {{c|scanimage -L}} и {{c|hp-scan}} работает от имени root, то что-то не так с разрешениями. Если сканировать не удаётся даже от root, особенно с {{c|hp-scan}}, убедитесь, что плагин правильно установлен/обновлён, а устройство подключено.

Ещё одно область для проверки, когда всё вышеперечисленное настроено правильно: убедитесь, что пользователь может читать файлы в {{Path|/etc/sane.d/}} (особенно {{Path|/etc/sane.d/dll.conf}}).

{{Note|Ни {{c|hp-scan -g}} HPLIP, ни {{c|scanimage -L}} SANE не сообщают никакой полезной информации касательно проблем с разрешениями.}}

Когда ничего не удаётся, {{c|strace}}, содержащийся в {{Package|dev-util/strace}}, может предоставить более подробные отчёты, но объяснения, как работать с strace, выходят за рамки этого руководства.

== Смотрите также ==

* [[Printing/ru|Руководство по печати Gentoo]]

== Внешние ресурсы ==

* [https://launchpad.net/hplip HPLIP на launchpad]
* [https://bugs.launchpad.net/hplip Launchpad bug tracker]
* [https://answers.launchpad.net/hplip ответы на Launchpad]
* [http://hplipopensource.com/node/224 раздел устранение ошибок в базе знаний HPLIP]

[[Category:Printing]]
[[Category:Software]]
