<languages />

{{InfoBox stack
|{{InfoBox homepage|http://hplipopensource.com/hplip-web/index.html|header=true}}
|{{InfoBox wikipedia|HP Linux Imaging and Printing}}
}}

'''HPLIP''' ('''HP''' '''L'''inux '''I'''maging and '''P'''rinting) предоставляет драйвера для принтеров HP. Также, она включает в себя поддержку сканера и факса, а также сервисные инструменты для различных периферийных устройств различного назначения.

== Действительно ли нужен HPLIP? ==

Использование HPLIP рекомендуется для большинства принтеров HP inkjet и laserjet. Однако, бывают устройства, работающие со стандартной установкой CUPS, которая предоставляет соответствующие драйвера или PPD файлы.

Некоторые устройства имеют возможности, которые можно использовать только когда включен бинарный плагин. Этот плагин должен быть установлен в дополнение к драйверам. Поэтому, он является необходимым, когда используются эти возможности (например, лучшее качество печати, более быстрая печать или сканирование). Для более подробной информации см. раздел [[#Binary plugins|бинарные плагины]].

== Установка ==

{{Note|Все пользователи, которым нужно управлять принтерами, используя web-интерфейс или {{c|hp-setup}}, должны быть членами группы {{c|lpadmin}}. Редактирование файлов конфигурации CUPS текстовым редактором, однако, требует root привилегий. Для пользователей, которым нужно только печатать, никаких особых привилегий или членства в группах не требуется.}}

Для поддержки печатания, рекомендуется использовать новые драйвера hpcups, которые могут быть задействованы USE-флагом <code>hpcups</code>. Старый драйвер hpijs всё ещё включен, если HPLIP компилируется с USE-флагом <code>hpijs</code>.

Стандартная установка разрешает динамически генерировать PPD файлы во время выполнения. Некоторые принтеры всё же могут требовать статические PPD файлы. Если возникают проблемы с {{c|hp-setup}}, попробуйте активировать USE-флаг <code>static-ppds</code> и переустановить HPLIP.

Для USB принтеров {{Package|net-print/cups}} должен быть собран с USE-флагом <code>usb</code>. Таким образом он использует инструмент пользовательского пространства {{Package|dev-libs/libusb}}, который заменяет поддержку USB принтера в ядре (<code>CONFIG_USB_PRINTER</code>). В случае возникновения проблем отключите USE-флаг <code>usb</code> для {{Package|net-print/cups}} и заново активируйте функциональность в ядре.

Чтобы была возможность настроить сетевой принтер, {{Package|net-print/cups-1.5}} должен быть собран с USE-флагом <code>avahi</code> или <code>slp</code>. Начиная с версии 1.6 {{Package|net-print/cups}} прекратил поддержку slp, и для выбора остались только USE-флаги <code>avahi</code> и <code>zeroconf</code>. Для того, чтобы печатать на сетевом принтере HPLIP должен быть собран с USE-флагом <code>snmp</code>. 

Для некоторых сканеров требуется активировать соответствующий back-end SANE. Чтобы определить какой back-end требуется для устройства, перейдите на страницу [http://www.sane-project.org/cgi-bin/driver.pl поиска драйверов] проекта SANE и поищите "HEWLETT-PACKARD" в поле manufacturer. Появится список всех поддерживаемых устройств с требуемым back-end'ом. Например, если устройство требует back-end hp, при установке {{Package|media-gfx/sane-backends}} к конфигурации portage необходимо добавить:

{{FileBox|filename=/etc/portage/make.conf|lang=bash|1=
SANE_BACKENDS="hp"
}}

{{Note|Back-end hpaio предоставляется самим HPLIP, если включен USE-флаг <code>scanner</code>. Если не требуется дополнительной настройки этого back-end'а, то должны быть определены следующие настройки в {{Path|/etc/sane.d/dll.conf}}.}}

{{FileBox|filename=/etc/sane.d/dll.conf|lang=bash|1=
# Add support for the HP-specific backend. Needs net-print/hplip installed.
hpaio
}}

=== Ядро ===

Устройства, подключённые через USB, требуют базовой поддержки USB в ядре. При использовании старого драйвера USB принтера, что означает ''не'' использовать USE-флаг <code>usb</code> в {{Package|net-print/cups}}, должны быть включены следующие опции ядра:

{{KernelBox|title=Optional: USB printer support|1=
Device Drivers  --->
    [*] USB support  --->
        <*> USB Printer support
}}

Этот драйвер может быть активирован как модуль, который будет называться <code>usblp</code>. Это также делает более удобным тестирование USE-флага <code>usb</code>, поскольку можно просто переключаться между 2 методами, отключая USE-флаг и загружая модуль ядра или включая USE-флаг и выгружая модуль ядра с помощью {{c|modprobe}}. Это экономит перекомпиляции ядра и перезагрузки; требуется только переустановить HPLIP для того, чтобы изменения USE-флага произвели эффект. Если модуль должен быть постоянно отключен, он может быть добавлен в чёрный список для предотвращения автоматической загрузки во время запуска системы.

Загрузите модуль ядра <code>usblp</code>:

{{RootCmd|modprobe usblp}}

Выгрузите модуль ядра <code>usblp</code>:

{{RootCmd|modprobe -r usblp}}

Добавьте модуль ядра <code>usblp</code> в чёрный список:

{{RootCmd|echo "blacklist usblp" >> /etc/modprobe.d/blacklist.conf}}

Устройства, подключенные через параллельный порт требуют следующих опций ядра:

{{KernelBox|title=Optional: Parallel port printer support|1=
Device Drivers  --->
    <*> Parallel port support  --->
        <*>   PC-style hardware
        [*]   IEEE 1284 transfer modes
    Character devices  --->
        <*> Parallel printer support
}}

Оба вышеупомянутых способа обычно уже включены в большинстве ядер.

Устройства, подключенные по сети, не требуют особых драйверов ядра, но все еще требуется базовая поддержка сети.

=== Программное обеспечение ===

Следующая таблица показывает текущие USE-флаги для {{Package|net-print/hplip}}:

{{USEflag|package=net-print/hplip}}

Установите {{Package|net-print/hplip}}:

{{Emerge|hplip}}

{{Note|Перед установкой hplip, убедитесь, что установили необходимые USE-флаги. Например, для сетевых принтеров, может понадобится флаг <code>snmp</code>. Если он не указан глобально, укажите его для пакета hplip:
{{Emerge|echo "net-print/hplip snmp" >> /etc/portage/package.use}}
}}

== Конфигурация ==

=== Принтеры и факсы ===

{{Note|Убедитесь, что USB-принтер подключен к компьютеру или сетевой принтер к сетевому сокету.}}

Если HPLIP был установлен с включенным USE-флагом <code>qt4</code>, используйте "HP Device Manager" для настройки устройств.

В качестве альтернативы выполните {{c|hp-setup}} в терминале:

{{RootCmd|hp-setup}}

Для сетевого принтера, также укажите его IP-адрес:

{{RootCmd|hp-setup -i 192.168.1.27}}

После этого, перезапустите CUPS:

{{RootCmd|rc-service cupsd restart}}

=== Сканеры ===

В итоге, сканеры должны работать и определяться в XSane и др.

== Тестирование ==

=== Принтер ===

После завершения {{c|hp-setup}}, он должен позволить распечатать тестовую страницу. Это может быть сделано позже с использованием "HP Device Manager" или web-интерфейса CUPS, который находится по адресу http://localhost:631/.

=== Сканер ===

Обратитесь к {{c|xsane}} и нажмите кнопку предварительного просмотра, чтобы убедиться, что драйвер сканера установлен и правильно работает.

== Обновление ==

Every time after upgrading HPLIP it is advised to run <kbd>hp-setup -r</kbd> to remove all printers and configure them again as described above in the configuration section.

== Бинарные плагины ==

There are some devices which require a binary plugin to use all functions the device provides. A list with devices requiring a binary plugin including the reasons why it is needed is available at the project's [http://hplipopensource.com/hplip-web/plugin.html homepage]. Gentoo currently does not support the binary plugin. However, {{c|hp-setup}} tries to automatically install the plugin.

The installed files are out of portage's control and are located under {{Path|/usr/share/hplip/data/firmware/}}, {{Path|/usr/share/hplip/data/plugins/}} and {{Path|/usr/share/hplip/prnt/plugins/}}. For installing just the plugin without configuring printer queues {{c|hp-plugin}} is available.

If installing the plugin with {{c|hp-setup}} or {{c|hp-plugin}} fails, the plugin installer is available for download [http://www.openprinting.org/download/printdriver/auxfiles/HP/plugins/ at the openprinting site]. To install the plugin the downloaded {{Path|.run}} file has to executed in a shell:

{{RootCmd|sh hplip-version-plugin.run}}

Afterwards follow the instructions of the installer similar to {{c|hp-setup}} or {{c|hp-plugin}}.

== Устранение проблем ==

=== Печать приостановлена ===

'''Проблема''': Печать начинается не сразу после отправки задания печати.

'''Решение''': Проверьте административный интерфейс принтера CUPS и убедитесь что принтер не стоит в состоянии паузы.

=== Ошибка при установке "File "./plugin_install.py", line 78 except ImportError, e:" ===

'''Проблема''': Происходит следующая ошибка:

{{RootCmd|hp-setup -i 192.168.1.27|output=<pre>
[...SNIP...]
 
----------------------
| INSTALLING PLUG-IN |
----------------------
 
Verifying archive integrity... All good.
Uncompressing HPLIP 3.12.10a Plugin Self Extracting Archive.....................................................
  File "./plugin_install.py", line 78
    except ImportError, e:
                      ^
SyntaxError: invalid syntax
error: Python gobject/dbus may be not installed
</pre>}}

'''Решение''': Python 3 установлен как основной интерпретатор для python. В настоящее время HPLIP не работает корректно с Python 3. Переключитесь на Python 2 с помощью команды {{c|eselect python}}, чтобы решить эту ошибку.

Дополнительная информация на {{Bug|718069|site=launchpad}}

=== Обновление ebuild'а HPLIP не обновляет бинарные плагин(ы) ===

'''Problem''': The HPLIP ebuild itself does not upgrade the binary plugin(s) when the ebuild is upgraded.  A symptom of this problem: segmentation faults might occur when starting XSane. (i.e. The HP LaserJet M1522nf requires a binary plugin for using the scanning feature.)

'''Solution 1''': Following the upgrade instructions should take care of this as {{c|hp-setup}} tries to upgrade the plugin. If there are still problems HPLIP comes with {{c|hp-plugin}} which can be used for installing the plugin. As a last resort one can download the plugin from [http://www.openprinting.org/download/printdriver/auxfiles/HP/plugins/ OpenPrinting] and install it manually.

'''Solution 2''': Lately, running {{c|hp-info}} (with HPLIP built with the <code>qt4</code> USE flag) via a user terminal will eventually auto detect the version conflict of the binary part of the installed driver and ask the user to automatically upgrade, including issuing a prompt for the root password via a qt4 widget prompt.

=== Printing weird characters ===

'''Problem''': The printout contains weird looking characters.

'''Solution''': The printer likely cannot handle Postscript Level 3 output. To work around this, edit the printer's PPD file and change <code>*LanguageLevel: "3"</code> to <code>*LanguageLevel: "2"</code>.

See {{Bug|277404|site=launchpad}} which was opened in 2008 and {{Bug|19640|site=fdo}} for more information.

{{Note|{{Bug|277404|site=launchpad}} has not been fixed as of {{=}}net-print/hplip-3.13, and the PPD file installed is still being assigned "LanguageLevel 3" when specific HP printers do not support level 3.}}

{{Note|Even Microsoft Windows prints using Postscript Language Level 2. Even though the graphical interface might state Level 3, the graphic interface is wrong and instead the code is hacked to print at Level 2.}}

{{Note|Sometimes using Infinality can create some unknown issues. If nothing works, try disabling Infinality.}}

=== SANE/XSANE не находит сканер hpaio ===

'''Проблема''': SANE или XSANE до сих пор не может найти сканер, основанный на hpaio.

'''Solution''': SANE/XSANE <code>SANE_BACKENDS</code> or {{Package|media-gfx/sane-backends}} used to require <code>hp</code> or the <code>hp</code> USE flag.  Currently, the 'hp' sane-backend appears no longer needed for accessing HPLIP hpaio devices.  Also, if no <code>SANE_BACKENDS</code> devices are specified within the {{Path|/etc/portage/make.conf}}, almost all sane-backend devices are compiled by default during compilation of {{Package|media-gfx/sanebackends}} package.  This appears to go against the main purpose of the USE flag function and inhibits a very long compilation on x86 platforms.

It may be prudent to still insert <code>SANE_BACKENDS="hp"</code> (or at least some driver even though it is not needed) within the {{Path|/etc/portage/make.conf}} file or within the package USE flags.  There also used to be an older <code>SANE_BACKENDS="sane_backends_hp"</code> format, so ensure that the configuration is adapted towards the newer format.

More current and relevant areas to check for resolving this specific problem: make sure the user is in the {{c|scanner}}, {{c|usb}} and/or {{c|lp}} groups of the {{Path|/etc/groups}} file.  If {{c|scanimage -L}} and the HPLIP {{c|hp-scan}} work as root, something must be awry with permissions. If even scanning as root fails, especially with HPLIP's {{c|hp-scan}}, check to ensure the plugin is properly installed/updated and the device is connected.

One more area to check when all of the above is set up correctly: make sure the user can read files within {{Path|/etc/sane.d/}} (specifically the {{Path|/etc/sane.d/dll.conf}} file).

{{Note|Neither HPLIP's {{c|hp-scan -g}} nor SANE's {{c|scanimage -L}} reported any useful information concerning this permissions problem.}}

When all else fails, {{c|strace}} (as provided by {{Package|dev-util/strace}}) may provide more in-depth feedback, but explaining how to work with strace is out of scope for this document.

== Смотрите также ==

* [[Printing/ru|Руководство по печати Gentoo]]

== Внешние ресурсы ==

* [https://launchpad.net/hplip HPLIP at launchpad]
* [https://bugs.launchpad.net/hplip Lauchpad bug tracker]
* [https://answers.launchpad.net/hplip Launchpad answers]
* [http://hplipopensource.com/node/224 Troubleshooting section of the HPLIP knowledge database]

[[Category:Printers]]
[[Category:Software]]
