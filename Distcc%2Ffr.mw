<languages />

Distcc est un programme conçu pour répartir les tâches de compilation à travers un réseau à des hôtes participants. Il comprend un serveur, <code>distccd</code> et un client, <code>distcc</code>. Distcc peut travailler en toute transparence avec [http://ccache.samba.org ccache], Portage et Automake moyennant un minimum de configuration. 

Si vous envisagez d'utiliser distcc pour vous aider à préparer la chaîne des outils de compilation pour  une installation de Gentoo, lisez d'abord la section [[#Utiliser_Distcc_pour_compiler_les_outils_de_compilation|Utiliser  Distcc pour compiler les outils de compilation]]. 

== Configuration ==

=== Dépendances ===

Afin d'utiliser Distcc, tous les ordinateurs sur votre réseau doivent posséder la même version de GCC. Pour être plus précis, mélanger 3.3.x (avec x variable) est accepté, mais mélanger 3.3.x avec 3.2.x '''peut''' conduire à des erreurs de compilation ou des erreurs en exécution. 

=== Installer Distcc ===

Il y a quelques options dont vous devriez être conscient avec d'installer distcc. 

Distcc arrive avec un surveillant graphique pour surveiller les tâches que votre ordinateur envoie à l'extérieur pour compilation. Si vous utilisez Gnome, alors mettez 'gnome' dans les options de votre variable USE. Cependant, si vous n'utilisez pas Gnome et désirez quand-même avoir le surveillant, vous devriez mettre 'gtk' dans ces options. 

{{Emerge|distcc}}

{{Important|Rappelez-vous que vous devez installer distcc sur tous les ordinateurs participants.}}

=== Configurer  Portage pour l'utilisation de  Distcc ===

Configurer Portage pour l'utilisation de distcc est simple. Exécutez les étapes suivantes sur chacun des systèmes qui devraient participer à la compilation distribuée : 

{{Emerge|distcc}}

Maintenant, définissez les variables <code>MAKEOPTS</code> et <code>FEATURES</code> comme indiqué ci-dessous. Pour <code>MAKEOPTS</code>, utilisez un nombre convenable pour votre configuration particulière. Une stratégie courante est de définir N comme étant deux fois le nombre de total de processeurs disponibles +1.

{{RootCmd|nano -w /etc/portage/make.conf|output=<pre>
MAKEOPTS="-jN"
FEATURES="distcc"
</pre>
}}

=== Spécifier les hôtes participants  ===

Utilisez la commande <code>distcc-config</code> pour définir la liste des participants. Voici un exemple de quelques hôtes qui pourraient se trouver dans votre liste : 

{{Code|Exemples de définition d'hôtes participant|<pre>
192.168.0.1          192.168.0.2                       192.168.0.3
192.168.0.1/2        192.168.0.2                       192.168.0.3/10
192.168.0.1:4000/2   192.168.0.2/1                     192.168.0.3:3632/4
@192.168.0.1         @192.168.0.2:/usr/bin/distccd     192.168.0.3
</pre>
}}

Il y a aussi plusieurs autres méthodes pour définir les hôtes. Reportez-vous à la page de manuel pour plus de détail.

Si vous désirez compiler sur la machine locale, vous devriez mettre 'localhost' dans la liste des participants. Inversement, si vous ne voulez pas que la machine locale participe (ce qui est souvent le cas) omettez la de la liste. Sur une machine lente, utiliser localhost peut ralentir les choses. Vérifiez la performance de votre configuration.

Cela peut paraître compliqué, mais dans la plupart des cas, une variante des lignes 1 ou 2 fonctionne. 

Comme la plupart des gens n'utilisent pas les lignes 3 ou 4, reportez-vous à [http://distcc.samba.org/man/distcc_1.html à la documentation de distcc] (man distcc) pour une information plus complète qui inclut comment exécuter distcc à travers une connexion SSH. 

Par exemple, pour définir la première ligne de l'exemple précédent : 

{{RootCmd|/usr/bin/distcc-config --set-hosts "192.168.0.1 192.168.0.2 192.168.0.3"}}

Éditez le fichier  {{Path|/etc/conf.d/distccd}} en fonction de vos besoins et assurez-vous de définir la directive <code>--allow</code> pour seulement les hôtes auxquels vous accordez votre confiance. Pour une sécurité renforcée, vous devriez utiliser  aussi la directive  <code>--listen</code> afin de dire au démon distcc quelles adresses IP écouter (pour des systèmes multi-adresses). Une information complémentaire sur la sécurité avec distcc est disponible à l'adresse [http://distcc.samba.org/security.html Distcc Security Design] . 

{{Important|Il est important d'utiliser --allow et --listen. Lisez la page de manuel de distcc (distccd manpage) ou le document cité précédemment sur la sécurité pour en savoir plus. }}

Maintenant démarrez votre démon distcc sur tous les ordinateurs participants : 

{{RootCmd|rc-update add distccd default
|/etc/init.d/distccd start}}

=== Configurer  Distcc pour qu'il fonctionne avec Automake ===

Ceci est, dans certains cas, plus facile que de configurer Portage. Ce que vous avez à faire, c'est mettre votre variable <code>PATH</code> à jour pour qu'elle inclut  {{Path|/usr/lib/distcc/bin}} en face du répertoire qui contient  <code>gcc</code> ( {{Path|/usr/bin}} ). Cependant, il faut savoir que si vous utilisez ''ccache'', vous devez placer ''distcc'' après la partie ''ccache'' : 

{{RootCmd|export PATH{{=}}"/usr/lib/ccache/bin:/usr/lib/distcc/bin:${PATH}"}}

Vous pouvez placer ceci dans votre fichier {{Path|~/.bashrc}},  ou son équivalent, pour avoir une variable PATH définie à chaque entrée dans la session.

Ensuite, là où vous taperiez normalement  <code>make</code> , vous devriez taper  <code>make -jN</code> (où N est un entier). 

== Compilation croisée ==

La compilation croisée consiste à  compiler les programmes sur une architecture pour les exécuter sur une autre architecture. C'est aussi simple que d'utiliser un Athlon (i686) pour compiler les programmes destinés à un K6-2 (i586), ou d'utiliser un Sparc pour compiler un programme destiné à un ppc. Ceci est documenté dans notre [http://www.gentoo.org//doc/fr/cross-compiling-distcc.xml guide de compilation croisée avec DistCC]. 

== Utiliser  Distcc pour compiler les outils de compilation ==

=== Étape 1: Configurer Portage ===

Démarrez votre nouvel machine avec un LiveCD de Gentoo et suivez les [http://www.gentoo.org/doc/fr/handbook/handbook-x86.xml?part=1 instructions d'installation] jusqu'à la partie compiler la chaîne des outils de compilation (bootstraping). Puis configurer Portage pour l'utilisation de distcc : 

{{RootCmd|nano -w /etc/portage/make.conf|output=<pre>
FEATURES="distcc"
MAKEOPTS="-jN"
</pre>
}}

{{RootCmd|export PATH{{=}}"/usr/lib/ccache/bin:/usr/lib/distcc/bin:${PATH}"}}

=== Étape 2: Obtenir Distcc ===

Installez distcc: 

{{RootCmd|USE{{=}}'-*' emerge --nodeps sys-devel/distcc}}

=== Étape 4: Configurer Distcc ===

Exécutez  <code>distcc-config --install</code> pour configurer distcc ; remplacez  <code>host*</code> par l'adresse  IP ou le nom d'hôte des nœuds participants de distcc.

{{RootCmd|/usr/bin/distcc-config --set-hosts "localhost host1 host2 host3 ..."}}

Distcc est désormais configuré pour la compilation de la chaîne des outils de compilation ! Continuez avec l'installation officielle et ''n'oubliez pas'' de ré-installer distcc après <code>emerge system</code> . Ceci pour être sûr que toutes des dépendances désirées sont aussi installées. 

{{Note|Pendant la compilation de la chaîne des outils de compilation et l'exécution de <code>emerge system</code>, distcc peut apparaître comme non utilisé. Ceci n'est pas surprenant dans la mesure où quelques ebuilds ne fonctionnent pas bien avec distcc et  le désactivent intentionnellement. }}

== Dépannage ==

=== Quelques paquets n'utilisent pas Distcc ===

Tandis que vous installez des paquets divers, vous noterez que la compilation de quelques uns d'entre-eux n'est pas distribuée (et qu'ils ne sont pas compilés en parallèle). Ceci peut arriver parce que le Makefile du paquet ne prend pas en charge  les opérations en parallèle ou que le mainteneur de l'ebuild a explicitement désactivé les opérations en parallèle à cause de problèmes identifiés. 

Parfois, distcc peut provoquer un échec de la compilation d'un paquet. Si cela vous arrive, [http://bugs.gentoo.org rapportez-le] nous. 

=== Verisons mélangées de  GCC  ===

Si vous avez différentes versions de GCC sur vos hôtes, vous rencontrerez très probablement d'étranges problèmes. La solution est d'installer la même version de GCC sur tous les hôtes. 

Des mises à jour récentes de Portage ont fait que Portage utilise  <code>${CHOST}-gcc</code> à la place de  <code>gcc</code>. Ceci signifie que si vous mélangez des machines i686 avec d'autres types de machines (i386, i586), vous allez rencontrer des problèmes. Un façon de contourner cela peut être d'utiliser la commande <code>export CC='gcc' CXX='c++'</code> ou de la mettre dans votre fichier {{Path|/etc/portage/make.conf}} . 

{{Important|Faire ceci explicitement redéfinit quelques comportements de Portage et peut avoir d'étranges conséquences dans le futur. Ne faites cela que si vous utilisez des   ''CHOSTs'' différents. }}

=== -march=native ===

Depuis  GCC 4.3.0, le compilateur prend en charge le commutateur  <code>-march=native</code> qui active la détection automatique du processeur et les optimisations qui valent la peine d'être activées pour le processeur sur lequel GCC tourne. Ceci est un problème avec <code>distcc</code> dans la mesure où ça autorise le mélange de code  optimisés pour différents processeurs (comme AMD Athlon et Intenl Pentium). ''N'utilisez-pas'' <code>-march=native</code> ou <code>-mtune=native</code> dans les options de votre variable <code>CFLAGS</code> lorsque vous compilez avec <code>distcc</code>. 

== Compléments à Distcc  ==

=== Surveillants Distcc  ===

Distcc est fourni avec deux surveillants. Le surveillant textuel est toujous compilé et est appelé  <code>distccmon-text</code>. L'exécuter pour la première fois peut générer un peu de trouble, mais il est réellement facile à utiliser. Si vous exécutez le programme sans paramètre, il s'exécutera une fois. Cependant, si vous lui passez un nombre N, il fera une mise à jour toute les N secondes. 

L'autre surveillant n'est activé que si vous avez activé les options  <code>gtk</code> ou <code>gnome</code> de votre variable  <code>USE</code>. Celui-ci est basé sur GTK+, tourne dans un environnement X et est très agréable. Pour Gentoo, le surveillant graphique a été appelé <code>distccmon-gui</code>  pour éviter les confusions. Dans d'autres distributions, il peut être appelé <code>distccmon-gnome</code>. 

{{RootCmd|distccmon-text N}}

ou exécutez <code>distccmon-gui</code>:

{{RootCmd|distccmon-gui}}

Pour surveiller l'utilisation du distcc de Portage, vous pouvez utiliser :
{{RootCmd|DISTCC_DIR{{=}}"/var/tmp/portage/.distcc/" distccmon-text N
|DISTCC_DIR{{=}}"/var/tmp/portage/.distcc/" distccmon-gui}}

{{Important|Si votre répertoire distcc se trouve ailleurs, changez la variable  DISTCC_DIR en conséquence.}}

== Acknowledgements ==

We would like to thank the following authors and editors for their contributions to this guide:

* Lisa Seelye
* Mike Frysinger
* Erwin
* Sven Vermeulen
* Lars Weiler
* Tiemo Kieft
* nightmorph
