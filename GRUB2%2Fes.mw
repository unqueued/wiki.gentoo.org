<languages />
{{InfoBox stack
|{{InfoBox homepage|http://www.gnu.org/software/grub/|header=true}}
|{{InfoBox wikipedia|GNU_GRUB#GRUB 2}}
|{{InfoBox gitweb|http://git.savannah.gnu.org/cgit/grub.git/|raw=true}}
|{{InfoBox odoc|http://www.gnu.org/software/grub/grub-documentation.html}}
}}

'''GRUB2''' es un cargador de arranque con soporte para los modernos sistemas informáticos de hoy en día. Está destinado a sustituir al antiguo gestor de arranque [[GRUB]] (ahora denominado «GRUB Legacy»). GRUB2 tiene una base de código totalmente independiente con respecto a GRUB Legacy y cuenta con características tales como una nueva sintaxis de shell que permite capacidades avanzadas en el lenguaje de programación de scripts. Se anima a los actuales usuarios de GRUB Legacy a migrar sus sistemas a GRUB2.

Para una primera aproximación, vea [[GRUB2 Quick Start]].

== Instalación ==

El paquete {{Package|sys-boot/grub}} viene integrado con ambas versiones. Tanto grub-0.97 ([[GRUB|GRUB Legacy]]) como grub-2.00 pueden ser instalados conjuntamente en el sistema, sin embargo, solo una de las versiones de GRUB puede ser instalada en un [http://es.wikipedia.org/wiki/Registro_de_arranque_principal MBR] a la vez.

=== Requisitos previos ===

De forma predeterminada, GRUB2 intentará determinar la plataforma de destino durante su propia construcción. Este valor puede alterarse definiendo la variable <var>GRUB_PLATFORMS</var> en {{Path|make.conf}}.

{{FileBox|filename=/etc/portage/make.conf|title=Ejemplo de configuración de variable GRUB_PLATFORMS para soporte EMU, EFI y PC|lang=bash|1=
GRUB_PLATFORMS="emu efi-32 efi-64 pc"
}}

Las siguientes plataformas son compatibles dependiendo de la CPU de destino:

{| class="table"
!
! colspan="7" | Target
|-
! Platform
! i386
! ia64
! mips
! mipsel
! powerpc
! spac64
! x86_64
|-
! arc
| {{No}}
| {{No}}
| {{No}}
| {{Yes}}
| {{No}}
| {{No}}
| {{No}}
|-
! coreboot
| {{Yes}}
| {{No}}
| {{No}}
| {{No}}
| {{No}}
| {{No}}
| style="background: PaleTurquoise; text-align: center" | 32-bit
|-
! efi
| {{Yes}}
| {{Yes}}
| {{No}}
| {{No}}
| {{No}}
| {{No}}
| {{Yes}}
|-
! emu
| {{Yes}}
| {{Yes}}
| {{Yes}}
| {{Yes}}
| {{Yes}}
| {{Yes}}
| {{Yes}}
|-
! ieee1275
| {{Yes}}
| {{No}}
| {{No}}
| {{No}}
| {{Yes}}
| {{Yes}}
| style="background: PaleTurquoise;  text-align: center" | 32-bit
|-
! loongson
| {{No}}
| {{No}}
| {{No}}
| {{Yes}}
| {{No}}
| {{No}}
| {{No}}
|-
! multiboot
| {{Yes}}
| {{No}}
| {{No}}
| {{No}}
| {{No}}
| {{No}}
| style="background: PaleTurquoise; text-align: center" | 32-bit
|-
! qemu
| {{Yes}}
| {{No}}
| {{No}}
| {{No}}
| {{No}}
| {{No}}
| style="background: PaleTurquoise; text-align: center" | 32-bit
|-
! qemu-mips
| {{No}}
| {{No}}
| {{Yes}}
| {{No}}
| {{No}}
| {{No}}
| {{No}}
|-
! pc
| {{Yes}}
| {{No}}
| {{No}}
| {{No}}
| {{No}}
| {{No}}
| style="background: PaleTurquoise; text-align: center" | 32-bit
|-
|}

{{Note|Whenever the values in the <var>GRUB_PLATFORMS</var> variable are adjusted GRUB2 will need to be re-emerged in order to build the changed binary. Be sure to use the <code>--newuse --deep</code> options as shown in the [[#Emerge|emerge section]] below.}}

=== Emerge ===

Para instalar GRUB2 utilice la sintaxis normal de {{c|emerge}}:

{{Emerge|sys-boot/grub:2|params+=--newuse --deep}}

=== Software adicional ===

Opcionalmente, puede instalar la utilidad {{c|os-prober}} (proporcionada por el paquete {{Package|sys-boot/os-prober}}) para que GRUB2 explore la presencia de otros sistemas operativos al ejecutar la orden {{c|grub-mkconfig}}. En la mayoría de los casos, esto permitirá a GRUB2 detectar automáticamente otros sistemas operativos (Windows 7, 8.1, 10, etc.).

{{Emerge|sys-boot/os-prober|params+=--newuse}}

Las instalaciones de GRUB2 (y opcionalmente {{Package|sys-boot/os-prober}}) no activan automáticamente el cargador de arranque. Esta acción solo instala el software en el sistema operativo, pero para instalar el cargador de arranque para el propio sistema (para usarlo para arrancar el sistema), deben realizarse algunos pasos adicionales, que se tratan en la sección [[#Configuración|Configuración]].

== Configuración ==

Hay dos aspectos importantes ha tener en cuenta en la configuración de GRUB2:

# La instalación del software GRUB2 como cargador de arranque del sistema.
# La configuración del propio cargador de arranque GRUB2.

La instalación del software GRUB2 es específico según el tipo de sistema, y se trata en [[#Instalar el cargador de arranque|instalar el cargador de arranque]]. Primero trataremos la configuración del propio gestor de arranque.

=== Fichero principal de configuración ===

The {{c|grub-mkconfig}} script is used to generate a grub configuration. It uses the scripts under {{Path|/etc/grub.d/*}} together with the {{Path|/etc/default/grub}} configuration file to generate the final {{Path|/boot/grub/grub.cfg}} - the only configuration file used by GRUB2 itself. 

{| class="table"
|-
! File !! Format !! Edits recommended? !! Description
|-
| {{Path|/usr/sbin/grub-mkconfig}} || POSIX shell script || {{No}} || Installed as part of the {{Package|sys-boot/grub}}:2 package. Run this script to generate {{Path|/boot/grub/grub.cfg}} after configuring the files described below.
|-
| {{Path|/boot/grub/grub.cfg}} || GRUB2 shell script || {{No}} || The file generated by {{c|grub-mkconfig}}. This file is evaluated by GRUB2's built-in script interpreter and doesn't necessarily support all POSIX commands or syntax. See the [https://www.gnu.org/software/grub/manual/grub.html#Shell_002dlike-scripting scripting reference] in the GRUB manual for supported features. Be aware that modifications to this file won't persist to the next time grub-mkconfig is run.
|-
| {{Path|/etc/grub.d/*}} || POSIX shell scripts || {{Partial|Maybe}} || Each script under {{Path|/etc/grub.d/*}} that has its execute bit set is evaluated in sequence, and the stdout is concatenated to form the final {{Path|/boot/grub/grub.cfg}} (or whatever file is given to the {{c|grub-mkconfig}} <code>-o</code> option). These scripts use the current system shell and therefore can use any supported syntax. Ideally they should be POSIX-compatible scripts, and the output script must be compatible with the GRUB2 interpreter. It may be necessary to disable or add scripts. For instance, to add menu items that couldn't be automatically generated.
|-
| {{Path|/boot/grub/custom.cfg}} || GRUB2 shell script || {{Partial|Maybe}} || The /etc/grub.d/41_custom script will reference this file to be read in at boot time if it exists.  This file provides a place to add additional entries or commands and does not require regeneration of the main grub.cfg file.
|-
| {{Path|/etc/default/grub}} || POSIX shell script || {{Yes}} || In most cases this is the only file that should be modified directly. It is mainly used to assign variables used by the scripts in {{Path|/etc/grub.d}} to generate a working configuration file. See [[GRUB2/Config_Variables|GRUB2 configuration variables]] or the [https://www.gnu.org/software/grub/manual/grub.html#Simple-configuration official reference] for supported variables.
|}

GRUB2 no requiere, a priori, intervención manual para configurar las opciones de arranque (como es el caso de cargadores de arranque tales como [[GRUB|GRUB Legacy]] y [[LILO/es|LILO]]). En su lugar, puede generar su fichero de configuración ({{Path|/boot/grub/grub.cfg}}) utilizando la orden {{c|grub2-mkconfig}}. Esta utilidad usa los scripts que residen en el directorio {{Path|/etc/grub.d/}} y los ajustes realizados en el fichero {{Path|/etc/default/grub}}.

{{Warning|The {{c|grub-mkconfig}} utility does not work properly when using software RAID. Manual configuration of the scripts in {{Path|/etc/grub.d/}} is necessary, as otherwise after installation the system will be left in a non-bootable state.
}}

After modifying one or more settings, run the {{c|grub-mkconfig}} utility with the <code>-o</code> option pointing to the output file located at {{Path|/boot/grub/grub.cfg}} (this is GRUB2's default output location):

{{RootCmd|grub-mkconfig -o /boot/grub/grub.cfg|output=<pre>
Generating grub.cfg ...
Found linux image: /boot/vmlinuz-3.3.0-gentoo
done
</pre>}}

Each time the {{c|grub-mkconfig}} utility is called a new configuration will be generated. 

{{Warning|If {{c|grub-mkconfig}} does not report any found entries then no entries were found. In this case GRUB2 will offer no boot selections when upon system restart which may be a tricky, time consuming situation to resolve. Make sure the output is satisfactory before restarting the system.}}

=== Definir los parámetros de la configuración ===

Las siguientes variables en {{Path|/etc/default/grub}} son algunas de las más comunes de definir para controlar cómo funcionará GRUB2:

{| class="table"
! Variable
! Explanation
! Default value
|-
| <var>GRUB_DEFAULT</var>
| Defines the default menu entry selected on boot. May be a numeric index, a menu title, or "saved". 
| Defaults to first detected entry.
|-
| <var>GRUB_TIMEOUT</var> 
| Delay (in seconds) before booting default menu entry. Set to <code>0</code> to boot immediately or <code>-1</code> to wait indefinitely. 
| The default is 5 seconds.
|-
| <var>GRUB_CMDLINE_LINUX</var>
| Parameters to be passed on the kernel command line for all Linux menu entries. For instance, to support hibernation, users will need to add <code>GRUB_CMDLINE_LINUX="resume=/dev/sdXY"</code> with {{Path|/dev/sdXY}} being the swap partition.
| 
|-
| <var>GRUB_CMDLINE_LINUX_DEFAULT</var>
| Parameters to be passed on the kernel command line for non-recovery Linux menu entries.
| 
|-
| <var>GRUB_DEVICE</var> 
| The initial root device (i.e. the kernel's <code>root=</code> parameter). Set this to override the {{c|grub-mkconfig}} command's root device auto-detection. For example, <code>GRUB_DEVICE=/dev/ram0</code> will force <code>root=/dev/ram0</code> to be used in the kernel command line.
| 
|}

Para obtener una lista más completa, consulte la subpágina de las [[GRUB2/Config_Variables|variables de configuración de GRUB2]].

After modifying the parameters, regenerate the GRUB2 configuration file with {{c|grub-mkconfig}}.

=== Activar o desactivar los scripts de configuración ===

The directory {{Path|/etc/grub.d/}} contains the scripts that {{c|grub-mkconfig}} uses to generate a {{Path|grub.cfg}} file. By default the contents of this directory should be similar to the following:

{{Cmd|ls /etc/grub.d/|output=<pre>
00_header  10_linux  20_linux_xen  30_os-prober  40_custom  41_custom README
</pre>}}

GRUB2 utilizará todos los scripts instalados que estén marcados como ejecutables (que, por defecto, lo están todos). Para desactivar cualquiera de los scripts, simplemente quite el bit de ejecución de los permisos del fichero del script, utilizando la orden {{c|chmod}}. En el siguiente ejemplo, cada script, salvo {{Path|00_header}} y {{Path|10_linux}}, serán desactivados:

{{RootCmd|chmod -x /etc/grub.d/<nowiki>{</nowiki>20_linux_xen,30_os-prober,40_custom,41_custom<nowiki>}</nowiki>}}

After modifying the scripts (or removing the executable bit), regenerate the GRUB2 configuration file using {{c|grub-mkconfig}}.

=== Manipular los scripts de configuración ===

Algunas de las características o funcionalidades de grub2 solo es posible desarrollarlas mediante la modificación de los scripts de configuración. Por ejemplo, para permitir el arranque dual con FreeBSD, es necesario realizar las siguientes modificaciones.

Cambiar el script {{Path|/etc/grub.d/40_custom}} como sigue:  

{{FileBox|filename=/etc/grub.d/40_custom|title=Añadir arranque dual|<pre>
menuentry "FreeBSD" --class freebsd --class bsd --class os {
 insmod ufs2
 insmod bsd
 set root=(hd0,1)
 kfreebsd /boot/kernel/kernel
 kfreebsd_loadenv /boot/device.hints
 set kFreeBSD.vfs.root.mountfrom=ufs:/dev/ada0s1a
 set kFreeBSD.vfs.root.mountfrom.options=rw
 set kFreeBSD.hw.psm.synaptics_support=1
}
</pre>}}

{{Path|/dev/sda1}} o <code>(hd0,1)</code> es la partición en la que reside FreeBSD. Si se utilizó la instalación normal de UFS para la partición de FreeBSD, entonces {{Path|/dev/sda1}} será un contenedor (algo así como una partición lógica). Este comprende la partición de intercambio y la raíz. Verifique con {{c|ls -la /etc/grub.d/40_custom}} que el script {{Path|40_custom}} es ejecutable. Si el bit de ejecución no está establecido, entonces, configúrelo con la orden {{c|chmod u+x 40_custom}}.  

Next install GRUB2 using the {{c|grub-install}} command and update GRUB2's configuration file:

{{RootCmd|grub-install /dev/sda
|grub-mkconfig -o /boot/grub/grub.cfg}}

== Instalar el cargador de arranque ==

Installing GRUB2 as the system's boot loader depends on how the system is meant to boot (through [[BIOS]] or UEFI) and how the disk on which the boot loader should be installed is partitioned (using MBR or GPT partition layout).

Este artículo trata las siguientes situaciones:

* [[#BIOS con MBR|BIOS con MBR]]
* [[#BIOS con GPT|BIOS con GPT]]
* [[#UEFI con GPT|UEFI con GPT]]

Seleccione las instrucciones de instalación adecuadas para su sistema.

=== BIOS con MBR ===

{{Note|When the system is meant to dual-boot with Microsoft Windows, make sure that the system itself does ''not'' have an UEFI firmware. Even when such systems are booted in 'legacy BIOS' mode, Microsoft Windows will refuse to boot.}}

Asegúrese de que la ubicación del directorio {{Path|/boot}} está disponible —si este directorio utiliza una partición separada, asegúrese de que se monta—:

{{RootCmd|mount /boot}}

Run the {{c|grub-install}} command to copy the relevant files to {{Path|/boot/grub}}. On the PC platform, this also installs a boot image to the Master Boot Record (MBR) or a partition's boot sector. If all goes well, after running {{c|grub-install}} an output such as the one below is to be expected:

{{RootCmd|grub-install /dev/sda|output=<pre>
Installation finished. No error reported.
</pre>}}

{{c|grub-install}} accepts a <code>--target</code> option to set the CPU architecture and system platform. If unspecified, {{c|grub-install}} will attempt to guess the proper values; on an {{Keyword|amd64}}/{{Keyword|x86}} system it will use <code>i386-pc</code> by default. {{c|grub-install}} also accepts a <code>--boot-directory</code> option to tell the GRUB2 installer which directory to look for GRUB2's boot files. This defaults to the current {{Path|/boot}} but is useful when trying to move a root partition.

==== Particionar para BIOS con MBR ====

Asegúrese de dejar suficiente espacio libre antes de la primera partición. Inicie la primera partición en el sector 2048, dejando, al menos, 1 MiB de espacio en el disco para el registro de arranque maestro (MBR). Se recomienda (aunque no es obligatorio) crear una partición adicional para GRUB llamada ''BIOS boot partition''. Esta partición solo necesita ser definida, pero no formateada.

Si el usuario está siguiendo las [[Handbook:Main_Page|instrucciones de instalación de Gentoo]], esta partición ''BIOS boot partition'' ya estará disponible.

=== BIOS con GPT ===

{{Note|When the system is meant to dual-boot with Microsoft Windows, make sure that the system itself does ''not'' have an UEFI firmware. Even when such systems are booted in 'legacy BIOS' mode, Microsoft Windows will refuse to boot. Also, older Microsoft Windows systems might not support GPT. It is possible to use a hybrid MBR-GPT approach; see [[Hybrid partition table]].}}

Si una partición {{Path|/boot}} es necesaria, comience por el montaje de la partición {{Path|/boot}}:

{{RootCmd|mount /boot}}

If all goes well, after running the {{c|grub-install}} command an output such as the one below is to be expected:

{{RootCmd|grub-install /dev/sda|output=<pre>
Installation finished. No error reported.
</pre>}}

{{c|grub-install}} accepts a <code>--target</code> option to set the CPU architecture and system platform. If unspecified, {{c|grub-install}} will attempt to guess the correct values; on an {{Keyword|amd64}}/{{Keyword|x86}} system it will use <code>i386-pc</code> by default. {{c|grub-install}} also accepts a <code>--boot-directory</code> option to tell the GRUB2 installer which directory to look in for GRUB2's boot files. This defaults to the current {{Path|/boot}} but is useful when trying to move a root partition.

==== Particionar para BIOS con GPT ====

Cuando una tabla de particiones GPT está presente en el sistema, una pequeña partición llamada ''BIOS boot partition'' (con tipo <code>EF02</code>, que es diferente de la partición ''EFI System Partition (ESP)'' que tiene el tipo <code>EF00</code>) tendrá que estar disponible. 1 MiB será suficiente para que funcione, pero 2-4 MiB es una opción segura. Esta partición ''BIOS boot partition'' sostendrá la etapa 2 del cargador de arranque. BIOS boot partition no necesita ser formateada con un sistema de ficheros; la orden {{c|grub2-install}} sobrescribe cualquier sistema de ficheros preexistente con el suyo propio.

{{Important/es|La partición de arranque de la BIOS («''BIOS boot partition''») ''no'' es la misma partición que se monta, comúnmente, en {{Path|/boot}}. La partición {{Path|/boot}} y la partición de arranque de la BIOS son diferentes particiones y deben manejarse por separado. La partición de arranque de la BIOS ''no'' se monta con regularidad en el sistema (es decir, ''no'' debe ser definida en {{Path|/etc/fstab}}). La partición {{Path|/boot}} ''se puede'' montar con regularidad, sin problemas, por lo que puede estar presente en el fichero {{Path|/etc/fstab}}.}}

Para configurar una partición como ''BIOS boot partition'' utilice la herramienta de línea de órdenes {{c|parted}} ({{Package|sys-block/parted}}) escribiendo lo que sigue (cambie <code>1</code> por el número que corresponda a su partición, la cual se marcará como ''BIOS boot partition''):

{{RootCmd|set 1 bios_grub on|prompt=(parted) |color=white}}

Con la utilidad {{c|cgdisk}} del paquete {{Package|sys-apps/gptfdisk}}, esto se logra estableciendo el tipo de partición como <code>0xEF02</code> y etiquetándola como <code>gptbios</code>.

An EFI System Partition is not required, but it would be sensible to make sure that the BIOS boot partition is large enough to be converted to one, should the system motherboard later be upgraded to an UEFI board.

La salida de abajo resulta de pulsar la tecla {{Key|p}} con la utilidad {{c|gdisk}} en un disco particionado con GPT, válido tanto para una ''BIOS boot partition'' [0xEF02], como para una partición EFI [0xEF00]:

{{RootCmd|gdisk /dev/sdc|output=<pre>
GPT fdisk (gdisk) version 0.8.1
 
Partition table scan:
  MBR: protective
  BSD: not present
  APM: not present
  GPT: present
 
Found valid GPT with protective MBR; using GPT.
 
Command (? for help): p
Disk /dev/sdc: 976773168 sectors, 465.8 GiB
Logical sector size: 512 bytes
Disk identifier (GUID): AA369F4D-37A4-4C0D-A357-DC24B99A6337
Partition table holds up to 128 entries
First usable sector is 34, last usable sector is 976773134
Partitions will be aligned on 2048-sector boundaries
Total free space is 2014 sectors (1007.0 KiB)
 
Number  Start (sector)    End (sector)  Size       Code  Name
   1            2048       828377087   395.0 GiB   8E00  Linux LVM
   2       828377088       891291647   30.0 GiB    0700  Microsoft basic data
   3       891291648       975177727   40.0 GiB    0700  Microsoft basic data
   4       975177728       976754687   770.0 MiB   8300  Linux filesystem
   5       976754688       976756735   1024.0 KiB  EF02  BIOS boot partition
   6       976756736       976773134   8.0 MiB     EF00  EFI System
 
Command (? for help): 
</pre>}}

{{Note/es|El prefijo hexadecimal <code>0x</code> no necesita ser introducido para GPT cuando se utiliza {{c|fdisk}}.}}

Utilizando la misma configuración, la utilidad {{c|parted}} proporciona una salida con una sintaxis un poco diferente:

{{RootCmd|parted /dev/sdc|output=<pre>
GNU Parted 3.0
Using /dev/sdc
(parted) print
...
Sector size (logical/physical): 512B/512B
Partition Table: gpt
  
Number  Start   End    Size    File system  Name                  Flags
 1      1049kB  424GB  424GB                Linux LVM             lvm
 2      424GB   456GB  32.2GB               Microsoft basic data
 3      456GB   499GB  42.9GB               Microsoft basic data
 4      499GB   500GB  807MB   ext2         Linux filesystem
 5      500GB   500GB  1049kB               BIOS boot partition   bios_grub
 6      500GB   500GB  8396kB               EFI System            boot
  
(parted)
</pre>}}

Crear particiones con {{c|gdisk}} es sencillo para los usuarios que ya están familiarizados con la utilidad de particionado {{c|fdisk}}. Después de iniciar {{c|gdisk}}, escriba {{Key|n}} (para nueva) en el menú principal, proporcione los sectores de inicio y fin (si es necesario) y, a continuación, establezca el tipo de partición <code>EF00</code> para una ''EFI system partition''.

Los usuarios que han seguido las [[Handbook:Main_Page|instrucciones de instalación de Gentoo]] ya tendrán el diseño de las particiones adecuado para este propósito.

=== UEFI con GPT ===

Asegúrese de que la ubicación del directorio {{Path|/boot}} está disponible —si este directorio utiliza una partición separada, asegúrese de que se monta—:

{{RootCmd|mount /boot}}

Run the {{c|grub-install}} command to copy the relevant files to {{Path|/boot/grub}}. This should install Grub2 in {{Path|/boot/grub}}, copy the core image to {{Path|/boot/efi/EFI/gentoo/grubx64.efi}}, and call [[Efibootmgr|efibootmgr]] to add a boot entry.

{{RootCmd|grub-install --efi-directory{{=}}/boot/efi|output=<pre>
Installation finished. No error reported.
</pre>}}

The above command assumes the vfat [[EFI System Partition]] (ESP) is mounted at {{Path|/boot/efi}}.  If the ESP is mounted directly at {{Path|/boot}}, use <code>--efi-directory=/boot</code>. 

{{c|grub-install}} also accepts a <code>--target</code> option to set the CPU architecture and system platform. If unspecified, {{c|grub-install}} will attempt to guess the proper values; on an AMD64 UEFI-booted system it will use <code>x86_64-efi</code> by default. {{c|grub-install}} also accepts a <code>--boot-directory</code> option to tell the GRUB2 installer which directory to look for GRUB2's boot files. This defaults to {{Path|/boot}} but is useful when trying to move a root partition.

==== Particionar para UEFI con GPT ====

Para arrancar UEFI GPT con GRUB2, el sistema ''debe'' tener una partición EFI dedicada que contenga un sistema de ficheros FAT.

The EFI partition can ''replace'' having a {{Path|/boot}} partition on {{Path|/dev/sda1}} by having a {{Path|/boot/efi}} partition on {{Path|/dev/sda1}}. This is to say a successful UEFI boot scenario using GRUB2 ''can'' operate with two partitions total (three total if a swap partition is needed): a root partition and an EFI partition. Using this configuration, the {{Path|/boot}} ''folder'' will be located in the root {{Path|/}} ''partition'' (at {{Path|/boot}}) and the EFI ''partition'' will mount ''in'' the boot ''folder'' (at {{Path|/boot/efi}}). For further clarification, see the example {{Path|/etc/fstab}} file below.

{{FileBox|filename=/etc/fstab|title=Ejemplo de un fichero {{Path|/etc/fstab}} adaptado a UEFI con una partición swap:|<pre>
/dev/sda1		/boot/efi	vfat		noauto,noatime	1 2
/dev/sda2		none		swap		sw		0 0
/dev/sda3		/		ext4		noatime		0 1
</pre>}}

Cree una partición de 100 MB para {{Path|/boot/efi}}, la cual debe proporcionar suficiente espacio para alojar múltiples ficheros {{Path|*.efi}} (lo más probable es que no se necesiten varias entradas, la mayoría de los sistemas solo utilizará una).

Cree la partición utilizando la [[Partition#GUID_Partition_Table|herramienta elegida]] de particionado. Las herramientas {{c|gdisk}} ({{Package|sys-apps/gptfdisk}}) y {{c|parted}} ({{Package|sys-block/parted}}) encajan muy bien para este propósito. Cuando se utiliza la utilidad {{c|gdisk}}, asegúrese de marcar la partición con el tipo <code>EF00</code>.

Proceda a crear un sistema de ficheros FAT en la partición del sistema EFI mediante {{c|mkdosfs}} y añádala a {{Path|/etc/fstab}} siguiendo el ejemplo siguiente:

{{RootCmd|mkdosfs -F 32 -n efi-boot /dev/sda1
|mkdir /boot/efi}}

{{FileBox|filename=/etc/fstab|title=Añadir entrada de montaje de /boot/efi|<pre>
/dev/sda1		/boot/efi	vfat		noauto,noatime	1 2
</pre>}}

{{RootCmd|mount /boot/efi}}

{{Note|It is helpful to set the <var>GRUB_PLATFORMS</var> variable in {{Path|/etc/portage/make.conf}}. This will assist GRUB2 in determining what options to use when detecting the proper EFI target. For 32-bit UEFI systems use <code>efi-32</code>. For 64-bit use <code>efi-64</code>.}}

{{Important|In order for GRUB2 to install properly, the EFI directory ''must'' be mounted ''and'' the <code>efivars</code> kernel module must be loaded before the {{c|grub-install}} command will complete successfully.}}

==== Alternativa: utilizar la ubicación del firmware de UEFI ====

Si el firmware UEFI del sistema no puede encontrar el fichero del cargador de arranque EFI de GRUB2, utilizar la ubicación del gestor de arranque por defecto debería proporcionar una solución funcional. Esto elude el menú de arranque gestionado por [[Efibootmgr|efibootmgr]] y, por lo tanto, ofrece una funcionalidad reducida, pero es menos propenso a errores. De no hacerlo así, compruebe que la partición EFI se monta en {{Path|/boot/efi}} y luego copie el fichero {{Path|grubx64.efi}}, que se encuentra en {{Path|/boot/efi/EFI/gentoo/grubx64.efi}}, a {{Path|/boot/efi/EFI/BOOT/BOOTX64.EFI}}. Este ejemplo es para un sistema EFI de 64-bit, ajústelo en consecuencia para los sistemas de EFI 32 bits.

== Características extendidas ==

GRUB2 tiene muchas características que lo convierten en un poderoso cargador de arranque. Es compatible con:

* Arranque desde plataformas UEFI.
* Arranque desde unidades particionadas con GPT sin necesidad de un MBR híbrido (el MBR híbrido puede activarse, según sea necesario, para proporcionar compatibilidad o portabilidad).
* Arranque desde una partición {{Path|/boot}} formateada con [[btrfs]].
* Arranque directamente desde un conjunto RAID [[btrfs]] sin necesitar un [[initramfs]] para configurar montaje temprano.
* Arranque directamente desde volúmenes lógicos (como [[LVM|LVM2]]).
* Arranque con soporte para DM-RAID (RAID 0, 1, 4, 5, 6, 9 y 10).
* Arranque desde dispositivos cifrados (LUKS).

Algunas características se explican con más detalle a continuación.

=== Cargar en cadena ===

GRUB2 fue construido con un modo de carga en cadena (''chainload'') verdaderamente mejorado en comparación con su predecesor GRUB Legacy. Para enlazar con otro cargador de arranque, utilice la opción <code>chainloader</code>.

{{FileBox|filename=/boot/grub/grub.cfg|title=Encadenar la carga de otro cargador de arranque|<pre>
menuentry "Custom Super Bootloader Example" {
     insmod part_msdos
     insmod chain
     chainloader (hd1,1)+1
}
</pre>}}

Para obtener más información sobre la carga en cadena, consulte la subpágina [[GRUB2/Chainloading|Chainloading]].

=== Utilizar framebuffer de pantalla ===

Para que GRUB2 utilice un [[framebuffer]] de pantalla gráfica, vuelva a ejecutar emerge de GRUB con el ajuste <code>truetype</code> de USE activado. Esto instalará una tipografía True Type por defecto, así como una utilidad de conversión del tipo de letra.

{{Emerge|--newuse sys-boot/grub:2}}

Proceda a configurar el fichero de configuración por defecto de GRUB2 ubicado en {{Path|/etc/default/grub}}. Por ejemplo:

{{FileBox|filename=/etc/default/grub|title=Framebuffer related settings|lang=bash|1=
# Set resolution and color depth
GRUB_GFXMODE=1366x768x32
 
# Keep resolution when loading the kernel
GRUB_GFXPAYLOAD_LINUX=keep
 
# Set a background image
GRUB_BACKGROUND="/boot/grub/bg.png"
 
# Use a custom font, converted using grub-mkfont utility
GRUB_FONT="/boot/grub/fonts/roboto.pf2"
}}

Con el fin de averiguar qué modos de visualización soporta la tarjeta gráfica del sistema, utilice las siguientes órdenes en la shell de GRUB2:

{{Cmd|prompt=(grub)|color=white|insmod all_video|videoinfo}}

== Solución de problemas ==

Most of the issues can be resolved by ensuring that the partition layout is correct. Make sure enough space is available before the first partition of the disk, or optionally make sure that a ''BIOS boot partition'' is available. Also verify that {{Path|/boot/grub/grub.cfg}} was correctly generated with {{c|grub-mkconfig}}, or generate one with a custom menu entry.

Para obtener más información sobre soluciones de problemas de GRUB2, consulte el articulo [[GRUB2/Troubleshooting|Troubleshooting]].

== Véase también ==

Hay algunos recursos específicos de grub2 disponibles:

* En [[GRUB2/Chainloading|Chainloading]] se describe el uso de GRUB2 para arrancar otros cargadores de arranque. Es importante leer esto para los sistemas de arranque dual, o cuando GRUB2 necesita ser configurado para arrancar ficheros ISO.
* En [[GRUB2/AdvancedStorage|Advanced storage]] están documentados los pasos necesarios sobre cómo instalar y utilizar GRUB2 en situaciones de almacenamiento más avanzados, tales como RAID por software, volúmenes lógicos o sistemas de ficheros cifrados.
* En [[GRUB2/Config_Variables|Configuration variables]] se documenta una lista exhaustiva de las variables de configuración de grub2, como las usadas por {{Path|/etc/default/grub}}.
* En [[GRUB2/Troubleshooting|Troubleshooting]] se presenta una lista de errores comunes de grub2 (con sus soluciones).
* En [[Hybrid_partition_table|Hybrid partition table]] se documenta el uso de una configuración mixta MBR/GPT, así como la forma de utilizar dicho esquema de partición híbrida con GRUB2.

== Recursos externos ==

Para más información, vea:

* [https://www.gnu.org/software/grub/manual/grub.html GNU GRUB 2 manual page]
** [https://www.gnu.org/software/grub/manual/grub.html#Network Network (PXE) section of GRUB2]
* [http://www.rodsbooks.com/gdisk/bios.html Legacy BIOS issues with GPT article]
* [http://www.rodsbooks.com/gdisk/hybrid.html GPT and Hybrid MBR article]
* [http://www.rodsbooks.com/gdisk/ GPT fdisk utility page]
* [https://wiki.archlinux.org/index.php/GRUB2 Arch Linux GRUB2 wiki article]
* [https://fedoraproject.org/wiki/GRUB_2?rd=Grub2#Encountering_the_dreaded_GRUB_2_boot_prompt Fedora GRUB2 wiki article : Encountering the dreaded GRUB2 boot prompt]
* [https://help.ubuntu.com/community/UEFIBooting ubuntu UEFI booting help]
* [http://unix.stackexchange.com/questions/109272/dualboot-freebsd-gentoo-with-grub2-mbr http://unix.stackexchange.com/questions/109272/dualboot-freebsd-gentoo-with-grub2-mbr]
* [http://daniel-lange.com/archives/75-Securing-the-grub-boot-loader.html A blog post entry on locking specific GRUB2 boot entries with a password]


[[Category:Bootloaders]]
