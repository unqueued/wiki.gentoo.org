{{InfoBox stack
|{{InfoBox wikipedia|Advanced Configuration and Power Interface|header=true}}
}}

'''ACPI''' ('''A'''dvanced '''C'''onfiguration and '''P'''ower Management '''I'''nterface) is a [[power management]] system. It is part of the [[BIOS]].

== Installation ==

=== Kernel ===
You need to activate the following kernel options:
{{Kernel||<pre>
Power management and ACPI options  --->
    [*] Power Management support
        [*] ACPI (Advanced Configuration and Power Interface) Support  --->
            [*] Optional drivers
</pre>}}

{| class="wikitable" 
|+ '''Optional drivers'''
|-
! Option
! Module
! Recommend
! Description
|-
| Deprecated /proc/acpi files
| {{ta|-}}
| {{No}}
| Creates deprecated files in the [[procfs]] filesystem, which are now replaced by files in the [[sysfs]] filesystem.
|-
| Deprecated power /proc/acpi directories
| {{ta|-}}
| {{No}}
| Creates deprecated files in the procfs filesystem, which are now replaced by files in the sysfs filesystem.
|-
| EC read/write access through /sys/kernel/debug/ec
| {{ta|ec-debugfs}}
| {{No}}
| Debug interface to the Embedded Controller.
|-
| Deprecated /proc/acpi/event support
| {{ta|-}}
| {{No}}
| Creates deprecated files in the procfs filesystem, which are now replaced by the input layer or netlink events.
|-
| AC Adapter
| {{ta|ac}}
| {{Yes|Laptops}}
| Creates files to tell, if your system is connected to AC.
|-
| Battery
| {{ta|battery}}
| {{Yes|Laptops}}
| Creates files to tell, if your system is powered by a battery.
|-
| Button
| {{ta|button}}
| {{ta|-}}
| Handles events on the power, sleep, and lid buttons.
|-
| Video
| {{ta|video}}
| {{ta|-}}
| Supports basic operations for [[:Category:Graphics Adapters|graphics adapters]].
|-
| Fan
| {{ta|fan}}
| {{ta|-}}
| Supports ACPI fan devices, allowing user-mode applications to perform basic fan control (on, off, status).
|-
| Dock
| {{ta|dock}}
| {{ta|-}}
| Supports ACPI-controlled docking stations and removable drive bays, see the [[acpi dock]] article.
|-
| Processor
| {{ta|processor}}
| {{ta|-}}
| Installs ACPI as the idle handler for Linux and uses ACPI C2 and C3 processor states to save power.
|-
| Processor Aggregator
| {{ta|processor-aggregator}}
| {{ta|-}}
| ACPI 4.0 function to perform specific processor configuration and control.
|-
| Thermal Zone
| {{ta|thermal}}
| {{Yes}}
| Supports ACPI thermal zones to protect your processor againt overheating.
|-
| NUMA support
| {{ta|-}}
| {{ta|-}}
| 
|-
| Debug Statements
| {{ta|-}}
| {{No}}
|
|-
| PCI slot detection driver
| {{ta|pci-slot}}
| {{No}}
| Helps to correlate PCI bus addresses with physical slots
|-
| Container and Module Devices
| {{ta|container}}
| {{ta|-}}
| Supports ACPI Container and Module devices to hotplug nodes, CPUs, and memory.
|-
| Smart Battery System
| {{ta|sbs, sbshc}}
| {{ta|-}}
| Supports another type of access to battery information, found on some laptops.
|-
| Hardware Error Device
| {{ta|hed}}
| {{ta|-}}
| Supports the Hardware Error Device, which is used to report some hardware errors.
|-
| Allow ACPI methods to be inserted/replaced at run time
| {{ta|custom-method}}
| {{No}}
|
|-
| ACPI Platform Error Interface (APEI)
| {{ta|-}}
| {{ta|-}}
| APEI allows to report errors (for example from the chipset) to the operating system.
|}

=== Software ===
[[:Category:Desktop environment|Desktop environments]] react on the common events generated by ACPI. If you don't use a desktop environment or want to react on special events, install {{Package|sys-power/acpid}}:
{{USEflag
|selinux++no
}}

{{Emerge|acpid}}
==== SELinux ====
If you want acpid to be able to shutdown the system, make sure you have installed {{Package|sec-policy/selinux-shutdown}} and relabelled {{Path|/sbin/shutdown}}

== Configuration ==
The scripts in {{Path|/etc/acpi}} define how to react on ACPI events. You can edit them or add more.

=== Boot service ===
You can now start acpid:
{{RootCmd|/etc/init.d/acpid start}}
To start acpid at boot time, add it your default runlevel:
{{RootCmd|rc-update add acpid default}}

== Advanced configuration ==
You may be satisfied with the default ACPI package set up. Although, you may need a little extra configuration to get acpid daemon treat some basic ACPI events like AC power plug in/out, multimedia keys etc.

You will have to edit {{Path|/etc/acpi/default.sh}} along with {{Path|/etc/acpi/events/default}} if necessary and why not a complicated set up that make use of {{Path|/etc/acpi/actions}} and {{Path|/etc/acpi/events}}. Just put your scripts and event files there.

A basic {{Path|default.sh}} may be enough. The following is an example on what could be done.

{{File|/etc/acpi/default.sh||<pre>
#!/bin/sh
# $Id: /etc/acpi/default.sh, 2012/08/01 13:22:59 -tclover Exp $

set $*
group=${1%%/*}
action=${1#*/}
device=$2
id=$3
value=$4

unhandled() { logger "ACPI event unhandled: $*"; }

case "$group" in
	ac_adapter)
		case "$value" in
			*0) if [ "rc-status -r" != "battery" ]; then
					logger "Switching to battery runlevel"
					rc battery; hprofile power.bat
				fi
				;;
			*1) if [ "rc-status -r" != "default" ]; then
					logger "Switching to default runlevel"
					rc default; hprofile power.adp
				fi
				;;
			*)	unhandled $*;;
		esac
		;;
	battery)
		case "$value" in
			*0) if [ "rc-status -r" != "default" ]; then
					logger "Switching to default runlevel"
					hprofile power.adp; rc default
				fi
				;;
			*1) if [ "rc-status -r" != "default" ]; then
						logger "Switching to default runlevel"
						hprofile power.adp; rc default
				fi
				;;
			*)	unhandled $*;;
		esac
		;;
	button)
		case "$action" in
			lid)
				case "$id" in
					close) pm-suspend --quirk-none;;
					*) unhandled $*;;
				esac
				;;
			power) telinit 0;;
			prog1) :;;
			mute) 
				/etc/init.d/alsasound status &>/dev/null &&
				{
				[ ! $(amixer get Master | grep -i off) ] &&
				amixer set Master mute || amixer set Master unmute
				};;
			volumeup) 
				/etc/init.d/alsasound status &>/dev/null && amixer set Master +3dB
				/etc/init.d/oss status &>/dev/null && ossmix -- vmix0-outvol +3;;
			volumedown) 
				/etc/init.d/alsasound status &>/dev/null && amixer set Master -3dB
				/etc/init.d/oss status &>/dev/null && ossmix -- vmix0-outvol -3;;
			*)	unhandled $*;;
		esac
		;;
	cd)
		case "$action" in
			play) :;;
			stop) :;;
			prev) :;;
			next) :;;
		esac
		;;
	jack)
		case "$id" in
			unplug|plug) :;;
			*) unhandled;;
		esac
		;;
	*)	unhandled $*;;
esac

# vim:fenc=utf-8:ft=sh:ci:pi:sts=0:sw=4:ts=4:
</pre>}}

{{Note|Notice that the script is compatible with [[ALSA]] and [[OSS]], so no extra actions to undergo when switching to using OSS from ALSA or the opposite. An extra notice should be taken for switching runlevels when AC power is unplugged or plugged in. Just make a battery runlevel with a simple `cp -a /etc/runlevels/{default,battery}' or else remove or comment out the related lines. My laptop multimedia ACPI capable key events used to be taken care of by MPRIS in [[enlightenment]] and I enjoyed being able to control multimedia player with them. So I did not thought something about the related events when writing the script. If somebody is experiencing with the same annoyance, do not hesitate to edit the script and share it back!}}

{{Note|The previous script make use of a power management profile using [[hprofile]]. Refer to that article for more information.}}

[[Category:ACPI]]
