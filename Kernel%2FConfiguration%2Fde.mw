<languages />

Dieser Artikel beschreibt die manuelle Konfiguration und Einrichtung des [[Special:MyLanguage/Kernel|Linux Kernels]]. Für eine automatische Methode siehe den [[Special:MyLanguage/genkernel|genkernel]] Artikel.

== Symlink setzen ==

Der Symlink <tt>/usr/src/linux</tt> sollte immer auf die Kernelquellen zeigen, die derzeit verwendet werden. Dies kann mit einem der folgenden drei Methoden erfolgen:

; 1. Den Kernel mit aktivem ''symlink'' [[Special:MyLanguage/USE flag|USE Flag]] installieren
: Damit zeigt <tt>/usr/src/linux</tt> auf die neu installierten Kernelquellen. Falls notwendig, kann der Symlink später mit den folgenden beiden Methoden geändert werden:
; 2. Den Symlink mit '''eselect''' setzen:
: {{RootCmd|eselect kernel list|output=<pre>
Available kernel symlink targets:
  [1]   linux-3.0.7 *
  [2]   linux-3.0.4 *
</pre>}}
: Hier werden die verfügbaren Kernelquellen angezeigt. Das Sternchen zeigt die momentan gewählten Kernelquellen an. Um zu anderen  Kernelquellen zu wechseln, z.B. zum zweiten Eintrag, schreibe:
: {{RootCmd|eselect kernel set 2}}

; 3. Den Symlink manuell setzen:
: {{RootCmd|ln -sf /usr/src/linux-2.6.39-gentoo-r3 /usr/src/linux
  |ls -l /usr/src/linux |
  |output=lrwxrwxrwx 1 root root 11 Aug 29 22:10 /usr/src/linux -> linux-2.6.39-gentoo-r3}}

== Konfigurationsprogramme ==

Der Kernel selber bietet mehrere Programme, um ihn zu konfigurieren:

; '''make config'''
: Textbasierte Konfiguration. Die Optionen werden nacheinander abgefragt. Es müssen grundsätzlich alle Optionen beantwortet werden und ein Zugriff außerhalb der Reihe auf frühere Optionen ist nicht möglich.

; '''make menuconfig'''
: Graphisches Menü (nur Tastatureingabe). Das Menü ist frei navigierbar und Optionen lassen sich einzeln ändern.

; '''make nconfig'''
: Graphisches Menü mittels ncurses. Erfordert, dass {{Package|sys-libs/ncurses}} installiert ist.

; '''make xconfig'''
: Graphisches Menü mittels Qt4. Erfordert, dass {{Package|x11-libs/qt-gui}} installiert ist.

; '''make gconfig'''
: Graphisches Menü mittels GTK+. Erfordert, dass {{Package|x11-libs/gtk+}}, {{Package|dev-libs/glib}} und {{Package|gnome-base/libglade}} installiert sind.

There are also several scripts to create miscellaneous default configurations. See:
{{RootCmd|make help}}

== Configuration ==

This article describes the configuration using '''make menuconfig''', but the procedure is similar for the other menus.
{{RootCmd|cd /usr/src/linux
|make menuconfig}}

=== Usage ===

In the shown menu the blue bar indicates your position. With the arrow keys {{Key|up}} and {{Key|down}} you can change the position. The arrow keys {{Key|left}} and {{Key|right}} traverse the menu bar in the bottom and define, what happens, when you hit the {{Key|Enter}} key. '''Select''' switches to a sub menu - the menu entries ending with ''--->'' - , while '''Exit''' exits a sub menu. Alternative you can hit the {{Key|Esc}} key twice.

Menu entries, which start with brackets, are drivers or features which can be activated:

; [ ], [*]
: Options in square brackets can be activated or deactivated. The asterisk marks the menu entry as activated. You change the value with the {{Key|space}} key or press {{Key|Y}} ('''Y'''es) to activate or {{Key|N}} ('''N'''o) to deactivate the entry.
: Is the option is activated, the chosen driver will be built into the kernel and will always be available at boot time.

; < >, <M>, <*>
: Options in angle brackets can be activated or deactivated, but also activated as module (indicated by a ''M''). You change the value as before and press key {{Key|M}} for activate as module.
: The differentiation between a driver as module and a driver build into the kernel is, that the module is not loaded at boot time, so speeds up the boot. As needed you are loading the module yourself or let a tool like [[udev]] do it (as needed also at boot time). Simpler in the usability is a driver build into the kernel.

; {M}, {*}
: Options in curly brackets can be activated or activated as module but not be deactivated, because another driver needs this activated in either way.

; -M-, -*-
: Options between hyphens are activated in the shown way by another driver. There is no choice.


Furthermore some menu entries have a tag at the end:

; (NEW)
: This driver is new in the kernel and is maybe not stable enough.

; (EXPERIMENTAL)
: This driver is experimental and most likely not stable enough.

; (DEPRECATED)
: This driver is deprecated and not needed for most systems.

; (OBSOLETE)
: This driver is obsolete and should not be activated.


Most options have a description, which get by pressing the {{Key|H}} key or choose in the menu bar '''Help'''.

=== Driver selection ===

See the [[hardware detection]] article and the articles in the [[:Category:Hardware|Hardware]] category.

=== Search modules ===
Within ''menuconfig'', you can use {{Key|/}} to search modules by keyboards.

== Build ==

After configuring the kernel you have to compile the kernel:
{{RootCmd|make}}

If you have a processor with multiple cores, you can let all the cores do the work. For this add the parameter '''-j(NUMBER_CORES +1)'''. For a dual core processor:
{{RootCmd|make -j3}}

== Setup ==

If activated drivers as modules, you have to install them:
{{RootCmd|make modules_install}}
The modules will be copied to a sub folder of <tt>/lib/modules</tt>.

To install the actual kernel:
{{RootCmd|make install}}

This command executes <tt>/sbin/installkernel</tt>, which is part of the {{Package|sys-apps/debianutils}} package. It copies the kernel and the additional files in Debian's naming syntax to <tt>/boot</tt> and creates there the symlinks <tt>vmlinuz</tt>, <tt>System.map</tt> and <tt>config</tt>, which point to the new kernel etc. The symlinks pointing to the older kernel sources will be renamed to <tt>.old</tt> suffix, as well as the old kernel if it has the same version as newly-installed one. These symlinks are handy, because they point always to the newest kernel without changing the file path (e.g. you can use them in the bootloader configuration).

== Bootloader ==

Change your bootloader configuration to pick up at boot the new kernel.

Finally restart your system with the new kernel.

== Links ==

* [http://kernelnewbies.org/Linux26Changes kernel changelog with some explanations]

[[Category:Kernel]]
