<languages />

{{Metadata|abstract=Dieser Artikel beschreibt die manuelle Konfiguration und Installation des Linuxkernels. Eine automatisierte Methode wird im genkernel Artikel beschrieben.}}

<div class="mw-translate-fuzzy">
Dieser Artikel beschreibt die manuelle Konfiguration und Einrichtung des [[Special:MyLanguage/Kernel|Linux Kernels]]. Für eine automatische Methode siehe den [[Special:MyLanguage/genkernel|genkernel]] Artikel.
</div>

== Symlink setzen ==

<div class="mw-translate-fuzzy">
Der Symlink {{Path|/usr/src/linux}} sollte immer auf die Kernelquellen zeigen, die derzeit verwendet werden. Dies kann mit einem der folgenden drei Methoden erfolgen:
</div>

<div class="mw-translate-fuzzy">
1. Die Kernelquellen mit aktivem ''symlink'' [[Special:MyLanguage/USE flag|USE Flag]] installieren
: Damit zeigt {{Path|/usr/src/linux}} auf die neu installierten Kernelquellen. Falls notwendig, kann der Symlink später mit den folgenden beiden Methoden geändert werden:
</div>

<div class="mw-translate-fuzzy">
; 2. Den Symlink mit '''eselect''' setzen:
</div>

{{RootCmd|eselect kernel list|output=<pre>
Available kernel symlink targets:
[1] linux-3.3.8-gentoo
[2] linux-3.4.9-gentoo
</pre>}}

<div class="mw-translate-fuzzy">
: Hier werden die verfügbaren Kernelquellen angezeigt. Das Sternchen zeigt die momentan gewählten Kernelquellen an. Um zu anderen  Kernelquellen zu wechseln, z.B. zum zweiten Eintrag, schreibe:
</div>

{{RootCmd|eselect kernel set 2}}

<div class="mw-translate-fuzzy">
3. Den Symlink manuell setzen:
</div>

{{RootCmd|ln -sf /usr/src/linux-3.4.9-gentoo /usr/src/linux |
|ls -l /usr/src/linux |
|output=<pre>lrwxrwxrwx 1 root root 11 Aug 29 22:10 /usr/src/linux -> /usr/src/linux-3.4.9-gentoo</pre>
}}

<!-- The output is the same as the target file in the ln command. -->

== Konfigurationsprogramme ==

<div class="mw-translate-fuzzy">
Der Kernel selber bietet mehrere Programme, um ihn zu konfigurieren:
</div>

{| class="table table-striped table-condensed"
|-
! scope="col" width="15%" | Command
! Description
|-
| {{c|make config}}
| Text based configuration. The options are prompted one after another. All options need to be answered, and out-of-order access to former options is not possible.
|-
| {{c|make menuconfig}}
| An ncurses-based pseudo-graphical menu (only text input). Navigate through the menu to modify the desired options.
|-
| {{c|make defconfig}}
| Generates a new config with default from the ARCH supplied defconfig file. Use this option to get back the default configuration file that came with the sources.
|-
| {{c|make nconfig}}
| Pseudo-graphical menu based on ncurses. Requires {{Package|sys-libs/ncurses}} to be installed.
|-
| {{c|make xconfig}}
| Graphical menu using Qt5. Requires {{Package|dev-qt/qtgui}} to be installed.
|-
| {{c|make gconfig}}
| Graphical menu using GTK+. Requires {{Package|x11-libs/gtk+}}, {{Package|dev-libs/glib}}, and {{Package|gnome-base/libglade}} to be installed.
|-
| {{c|make oldconfig}}
| Review changes between kernel versions and update to create a new {{Path|.config}} for the kernel.
|-
| {{c|make olddefconfig}}
| Generates a new configuration with default values from the ARCH supplied defconfig file while, at the same time, maintaining all the previous options set in the {{Path|.config}} file found at {{Path|/usr/src/linux/.config}}. This is a fast and safe method for upgrading a config file that has all the configuration options it needs for hardware support while at the same time gaining bug fixes and security patches.
|-
| {{c|make allyesconfig}}
| Enables all configuration options in the kernel. It will set ''all'' kernel options to <code>*</code>. Make sure a backup of the current kernel configuration is acquired before using this option!
|}

<div class="mw-translate-fuzzy">
Es gibt diverse Skript, um verschiedene Standardkonfigurationen zu erstellen. Siehe dazu:
</div>

{{RootCmd|make help}}

== Konfiguration ==

<div class="mw-translate-fuzzy">
Dieser Artikel erklärt die Konfiguration mittels '''make menuconfig''', aber das Vorgehen ist für die anderen Menüs ähnlich.
</div>

{{RootCmd|cd /usr/src/linux
|make menuconfig}}

=== Bedienung ===

<div class="mw-translate-fuzzy">
Im nun erscheinenden Menü zeigt der blaue Balken die aktuelle Position an. Mit den Pfeiltasten {{Key|Hoch}} und {{Key|Runter}} kann die Position geändert werden. Die Pfeiltasten {{Key|Links}} und {{Key|Rechts}} durchlaufen die Menüleiste unten und bestimmen, was passiert, wenn die {{Key|Enter}} Taste bestätigt werden. '''Select''' wechselt in ein Untermenü - die Menüeinträge enden mit ''--->'' - während '''Exit''' das Untermenü wieder verlässt. Alternativ kann auch zweimal die {{Key|Esc}} Taste gedrückt werden.
</div>

Pressing an associated letter key {{Key|A}}-{{Key|Z}} will move the position of the cursor lines that have characters in bold. The {{Key|Y}}, {{Key|M}}, {{Key|N}} keys are excluded from navigation in this way; they are sanctified for other purposes. If a line begins with a Y, M, or N, the next character will be bold and capable of being jumped to. For example, relative to the cursor's current position, if the next line reads "N'''e'''twork Device Support --->" pressing the {{Key|E}} key will move the cursor to that line.

<div class="mw-translate-fuzzy">
Menüeinträge, die mit den folgenden Klammern beginnen, sind Treiber oder Funktionen, die man aktivieren kann:
</div>

{| class="table table-striped table-condensed"
|-
! scope="col" width="15%" | Symbol(s)
! Description
|-
| <code>[ ], [*]</code>
| Options in square brackets can be activated or deactivated. The asterisk marks the menu entry as activated. The value can be changed with the {{Key|space}} key. It is also possible to press {{Key|Y}} key ('''Y'''es) to activate or {{Key|N}} key ('''N'''o) to deactivate the selected entry.
<br />
If the option is activated, the selected feature/driver will be built into the kernel and will always be available at boot time.
|-
| <code>< >, <M>, <*></code>
| Options in angle brackets can be activated or deactivated, but also activated as module (indicated by a ''M''). The values can be modified by pressing {{Key|Y}}/{{Key|N}} keys as before or by pressing the {{Key|M}} key to activate the feature/driver as a module.
<br />
See the [[Kernel Modules]] article for differentiation.
|-
| <code>{M}, {*}</code>
| Options in curly brackets can be activated or activated as module but not be deactivated. This happens because another feature/driver is dependent on this feature.
|-
| <code>-M-, -*-</code>
| Options between hyphens are activated in the shown way by another feature/driver. There is no choice.
|}

Des weiteren enthalten manche Menüeinträge eine Klassifizierung am Ende:

{| class="table table-striped table-condensed"
|-
! scope="col" width="15%" | Tag
! Description
|-
| <code>(NEW)</code>
| This driver is new in the kernel and is maybe not stable enough.
|-
| <code>(EXPERIMENTAL)</code>
| This driver is experimental and most likely not stable enough.
|-
| <code>(DEPRECATED)</code>
| This driver is deprecated and not needed for most systems.
|-
| <code>(OBSOLETE)</code>
| This driver is obsolete and should not be activated.
|}

<div class="mw-translate-fuzzy">
Die meisten Optionen enthalten eine Beschreibung (in Englisch), die durch Drücken von {{Key|H}}  oder durch Auswahl von '''Help''' in der unteren Menüleiste angezeigt wird.
</div>

=== Treiberauswahl ===

Siehe den [[Special:MyLanguage/hardware detection|Hardwareerkennung]] Artikle oder die Artikel in der [[:Category:Hardware|Hardware]] Kategorie.

<div class="mw-translate-fuzzy">
=== Suchfunktion ===
Durch Drücken von {{Key|/}} können die Treiber und Funktionen anhand ihrer Modulnamen gefunden werden.
</div>

Within <code>menuconfig</code>, use the {{Key|/}} key to search modules by name.

As shown below, the search result will show numbers in front of the matches. Pressing {{Key|1}} in the example below would {{c|make menuconfig}} jump straight to the option ''Bluetooth device drivers'' in the menu structure.

{{KernelBox|title=Example output after searching for HCIBTUSB|1=
Symbol: BT_HCIBTUSB [{{=}}m]                       
Type  : tristate                               
Prompt: HCI USB driver                         
  Location:                                    
    -> Networking support (NET [{{=}}y])           
      -> Bluetooth subsystem support (BT [{{=}}y]) 
(1)     -> Bluetooth device drivers            
  Defined at drivers/bluetooth/Kconfig:5       
  Depends on: NET [{{=}}y] && BT [{{=}}y] && USB [{{=}}m]
}}

=== Allgemeine Gentoo-Einstellungen aktivieren ===

<div class="mw-translate-fuzzy">
In {{Package|sys-kernel/gentoo-sources}} und anderen vom [[Project:Kernel|Kernel Project]] gepflegten Kerneln gibt es die Option <code>CONFIG_GENTOO_LINUX</code>. Diese setzt einige in typischen Installationen benötigten Kernel-Optionen.
</div>

<div class="mw-translate-fuzzy">
Die Einstellung wählt automatisch tmpfs- und devtmpfs-Unterstützung aus, die unter Gentoo für {{Path|/dev}} benötigt werden. Zukünftig soll dies auf andere in Gentoo-Systemen benötige Optionen erweitert werden. Mehr Informationen finden sich wie oben beschrieben in der Beschreibung im Kernel-Konfigurationsprogramm.
</div>

== Kompilieren ==

<div class="mw-translate-fuzzy">
Nachdem der Kernel konfiguriert wurde, muss er nun kompiliert werden:
</div>

{{RootCmd|make}}

<div class="mw-translate-fuzzy">
Wer einen Prozessor mit mehreren Kernel hat, kann die Arbeit auf alle Kerne verteilen. Dazu gibt man den Parameter '''-j(NUMBER_CORES +1)''' mit an. Für einen Zweikern-Prozessor also:
</div>

{{RootCmd|make -j3}}

A quad core system contains four logical cores plus one (4 + 1):

{{RootCmd|make -j5}}

== Einrichtung ==

<div class="mw-translate-fuzzy">
Wurde Treiber im Kernel als Module aktiviert, so muss man diese installieren:
</div>

{{RootCmd|make modules_install}}

Die Module werden in einen Unterverzeichnis von {{Path|/lib/modules}} kopiert.

Nun installiert man den Kernel:

{{RootCmd|make install}}

<div class="mw-translate-fuzzy">
Dieser Befehl führt das Programm {{Path|/sbin/installkernel}} aus, das zum {{Package|sys-apps/debianutils}} Paket gehört. ''Der neue Kernel wird in {{Path|/boot//vmlinuz-{version}}} installiert. Falls bereits ein symbolischer Link {{Path|/boot/vmlinuz}} existiert, wird er erneuert, indem ein Link von {{Path|/boot/vmlinuz}} auf den neuen Kernel gelegt wird. Der vorher installierte Kernel ist unter {{Path|/boot/vmlinuz.old}} verfügbar.'' (''installkernel'' [[man page|Manpage]]). Das gleiche gilt für {{Path|config}}- und {{Path|System.map}}-Dateien. Diese Verknüpfungen sind praktisch, weil man so immer auf den neuesten Kernel verweisen kann, ohne den Dateipfad ändern zu müssen (z.B. bei der Konfiguration des Bootloaders).
</div>

== Bootloader ==

<div class="mw-translate-fuzzy">
Man muss die [[Bootloader]]-Konfiguration anpassen, damit der neue Kernel beim Systemstart geladen wird.
</div>

<div class="mw-translate-fuzzy">
Schließlich muss das System mit dem neuen Kernel neu gestartet werden.
</div>

== Comparing current kernel configuration with default configuration ==

Use the following procedure to get an overview of the kernel configuration settings that deviate from the default. Keep in mind that the modification of one configuration setting may alter additional configuration settings.

{{RootCmd
|cd /usr/src/linux
|cp .config ../.config.working
|make defconfig
|mv .config ../.config.default
|cp ../.config.working .config
|cd ..
|/usr/src/linux/scripts/diffconfig .config.working .config.default > .config.diff
}}

The search function in {{c|make menuconfig}} can be used to look up the symbols and their interpretations.
When you're done, clean up:

{{RootCmd
|cd /usr/src/
|rm .config.working .config.default .config.diff
}}

== See also ==

* {{See also|Genkernel}}
* {{See also|Kernel/Configuration/Kernel_Seeds}}
* {{See also|Kernel/Gentoo Kernel Configuration Guide}}

[[Category:Kernel]]
