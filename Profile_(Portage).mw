A '''Portage profile''' specifies default values for global and per-package [[USE flag]]s, specifies default values for most variables found in {{Path|[[:/etc/portage/make.conf]]}}, and defines a [[System_set_(Portage)|set of system packages]]. It masks unstable package versions and USE flags. The profiles are maintained by the Gentoo developers as part of the Gentoo repository ({{Path|[[:/usr/portage/profiles]]}}), but there are ways for users to override single pieces.

== Usaging the eselect profile command ==

=== List profiles ===

List the available profiles with {{c|[[eselect]]}}:

(The 17.0 profiles have been added to the Gentoo repository in November 2017.  For details see the [https://gentoo.org/support/news-items/2017-11-30-new-17-profiles.html News item (2017-11-30)].)
<br />(The 17.1 profiles have been added to the Gentoo repository in December 2017 as '''experimental'''. For details see the [https://gentoo.org/support/news-items/2017-12-26-experimental-amd64-17-1-profiles.html News Item (2017-12-26)] )

{{RootCmd|eselect profile list|output=<pre>
Available profile symlink targets:
  [1]   default/linux/amd64/13.0
  [2]   default/linux/amd64/13.0/selinux
  [3]   default/linux/amd64/13.0/desktop
  [4]   default/linux/amd64/13.0/desktop/gnome
  [5]   default/linux/amd64/13.0/desktop/gnome/systemd
  [6]   default/linux/amd64/13.0/desktop/plasma
  [7]   default/linux/amd64/13.0/desktop/plasma/systemd
  [8]   default/linux/amd64/13.0/developer
  [9]   default/linux/amd64/13.0/no-multilib
  [10]  default/linux/amd64/13.0/systemd
  [11]  default/linux/amd64/13.0/x32
  [12]  default/linux/amd64/17.0
  [13]  default/linux/amd64/17.0/selinux
  [14]  default/linux/amd64/17.0/hardened
  [15]  default/linux/amd64/17.0/hardened/selinux
  [16]  default/linux/amd64/17.0/desktop
  [17]  default/linux/amd64/17.0/desktop/gnome
  [18]  default/linux/amd64/17.0/desktop/gnome/systemd
  [19]  default/linux/amd64/17.0/desktop/plasma
  [20]  default/linux/amd64/17.0/desktop/plasma/systemd
  [21]  default/linux/amd64/17.0/developer
  [22]  default/linux/amd64/17.0/no-multilib
  [23]  default/linux/amd64/17.0/no-multilib/hardened
  [24]  default/linux/amd64/17.0/no-multilib/hardened/selinux
  [25]  default/linux/amd64/17.0/systemd
  [26]  default/linux/amd64/17.0/x32
  [27]  default/linux/amd64/17.1
  [28]  default/linux/amd64/17.1/selinux
  [29]  default/linux/amd64/17.1/hardened
  [30]  default/linux/amd64/17.1/desktop
  [31]  default/linux/amd64/17.1/desktop/gnome
  [32]  default/linux/amd64/17.1/desktop/gnome/systemd
  [33]  default/linux/amd64/17.1/desktop/plasma
  [34]  default/linux/amd64/17.1/desktop/plasma/systemd
  [35]  default/linux/amd64/17.1/developer
  [36]  default/linux/amd64/17.1/no-multilib
  [37]  default/linux/amd64/17.1/no-multilib/hardened
  [38]  default/linux/amd64/17.1/no-multilib/hardened/selinux
  [39]  default/linux/amd64/17.1/systemd
  [40]  hardened/linux/amd64
  [41]  hardened/linux/amd64/selinux
  [42]  hardened/linux/amd64/no-multilib
  [43]  hardened/linux/amd64/no-multilib/selinux
  [44]  hardened/linux/amd64/x32
  [45]  default/linux/musl/amd64
  [46]  hardened/linux/musl/amd64
  [47]  default/linux/musl/amd64/x32
  [48]  hardened/linux/musl/amd64/x32
  [49]  default/linux/uclibc/amd64
  [50]  hardened/linux/uclibc/amd64
</pre>}}

The "normal" profiles are the ones beginning with ''default'', followed by subprofiles for kernel (''linux'' or ''bsd''), architecture (''x86'', ''amd64'', etc.), release number (''13.0'') and target (''desktop'', ''server'', ''developer'', etc.). The ''desktop'' subprofile has also the subprofiles ''gnome'', ''kde'' and ''plasma''.

The asterisk marks your currently active profile.

=== Change profile ===

Change the profile using {{c|eselect}}, e.g. for a [[KDE]] desktop:

{{RootCmd|eselect profile set 19}}

== Structure ==

All profiles are cascading/stackable profiles composed by several subprofiles. Each subprofile (corresponding to a directory under {{Path|[[:/usr/portage/profiles]]}}) can contain files to set some defaults. Lower level subprofiles (e.g ''default/linux/amd64'') also can have a file called {{Path|parent}}, which pulls in one or more other higher level subprofiles (here: ''default/linux'', ''arch/amd64'' and ''base''). Defaults defined in a lower level subprofile overwrites all conflicting defaults in higher subprofiles.

Following is an example for the stacked profile ''default/linux/amd64/13.0/desktop/kde'' showing the dependencies:
{{CodeBox|title=Stacked profiles example|1=
/usr/portage/profiles/
{{!}}-- arch
{{!}}   {{!}}-- amd64 <--------------.
{{!}}   {{!}}   `-- parent >-------- {{!}} ----------------------.
{{!}}   -- base <--------------- {{!}} ----------------------{{!}}
{{!}}-- base <-------------------{{!}}                       {{!}}
{{!}}-- default                  {{!}}                       {{!}}
{{!}}   `-- linux <--------------{{!}}                       {{!}}
{{!}}       `-- amd64 <--------- {{!}} ------------------.   {{!}}
{{!}}           {{!}}-- parent >-----'                   {{!}}   {{!}}
{{!}}           `-- 13.0 <-----------------------.   {{!}}   {{!}}
{{!}}               {{!}}-- parent >---------------- {{!}} --{{!}}   {{!}}
{{!}}               `-- desktop <------------.   {{!}}   {{!}}   {{!}}
{{!}}                   {{!}}-- parent >-------- {{!}} --{{!}}   {{!}}   {{!}}
{{!}}                   `-- kde              {{!}}   {{!}}   {{!}}   {{!}}
{{!}}                       `-- parent >-----{{!}}   {{!}}   {{!}}   {{!}}
{{!}}-- features                             {{!}}   {{!}}   {{!}}   {{!}}
{{!}}   `-- multilib <-----------.           {{!}}   {{!}}   {{!}}   {{!}}
{{!}}       `-- lib32 <--------- {{!}} --------- {{!}} - {{!}} - {{!}} --'
{{!}}           `-- parent >-----'           {{!}}   {{!}}   {{!}}
{{!}}-- releases <-----------.               {{!}}   {{!}}   {{!}}
{{!}}   `-- 13.0 <---------- {{!}} ------------- {{!}} - {{!}} --'
{{!}}       `-- parent >-----'               {{!}}   {{!}}
`-- targets                              {{!}}   {{!}}
    `-- desktop <----------------------- {{!}} --'
        `--kde <----------- {{!}} -----------'
           `-- parent >-----'
}}

The following table gives a quick overview of what subprofile contain what files:

{| class="table table-striped table-condensed" style="vertical-align: top; white-space: nowrap;"
! &nbsp;
! root<br />folder
! arch<br />-amd64
! arch<br />-base
! base
! default<br/>-linux
! default<br/>-linux<br />-amd64
! default<br/>-linux<br />-amd64<br />-13.0
! default<br/>-linux<br />-amd64<br />-13.0<br />-desktop
! default<br/>-linux<br />-amd64<br />-13.0<br />-desktop<br />-kde
! features<br />-multilib
! features<br />-multilib<br />-lib32
! releases
! releases<br />-13.0
! targets<br />-desktop
! targets<br />-desktop<br />-kde
|-
| {{Path|eapi}} || {{Yes}} || {{No}} || {{No}} || {{No}} || {{No}} || {{No}} || {{Yes}} || {{Yes}} || {{Yes}} || {{No}} || {{No}} || {{No}} || {{Yes}} || {{No}} || {{No}}
|-
| {{Path|make.defaults}} || {{No}} || {{Yes}} || {{No}} || {{Yes}} || {{Yes}} || {{No}} || {{No}} || {{No}} || {{No}} || {{Yes}} || {{Yes}} || {{Yes}} || {{Yes}} || {{Yes}} || {{Yes}}
|-
| {{Path|packages}} || {{No}} || {{No}} || {{No}} || {{Yes}} || {{Yes}} || {{No}} || {{No}} || {{No}} || {{No}} || {{No}} || {{No}} || {{No}} || {{No}} || {{No}} || {{No}}
|-
| {{Path|package.build}} || {{No}} || {{No}} || {{No}} || {{No}} || {{Yes}} || {{No}} || {{No}} || {{No}} || {{No}} || {{No}} || {{No}} || {{No}} || {{No}} || {{No}} || {{No}}
|-
| {{Path|package.mask}} || {{Yes}} || {{No}} || {{No}} || {{Yes}} || {{No}} || {{No}} || {{No}} || {{No}} || {{No}} || {{No}} || {{No}} || {{No}} || {{Yes}} || {{No}} || {{No}}
|-
| {{Path|package.use}} || {{No}} || {{No}} || {{No}} || {{Yes}} || {{Yes}} || {{No}} || {{No}} || {{No}} || {{No}} || {{No}} || {{No}} || {{No}} || {{No}} || {{Yes}} || {{Yes}}
|-
| {{Path|package.use.force}} || {{No}} || {{Yes}} || {{No}} || {{Yes}} || {{No}} || {{No}} || {{No}} || {{No}} || {{No}} || {{No}} || {{No}} || {{No}} || {{No}} || {{No}} || {{No}}
|-
| {{Path|package.use.mask}} || {{No}} || {{Yes}} || {{No}} || {{Yes}} || {{Yes}} || {{No}} || {{No}} || {{No}} || {{No}} || {{No}} || {{No}} || {{No}} || {{No}} || {{No}} || {{No}}
|-
| {{Path|profile.bashrc}} || {{No}} || {{No}} || {{No}} || {{Yes}} || {{No}} || {{No}} || {{No}} || {{No}} || {{No}} || {{No}} || {{No}} || {{No}} || {{No}} || {{No}} || {{No}}
|-
| {{Path|use.force}} || {{No}} || {{Yes}} || {{No}} || {{Yes}} || {{No}} || {{No}} || {{No}} || {{No}} || {{No}} || {{Yes}} || {{No}} || {{No}} || {{No}} || {{No}} || {{Yes}}
|-
| {{Path|use.mask}} || {{No}} || {{Yes}} || {{Yes}} || {{Yes}} || {{No}} || {{No}} || {{No}} || {{No}} || {{No}} || {{Yes}} || {{No}} || {{No}} || {{No}} || {{No}} || {{No}}
|}

== Combining profiles ==

If there isn't a profile in the Gentoo repository that meets your exact requirements, you can try combining multiple profiles into a single custom profile. An example of this would be combining a hardened profile with a desktop systemd profile, such as '''<code><nowiki>default/linux/amd64/13.0/desktop/plasma/systemd</nowiki></code>''' and '''<code><nowiki>hardened/linux/amd64</nowiki></code>'''. It is expected that you already have a [[Handbook:AMD64/Portage/CustomTree#Defining_a_custom_repository|custom repository]] set up.


{{Important|The order in which the profiles are listed in the '''parent''' file can drastically affect which features will be enabled/disabled system-wide. If you have emerge resolution problems after switching to the custom profile, try changing the order of the lines in the '''parent''' file. It may be impossible to get some combinations to work correctly. '''Your mileage may vary!'''}}

# Create a profile name for your hybrid profile. For instance, the combination mentioned above could be named:<br><br> '''<code><nowiki>hardened/linux/amd64/13.0/desktop/plasma/systemd</nowiki></code>''' <br><br>
# Create the directory structure in your local repository:<br><br> {{RootCmd |local_repo{{=}}/usr/local/portage # A common location for the local repository |profile_name{{=}}hardened/linux/amd64/13.0/desktop/plasma/systemd |mkdir -p $local_repo/profiles/$profile_name }}<br>
# Reference the profiles from the Portage tree and store them in your new profile's '''parent''' file:<br><br> {{RootCmd |portage_dir{{=}}/usr/portage # A common location for the Portage tree |for p in default/linux/amd64/13.0/desktop/plasma/systemd hardened/linux/amd64 |output=<pre>> do</pre><pre>>     realpath --relative-to=$local_repo/profiles/$profile_name $portage_dir/profiles/$p</pre><pre>> done > $local_repo/profiles/$profile_name/parent</pre> }}<br>
# Insert the newly created profile in your repository's '''profiles.desc''':<br><br> {{RootCmd |arch{{=}}amd64 # Your architecture of choice |type{{=}}stable # The profile's type: stable or dev |echo "$arch     $profile_name     $type" >> $local_repo/profiles/profiles.desc}}<br>
# Switch to the new profile using [[eselect]]:<br><br> {{RootCmd |eselect profile list |output=<pre>   ...</pre><pre> [21] local:hardened/linux/amd64/13.0/desktop/plasma/systemd</pre> }}<br> {{RootCmd |eselect profile set 21 }}<br>
# Run a world rebuild:<br><br> {{Emerge |@world |params=-DNuva }}<br>

== See also ==

* [[Project:AMD64/Multilib_layout]]

== External resources ==

* [https://archives.gentoo.org/gentoo-dev/message/cc9cd23b9f3a1776ddf258bb6f6cb751<nowiki>[gentoo-dev] [RFC] First (experimental) 17.1 profiles news item for review (v2)</nowiki>]
* {{bug|506276|text=(no-symlink-lib) - kill SYMLINK_LIB=yes support}}
* [https://forums.gentoo.org/viewtopic-t-1074166.html Forums topic '''Profile 17.1''']

[[Category:Portage]]
