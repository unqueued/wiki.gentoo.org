The Lenovo Thinkpad W530 and its associated hardware components can (potentially) be difficult to configure properly in Gentoo. This article has been written as configuration guide to help users work out some of the gritty details needed to get this notebook working as it should while using Gentoo. 

{{Note|Do not expect to have exactly the same hardware listed in this guide in ''your'' W530. The hardware listed here is to be used as an example. Some of the components may be similar, but there are always variants in computers depending on what hardware was purchased. See the ThinkWiki.org link in the [[Lenovo_Thinkpad_W530#External_resources|External resources]] section for a review of possible factory hardware setups.}}

__TOC__

== Installation ==

=== Preparation ===

Things to be aware of when before installing Gentoo Linux on any machine:

# '''Backups:''' If the computer owner finds any value in being able to restore the factory existing operating system, make sure appropriate measures are taken to create a full system restoration. This is a nice fall back option in the case something goes wrong while installing Linux. 
# '''Time:''' Allot enough time for installing Gentoo. The length of the install process varies. Experienced Gentoo users are mostly limited by the speed of their current hardware where beginners are limited by the Gentoo learning curve.
# '''Diligence:''' Dedication is required in order to configure all parts of the hardware to work properly. Unfortunately most manufacturers do not deliver open source drivers for their hardware. Linux users go through great lengths in order to build or find open source drivers that are compatible with their hardware.

=== System hardware ===

{{Important|As stated above, the hardware listed in the following commands might not match the hardware in ''your'' system verbatim. Use the follow hardware information as rough guide.}}

{{RootCmd|lspci -nnk|output=<pre>
00:00.0 Host bridge [0600]: Intel Corporation 3rd Gen Core processor DRAM Controller [8086:0154] (rev 09)
        Subsystem: Lenovo Device [17aa:21f6]
        Kernel driver in use: ivb_uncore
00:01.0 PCI bridge [0604]: Intel Corporation Xeon E3-1200 v2/3rd Gen Core processor PCI Express Root Port [8086:0151] (rev 09)
        Kernel driver in use: pcieport
00:02.0 VGA compatible controller [0300]: Intel Corporation 3rd Gen Core processor Graphics Controller [8086:0166] (rev 09)
        Subsystem: Lenovo Device [17aa:21f5]
        Kernel driver in use: i915
00:14.0 USB controller [0c03]: Intel Corporation 7 Series/C210 Series Chipset Family USB xHCI Host Controller [8086:1e31] (rev 04)
        Subsystem: Lenovo Device [17aa:21f6]
        Kernel driver in use: xhci_hcd
00:16.0 Communication controller [0780]: Intel Corporation 7 Series/C210 Series Chipset Family MEI Controller #1 [8086:1e3a] (rev 04)
        Subsystem: Lenovo Device [17aa:21f6]
00:16.3 Serial controller [0700]: Intel Corporation 7 Series/C210 Series Chipset Family KT Controller [8086:1e3d] (rev 04)
        Subsystem: Lenovo Device [17aa:21f6]
        Kernel driver in use: serial
00:19.0 Ethernet controller [0200]: Intel Corporation 82579LM Gigabit Network Connection [8086:1502] (rev 04)
        Subsystem: Lenovo Device [17aa:21f3]
        Kernel driver in use: e1000e
00:1a.0 USB controller [0c03]: Intel Corporation 7 Series/C210 Series Chipset Family USB Enhanced Host Controller #2 [8086:1e2d] (rev 04)
        Subsystem: Lenovo Device [17aa:21f6]
        Kernel driver in use: ehci-pci
00:1b.0 Audio device [0403]: Intel Corporation 7 Series/C210 Series Chipset Family High Definition Audio Controller [8086:1e20] (rev 04)
        Subsystem: Lenovo Device [17aa:21f6]
        Kernel driver in use: snd_hda_intel
00:1c.0 PCI bridge [0604]: Intel Corporation 7 Series/C210 Series Chipset Family PCI Express Root Port 1 [8086:1e10] (rev c4)
        Kernel driver in use: pcieport
00:1c.1 PCI bridge [0604]: Intel Corporation 7 Series/C210 Series Chipset Family PCI Express Root Port 2 [8086:1e12] (rev c4)
        Kernel driver in use: pcieport
00:1c.2 PCI bridge [0604]: Intel Corporation 7 Series/C210 Series Chipset Family PCI Express Root Port 3 [8086:1e14] (rev c4)
        Kernel driver in use: pcieport
00:1d.0 USB controller [0c03]: Intel Corporation 7 Series/C210 Series Chipset Family USB Enhanced Host Controller #1 [8086:1e26] (rev 04)
        Subsystem: Lenovo Device [17aa:21f6]
        Kernel driver in use: ehci-pci
00:1f.0 ISA bridge [0601]: Intel Corporation QM77 Express Chipset LPC Controller [8086:1e55] (rev 04)
        Subsystem: Lenovo Device [17aa:21f6]
00:1f.2 SATA controller [0106]: Intel Corporation 7 Series Chipset Family 6-port SATA Controller [AHCI mode] [8086:1e03] (rev 04)                                                             
        Subsystem: Lenovo Device [17aa:21f6]                                                                                                                                                  
        Kernel driver in use: ahci                                                                                                                                                            
        Kernel modules: ahci                                                                                                                                                                  
00:1f.3 SMBus [0c05]: Intel Corporation 7 Series/C210 Series Chipset Family SMBus Controller [8086:1e22] (rev 04)                                                                             
        Subsystem: Lenovo Device [17aa:21f6]                                                                                                                                                  
        Kernel driver in use: i801_smbus                                                                                                                                                      
        Kernel modules: i2c_i801                                                                                                                                                              
01:00.0 VGA compatible controller [0300]: NVIDIA Corporation GK107GLM [Quadro K2000M] [10de:0ffb] (rev a1)                                                                                    
        Subsystem: Lenovo Device [17aa:21f5]                                                                                                                                                  
02:00.0 System peripheral [0880]: Ricoh Co Ltd PCIe SDXC/MMC Host Controller [1180:e823] (rev 05)                                                                                             
        Subsystem: Lenovo Device [17aa:21f6]
02:00.3 FireWire (IEEE 1394) [0c00]: Ricoh Co Ltd R5C832 PCIe IEEE 1394 Controller [1180:e832] (rev 04)
        Subsystem: Lenovo Device [17aa:21f6]
        Kernel driver in use: firewire_ohci
03:00.0 Network controller [0280]: Intel Corporation Centrino Ultimate-N 6300 [8086:4238] (rev 2c)
        Subsystem: Intel Corporation Centrino Ultimate-N 6300 3x3 AGN [8086:1111]
        Kernel driver in use: iwlwifi
        Kernel modules: iwlwifi
</pre>
}}

{{RootCmd|lsusb|output=<pre>
Bus 002 Device 002: ID 8087:0024 Intel Corp. Integrated Rate Matching Hub
Bus 002 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
Bus 001 Device 005: ID 04f2:b2ea Chicony Electronics Co., Ltd Integrated Camera [ThinkPad]
Bus 001 Device 004: ID 0a5c:21e6 Broadcom Corp. BCM20702 Bluetooth 4.0 [ThinkPad]
Bus 001 Device 003: ID 147e:2020 Upek TouchChip Fingerprint Coprocessor (WBF advanced mode)
Bus 001 Device 002: ID 8087:0024 Intel Corp. Integrated Rate Matching Hub
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
Bus 004 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub
Bus 003 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
</pre>
}}

== Kernel configuration ==

=== Manual configuration ===

In order to build your kernel properly use the <tt>make menuconfig</tt> command to configure the kernel:

{{RootCmd|make menuconfig|}}

After configuration run the following commands in this to build and install the system's kernel and modules:

{{RootCmd
|make
|make modules
|make install
|make modules_install}}

=== Genkernel ===

The [[Genkernel]] tool can also be used to configure the kernel:

{{RootCmd|genkernel --install --menuconfig all}}

== X11 configuration ==

=== Intel graphics ===

If you just want to configure the integrated graphics card (Intel GPU), then this is the section for you!

==== Kernel ====

{{KernelBox|1=
Device drivers -->
  Graphics support -->
    Direct Rendering Manager -->
      <*> Intel 8xx/9xx/G3x/G4x/HD Graphics
        [*] Enable modesetting on intel by default
}}

This xorg.conf can make the integrated Intel GPU work properly:

{{fileBox|filename=/etc/X11/xorg.conf|1=}}

=== Nouveau & Intel graphics ===

=== NVidia proprietary graphics ===

== USB device configuration ==

If the default USB power saving features are bugging you they can disabled by adding a configuration file to {{Path|/etc/modprobe.d/}}

{{FileBox|filename=/etc/modprobe.d/usb_auto_suspend_disable.conf|1=
#This example disables USB power saving altogether
options usbcore autosuspend=-1
}}

For more information visit Kernel.org's [https://www.kernel.org/doc/Documentation/usb/power-management.txt USB Power Management page].

== Helpful tools ==

These tools will help you diagnose problems if you learn how to use them properly. They are included on SystemRescueCD, which is the distribution this author recommends when installing Gentoo. Be sure to emerge them on your system after the install is complete for future troubleshooting.

=== Software ===

{| class="wikitable sortable"
|-
! Command(s) !! Package !! Description
|-
| <tt>[[eix]]</tt> || {{Package|app-portage/eix}} || A faster and better way to search for packages (compared to <tt>emerge --search</tt>).
|-
| <tt>[[eclean]]</tt>, <tt>[[equery]]</tt>, <tt>[[eread]]</tt>, <tt>[[euse]]</tt>, and more || {{Package|app-portage/gentoolkit}} || A collection of administration scripts for Gentoo.
|-
| <tt>[[ufed]]</tt> || {{Package|app-portage/ufed}} || A simple program designed to configure system USE flags.
|}

=== Hardware detection ===

{| class="wikitable sortable"
|-
! Name !! Package !! Description
|-
| <tt>[[lspci]]</tt> || {{Package|sys-apps/pciutils}} || Includes command-line tools for identifying PCI system hardware.
|-
| <tt>[[lsusb]]</tt> || {{Package|sys-apps/usbutils}} || Includes command-line tools for identifying USB system hardware.
|-
|}

For more hardware detection tools see the [[Hardware_detection|hardware detection]] article.

=== Tips ===

==== Caching Portage in tmpfs ====

If you are using an SSD or HHD and you have a lot of RAM (16GB would be more than enough) you can both expand the life of your drive and speed up build time by caching your Portage temp directory completely in RAM. Be sure to adjust to the amount of memory you want to allocate. The example below allows Portage to use maximum of 10GBs of RAM (tmpfs) during compiles. You can read more about caching Portage in tmpfs by reading [[Portage_TMPDIR_on_tmpfs|this article]].
{{fileBox|filename=/etc/fstab|title=Adding Portage temp directory to 10GBs of tmpfs:|1=
tmpfs		/var/tmp/portage	tmpfs	uid=portage,gid=portage,mode=0775,size=10240M,noatime	0 0
}}

After {{path|/etc/fstab}} has been modified, Portage's temp directory will be mounted in RAM on every boot. To mount Portage temp directory now simply run this command:

{{RootCmd|mount /var/tmp/portage}}

== See also ==

* [[Gentoo Cheat Sheet]]

== External resources ==

* [http://www.thinkwiki.org/wiki/Category:W530 Lenovo Thinkpad W530 at ThinkWiki.org]. 

[[Category:Laptops]]
