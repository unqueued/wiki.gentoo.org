<languages />
When using {{c|emerge}} for building a package, it is not uncommon to notice messages coming from [[Portage]] itself. Since they may contain important information from Gentoo developers it is a good idea to read them, but often this is not immediately possible because they rapidly scroll out of the screen. This can be easily solved by enabling a Portage [[FEATURES|feature]] called elog, whose purpose is to save messages to disk for later review. But other logging capabilities exist as well...

== Portage elog サブシステム ==

Portage elog サブシステムは、管理者またはユーザーの注意を引き付けるために ebuild に開発者が入れた特定の、ebuild が生成したログメッセージを追跡します。 これらのメッセージにはパッケージのビルドに関連した情報が含まれ、それはしばしば重要だったり関心をもつべきものだったりします。

=== セットアップ ===

<code>PORTAGE_ELOG_CLASSES</code> 変数を介してログに記録する情報の種類を選択。 可能な値は、<code>info</code>, <code>warn</code>, <code>error</code>, <code>log</code> and <code>qa</code>：

{{FileBox|filename=[[:/etc/portage/make.conf]]|lang=bash|1=
PORTAGE_ELOG_CLASSES="log warn error"
}}

=== ファイルへの保存の設定 ===

Portageは、多くの方法で elog イベントを処理することができます。

ディスクに elog のイベントを保存するためには、<code>PORTAGE_ELOG_SYSTEM</code> 変数の <code>save</code> モジュールを有効：

{{FileBox|filename=/etc/portage/make.conf|lang=bash|1=
PORTAGE_ELOG_SYSTEM="save"
}}

メッセージは、{{Path|/var/log/portage/elog}} または{{Path|${PORT_LOGDIR}/elog}} 変数が設定されている場合に保存されます。

カテゴリ毎に elog ファイルを作成するには、Portage の<code>split-elog</code> 機能を有効にします。 これは、{{Path|/var/log/portage/elog}} という場所にカテゴリベースのサブディレクトリを作成することを、Portageに強制します。

=== 電子メール機能を設定 ===

ログをメール送信するために、<code>mail</code>モジュール有効化。 メールオプションは、いくつかの追加の変数を設定することが必要です。 詳細については、{{Path|/usr/share/portage/config/make.conf.example}}をお読みください。

以下のセット​​アップ例がわかりやすいでしょう：

{{FileBox|filename=/etc/portage/make.conf|lang=bash|1=
PORTAGE_ELOG_SYSTEM="mail"
# 送信先アドレスと、SMTP サーバ名
PORTAGE_ELOG_MAILURI="log-intake@example.com mail.example.com"
PORTAGE_ELOG_MAILFROM="portage@$(hostname).example.com"
PORTAGE_ELOG_MAILSUBJECT="${PACKAGE} is ${ACTION} on ${HOST}"
}}

nullmailerやsendmailを使う例もあります:

{{FileBox|filename=/etc/portage/make.conf|lang=bash|1=
PORTAGE_ELOG_SYSTEM="mail"
# First the mail-to address, then the SMTP server
PORTAGE_ELOG_MAILURI="users@host /usr/sbin/sendmail"
PORTAGE_ELOG_MAILFROM="portage@$(hostname).example.com"
PORTAGE_ELOG_MAILSUBJECT="${PACKAGE} is ${ACTION} on ${HOST}"
}}

=== 関連するソフトウェア ===

以下は、elog 関連のソフトウェアパッケージの一覧です。

* {{Package|app-portage/elogv}} - Curses based utility to parse the contents of elogs
* {{Package|app-portage/elogviewer}} - Python based elog viewer

== ログを構築 ==

失敗や成功に関係なく、Portage elogサブシステムと、パッケージのビルドログはディスク上に保存されているか、リモート受信者に郵送します。 管理者が確認するためにこれは後のビルドまたはサポートチケットのビルドログを取得できます。

=== セットアップ ===

To enable Portage logging, edit {{Path|[[:/etc/portage/make.conf]]}} and set <var>PORT_LOGDIR</var> to a location where the log files should be stored. By default, Portage will use {{Path|/var/log/portage}}:

{{FileBox|filename=/etc/portage/make.conf|lang=bash|1=
PORT_LOGDIR="/var/log/portage"
}}

次に、多くの <code>FEATURES</code> 設定は、Portageが構築するログがどのように処理されるのかに影響します。

* With <code>binpkg-logs</code> set, even binary package deployments will have their logs saved
* When <code>clean-logs</code> is set, regular log file clean operations are executed. The command that is executed is defined by <code>PORT_LOGDIR_CLEAN</code> and defaults to a retention of the files of 7 days.
* With <code>split-log</code> set, build logs are stored in category-named subdirectories of <code>${PORT_LOGDIR}/build</code>

* <code>binpkg-logs</code>設定もバイナリパッケージの導入は、それらのログが保存されているでしょう
* <code>clean-logs</code>が設定されている場合、通常のログファイルのクリーン操作が実行されます。 実行するコマンドは以下のように定義され<code>PORT_LOGDIR_CLEAN</code> デフォルトは7日のファイルの保持。
* <code>split-log</code>セット、ログを構築するには、カテゴリの名前のサブディレクトリに格納され<code>${PORT_LOGDIR}/build</code>

=== Cleaning up ===

When <code>clean-logs</code> is set, Portage will execute the command defined by <var>PORT_LOGDIR_CLEAN</var> after every build or unmerge operation. By default, the following command is used:

{{FileBox|filename=/usr/share/portage/config/make.globals|lang=bash|1=
PORT_LOGDIR_CLEAN="find \"\${PORT_LOGDIR}\" -type f ! -name \"summary.log*\" -mtime +7 -delete"
}}

When defining a custom command, do not forget to ''escape'' the <var>PORT_LOGDIR</var> variable (or immediately hardcode the right location).

== 外部の情報 ==

* [http://blog.siphos.be/2013/09/underestimated-or-underused-portage-elogging/ Underestimated or underused: Portage (e)logging] on ([[User:SwifT|Sven Vermeulen]]'s blog)

[[Category:Portage]]
