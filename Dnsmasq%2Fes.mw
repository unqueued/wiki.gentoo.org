<languages />

{{Metadata|abstract=Dnsmasq es un servidor DHCP/DNS ligero para redes de tamaño pequeño y mediano.}}

{{InfoBox stack
|{{InfoBox homepage|http://www.thekelleys.org.uk/dnsmasq/doc.html|header=true}}
|{{InfoBox wikipedia|Dnsmasq|header=true}}
}}

[http://thekelleys.org.uk/dnsmasq/doc.html Dnsmasq] es un servidor DHCP/DNS sencillo que puede ser utilizado en una red local de hasta unos 1.000 clientes. Sus características fundamentales son una fácil configuración y un bajo consumo de recursos del sistema. También tiene soporte para IPv6.

== Instalación ==

La instalación de dnsmasq es totalmente compatible con el gestor de paquetes y el árbol portage. Como primer requisito, seleccione la variable USE apropiada.

{{USEflag|package=net-dns/dnsmasq
|dbus
|dhcp
|dnssec+++Enables DNSSEC feature
|ipv6
|auth-dns
|conntrack
|dhcp-tools
|idn
|lua
|script
|tftp
}}

A continuación, instale {{Package|net-dns/dnsmasq}} y agrégelo al nivel de ejecución ''default'', si desea que se inicie automáticamente.

{{Emerge|net-dns/dnsmasq}}

{{RootCmd|/etc/init.d/dnsmasq start
|rc-update add dnsmasq default}}

== Configuración ==

Hay varios recursos que se pueden modificar para cambiar el comportamiento de dnsmasq. Estos incluyen:
* las opciones de línea de órdenes pasadas al fichero {{Path|/etc/conf.d/dnsmasq}}
* el fichero de configuración principal ({{Path|/etc/dnsmasq.conf}})

=== Configuración del servicio ===

En el fichero {{Path|/etc/conf.d/dnsmasq}}, se pueden configurar las opciones de línea de órdenes que se transmitirán al demonio dnsmasq en la fase de arranque.

{{FileBox|filename=/etc/conf.d/dnsmasq|title=Ejemplo de configuración del servicio dnsmasq|1=
DNSMASQ_OPTS="--user=dnsmasq --group=dnsmasq -H /srv/virt/gentoo/hosts --max-cache-ttl=10"
}}

=== Fichero de configuración principal ===

La configuración principal de dnsmasq se realiza a través de su fichero de configuración, {{Path|/etc/dnsmasq.conf}}. El fichero utiliza una sintaxis <code>clave[=valor]</code> y el paquete de instalación proporciona uno que está bien documentado y es recomendable leerlo. Dentro del fichero, o a través de las opciones de la línea de órdenes, se pueden obtener referencias a recursos adicionales (como un fichero hosts DHCP).

A continuación se muestra una configuración de ejemplo:

{{FileBox|filename=/etc/dnsmasq.conf|1=
# Escuchar solo a esta interfaz
interface=eth1
  
# Asignar nombres basados ​​en la dirección mac
dhcp-host=00:1e:68:c2:ff:ee,endor,192.168.0.54,24h
  
# Cualquier otra solicitud DHCP obtiene una IP en este rango
dhcp-range=eth1,192.168.0.100,192.168.0.120,12h
  
# Activar el servidor TFTP y definir el directorio raíz de los ficheros disponibles a través de TFTP
enable-tftp
tftp-root=/var/lib/tftpboot
dhcp-boot=/pxelinux.0
}}

Después de editar el fichero de configuración, el servicio tiene que ser reiniciado —la recarga es compatible, pero para otros recursos—.

{{RootCmd|/etc/init.d/dnsmasq restart}}

=== Fichero hosts ===

La aplicación dnsmasq utiliza el fichero {{Path|/etc/hosts}} como una de sus fuentes para proporcionar servicios de DNS, a menos que se pase el argumento de línea de órdenes <code>-h</code> (<code>--no-hosts</code>).

Si el fichero {{Path|/etc/hosts}} se actualiza, el servicio dnsmasq necesita recibir una señal SIGHUP para recargar los ajustes. Este resultado también se puede logar utilizando los script init con la orden ''reload'':

{{RootCmd|/etc/init.d/dnsmasq reload}}

Este comportamiento puede ser desactivado a través del parámetro <code>no-hosts</code> pasado al fichero de configuración.

=== Ficheros hosts adicionales ===

Es posible hacer referencia a un fichero de hosts (adicional) para su uso como fuente de consultas DNS. Para ello, agregue la opción de línea de órdenes  <code>-H /ruta/al/fichero hosts</code> (<code>--addn-hosts=/ruta/al/fichero hosts</code>). También es posible indicar un directorio; en ese caso, todos los ficheros dentro de ese directorio serán tratados como ficheros hosts adicionales.

Al igual que en el fichero de hosts estándar, una señal SIGHUP recarga el fichero.

Este comportamiento también se puede configurar a través del parámetro <code>addn-hosts</code> en el fichero de configuración.

=== Servidores de nombres upstream ===

Por defecto, dnsmasq utiliza los servidores de nombres especificados en {{Path|/etc/resolv.conf}} como sus servidores DNS upstream.

Se puede utilizar un fichero diferencie mediante la opción de línea de órdenes <code>-r</code> (<code>--resolv-file</code>).

Este comportamiento también se puede definir con el parámetro <code>resolv-file</code> en el fichero de configuración.

== Características ==

Dnsmasq admite DNS, TFTP, PXE, router advertisements y servicios DHCP. Como tal, es una herramienta de gestión de red versátil para redes pequeñas y medianas.

=== Servicios DNS ===

Con el fin de proporcionar (solamente) servicios de DNS, primero identifique el ''servidor DNS upstream '' a utilizar. Si este es el mismo servidor de nombres que se especifica en {{Path|/etc/resolv.conf}} entonces no hay pasos adicionales que realizar. De lo contrario, señale a dnsmasq el fichero {{Path|resolv.conf}} apropiado con la opción <code>-r</code> (<code>-resolv-file </code>). La sintaxis de este último es la misma que la utilizada por el fichero {{Path|/etc/resolv.conf}}, aunque dnsmasq considera solamente las definiciones de los ''servidores de nombres''.

Por ejemplo:

{{RootCmd|echo "nameserver 8.8.8.8" >> /etc/dnsmasq.conf.resolv}}

A continuación, indique a dnsmasq este fichero en el fichero de configuración:

{{FileBox|filename=/etc/dnsmasq.conf|title=Configurar un fichero resolv personalizado|1=
resolv-file=/etc/dnsmasq.conf.resolv
}}

Para comprobar que el servicio está funcionando (después de recargar el fichero de configuración tan pronto se haya cambiado), utilice la orden <code>dig</code> (proporcionada por el paquete {{Package|net-dns/bind-tools}}), solicitando el servidor DNS (en el ejemplo siguiente se ejecuta sobre localhost) para resolver una dirección local o remota:

{{Cmd|dig @localhost +short www.gentoo.org|output=<pre>
www-bytemark-v4v6.gentoo.org.
89.16.167.134
</pre>}}

=== DNSSEC ===

Dnsmasq puede validar los datos DNSSEC mientras pasa los datos a través de él. Esto se puede lograr mediante la adición de estas líneas al fichero de configuración:

{{FileBox|filename=/etc/dnsmasq.conf|title=Activar DNSSEC|1=
# DNSSEC setup
dnssec
trust-anchor=.,19036,8,2,49AAC11D7B6F6446702E54A1607371607A1A41855200FD2CE1CDDE32F24E8FB5
dnssec-check-unsigned
}}

The trusted anchor can be found [https://data.iana.org/root-anchors/root-anchors.xml on the iana.org site]. After this change dnsmasq will return SERVFAIL and no DNS data if the validation fails. If the validation succeeds it sets the ''ad'' flag. In case the domain does not support DNSSEC dnsmasq behaves as before.

=== Servicios DHCP ===

Para activar los servicios DHCP en dnsmasq, utilice el ajuste de configuración <code>dhcp-range</code>.

Por ejemplo, para activar la configuración de direcciones IPv6 a través de la RA con tiempo de concesión ilimitado, y la configuración de direcciones IPv4 también con tiempo de concesión ilimitado:

{{FileBox|filename=/etc/dnsmasq.conf|title=Activar asignaciones IPv6 y IPv4|1=
dhcp-range=2001:db8:81:e2::,ra-only,infinite
dhcp-range=192.168.100.100,192.168.100.149,infinite
}}

Es posible utilizar definiciones estáticas para hosts conocidos, ya sea a través del fichero de configuración principal (ajustando <code>dhcp-host=</code>) o por medio de un fichero separado. Si se utiliza un fichero separado, indique a dnsmasq el mismo a través de la opción <code>-dhcp-hostsfile</code>. La ventaja de este último enfoque es que basta enviar una señal SIGHUP (o recargar el servicio) para volver a leer las entradas, mientras que cada modificación del fichero de configuración principal requiere reiniciar el servicio completo.

For more information about the syntax of the <code>dhcp-host</code> parameter please refer to the manual page or configuration file as its syntax is very extensive.

== Usage ==

This section covers various usage scenarios (maintenance and operational tasks) for the dnsmasq service.

=== Resetting leases ===

Clients that had a network interface update which results in a different MAC address might not get the intended IP address immediately. This is because the dnsmasq service has provided this IP address to the old MAC address, and will wait until the lease of this address has expired before re-assigning it.

The dnsmasq service stores its leases in {{Path|/var/lib/misc/dnsmasq.leases}}. If the lease needs to be removed faster, shut down the dnsmasq service, remove the lease from the {{Path|dnsmasq.leases}} file and start the service again.

{{RootCmd|/etc/init.d/dnsmasq stop
|nano -w /var/lib/misc/dnsmasq.leases
|/etc/init.d/dnsmasq start}}

=== Reloading non-main configuration settings ===

Next to the {{Path|dnsmasq.conf}} file, the dnsmasq service can use external definitions for the following services:
* DHCP host configuration entries (through <code>--dhcp-hostsfile</code> command line option)
* DHCP options (through <code>--dhcp-optsfile</code> command line option)

When these files are modified, a SIGHUP signal has dnsmasq reload these configuration files.

{{Note/es|El fichero {{Path|resolv.conf}} es consultado, por defecto, por dnsmasq; los cambios en este fichero son aplicados automáticamente, a menos que se haya establecido la opción de línea de órdenes <code>-n</code> (<code>--no-poll</code>) o se haya utilizado el parámetro de configuración <code>no-poll</code>.}}


[[Category:Software]]
