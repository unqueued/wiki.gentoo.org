<languages />


{{Metadata|abstract=AIDE ('''''A'''dvanced '''I'''ntrusion '''D'''etection '''E'''nvironment'') è un HIDS (Host-based Intrusion Detection System). AIDE scansiona file ed altre risorse, immagazzinando informazioni riguardo a questi in un database. Le informazioni immagazzinate includono alcuni attributi chiave dei file come l'hash, la dimensione, ownership, modification time, creation time, ed altri. Dopo la creazione iniziale del database, AIDE riscansiona il sistema e compara i nuovi risultati con quelli precedentemente immagazzinati. Se i valori differiscono, il file è stato modificato ed il cambiamento viene riportato. L'idea dietro all'utilizzo di AIDE è di creare un'immagine del sistema e poi compararla con una già creata in modo da identificare file compromessi.}}

AIDE ('''''A'''dvanced '''I'''ntrusion '''D'''etection '''E'''nvironment'') è un HIDS (Host-based Intrusion Detection System). AIDE scansiona file ed altre risorse, immagazzinando informazioni riguardo a questi in un database. Le informazioni immagazzinate includono alcuni attributi chiave dei file come l'hash, la dimensione, ownership, modification time, creation time, ed altri. Dopo la creazione iniziale del database, AIDE riscansiona il sistema e compara i nuovi risultati con quelli precedentemente immagazzinati. Se i valori differiscono, il file è stato modificato ed il cambiamento viene riportato. L'idea dietro all'utilizzo di AIDE è di creare un'immagine del sistema e poi compararla con una già creata in modo da identificare file compromessi.

__TOC__

== Installazione ==

=== Flags USE ===

L'installazione di {{Package|app-forensics/aide}} è semplice una volta settate le flags USE.
{{USEflag|package=app-forensics/aide}}

Le flag USE specifiche ad un certo pacchetto dovrebbero essere definite in {{Path|/etc/portage/package.use}}, oppure in un file di testo dentro una directory chiamata {{Path|/etc/portage/package.use}}. Per esempio, utilizzando {{Path|/etc/portage/package.use}} come ''file'':

{{FileBox|filename=/etc/portage/package.use|title=Abilitazione supporto zlib per AIDE|1=<pre>
app-forensics/aide zlib
</pre>}}

=== Emerge ===

Dopo aver settato le flag USE, installate il software:

{{Emerge|app-forensics/aide}}

== Configurazione ==

Il file di configurazione per {{Package|app-forensics/aide}} non è così spaventoso come può sembrare a prima vista. Il file di default si trova in {{Path|/etc/aide/aide.conf}}, ma gli amministratori possono facilmente creare molteplici file se necessario. Oltre ad alcune variabili, il file di configurazione utilizza una notazione breve per i vari aspetti dei file da scansionare (solo hash o anche informazioni sugli inode, ecc.) e quali file scansionare.

Di seguito le variabili relative al database:

{{FileBox|filename=aide.conf|title=Variabili di configurazione del database di AIDE|1=
database=file:/var/lib/aide/aide.db
database_out=file:/var/lib/aide/aide.db.new
}}

La prima riga dell'esempio sopra (<code>database</code>) definisce la collocasione del database che contiene i valori conosciuti. La seconda riga (<code>database_out</code>) definisce dove scrivere il nuovo database quando viene generato. Si raccomanda di non puntare queste variabili allo stesso database (con lo stesso percorso per ogni variabile). Se un database deve sovrascrivere l'altro, il miglior metodo è di "copiare manualmente" il nuovo db da un posto all'altro. Per esempio, per sovrascrivere il primo database con il secondo, è possibile usare questo comando:

{{RootCmd|cp /var/lib/aide/aide.db.new /var/lib/aide/aide.db}}

Per ora, lasciate le impostazioni sul database così come sono; le vedremo in dettaglio in seguito.

Il prossimo file considerato è {{Path|aide.conf}}.
I valori delle variabili sono notazioni brevi che indicano quali informazioni registrare nel database.

{{FileBox|filename=aide.conf|title=Configurazione di AIDE utilizzando la notazione breve|lang=ini|1=
Binlib = p+i+n+u+g+s+b+m+c+md5+sha1
Logs = p+i+n+u+g+S
...
}}

{{Note|I codici <code>md5</code> e <code>sha1</code> significano ovviamente che saranno calcolati hash di tipo MD5 e SHA-1 (rispettivamente).}}

Le lettere sono descritte nel file {{Path|aide.conf}} di default, ma per comodità riportiamo nella tabella seguente le opzioni più comuni:

{| class="table"
! Short
! Description
|-
| <code>p</code>
| Permessi
|-
| <code>i</code>
| Numero dell'inode
|-
| <code>n</code>
| Numero di (hard)link
|-
| <code>u</code>
| Informazioni sull'Utente (User)
|-
| <code>g</code>
| Informazioni sul Gruppo (Group)
|-
| <code>s</code>
| Dimensione (Size)
|-
| <code>S</code>
| Dimensione (Size, ma viene riportato solo il calo di dimensione - la crescita è consentita)
|-
| <code>b</code>
| Conta dei blocchi (Block count)
|-
| <code>m</code>
| Modification time
|}

Di seguito un'overview di quali directory scansionare e di cosa cercare. Con le tre righe d'esempio seguenti, AIDE è configurato per esaminare le directory {{Path|/bin}} e {{Path|/sbin}} con gli elementi identificati dalla notazione in <var>Binlib</var>. Il path {{Path|/var/log}} utilizzerà invece quanto definito nella variabile <var>Logs</var> sopra.

{{FileBox|filename=aide.conf|title=Opzioni sugli obbiettivi da scansionare|1=
/bin Binlib
/sbin Binlib
/var/log Logs
...
}}

AIDE supporta le espressioni regolari ed agli utenti è permesso "rimuovere" le corrispondenze. Per esempio, per controllare il path {{Path|/var/log}} ma non il {{Path|/var/log/portage}} è possibile impostare un set di esclusioni utilizzando il <code>!</code> prima dei percorsi da escludere:

{{FileBox|filename=aide.conf|title=Altri obbiettivi di scan|1=
/var/log Logs
!/var/log/portage
}}

=== Inizializzazione e scansioni frequenti ===

Per un setup di base di AIDE, è necessario inizializzare un database. Questo avviene utilizzando l'opzione <code>--init</code>. Per sincerarsi che AIDS utilizzi le configurazioni definite nelle sezioni precedenti, assicurarsi di passare l'opzione <code>--config</code> con il puntamento alla configurazione corretta:

{{RootCmd|aide --init --config{{=}}/etc/aide/aide.conf|output=<pre>
AIDE, version 0.14.2
  
### AIDE database at /var/lib/aide/aide.db.new initialized.
</pre>}}

Una volta inizializzato, ogni database preesistente può essere sovrascritto:

{{RootCmd|cd /var/lib/aide; cp aide.db.new aide.db}}

With a new database available, the entries can be scanned again (now or at a later date) using the <code>--check</code> option. This will create another database containing any modifications that have made to the file system since the first database has been created. Be sure to use the <code>--config</code> option pointed to the same configuration file that the first database was created with:

{{RootCmd|aide --check --config{{=}}/etc/aide/aide.conf|output=<pre>
AIDE, version 0.14.2
  
### All files match AIDE database. Looks okay!
</pre>}}

If file modification(s) occurred, a notification will be sent out:

{{RootCmd|aide --check --config{{=}}/etc/aide/aide.conf|output=<pre>
AIDE found differences between database and filesystem!!
Start timestamp: 2013-04-11 15:31:02
  
Summary:
  Total number of files:        318
  Added files:                  0
  Removed files:                0
  Changed files:                2
  
  
---------------------------------------------------
Changed files:
---------------------------------------------------
  
changed: /etc/pam.d
changed: /etc/pam.d/run_init
  
---------------------------------------------------
Detailed information about changes:
---------------------------------------------------
  
  
Directory: /etc/pam.d
  Mtime    : 2013-04-09 22:11:18              , 2013-04-11 15:31:01
  Ctime    : 2013-04-09 22:11:18              , 2013-04-11 15:31:01
  
File: /etc/pam.d/run_init
  Size     : 205                              , 208
  Mtime    : 2013-04-09 22:11:18              , 2013-04-11 15:31:00
  Ctime    : 2013-04-09 22:11:18              , 2013-04-11 15:31:01
  Inode    : 394203                           , 394053
  MD5      : Mm0KPzpPt63eqGClTJ/KaQ==         , eLUrP2BsIq25f3AZX+dlBA==
  SHA1     : NrQtsUeOsXS4RHUq+ejYBne5V6E=     , 5A6ef6VJCcMiqEjKQ7e9xkBNZB8=
</pre>}}

== Best practices ==

=== Be clear on what to scan ===

The default AIDE configuration is useful, but it needs to be fine-tuned to suit the users' needs. It is important to know which files to scan and why.

For instance, to scan for all authentication-related files but not for other files, use a configuration like so:

{{FileBox|filename=aide.conf|title=authentication-related scan targets|1=
# SELinux policy and settings
/etc/selinux ConfFiles
# Authentication databases
/etc/passwd ConfFiles
/etc/shadow ConfFiles
/etc/nsswitch.conf ConfFiles
# Authentication configuration
/etc/pam.d ConfFiles
/etc/securetty ConfFiles
/etc/security ConfFiles
# PAM libraries
/lib(64)?/security Binlib
}}

=== Keep the database offline and read-only ===

A second important aspect is that the result database should be stored offline when ''not'' needed and should be used in read-only mode when the database ''is'' needed. This gives some protection against a malicious user that might have compromised the machine to modify the results database. For instance, provide the result database on a read-only NFS mount (for servers) or read-only medium (when physical access to the machine is possible) such as a CD/DVD or a read-only USB drive.

After storing the database on a read-only location, update the {{Path|aide.conf}} file to have <code>database</code> point to this new location.

=== Do offline scanning ===

If applicable, try using offline scanning methods for the system. In case of virtual platforms, it might be possible to take a snapshot of the system, mount this snapshot (read-only) and then run the aide scan on the mounted file system.

{{RootCmd|losetup /dev/loop0 /srv/virt/gentoo.img
|vgscan
|vgchange -ay
|mount -o ro /dev/volgrpX/volumeY /mnt/image
|chroot /mnt/image
|aide --check --config{{=}}/path/to/aide.conf
|exit
|umount /mnt/image
|vgchange -an /dev/volgrpX
|losetup -d /dev/loop0}}

The above approach uses {{c|chroot}}. This is only needed when the initial file system has been scanned from the live system and the administrator wants to perform an offline validation. If the initial scan was done offline, then the {{Path|aide.conf}} file will point to the mount point already and the database will use these paths immediately, so then there is no need for chrooting.

== See also ==

* [[Integrity/Concepts]] talks about the concepts related to system integrity

== External resources ==

* [http://archive09.linux.com/articles/113919 Tutorial on how to use AIDE (Linux.com)]
* [http://www.symantec.com/connect/articles/securing-linux-aide Securing Linux with AIDE article (Symantec.com)]


[[Category:Server and Security]]
