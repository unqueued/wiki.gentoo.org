Installing Gentoo on the Asus Transformer Prime (TF201) 

This is an initial introduction to installing gentoo on the Asus Transformer Prime (TF201).  At the moment, I can get it to boot and launch X, but there are quite a few problems.  Hopefully, this site will invite others to share their own experiences, and maybe even generate some solutions to these problems.

INSTRUCTIONS

The basic steps are as follows:

1) Create a decent gentoo system via chroot on the current machine.  (You can also do a cross-compile installation on some other box.)  You should use the armv7a stage3.  Special steps:
  a) Grab http://lilstevie.geek.nz/ports/ubuntu-prime.img.gz and steal the following from it:
   * /lib/firmware/prime*
   * /lib/firmware/atmel* (I'm not sure if these are necessary.)
   * /etc/X11/xorg.conf
   * /usr/share/X11/xorg.conf.d/*
   * /lib/modules/*
   * /usr/sbin/brcm_patchram_plus
   * (TODO: I should just post these somewhere.)
  b) Edit /etc/conf.d/modules and add: bcm4329 iface_name=wlan0
  c) Edit /etc/make.conf and add: FEATURES="-userfetch" (This is a gentoo-specific 'feature/bug'.)
  d) Add the x11 layman and emerge tegra-drivers
  e) Edit /etc/local.d/mine.start and add: chmod 0666 /dev/nv* /dev/tegra_* (I'm not sure if this is necessary)

2) Flash http://lilstevie.geek.nz/ports/prime-sdlinux.blob to the TFP using the 'fastboot' utility.
Run: fastboot -i 0x0b05 flash boot prime-sdlinux.blob.  Once this is finished, you should be able to reboot the TFP and it'll show four penguins and load a kernel.  It'll, of course, bail because it is trying to mount your microsd card.

3) Somehow get your gentoo system onto a microsd card.  I used rsync to transfer the system to another box with that microsd card.  

4) Insert the microsd card into the TFP, reboot, and enjoy.

GETTING X TO WORK (OPTION 1)

If you use the prime-sdlinux.blob, then you will have a 2.6.x kernel.  Hence, you can't use the new tegra drivers (v. 15beta) but will have to use the old ones (v. 12).  These are the drivers you copied from the ubuntu image above.  You can also download them from nvidia's L4T website.  However, you will also need to patch evdev to work with the atmel-maxtouch.  But this will require that you patch inputproto and glib.  To cut things short, follow the instructions here:
https://bugs.gentoo.org/show_bug.cgi?id=415089

PROBLEMS WITH X (OPTION 1)

* The cursor doesn't redraw

* xinput (to readjust the mouse coordinates after an xrandr), while claiming to update, do not.  Hence, rotation is pretty broken.

GETTING X TO WORK (OPTION 2 [UNDER DEVELOPMENT])

Hence, the better solution is to use the new xorg-server which requires the new tegra drivers (v. 15beta).  This requires a 3.x kernel.  I am still in the progress of getting the 3.x kernel to work.  Check back in in a few weeks.

KNOWN BUGS

* Problem: Screen blanks and never comes back in console.
  Solution: There is none.  
  Work-around: In .bashrc or in your /etc/local.d/ add: "setterm -blank 0 -powerdown 0"

* Problem: After I launch X and I kill X, the screen is blank.
  Solution: There is none.  Make sure you have sshd installed.

Please contact peter period hartman at utoronto period ca a.k.a. wart_ in #gentoo-embedded (and elsewhere)
