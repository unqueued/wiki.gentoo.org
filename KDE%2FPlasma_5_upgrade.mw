Plasma 5 is the next generation of KDE's desktop environment, based on Qt 5 and KDE Frameworks 5. Upgrading is fairly simple, although it cannot be coinstalled with Plasma 4 due to upstream design decisions.

Note that while Plasma 5 is in a good state, it is still under heavy upstream development and is missing some features present in KDE 4.

== Overlay (optional) ==
For set and keyword support install [[layman]] and add the [[KDE/Overlay|KDE Overlay]]:
{{RootCmd|echo "app-portage/layman sync-plugin-portage" >> /etc/portage/package.use|emerge --ask app-portage/layman|layman --fetch --add kde}}

== Profile ==
It is highly recommended to use the Plasma desktop profile as it sets a number of important options to ensure things run smoothly.

In order to choose the most suitable profile, first list what's available:

{{RootCmd|eselect profile list|output=<pre>
  [1]   default/linux/amd64/13.0
  [2]   default/linux/amd64/13.0/selinux
  [3]   default/linux/amd64/13.0/desktop
  [4]   default/linux/amd64/13.0/desktop/gnome
  [5]   default/linux/amd64/13.0/desktop/gnome/systemd
  [6]   default/linux/amd64/13.0/desktop/kde
  [7]   default/linux/amd64/13.0/desktop/kde/systemd
  [8]   default/linux/amd64/13.0/desktop/plasma
  [9]   default/linux/amd64/13.0/desktop/plasma/systemd
  ...
</pre>}}

Then, select the right profile, substituting the appropriate profile number (which may vary between configurations):

{{RootCmd|eselect profile set 8}}

Any packages affected by the profile change need to be rebuilt:
{{RootCmd|emerge --ask --changed-use --deep world}}

== Unmasking and keywording ==
In the following examples please adapt "/path/to/overlay/" with the actual path, this is probably: /var/lib/layman/.

For stable users, you also need to keyword the required packages:
{{RootCmd|cd /etc/portage/package.accept_keywords|
ln -s /path/to/overlay/kde/Documentation/package.accept_keywords/kde-frameworks-5.16.keywords | ln -s /path/to/overlay/kde/Documentation/package.accept_keywords/kde-plasma-5.5.keywords
}}

{{Note| KDE Plasma is in constant change and weekly there's new package version avaiable and new frameworks version and kde-plasma, please, ensure you're using the latest "stable" version (if we can talk of stable version), paying attention to the files available in the directory {{Path|var/lib/layman/kde/Documentation/package.accept_keywords/}} and use it in the above command, replacing by the desired version avaiable
}}

== Installation ==

The {{Package|kde-plasma/plasma-meta}} package provides the full Plasma 5 suite:
{{RootCmd|emerge --ask kde-plasma/plasma-meta}}

Alternatively, {{Package|kde-plasma/plasma-desktop}} provides the basic desktop, leaving you free to install only the extra packages you require:
{{RootCmd|emerge --ask kde-plasma/plasma-desktop}}

== Display manager ==

[[SDDM]] (Simple Desktop Display Manager) is the recommended login manager and is pulled in automatically via {{package|kde-plasma/plasma-meta}} by default. This is the preferred option. Alternatively, [[LightDM]] can be used and pulled in by setting <code>USE</code> flag <code>-sddm</code> for {{package|kde-plasma/plasma-meta}}.
Change the setting accordingly in {{Path| /etc/conf.d/xdm}}.
Also, be sure to read through the [[SDDM]] page if further issues appear.

== KWallet Migration ==

KWallet5 will have to open your wallet from KWallet4 and import all the data into a new wallet. For that purpose, {{Package|kde-apps/kwalletd}} needs to be present at least once in a session after upgrade, but can be removed after migration and when you are sure no legacy package is using it anymore:
{{RootCmd|echo "kde-apps/kdebase-runtime-meta -oldwallet" >> /etc/portage/package.use|emerge --ask --oneshot kde-apps/kdebase-runtime-meta}}

== Troubleshooting ==
The most common issue with upgrading is running into blockers. Unfortunately, some packages just can't be coinstalled so they'll need to be removed. Feel free to drop by [irc://chat.freenode.net/#gentoo #gentoo] or [irc://chat.freenode.net/#gentoo-kde #gentoo-kde] for assistance with resolving any blockers.

=== Missing systray icons ===

Plasma <= 5.4 does not support xembed-based systray icons anymore, but uses the StatusNotifier specification for that <ref>http://blog.martin-graesslin.com/blog/2014/03/system-tray-in-plasma-next/</ref>.
As not all applications have been ported to the new system, some workaround exist <ref>http://blog.martin-graesslin.com/blog/2014/06/where-are-my-systray-icons/</ref>.

The workaround can be enabled by activating the <code>legacy-systray</code> and GUI-specific (<code>gtk2</code>, <code>gtk3</code>, <code>qt4</code>) USE flags for {{package|kde-plasma/plasma-desktop}}.

{{RootCmd| echo "kde-plasma/plasma-desktop legacy-systray gtk2 gtk3 qt4" >> /etc/portage/package.use
}}

Alternatively, the required packages can be installed manually:

{{RootCmd|emerge --ask dev-libs/sni-qt&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# for qt4-based applications|emerge --ask dev-libs/libappindicator:2&nbsp;&nbsp;# for gtk2+-based applications|emerge --ask dev-libs/libappindicator:3&nbsp;&nbsp;# for gtk3+-based applications}}

==== Pidgin ====
{{Package|net-im/pidgin}} requires {{Package|x11-plugins/pidgin-indicator}}. After install, find this plugin under Tools | Plugins. It is called "Ubuntu Indicator".

==== Skype ====
{{Package|net-im/skype}} is a 32-bit binary, you need to enable <code>abi_x86_32</code> on {{Package|dev-libs/sni-qt}}.

Update: there is an application that allows to convert old xembed-based system tray icons to StatusNotifier icons, compatible with Plasma 5: <code>xembed-sni-proxy</code> <ref>http://blog.davidedmundson.co.uk/blog/xembed_back</ref>. To install it, you have to setup [[KDE/Overlay]].
{{Emerge|dev-libs/xembed-sni-proxy}}
This program is included in >=plasma-workspace-5.5, so you don't have to install it separately if you're using Plasma >= 5.5. Otherwise, you'll have to unmask/unkeyword it (add <code>=dev-libs/xembed-sni-proxy-9999 **</code> to <code>package.accept-keywords</code> and <code>package.unmask</code> files.

=== Missing all but the default group ===

{{RootCmd|chmod g-s /usr/lib64/libexec/kf5/start_kdeinit}}

=== ck-list-sessions has wrong session information ===

Start plasma without exec or ck-launch-session.  Using `dbus-launch --sh-syntax --exit-with-session "/usr/bin/startkde"` was what I ended up using.

=== SSH/GPG Agent startup/shutdown scripts ===

Configuration moved to {{Path|/etc/plasma/{startup,shutdown}}} for Plasma 5.
{{Note|For KDE SC 4 it is in {{Path|/etc/kde/{startup,shutdown}}}.}}

=== Missing shutdown, reboot, suspend and hibernate buttons when using OpenRC ===

Please ensure that {{package|kde-plasma/powerdevil}} and {{package|sys-power/upower-pm-utils}} ('''not''' {{package|sys-power/upower}}) are installed. Also ensure that your user belongs to the <code>users</code> group.

If you use {{package|x11-misc/sddm}}, try {{package|x11-misc/lightdm}} instead.

=== sddm display issues ===
Check that your user (and <code>sddm</code> user) are in the <code>video</code> group.

=== sddm: KCM unable to change themes ===
Sddm needs a configuration file so that the KCM module can change themes. This file is not created during the sddm installation, so it needs to be created manually afterwards:
{{RootCmd|sddm --example-config > /etc/sddm.conf}}

=== kio-extras blocking plasma-workspace-5.4.1 ===
This can happen if you installed {{package|kde-plasma/plasma-workspace}} from the overlay and {{package|kde-apps/kio-extras}} from the tree. Simply do: {{RootCmd|emerge -1 plasma-workspace}}

== References ==
<references />

[[Category:KDE]]
