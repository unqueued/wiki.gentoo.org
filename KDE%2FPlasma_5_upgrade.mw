Plasma 5 is the next generation of KDE's desktop environment, based on Qt 5 and KDE Frameworks 5. Upgrading is fairly simple, although it cannot be coinstalled with Plasma 4 due to upstream design decisions.

Note that while Plasma 5 is in a good state, it is still under heavy upstream development and is missing some features present in KDE 4.

== Overlay (optional) ==
For set and keyword support install [[layman]] and add the [[KDE/Overlay|KDE Overlay]]:
{{RootCmd|echo "app-portage/layman sync-plugin-portage" >> /etc/portage/package.use|emerge --ask app-portage/layman|layman --fetch --add kde}}

== Profile ==
It is highly recommended to use the Plasma desktop profile as it sets a number of important options to ensure things run smoothly.

In order to choose the most suitable profile, first list what's available:

{{RootCmd|eselect profile list|output=<pre>
  [1]   default/linux/amd64/13.0
  [2]   default/linux/amd64/13.0/selinux
  [3]   default/linux/amd64/13.0/desktop
  [4]   default/linux/amd64/13.0/desktop/gnome
  [5]   default/linux/amd64/13.0/desktop/gnome/systemd
  [6]   default/linux/amd64/13.0/desktop/kde
  [7]   default/linux/amd64/13.0/desktop/kde/systemd
  [8]   default/linux/amd64/13.0/desktop/plasma
  [9]   default/linux/amd64/13.0/desktop/plasma/systemd
  ...
</pre>}}

Then, select the right profile, substituting the appropriate profile number (which may vary between configurations):

{{RootCmd|eselect profile set 8}}

Any packages affected by the profile change need to be rebuilt:
{{RootCmd|emerge --ask --changed-use --deep world}}

== Unmasking and keywording ==
In the following examples please adapt "/path/to/overlay/" with the actual path, this is probably: /var/lib/layman/.

For stable users, you also need to keyword the required packages:
{{RootCmd|cd /etc/portage/package.accept_keywords|
ln -s /path/to/overlay/kde/Documentation/package.accept_keywords/kde-frameworks-5.14.keywords | ln -s /path/to/overlay/kde/Documentation/package.accept_keywords/kde-plasma-5.4.keywords
}}

== Installation ==

=== Installation via Overlay ===

This method is preferred by many.
Using Layman to add the QT5 and KDE overlay updates the emerge profiles such as @qt5 and @kde-plasma.

If you have not already done so as above, emerge layman and add both overlays including the qt5 overlay.

{{RootCmd|emerge --ask layman}}

then add the overlays

{{RootCmd|layman --fetch --add qt5}}

and

{{RootCmd|layman --fetch --add kde}}

Now you can emerge qt5, kde-frameworks and kde-plasma in that order using the overlay sets:

{{Note|
''If you want to see all available sets you can using emerge @. Just type ''

{{RootCmd|emerge @}} 

''without entering a set parameter and all available sets will be listed.''
}}

{{RootCmd|emerge -av @qt5-essentials @qt5-addons @qt5-tools}}

Then:

{{RootCmd|emerge -av @kde-frameworks}}

and finally:

{{RootCmd|emerge -av @kde-plasma}}

<big>It is important to emerge the qt5, kde-frameworks and kde-plasma in this order because kde-frameworks depends on the QT5 sets of libraries to build. kde-plasma then depends on QT5 and kde-frameworks being built and installed to successfully compile kde-plasma</big>

Problems have been found between mixing versions of QT5, kde-frameworks and kde-plasma so you may or may not have to mask or keyword correctly the versions of QT5 and kde-frameworks to get kde-plasma working correctly.
At present kdelibs does work along side, qt-5.4.2 kde-frameworks-5.14.0 and kde-plasma-5.4.2 but seems to conflict with qt-5.5.1 and kde-frameworks-5.15.0 so if you are aiming for a stable system use version kde-frameworks-5.14.0 in combination with QT-5.4.2 . 
As off 24/10/2015 versions QT-5.5.0 and kde-frameworks-5.15.0 are both in heavy development and are unstable. They should only be used for testing. This means you will have to mask using <code>/etc/portage/package.mask</code> all qt-5.5.1 packages and kde-frameworks-5.15.0 packages.

Also it is advisable to disable the '''kde''' use flag if present in your <code>/etc/portage/make.conf</code> as this pulls in old libraries of KDE-4 that conflict with KDE-Plasma-5.

Here is the set to add to your <code>/etc/portage/package.mask</code> for your convenience.

{{FileBox|filename=[[:/etc/portage/package.mask]]|title=package.mask qt5.5 and kde-frameworks-5.15.0|1=
####################qtunstable########2015 october###############
=dev-qt/assistant-5.5.1
=dev-qt/designer-5.5.1
=dev-qt/linguist-5.5.1
=dev-qt/linguist-tools-5.5.1
=dev-qt/pixeltool-5.5.1
=dev-qt/qdbus-5.5.1
=dev-qt/qdbusviewer-5.5.1
=dev-qt/qdoc-5.5.1
=dev-qt/qtconcurrent-5.5.1
=dev-qt/qtcore-5.5.1
=dev-qt/qtdbus-5.5.1
=dev-qt/qtdeclarative-5.5.1
=dev-qt/qtdiag-5.5.1
=dev-qt/qtgraphicaleffects-5.5.1
=dev-qt/qtgui-5.5.1
=dev-qt/qthelp-5.5.1
=dev-qt/qtimageformats-5.5.1
=dev-qt/qtmultimedia-5.5.1
=dev-qt/qtnetwork-5.5.1
=dev-qt/qtopengl-5.5.1
=dev-qt/qtpaths-5.5.1
=dev-qt/qtpositioning-5.5.1
=dev-qt/qtprintsupport-5.5.1
=dev-qt/qtquick1-5.5.1
=dev-qt/qtquickcontrols-5.5.1
=dev-qt/qtscript-5.5.1
=dev-qt/qtsensors-5.5.1
=dev-qt/qtserialport-5.5.1
=dev-qt/qtsql-5.5.1
=dev-qt/qtsvg-5.5.1
=dev-qt/qttest-5.5.1
=dev-qt/qttranslations-5.5.1
=dev-qt/qtwebkit-5.5.1
=dev-qt/qtwebsockets-5.5.1
=dev-qt/qtwidgets-5.5.1
=dev-qt/qtx11extras-5.5.1
=dev-qt/qtxml-5.5.1
=dev-qt/qtxmlpatterns-5.5.1

#####################KDE Frameworks### Unstable 5.15 blocking for testing#########

=kde-frameworks/sonnet-5.15.0
=kde-frameworks/kparts-5.15.0
=kde-frameworks/kidletime-5.15.0
=kde-frameworks/kapidox-5.15.0
=kde-frameworks/kdewebkit-5.15.0
=kde-frameworks/baloo-5.15.0
=kde-frameworks/kactivities-5.15.0
=kde-frameworks/kactivities-5.15.0-r1
=kde-frameworks/kunitconversion-5.15.0
=kde-frameworks/khtml-5.15.0
=kde-frameworks/kguiaddons-5.15.0
=kde-frameworks/kemoticons-5.15.0
=kde-frameworks/kpeople-5.15.0
=kde-frameworks/attica-5.15.0
=kde-frameworks/extra-cmake-modules-5.15.0
=kde-frameworks/kross-5.15.0
=kde-frameworks/ktextwidgets-5.15.0
=kde-frameworks/kwidgetsaddons-5.15.0
=kde-frameworks/karchive-5.15.0
=kde-frameworks/kglobalaccel-5.15.0
=kde-frameworks/kxmlgui-5.15.0
=kde-frameworks/ktexteditor-5.15.0
=kde-frameworks/kfilemetadata-5.15.0
=kde-frameworks/kcoreaddons-5.15.0
=kde-frameworks/solid-5.15.0
=kde-frameworks/kcodecs-5.15.0
=kde-frameworks/kcmutils-5.15.0
=kde-frameworks/kdesignerplugin-5.15.0
=kde-frameworks/kdeclarative-5.15.0
=kde-frameworks/kpty-5.15.0
=kde-frameworks/plasma-5.15.0
=kde-frameworks/threadweaver-5.15.0
=kde-frameworks/kitemmodels-5.15.0
=kde-frameworks/kdelibs4support-5.15.0
=kde-frameworks/kitemviews-5.15.0
=kde-frameworks/kconfig-5.15.0
=kde-frameworks/kcompletion-5.15.0
=kde-frameworks/kauth-5.15.0
=kde-frameworks/kjobwidgets-5.15.0
=kde-frameworks/kservice-5.15.0
=kde-frameworks/kconfigwidgets-5.15.0
=kde-frameworks/modemmanager-qt-5.15.0
=kde-frameworks/kjsembed-5.15.0
=kde-frameworks/kwallet-5.15.0
=kde-frameworks/kjs-5.15.0
=kde-frameworks/ki18n-5.15.0
=kde-frameworks/kdesu-5.15.0
=kde-frameworks/networkmanager-qt-5.15.0
=kde-frameworks/knewstuff-5.15.0
=kde-frameworks/kded-5.15.0
=kde-frameworks/kdoctools-5.15.0
=kde-frameworks/bluez-qt-5.15.0
=kde-frameworks/kinit-5.15.0
=kde-frameworks/kdbusaddons-5.15.0
=kde-frameworks/kmediaplayer-5.15.0
=kde-frameworks/kpackage-5.15.0
=kde-frameworks/kcrash-5.15.0
=kde-frameworks/kdnssd-5.15.0
=kde-frameworks/kimageformats-5.15.0
=kde-frameworks/kplotting-5.15.0
=kde-frameworks/krunner-5.15.0
=kde-frameworks/kbookmarks-5.15.0
=kde-frameworks/knotifyconfig-5.15.0
=kde-frameworks/kwindowsystem-5.15.0
=kde-frameworks/kxmlrpcclient-5.15.0
=kde-frameworks/kio-5.15.0
=kde-frameworks/knotifications-5.15.0
=kde-frameworks/kiconthemes-5.15.0
=kde-frameworks/frameworkintegration-5.15.0
=kde-frameworks/frameworkintegration-5.15.0-r1
=kde-frameworks/kf-env-5.15.0
=kde-plasma/breeze-5.4.2-r1
}}

{{Note|If you have followed the above overlay method then there is no need to use the bellow method of kde-plasma/plasma-meta, you have the choice of either installation.}}

=== Installation via Plasma-Meta ===
The {{Package|kde-plasma/plasma-meta}} package provides the full Plasma 5 suite:
{{RootCmd|emerge --ask kde-plasma/plasma-meta}}

Alternatively, {{Package|kde-plasma/plasma-desktop}} provides the basic desktop, leaving you free to install only the extra packages you require:
{{RootCmd|emerge --ask kde-plasma/plasma-desktop}}

== Display manager ==

[[SDDM]] (Simple Desktop Display Manager) is the recommended login manager and is pulled in automatically via {{package|kde-plasma/plasma-meta}} by default. This is the preferred option. Alternatively, [[LightDM]] can be used and pulled in by setting <code>USE</code> flag <code>-sddm</code> for {{package|kde-plasma/plasma-meta}}.
Change the setting accordingly in {{Path| /etc/conf.d/xdm}}.
Also, be sure to read through the [[SDDM]] page if further issues appear.

== KWallet Migration ==

KWallet5 will have to open your wallet from KWallet4 and import all the data into a new wallet. For that purpose, {{Package|kde-apps/kwalletd}} needs to be present at least once in a session after upgrade, but can be removed after migration and when you are sure no legacy package is using it anymore:
{{RootCmd|echo "kde-apps/kdebase-runtime-meta -oldwallet" >> /etc/portage/package.use|emerge --ask --oneshot kde-apps/kdebase-runtime-meta}}

== Troubleshooting ==
The most common issue with upgrading is running into blockers. Unfortunately, some packages just can't be coinstalled so they'll need to be removed. Feel free to drop by [irc://chat.freenode.net/#gentoo #gentoo] or [irc://chat.freenode.net/#gentoo-kde #gentoo-kde] for assistance with resolving any blockers.

=== Missing systray icons ===

Plasma 5 does not support xembed-based systray icons anymore, but uses the StatusNotifier specification for that <ref>http://blog.martin-graesslin.com/blog/2014/03/system-tray-in-plasma-next/</ref>.
As not all applications have been ported to the new system, some workaround exist <ref>http://blog.martin-graesslin.com/blog/2014/06/where-are-my-systray-icons/</ref>.

The workaround can be enabled by activating the <code>legacy-systray</code> and GUI-specific (<code>gtk2</code>, <code>gtk3</code>, <code>qt4</code>) USE flags for {{package|kde-plasma/plasma-desktop}}.

Alternatively, the required packages can be installed manually:

For qt4-based applications that miss a systray icon:
{{Emerge|dev-libs/sni-qt}}
{{Important|{{Package|net-im/skype}} is a 32-bit binary, you need to enable abi_x86_32 on {{Package|dev-libs/sni-qt}}.}}

For gtk3+-based applications that miss a systray icon it might help to install {{Package|dev-libs/libappindicator}}:
{{Emerge|dev-libs/libappindicator:3}}

For gtk2+-based applications that miss a systray icon it might help to install {{Package|dev-libs/libappindicator}}:
{{Emerge|dev-libs/libappindicator:2}}
{{Important|{{Package|net-im/pidgin}} requires {{Package|x11-plugins/pidgin-indicator}}. }}
After install, find this plugin under Tools | Plugins. It is called "Ubuntu Indicator".

Update: there is an application that allows to convert old xembed-based systray icons to SNI icons which can show in Plasma 5: <code>xembed-sni-proxy</code> <ref>http://blog.davidedmundson.co.uk/blog/xembed_back</ref>. To install it, you have to setup [[KDE/Overlay]].
{{Emerge|dev-libs/xembed-sni-proxy}}
Currently this package is under development (probably it will be included in Plasma 5.5), and you will have to unmask/unkeyword it (add <code>=dev-libs/xembed-sni-proxy-9999 **</code> to <code>package.accept-keywords</code> and <code>package.unmask</code> files, see [[Handbook:X86/Portage/Branches#Mixing_stable_with_testing]] for more info about unmasking). More information about <code>xembed-sni-proxy</code> is on [https://github.com/davidedmundson/xembed-sni-proxy  GitHub page].

=== Agent startup/shutdown scripts ===

Configuration moved to {{Path|/etc/plasma/{startup,shutdown}}} for Plasma 5.
{{Note|For KDE SC 4 it is in {{Path|/etc/kde/{startup,shutdown}}}.}}

=== Missing shutdown, reboot, suspend and hibernate buttons when using OpenRC ===

Please ensure that {{package|kde-plasma/powerdevil}} and {{package|sys-power/upower-pm-utils}} ('''not''' {{package|sys-power/upower}}) are installed. Also ensure that your user belongs to the <code>users</code> group.

If you use {{package|x11-misc/sddm}}, try {{package|x11-misc/lightdm}} instead.

=== sddm display issues ===
Check that your user is in the <code>video</code> group.

=== sddm: KCM unable to change themes ===
Sddm needs a configuration file so that the KCM module can change themes. This file is not created during the sddm installation, so it needs to be created manually afterwards:
{{RootCmd|sddm --example-config > /etc/sddm.conf}}

=== kio-extras blocking plasma-workspace-5.4.1 ===
This can happen if you installed {{package|kde-plasma/plasma-workspace}} from the overlay and {{package|kde-apps/kio-extras}} from the tree. Simply do: {{RootCmd|emerge -1 plasma-workspace}}

== References ==
<references />

[[Category:KDE]]
