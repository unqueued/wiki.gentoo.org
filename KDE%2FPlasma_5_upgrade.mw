Plasma 5 is the next generation of KDE's desktop environment, based on Qt 5 and KDE Frameworks 5. Upgrading is fairly simple, although it cannot be coinstalled with Plasma 4 due to upstream design decisions.

Note that while Plasma 5 is in a good state, it is still under heavy upstream development and is missing some features present in KDE 4.

== Overlay (optional) ==
For set and keyword support install [[layman]] and add the [[KDE/Overlay|KDE Overlay]]:
{{RootCmd|echo "app-portage/layman sync-plugin-portage" >> /etc/portage/package.use|emerge --ask app-portage/layman|layman --fetch --add kde}}

== Profile ==
It is highly recommended to use the Plasma desktop profile as it sets a number of important options to ensure things run smoothly.

In order to choose the most suitable profile, first list what's available:

{{RootCmd|eselect profile list|output=<pre>
  [1]   default/linux/amd64/13.0
  [2]   default/linux/amd64/13.0/selinux
  [3]   default/linux/amd64/13.0/desktop
  [4]   default/linux/amd64/13.0/desktop/gnome
  [5]   default/linux/amd64/13.0/desktop/gnome/systemd
  [6]   default/linux/amd64/13.0/desktop/kde
  [7]   default/linux/amd64/13.0/desktop/kde/systemd
  [8]   default/linux/amd64/13.0/desktop/plasma
  [9]   default/linux/amd64/13.0/desktop/plasma/systemd
  ...
</pre>}}

Then, select the right profile, substituting the appropriate profile number (which may vary between configurations):

{{RootCmd|eselect profile set 8}}

Any packages affected by the profile change need to be rebuilt:
{{RootCmd|emerge --ask --changed-use --deep world}}

== Unmasking and keywording ==
In the following examples please adapt "/path/to/overlay/" with the actual path, this is probably: /var/lib/layman/.

It's necessary to unmask the qt5 USE flag:
{{RootCmd|echo "-qt5" >> /etc/portage/profile/use.stable.mask}}

For stable users, you also need to keyword the required packages:
{{RootCmd|cd /etc/portage/package.accept_keywords|
ln -s /path/to/overlay/kde/Documentation/package.accept_keywords/kde-frameworks-5.13.keywords | ln -s /path/to/overlay/kde/Documentation/package.accept_keywords/kde-plasma-5.3.keywords
}}

== Installation ==
The {{Package|kde-plasma/plasma-meta}} package provides the full Plasma 5 suite:
{{RootCmd|emerge --ask kde-plasma/plasma-meta}}

Alternatively, {{Package|kde-plasma/plasma-desktop}} provides the basic desktop, leaving you free to install only the extra packages you require:
{{RootCmd|emerge --ask kde-plasma/plasma-desktop}}

== Display manager ==

[[SDDM]] (Simple Desktop Display Manager) is the recommended login manager and is pulled in automatically via {{package|kde-plasma/plasma-meta}} by default. This is the prefered option when using [[systemd]]. If using [[OpenRC]] [[LightDM]] can be used and pulled in by setting <code>USE</code> flag <code>-sddm</code> for {{package|kde-plasma/plasma-meta}}.
Change the setting accordingly in {{Path| /etc/conf.d/xdm}}.
Also, be sure to read through the [[SDDM]] page if further issues appear.

== Troubleshooting ==
The most common issue with upgrading is running into blockers. Unfortunately, some packages just can't be coinstalled so they'll need to be removed. Feel free to drop by [irc://chat.freenode.net/#gentoo #gentoo] or [irc://chat.freenode.net/#gentoo-kde #gentoo-kde] for assistance with resolving any blockers.

=== Missing systray icons ===

Plasma 5 does not support xembed-based systray icons anymore, but uses the StatusNotifier specification for that <ref>http://blog.martin-graesslin.com/blog/2014/03/system-tray-in-plasma-next/</ref>.
As not all applications have been ported to the new system, some workaround exist <ref>http://blog.martin-graesslin.com/blog/2014/06/where-are-my-systray-icons/</ref>.

The workaround can be enabled by activating the <code>legacy-systray</code> and GUI-specific (<code>gtk2</code>, <code>gtk3</code>, <code>qt4</code>) USE flags for {{package|kde-plasma/plasma-desktop}}.

Alternatively, the required packages can be installed manually:

For qt4-based applications that miss a systray icon:
{{Emerge|dev-libs/sni-qt}}
{{Important|{{Package|net-im/skype}} is a 32-bit binary, you need to enable abi_x86_32 on {{Package|dev-libs/sni-qt}}.}}

For gtk3+-based applications that miss a systray icon it might help to install {{Package|dev-libs/libappindicator}}:
{{Emerge|dev-libs/libappindicator:3}}

For gtk2+-based applications that miss a systray icon it might help to install {{Package|dev-libs/libappindicator}}:
{{Emerge|dev-libs/libappindicator:2}}
{{Important|{{Package|net-im/pidgin}} requires {{Package|x11-plugins/pidgin-indicator}}.}}

=== Agent startup/shutdown scripts ===

Configuration moved to {{Path|/etc/plasma/{startup,shutdown}}} for Plasma 5.
{{Note|For KDE SC 4 it is in {{Path|/etc/kde/{startup,shutdown}}}.}}

=== KWallet ===

KWallet5 will have to open your wallet from KWallet4 and import all the data into a new wallet.

=== Missing shutdown, reboot, suspend and hibernate buttons when using OpenRC ===

Please ensure that {{package|kde-plasma/powerdevil}} and {{package|sys-power/upower-pm-utils}} ('''not''' {{package|sys-power/upower}}) are installed. Also ensure that your user belongs to the <code>users</code> group.

If you use {{package|x11-misc/sddm}}, try {{package|x11-misc/lightdm}} instead.

== References ==
<references />

[[Category:KDE]]
