<languages />
Les équipementiers peuvent mettre à disposition les mises à jours des micrologiciels et du [[BIOS]]. Ces mises à jour sont parfois plus difficiles à effectuer (pour l'utilisateur) via les systèmes GNU/Linux qu'avec des systèmes d'exploitation propriétaires. Leur réalisation peut parfois nécessiter davantage d'opérations.

{{Warning/fr|Souvent, le BIOS n'est mis à jour qu'en cas de dysfonctionnement matériel. On peut endommager irrémédiablement l'ordinateur, lors de la mise à jour, en provoquant des dysfonctionnements irréversibles, par rapport au BIOS, et aboutir à l'annulation de la garantie. Procédez avec précaution.}}

== Obtenir des informations sur le micrologiciel ==

Vous devez d'abord identifier le fabricant et le modèle de la carte mère. Consultez les documents relatifs à la carte mère ou à l'ordinateur. En général, les informations nécessaires se trouveront dans ces documents.

Le paquet {{package|sys-apps/dmidecode}} contient des utilitaires permettant d'obtenir des informations sur le système (nom du constructeur, numéro de série, version du BIOS, etc.). Plus précisément, {{c|dmidecode}} reprend les informations qui sont contenues dans la table DMI <ref>Les informations de la table DMI peuvent être incorrectes bien que la table soit réalisée par le fabricant.</ref>.

{{RootCmd|dmidecode -t bios -t baseboard}}

En dernier recours, on peut consulter les inscriptions sur la carte mère.

{{Warning/fr|Accéder à la carte mère d'un ordinateur peut aboutir à l'annulation de la garantie !}}

Le site web du fabricant propose éventuellement des mises à jour. Normalement, lorsqu'on sélectionne une mise à jour, un fichier ou un répertoire au format .zip, .exe ou .iso est proposé en téléchargement. 

{{Cmd|unzip 7235v1A.zip
|output=<pre>Archive:  7235v1A.zip
   creating: 7235v1A/
inflating: 7235v1A/7235v1x.txt
inflating: 7235v1A/AWFL865.EXE
inflating: 7235v1A/How to flash the BIOS.DOC
inflating: 7235v1A/W7235IMS.1A0
</pre>}}

== Configuration du BIOS  ==

La plupart des BIOS permettent l'amorçage de l'ordinateur à partir d'un support externe, comme une clé USB ou un DVD. On doit configurer l'ordre d'amorçage (cf. [[BIOS]]) pour pouvoir démarrer sur le support externe et effectuer la mise à jour. En cas de difficultés, on peut reprendre la lecture à la section suivante.

== CD de démarrage ==

Les fabricants proposent souvent les mises à jour du BIOS, sous la forme d'une image disque (extensions .iso, .img, etc.). Cette image disque peut être gravée sur un CD-R(W) et être ensuite exécutée à chaque lecture du CD-ROM. On peut graver l'image avec {{c|cdrecord}} :

{{RootCmd|cdrecord BOOT-CD.iso}}

{{Note|cdrecord est fourni par deux paquets (un seul parquet suffit): {{Package|app-cdr/cdrtools}} et {{Package|app-cdr/cdrkit}}}}

Dès à présent, si ce n'est pas déjà fait, il faut configurer le BIOS afin de démarrer sur le CD-ROM. Ensuite, on s'en tient habituellement aux instructions indiquées sur le site web du fabricant.

== Environnement FreeDOS  ==

On peut exécuter des utilitaires compatibles avec DOS, dans un environnement FreeDOS, afin de mettre à jour le BIOS. Une image FreeDOS devra être constituée avec les programmes requis puis exécutée selon l'une des méthodes présentées ci-après.

Télécharger FreeDOS et les outils :

* [https://www.ibiblio.org/pub/micro/pc-stuff/freedos/files/distributions/1.0/ FreeDOS] (télécharger le fichier ''fdboot.img'') 
* [https://www.ibiblio.org/pub/micro/pc-stuff/freedos/files/dos/sys/sys-freedos-linux/ FreeDOS bootsector] (télécharger le fichier ''sys-freedos-linux.zip'')
* Le programme {{c|DOS-Flash}} et la ''nouvelle version'' du BIOS sur le site web du fabricant.

=== Création d'une image FreeDOS ===

Les logiciels requis doivent être téléchargés et le dispositif de bouclage doit être activé dans le noyau :

{{KernelBox|title=enable loopback device|1=
Device Drivers  --->
    [*] Block devices  --->
        <M>   Loopback device support
}}

Il faut utiliser {{c|modprobe}} si le module n'a pas été chargé :

{{RootCmd|modprobe loop}}

On installe les logiciels requis :

{{Emerge|dev-lang/nasm app-arch/unzip sys-fs/dosfstools}}

On crée un fichier image de ~20 Mo nommé {{Path|freedos.img}} grâce à la commande {{c|dd}} :

{{RootCmd|dd if{{=}}/dev/null of{{=}}freedos.img bs{{=}}1024 seek{{=}}20480}}

On crée un pseudo-système de fichiers (système de fichiers virtuel) :

{{RootCmd|mkfs.fat freedos.img}}

On décompresse certains fichiers et on écrit les données sur le secteur d'amorçage de la pseudo-partition :

{{RootCmd|unzip sys-freedos-linux.zip && ./sys-freedos.pl --disk{{=}}freedos.img}}

Ensuite, il faut copier les ''fichiers FreeDOS'' sur le pseudo-système de fichiers.

On crée les points de montage :

{{RootCmd|mkdir -p /mnt/freedos /mnt/freedos_new}}

On monte le fichier ''fdboot.img'' sur {{Path|/mnt/freedos}}  :

{{RootCmd|mount -o loop fdboot.img /mnt/freedos}}

On monte le pseudo-système de fichiers ''freedos.img'' sur {{Path|/mnt/freedos_new}} :

{{RootCmd|mount -o loop freedos.img /mnt/freedos_new}}

On copie les fichiers systèmes de FreeDOS sur le pseudo-système de fichiers {{Path|/mnt/freedos_new/}} :

{{RootCmd|cp -ar /mnt/freedos/* /mnt/freedos_new/}}

On copie les programmes {{c|FLASH-PROGRAM}} et {{c|BIOS-UPDATE}} sur le pseudo-système de fichiers.

{{RootCmd|cp -ar FLASH-PROGRAM BIOS-UPDATE /mnt/freedos_new}}

On démonte les deux pseudo-systèmes de fichiers :

{{RootCmd|umount /mnt/freedos_new /mnt/freedos}}

{{Note|DOS peut seulement afficher les noms dont la longueur n'excède pas 8 caractères. Ce serait idéal de renommer les fichiers ayant un nom constitué de plus de huit caractères.}}

=== Utiliser SystemRescueCD pour démarrer sur FreeDOS ===

SystemRescueCD est aussi disponible en version FreeDOS. Cette version peut être installée sur une clé USB amorçable. Elle contient ce qu'il faut pour mettre à jour le micrologiciel.

==== Téléchargement de SystemRescueCD et préparation de la clé USB autonome ====

* [https://www.sysresccd.org/Download SystemRescueCD] (télécharger l'image ISO standard de SystemRescueCD).

==== Création de la clé USB amorçable ====

On utilise la méthode par défaut pour créer la clé USB autonome SystemRescueCD. Le script {{Path|usb_inst.sh}} aide à réaliser l'installation.

{{Warning/fr|Les opérations suivantes effaceront toutes les données de la clé USB ! On vérifie que l'on dispose d'une copie des données avant de procéder à l'effacement.}}

On crée un répertoire ''SysRescueCD'' dans {{Path|/mnt}} :

{{RootCmd|mkdir /mnt/SysRescueCD}}

On monte l'image disque sur {{Path|/mnt/SysRescueCD}} :

{{RootCmd|mount -o loop systemrescuecd-x86-VERSION.iso /mnt/SysRescueCD}}

On exécute le script d'installation :

{{RootCmd|/mnt/SysRescueCD/usb_inst.sh}}

On démonte l'image disque :

{{RootCmd|umount /mnt/SysRescueCD}}

==== Remplacement de l'image FreeDOS ====

Le moment est venu de remplacer l'image FreeDOS originale de SystemRescueCD.

On monte la clé USB autonome SystemRescueCD (on pense à remplacer {{Path|/dev/sda1}} par le nom de périphérique donné à la clé USB).

{{RootCmd|mount /dev/sdX1 /mnt/SysRescueCD}}

On procède au remplacement avec le fichier {{Path|freedos.img}} :

{{RootCmd|cp freedos.img /mnt/SysRescueCD/bootdisk/}}

On démonte la clé USB autonome SystemRescueCD :

{{RootCmd|umount /mnt/SysRescueCD}}

=== Amorçage de FreeDOS avec GRUB ===

Il n'est pas indispensable d'utiliser un médium car l'utilitaire {{c|memdisk}} de syslinux permet d'amorcer FreeDOS directement ou ultérieurement après le chargement de GRUB (ou un autre chargeur d'amorçage).

{{Emerge|sys-boot/syslinux}}

On peut monter le système de fichiers {{Path|/boot}} (si besoin) :

{{RootCmd|mount /boot}}

On copie {{c|memdisk}} et l'image FreeDOS récemment créée sur le système de fichiers {{Path|/boot}}.

{{RootCmd|cp /usr/share/syslinux/memdisk /boot}}
{{RootCmd|cp freedos.img /boot}}

On édite {{Path|/boot/grub/grub.conf}} pour ajouter une entrée d'amorçage FreeDOS :

{{FileBox|filename=/boot/grub/grub.conf|title=Exemple d'entrée grub.conf|1=
title FreeDOS (BIOS update)
kernel /boot/memdisk floppy
initrd /boot/freedos.img
}}

=== Mise à jour du BIOS ===

On amorce l'ordinateur depuis la clé USB autonome SystemRescueCD. On entre les commandes suivantes si la ligne de commandes de GRUB apparaît :

{{GenericCmd|freedos}}

Ensuite, l'invite de commande DOS apparaît.

{{CodeBox|C:\}}

On peut commencer la mise à jour du BIOS en suivant les instructions du fabricant. Voici, quelques commandes DOS utiles :

; {{c|cd <dir>}}
: Changement de répertoire.

; {{c|dir}}
: Liste les fichiers du répertoire courant.

; {{c|type [drive][path]filename}}
: Affichage du contenu d'un fichier.

== Flashrom ==

On peut également changer le BIOS de certaines cartes mère grâce au système d'exploitation. Dans ce cas, le seul pré-requis est d'utiliser l'image BIOS. Avant tout, on vérifie que le BIOS de la carte mère peut être modifié avec {{c|flashrom}}.

On analyse la nouvelle version avec {{c|flashrom}} si le BIOS de la carte mère est modifiable avec {{c|flashrom}}.

{{RootCmd|flashrom -v W7235IMS.1A0}}

Si tout est OK, on réalise la mise à jour du BIOS  :

{{RootCmd|flashrom -vw W7235IMS.1A0}}

== Voir aussi ==

* [[BIOS | BIOS]]
* [[Bootable DOS USB stick | clé USB autonome DOS]]

== Références ==

{{Reflist}}

[[Category:Core system]]
[[Category:Firmware]]
