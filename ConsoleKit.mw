{{InfoBox stack
|{{InfoBox homepage|https://github.com/ConsoleKit2/ConsoleKit2|header=true}}
|{{InfoBox odoc|https://consolekit2.github.io/ConsoleKit2/}}
}}

'''ConsoleKit''' is a framework for defining and tracking users, login sessions, and seats. ConsoleKit's primary function is to support multi-user setups. It also works for a single user, but offers no benefits compared to existing methods.

ConsoleKit is a [[D-Bus]] daemon and creates for each [[PAM]] session its own session. All applications in that session can make use of the permissions granted to this session. ConsoleKit determines if the session is local (created by a local user in contrast to users logged in over the network), and if the session is active (meaning it's the most recent session). Based on these distinctions, ConsoleKit assigns device file permissions (e.g. for audio, video and more) to the session. Other software like [[polkit]] also make use of these distinctions.

Fast user switching is a feature powered by ConsoleKit. When switching, device file permissions get changed to the new active user and applications in the old session get notified, so they can revoke grants based on ConsoleKit information.

ConsoleKit supports shutdown/reboot handling, so that only the local, active user can shutdown or reboot the system.

The planned multi-seat feature is not fully implemented. At the moment all local sessions are in <code>Seat1</code>, all other sessions are in <code>Seat2</code>.

== Prerequisites ==

This article assumes that [[D-Bus]] has been previously configured.

== Installation ==

=== Kernel ===

{{KernelBox|title=Required options for ConsoleKit|
    General setup --->
      [*] Auditing support
      [*] Enable system-call auditing support
}}

=== USE flags ===

ConsoleKit support can be enabled system-wide by setting the USE flag to [https://packages.gentoo.org/useflags/consolekit <code>consolekit</code>]. The {{c|desktop}} [[Profile (Portage)|profile]]s implicitly enable ConsoleKit.

{{FileBox|filename=/etc/portage/make.conf|lang=bash|1=
USE="consolekit"
}}

{{USEflag|package=sys-auth/consolekit}}

=== Emerge ===

The system needs to be updated if the <var>USE</var> variable was set to <code>consolekit</code>:

{{Emerge
|@world
|params+=--changed-use --deep}}

== Configuration ==

=== startx integration ===

To have a ConsoleKit session created when using {{c|startx}} to start the X server (instead of a [[display manager]]), add the following to each users {{Path|~/.xinitrc}} file:

{{FileBox|filename=~/.xinitrc|lang=bash|1=
exec ck-launch-session dbus-launch --sh-syntax --exit-with-session <WINDOW_MANAGER>
}}

<code>WINDOW_MANAGER</code> in the above example needs to be replaced by a [[:Category:Window manager|window manager]] or a single application.

== Starting ==

To start ConsoleKit:

{{RootCmd|/etc/init.d/consolekit start}}

To start ConsoleKit at boot:

{{RootCmd|rc-update add consolekit default}}

== Usage ==

* {{c|ck-list-sessions}}: Displays the details of all current sessions. For a local user, <code>active</code> and <code>is-local</code> should be <code>TRUE</code>.

== Troubleshooting ==

* {{Bug|consolekit|search=package}}
* {{c|ck-history}}: Use the <code>--log</code> parameter to display the logged messages.
* The ConsoleKit init.d script {{Path|/etc/init.d/consolekit}} uses the <code>-q</code> parameter to suppress debug messages. Remove this parameter and restart the service to get more messages. Use also the parameter <code>--debug</code> to get even more messages.
* Since ConsoleKit communicates over D-Bus, [[D-Bus#Troubleshooting|D-Bus Troubleshooting]] may be of help.

== See also ==

* [[D-Bus]] - An inter-process communication (IPC) system for software applications.

[[Category:Daemons]]
