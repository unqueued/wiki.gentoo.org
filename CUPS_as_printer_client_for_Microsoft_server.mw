Many Microsoft servers started using encryption for their shares. This is also the case for Windows printer shares. In order to print from a Gentoo installation Samba and CUPS will be needed.

== Installation ==

Edit {{Path|/etc/portage/package.use}} to enable active directory support for CIFS and Samba. The following USE flags will pull in the required encryption needed for newer Windows servers:

{{RootCmd|echo "net-fs/cifs-utils ads creds upcall" >> /etc/portage/package.use
|echo "net-fs/samba caps addns ads" >> /etc/portage/package.use}}

Next (re)install {{Package|net-fs/samba}} and {{Package|net-print/cups}}:

{{Emerge|params+=--oneshot|net-fs/samba net-print/cups}}

== Configuration ==

Setting up printers is fairly simple through the web-interface of CUPS. Point a browser to <code>https://localhost:631</code> (which is the default location for the CUPS interface). Click {{Path|Administration}} and choose {{Path|Add Printer}}. There will be a prompt for a username and password of the printer administrator. Now choose {{Path|Windows Printer via SAMBA}} and click continue. The connection to the Samba share is crucial to get the printers working. If on a domain a connection URL will need to be entered. An example is

<code>smb://USERNAME:PASSWORD@DOMAIN/URL/PRINTERSHARE</code>

Where the values for <code>USERNAME</code>, <code>PASSWORD</code>, <code>DOMAIN</code>, <code>URL</code> and <code>PRINTERSHARE</code> are properly substituted with the appropriate values for each use case. When not on a network with a domain-server leave out the <code>DOMAIN/</code> section of the string.

== Troubleshooting ==

If users cannot print try to connect to the print server using the Samba client:

{{Cmd|smbclient -W DOMAIN -U USERNAME //SERVER/PRINTER|output=<pre>
Password: PASSWORD
Domain=[DOMAIN] OS=[Windows Server 2008 R2 Datacenter 7601 Service Pack 1] Server=[Windows Server 2008 R2 Datacenter 6.1]
smb: \> print test.ps
printing file test.ps as test.ps (196,6 kb/s) (average 196,6 kb/s)
smb: \> quit
</pre>}}

Where <code>test.ps</code> is a postscript file located in the local current working directory.

If this test is working, then something went bad when setting up CUPS.
== See also ==
[[Printing#Configuring_a_Linux_Client_for_a_Windows_Print_Server|Configuring a Linux Client for a Windows Print Server]]
[[Category:Core system]]
