Services like netmount or fetchmail which depend on an available network connection could be started/stopped with the following <includeonly>additional</includeonly> setup:<ref name=bug522206>{{Bug|522206|text=Bug 522206 &ndash; net-misc/dhcpcd-6.4.3 fails to start/stop network dependant services like ntpd, sshd, fetchmai}}, [https://bugs.gentoo.org/ Gentoo's Bugzilla Main Page], (Last modified) April 9th, 2015. Retrieved on May 7th, 2015.</ref><noinclude>

=== Precondition ===

Precondition is that [[Network_management|network management]] is done with [[Network_management_using_DHCPCD|dhcpcd]].
</noinclude>
=== Implementation ===

Get the patch for dhcpcd:<ref>{{Bug|522206#c37|text=99-openrc_dhcpcd_hook.patch, updated for epatch_user}}, [https://bugs.gentoo.org/ Gentoo's Bugzilla Main Page], May 8th, 2015. Retrieved on May 10th, 2015.</ref>
{{RootCmd|mkdir -p /etc/portage/patches/net-misc/dhcpcd-6.9.0|wget https://522206.bugs.gentoo.org/attachment.cgi?id{{=}}402858 -P /etc/portage/patches/net-misc/dhcpcd-6.9.0}}

Get the patch for openrc:<ref>{{Bug|522206#c36|text=runscript-background.patch, updated for epatch_user
}}, [https://bugs.gentoo.org/ Gentoo's Bugzilla Main Page], May 8th, 2015. Retrieved on May 10th, 2015.</ref>
{{RootCmd|mkdir -p /etc/portage/patches/sys-apps/openrc-0.13.11|wget https://bugs.gentoo.org/attachment.cgi?id{{=}}402856 -P /etc/portage/patches/sys-apps/openrc-0.13.11}}

Re-emerge both dhcpcd and openrc:
{{RootCmd|emerge -1avt {{=}}net-misc/dhcpcd-6.6.7 {{=}}sys-apps/openrc-0.13.11}}

Add one line '''start_inactive=true''' to the init script:<ref>Roy Marples. {{Bug|522206#c3|text=Mark the dhcpcd service as starting inactive}}, [https://bugs.gentoo.org/ Gentoo's Bugzilla Main Page], September 8th, 2014. Retrieved on May 7th, 2015.</ref>
{{RootCmd|wget https://522206.bugs.gentoo.org/attachment.cgi?id{{=}}384410|patch /etc/init.d/dhcpcd < attachment.cgi?id{{=}}384410}}

Restart dhcpcd:
{{RootCmd|/etc/init.d/dhcpcd restart}}

Later versions than the presently stable of net-misc/dhcpcd and sys-apps/openrc have not been tested with these patches.  It does not work for [https://bugs.gentoo.org/show_bug.cgi?id=522206#c38 sys-apps/openrc-0.16.4].

=== Result ===

Services having "need net" in their init.d scripts like fetchmail would then start after dhcpcd is started.
{{FileBox|filename=/etc/init.d/fetchmail|lang=bash|1=
#!/sbin/runscript

piddir=${pid_dir:-/var/run/fetchmail}
pid_file=${piddir}/${RC_SVCNAME}.pid
rcfile=/etc/${RC_SVCNAME}rc

depend() {
        need net
        use mta
}
}}
{{RootCmd|eselect rc start fetchmail
||output=<pre>Starting init script
dhcpcd          * Starting DHCP Client Daemon ...
fetchmail       * WARNING: fetchmail is scheduled to start when dhcpcd has started            [ ok ]
</pre>}}

They will be stopped when dhcpcd turns inactive and will be restarted when dhcpcd is back.
{{Cmd|rc-config show default|output=<pre>
  dhcpcd                    [inactive]
  fetchmail                 [stopped]
</pre>}}

This should be sufficient for most end user computers. For more complex requirements in dependency behaviour see [[OpenRC#Dependency_behaviour]].

<noinclude>
== References ==
{{reflist}}


</noinclude>
