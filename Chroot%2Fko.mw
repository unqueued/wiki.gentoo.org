<languages />
chroot (루트 바꾸기)는 메인 시스템에서 논리적으로 나뉘는 새 환경을 만들때 눈에 보이는 루트 디렉터리를 바꾸는데 사용하는 유닉스 시스템 유틸리티입니다. 이 새 환경은 "chroot 감옥"으로 알려져 있습니다. 감옥 안의 chroot 감옥에 가둬진 이상 사용자 운영 내부를 보거나 외부로의 파일 접근이 불가능합니다.

chroot의 주된 사용처중 하나는 테스트나 프로그램 호환성을 이유로 현재의 최상단 리눅스 시스템으로부터 분할한 시스템을 만드는데 목적이 있습니다. 종종 가상화의 가벼운 대안이기도 하는데, chroot는 하이퍼바이저의 오버헤드없이 실행할 수 있기 때문입니다.

== 환경 설정 ==

The first thing that you need to do when you create a new installation is create a directory for your chroot to reside in, for example in {{Path|/mnt/mychroot}}:

<!--T:4-->
{{Cmd
|mkdir /mnt/mychroot
|cd /mnt/mychroot
}}

파티션에 이미 있는 설치로 마운트 하려면 다음과 같이 하시면 됩니다:

<!--T:6-->
{{Cmd
|mkdir /mnt/mychroot
|mount /dev/DEVICE /mnt/mychroot
}}

기존의 설치 내용이 들어있는 파티션으로 DEVICE를 바꾸십시오.

이미 있는 곳이 루트의 하위 디렉터리고 설치 내용이 있을 경우, 위의 과정을 진행할 필요가 없습니다.


==Unpacking system files & portage tree for a new installation==

If you're building a new install, the next step is to download the stage3 and portage tarballs and set them up in the chroot location. For more information on this process please see sections 5a and 5b in the [http://www.gentoo.org/doc/en/handbook/handbook-amd64.xml?part=1&chap=5 Gentoo Handbook].

<!--T:10-->
{{RootCmd
|links http://distfiles.gentoo.org/releases/amd64/current-stage3/
|tar xvjpf stage3-*.tar.bz2 -C /mnt/mychroot
|links http://distfiles.gentoo.org/snapshots/
|tar xvjf portage-*.tar.bz2 -C /mnt/mychroot/usr
}}

==Configuration==

Before entering the chroot we need to mount a number of directories.

<!--T:12-->
{{RootCmd
|mount -o bind /dev /mnt/mychroot/dev
|mount -t proc none /mnt/mychroot/proc
|mount -o bind /sys /mnt/mychroot/sys
|mount -o bind /tmp /mnt/mychroot/tmp
}}

And will also need to copy over some basic configuration file from the host, do not copy over {{Path|make.conf}} if you're using an existing installation.

<!--T:14-->
{{Cmd
|cp /etc/portage/make.conf /mnt/mychroot/etc/portage # If you use an existing installation, skip this command.
|cp /etc/resolv.conf /mnt/mychroot/etc
}}

끝내고 나면 chroot 환경으로 진입할 수 있습니다.

<!--T:16-->
{{RootCmd
|chroot /mnt/mychroot /bin/bash
|env-update
|source /etc/profile
|<nowiki>export PS1="(chroot) $PS1"</nowiki>
}}

새 설치를 만들때 모든 것이 최신인지 확인하려 포티지를 동기화 할 수 있습니다.

<!--T:18-->
{{RootCmd
|emerge --sync
}}

The system is now ready. You can install software, mess with settings, test experimental packages and configurations without having any effect on your main system. To leave the chroot simply type "exit" or press {{Key|Ctrl}} + {{Key|D}}, this will return you back to your normal environment. Don't forget to umount directories you've mounted.

==Init scripts==

If you need to do this often, you can speed up the mounting of the directories needed for a chroot by using an init script:

<!--T:21-->
{{File|/etc/init.d/mychroot||
 #!/sbin/runscript

 <!--T:22-->
depend() {
   need localmount
   need bootmisc
 }

 <!--T:23-->
start() {
     ebegin "Mounting chroot directories"
     mount -o bind /dev /mnt/mychroot/dev > /dev/null &
     mount -t proc none /mnt/mychroot/proc > /dev/null &
     mount -o bind /sys /mnt/mychroot/sys > /dev/null &
     mount -o bind /tmp /mnt/mychroot/tmp > /dev/null &
     eend $? "An error occurred while mounting chroot directories"
}

 <!--T:24-->
stop() {
     ebegin "Unmounting chroot directories"
     umount -f /mnt/mychroot/dev > /dev/null &
     umount -f /mnt/mychroot/proc > /dev/null &
     umount -f /mnt/mychroot/sys > /dev/null &
     umount -f /mnt/mychroot/tmp > /dev/null &
     eend $? "An error occurred while unmounting chroot directories"
 }
}}

If you use a different directory or partition, add the necessary mounting commands in start() and change {{Path|/mnt/chroot}} if you use a different name.

==See also==
* [http://www.gentoo.org/proj/en/base/x86/chroot.xml Gentoo x86 Chroot Setup Guide]

[[Category:Core system]]
