<languages />

Chroot ('''Ch'''ange '''root''') is a Unix system utility used to change the apparent root directory to create a new environment logically separate from the main system's root directory. This new environment is known as a "chroot jail". A user operating inside the jail can not see or access files outside of the environment they have been locked into.

One of the main uses for chrooting is to create a separate Linux system on top of a the current one for the purpose of testing or software compatibility. Chroot is often seen as a lightweight alternative to virtualization because it is able to run without the overhead of a hypervisor.

== Setting up the environment ==

When creating a new chroot setup, the first thing needed is a directory for the chroot to reside in. For example, a chroot could be created in {{Path|/mnt/mychroot}}:

{{Cmd
|mkdir /mnt/mychroot
|cd /mnt/mychroot
}}

To mount an existing installation from a partition the following command can be ran. Be sure to replace the <code><DEVICE></code> string in the example below with the drive and partition of the existing installation:

{{Cmd
|mkdir /mnt/mychroot
|mount /dev/DEVICE /mnt/mychroot
}}

If an installation has been previously created in a sub directory of the current root file system the above steps can be skipped.

== Unpacking system files and the Portage tree (new installations) ==

When building a new install, the next step is to download the stage3 and Portage tarballs and set them up in the chroot location. For more information on this process please see sections 5a and 5b in the [http://www.gentoo.org/doc/en/handbook/handbook-amd64.xml?part=1&chap=5 Gentoo Handbook].

{{RootCmd
|links http://distfiles.gentoo.org/releases/amd64/current-stage3/
|tar xvjpf stage3-*.tar.bz2 -C /mnt/mychroot
|links http://distfiles.gentoo.org/snapshots/
|tar xvjf portage-*.tar.bz2 -C /mnt/mychroot/usr
}}

== 설정 ==

Before entering the chroot a number of directories need to be mounted:

{{RootCmd
|mount -o bind /dev /mnt/mychroot/dev
|mount -t proc none /mnt/mychroot/proc
|mount -o bind /sys /mnt/mychroot/sys
|mount -o bind /tmp /mnt/mychroot/tmp
}}

Some basic configuration files will need to be copied from the host, do not copy over {{Path|make.conf}} when using an existing installation:

{{Cmd
|cp /etc/portage/make.conf /mnt/mychroot/etc/portage # If you use an existing installation, skip this command.
|cp /etc/resolv.conf /mnt/mychroot/etc
}}

끝내고 나면 다음 명령을 실행하여 chroot 환경으로 진입할 수 있습니다:

{{RootCmd
|chroot /mnt/mychroot /bin/bash
|env-update
|source /etc/profile
|<nowiki>export PS1="(chroot) $PS1"</nowiki>
}}

새로 설치할 때 모든 항목이 최신인지 확인하려면 포티지를 동기화 해야합니다.

{{RootCmd
|emerge --sync
}}

시스템을 준비했습니다. 프로그램을 설치하고, 문자열로 화면을 어지럽히며 시험 패키지를 테스트하고, 메인 시스템에 영향을 주지 않는 설정을 할 수 있습니다. chroot에서 빠져나가려면 <kbd>exit</kbd>를 입력하거나 {{Key|Ctrl}}+{{Key|D}}를 입력하시면 됩니다. 이렇게 하면 보통 환경으로 되돌아갈 수 있습니다. 마운트한 디렉터리의 마운트 해제를 잊지 마십시오.

==Init 스크립트==

If setting up chroots is a task that is needed to be performed often, it is possible to speed up the mounting of the directories by using an init script:

{{FileBox|filename=/etc/init.d/mychroot|lang=bash|1=
#!/sbin/runscript
 
depend() {
   need localmount
   need bootmisc
}
 
start() {
     ebegin "Mounting chroot directories"
     mount -o rbind /dev /mnt/mychroot/dev > /dev/null &
     mount -t proc none /mnt/mychroot/proc > /dev/null &
     mount -o bind /sys /mnt/mychroot/sys > /dev/null &
     mount -o bind /tmp /mnt/mychroot/tmp > /dev/null &
     eend $? "An error occurred while mounting chroot directories"
}
 
stop() {
     ebegin "Unmounting chroot directories"
     umount -f /mnt/mychroot/dev > /dev/null &
     umount -f /mnt/mychroot/proc > /dev/null &
     umount -f /mnt/mychroot/sys > /dev/null &
     umount -f /mnt/mychroot/tmp > /dev/null &
     eend $? "An error occurred while unmounting chroot directories"
}
}}

다른 디렉터리나 파티션을 사용한다면, 필요한 마운트 명령을 <code>start()</code>에 적고, {{Path|/mnt/chroot}}을 적당한 이름으로 바꾸십시오.

== 추가 참조 ==

* [[Project:X86/Chroot Guide|Chroot 안내서]]


[[Category:Core system]]
