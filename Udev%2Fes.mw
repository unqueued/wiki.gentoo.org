<languages />
{{Metadata|abstract=udev es el gestor de dispositivos para el núcleo Linux. Gestiona los nodos de dispositivo en /dev y también todos las acciones en espacio de usuario cuando se añaden o eliminan dispositivos.}}

{{Lowercase title}}
{{InfoBox stack
|{{InfoBox homepage|http://www.freedesktop.org/wiki/Software/systemd/|header=true}}
|{{InfoBox gdoc|Udev}}
|{{InfoBox wikipedia}}
|{{InfoBox gitweb|http://cgit.freedesktop.org/systemd/systemd/tree/src/udev|raw=true}}
}}

'''udev''' es el gestor de dispositivos para el núcleo Linux. Gestiona los nodos de dispositivo en {{Path|/dev}} y también todos las acciones en espacio de usuario cuando se añaden o eliminan dispositivos. El lector debería también echar un vistazo a [Project:Eudev|eudev] una bifurcación de udev.

== ¿Qué es udev? ==

=== El directorio /dev ===

Cuando los usuarios de Linux hablan acerca del hardware de sus sistemas a gente que puede llegar a pensar que Linux es algún tipo de virus o marca de café, el uso de términos como "barra dev barra algo" provocará, sin dudas, miradas raras. Pero para el usuario afortunado (y esto incluye al lector de este artículo) el usar {{Path|/dev/sda1}} es solo una forma rápida de referenciar a la primera partición del disco primer disco SATA. Eso es muy fácil ¿no? 

La mayoría de los usuarios de Linux saben lo que es un [[device file|archivo de dispositivo]]. Algunos incluso saben porqué los archivos de dispositivo tienen asociados números especiales. Echa un vistazo a la lista de dispositivos cuando se lanza {{c|ls -l}} en el directorio {{Path|/dev}}. Lo que asumen los usuarios es que el primer disco SATA se referencia como {{Path|/dev/sda}}. Puede que algunos usuarios no lo vean de esta forma,  pero esto es un fallo de diseño. 

Piense en los dispositivos que se enchufan en caliente como los USB, IEEE 1394, tarjetas PCI que se cambian en caliente, etc. ¿Cuál es el primer dispositivo? ¿Y por cuánto tiempo? ¿Cómo se llamarán los demás dispositivos cuando el primero desaparezca? ¿Cómo afectará ésto a las transacciones en curso? ¿No sería divertido que un trabajo de impresión se cambiase de repente desde su flamante impresora láser nueva a una moribunda impresora de matriz solo porque la madre de alguien decidió desenchufar la impresora láser que era la primera impresora? 

Entra en escena {{c|udev}}. Los objetivos del proyecto udev son a la vez interesantes y necesarios. Udev:

* Corre en espacio de usuario
* Crea y borra archivos de dispositivo dinámicamente
* Proporciona nombres consistentes
* Proporciona un interfaz de aplicación (API) en el espacio de usuario.

Cada vez que se produce un cambio en la estructura de los dispositivos, el núcleo emite un ''uevent'' que recoge {{c|udev}}. Entonces, {{c|udev}} sigue las reglas declaradas en los directorios {{Path|/etc/udev/rules.d}}, {{Path|/run/udev/rules.d}} y {{Path|/lib/udev/rules.d}}. Basándose en la información contenida en el evento, busca la regla o reglas que necesita ejecutar y realiza las acciones requeridas. Estas acciones pueden consistir en la creación o eliminación de ficheros de dispositivo, pero pueden suponer también la carga de ficheros de firmware particulares en la memoria del núcleo.

== Instalación ==

{{Important|Cuando actualice udev, eche un vistazo a [[Udev/Upgrade Guide|guía de actualización de udev]] para obtener información sobre cómo evitar que los sistemas no inicien.}}

=== Núcleo ===

{{c|udev}} necesita las siguientes opciones del núcleo:

<!-- Mire en  http://git.kernel.org/?p=linux/hotplug/udev.git;a=blob_plain;f=README -->
{{KernelBox|1=
General setup --->
  [*] Configure standard kernel features (expert users) --->
     [ ] Enable deprecated sysfs features to support old userspace tools
     [*] Enable signalfd() system call
Enable the block layer --->
  [*] Block layer SG support v4
Networking support --->
  Networking options --->
     <*> Unix domain sockets
Device Drivers --->
  Generic Driver Options --->
     () path to uevent helper
     [*] Maintain a devtmpfs filesystem to mount at /dev
  < > ATA/ATAPI/MFM/RLL support (DEPRECATED) --->
File systems --->
  [*] Inotify support for userspace
  Pseudo filesystems --->
     [*] /proc file system support
     [*] sysfs file system support
}}

=== Ajustes USE ===

Portage knows the <code>udev</code> global USE flag for enabling support for udev in other packages. Adding this USE flag value to the USE flag list (default in all Linux [[Profile (Portage)|profiles]]) will pull in the {{Package|sys-fs/udev}} package automatically:

{{FileBox|filename=/etc/portage/make.conf|lang=bash|1=
USE="udev"
}}

{{USEflag|package=sys-fs/udev}}

=== Emerge ===

Después de definir los ajustes USE, seguramente desee actualizar el sistema para que los cambios tengan efecto:

{{Emerge|params+=--changed-use --deep|@world}}

== Configuración ==

=== Servicio ===

Para arrancar udev en el inicio del sistema, añádalo al nivel de ejecución sysinit. Esto se puede hacer lanzando la siguiente orden con privilegios de root:

{{RootCmd|rc-update add udev sysinit}}

== Configuración avanzada ==

=== Reglas ===

Udev ofrece un conjunto de reglas que concuerdan con los valores exportados de los uevents (eventos enviados por el núcleo) y las propiedades del dispositivo que se ha descubierto. Una regla que concuerda posiblemente creará y nombrará un nodo de dispositivo y lanzará los programas definidos para poner en marcha y configurar el dispositivo.

Las definiciones de las reglas se almacenan en dos localizaciones:

# '''{{Path|/lib/udev/rules.d/}}'''. Las reglas en este directorio son instaladas por determinados paquetes, normalmente los usuarios no deberían cambiarlas.
# '''{{Path|/etc/udev/rules.d/}}'''. Este directorio es para las reglas especificadas por los usuarios finales. Cualquier nueva regla se debe añadir en este directorio.

En estos directorios se recorren en orden alfabético múltiples ficheros de reglas (con el sufijo {{Path|.rules}}), udev buscará expresiones que concuerden con un uevent y con el estado definido (es el uevent debido que se ha añadido o retirado un dispositivo) y la orden a ejecutar.

La concordancia del evento se basa en información como:

* The ''SUBSYSTEM'' of the uevent (for which type of device is the uevent fired);
* The ''ACTION'' that is taken (add, change, or remove);
* One or more attributes (through ''ATTR'' or ''ATTRS''), such as the device class, vendor or other device information;
* The kernel-provided name (through ''KERNEL''), such as sd* (for SCSI/SATA disks) or input* (for input devices such as mice and keyboards);
* One or more environment settings (through ''ENV''), used to send information between multiple rules.

Basándose en esta información, la regla puede entonces comprobar sí:

# Se necesita compartir alguna información con eventos posteriores (a través de variables de entorno)
# Se necesita crear enlaces en {{Path|/dev}}
# Se necesita lanzar alguna orden

Udev realiza esto para cada regla que concuerda (por lo que no se detiene en la primera concordancia) para permitir un enfoque flexible de gestión de los dispositivos.

=== Nombres persistentes de dispositivos ===

El núcleo detecta los dispositivos de forma asíncrona. Udev crea un reflejo del sistema de ficheros del núcleo [[sysfs]] y por lo tanto los dispositivos se nombran y numeran en el orden de su detección. Así, por defecto udev no ofrece nombres persistentes de los dispositivos. Sin embargo, existen mecanismos de algunas clases de dispositivo para ofrecerlos:

* Udev creates for storage devices additional symlinks based on the device's ID, [[Removable_media#UUIDs_and_labels|label, UUID]] and path. See the {{Path|/dev/disk/by-*}} directory. So instead of using e.g. the device file {{Path|/dev/sda}} use the file {{Path|/dev/disk/by-label/SOME_LABEL}}.

* Lo mismo aplica para los dispositivos de entrada en el directorio {{Path|/dev/input}}.

* Usando reglas propias los usuarios pueden crear sus propios ficheros de dispositivo.

== Utilización ==

Algunas órdenes útiles son las siguientes:

* Mostrar todos los mensajes sobre un determinado archivo de dispositivo: : {{RootCmd|udevadm info --query{{=}}all --name{{=}}/dev/FICHERO_DE_DISPOSITIVO}}

* Monitorizar las actividades de udev: {{RootCmd|udevadm monitor}}

Lea la [[man page|página del manual]] de ''udevadm'' para más información.

== Resolución de problemas ==

* {{Bug|udev|search=package}}

=== Registrar mensajes del monitor ===

To log all message when {{c|udevadm monitor}} is ran, modify the following configuration file:

{{FileBox|filename=/etc/conf.d/udev|lang=bash|1=
udev_monitor="YES"
}}

Se creará un el nuevo fichero de registro localizado en {{Path|/run/udev/udevmonitor.log}}.

=== Modo depuración ===

Habilitar el modo depuración permitirá mostrar más mensajes de registro:

{{FileBox|filename=/etc/conf.d/udev|lang=bash|1=
udev_debug="YES"
}}

Defina la prioridad del registro:

{{FileBox|filename=/etc/udev/udev.conf|lang=bash|1=
udev_log="debug"
}}

The log file {{Path|/run/udevdebug.log}} will be created but no messages will be logged to it. The most recent versions of udev will log all messages to {{c|dmesg}}.

=== Faltan los ficheros de dispositivo {{Path|/dev/null}} y {{Path|/dev/console}} ===

Algunas versiones de udev necesitan los ficheros {{Path|/dev/null}} y {{Path|/dev/console}} para funcionar correctamente pero no pueden crearlos ellos mismos. Para crear manualmente estos ficheros por udev, lance las siguientes ordenes con privilegios de root:

{{RootCmd
|mkdir test
|mount --bind / test
|cd test/dev
|mknod -m 660 console c 5 1
|mknod -m 660 null c 1 3
|cd ../..
|umount test
|rmdir test
}}

=== NIC asignada a eth0 pero se mueve a eth1 ===

Those having dual network cards on their motherboards may run into a situation where {{c|ifconfig}} may show no eth0 or eth1. {{c|dmesg}} may show their NIC detected as eth0, and later moved to eth1. Performing a {{c|ifconfig -a}} will also show the NIC as eth1. This is caused by using the kernel assigned names in the first place. Users should write custom rules like {{Path|/etc/udev/rules.d/70-my-network.rules}} to use free names like lan0 or wireless0 or use predictable interface names (which have been enabled by default since udev version 197).

Recuerde también eliminar los ficheros antiguos de las versiones anteriores de udev:

{{RootCmd|rm /etc/udev/rules.d/70-persistent-net.rules}}

== See also ==

== Recursos externos ==
* [http://cgit.freedesktop.org/systemd/systemd/tree/src/udev Código fuente de udev]


[[Category:Core system]]
[[Category:Daemons]]
