This document [[Article description::describes various ways how to update your CPU's microcode in Gentoo]].

== Introduction ==

Modern processors are complex devices that can have bugs. Furthermore, instead of executing x86 instructions directly, modern x86 processors contain internal code that implements support for the x86 instruction set. The internal code is called microcode. Microcode can be updated to fix or mitigate CPU bugs.

And because [[Complete_Handbook/Making_a_choice|Gentoo is about choices]] there there isn't just one way to update your CPU's microcode. Please choose the workflow which suits your setup.

== Dracut ==

<Please help!>

== Genkernel ==

When you are already using {{Package|sys-kernel/genkernel}}, all you need to do is to ensure, that you have installed the package containing microcode updates for your processor (see below) and make sure you call ''genkernel'' next time with ''--microcode'' parameter:

{{Emerge|sys-kernel/genkernel}}

and just call it with ''--microcode'' parameter, i.e.

{{RootCmd|1=genkernel --microcode}}

If you just want to generate a new Initramfs with microcodes, call

{{RootCmd|1=genkernel --microcode initramfs}}

and make sure you instruct your bootloader to load the newly generated initramfs.

It is recommended that you update your ''genkernel.conf'' and make sure it contains

{{FileBox|filename=/etc/genkernel.conf|lang=text|1=
# Add in early microcode support
MICROCODE="yes"
}}

so that you don't need to remember to pass the ''--microcode'' parameter all the time.

{{Note|You need {{c|&gt;&#61;}}{{Package|sys-kernel/genkernel}}-3.5.0.7 for microcode support which isn't yet stabilized. Please see for [[Knowledge_Base:Accepting_a_keyword_for_a_single_package|how to keyword a single package]].}}

== The manual way ==

<Please help!>

=== Early microcode loading ===
Basically you provide the microcode as the first initramfs (aka initrd, in cpio format) to the kernel during boot. Grub (both legacy and grub2) lets you specify multiple cpio images separated by space in the initrd command.

<Please help!>

=== Late microcode loading ===

If your kernel has microcode loading support,

{{KernelBox|title=Configuring a kernel to support microcode loading|<pre>
Processor type and features --->
   [*] CPU microcode loading support
   [*]   Intel microcode loading support
   [*]   AMD microcode loading support</pre>
(you only need AMD or Intel microcode loading support, not both)
}}

also ensure you have installed the package which is providing microcode updates for your processor (see below).

To instruct the kernel to reload microcodes, do

{{RootCmd|1=echo 1 > /sys/devices/system/cpu/microcode/reload}}

and watch ''dmesg'' for any errors.

{{Note|You must run the command above after every reboot or firmware package update.}}

== Specifics ==

<Please help!>

=== AMD specifics ===

AMD microcodes are bundled in the {{Package|sys-kernel/linux-firmware}} package.

=== Intel specifics ===
see also [[Intel_microcode]]

Intel microcodes are bundled in the {{Package|sys-firmware/intel-microcode}} package.
