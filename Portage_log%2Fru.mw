<languages />
When using {{c|emerge}} for building a package, it is not uncommon to notice messages coming from [[Portage]] itself. Since they may contain important information from Gentoo developers it is a good idea to read them, but often this is not immediately possible because they rapidly scroll out of the screen. This can be easily solved by enabling a Portage [[FEATURES|feature]] called elog, whose purpose is to save messages to disk for later review. But other logging capabilities exist as well...

== Подсистема elog в portage ==

The Portage elog subsystem keeps track of specific, ebuild-provided log messages that developers have put in the [[ebuild]]s to attract attention of the administrator or user. Often, these messages contain important or interesting information related to the build of said package.

=== Настройка ===

С помощью переменной <var>PORTAGE_ELOG_CLASSES</var> выберите какой тип информации нужно журналировать. Возможные значения <code>info</code>, <code>warn</code>, <code>error</code>, <code>log</code> и <code>qa</code>:

{{FileBox|filename=[[:/etc/portage/make.conf]]|lang=bash|1=
PORTAGE_ELOG_CLASSES="log warn error"
}}

=== Настройка для хранения в виде файлов ===

Portage может обрабатывать события elog в ряде случаев.

Для того чтобы сохранить события elog на диск, включите модуль <code>save</code> в переменной <var>PORTAGE_ELOG_SYSTEM</var>:

{{FileBox|filename=/etc/portage/make.conf|lang=bash|1=
PORTAGE_ELOG_SYSTEM="save"
}}

Сообщения будут сохранены в файл {{Path|/var/log/portage/elog}} или в файл {{Path|${PORT_LOGDIR}/elog}}, если указанная переменная установлена.

Для того чтобы создать файлы elog для каждой категории, включите <code>split-elog</code>. Это заставить Portage в каталоге {{Path|/var/log/portage/elog}} создавать подкаталоги для каждой категории.

=== Настройка для e-mail ===

Для того чтобы отправить журнал по почте, включите модуль <code>mail</code>. Для модуля mail необходимо установить некоторые дополнительные переменные. Чтобы получить больше информации, прочитайте {{Path|/usr/share/portage/config/make.conf.example}}.

Ниже, показан пример настройки, который говорит, надеемся, сам за себя:

{{FileBox|filename=/etc/portage/make.conf|lang=bash|1=
PORTAGE_ELOG_SYSTEM="mail"
# Сперва ящик для сообщений, затем сервер SMTP
PORTAGE_ELOG_MAILURI="log-intake@example.com mail.example.com"
PORTAGE_ELOG_MAILFROM="portage@$(hostname).example.com"
PORTAGE_ELOG_MAILSUBJECT="${PACKAGE} is ${ACTION} on ${HOST}"
}}

Другой пример для nullmailer или sendmail:

{{FileBox|filename=/etc/portage/make.conf|lang=bash|1=
PORTAGE_ELOG_SYSTEM="mail"
# Сперва ящик для сообщений, затем сервер SMTP
PORTAGE_ELOG_MAILURI="users@host /usr/sbin/sendmail"
PORTAGE_ELOG_MAILFROM="portage@$(hostname).example.com"
PORTAGE_ELOG_MAILSUBJECT="${PACKAGE} is ${ACTION} on ${HOST}"
}}

=== Сопутствующее программное обеспечение ===

Далее идет список сопутствующего для elog программного обеспечения:

* {{Package|app-portage/elogv}} - утилита сделанная на библиотеки curses для разбора содержимого файлов elog
* {{Package|app-portage/elogviewer}} - просмотрщик файлов elog сделанный на основе Python

== Build logs ==

With the Portage elog subsystem, package build logs are saved on disk or mailed to a remote recipient, regardless of failure or success. This allows for administrators to review builds later or retrieve build logs for support tickets.

=== Настройка ===

Чтобы включить журналирование Portage, отредактируйте файл {{Path|[[:/etc/portage/make.conf]]}} и установите в переменной <var>PORT_LOGDIR</var> каталог, где файлы журналов будут храниться. По умолчанию Portage использует {{Path|/var/log/portage}}:

{{FileBox|filename=/etc/portage/make.conf|lang=bash|1=
PORT_LOGDIR="/var/log/portage"
}}

Далее несколько настроек для переменной <var>FEATURES</var> влияющих на то, как Portage будет обрабатывать журналы компиляции.

* With <code>binpkg-logs</code> set, even binary package deployments will have their logs saved
* When <code>clean-logs</code> is set, regular log file clean operations are executed. The command that is executed is defined by <var>PORT_LOGDIR_CLEAN</var> and defaults to a retention of the files of 7 days.
* With <code>split-log</code> set, build logs are stored in category-named subdirectories of <code>${PORT_LOGDIR}/build</code>

=== Очистка ===

Если установлен <code>clean-logs</code>, Portage будет выполнять команду, которая определена в переменной <var>PORT_LOGDIR_CLEAN</var>, после каждой операции компиляции или удаления. По умолчанию используется следующая команда:

{{FileBox|filename=/usr/share/portage/config/make.globals|lang=bash|1=
PORT_LOGDIR_CLEAN="find \"\${PORT_LOGDIR}\" -type f ! -name \"summary.log*\" -mtime +7 -delete"
}}

When defining a custom command, do not forget to ''escape'' the <var>PORT_LOGDIR</var> variable (or immediately hardcode the right location).

== Внешние ресурсы ==

* [http://blog.siphos.be/2013/09/underestimated-or-underused-portage-elogging/ Underestimated or underused: Portage (e)logging] on ([[User:SwifT|Sven Vermeulen]]'s blog)

[[Category:Portage]]
