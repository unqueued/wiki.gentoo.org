<languages />
{{InfoBox stack
|{{InfoBox wikipedia|Java_(programming_language)|header=true}}
|{{InfoBox project|Java}}
}}
{{Metadata|abstract=Это руководство знакомит читателя с Java и объясняется, как использовать Java в Gentoo Linux.}}
Это руководство знакомит читателя с Java и объясняется, как использовать Java в Gentoo Linux.

== Что такое Java? ==

=== Общий обзор ===

Java — это язык программирования, разрабатываемый инженерами Sun Microsystems. Язык является объектно-ориентированным и предназначен для запуска на различных платформах без необходимости перекомпиляции кода для каждой платформы. Хотя программа на Java и может быть скомпилирована в нативный код, изрядную долю популярности языку принесла портируемость, а также некоторые другие возможности, такие как сборка мусора. Чтобы сделать независимость от платформы возможной, компилятор Java компилирует Java-код в промежуточное представление, называемое «байт-кодом Java» (Java bytecode), которое запускается в JRE (среде выполнения Java), а не непосредственно в операционной системе. 

Для запуска байт-кода Java, необходимо наличие установленной JRE (Java Runtime Environment). JRE предоставляет доступ к основным библиотекам, зависящей от платформы виртуальной машине Java, плагинам для браузеров и другим вещам. JDK (Java Development Kit) добавляет программные инструменты, такие как компилятор в байт-код и отладчик.

== Установка виртуальной машины ==

=== Выбор ===

Gentoo предоставляет различные (среды выполнения) Java Runtime Environments (JRE) и (пакеты средств для разработчиков) Java Development Kits (JDK). В числе текущих вариантов, имеются: 

{| class="table table-condensed table-striped" style="text-align: left;" 
|- 
! Производитель
! JDK
! JRE
|- 
| IcedTea Open Java SE (ранее icedtea6-bin)
| {{Package|dev-java/icedtea}} и {{Package|dev-java/icedtea-bin}}
| 
|- 
| Java от Oracle
| {{Package|dev-java/oracle-jdk-bin}}
| {{Package|dev-java/oracle-jre-bin}}
|-
| GCJ IcedTea GNU GCC Java (на данный момент IcedTea-7)
| {{Package|dev-java/icedtea}} {{Package|sys-devel/gcc}}  USE="gcj"
|}

=== Установка JRE/JDK ===

Для установки дефолтного '''JDK''' из профиля, запустите:

{{Emerge|virtual/jdk}}

Для установки дефолтного '''JRE''' из профиля, запустите

{{Emerge|virtual/jre}}

Некоторые JDK и JRE, включая пакеты от Oracle, требуют принятия лицензионного соглашения конечного пользователя (End User License Agreement), или EULA. Если лицензия JDK или JRE (например, dlj-1.1) не указана в переменной <var>ACCEPT_LICENSE</var> (находящейся в файле {{Path|/etc/portage/make.conf}}), тогда эту JDK/JRE установить не удастся. Более подробно о том, как можно добавить допустимые лицензии в {{Path|make.conf}}, можно прочитать в главе [[Handbook:X86/Working/Portage/ru#Лицензии|Лицензии]] Portage Handbook. 

Чтобы избежать какой-либо суматохи с лицензионными ограничениями, рассмотрите установку icedtea-bin, который является открытой реализацией Java из проекта OpenJDK. 

{{Note|Имейте ввиду, что ''JDK'' также включает в себя ''JRE''; необязательно ставить JRE, если JDK уже был установлен.}}

=== Установка виртуальной машины IcedTea GCJ ===

Виртуальная машина Icedtea доступна в виде исходного кода и требует компиляции байт-кода компилятором Java. Эту начальную установку можно запустить с помощью GNU Compiler for Java (GCJ). Этот компилятор доступен, если GCC собран с USE-флагом <code>gcj</code>.

Если GCC собран с этим USE-флагом, можно приступить к установке пакета {{Package|dev-java/icedtea}}:

{{Emerge|dev-java/icedtea}}

=== Установка виртуальных машин с ограничениями на скачивание исходного кода ===

Настройка некоторых JDK и JRE требует некоторых дополнительных действий. Установите пакеты как обычно; если потребуются дополнительные действия, пакеты укажут, куда необходимо перейти и что необходимо загрузить.

Загрузите указанные файлы в каталог {{Path|/usr/portage/distfiles}}, повторно запустите {{c|emerge}}, и JRE/JDK будет установлен.

=== Установка headless JRE === 

Бывают случаи, когда не требуется установка полноценной JRE со всеми возможностями java. При использовании java на сервере часто не требуются такие возможности, как графический интерфейс пользователя, графика, звук или печать. Чтобы установить упрощенную JRE, иногда называемую headless, необходимо изменить некоторые USE-флаги. 

{{FileBox|filename=/etc/portage/package.use|title=Требование изменение USE-флага|1=
virtual/jre headless-awt -alsa -cups
}}

В зависимости от используемого профиля Gentoo, эти флаги уже могут быть установлены. Как обычно, проверить, какие USE-флаги установлены для конкретного пакета можно, запустив {{c|emerge}} в режиме pretend:

{{Cmd|emerge --pretend --verbose virtual/jre}}

== Настройка виртуальной машины java ==

=== Общий обзор ===

На Gentoo, возможна установка множества разных JDK и JRE без вызова конфликтов. 

Установить общесистемную виртуальную машину java (VM), используемую по умолчанию, можно, запустив утилиту {{c|java-config}} с административными привилегиями. Пользователи также могут воспользоваться этой утилитой для установки пользовательской виртуальной машины. 

{{Note|Также, можете пользоваться командой {{c|eselect}} для изменения системной и пользовательской виртуальной машины. Обратитесь к {{c|eselect java-vm help}}.}}

=== Установка виртуальной машины по умолчанию ===

Запуск команды {{c|java-config}} с опцией <code>--list-available-vms</code> выведет список всех JRE и JDK, установленных в системе. Ниже приведен пример работы команды: 

{{RootCmd|java-config --list-available-vms|output=<pre>
The following VMs are available for generation-2:
1)      IcedTea JDK 7.2.6.3 [icedtea-7]
*)      IcedTea JDK 3.0.1 [icedtea-8]
</pre>
}}

{{Note|Виртуальные машины, помеченные как 'Build Only', могут быть уязвимы с точки зрения безопасности и/или могут находиться в состоянии конца жизненного цикла (EOL). Gentoo не рекомендует использовать эти виртуальные машины в качестве системных ''или'' пользовательских. Подробнее читайте в разделе [[Java/ru#Виртуальные машины Build only|Виртуальные машины Build only]].}}

Символ ''*'' означает, что эта виртуальная машина является активной (системной или пользовательской, если последняя установлена). Имя в квадратных скобках является идентификатором данной виртуальной машины. Установить виртуальную машину можно, подав ее идентификатор или номер в качестве аргумента команде {{c|java-config --set-system-vm}}. Следующий пример показывает, как можно установить системную виртуальную машину.

Установка системной виртуальной машины с использованием имени (рекомендуемый способ):

{{RootCmd|java-config --set-system-vm icedtea-7|output=<pre>
Now using icedtea-7 as your generation-2 system JVM
</pre>}}

Альтернативный способ: выбор виртуальной машины с помощью номера:

{{RootCmd|java-config --set-system-vm 3|output=<pre>
Now using icedtea-7 as your generation-2 system JVM
</pre>
}}

В качестве обычного пользователя, запустите java-config <code>--set-user-vm</code>. 

{{Note/ru|Выполнение команды {{c|source}} для текущего профиля для работающих сеансов оболочки обычно не требуется после изменения пользовательской или системной виртуальной машины. Единственное исключение: такие переменные, как <var>JAVA_HOME</var>, будут по-прежнему указывать на старое местоположение после установки пользовательской виртуальной машины в первый раз, или будут снова указывать на системную виртуальную машину.}}

=== Виртуальные машины Build only ===

Некоторые виртуальные машины отмечены как build-only, вследствие завершения жизненного цикла (EOL) и/или содержащихся уязвимостей. Эти виртуальные машины не выбираются системой автоматически с использованием Gentoo Launchers (скрипт, созданный для переключения виртуальных машин в Java), но все еще доступны для использования средой сборки Gentoo, так как некоторые пакеты могут потребовать их для сборки. Настройка такой виртуальной машины в качестве системной или пользовательской машины строго не рекомендуется, так как в таком случае она будет использоваться для запуска {{Path|/usr/bin/{java,javac,...}}}, а также ее будут использовать пакеты, не использующие стандартные скрипты Gentoo для запуска Java-приложений.

== Установка переменной CLASSPATH по умолчанию ==

{{Warning/ru|Параметры, описанные в этом разделе, следует считать устаревшими. Скорее всего, они будут убраны в будущем. Настоятельно рекомендуется не использовать эти параметры, поскольку проекты и приложения Java, в идеале, должны управлять своими путями классов. Если указать переменную <var>CLASSPATH</var> по умолчанию, некоторые приложения могут повести себя непредсказуемо, по причине наличия в пути классов классов, которые они не ожидали там найти.}}

{{c|java-config}} также можно использовать для установки общесистемной и пользовательской переменной <var>CLASSPATH</var> по умолчанию. 

Прежде всего, выведите все доступные библиотеки Java, установленные в системе, которые можно поместить в переменную <var>CLASSPATH</var>. Вот пример вывода: 

{{RootCmd|java-config --list-available-packages|output=<pre>
[xerces-2] The next generation of high performance, fully compliant XML parsers in the Apache Xerces family (/usr/share/xerces-2/package.env)
[junit] Simple framework to write repeatable tests (/usr/share/junit/package.env)
[bsh] BeanShell: A small embeddable Java source interpreter (/usr/share/bsh/package.env)
[bcel] The Byte Code Engineering Library: analyze, create, manipulate Java class files (/usr/share/bcel/package.env)
[log4j] A low-overhead robust logging package for Java (/usr/share/log4j/package.env)
...
</pre>
}}

Опять-таки, имена в квадратных скобках являются идентификаторами для передачи команде {{c|java-config --set-system-classpath}}. Например: 


{{RootCmd|java-config --set-system-classpath log4j,xerces-2}}

{{Note/ru|Текущий каталог ({{Path|.}}) не будет являться частью системного параметра classpath, так как это должно быть добавлено в профиль входа в систему.}}

Update the environment by logging out, then in again or by typing {{c|source {{Path|/etc/profile}}}} 

For users, java-config --set-user-classpath will create {{Path|~/.gentoo/java-env-classpath}}, which should then source from the shell's profile. 

{{CodeBox|title=Запуск команд пользовательского файла classpath|1=
if [[ -f "${HOME}/.gentoo/java-env-classpath" ]]; then
       source ${HOME}/.gentoo/java-env-classpath
fi
}}

If desiring a system wide or user default classpath add something like the following to the shell's profile. This is advised against: 

{{RootCmd|export CLASSPATH{{=}}"${CLASSPATH}:$(java-config --classpath log4j,xerces-2)"}}

== Java-плагины браузера ==

The Java browser plugin used to be managed via {{c|eselect java-nsplugin}}. This has now been removed in favor of a simpler out-of-the-box experience. For basic usage, simply emerge the chosen JVM with the <code>nsplugin</code> USE flag enabled. Note that Oracle's plugin is only available for {{Keyword|amd64}} and {{Keyword|x86}}.

Also note that Chromium-based browsers no longer support NPAPI-based plugins since the code was removed in September 2015. The list of supporting browsers is shrinking but still includes Firefox as of version 46.

For more information, including JVM selection, Web Start, and multilib, see [https://gitweb.gentoo.org/repo/gentoo.git/plain/dev-java/icedtea-web/files/README.gentoo-r1 the README installed with icedtea-web].

== USE-флаги для использования с Java ==

=== Настройка USE-флагов ===

For more information regarding [[USE flag]]s, refer to the USE flags chapter from the [[Handbook:X86/Working/USE|Gentoo Handbook]].

=== USE-флаги ===

* The [https://packages.gentoo.org/useflags/java <code>java</code>] flag adds support for Java in a variety of programs;
* The [https://packages.gentoo.org/useflags/nsplugin <code>nsplugin</code>] flag adds support for Mozilla-like browsers (including Firefox). This is needed for viewing Java applets in a Mozilla-like browser;
* The [https://packages.gentoo.org/useflags/jce <code>jce</code>] flag adds support for the Java Cryptography Engine;

Following USE flags go in [[Gentoo_Java_USE_flags|JAVA_PKG_IUSE]].
* The [https://packages.gentoo.org/useflags/source <code>source</code>] flag installs a zip of the source code of a package. This is traditionally used for IDEs to 'attach' source to the libraries that are being use;
* For Java packages, the [https://packages.gentoo.org/useflags/doc <code>doc</code>] flag will build API documentation using javadoc.

== Смотрите также ==

* [[Project:Java/User_Guide|Java руководство пользователя]] на Java project

== Ссылки ==

* The [http://news.gmane.org/gmane.linux.gentoo.java gentoo-java], [http://news.gmane.org/gmane.linux.gentoo.user gentoo-user], and [http://news.gmane.org/gmane.linux.gentoo.devel gentoo-dev] mailing list archives
* {{IRC|gentoo}} and {{IRC|gentoo-java}} on IRC
* [https://forums.gentoo.org/viewtopic-t-901036.html Java 7 and bootstrapping icedtea] on the Gentoo forums

More information can be found offline:

* {{c|man java-config}}
* {{c|java-config --help}}

For suggestions or questions regarding this document, please email the Gentoo Java team: {{Mail|java@gentoo.org}}

[[Category:Programming_language]]

{{Migrated|originalauthors=Joshua Nichols, Karl Trygve Kalleberg, Joshua Saddler}}
