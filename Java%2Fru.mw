<languages />
{{InfoBox stack
|{{InfoBox wikipedia|Java_(programming_language)|header=true}}
|{{InfoBox project|Java}}
}}
{{Metadata|abstract=Это руководство знакомит читателя с Java и объясняется, как использовать Java в Gentoo Linux.}}
Это руководство знакомит читателя с Java и объясняется, как использовать Java в Gentoo Linux.

== Что такое Java? ==

=== Общий обзор ===

Java — это язык программирования, разрабатываемый инженерами Sun Microsystems. Язык является объектно-ориентированным и предназначен для запуска на различных платформах без необходимости перекомпиляции кода для каждой платформы. Хотя программа на Java и может быть скомпилирована в нативный код, изрядную долю популярности языку принесла портируемость, а также некоторые другие возможности, такие как сборка мусора. Чтобы сделать независимость от платформы возможной, компилятор Java компилирует Java-код в промежуточное представление, называемое «байт-кодом Java» (Java bytecode), которое запускается в JRE (среде выполнения Java), а не непосредственно в операционной системе. 

Для запуска байт-кода Java, необходимо наличие установленной JRE (Java Runtime Environment). JRE предоставляет доступ к основным библиотекам, зависящей от платформы виртуальной машине Java, плагинам для браузеров и другим вещам. JDK (Java Development Kit) добавляет программные инструменты, такие как компилятор в байт-код и отладчик.

== Установка виртуальной машины ==

=== Выбор ===

Gentoo предоставляет различные (среды выполнения) Java Runtime Environments (JRE) и (пакеты средств для разработчиков) Java Development Kits (JDK). В числе текущих вариантов, имеются: 

{| class="table table-condensed table-striped" style="text-align: left;" 
|- 
! Производитель
! JDK
! JRE
|- 
| IcedTea Open Java SE (ранее icedtea6-bin)
| {{Package|dev-java/icedtea}} и {{Package|dev-java/icedtea-bin}}
| 
|- 
| Java от Oracle
| {{Package|dev-java/oracle-jdk-bin}}
| {{Package|dev-java/oracle-jre-bin}}
|-
| GCJ IcedTea GNU GCC Java (на данный момент IcedTea-7)
| {{Package|dev-java/icedtea}} {{Package|sys-devel/gcc}}  USE="gcj"
|}

=== Установка JRE/JDK ===

Для установки дефолтного '''JDK''' из профиля, запустите:

{{Emerge|virtual/jdk}}

Для установки дефолтного '''JRE''' из профиля, запустите

{{Emerge|virtual/jre}}

Некоторые JDK и JRE, включая пакеты от Oracle, требуют принятия лицензионного соглашения конечного пользователя (End User License Agreement), или EULA. Если лицензия (например, dlj-1.1) не указана в переменной <var>ACCEPT_LICENSE</var> (находящейся в файле {{Path|/etc/portage/make.conf}}), тогда JDK/JRE установить не удастся. Более подробно о том, как можно добавить допустимые лицензии в {{Path|make.conf}}, можно прочитать в главе [[Handbook:X86/Working/Portage/ru#Лицензии|Лицензии]] Portage Handbook. 

Чтобы избежать какой-либо суматохи с лицензионными ограничениями, рассмотрите установку icedtea-bin, который является открытой реализацией Java из проекта OpenJDK. 

{{Note|Имейте ввиду, что ''JDK'' также включает в себя ''JRE''; необязательно ставить JRE, если JDK уже был установлен.}}

=== Установка виртуальной машины IcedTea GCJ ===

Виртуальная машина Icedtea доступна в виде исходного кода и требует компиляции байт-кода компилятором Java. Эту начальную установку можно запустить с помощью GNU Compiler for Java (GCJ). Этот компилятор доступен, если GCC собран с USE-флагом <code>gcj</code>.

После того как GCC был пересобран с этим USE-флагом, можно приступить к установке пакета {{Package|dev-java/icedtea}}:

{{Emerge|dev-java/icedtea}}

=== Установка виртуальных машин с ограничениями на скачивание исходного кода ===

Настройка некоторых JDK и JRE требует некоторых дополнительных действий. Установите пакеты как обычно; если потребуются дополнительные действия, пакеты укажут, куда необходимо перейти и что необходимо загрузить.

Загрузите указанные файлы в каталог {{Path|/usr/portage/distfiles}}, повторно запустите {{c|emerge}}, после чего установка JRE/JDK будет продолжена.

=== Установка headless JRE === 

Бывают случаи, когда не требуется установка полноценной JRE со всеми возможностями java. При использовании java на сервере часто не требуются такие возможности, как графический интерфейс пользователя, графика, звук или печать. Чтобы установить упрощенную JRE, иногда называемую headless, необходимо изменить некоторые USE-флаги. 

{{FileBox|filename=/etc/portage/package.use|title=Необходимые изменения USE-флага|1=
virtual/jre headless-awt -alsa -cups
}}

В зависимости от используемого профиля Gentoo, эти флаги уже могут быть установлены. Как обычно, проверить, какие USE-флаги установлены для конкретного пакета можно, запустив {{c|emerge}} в режиме pretend:

{{Cmd|emerge --pretend --verbose virtual/jre}}

== Настройка виртуальной машины java ==

=== Общий обзор ===

На Gentoo, возможна установка множества разных JDK и JRE без вызова конфликтов. 

Установить общесистемную виртуальную машину java (VM), используемую по умолчанию, можно, запустив утилиту {{c|java-config}} с административными привилегиями. Пользователи также могут воспользоваться этой утилитой для установки пользовательской виртуальной машины. 

{{Note|Также, можно воспользоваться командой {{c|eselect}} для изменения системной и пользовательской виртуальной машины. Обратитесь к {{c|eselect java-vm help}}.}}

=== Установка виртуальной машины по умолчанию ===

Запуск команды {{c|java-config}} с опцией <code>--list-available-vms</code> выведет список всех JRE и JDK, установленных в системе. Ниже приведен пример работы команды: 

{{RootCmd|java-config --list-available-vms|output=<pre>
The following VMs are available for generation-2:
1&#41;      IcedTea JDK 7.2.6.3 [icedtea-7]
*&#41;      IcedTea JDK 3.0.1 [icedtea-8]
</pre>
}}

{{Note|Виртуальные машины, помеченные как 'Build Only', могут быть уязвимы с точки зрения безопасности и/или могут находиться в состоянии конца жизненного цикла (EOL). Gentoo не рекомендует использовать эти виртуальные машины в качестве системных ''или'' пользовательских. Подробнее читайте в разделе [[Java/ru#Виртуальные машины Build only|Виртуальные машины Build only]].}}

Символ ''*'' означает, что эта виртуальная машина является активной JVM (системной или пользовательской, если последняя установлена). Имя в квадратных скобках ([]) обозначает имя или идентификатор данной виртуальной машины. Установить виртуальную машину можно, передав ее имя или номер в качестве аргумента команде {{c|java-config --set-system-vm}}. Следующий пример показывает, как можно установить системную виртуальную машину.

Установка системной виртуальной машины с использованием имени (рекомендуемый способ):

{{RootCmd|java-config --set-system-vm icedtea-7|output=<pre>
Now using icedtea-7 as your generation-2 system JVM
</pre>}}

Альтернативный способ: выбор виртуальной машины с помощью номера:

{{RootCmd|java-config --set-system-vm 3|output=<pre>
Now using icedtea-7 as your generation-2 system JVM
</pre>
}}

В качестве обычного пользователя, запустите java-config <code>--set-user-vm</code>. 

{{Note|После изменения пользовательской или системной виртуальной машины (VM), обычно не требуется выполнение команды {{c|source /etc/profile}} в открытых сеансах оболочки. Единственное исключение: такие переменные, как <var>JAVA_HOME</var>, будут по-прежнему указывать на старое местоположение после установки пользовательской виртуальной машины в первый раз, или будут снова указывать на системную виртуальную машину.}}

=== Виртуальные машины Build only ===

Некоторые виртуальные машины отмечены как build-only, вследствие завершения жизненного цикла (EOL) и/или содержащихся уязвимостей. Эти виртуальные машины не будут автоматически использоваться Gentoo для запуска приложений с использованием Gentoo launcher (скрипт, созданный для переключения виртуальных машин в Java), но все еще будут доступны для использования средой сборки Gentoo, так как некоторые пакеты могут потребовать их для сборки. Настройка такой виртуальной машины в качестве системной или пользовательской машины строго не рекомендуется, так как в таком случае она будет использоваться при запуске {{Path|/usr/bin/{java,javac,...}}}, а также ее будут использовать пакеты, не использующие Gentoo launcher для запуска Java-приложений.

== Установка переменной CLASSPATH по умолчанию ==

{{Warning|Параметры, описанные в этом разделе, следует считать устаревшими. Скорее всего, они будут убраны в будущем. Настоятельно рекомендуется не использовать эти параметры, поскольку проекты и приложения Java, в идеале, должны управлять своими путями классов. Если указать переменную <var>CLASSPATH</var> по умолчанию, некоторые приложения могут повести себя непредсказуемо, по причине наличия в пути классов, которые они не ожидали там найти.}}

{{c|java-config}} также можно использовать для установки общесистемной и пользовательской переменной <var>CLASSPATH</var> по умолчанию. 

Прежде всего, выведите все доступные библиотеки Java, установленные в системе, которые можно поместить в переменную <var>CLASSPATH</var>. Вот пример вывода: 

{{RootCmd|java-config --list-available-packages|output=<pre>
[xerces-2] The next generation of high performance, fully compliant XML parsers in the Apache Xerces family (/usr/share/xerces-2/package.env)
[junit] Simple framework to write repeatable tests (/usr/share/junit/package.env)
[bsh] BeanShell: A small embeddable Java source interpreter (/usr/share/bsh/package.env)
[bcel] The Byte Code Engineering Library: analyze, create, manipulate Java class files (/usr/share/bcel/package.env)
[log4j] A low-overhead robust logging package for Java (/usr/share/log4j/package.env)
...
</pre>
}}

Опять-таки, имена в квадратных скобках являются идентификаторами для передачи команде {{c|java-config --set-system-classpath}}. Например: 


{{RootCmd|java-config --set-system-classpath log4j,xerces-2}}

{{Note|Текущий каталог ({{Path|.}}) не будет являться частью системного параметра classpath, так как это должно быть добавлено в профиль входа в систему.}}

Обновите среду, выйдя из системы и снова войдя в нее, либо с помощью команды {{c|source {{Path|/etc/profile}}}}. 

Для пользователей, java-config --set-user-classpath создаст {{Path|~/.gentoo/java-env-classpath}}, который затем должен быть использован в качестве источника (source) для профиля оболочки. 

{{CodeBox|title=Запуск команд пользовательского файла classpath|1=
if [[ -f "${HOME}/.gentoo/java-env-classpath" ]]; then
       source ${HOME}/.gentoo/java-env-classpath
fi
}}

Чтобы создать общесистемный или пользовательский classpath по умолчанию, добавьте строку, подобную следующей, в профиль оболочки. Это не рекомендуется: 

{{RootCmd|export CLASSPATH{{=}}"${CLASSPATH}:$(java-config --classpath log4j,xerces-2)"}}

== Java-плагины браузера ==

Управление Java-плагином браузера раньше осуществлялось посредством команды {{c|eselect java-nsplugin}}. Это было убрано в целях простоты. Для базового использования, установите выбранную JVM с USE-флагом <code>nsplugin</code>. Обратите внимание, что плагин от Oracle доступен только для архитектур {{Keyword|amd64}} и {{Keyword|x86}}.

Также обратите внимание, что браузеры, основанные на Chromium, больше не поддерживают плагины на базе NPAPI, поскольку код был убран в сентябре 2015 года. Список поддерживаемых браузеров уменьшается, но по-прежнему включает в себя Firefox, на момент версии 46.

Для получения более подробной информации, включая выбор JVM, Web Start и multilib, читайте [https://gitweb.gentoo.org/repo/gentoo.git/plain/dev-java/icedtea-web/files/README.gentoo-r1 файл README, устанавливаемый с icedtea-web].

== USE-флаги для использования с Java ==

=== Настройка USE-флагов ===

Чтобы найти больше информации по [[USE flag|USE-флагам]], обратитесь к главе [[Handbook:X86/Working/USE/ru|USE-флаги]] настольной книги Gentoo.

=== USE-флаги ===

* Флаг [https://packages.gentoo.org/useflags/java <code>java</code>] добавляет поддержку Java в различных программах;
* Флаг [https://packages.gentoo.org/useflags/nsplugin <code>nsplugin</code>] добавляет поддержку Mozilla-подобных браузеров (включая Firefox). Это необходимо для просмотра апплетов Java в Mozilla-подобных браузерах;
* Флаг [https://packages.gentoo.org/useflags/jce <code>jce</code>] добавляет поддержку Java Cryptography Engine;

Следующие USE-флаги входят в переменную [[Gentoo_Java_USE_flags|JAVA_PKG_IUSE]].
* Флаг [https://packages.gentoo.org/useflags/source <code>source</code>] устанавливает zip-файл с исходным кодом пакета. Это традиционно используется средами разработки для 'присоединения' исходного кода к используемым библиотекам;
* Для пакетов Java, флаг [https://packages.gentoo.org/useflags/doc <code>doc</code>] собирает документацию API с помощью javadoc.

== Смотрите также ==

* [[Project:Java/User_Guide|Java руководство пользователя]] на Java project

== Ссылки ==

* Архивы списков рассылки [http://news.gmane.org/gmane.linux.gentoo.java gentoo-java], [http://news.gmane.org/gmane.linux.gentoo.user gentoo-user] и [http://news.gmane.org/gmane.linux.gentoo.devel gentoo-dev]
* {{IRC|gentoo}} и {{IRC|gentoo-java}} на IRC
* [https://forums.gentoo.org/viewtopic-t-901036.html Java 7 and bootstrapping icedtea] на форумах Gentoo

Дальнейшая информация доступна оффлайн:

* {{c|man java-config}}
* {{c|java-config --help}}

Предложения и вопросы, касающиеся данной статьи, присылайте на email команды Gentoo Java: {{Mail|java@gentoo.org}}

[[Category:Programming_language]]

{{Migrated|originalauthors=Joshua Nichols, Karl Trygve Kalleberg, Joshua Saddler}}
