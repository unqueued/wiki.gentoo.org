This article has been created for ''experienced'' users who desire a quick, less detailed installation guide. It doubles as a checklist so essential installation steps are not forgotten.

{{Warning|This document is intended for '''experienced users only.''' It is '''not a replacement for the [[Handbook:Main Page|Gentoo Handbook]]''' and will '''not help you install Gentoo any faster.'''<br>
'''Do not expect''' to receive '''any kind of support''' when following this checklist. Installing according to the [[Handbook:Main Page|Handbook]] is fully supported however.}}

__TOC__

== Format drive ==

=== BIOS/MBR ===

Create three partitions. 128MB for {{Path|/boot}}, 1024MB for swap, and the rest for {{Path|/}}

{{RootCmd|cfdisk /dev/sda}}

Format the partitions:

{{RootCmd
|mkfs.ext4 /dev/sda1
|mkfs.ext4 /dev/sda3
|mkswap /dev/sda2 && swapon /dev/sda2
}}

=== BIOS/GPT ===

Create four partitions. 128MB for {{Path|/boot}}, 2MB for BIOS Boot, 1024MB swap and the rest goes to {{Path|/}}

{{RootCmd|gdisk /dev/sda|output=<pre>
Create GPT partition table:
Command: o ↵
This option deletes all partitions and creates a new protective MBR.
Proceed? (Y/N): y ↵

Create Partition 1 (/boot):
Command: n ↵
Partition Number: 1 ↵
First sector: ↵
Last sector: +128M ↵
Hex Code: ↵

Create Partition 2 (BIOS boot):
Command: n ↵
Partition Number: 2 ↵
First sector: ↵
Last sector: +2M ↵
Hex Code: EF02 ↵

Create Partition 3 (swap):
Command: n ↵
Partition Number: 3 ↵
First sector: ↵
Last sector: +1024MB ↵
Hex Code: 8200 ↵

Create Partition 4 (/):
Command: n ↵
Partition Number: 4 ↵
First sector: ↵
Last sector: ↵ (for rest of disk)
Hex Code: ↵

Write Partition Table To Disk:
Command: w ↵
Do you want to proceed? (Y/N): Y ↵
</pre>}}

Format the partitions:

{{RootCmd
|mkfs.ext4 /dev/sda1
|mkfs.ext4 /dev/sda4
|mkswap /dev/sda3 && swapon /dev/sda3
}}

=== UEFI/GPT ===

Create four partitions. 128MB for {{Path|/boot}}, 32MB for UEFI ESP, 1024MB swap and the rest goes to {{Path|/}}

{{RootCmd|gdisk /dev/sda|output=<pre>
Create GPT partition table:
Command: o ↵
This option deletes all partitions and creates a new protective MBR.
Proceed? (Y/N): y ↵

Create Partition 1 (/boot):
Command: n ↵
Partition Number: 1 ↵
First sector: ↵
Last sector: +128M ↵
Hex Code: ↵

Create Partition 2 (UEFI ESP):
Command: n ↵
Partition Number: 2 ↵
First sector: ↵
Last sector: +32M ↵
Hex Code: EF00 ↵

Create Partition 3 (swap):
Command: n ↵
Partition Number: 3 ↵
First sector: ↵
Last sector: +1024MB ↵
Hex Code: 8200 ↵

Create Partition 4 (/):
Command: n ↵
Partition Number: 4 ↵
First sector: ↵
Last sector: ↵ (for rest of disk)
Hex Code: ↵

Write Partition Table To Disk:
Command: w ↵
Do you want to proceed? (Y/N): Y ↵
</pre>}}

Format the partitions:

{{RootCmd
|mkfs.ext4 /dev/sda1
|mkfs.ext4 /dev/sda4
|mkswap /dev/sda3 && swapon /dev/sda3
|mkfs.vfat /dev/sda2
}}

== Mount partitions ==

=== BIOS/MBR ===

{{RootCmd
|mkdir -p /mnt/gentoo
|mount /dev/sda3 /mnt/gentoo
|mkdir /mnt/gentoo/boot
|mount /dev/sda1 /mnt/gentoo/boot
}}

=== BIOS/GPT ===

{{RootCmd
|mkdir -p /mnt/gentoo
|mount /dev/sda4 /mnt/gentoo
|mkdir /mnt/gentoo/boot
|mount /dev/sda1 /mnt/gentoo/boot
}}

=== UEFI/GPT ===

{{RootCmd
|mkdir -p /mnt/gentoo
|mount /dev/sda4 /mnt/gentoo
|mkdir /mnt/gentoo/boot
|mount /dev/sda1 /mnt/gentoo/boot
|mkdir /mnt/gentoo/boot/efi
|mount /dev/sda2 /mnt/gentoo/boot/efi
}}

== Stage3 ==

Find nearest mirror from [https://www.gentoo.org/downloads/mirrors/ this list].

Navigate to the {{Path|/mnt/gentoo}} directory:

{{RootCmd|cd /mnt/gentoo}}

Download the [[Stage tarball|stage3 tarball]]. Be sure to replace the keyword ({{Keyword|amd64}} in the example below) with the correct architecture:

{{RootCmd|wget http://distfiles.gentoo.org/releases/amd64/autobuilds/current-stage3-amd64/stage3-amd64-20140410.tar.bz2}}

Unpack the stage3 file:

{{RootCmd|tar xjpf stage3*}}

== Chroot ==

Chroot into the extracted stage3:

{{RootCmd
|cd /mnt/gentoo
|mount -t proc none proc
|mount --rbind /sys sys
|mount --make-rslave sys
|mount --rbind /dev dev
|mount --make-rslave dev
|cp /etc/resolv.conf etc
|chroot . /bin/bash
|source /etc/profile
}}

== Portage ==

Sync the Portage tree:

{{RootCmd
|mkdir /usr/portage
|emerge-webrsync
}}

== User accounts ==

Change the root password:

{{RootCmd|passwd}}

Create user(s):

{{RootCmd|useradd -g users -G wheel,portage,audio,video,usb,cdrom -m username
|passwd username}}

{{Note|There are no spaces allowed between the groups.}}

== Configure system ==

=== /etc/fstab ===

Configure {{Path|/etc/fstab}} to match the actual partitioning performed in the step above:

{{FileBox|filename=/etc/fstab|1=
/dev/sda1		/boot		ext4		noauto,noatime	1 2
/dev/sda3		/		ext4		noatime		0 1
/dev/sda2		none		swap		sw		0 0
/dev/cdrom		/mnt/cdrom	auto		noauto,ro	0 0
}}

=== /etc/portage/make.conf ===

Set preferred Portage options:

{{FileBox|filename=[[:/etc/portage/make.conf]]|title=A x86_64 make.conf example|1=
CFLAGS="-march=native -O2 -pipe"
CXXFLAGS="${CFLAGS}"
# Do NOT change CHOST setting
CHOST="x86_64-pc-linux-gnu"

# Choose desired USE flags
USE="alsa usb"

PORTDIR="/usr/portage"
DISTDIR="${PORTDIR}/distfiles"
PKGDIR="${PORTDIR}/packages"
}}

=== Locale ===

Set system [[Localization/Guide#Setting_a_locale|locale]]:

{{FileBox|filename=/etc/env.d/02locale|title=Example locale configuration|1=
LANG="en_US.UTF-8"
LC_COLLATE="C"
}}

=== Hostname ===

Edit {{Path|/etc/conf.d/hostname}}

=== Keymap ===

Edit {{Path|/etc/conf.d/keymaps}}

=== Clock ===

Edit {{Path|/etc/conf.d/hwclock}}

=== Timezone ===

Set the appropriate timezone:

{{RootCmd|ln -sf /usr/share/zoneinfo/Europe/Helsinki /etc/localtime}}

== Kernel ==

=== Emerge ===

The {{Package|sys-kernel/gentoo-sources}} package is the vanilla kernel with the Gentoo patchset applied. Choose between kernel sources. The {{Package|sys-kernel/linux-firmware}} package contains binary blobs needed for some hardware (wlan cards).

If {{Package|sys-kernel/gentoo-sources}} has been selected:

{{RootCmd
|emerge -av sys-kernel/gentoo-sources sys-kernel/linux-firmware
|cd /usr/src/linux
}}

=== Configure ===

==== Manual ====

Discover which modules are required for the system's hardware: 

{{RootCmd|lspci -nnk}}

Configure kernel by enabling each necessary module in the menuconfig interface. Search for specific module names by pressing {{Key|/}} in menuconfig. Navigate to the associated feature by pressing the corresponding number listed on the left of the search results.

{{RootCmd|make menuconfig}}

Once finished build kernel and modules:

{{RootCmd|make -j2}}

==== Automatic ====

If things are working nicely in the current install environment, it is possible to use <code>localyesconfig</code> to select all modules currently loaded by the LiveCD:

{{RootCmd|make localyesconfig}}

Build the kernel and modules:

{{RootCmd|make -j2}}

=== Install ===

Install the kernel and modules:

{{RootCmd
|make modules_install
|make install
}}

== Bootloader ==

Specify the correct setting for the system's firmware. BIOS/MBR is <code>pc</code>, 64-bit UEFI is <code>efi-64</code>, 32-bit UEFI is <code>efi-32</code>:

{{Note|32-bit UEFI is rare to find on PCs. Mostly older Apple hardware use this.  It has nothing to do with the Gentoo architecture chosen.}}

{{FileBox|filename=[[:/etc/portage/make.conf]]|title=PC BIOS settings for GRUB2|1=
GRUB_PLATFORMS="pc"
}}

{{FileBox|filename=[[:/etc/portage/make.conf]]|title=64-bit UEFI settings for GRUB2|1=
GRUB_PLATFORMS="efi-64"
}}

Emerge GRUB2:

{{Emerge|sys-boot/grub}}

Supposing the system has PC BIOS:

{{RootCmd|grub-install /dev/sda}}

Supposing the system has UEFI firmware and the EFI partition is mounted in the '''/boot''' directory:

{{RootCmd|grub-install --target{{=}}x86_64-efi --efi-directory{{=}}/boot --bootloader-id{{=}}grub --boot-directory{{=}}/boot /dev/sda}}

Edit GRUB2's configuration file:

{{RootCmd|nano /boot/grub/grub.cfg}}

Below is a simple [[GRUB2]] configuration file:

{{FileBox|filename=/boot/grub/grub.cfg|title=Example manual config|1=
set default=0
set timeout=1

menuentry "Gentoo" {
linux (hd0,1)/vmlinuz-3.14.4-gentoo root=/dev/sda3 rootfstype=ext4 net.ifnames=0 quiet ro
}
}}

Alternatively use the <tt>grub-mkconfig</tt> command to generate the configuration file::

{{RootCmd|grub-mkconfig -o /boot/grub/grub.cfg|output=<pre>
Found vmlinuz-3.14.4-gentoo
</pre>}}

== Network tools ==

Install tools needed for configuring the network interfaces:

{{Emerge|sys-apps/iproute2 net-misc/dhcpcd net-wireless/wireless-tools net-wireless/iw net-wireless/wpa_supplicant}}

== Clean up ==

Exit chroot, unmount partitions, and reboot:

{{RootCmd
|exit
|cd /mnt
|umount -R gentoo
|reboot
}}

== See also ==

* [[Handbook:Main_Page|Gentoo Handbook]]

[[Category:Core system]]
