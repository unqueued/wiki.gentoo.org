<languages />

{{InfoBox stack
|{{InfoBox wikipedia|header=true}}
}}

Это руководство описывает установку и использование cron.

== Основные понятия cron ==

=== Что делает cron? ===

Cron - это программа-демон, запускающая запланированные задания, основываясь на результате работы команды <code>crontab</code>. Она выполняет эти задания просыпаясь каждую минуту и проверяя, есть ли какие-нибудь задания cron (cron-jobs) для запуска в каком-либо из файлов заданий crontab пользователя. 

{{Note/ru|Заметьте что ''crontab'' - это как имя списка заданий cron, так и имя команды для редактирования этого списка.}}

=== Cron на практике ===

Существует несколько реализаций программы cron, доступных через Portage. Все они предлагают сходный интерфейс, а именно, использование команды <code>crontab</code> или ей подобных. Также есть родственная утилита, называемая Anacron, которая предназначена для работы с cron-ом на системах, которые не работают непрерывно. 

Также следует заметить, что не все доступные пакеты cron зависят от <code>sys-process/cronbase</code> . Этот пакет не зависит технически от какого-либо из пакетов cron, но он предлагает сходную с cron-ом функциональность, которую оценят многие из пользователей. 

Перед тем, как начать работу с cron-ом, Вам следует выбрать какую из его реализаций Вы хотите использовать. Для Вашего удобства, мы собрали информацию о каждой из них ниже. 

== Какая программа cron Вам подходит? ==

=== Vixie cron ===

Vixie cron - это полноценная реализация программы cron, основанная на SysV cron. Каждый пользователь имеет свой собственный файл заданий crontab, и ему разрешается указывать переменные среды внутри этого файла. В отличие от других видов cron, он также предлагает поддержку SELinux и PAM. Он поддерживает меньшее количество архитектур чем Dcron, но большее по сравнению с Fcron. 

Особенности <code>sys-process/vixie-cron</code> : 

* Поддержка SELinux
* Поддержка PAM {{Path|/etc/security/limits.conf}} 
* Установка переменных среды в файлах заданий crontabs (PATH, SHELL, HOME, etc.)
* Каждый пользователь может иметь свой собственный файл заданий crontab; доступ контролируется файлами {{Path|cron.allow}} и {{Path|cron.deny}} 

=== Dillon's Cron ===

Dcron стремится быть простой, элегантной и безопасной реализацие программы cron. Он не разрешает установку переменных среды в файлах crontabs и все задания cron запускаются из {{Path|/bin/sh}} . Как и Vixie cron, каждый пользователь имеет свой собственный файл заданий crontab. 

Особенности <code>sys-process/dcron</code> : 

* Быстрый, простой и свободный от излишних функций
* Доступ к файлу <code>crontab</code> ограничен группой cron, т.е. он не полагается на внешние средства

=== Fcron ===

Fcron ориентирован на то, чтобы заменить собой Vixie cron и Anacron. Он разработан для работы на системах, которые не работают непрерывно и включает в себя дополнительные особенности. Он имеет ограничения на запуск заданий, управление сериализацией работ, возможность назначить работам приятные в обращении значения и возможность запланировать запуск работ при загрузке системы. Просмотрите [http://fcron.free.fr/ главную страницу fcron], чтобы получить больше информации. 

Особенности <code>sys-process/fcron</code> : 

* Разработан для работы на системах, которые не работают непрерывно, т.е. он может запустить задание после перезапуска, если оно было пропущено
* Установка переменных среды и множества других параметров в файлах заданий crontab
* Каждый пользователь может иметь свой собственный файл заданий crontab, доступ к которому контролируется файлами cron.allow и cron.deny
* Улучшенный синтаксис crontab с поддержкой множества других особенностей

=== bcron ===

bcron - это новая система cron, разработанная с учетом безопасности ее работы. Чтобы добиться этого, система поделена на несколько отдельных программ, каждая из которых отвечает за отдельное задание, со строго контролируемым сообщением между ними. Пользовательский интерфейс представляет собой несущественное изменение интерфейсов для подобных систем (таких как vixie-cron), но внутренние части программы сильно отличаются. Чтобы получить больше информации, проконсультируйтесь с главной страницей bcron по адресу [http://www.gentoo.org/ http://untroubled.org/bcron/] . 

Особенности <code>sys-process/bcron</code> : 

* Легкая замена vixie-cron
* Ориентированность на множество процессов
* Нативная поддержка перехода на летнее время

=== Anacron ===

Anacron - это не программа-демон, это то, что работает в объединении с ней. Он выполняет команды по интервалам, указанным по дням, и не предполагат непрерывную работу системы; он запускает работы, которые были пропущены, пока система была отключена. Anacron обычно полагается на демон cron, чтобы запускаться каждый день. 

== Использование cron ==

=== Установка ===

Выберите реализацию cron, которая Вам больше нравится, и установите ее командой emerge. 

{{Emerge|dcron}}

{{RootCmd|/etc/init.d/dcron start
|rc-update add dcron default}}

Опционально, если Вы не устанавливали Fcron, Вы можете также пожелать установить Anacron. 

{{Emerge|anacron}}

{{RootCmd|/etc/init.d/anacron start
|rc-update add anacron default}}

=== Системный файл crontab ===

Постустановочные сообщения некоторых из этих пакетов cron могут сообщить чтобы Вы запустили <code>crontab /etc/crontab</code> . Файл {{Path|/etc/crontab}} - это ''системный crontab''. Установка cron может использовать его вместе с <code>sys-process/cronbase</code> для запуск сценариев в {{Path|/etc/cron.{daily,hourly,weekly,monthly}}} . Заметьте, что только Vixie-cron планирует задания в {{Path|/etc/crontab}} автоматически. Пользователям Dcron и Fcron потребуется запускать <code>crontab /etc/crontab</code> каждый раз при внесении изменений в {{Path|/etc/crontab}} . 

Пожалуйста, возьмите на заметку, что задания, запланированные в системном crontab могут не появиться в списке заданий cron отображаемом командой <code>crontab -l</code> . 

Конечно, Вы можете не использовать какой-либо системный файл crontab вовсе, по вашему выбору. Если Вы выбрали Dcron или Fcron, ''не'' запускайте <code>crontab /etc/crontab</code> . Если Вы выбрали vixie-cron или bcron, вы можете закомментировать строчки в {{Path|/etc/crontab}} . 

{{RootCmd|sed -i -e "s/^/#/" /etc/crontab}}

=== Предоставление доступа к cron проверенным пользователям ===

Если Вы хотите, чтобы обычные пользователи, а не только root, имели доступ к демону cron, Вам потребуется прочитать этот раздел. В противном случае, Вы можете перейти к следующему разделу, [[#scheduling]] . 

{{Note/ru|Предоставление другим пользователям доступа к crontab не позволяет им запускать задания cron в качестве администратора. Если Вы хотите, чтобы пользователь смог редактировать файл crontab учетной записи root, Вам следует рассмотреть использование <code>sudo</code> . Пожалуйста, прочтите наше [http://www.gentoo.org//doc/ru/sudo-guide.xml Руководство по использованию Sudo в Gentoo] для дальнейших подробностей.}}

Не имеет значения какой из пакетов cron Вы используете, если Вы хотите разрешить пользователю использование crontab, он сперва должен принадлежать к группе cron. В качестве примера, если Вы хотите добавить пользователя ''wepy'' в группу cron, Вы можете запустить: 

{{RootCmd|gpasswd -a wepy cron}}

{{Note/ru|При добавлении пользователя в группу cron, убедитесь что пользователь вышел и снова вошел в систему, чтобы изменения в группе возымели эффект.}}

Если Вы используете '''Dcron''', все, что Вам требуется сделаеть - это предоставить пользователю доступ к crontab. Пользователи Dcron могут перейти к следующему разделу [[#scheduling]] , в то время как другим надо продолжить чтение. 

Если Вы используете '''Fcron''', Вам надо отредактировать {{Path|/etc/fcron/fcron.deny}} и {{Path|/etc/fcron/fcron.allow}} . Наиболее безопасный способ - сперва запретить всех в файле {{Path|/etc/fcron/fcron.deny}} , а затем явно разрешить пользователей в {{Path|/etc/fcron/fcron.allow}} . 

{{Important/ru|Если ни файл {{Path|/etc/fcron/fcron.allow}} ни {{Path|/etc/fcron/fcron.deny}} не существуют, всем пользователям в группе cron будет разрешено использовать crontab. fcron поставляется с файлом {{Path|fcron.allow}} по умолчанию, который имеет параметр '''allows all users''' в доступе группы cron к fcrontab.}}

{{Code|Разрешения в fcron.deny|<pre>
all
</pre>
}}

Теперь, допустим у нас есть пользователь ''wepy'', которому необходимо управлять его собственными заданиями cron. Мы можем добавить его к {{Path|/etc/fcron/fcron.allow}}, как показано ниже: 

{{Code|Разрешения в fcron.allow|<pre>
wepy
</pre>
}}

Если Вы выбрали '''Vixie cron''' , Вам, возможно, нужно просто отредактировать {{Path|/etc/cron.allow}} . 

{{Important/ru|Важно заметить что если существует только файл {{Path|/etc/cron.allow}} , то только пользователи, принадлежащие группе cron, перечисленные в нем, будут иметь доступ. Иначе, если существует только пустой файл {{Path|/etc/cron.deny}} , то доступ всем пользователям, принадлежащим группе cron будет разрешен! Не оставляйте файл {{Path|/etc/cron.deny}} пустым, если Вы не имеете {{Path|/etc/cron.allow}} .}}

Например, если Вы хотите разрешить доступ пользователю ''wepy'', Вам нужно добавить его в {{Path|/etc/cron.allow}} как показано ниже: 

{{Code|Разрешения в /etc/cron.allow|<pre>
wepy
</pre>
}}

=== Планирование заданий cron ===

Процесс редактирования файлов crontab различен для каждого пакета, но все они поддерживают один и тот же простой набор команд: добавление и замещение файлов crontab, редактирование и удаление файлов crontab, и перечисление заданий cron в этих файлах. Следующий список показывает как можно запустить эти команды для каждого из пакетов. 

{| class="wikitable" style="text-align: left;" 
|- 
! Версия
! Редактировать crontab
! Удалить crontab
! Новый crontab
! Перечислить cron-jobs
|- 
| dcron
| <code>crontab -e</code>
| <code>crontab -d ''[user]'' </code>
| <code>crontab ''file'' </code>
| <code>crontab -l</code>
|- 
| fcron
| <code>fcrontab -e</code>
| <code>fcrontab -r ''[user]'' </code>
| <code>fcrontab ''file'' </code>
| <code>fcrontab -l</code>
|- 
| vixie-cron & bcron
| <code>crontab -e</code>
| <code>crontab -r ''-u [user]'' </code>
| <code>crontab ''file'' </code>
| <code>crontab -l</code>
|-
|}

{{Note/ru|Если не указано ни одного аргумента при использовании команды удаления, она удаляет файл crontab текущего пользователя.}}

{{Note/ru|Fcron также имеет символьную ссылку с <code>crontab</code> на <code>fcrontab</code>.}}

Хотя, перед тем как мы сможем использовать какие-либо из этих команд, Вам сперва нужно понять работу самого crontab. В каждой строке файла crontab нужно указать пять полей, связанных со времененм исполнения заданий в следующем порядке: минуты (0-59), часы (0-23), дни месяца (1-31), месяцы (1-12), и дни недели (0-7, Понедельник - 1, Воскресенье - 0 и 7). Дни недели и месяцы могут быть указаны трехбуквенными сокращениями, например mon,tue,jan,feb, и т.д. Каждое поле также может указывать диапазон значений (напр. 1-5 или mon-fri), список значений, разделенный запятыми (напр. 1,2,3 или mon,tue,wed) или диапазон значений с ''шагом'' (напр. 1-6/2 как 1,3,5). 

Звучит немного запутанно, но на нескольких примерах, Вы убедитесь, что это не так сложно, как кажется. 

{{Code/ru|Примеры|<pre>
## # Запускать /bin/false каждую минуту круглый год
*     *     *     *     *        /bin/false
  
## # Запускать /bin/false в 1:35 в mon,tue,wed (понедельник, вторник, среду) и 4-й день каждого месяца
35    1     4     *     mon-wed  /bin/false
  
## # Запускать /bin/true в 22:25 на 2-е Марта
25    22    2     3     *        /bin/true
  
## # Запускать /bin/false в 2:00 каждый Понедельник, Среду и Пятницу
0     2     *     *     1-5/2    /bin/false
</pre>
}}

{{Note/ru|Заметьте, что Вы указали определенные дни недели и дни месяца перед тем, как их сгруппировать. Если Вы укажете * только для одной категории, другие возьмут приоритет, в то время как * для обоих просто означает каждый день.}}

Чтобы протестировать то, что мы только что изучили, давайте разберем по шагам фактический ввод нескольких заданий cron. Для начала, создайте файл, названный {{Path|crons.cron}} и приведите его к следующему виду: 

{{RootCmd|nano crons.cron|output=<pre>
## #Минуты  Часы  Дни   Месяцы  Дни недели
10     3      1      1       *       /bin/echo "Мне действительно не нравится cron"
30     16     *      1,2     *       /bin/echo "Мне нравится cron немного"
*      *      *      1-12/2  *       /bin/echo "Мне нравится cron в самом деле"
</pre>
}}

Теперь мы можем добавить этот crontab к системе с помощью команды ''Новый crontab'' из таблицы выше. 

{{RootCmd|crontab crons.cron}}


{{Note/ru|На самом деле, Вы не увидите результата работы этих echo-команд, если только Вы не используете перенаправление.}}

Чтобы проверить запланированные задачи cron, мы используем соответственную команду ''Перечислить cron-jobs'' из таблицы выше. 

{{RootCmd|crontab -l}}

Вы должны увидеть список, напоминающий {{Path|crons.cron}} . Если этого не произошло, возможно, Вы использовали неверную команду для ввода нового файла crontab. 

Этот файл заданий crontab должен выводить "Мне нравится cron в самом деле" каждую минуту каждый час каждого дня каждого второго месяца. Очевидно, Вам следует это делать только если Вы любите cron в самом деле. Этот crontab также выведет "Мне нравится cron немного" в 16:30 каждый день в Январе и Феврале. Он также будет выводить "Мне действительно не нравится cron" в 3:10 1-го Января. 

Если Вы используете Anacron, Вам следует продолжить чтение этого раздела. Иначе, перейдите к следующей главе [[#editing]] . 

Пользователи Anacron, возможно, захотят отредактировать {{Path|/etc/anacrontab}} . Этот файл имеет четыре поля: количество дней перед каждым запуском, задержка в минутах после которой он запускает задания, имя задания, и команда для запуска. 

Например, чтобы заставить его запускать команду <code>echo "Мне нравится anacron"</code> каждые 5 дней и 10 минут после того как запущен Anacron, Вам следует ввести следующее: 

{{Code/ru|/etc/anacrontab|<pre>
5 10 wasting-time /bin/echo "Мне нравится anacron"
</pre>
}}

Anacron завершается после того, как сделаны все задания, перечисленные в файле anacrontab. Поэтому, если мы хотим, чтобы он проверял эти задания каждый день, нам потребуется использовать cron. Инструкции в конце следующего раздела покажут как это сделать. 

=== Редактирование crontabs ===

Все же, давайте будем реалистами; Вы не хотите, чтобы система сообщала Вам как сильно Вы любите cron каждую минуту. Как шаг вперед, давайте удалим этот crontab, используя соответствующую команду ''Удалить crontab'' из таблицы выше. Мы также перечислим задания cron после этого, чтобы убедиться что оно работает. 

{{RootCmd|crontab -d
|crontab -l}}

Вы должны увидеть ''no cron jobs'' в качестве результата работы команды <code>crontab -l</code> . Если Вы видите перечисленные задания, это значит, что мы не смогли удалить crontab, и что Вам придется удостовериться, что Вы использовали правильную команду ''Удалить'' из своего пакета cron. 

Теперь, когда мы можем начать с чистого листа, давайте поместим что-нибудь полезное в файл crontab принадлежащий '''root'''. Большинство пожелает запускать команду <code>updatedb</code> еженедельно, чтобы убедиться, что <code>mlocate</code> работает как надо. Чтобы добавить это в crontab, давайте сначала отредактируем файл {{Path|crons.cron}} заново, чтобы он принял следующий вид: 

{{Code|Настоящий crontab|<pre>
22 2 * * 1    /usr/bin/updatedb
</pre>
}}

Это заставит cron запускать updatedb в 2:22 A.M. утром в понедельник каждую неделю. Теперь, вы должны ввести этот crontab с помощью команды ''Новый crontab'' из таблицы выше, и проверить список снова. 

{{RootCmd|crontab crons.cron
|crontab -l}}

Now let's say that you also want to add <code>emerge --sync</code> to your daily schedule. You could do this by first editing {{Path|crons.cron}} and then using <code>crontab crons.cron</code> just as we did before, or you could use the proper ''edit command'' from the table above. This gives you a way to edit your user's crontab in situ, without depending on external files like {{Path|crons.cron}} . 

{{RootCmd|crontab -e}}

Это должно открыть Ваш пользовательский crontab с помощью редактора. Мы хотим, чтобы команда <code>emerge --sync</code> работала каждый день в 6:30 A.M., поэтому мы придадим ей следующий вид: 

{{Code|A real crontab|<pre>
22 2 * * 1    /usr/bin/updatedb
30 6 * * *    /usr/bin/emerge --sync
## (if you're using anacron, add this line)
30 7 * * *    /usr/sbin/anacron -s
</pre>
}}

Again, check the cron-jobs list as we did in the previous examples to make sure the jobs are scheduled. If they are all there, then you're all set. 

== Using cronbase ==

As mentioned earlier, all of the available cron packages depend on <code>sys-process/cronbase</code> . The cronbase package creates {{Path|/etc/cron.{hourly,daily,weekly,monthly}}} , and a script called <code>run-crons</code> . You might have noticed that the default {{Path|/etc/crontab}} contains something like this: 

{{Code|Default system crontab|<pre>
*/15 * * * *     test -x /usr/sbin/run-crons && /usr/sbin/run-crons
0  *  * * *      rm -f /var/spool/cron/lastrun/cron.hourly
0  3  * * *      rm -f /var/spool/cron/lastrun/cron.daily
15 4  * * 6      rm -f /var/spool/cron/lastrun/cron.weekly
30 5  1 * *      rm -f /var/spool/cron/lastrun/cron.monthly
</pre>
}}

To avoid going into much detail, we can just assume that these commands will effectively run your hourly, daily, weekly and monthly scripts. This method of scheduling cron-jobs has some important advantages: 

* They will run even if your computer was off when they were scheduled to run
* It is easy for package maintainers to place scripts in those well defined places
* You know exactly where your cron-jobs and your crontab are stored, making it easy for you to backup and restore this part of your system

{{Note|Again, it is useful to point out that Vixie cron and bcron automatically read {{Path|/etc/crontab}} , while dcron and fcron do not. Please read the [[#systemtab]] section to learn more about this.}}

== Final Notes ==

Remember, each cron package is different and the range of features varies greatly. Be sure to consult the man pages for crontab, fcrontab or anacrontab, depending on what you use. 

Good luck! 

=== Troubleshooting ===

If you're having problems getting cron to work properly, you might want to go through this quick checklist. 

==== Is cron running? ====

Run <code>ps ax | grep cron</code> and make sure it shows up!

==== Is cron working? ====

Try the following:

{{Code|crontab to see if cron is running|<pre>
* * * * * /bin/echo "foobar" >> /file_you_own
</pre>}}

Then check if {{Path|/file_you_own}} is modified periodically.

==== Is your command working? ====

Same as before, but perhaps redirect the standard error output as well:

{{Code|crontab to verify application runs|<pre>
* * * * * /bin/echo "foobar" >> /file_you_own 2>&amp;1
</pre>}}

==== Can cron run your job? ====

Check the cron log, usually {{Path|/var/log/cron.log}} or {{Path|/var/log/messages}} for errors

==== Are there any {{Path|dead.letter}}s? ====

cron usually sends mail when there's a problem; check your mail and also look for {{Path|~/dead.letter}} .

== Acknowledgements ==

We would like to thank the following authors and editors for their contributions to this guide:


* Eric Brown
* Xavier Neys
* nightmorph

[[Category:Core system]]
[[Category:Daemons]]
