{{InfoBox stack
|{{InfoBox wikipedia|Media Transfer Protocol|header=true}}
}}

'''MTP''' ('''M'''edia '''T'''ransfer '''P'''rotocol) is a protocol to allow the transfer of files to external devices. It is provided by several programs, most of them depending on [[FUSE]]. 

__TOC__


== MTPfs ==

=== Installation ===

==== Kernel ====

Prepare for MTP implementations by activating <var>CONFIG_FUSE_FS</var> in the [[Kernel/Configuration|kernel]]:

{{KernelBox|title=Enable FUSE for MTP implementations|1=<pre>
File systems  ---> 
   <*> FUSE (Filesystem in Userspace) support
</pre>}}

==== USE flags ====

{{USEflag|package=sys-fs/mtpfs}}

{{Package|sys-fs/mtpfs}} depends on {{Package|media-libs/libmtp}}. It turned out<ref>http://forums.gentoo.org/viewtopic-p-7633366.html#7633366</ref> that at least version 1.1.8<ref>{{Bug|527086}}</ref> is needed to make it work.<ref>libmtp will scan the usb bus and send messages to the log for all attached usb devices<pre>
Dec 29 11:58:42 localhost kernel: usb 1-1.2: new full-speed USB device number 8 using ehci-pci
Dec 29 11:58:42 localhost mtp-probe: checking bus 1, device 8: "/sys/devices/pci0000:00/0000:00:1d.7/usb1/1-1/1-1.2"
Dec 29 11:58:42 localhost mtp-probe: bus: 1, device: 8 was not an MTP device
Dec 29 11:59:51 localhost kernel: usb 1-5.1: new low-speed USB device number 10 using ehci-pci
Dec 29 11:59:51 localhost kernel: input: Logitech Trackball as /devices/pci0000:00/0000:00:1d.7/usb1/1-5/1-5.1/1-5.1:1.0/0003:046D:C404.0007/input/input25
Dec 29 11:59:51 localhost kernel: hid-generic 0003:046D:C404.0007: input: USB HID v1.10 Mouse [Logitech Trackball] on usb-0000:00:1d.7-5.1/input0
Dec 29 11:59:51 localhost mtp-probe: checking bus 1, device 10: "/sys/devices/pci0000:00/0000:00:1d.7/usb1/1-5/1-5.1"
Dec 29 11:59:51 localhost mtp-probe: bus: 1, device: 10 was not an MTP device
Dec 29 11:59:51 localhost kernel: input: Logitech Logitech Illuminated Keyboard as /devices/pci0000:00/0000:00:1d.7/usb1/1-5/1-5.4/1-5.4:1.0/0003:046D:C318.0008/input/input26
Dec 29 11:59:51 localhost kernel: hid-generic 0003:046D:C318.0008: input: USB HID v1.11 Keyboard [Logitech Logitech Illuminated Keyboard] on usb-0000:00:1d.7-5.4/input0
Dec 29 11:59:51 localhost kernel: input: Logitech Logitech Illuminated Keyboard as /devices/pci0000:00/0000:00:1d.7/usb1/1-5/1-5.4/1-5.4:1.1/0003:046D:C318.0009/input/input27
Dec 29 11:59:51 localhost kernel: hid-generic 0003:046D:C318.0009: input: USB HID v1.11 Device [Logitech Logitech Illuminated Keyboard] on usb-0000:00:1d.7-5.4/input1
Dec 29 11:59:51 localhost mtp-probe: checking bus 1, device 11: "/sys/devices/pci0000:00/0000:00:1d.7/usb1/1-5/1-5.4"
Dec 29 11:59:51 localhost mtp-probe: bus: 1, device: 11 was not an MTP device</pre></ref>.

==== Emerge ====

Install {{Package|sys-fs/mtpfs}}:

{{Emerge|sys-fs/mtpfs}}

=== Configuration ===

Appropriate user need to be in the <code>plugdev</code> group:

{{RootCmd|gpasswd -a <USER_NAME> plugdev}}

Modify {{Path|/etc/fuse.conf}}:

{{FileBox|filename=/etc/fuse.conf|1=
user_allow_other}}

=== Usage ===

[[Mount]]:

{{Cmd|mkdir ~/AndroidDevice}}

{{Cmd|mtpfs ~/AndroidDevice|output=<pre>
Unable to open ~/.mtpz-data for reading, MTPZ disabled.
Device 0 (VID=0bb4 and PID=0c93) is a HTC EVO 4G LTE/One V (ID1).
Android device detected, assigning default bug flags
</pre>}}

{{Note|Be patient, as this can take several minutes. Upon successful mount, mtpfs will background itself.}}

Unmount:

{{Cmd|fusermount -u ~/AndroidDevice}}

== Go-mtpfs ==

{{Note|Newer Galaxy Devices (S3, S4, Note2, etc.) use their own MTP-stack and don't work reliably, although this should be fixed in newer versions. See [https://github.com/hanwen/go-mtpfs/issues/29 Bug#29]}}

=== Installation ===

We need to unmask 2 packages in {{Path|/etc/portage/package.keywords}}:

{{FileBox|filename=/etc/portage/package.keywords|1=
dev-libs/go-fuse **
sys-fs/go-mtpfs **
}}

==== Emerge ====

Install {{Package|sys-fs/go-mtpfs}}:

{{Emerge|sys-fs/go-mtpfs}}

=== Configuration ===

Appropriate users need to be in the <code>plugdev</code> group:

{{RootCmd|gpasswd -a <USER_NAME> plugdev}}

=== Usage ===

[[Mount]]:

{{Cmd
|mkdir ~/AndroidDevice
|go-mtpfs ~/AndroidDevice &
}}

Note: If you don't run go-mtpfs in the background (with <code>&</code> at the end), you will need another console to browse the device and to unmount it.

Unmount:

{{Cmd|fusermount -u ~/AndroidDevice}}

When you unmount the device, go-mtpfs will quit.

== gphotofs ==

gphotofs is a FUSE file system for interfacing with digital cameras using gphoto2. Most modern mobile phones are cameras at the same time, and gphotofs can be a good alternative to mtpfs or go-mtpfs.

=== Installation ===

==== Emerge ====

Install {{Package|media-gfx/gphotofs}}:

{{Emerge|media-gfx/gphotofs}}

=== Usage ===

[[Mount]]:

{{Cmd
|mkdir ~/AndroidDevice
|gphotofs ~/AndroidDevice -o allow_other
}}

Unmount:

: {{Cmd|fusermount -u ~/AndroidDevice}}

== simple-mtpfs ==

Another FUSE file system implementation for use with MTP devices is simple-mtpfs.

=== Installation ===

==== Emerge ====

Install {{Package|sys-fs/simple-mtpfs}}:

{{Emerge|sys-fs/simple-mtpfs}}

=== Usage ===

[[Mount]]:

{{Cmd
|mkdir ~/AndroidDevice
|simple-mtpfs ~/AndroidDevice
}}

Unmount:

{{Cmd|fusermount -u ~/AndroidDevice}}

== Gnome ==

Install {{Package|gnome-base/gvfs}} with the <code>mtp</code> USE flag enabled.

{{FileBox|filename=/etc/portage/package.use|1=
gnome-base/gvfs mtp
}}

== KDE ==

=== KDE SC 4 ===

'''kio-mtp''' is a slave for [[KDE]]'s KIO framework. It is still unstable, but it is in the main repository.

First, install:

{{Emerge|kde-misc/kio-mtp}}

Quit KDE, and relaunch it. Now your MTP devices appear e.g. in Dolphin.

=== KDE 5 ===

'''kio-extras''' contains MTP support, but it requires the <code>mtp</code> USE flag.

Enable the global <code>mtp</code> use flag:

{{FileBox|filename=/etc/portage/make.conf|1=
USE="$USE mtp"
}}

Alternatively, enable it in kio-extras:

{{FileBox|filename=/etc/portage/package.use|1=
kde-apps/kio-extras mtp
}}

Then emerge:

{{Emerge|kde-misc/kio-mtp}}

After this, quitting KDE and restarting is probably sufficient to get it working.
If that does not work, please try restarting you system.

== gMTP ==

'''gMTP''' is a simple MTP client for Solaris and Linux.

It is sufficient to just install and run {{Package|media-sound/gmtp}}:

{{Emerge|media-sound/gmtp}}

{{Cmd|gmtp}}

Click on connect. A few second later, you will get the file hierarchy of your device. You can start to manipulate the files. It support features like Album Artwork and play lists.

== Thunar ==

To have thunar automount MTP and other volumes, install {{Package|xfce-extra/thunar-volman}}

== Troubleshooting ==

* If your device is not recognized by libmtp, try upgrading to latest (or even live) version - e.g. 1.1.8.
* Some ROMs(e.g. PAC rom) require to unlock the screen of your device. If you don't - you'll see the device as empty.
* Sometimes (e.g. on HTC One X) USB debugging automatically turns on when device is connected to PC. You need to turn debugging off, otherwise libmtp can't recognize device.
* Make sure your Android device is not going to sleep and the screen is not getting locked. Set screen timeout to very long values, or enable in Development section flag "Do not turn off the screen".
* Lumia devices might require {{Package|media-libs/libmtp}} version 1.1.9 and {{Package|sys-fs/simple-mtpfs}} to be mounted properly.
* Lumia devices must be unlocked to be able to connect (enter your PIN).

== References ==

{{reflist}}

[[Category:Software]]
[[Category:Meta]]
