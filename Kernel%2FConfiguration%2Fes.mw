<languages />

{{Metadata|abstract=Este artículo describe la configuración manual y la puesta en marcha del núcleo Linux. Para el método automático consulte el artículo de genkernel.}}

Este artículo describe la configuración manual y la puesta en marcha del [[Kernel/es|núcleo Linux]]. Para el método automático consulte el artículo de [[genkernel/es|genkernel]].

== Ajustar el enlace simbólico ==

El enlace simbólico {{Path|/usr/src/linux}} debe apuntar siempre a los fuentes del núcleo que se está utilizando actualmente. Esto se puede hacer de tres formas:

1. Instalar los fuentes del núcleo con el [[USE flag|ajuste USE]] <code>symlink</code> activo. Esto hará que  {{Path|/usr/src/linux}} apunte a los nuevos fuentes del núcleo instalado. En caso necesario se puede modificar más tarde mediante los siguientes dos métodos:

; 2. Ajustar el enlace simbólico con la herramienta <tt>eselect</tt>:

{{RootCmd|eselect kernel list|output=<pre>
Available kernel symlink targets:
[1] linux-3.3.8-gentoo
[2] linux-3.4.9-gentoo
</pre>}}

Esto muestra los fuentes del núcleo disponibles. El asterisco indica los fuentes seleccionados. Para cambiar estos fuentes, por ejemplo, a la segunda entrada, haga lo siguiente:

{{RootCmd|eselect kernel set 2}}

3. Ajustar el enlace simbólico manualmente:

{{RootCmd|ln -sf /usr/src/linux-3.4.9-gentoo /usr/src/linux |
|ls -l /usr/src/linux |
|output=lrwxrwxrwx 1 root root 11 Aug 29 22:10 /usr/src/linux -> /usr/src/linux-3.4.9-gentoo
}}

<!-- The output is the same as the target file in the ln command. -->

== Herramientas de configuración ==

El núcleo ofrece varias herramientas para configurarlo.

{| class="table"
|-
! Command
! Description
|-
| <tt>make config</tt>
| Text based configuration. The options are prompted one after another. All options need to be answered, and out-of-order access to former options is not possible.
|-
| <tt>make menuconfig</tt>
| An ncurses-based graphical menu (only text input). Navigate through the menu to modify the desired options.
|-
| <tt>make defconfig</tt>
| Generates a new config with default from the ARCH supplied defconfig file. Use this option to get back the default configuration file that came with the sources.
|-
| <tt>make nconfig</tt>
| Graphical menu based on ncurses. Requires {{Package|sys-libs/ncurses}} to be installed.
|-
| <tt>make xconfig</tt>
| Graphical menu using Qt4. Requires {{Package|dev-qt/qtgui}} to be installed.
|-
| <tt>make gconfig</tt>
| Graphical menu using GTK+. Requires {{Package|x11-libs/gtk+}}, {{Package|dev-libs/glib}}, and {{Package|gnome-base/libglade}} to be installed.
|-
| <tt>make oldconfig</tt>
| Review changes between kernel versions and update to create a new {{Path|.config}} for the kernel.
|-
| <tt>make allyesconfig</tt>
| Enables all configuration options in the kernel. target will set ''all'' kernel options to <code>*</code>. Make sure a backup of the current kernel configuration is acquired before experimentally using it!
|}

También existen varios guiones para crear configuraciones por defecto de distintos tipos. Esto puede hacer que las configuración más complejas se realicen en menos tiempo. Lance la siguiente orden para mostrar una lista completa de las opciones de make:

{{RootCmd|make help}}

== Configuración ==

Este artículo describe la configuración mediante la herramienta <tt>make menuconfig</tt>, sin embargo, el procedimiento es similar para los otros menús.

{{RootCmd|cd /usr/src/linux
|make menuconfig}}

=== Utilización ===

In the shown menu the blue bar indicates the position of the cursor. With the {{Key|↑}} and {{Key|↓}} arrow keys change the position of the cursor. The {{Key|←}} and {{Key|→}}  arrow keys traverse the menu bar in the bottom and define what happens when the {{Key|Enter}} key is pressed. For the menu bar below, '''Select''' switches to a sub menu for the menu entries ending with <tt>---></tt> while '''Exit''' exits a sub menu. As an alternative the {{Key|Esc}} key can be pressed twice to exit the application.

Pressing an associated letter key {{Key|A}}-{{Key|Z}} will move the position of the cursor lines that have characters in bold. The {{Key|Y}}, {{Key|M}}, {{Key|N}} keys are excluded from navigation in this way; they are sanctified for other purposes. If a line begins with a Y, M, or N, the next character will be bold and capable of being jumped to. For example, relative to the cursor's current position, if the next line reads "N'''e'''twork Device Support --->" pressing the {{Key|E}} key will move the cursor to that line.

Menu entries, which start with brackets, are drivers or features that can be activated:
{
{| class="table"
|-
! Symbol(s)
! Description
|-
| <code>[ ], [*]</code>
| Options in square brackets can be activated or deactivated. The asterisk marks the menu entry as activated. The value can be changed with the {{Key|space}} key. It is also possible to press {{Key|Y}} key ('''Y'''es) to activate or {{Key|N}} key ('''N'''o) to deactivate the selected entry.
<br/>
If the option is activated, the selected feature/driver will be built into the kernel and will always be available at boot time.
|-
| <code>< >, <M>, <*></code>
| Options in angle brackets can be activated or deactivated, but also activated as module (indicated by a ''M''). The values can be modified by pressing {{Key|Y}}/{{Key|N}} keys as before or by pressing the {{Key|M}} key to activate the feature/driver as a module.
<br/>
See the [[Kernel Modules]] article for differentiation.
|-
| <code>{M}, {*}</code>
| Options in curly brackets can be activated or activated as module but not be deactivated. This happens because another driver is dependent on this feature.
|-
| <code>-M-, -*-</code>
| Options between hyphens are activated in the shown way by another driver. There is no choice.
|}

Más aún, algunas entradas de menú tienen una etiqueta al final:

{| class="table"
|-
! Tag
! Description
|-
| <code>(NEW)</code>
| This driver is new in the kernel and is maybe not stable enough.
|-
| <code>(EXPERIMENTAL)</code>
| This driver is experimental and most likely not stable enough.
|-
| <code>(DEPRECATED)</code>
| This driver is deprecated and not needed for most systems.
|-
| <code>(OBSOLETE)</code>
| This driver is obsolete and should not be activated.
|}

La mayoría de las opciones tienen una descripción que se puede ver pulsando la tecla {{Key|H}} o eligiendo '''Help''' en la barra de menú.

=== Selección de controladores ===

Eche un vistazo al artículo sobre [[hardware detection|detección del hardware]] y a los artículos en la categoría [[:Category:Hardware|Hardware]].

=== Buscar módulos ===

Dentro de <tt>menuconfig</tt> utilice la tecla {{Key|/}} para buscar módulos por su nombre.

Tal y como se muestra abajo, el resultado de la búsqueda mostrará números delante de los resultados. Si se pulsa {{Key|1}} en el ejemplo de abajo <tt>menuconfig</tt> saltará hasta la opción ''Bluetooth device drivers'' en la estructura del menú.

{{KernelBox|title=Salida ejemplo después de buscar  HCIBTUSB|1=
Symbol: BT_HCIBTUSB [{{=}}m]                       
Type  : tristate                               
Prompt: HCI USB driver                         
  Location:                                    
    -> Networking support (NET [{{=}}y])           
      -> Bluetooth subsystem support (BT [{{=}}y]) 
(1)     -> Bluetooth device drivers            
  Defined at drivers/bluetooth/Kconfig:5       
  Depends on: NET [{{=}}y] && BT [{{=}}y] && USB [{{=}}m]
}}

=== Habilitar los ajustes comunes de Gentoo Linux ===

Existe una opción de configuración del núcleo llamada <code>CONFIG_GENTOO_LINUX</code> que se encuentra disponible únicamente en  {{Package|sys-kernel/gentoo-sources}} y otros núcleos mantenidos por [[Project:Kernel|el proyecto del núcleo]]. Por sí misma no hace nada, sin embargo define algunas opciones de configuración que necesitan las instalaciones típicas.

This setting automatically selects <code>tmpfs</code> and <code>devtmpfs</code> support, which are needed for handling {{Path|/dev}} on Gentoo Linux, but might be expanded in the future to enable other mandatory settings for a Gentoo Linux system. For more information, read the help information available through the kernel configuration system as described earlier in this guide.

== Construcción ==

Después de haber realizado correctamente la configuración, compile el núcleo:

{{RootCmd|make}}

For processors with multiple cores, make all the cores do the work: add the option <tt>-j(NUMBER_CORES +1)</tt>. For example, a dual core processor contains two cores plus one (2+1):

{{RootCmd|make -j3}}

== Configuración ==

If drivers are activated as modules, they must be installed:

{{RootCmd|make modules_install}}

Los módulos se copiarán a un directorio de {{Path|/lib/modules}}.

Para instalar el núcleo:

{{RootCmd|make install}}

This command executes {{Path|/sbin/installkernel}}, which is part of the {{Package|sys-apps/debianutils}} package. ''The new kernel is installed into {{Path|/boot/vmlinuz-{version}}}. If a symbolic link {{Path|/boot/vmlinuz}} already exists, it is refreshed by making a link from {{Path|/boot/vmlinuz}} to the new kernel, and the previously installed kernel is available as {{Path|/boot/vmlinuz.old}}.'' (''installkernel'' [[man page]]). The same for {{Path|config}} and {{Path|System.map}} files. These symlinks are handy, because they always point to the newest kernel without changing the file path (e.g. they can be used in the bootloader configuration).

== Cargador de arranque ==

Cambie la configuración del [[bootloader|cargador de arranque]] del sistema para que inicie el nuevo núcleo.

Por último reinicie el sistema para que utilice el núcleo nuevo.

== Comparing current kernel configuration with default configuration ==

Use the following procedure to get an overview over the kernel configurations that deviate from the default. Keep in mind that the modification of configuration setting may entail additional configuration settings.

{{RootCmd
|cd /usr/src/linux
|cp .config ../.config.working
|make defconfig
|mv .config ../.config.default
|cp ../.config.working .config
|cd ..
|diff .config.working .config.default {{!}} sed --quiet '/^\([<{{!}}>] CONFIG\)/ p' > .config.diff
}}

The search function in <tt>make menuconfig</tt> can be used to look up the flags and their interpretation.
When you're done, clean up:

{{RootCmd
|cd /usr/src/
|rm .config.working .config.default .config.diff
}}

== Veáse también ==
* [[Genkernel/es]]
* [[Kernel/Configuration/Kernel_Seeds|Kernel Seeds]]

== Recursos externos ==

[[Category:Kernel]]
