<languages />

{{Metadata|abstract=Este artículo describe la configuración manual y la puesta en marcha del núcleo Linux. Para el método automático consulte el artículo de genkernel.}}

Este artículo describe la configuración manual y la puesta en marcha del [[Kernel/es|núcleo Linux]]. Para el método automático consulte el artículo de [[genkernel/es|genkernel]].

== Ajustar el enlace simbólico ==

El enlace simbólico {{Path|/usr/src/linux}} debe apuntar siempre a los fuentes del núcleo que se está utilizando actualmente. Esto se puede hacer de tres formas:

1. Instalar los fuentes del núcleo con el [[USE flag|ajuste USE]] <code>symlink</code> activo. Esto hará que  {{Path|/usr/src/linux}} apunte a los nuevos fuentes del núcleo instalado. En caso necesario se puede modificar más tarde mediante los siguientes dos métodos:

2. Ajustar el enlace simbólico con la herramienta {{c|eselect}}:

{{RootCmd|eselect kernel list|output=<pre>
Available kernel symlink targets:
[1] linux-3.3.8-gentoo
[2] linux-3.4.9-gentoo
</pre>}}

Esto muestra los fuentes del núcleo disponibles. El asterisco indica los fuentes seleccionados. Para cambiar estos fuentes, por ejemplo, a la segunda entrada, haga lo siguiente:

{{RootCmd|eselect kernel set 2}}

3. Ajustar el enlace simbólico manualmente:

{{RootCmd|ln -sf /usr/src/linux-3.4.9-gentoo /usr/src/linux |
|ls -l /usr/src/linux |
|output=lrwxrwxrwx 1 root root 11 Aug 29 22:10 /usr/src/linux -> /usr/src/linux-3.4.9-gentoo
}}

<!-- La salida es la misma que el fichero destino en la orden ln. -->

== Herramientas de configuración ==

El núcleo ofrece varias herramientas para configurarlo.

{| class="table"
|-
! Command
! Description
|-
| {{c|make config}}
| Text based configuration. The options are prompted one after another. All options need to be answered, and out-of-order access to former options is not possible.
|-
| {{c|make menuconfig}}
| An ncurses-based pseudo-graphical menu (only text input). Navigate through the menu to modify the desired options.
|-
| {{c|make defconfig}}
| Generates a new config with default from the ARCH supplied defconfig file. Use this option to get back the default configuration file that came with the sources.
|-
| {{c|make nconfig}}
| Pseudo-graphical menu based on ncurses. Requires {{Package|sys-libs/ncurses}} to be installed.
|-
| {{c|make xconfig}}
| Graphical menu using Qt4. Requires {{Package|dev-qt/qtgui}} to be installed.
|-
| {{c|make gconfig}}
| Graphical menu using GTK+. Requires {{Package|x11-libs/gtk+}}, {{Package|dev-libs/glib}}, and {{Package|gnome-base/libglade}} to be installed.
|-
| {{c|make oldconfig}}
| Review changes between kernel versions and update to create a new {{Path|.config}} for the kernel.
|-
| {{c|make allyesconfig}}
| Enables all configuration options in the kernel. It will set ''all'' kernel options to <code>*</code>. Make sure a backup of the current kernel configuration is acquired before experimentally using it!
|}

También existen varios guiones para crear configuraciones por defecto de distintos tipos. Esto puede hacer que las configuración más complejas se realicen en menos tiempo. Lance la siguiente orden para mostrar una lista completa de las opciones de make:

{{RootCmd|make help}}

== Configuración ==

This article describes the configuration using the {{c|make menuconfig}} tool, but the procedure is similar for the other menus.

{{RootCmd|cd /usr/src/linux
|make menuconfig}}

=== Utilización ===

In the shown menu the blue bar indicates the position of the cursor. With the {{Key|↑}} and {{Key|↓}} arrow keys change the position of the cursor. The {{Key|←}} and {{Key|→}}  arrow keys traverse the menu bar in the bottom and define what happens when the {{Key|Enter}} key is pressed. For the menu bar below, '''Select''' switches to a sub menu for the menu entries ending with '''--->''' while '''Exit''' exits a sub menu. As an alternative the {{Key|Esc}} key can be pressed twice to exit the application.

Al pulsar una tecla asociada a una letra {{Key|A}}-{{Key|Z}} se moverá la posición del cursor a las líneas que tienen estos caracteres en negrita. Las teclas {{Key|Y}}, {{Key|M}} y {{Key|N}} se excluyen de esta forma de navegación ya que se utilizan para otros propósitos. Si una línea comienza por una Y, M  o N, el siguiente carácter se mostrará en negrita y se podrá saltar a esa línea. Por ejemplo, relativo a la posición actual del cursor, si la siguiente línea muestra "N'''e'''twork Device Support --->", al pulsar la tecla {{Key|E}}, se moverá el cursor a esa línea.

The following symbols can appear in front of the lines in the menus:

{| class="table"
|-
! Symbol(s)
! Description
|-
| <code>[ ], [*]</code>
| Options in square brackets can be activated or deactivated. The asterisk marks the menu entry as activated. The value can be changed with the {{Key|space}} key. It is also possible to press {{Key|Y}} key ('''Y'''es) to activate or {{Key|N}} key ('''N'''o) to deactivate the selected entry.
<br/>
If the option is activated, the selected feature/driver will be built into the kernel and will always be available at boot time.
|-
| <code>< >, <M>, <*></code>
| Options in angle brackets can be activated or deactivated, but also activated as module (indicated by a ''M''). The values can be modified by pressing {{Key|Y}}/{{Key|N}} keys as before or by pressing the {{Key|M}} key to activate the feature/driver as a module.
<br/>
See the [[Kernel Modules]] article for differentiation.
|-
| <code>{M}, {*}</code>
| Options in curly brackets can be activated or activated as module but not be deactivated. This happens because another feature/driver is dependent on this feature.
|-
| <code>-M-, -*-</code>
| Options between hyphens are activated in the shown way by another feature/driver. There is no choice.
|}

Más aún, algunas entradas de menú tienen una etiqueta al final:

{| class="table"
|-
! Etiqueta
! Descripción
|-
| <code>(NEW)</code>
| Este controlador es nuevo en el núcleo y probablemente no sea del todo estable.
|-
| <code>(EXPERIMENTAL)</code>
| Este controlador es experimental y seguramente no será del todo estable.
|-
| <code>(DEPRECATED)</code>
| Este controlador es obsoleto y no es necesario en la mayoría de los sistemas.
|-
| <code>(OBSOLETE)</code>
| Este controlador es obsoleto y no se debería activar.
|}

La mayoría de las opciones tienen una descripción que se puede ver pulsando la tecla {{Key|H}} o eligiendo '''Help''' en la barra de menú.

=== Selección de controladores ===

Eche un vistazo al artículo sobre [[hardware detection|detección del hardware]] y a los artículos en la categoría [[:Category:Hardware|Hardware]].

=== Buscar módulos ===

Within <code>menuconfig</code>, use the {{Key|/}} key to search modules by name.

As shown below, the search result will show numbers in front of the matches. Pressing {{Key|1}} in the example below would make <code>menuconfig</code> jump straight to the option ''Bluetooth device drivers'' in the menu structure.

{{KernelBox|title=Salida ejemplo después de buscar  HCIBTUSB|1=
Symbol: BT_HCIBTUSB [{{=}}m]                       
Type  : tristate                               
Prompt: HCI USB driver                         
  Location:                                    
    -> Networking support (NET [{{=}}y])           
      -> Bluetooth subsystem support (BT [{{=}}y]) 
(1)     -> Bluetooth device drivers            
  Defined at drivers/bluetooth/Kconfig:5       
  Depends on: NET [{{=}}y] && BT [{{=}}y] && USB [{{=}}m]
}}

=== Habilitar los ajustes comunes de Gentoo Linux ===

Existe una opción de configuración del núcleo llamada <var>CONFIG_GENTOO_LINUX</var> que se encuentra disponible únicamente en {{Package|sys-kernel/gentoo-sources}} y otros núcleos mantenidos por [[Project:Kernel|el proyecto del núcleo]]. Por sí misma no hace nada, sin embargo define algunas opciones de configuración que necesitan las instalaciones típicas.

Este ajuste selecciona automáticamente el soporte para <code>tmpfs</code> y <code>devtmpfs</code> que es necesario para gestionar {{Path|/dev}} en Gentoo Linux. En el futuro puede que se expanda para permitir otros ajustes obligatorios en un sistema Gentoo Linux. Para más información, lea la ayuda disponible en el sistema de configuración del núcleo del sistema tal y como se describió antes en esta guía.

== Construcción ==

Después de haber realizado correctamente la configuración, compile el núcleo:

{{RootCmd|make}}

En sistemas con procesadores con varios núcleos (cores), se debe intentar conseguir que trabajen todos. Añada la opción <code>-j(<NÚMERO_DE_NÚCLEOS> + 1)</code>. Por ejemplo, un procesador de doble núcleo contiene dos núcleos lógicos más uno (2 + 1):

{{RootCmd|make -j3}}

Un sistema con cuatro núcleos contiene cuatro núcleos lógicos más uno (4 + 1):

{{RootCmd|make -j5}}

== Configuración ==

Si se activaron controladores como módulos, se deberían instalar:

{{RootCmd|make modules_install}}

Los módulos se copiarán a un directorio de {{Path|/lib/modules}}.

Para instalar el núcleo:

{{RootCmd|make install}}

Esta orden lanza {{Path|/sbin/installkernel}}, que es parte del paquete {{Package|sys-apps/debianutils}}. ''El nuevo núcleo se instala en {{Path|/boot/vmlinuz-{versión}}}. Si ya existe un enlace simbólico {{Path|/boot/vmlinuz}} éste se refresca haciendo un enlace simbólico desde  {{Path|/boot/vmlinuz}} al nuevo núcleo y el núcleo previamente instalado estará disponible como {{Path|/boot/vmlinuz.old}}.'' ([[man page|Página del manual]] de ''installkernel''). Ocurre lo mismo para los ficheros {{Path|config}} y {{Path|System.map}}. Estos enlaces simbólicos son muy útiles ya que apunta siempre al último núcleo que se ha construido sin necesidad de cambiar la ruta a los ficheros (por ejemplo, se pueden utilizar en la configuración del cargador de arranque).

== Cargador de arranque ==

Cambie la configuración del [[bootloader|cargador de arranque]] del sistema para que inicie el nuevo núcleo.

Por último reinicie el sistema para que utilice el núcleo nuevo.

== Comparar la configuración actual del núcleo con la configuración por defecto ==

Utilice el siguiente procedimiento para tener una visión general de las configuraciones del núcleo que se desvían de la configuración por defecto. Recuerde que la modificación de un ajuste en la configuración puede conllevar ajustes de configuración adicionales.

{{RootCmd
|cd /usr/src/linux
|cp .config ../.config.working
|make defconfig
|mv .config ../.config.default
|cp ../.config.working .config
|cd ..
|/usr/src/linux/scripts/diffconfig .config.working .config.default > .config.diff
}}

The search function in {{c|make menuconfig}} can be used to look up the flags and their interpretation.
When you're done, clean up:

{{RootCmd
|cd /usr/src/
|rm .config.working .config.default .config.diff
}}

== Veáse también ==
* [[Genkernel/es]]
* [[Kernel/Configuration/Kernel_Seeds|Kernel Seeds]]

== Recursos externos ==

[[Category:Kernel]]
