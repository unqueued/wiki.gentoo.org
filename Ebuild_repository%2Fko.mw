<languages />
'''오버레이는 프로그램을 다룰 때, 포티지가 제자리를 찾아 처리하는 추가 저장소입니다.'''

젠투 리눅스에서 사용자에게 이미 "포티지 트리"라는 "주" 꾸러미 저장소 하나를 제공합니다. 주 저장소에는 젠투 개발자가 관리하는 모든 프로그램 꾸러미([[Ebuild|이빌드]])가 있습니다. 다만, 사용자는 주 트리에 "겹쳐 올리는" 추가 저장소를 넣을 수 있습니다. 그래서 이름이 "오버레이" 입니다.

꾸러미 저장소에는 파일 모음 말고도 더(또는 덜) 들어있는 곳이 아니기에 이 저장소는 공개 저장소(git, cvs, svn 등) 또는 타르볼로 다운로드 하고 시스템에 직접 추출하는 방식으로 가져올 수 있습니다. 그러나, 오버레이를 설치하면 포티지가 이 파일 또한 어떤 프로그램을 설치할지 파일을 찾아보고 결정하므로, 관리중이며 "신뢰하는" 제 3자 저장소를 사용하시는 것이 좋습니다.

== 오버레이 다루기 �==

Portage uses the <code>PORTDIR_OVERLAY</code> variable to link to the installed overlays on the system. This variable uses a space-delimited list of paths on the system where Portage can find the roots of the additional repositories.

=== Manually setting overlay locations ===

When you want to create an overlay yourself, create a location (say <code>/home/user/overlay</code>) in which you will put the packages you want Portage to look into as well. Then add <code>PORTDIR_OVERLAY="/home/user/overlay"</code> to your {{Path|/etc/portage/make.conf}} file:

{{File|/etc/portage/make.conf|Adding an overlay manually|<pre>
PORTDIR_OVERLAY="/home/user/overlay"
</pre>}}

=== Using crossdev ===

[[crossdev]] will automatically place the ebuilds/categories it generates into the first overlay found in <code>PORTDIR_OVERLAY</code>. You might want to prevent [[crossdev]] from disturbing [[layman]]'s overlays or your personal per-machine overlay (normally created at <code>/usr/local/portage</code>). You can create an overlay specifically for [[crossdev]]'s use:

{{RootCmd|mkdir -p /usr/local/portage-crossdev/profiles
|echo local-crossdev > /usr/local/portage-crossdev/profiles/repo_name}}

Then you can instruct portage and crossdev to use this overlay:

{{File|/etc/portage/make.conf|Let crossdev to store its ebuild in local-crossdev and indicate that the local overlay should override every other overlay|<pre>
source /var/lib/layman/make.conf
PORTDIR_OVERLAY="/usr/local/portage-crossdev ${PORTDIR_OVERLAY} /usr/local/portage"
</pre>}}

{{File|/etc/portage/make.conf|Prevent crossdev from messing with your local overlay when not using layman|<pre>
PORTDIR_OVERLAY="/usr/local/portage-crossdev /usr/local/portage"
</pre>}}

=== Using layman ===

To make management of multiple overlays simple, a tool called [[Layman|layman]] is developed. This tool knows about popular user- and developer managed overlays and is able to install & synchronize them as well as add them to the <code>PORTDIR_OVERLAY</code> location.

=== Local overlay ===

For instructions on setting up a local overlay, see [[Overlay/Local_overlay]].

=== Overlay priorities ===

Each overlay has its unique priority. This makes sure that in the case of a specific version being found in several overlays, the resolution is unambiguous. Ebuilds from overlays with higher priorities take precedence over ebuilds from overlays with lower priorities.

{{Note|This "natural" way of priority handling was introduced in January 2011, before that the priority resolution order was reversed, so negative numbers used to stand for high priorities}}

The list of overlays with their priorities can be obtained through the output of the following command

{{Cmd|emerge --info --verbose}}

Unless the <code>PORTDIR_OVERLAY</code> variable has been modified as described [[#Setting overlay priorities|below]], the default gentoo portage tree will have a priority of -1000. That means that all other overlays take precedence. That is the default behavior, because overlays are designed to "lay over/on top" of the portage tree.

==== Setting overlay priorities ====

The overlay priority is calculated from the order of overlay entries in the <code>PORTDIR_OVERLAY</code> variable. Portage "walks" through the variable from left to right and increments the priority on the way. The leftmost entry starts with a priority of 1, the next entry has a priority of 2 and so on.

{{Note|Some time ago the overlay priority could be set in <code>/etc/portage/repos.conf</code>. This does not work anymore}}

Unless the <code>PORTDIR_OVERLAY</code> contains the portage tree entry, the portage tree will always be assigned a priority of -1000.
This can be easily changed by putting <code>PORTDIR</code> in the <code>PORTDIR_OVERLAY</code> variable:

{{File|/etc/portage/make.conf|Manual portage tree priority setting|<pre>
PORTDIR_OVERLAY="/home/user/overlay ${PORTDIR}"
</pre>}}

In the example above the user overlay will be assigned a priority of 1 and the portage tree will be assigned a priority of 2. 

{{Note|If you also use [[Layman|layman]] to manage your overlays, you may be interested in the article about [[Layman#Setting overlay priorities with layman|setting overlay priorities with layman]].}}

=== Using unsafe overlays ===

When using huge overlays or those with unknown/low quality it is best practice to hardmask the whole overlay.

{{File|/etc/portage/package.mask|Mask all packages in an overlay|<pre>
*/*::overlay-name
</pre>}}

After that you can unmask the packages you specifically want to emerge.

{{File|/etc/portage/package.unmask|Unmask a specific package in an overlay|<pre>
foo/bar::overlay-name
</pre>}}

This way nothing weird will happen on updates and it is safer than using priorities.

== Metadata cache ==

=== Cache generation ===

When large overlays are installed, portage may take a long time to perform operations like dependency resolution. This is because overlays do not usually contain a metadata cache.

You may generate a local metadata cache by running emerge --regen after syncing your overlays.

{{RootCmd|layman -S
|emerge --regen}}

=== eix integration ===

==== eix-sync ====

eix-sync can run <code>emerge --regen</code> after syncing your overlays and portage tree.

{{File|/etc/eix-sync.conf||<pre>
# Sync all overlays
*
  
# Regenerate overlay metadata
@emerge --regen || true
</pre>}}

==== eix-update ====

eix-update can utilize the metadata cache generated by <code>emerge --regen</code> for a speedup and better accuracy. To enable this, set the <code>OVERLAY_CACHE_METHOD</code> to "<code>assign</code>" in {{Path|/etc/eixrc/01-cache}}.

{{File|/etc/eixrc/01-cache|Setting OVERLAY_CACHE_METHOD|<pre>
OVERLAY_CACHE_METHOD="assign"
</pre>}}


[[Category:Portage]]
