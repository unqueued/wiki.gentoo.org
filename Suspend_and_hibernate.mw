== Requirements ==

=== Software ===

The following software can be used for in-kernel default suspend/hibernate implementation, namely, ''swsusp''.

{{Emerge
|sys-power/suspend
}}

Also you must unemerge [https://packages.gentoo.org/packages/sys-power/upower sys-power/upower] and emerge [https://packages.gentoo.org/packages/sys-power/upower-pm-utils sys-power/upower-pm-utils]. Then in menu of your DE will button "Suspend" and "Hibernate". Checked on KDE 4.

{{Emerge
|sys-power/upower
|params=--unemerge
}}

{{Emerge
|sys-power/upower-pm-utils
}}

Another alternative is {{Package|sys-power/hibernate-script}} which can be used with swsusp and TuxOnIce patched kernels.

=== Kernel ===
Make sure the following variables are set to 'yes':

{{KernelBox|
Power management and ACPI options --->
    [*] Suspend to RAM and standby
    [*] Hibernation (aka 'suspend to disk')
}}

== Available suspend modes ==
To see available suspend modes use
{{RootCmd
|cat /sys/power/state
|prompt=root <span style{{=}}"color:blue;">linux #</span>
}}
for swsusp, default implementation.

Or else, probe `/sys/power/tuxonice/powerdown_method' sysfs file for ToI.

Those two file will list at least [[ACPI]] S2/4 power down methods on modern hardware.
New hardware would also support S5 method which is a rough S4 method.
ACPI S2 correspond to suspend to ram (''ram'' method is swsusp terms and ''3'' in ToI terms);
S4 hibernation to disk (''disk'' in swsusp temrs and ''4'' in ToI terms; S5 hibernation to disk (''5'' in ToI terms).

Swsusp users can choose between ''platfom'', meaning ACPI, or *shutdown* methods which can be echo-ed to `/sys/power/disk' sysfs file.

{{Note|TuxOnIce can be configured to take over swsusp syspend/hibernation methods. So any command echo-ed to either file will triger the same result.}}

== Suspend to RAM ==

Preferred commands to suspend are
{{RootCmd
|pm-suspend
|prompt=root <span style{{=}}"color:blue;">linux #</span>
}}
or
{{RootCmd
|s2ram
|prompt=root <span style{{=}}"color:blue;">linux #</span>
}}
or
{{RootCmd
|hibernate-ram
|prompt=root <span style{{=}}"color:blue;">linux #</span>
}}
for suspend (to ram) for hibernate-script users;
or
{{RootCmd
|hibernate
|prompt=root <span style{{=}}"color:blue;">linux #</span>
}}
to hibernate (to disk.)

A more raw method is to 
{{RootCmd
|echo mem > /sys/power/state
|prompt=root <span style{{=}}"color:blue;">linux #</span>
}}
or
{{RootCmd
|echo 3 > /sys/power/tuxonice/powerdown_method
|prompt=root <span style{{=}}"color:blue;">linux #</span>
}}
for TuxOnIce users. An then
{{RootCmd
|echo > /sys/power/tuxonice/do_hibernate
|prompt=root <span style{{=}}"color:blue;">linux #</span>
}}
is necessary to trigger a suspend/hibernation.

== Suspend to disk ==
for suspend to disk make sure you have a swap partition or swap file
The swap file should be active beforehand obviously and should be echo-ed on the appropriate file before any atempt to suspend/hibernate.

{{RootCmd
|echo /dev/sda1 > /sys/power/resume
|prompt=root <span style{{=}}"color:blue;">linux #</span>
}}
or
{{RootCmd
|echo /dev/sda1 > /sys/power/tuxonice/swap/swapfile
|prompt=root <span style{{=}}"color:blue;">linux #</span>
}}
for ToI users.

Do not forget to probe
{{RootCmd
|cat /sys/power/tuxonice/swap/headerlocations
|prompt=root <span style{{=}}"color:blue;">linux #</span>
}}
before issueing an actual command and append the result to kernel command line argument prepended with `resume='.
This will suffice to resume from a block device or swap file for ToI.
However, it's more complicated for a swapfile with swsusp. 

=== Suspend to disk with sys-power/pm-utils ===

Yet another way to achieve disk hibernation is to use hibernate to swap partition and pm-utils.

First, make sure you have a swap partition set, for this example, we will assume it's <code>/dev/sdc2</code>

edit <code>/etc/default/grub</code> and append the resume kernel option to <code>GRUB_CMDLINE_LINUX</code> pointing to you swap partition.

<code>GRUB_CMDLINE_LINUX="resume=/dev/sdc2"</code>

Rebuild your grub2 config : 

{{RootCmd
|grub2-mkconfig -o /boot/grub/grub.cfg
|prompt=root <span style{{=}}"color:blue;">linux #</span>
}}

Next, try 

{{RootCmd
|pm-hibernate
|prompt=root <span style{{=}}"color:blue;">linux #</span>
}}

=== Suspend to disk with swapfile ===

You can use suspend to disk with swapfile. You must create swapfile and configure GRUB.

Find UUID, where your swapfile place. For example /dev/sda (it may be LVM volume)

{{Note|If swapfile place at LVM volume, GRUB must be compiled with LVM support. Else system will not resume and will be cold start}}

{{RootCmd
|blkid /dev/sda
|prompt=root <span style{{=}}"color:blue;">linux #</span>
}}

Find offset of swapfile on partition

{{RootCmd
|swap-offset /path/to/swapfile
|prompt=root <span style{{=}}"color:blue;">linux #</span>
}}

After that edit GRUB config.

{{RootCmd
|nano -w /etc/default/grub
|prompt=root <span style{{=}}"color:blue;">linux #</span>
}}

And add some parameters to boot string

<code>GRUB_CMDLINE_LINUX_DEFAULT="resume=UUID=UUDI_of_partition resume_offset=offset_of_swapfile"</code>

Update grub-config

{{RootCmd
|grub2-mkconfig -o /boot/grub/grub.cfg
|prompt=root <span style{{=}}"color:blue;">linux #</span>
}}

After reboot you can hibernate your system. 

{{Note|Remember, that swapfile must contain all RAM!}}

== Troubleshooting ==

In troubleshooting suspend you can help log

{{RootCmd
|less /var/log/pm-powersave.log
|prompt=root <span style{{=}}"color:blue;">linux #</span>
}}

=== Can not resume after suspend ===
In case resuming from suspend does not work, disable the security chip in BIOS/UEFI and try again.

== Related links ==
[[Power management/Guide]]

[http://tuxonice.nigelcunningham.com.au TuxOnIce]
