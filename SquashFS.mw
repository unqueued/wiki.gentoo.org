{{InfoBox stack
|{{InfoBox homepage|http://sourceforge.net/projects/squashfs/|header=true}}
|{{InfoBox wikipedia}}
}}

'''SquashFS''' is an open source, read only, extremely compressible [[filesystem]]. Like other filesystems SquashFS is capable of de-duplicating the data passed to it, which helps it compress data further. Although not fully necessary to operate correctly, SquashFS is typically used with some kind of union filesystem when used for Live media (LiveUSBs and LiveCDs).

== Installation ==

=== Kernel ===

Activate the following kernel options ''must'' be activated for SquashFS support:

{{KernelBox|title=Enabling ext4 support|1=
File systems  --->
   [*] Miscellaneous filesystems  --->
      [*]   SquashFS 4.0 - Squashed file system support
}}

==== Optional SquashFS support ====

{{KernelBox|title=Enabling optional features of SquashFS|1=
File systems  --->
   [*] Miscellaneous filesystems  --->
         File decompression options (Decompress file data into an intermediate buffer)  --->
         Decompressor parallelisation options (Single threaded compression)  --->
      [*]     Squashfs XATTR support
      [*]     Include support for ZLIB compressed file systems
      [*]     Include support for LZ4 compressed file systems
      [*]     Include support for LZO compressed file systems
      [*]     Include support for XZ compressed file systems
      [*]     Use 4K device block size?
      [*]     Additional option for memory-constrained systems
      (3)       Number of fragments cached
}}

=== USE flags ===

Like most filesystems in Linux, the SquashFS filesystem tools come in a separate package. This package is called {{Package|sys-fs/squashfs-tools}}. Set the desired support for the package by adjusting USE flags accordingly.

{{USEflag|package=sys-fs/squashfs-tools|desc=Optional USE flags for {{Package|sys-fs/squashfs-tools}}:
|lz4+++Enable support for LZ4 compression using {{Package|app-arch/lz4}}
|lzma
|lzo
|xattr
|xz
}}

=== Emerge ===

After setting flags as desired, update the system so the changes take effect:

{{Emerge|params+=--changed-use --deep|sys-fs/squashfs-tools}}

== Usage ==

=== Filesystem creation ===

Creation of SquashFS filesystems is performed with the <tt>mksquashfs</tt> command. To create a SquashFS filesystem of the home directory of a user named Larry, the following command could be used:

{{Cmd|prompt=larry@example $|mksquashfs /home/larry /home/larry/home_directory.squashfs}}

Depending on what kernel features were selected for SquashFS support, the output of the <tt>mksquashfs</tt> command will look something like the following:

{{GenericCmd|
<pre>Parallel mksquashfs: Using 4 processors
Creating 4.0 filesystem on /home/larry/home_directory.squashfs, block size 131072.
[=====================================================================|] 22/22 100%

Exportable Squashfs 4.0 filesystem, gzip compressed, data block size 131072
        compressed data, compressed metadata, compressed fragments, compressed xattrs
        duplicates are removed
Filesystem size 17.95 Kbytes (0.02 Mbytes)
        22.73% of uncompressed filesystem size (78.98 Kbytes)
Inode table size 437 bytes (0.43 Kbytes)
        40.09% of uncompressed inode table size (1090 bytes)
Directory table size 403 bytes (0.39 Kbytes)
        57.99% of uncompressed directory table size (695 bytes)
Number of duplicate files found 6
Number of inodes 34
Number of files 25
Number of fragments 1
Number of symbolic links  0
Number of device nodes 0
Number of fifo nodes 0
Number of socket nodes 0
Number of directories 9
Number of ids (unique uids + gids) 3
Number of uids 2
        larry (1001)
        root (0)
Number of gids 2
        users (100)
        root (0)
</pre>}}

Notice the command provides an excellent summary of what went into the newly created {{Path|home_directory.squashfs}} file. Information such as filesystem size, inode table, directory table, number of duplicate files, UIDs, and GUIs are easily readable. This information can be very helpful when attempting to gather specific information from the filesystem.

=== Mount ===

To mount a SquashFS, use the <tt>mount</tt> command's <code>-o loop</code> option with escalated privileges:

{{Cmd|prompt=larry@example $
|mkdir ~/tmp
|sudo mount -o loop ~/home_directory.squashfs tmp/
}}

{{Note|If the <tt>sudo mount</tt> command fails, see the related entry in the troubleshooting section below.}}

=== Unmount ===

To unmount the filesytem, use the <tt>umount</tt> command with escalated privileges:

{{Cmd|prompt=larry@example $|sudo umount ~/tmp}}

== Troubleshooting ==

=== mount: only root can use "--options" option ===

This error is should be self-explanatory. Login as the root user or use <tt>[[sudo]]</tt> to run mount the filesystem with escalated privileges.

== External resources ==

* [https://www.youtube.com/watch?v=Rt6U2gG0ggw A SquashFS instructional video on YouTube].

[[Category:Filesystems]]
