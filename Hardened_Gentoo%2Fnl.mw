<languages />
Gentoo Hardened (nl: Verhard) is een Gentoo project dat meerdere additionele beveiligingsservices aanbiedt boven op de welbekende Gentoo Linux installatie. Terwijl elke service individueel geselecteerd kan worden, stelt Gentoo Hardened meerdere risicobeperkende opties in de toolchain, ondersteunen van PaX, grSecurity, SELinux, TPE en meer...

Of dat je nu een server op het internet of een flexibel werkstation draait, wanneer je voor verschillende bedreigingen staat wil je jouw systeem meer verharden door automatisch de laatste beveiligingsverbeteringen toe te passen. Een systeem '''verharden''' betekent dat je extra tegenmaatregelen toepast tegen aanvallen en andere risico's en dat is gewoonlijk een gecombineerde verzamelingen van activiteiten die je op jouw systeem uitvoert.

In Gentoo Hardened zijn er verschillende projecten die actief zijn met het verder helpen van jouw Gentoo systeem te verharden door
* specifieke opties in de toolchain (compiler, linker ...) aan te zetten zoals het forceren van positie-onafhankelijke toepassingen (en: position-independent executables aka PIE), stack smashing protectie en buffer controles tijdens het compileren.
* PaX extensies aan te zetten in de Linux kernel, dewelke additionele beveiligingsmaatregelen bieden zoals het randomiseren van van de adresruimte lay-out (ASLR) en niet-uitvoerbaar geheugen (NX).
* grSecurity extensies aan te zetten in de Linux kernel, inclusief extra chroot restricties, extra auditing, process restricties, enzovoort...
* [[Hardened Gentoo/SELinux|SELinux]] extensies aan te zetten in de Linux kernel, dewelke het Mandatory Access Control systeem aanbieden die de standaard Linux permissie restricties verbeteren.
* [[Integrity]] gerelateerde technologieÃ«n, zoals het Integrity Measurement Architecture, voor systemen beter te beveiligen tegen ongewenste veranderingen.

Natuurlijk bevat dit de nodige userspace programma's om deze extensies te beheren.

== Wisselen naar een Hardened Profiel ==

Selecteer een Hardened [[Profile|Profiel]], zodanig dat "pakket management" op een verharde manier gedaan word.

{{RootCmd|eselect profile list}}
{{RootCmd|eselect profile set [number of hardened profile]}}
{{RootCmd|source /etc/profile}}

By choosing the hardened profile, certain package management settings (masks, USE flags, etc) become default for your system.  This applies to many packages, including the toolchain.  The toolchain is used for building/compiling your programs, and includes: the GNU Compiler Collection (GCC), binutils (linker, etc.), and the GNU C library (glibc).  By re-emerging the toolchain, these new default settings will apply to the toolchain, which will allow all future ''package compiling'' to be  done in a hardened way.

{{emerge|params=--oneshot|binutils gcc virtual/libc}}

The above command rebuilt GCC, which can now be used to compile hardened software.  Make sure that the hardened option is selected for GCC.

{{RootCmd|gcc-config -l
|output=<pre>
[1] i686-pc-linux-gnu-4.5.3 *
[2] i686-pc-linux-gnu-4.5.3-hardenednopie
[3] i686-pc-linux-gnu-4.5.3-hardenednopiessp
[4] i686-pc-linux-gnu-4.5.3-hardenednossp
[5] i686-pc-linux-gnu-4.5.3-vanilla
</pre>}}

In the example output above, the hardened GCC profile is the one without a suffix. If you want to disable PIE or SSP, choose the relevant '''hardenedno'''('''pie'''|'''ssp''') or both, '''hardenednopiessp'''. The '''vanilla''' profile is of course the one with hardening disabled. Finally source your new profile settings:

{{RootCmd|source /etc/profile}}

If you use the "prelink" package, remove it, since it isn't compatible with the hardened profile:

{{emerge|params=--depclean|prelink}}

Now you can reinstall all packages with your new hardened toolchain:

{{emerge|params=--emptytree --verbose|@world}}

Install hardened kernel sources, so that the kernel will *manage your running system* in a hardened way (especially using PaX):

{{emerge|hardened-sources}}

Now configure/compile the sources and add the new kernel to your boot manager (ie., GRUB).

== Tips & Tricks ==

=== Hardened Gentoo/Grsecurity chroot ===

If you want to chroot to a copied environment where the CONFIG_GRKERNSEC_CHROOT is enabled you must use the cd grub and change the root(cd) kernel(cd) initrd(cd) setting to from (cd) to (hdx,y).

Now you can install the grub environment.

=== Per Package Hardening Settings ===

{{Warning|This method is not supported by Gentoo.}}

Changing the GCC profile to deal with specific packages can be a pain. A way to avoid this is to set per-package C(XX)FLAGS using [[:/etc/portage/env|package.env]]. Create the file /etc/portage/env/nossp and add to that:

{{File|/etc/portage/env/nossp|Disable SSP|<pre>
CFLAGS="${CFLAGS} -fno-stack-protector"
CXXFLAGS="${CXXFLAGS} -fno-stack-protector"
</pre>}}

To allow for disabling PIE, create and add to {{Path|/etc/portage/env/nopie}}:

{{File|/etc/portage/env/nopie|Disable PIE|<pre>
CFLAGS="${CFLAGS} -nopie"
CXXFLAGS="${CXXFLAGS} -nopie"
LDFLAGS="${LDFLAGS} -nopie"
</pre>}}

Finally add the package you want to disable either PIE or SSP for to /etc/portage/package.env and the relevant /etc/portage/env/<filename>, for this example {{Package|sys-libs/zlib}} is used here:

{{File|/etc/portage/package.env|Disable PIE for sys-libs/zlib|<pre>
sys-libs/zlib nopie
</pre>}}

== See also ==

For more information, check out the following resources:
* [http://www.gentoo.org/proj/en/hardened/ Gentoo Hardened Project]
* [http://www.gentoo.org/proj/en/hardened/selinux/ Gentoo Hardened SELinux Project]
* http://www.gentoo.org/proj/en/hardened/grsecurity.xml
* http://www.gentoo.org/proj/en/hardened/pax-quickstart.xml

== External resources ==

* http://www.rockfloat.com/howto/gentoo-hardened.html#kernel


[[Category:Security]]
