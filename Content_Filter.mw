{{InfoBox stack
|{{InfoBox todo|Section [[#Installing and Configuring Tinyproxy|Installing and Configuring Tinyproxy]] is still under construction.|Write content for the [[#Large Networks|Large Networks]] section.|Write content for the [[#Transparent Filtering With IPTables|Transparent Filtering With IPTables]] section.}}
}}

== Planning ==
In order to build a successful content filter, some questions need answering. How many users will be filtered? What will be filtered? How will it be filtered?

== Single Machines And Small Networks ==
For single machines and small networks I find that Tinyproxy and Dansguardian work best.<br />
Tinyproxy is a very lightweight and easy to configure proxy server. Dansguardian actually does all the filtering work, but is unable to fetch pages by itself, this is where Tinyproxy comes in.<br />
A user will open their web browser and request a web page, this request typically travels over port 80, we'll redirect port 80 to a port that Dansguardian is listening on, then Dansguardian will forward the request onto Tinyproxy, who will then actually go out and fetch the web page.<br />

=== Installing and Configuring Tinyproxy ===
*under construction*
By default a few USE flags are set for Tinyproxy, most are not needed for this guide but don't hurt either. However be sure that the '''transparent-proxy''' USE flag is '''not''' set. It is not compatible with this guide.<br />
First, install Tinyproxy:
{{Emerge|tinyproxy}}

Next, back up the default configuration in case things go astray:
{{RootCmd|cp /etc/tinyproxy.conf /etc/tinyproxy.conf.vanilla}}
Finally, open /etc/tinyproxy.conf in your favorite text editor, make sure you have suid root privileged.
Make sure it looks something like this:
{{File|/etc/tinyproxy.conf||<pre>
User tinyproxy
Group tinyproxy
Port 3128
Timeout 1200
DefaultErrorFile "/usr/share/tinyproxy/default.html"
LogFile "/var/log/tinyproxy/tinyproxy.log"

# change this to Info when debugging issues for more verbose output
LogLevel Error

# these settings can significantly effect the performance of the proxy
MaxClients 100
MinSpareServers 5
MaxSpareServers 20
StartServers 10
MaxRequestsPerChild 0

# for a single computer, chose this, otherwise remove it
Allow 127.0.0.1

# for a small network, chose the subnet in use, otherwise remove it
Allow 10.0.0.0/24

# you can leave this as is or change it to whatever you like, its a privacy thing
ViaProxyName "tinyproxy"

# the easiest, but least secure option for ConnectPort is to leave it commented
# this way all ports are allowed. each port you wish to allow should be listed on its own line
ConnectPort 445 # SSL
ConnectPort 563 # TLS
</pre>}}

=== Installing and Configuring DansGuardian ===
Todo

== Large Networks ==
Todo

=== Installing and Configuring Squid ===

=== Tweaking DansGuardian For Heavier Use ===

==== Authentication and Authorization ====

==== Filter Groups ====

== Transparent Filtering With IPTables ==

[[Category:Server]]
