This page contains information on how to run your own private Gentoo mirror.

{{Note|If you want to help the project by providing public mirrors, please see the relevant documentation for [[Project:Infrastructure/Mirrors/Source|source]] and [[Project:Infrastructure/Mirrors/Rsync|rsync]] mirrors.}}

== Setting up your own rsync mirror ==

Many users run Gentoo on several machines and need to sync the portage trees on all of them. Using public mirrors is simply a waste of bandwidth at both ends. Syncing only one machine against a public mirror and all others against that computer would save resources on Gentoo mirrors and save users' bandwidth. 

The same holds true for organizations who would like to control the rsync mirror their servers and workstations sync against. Of course, they usually also want to save on bandwidth and traffic costs. 

All you need to do is select which machine is going to be your own local rsync mirror and set it up. You should choose a computer that can handle the CPU and disk load that an rsync operation requires. Your local mirror also needs to be available whenever any of your other computers syncs its portage tree. Besides, it should have a static IP address or a name that always resolves to your server. Configuring a DHCP and/or a DNS server is beyond the scope of this guide. 

=== Setting up the server ===

There is no extra package to install as the required software is already on your computer. Setting up your own local rsync mirror is just a matter of configuring the <code>rsyncd</code> daemon to make your {{Path|/usr/portage}} directory available for syncing. Create the following {{Path|/etc/rsyncd.conf}} configuration file: 

{{FileBox|filename=/etc/rsyncd.conf|1=
pid file = /var/run/rsyncd.pid
max connections = 5
use chroot = yes
uid = nobody
gid = nobody
# Optional: restrict access to your Gentoo boxes
hosts allow = 192.168.0.1 192.168.0.2 192.168.1.0/24
hosts deny  = *
  
[gentoo-portage]
path=/usr/portage
comment=Gentoo Portage
exclude=distfiles/ packages/
}}

You do not need to use the <code>hosts allow</code> and <code>hosts deny</code> options. By default, all clients will be allowed to connect. The order in which you write the options is not relevant. The server will always check the <code>hosts allow</code> option first and grant the connection if the connecting host matches any of the listed patterns. The server will then check the <code>hosts deny</code> option and refuse the connection if any match is found. Any host that does not match anything will be granted a connection. Please read the man page (<code>man rsyncd.conf</code>) for more information. 

Now, start your rsync daemon with the following command as the root user: 

{{RootCmd|/etc/init.d/rsyncd start
|rc-update add rsyncd default}}

Let's test your rsync mirror. You do not need to try from another machine but it would be a good idea to do so. If your server is not known by name from all your computers, you can use its IP address instead. 

{{RootCmd|rsync 192.168.0.1::|output=<pre>
gentoo-portage     Gentoo Portage</pre>}}

{{RootCmd|rsync your_server_name::gentoo-portage}}

You should see the content of /usr/portage on your mirror.

Your rsync mirror is now set up. Keep running <code>emerge --sync</code> as you have done so far to keep your server up-to-date. If you use cron or similar facilities to sync regularly, remember to keep it down to a sensible frequency like once or twice a day. 

{{Note|Please note that most public mirror administrators consider syncing more than once or twice a day an abuse. Some if not most of them will ban your IP from their server if you start abusing their machines.}}

=== Configuring your clients ===

Now, make your other computers use your own local rsync mirror instead of a public one using [[Project:Portage/Sync#Portage_configuration|{{Path|repos.conf}}]].
