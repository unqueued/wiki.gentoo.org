''The /usr move'' is a concept of moving various applications installed into the filesystem root to {{path|/usr}} prefix in order to unify the filesystem layout.

== Benefits ==
=== A common location for all shared data ===
Currently, the read-only shared data for various programs are split between {{path|/}} subdirectories and {{path|/usr}}. This means, that the rootfs usually contains both read-only and writable data which separating requires using a number of additional, small mountpoints.

The concept is that after the split, all shared, read-only data would be stored in {{path|/usr}}, while other locations in rootfs will be used to perform their respective (mostly read/write) tasks.

Possible uses include:

# sharing the whole system over NFS. Right now this requires sharing {{path|/bin}}, {{path|/lib*}}, {{path|/sbin}} and {{path|/usr}}. After the move, only {{path|/usr}} would be necessary;
# mounting {{path|/usr}} read-only while keeping {{path|/}} read/write. Right now, this keeps the '''most important''' system executables and libraries writable. Of course, a preferable alternative is to mount whole {{path|/}} read-only but it usually involves moving some files from {{path|/etc}} to other locations (like {{path|/etc/resolv.conf}} when using DHCP).

== Prerequisites ==
=== initramfs (for system packages) ===
In order to perform the {{path|/usr}} move on packages required to boot the system, it is necessary that all users having separate {{path|/usr}} partition have an enabled and working initramfs. Such an initramfs would need to mount the {{path|/usr}} filesystem in order to execute the system init.

=== /usr remount in system RC ===
Considering that initramfs would mount {{path|/usr}} read-only (alike {{path|/}} is mounted now), OpenRC or any other RC used in Gentoo would need to be able to perform fsck on mounted {{path|/usr}} and re-mount it read/write afterwards. In other words, {{path|/usr}} would need to be handled alike {{path|/}} is handled now.

== The process ==
=== Modifying package install prefixes ===
The most important process in the {{path|/usr}} move is updating the packages to not use {{path|/}} prefix. In most cases, this simply involves removing the ''--prefix'' argument to configure calls since {{path|/usr}} is the default prefix used by ''econf''.

Some packages install files to rootfs directories explicitly. Those packages may require actually modifying the build system or specifying the prefix some other way.

=== Adding necessary symlinks ===
To maintain compatibility with various packages, a symlinks to various binaries or libraries may need to be created on rootfs. However, it is preferred that packages in question are checked for possibility of fixing first.

For example, if a script calls {{path|/bin/foo}}, it is preferred that it is fixed to just call ''foo'' and let the shell handle ''${PATH}'' resolution rather than creating an unnecessary symlink.

== The /usr move in other distributions ==
A [http://fedoraproject.org/wiki/Features/UsrMove similar concept is being considered in Fedora] yet it assumes that the rootfs directories would become symlinks to {{path|/usr}} counterparts. In Gentoo we are rather considering creating the symlinks for necessary files only.

[[Category:Core system]]
