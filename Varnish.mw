{{InfoBox stack
|{{InfoBox homepage|https://www.varnish-cache.org/|header=true}}
|{{InfoBox wikipedia|Varnish_(software)}}
|{{InfoBox ohloh}}
}}

'''Varnish''' is [[Article description::a webcache and HTTP accelerator.]] It can either serve cached content, or retrieve content from a server and cache it. This helps to reduce I/O pressure for web servers that are serving many clients or have many requests.

== Installation ==

=== USE flags ===

{{USEflag|package=www-servers/varnish}}

=== Emerge ===

Install {{Package|www-servers/varnish}}

{{emerge|www-servers/varnish}}

== Configuration ==

=== Files ===

==== Global ====

Configuration is controlled by the {{Path|/etc/varnish/default.vcl}} file.

{{FileBox|filename=/etc/varnish/example.vcl|tile=Example configuration file|1=
#
# This is an example VCL file for Varnish.
#
# It does not do anything by default, delegating control to the
# builtin VCL. The builtin VCL is called when there is no explicit
# return statement.
#
# See the VCL chapters in the Users Guide at https://www.varnish-cache.org/docs/
# and https://www.varnish-cache.org/trac/wiki/VCLExamples for more examples.

# Marker to tell the VCL compiler that this VCL has been adapted to the
# new 4.0 format.
vcl 4.0;

# Default backend definition. Set this to point to your content server.
backend default {
    .host = "127.0.0.1";
    .port = "8080";
}
}}

Any traffic pointed at port 8080 will travel through varnish.

=== Service ===

==== OpenRC ====

To start varnish immediately:

{{RootCmd|rc-service varnishd start}}

To start varnish at boot:

{{RootCmd|rc-update add varnishd default}}

==== systemd ====

To start varnish on boot:

{{RootCmd|systemctl enable varnishd}}

To start varnish immediately:

{{RootCmd|systemctl start varnishd}}

== Troubleshooting ==

=== Verification ===

The {{c|curl}} command ({{Package|net-misc/curl}}) can be used to verify that HTTP traffic is successfully traveling through the varnish proxy:

{{Cmd|curl -I <nowiki>https://wiki.gentoo.org/wiki</nowiki>}}

[[Category:Server]]
[[Category:Daemons]]
