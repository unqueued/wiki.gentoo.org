Flicker Free Boot is a relatively new feature, that was created by Hans de Goede and is available in Fedora since version 30. This Wiki page will show you how to implement it in Gentoo, to have a smooth boot experience.<br>
<br>
This is not an easy task to accomplish and might break your system.<br>
''' <span style="color:#FF0000">Follow this tutorial at your own risk!</span>'''<br>

== Testing ==

=== Dell PowerEdge T20 ===
This process was tested on a Dell PowerEdge T20 with Intel Xeon E3-1225v3 (Haswell Based) processor. On the Dell PowerEdge the boot proces is around 80% fluent. It flickers once for 2 - 3 sec. Unfortunately it's the same when booting from a Microsoft Windows 10 based USB key, so I guess it's the way it was implemented.

=== Lenovo ThinkPad P52 ===
This process was tested on a Lenovo ThinkPad P52 with Intel Core i7-8750H (Coffee Lake Based) processor. On the Lenovo ThinkPad P52 the boot proces is around completely fluent. It doesn't flicker, so this guide should work as expected.<br>

=== Other results ===
Please share your success or failure results if you can. This way we can get a more accurate view of what is working.

== Requirements ==

=== Hardware / Software ===
- A working UEFI setup, preferably with a Intel Skylake (6th Generation) or more recent processor should work.<br>
- Older (3rd to 5th Generation Core iXXXX series processors might work.<br>
- You must be using the Intel Onboard (i195) series graphics. Other graphics cards are not supported yet.<br>
- The specified system must boot up in native UEFI mode. CSM mode needs to be disabled.<br>
- The specified system must use a manually compiled kernel. I haven't tested this with a genkernel created kernel.<br>
- If you're using an older (e.g. Ivy Bridge / Haswell / Broadwell) based system, it's recommended that you use at least {{Package|sys-kernel/gentoo-sources-4.20.17}} or higher due to a bug that actually causes the screen to go to stand-by mode and turn back on.
- This guide assumes that you've configured your kernel correctly and set the appropriate options for framebuffer support and such.<br>
- This guide assumes that you're using /dev/sda1 as ESP (/boot) partition. If it's not, then adjust the commands for your own paths accordingly.<br>
- This guide assumes that you're using a standardized naming scheme for your kernel that grub identifies and accepts (vmlinuz- or kernel-).<br>
- The specified system must use grub as a bootloader. I've tried getting it to work with EFI stub, but it just does not seem to work.<br>

=== Knowledge ===
- A working gentoo setup, preferably configured with grub2.<br>
- Intermediate to advanced knowledge about the Linux boot proces.<br>
- Knowledge on how to manually patch and compile.<br>

=== Summary ===
This tutorial assumes that you've currently got a working Gentoo setup. This setup boots in (U)EFI mode using grub2 with CSM mode disabled and is using an Intel processor with it's own integrated graphics card.

== Installing the required software ==
In order to be able to succesfully get everything working, there's a things you'll need to do in order to be able to succesfully getting this running on a system

=== Using the GIT version of plymouth and setting the correct USE flags ===
The only version that currently has these patches is the GIT version of plymouth. In order to emerge the GIT version of plymouth, you'll need to take the following steps<br>
# Run the command: {{RootCmd|nano -w /etc/portage/package.use/plymouth}}
# Add the following line to the file: {{FileBox|filename=/etc/portage/package.use/plymouth|lang=portage|1=
sys-boot/plymouth libkms pango
}}
## NOTE: libkms is the minimal requirement for the splash screen even to show up and pango is required For interactivity (e.g.: If you want to have the ability to enter a LUKS password on a nice graphical screen). The gtk and gdm USE flags should be added respectively when using GDM as Display Manager or lightdm with GTK.
## NOTE: Do NOT use the static-libs USE flag. This USE flags break plymouth and causes the package not to compile or show any themes.
# Press CTRL + O, press [Enter] and press CTRL + X in order to save the file.
# Run the command: {{RootCmd|nano -w /etc/portage/package.use/plymouth}}
# Add the following line to the file: {{FileBox|filename=/etc/portage/package.accept_keywords/plymouth|lang=portage|1=
sys-boot/plymouth **
}}
# Press CTRL + O, press [Enter] and press CTRL + X in order to save the file.
# Now install the package: {{Package|sys-boot/plymouth}}, by running the command: {{RootCmd|emerge -av plymouth}}Verify if the package is actually version 9999 (otherwise there might be a typo in one of the files) and press Y [Enter]
## NOTE: This might pull in some extra dependencies. This is due to the fact that the ebuild will actually literally pull the package from GIT.

=== Using dracut version 0.49-r1 (the ~amd64 version of dracut) ===
I've only been able to get this to work by using the ~amd64 version of dracut. I've tried to get it to work with genkernel-next, but it just does not seem to work. Using the latest available version of dracut from portage is recommended.
# Run the command: {{RootCmd|nano -w /etc/portage/package.accept_keywords/dracut}}
# Add the following line to the file: {{FileBox|filename=/etc/portage/package.accept_keywords/dracut|lang=portage|1=
sys-boot/plymouth ~amd64
}}
# Press CTRL + O, press [Enter] and press CTRL + X in order to save the file.
# Now install the package: {{Package|sys-kernel/dracut}}, by running the command: {{RootCmd|emerge -av dracut}}Verify if the package is actually at least version 0.49-r1 (otherwise there might be a typo in one of the files) and press Y [Enter]

=== Getting the custom version of grub2 ===
Hans de Goede from Fedora made a customized version of grub in order to get this to work. This is not the default grub2 you get by emerging the software. For this you'll need to use the customized version of grub.
# Git should already be installed, as it should've been pulled in by emerging the 9999 version of plymouth. If it's not, then install {Package|dev-vcs/git}} by running the command : {{RootCmd|emerge -av git}} and press Y [Enter].
# Now let's make a directory which we'll clone the project in and enter it {{RootCmd|mkdir -p /root/grub/fedora}}{{RootCmd|cd /root/grub/fedora}}
# Now let's clone the project from Fedora: {{RootCmd|git clone https://github.com/rhboot/grub2 -b fedora-30}}

== Building and compiling ==
=== Getting the splash screen to show ===
In order to get the splash screen to show, we'll need to adjust a few settings and generate working initramfs using dracut.
# First we'll need to edit the plymouthd file, to specify the theme we'll be using. Run the command: {{RootCmd|nano -w /etc/plymouth/plymouthd.conf}}
# Change the settings to make it look like the following: {{FileBox|filename=/etc/plymouth/plymouthd.conf|lang=portage|1=
[Daemon]
Theme=bgrt
ShowDelay=0
}}
# Press CTRL + O, press [Enter] and press CTRL + X in order to save the file.
# Now let's mount the boot partition in order for plymouth to be able to automatically install the initramfs file{{RootCmd|mount /dev/sda1 /boot}}
# Now let's generate the initramfs with the plymouth theme and have it automatically: {{RootCmd|plymouth-set-default-theme -R bgrt}}
## Note: This command automatically generates an intitramfs file and will install it onto the /boot partition with the name initramfs-[version]-gentoo-[release].img which grub will pick up automatically.
