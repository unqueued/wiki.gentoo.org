<languages />


{{Metadata|abstract=El objetivo de esta guía es ofrecer a los lectores una migración cómoda desde GRUB Legacy a GRUB2.}}

{{Metadata|abstract=El objetivo de esta guía es ofrecer a los lectores una migración cómoda desde [[GRUB Legacy]] a [[GRUB2/es|GRUB2]].}}

== Conceptos previos ==

=== ¿Qué es GRUB? ===

GRUB es uno de los cargadores de arranque más utilizados en las máquinas Linux no empotradas. El papel de GRUB es facilitar la carga del núcleo Linux del disco a la memoria y la ejecución del núcleo. 

=== ¿Porqué migrar? ===

En primer lugar, ya no se mantiene GRUB Legacy y por lo tanto no recibe actualizaciones. GRUB Legacy se creó en un tiempo en el que los desarrolladores se sentían a salvo al hacer ciertas suposiciones que ya no son ciertas hoy en día. Por ejemplo, GRUB Legacy no puede arrancar desde discos mayores de 2 TB y asume que los nuevos sistemas de archivos no podrían reemplazar {{Path|/boot}}. 

El objetivo de GRUB2 es ser más robusto, más portable, más potente y se mantiene con una base de código más limpia. GRUB2 ofrece soporte a más configuraciones de hardware, más sistemas de archivos y más disposiciones de controladores que su predecesor. 

== Migración a GRUB2 ==

La migración a GRUB2 es bastante directa: el gestor de paquetes lo obtiene como un componente más del proceso regular de actualización. Si no se obtiene de forma automática se puede hacer emerge a través del átomo de paquete <code>sys-boot/grub:2</code>:

{{Emerge|sys-boot/grub:2}}

=== Dispositivo de arranque ===

Lo más importante es comprender cuál de los discos es arrancable. Para aquéllos que hayan seguido el manual de Gentoo debería ser {{Path|/dev/sda}}. Para aquéllos que no están seguros, la forma más fácil de localizarlo es echar un vistazo a la configuración actual de GRUB Legacy. El fichero {{Path|/boot/grub/grub.conf}} es el lugar a comprobar. 

{{Note|Asegúrese de que la partición {{Path|/boot}} está montada para poder ver estos ficheros. Debería hacerse algo tan simple como {{RootCmd|mount /boot}}
}}

El fichero {{Path|grub.conf}} debería tener el siguiente aspecto:

{{FileBox|filename=/boot/grub/grub.conf|1=
default 0
timeout 30
splashimage=(hd0,0)/boot/grub/splash.xpm.gz
  
title Gentoo Linux 3.2.12
root (hd0,0)
kernel /boot/kernel-3.2.12-gentoo root=/dev/sda3 quiet dolvm
initrd /boot/initramfs-genkernel-x86_64-3.2.12-gentoo
}}

Basándose en el fichero de arriba, se puede deducir que  <code>(hd0)</code> es el disco de arranque, sin embargo, debemos mapearlo al dispositivo real. Para averiguar esto, echar un vistazo al fichero {{Path|/boot/grub/device.map}}. Abajo se muestra un ejemplo. 

{{FileBox|filename=/boot/grub/device.map|1=
(fd0) /dev/fd0
(hd0) /dev/sda
(hd1) /dev/sdb
}}

{{Note|Cuando se sospeche que {{Path|/boot/grub/device.map}} no es exacto, lanzar la siguiente orden para recrear el fichero:
{{RootCmd|grub-install --recheck /dev/sda}}
}}

Basándose en el fichero de arriba, podemos deducir que {{Path|/dev/sda}} es el disco de arranque.

== Instalar y configurar GRUB2 ==

El siguiente paso es instalar y configurar GRUB2 para la partición {{Path|/boot}} sin reemplazar GRUB Legacy del Registro Principal de Arranque (Master Boot Record o MBR). El ejemplo de abajo utiliza {{Path|/dev/sda}}. Reemplazarlo por la ruta correcta al disco de arranque.

En primer lugar instalar los ficheros necesarios de GRUB2 a {{Path|/boot/grub}}.

{{RootCmd|grub-install --grub-setup{{=}}/bin/true /dev/sda|output=<pre>
Installation finished. No error reported.
</pre>}}

{{Warning|The option <code>--grub-setup{{=}}/bin/true</code> tells {{c|grub-install}} to ''not'' install GRUB2 in the MBR. If this option is omitted, GRUB Legacy will be overwritten and [[#Chainloading GRUB2 from GRUB Legacy to test the setup|chainloading GRUB2 from GRUB Legacy later on]] will not be possible.}}

{{Note|If GRUB2 was emerged with the <code>multislot</code> USE flag, the {{c|grub-install}} command will still refer to GRUB Legacy. In this case, use {{c|grub2-install}} instead — and use {{c|grub2-mkconfig}} in place of {{c|grub-mkconfig}} in the next step.}}

Now we can scan the available kernels and generate a suitable config file to {{Path|/boot/grub/grub.cfg}}. Skip this step when using a [[GRUB2_Quick_Start#Manual_configuration|Manual Configuration]].

{{RootCmd|grub-mkconfig -o /boot/grub/grub.cfg|output=<pre>
Generating grub.cfg ...
Found linux image: /boot/kernel-3.2.12-gentoo
Found initrd image: /boot/initramfs-genkernel-x86_64-3.2.12-gentoo
done
</pre>
}}

{{Warning|GRUB2 uses the configuration file {{Path|/boot/grub/grub.'''cfg'''}} whereas GRUB Legacy used {{Path|/boot/grub/grub.'''conf'''}} so please make sure not to use the old file by mistake, e.g. by using tab-completion if the old file is still there.}}

{{Note|{{c|grub-mkconfig}} has strict naming requirements for kernels and initramfs images. A kernel must be named <code>kernel-${version}</code> or <code>vmlinuz-${version}</code> while an initramfs must be named <code>initramfs-${version}.img</code>, <code>initramfs-genkernel-${version}</code>, <code>initramfs-genkernel-${arch}-${version}</code>, <code>initrd-${version}.img</code>, <code>initrd.img-${version}</code>, <code>initrd-${version}.gz</code>, or <code>initrd-${version}</code>. These files must be available in {{Path|/boot}}.}}

{{Note|El fichero {{Path|/etc/default/grub}} controla la operación de {{c|grub-mkconfig}}. Si es necesario pasar parámetros al núcleo (por ejemplo cuando se utiliza  genkernel y se arranca desde LVM o RAID por software), editar dicho fichero antes de generar {{Path|/boot/grub/grub.cfg}} de este modo:
{{RootCmd|nano /etc/default/grub}}
Echar un vistazo a la [[GRUB2#Configuration|configuración de GRUB2]] en el wiki de Gentoo o al [http://www.gnu.org/software/grub/manual/html_node/Simple-configuration.html manual oficial de GRUB2] para decidir cómo modificar este fichero. La mayoría de usuarios necesitarán cambiar <code>GRUB_CMDLINE_LINUX</code> para especificar los parámetros a pasar a la línea de órdenes del núcleo.}}

=== Cargar en cadena GRUB2 desde GRUB Legacy para probar la configuración ===

Because a broken GRUB configuration could mean an unbootable system, we want to test our GRUB2 configuration before making it permanent. To do this we will chainload GRUB2 from GRUB Legacy. This is done by adding a new section into {{Path|/boot/grub/grub.conf}}. An example is shown below. 

{{Note|Tenga en cuenta que la partición raíz puede ser diferente de <code>(hd0,0)</code> que es la que se utiliza en el ejemplo y asegúrese de reutilizar el mismo valor para el raíz del fichero de configuración {{Path|/boot/grub/grub.conf}}.}}

{{FileBox|filename=/boot/grub/grub.conf|1=
default 0
timeout 30
splashimage=(hd0,0)/boot/grub/splash.xpm.gz
  
title GRUB2 Chainload
root (hd0,0)
kernel /boot/grub/i386-pc/core.img
boot
  
title Gentoo Linux 3.2.12
root (hd0,0)
kernel /boot/kernel-3.2.12-gentoo root=/dev/sda3 quiet dolvm
initrd /boot/initramfs-genkernel-x86_64-3.2.12-gentoo
}}

At this point the machine should be rebooted, and <code>GRUB2 Chainload</code> selected from the GRUB menu when the machine begins to boot. Another GRUB menu will be presented which should advertise itself as GRUB 2.0.0 or higher at the top and show the available kernel(s) to boot. Should this not work, simply reboot the system and pick the normal boot option instead of <code>GRUB2 Chainload</code>. 

=== Reemplazar y eliminar GRUB Legacy ===

Si todo ha ido bien, reemplace GRUB Legacy y elimínelo del sistema. 

{{Warning|Since the system has been rebooted, it might be necessary to mount {{Path|/boot}} again. Make sure to use the right boot drive path instead of {{Path|/dev/sda}} as this is merely an example. If {{Path|/boot}} is not mounted before running {{c|grub-install}}, the system will become unbootable}}

{{Note|Tal y como se ha mencionado anteriormente, si se hizo emerge de GRUB2 con el ajuste USE <code>multislot</code> entonces se debe utilizar {{c|grub2-install}} en lugar de {{c|grub-install}}. En este caso, una vez se ha eliminado GRUB Legacy del sistema como se indica en el siguiente paso, se debe volver a hacer emerge de GRUB2 sin el ajuste USE <code>multislot</code> de modo que {{c|grub-install}} y {{c|grub-mkconfig}} se puedan convertir en órdenes GRUB2.}}

{{RootCmd|grub-install /dev/sda|output=<pre>
Installation finished. No error reported.
</pre>
}}

En este punto utilice el gestor de paquetes para eliminar <code>sys-boot/grub:0</code>. 

{{RootCmd|emerge -avC "{{=}}sys-boot/grub-0.97*"}}

Así se completa la migración.

== Mantenimiento de GRUB2 ==

Cada vez que se instala un nuevo núcleo, se debe completar el siguiente paso de modo que la configuración de GRUB2 reconozca el nuevo núcleo (excepto cuando se esté realizando una [[GRUB2_Quick_Start/es#Configuraci.C3.B3n_manual|configuración manual]]). 

{{Note|Asegúrese de que la partición {{Path|/boot}} está montada para realizar este paso.}}

{{RootCmd|grub-mkconfig -o /boot/grub/grub.cfg|output=<pre>
Generating grub.cfg ...
Found linux image: /boot/kernel-3.3.8-gentoo
Found initrd image: /boot/initramfs-genkernel-x86_64-3.3.8-gentoo
Found linux image: /boot/kernel-3.2.12-gentoo
Found initrd image: /boot/initramfs-genkernel-x86_64-3.2.12-gentoo
done
</pre>
}}


[[Category:Bootloaders]]

{{Migrated|originalauthors=Cardoe}}
