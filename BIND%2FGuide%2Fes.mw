<languages />

{{Metadata|abstract=Esta guía le mostrará como instalar y configurar BIND para su dominio y tu red local.}}

Esta guía le mostrará como instalar y configurar BIND para su dominio y su red local

== Introducción ==

Este tutorial le mostrará como instalar y configurar BIND, el servidor DNS más usado en Internet. Configuraremos bind para tu dominio usando diferentes configuraciones, una para tu red local y otra para el resto del mundo. Usaremos vistas para ello. Una vista para tu zona interna (tu red local) y otra vista para tu zona externa (resto del mundo). 

==Datos usados en los ejemplos==

{| class="wikitable" style="text-align: left;" 
|- 
! Palabra clave
! Explicación
! Ejemplo
|- 
| TU_DOMINIO
| Tu nombre de dominio
| gentoo.org
|- 
| TU_IP_PUBLICA
| La ip publica que te entrega el ISP
| 204.74.99.100
|- 
| TU_IP_LOCAL
| La dirección IP local
| 192.168.1.5
|- 
| TU_RED_LOCAL
| La red local
| 192.168.1.0/24
|- 
| SERVIDOR_DNS_ESCLAVO
| La dirección IP del servidor DNS esclavo para tu dominio.
| 209.177.148.228
|- 
| ADMIN
| Los nombres de los administradores del servidor DNS.
| root
|- 
| MODIFICACION
| La fecha de modificación del archivo de zona, con un número adicionado
| 2009062901
|-
|}

== Configurando BIND ==

=== Instalación ===

Primero, Instala {{Package| net-dns/bind}}. 

{{Emerge|net-dns/bind}}

=== Configurando /etc/bind/named.conf ===

Lo primero que debe configurar es {{Path|/etc/bind/named.conf}}. La primera parte de este paso es especificar el directorio raíz de bind, el puerto e IP donde se presentará el servicio, el archivo pid, y una linea para el protocolo IPv6.

{{CodeBox|title=options section|1=
options {
        directory "/var/bind";
  
        listen-on-v6 { none; };
        listen-on port 53 { 127.0.0.1; TU_IP_LOCAL; };
  
        pid-file "/var/run/named/named.pid";
};
}}

La segunda parte de {{Path|named.conf}} es la vista interna usada para nuestra red local. 

{{CodeBox|title=Internal view|1=
view "internal" {
        match-clients { TU_READ_LOCAL; localhost; };
        recursion yes;
  
        zone "TU_DOMINIO" {
                type master;
                file "pri/TU_DOMINIO.internal";
                allow-transfer { any; };
        };
};
}}

La tercera parte de {{Path|named.conf}} es la vista externa usada para resolver nuestro nombre de dominio para el resto del mundo y para resolver todos los otros nombre de dominios para nosotros (y cualquiera que quiera usar nuestro DNS). 

{{CodeBox|title=Vista externa|1=
view "external" {
        match-clients { any; };
        recursion no;
  
        zone "." IN {
                type hint;
                file "named.ca";
        };
  
        zone "127.in-addr.arpa" IN {
                type master;
                file "pri/127.zone";
                allow-update { none; };
                notify no;
        };
  
        zone "TU_DOMINIO" {
                type master;
                file "pri/TU_DOMINIO.external";
                allow-query { any; };
                allow-transfer { SERVIDOR_DNS_ESCLAVO; };
        };
};
}}

The final part of {{Path|named.conf}} is the logging policy. 

{{CodeBox|title=External view|1=
logging {
        channel default_syslog {
                file "/var/log/named/named.log" versions 3 size 5m;
                severity debug;
                print-time yes;
                print-severity yes;
                print-category yes;
        };
       category default { default_syslog; };
};
}}

The {{Path|/var/log/named/}} directory must be exist and belong to <code>named</code>: 

{{RootCmd|mkdir -p /var/log/named/
|chmod 770 /var/log/named/
|touch /var/log/named/named.log
|chmod 660 /var/log/named/named.log
|chown -R named /var/log/named/
|chgrp -R named /var/log/named/}}

=== Creating the internal zone file ===

We use the hostnames and IP adresses of the picture network example. Note that almost all (not all) domain names finish with "." (dot). 

{{FileBox|filename=/var/bind/pri/YOUR_DOMAIN.internal|1=
$TTL 2d
@	IN SOA	ns.YOUR_DOMAIN.	ADMIN.YOUR_DOMAIN. (
	MODIFICATION	; serial
	3h	; refresh
	1h	; retry
	1w	; expiry
	1d )	; minimum
  
YOUR_DOMAIN.		IN MX	0 mail.YOUR_DOMAIN.
YOUR_DOMAIN.		IN TXT	"v=spf1 ip4:YOUR_PUBLIC_IP/32 mx ptr mx:mail.YOUR_DOMAIN ~all"
YOUR_DOMAIN.		IN NS	ns.YOUR_DOMAIN.
YOUR_DOMAIN.		IN NS	SLAVE_DNS_SERVER
www.YOUR_DOMAIN.	IN A	192.168.1.3
ns.YOUR_DOMAIN.		IN A	192.168.1.5
mail.YOUR_DOMAIN.	IN A	192.168.1.3
router.YOUR_DOMAIN.	IN A	192.168.1.1
hell.YOUR_DOMAIN.	IN A	192.168.1.3
heaven.YOUR_DOMAIN.	IN A	192.168.1.5
desktop.YOUR_DOMAIN.	IN A	192.168.1.4
}}

=== Creating the external zone file ===

Here we only have the subdomains we want for external clients (www, mail and ns). 

{{FileBox|filename=/var/bind/pri/YOUR_DOMAIN.external|1=
$TTL 2d
@	IN SOA	ns.YOUR_DOMAIN.	ADMIN.YOUR_DOMAIN. (
	MODIFICATION	;serial
	3h	;refresh
	1h	;retry
	1w	;expiry
	1d )	;minimum
  
YOUR_DOMAIN.		IN MX	0 mail.YOUR_DOMAIN.
YOUR_DOMAIN.		IN TXT	"v=spf1 ip4:YOUR_PUBLIC_IP/32 mx ptr mx:mail.YOUR_DOMAIN ~all"
YOUR_DOMAIN.		IN NS	ns.YOUR_DOMAIN.
YOUR_DOMAIN.		IN NS	SLAVE_DNS_SERVER
www.YOUR_DOMAIN.	IN A	YOUR_PUBLIC_IP
ns.YOUR_DOMAIN.		IN A	YOUR_PUBLIC_IP
mail.YOUR_DOMAIN.	IN A	YOUR_PUBLIC_IP
}}

=== Finishing configuration ===

You'll need to add <code>named</code> to the default runlevel: 

{{RootCmd|rc-update add named default}}

== Configuring clients ==

Now you can use your own DNS server in all machines of your local network to resolve domain names. Modify the {{Path|/etc/resolv.conf}} file of all machines of your local network. 

{{FileBox|filename=/etc/resolv.conf|1=
search YOUR_DOMAIN
nameserver YOUR_DNS_SERVER_IP
}}

Note that YOUR_DNS_SERVER_IP is the same as YOUR_LOCAL_IP we used in this document. In the picture the example is 192.168.1.5. 

== Testing ==

We are able to test our new DNS server. First, we need to start the service. 

{{RootCmd|/etc/init.d/named start}}

Now, we are going to make some <code>host</code> commands to some domains. We can use any computer of our local network to do this test. If you don't have <code>net-dns/host</code> installed you can use <code>ping</code> instead. Otherwise, first run <code>emerge host</code> . 

{{Cmd|host www.gentoo.org|output=<pre>
www.gentoo.org has address 209.177.148.228
www.gentoo.org has address 209.177.148.229
</pre>}}

{{Cmd|host hell|output=<pre>
hell.YOUR_DOMAIN has address 192.168.1.3
</pre>}}

{{Cmd|host router|output=<pre>
router.YOUR_DOMAIN has address 192.168.1.1
</pre>}}


== Protecting the server with iptables ==

If you use iptables to protect your server, you can add these rules for DNS service. 

{{CodeBox|title=Iptables rules|1=
iptables -A INPUT -p udp --sport 53 -m state --state ESTABLISHED,RELATED -j ACCEPT
iptables -A INPUT -p udp --dport 53 -j ACCEPT
iptables -A INPUT -p tcp --dport 53 -j ACCEPT
}}

[[Category:Server]]
[[Category:Daemons]] {{Migrated|originalauthors=Vicente Olivert Riera, nightmorph}}
