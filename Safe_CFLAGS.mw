A recommended default choice of <code>CFLAGS</code>/<code>CXXFLAGS</code> is to use <code>-march=native</code>, which enables auto-detection of the architecture. A possible entry might look like
{{FileBox|filename=/etc/portage/make.conf|lang=bash|1=
CFLAGS="-O2 -pipe -march=native"
CXXFLAGS="${CFLAGS}"
}}

Under certain circumstances it is not possible (or not recommended) to use <code>-march=native</code>, e.g. when using [[distcc]], or if the CPU model is newer than the compiler version. In this case consult the list below for known, safe CPU-specific <code>CFLAGS</code>.

{{Note|Additional information can be found at the [[GCC optimization]] page.}}

{{Warning|Do '''not''' use <code>-march{{=}}native</code> or <code>-mtune{{=}}native</code> in the <var>CFLAGS</var> or <var>CXXFLAGS</var> variables of {{Path|make.conf}} when compiling with {{c|[[Distcc#-march.3Dnative|distcc]]}}.}}

== Finding the CPU == <!--T:6-->

<!--T:7-->
To identify the model of the CPU, take a look inside {{Path|/proc/cpuinfo}} for the "cpu family" and "model" numbers like so:

<!--T:8-->
{{Cmd|grep -m1 -A3 "vendor_id" /proc/cpuinfo}}

<!--T:9-->
Once this information is found match the CPU to one listed on this page in order to find out the suggested "safe" <var>CFLAGS</var>.

<!--T:10-->
Below is a list of [[CFLAGS]] which are to be considered "safe" for the given processors. These are the settings that should be used, especially when unsure which CFLAGS the processor needs.

== x86/amd64 == <!--T:33-->

=== Intel === <!--T:34-->

==== Skylake ==== <!--T:35-->

===== Core i3/i5/i7 & Xeon E3/E5 *V5 ===== <!--T:36-->

<!--T:37-->
<pre>
vendor_id       : GenuineIntel
cpu family      : 6
model           : 94
model name      : Intel(R) Core(TM) i7-6700K CPU @ 4.00GHz
</pre>

<!--T:38-->
{{FileBox|filename=/etc/portage/make.conf|lang=bash|1=
CHOST="x86_64-pc-linux-gnu"
CFLAGS="-march=broadwell -O2 -pipe"
CXXFLAGS="${CFLAGS}"
}}

<!--T:39-->
{{Note|''Skylake'' march support will be introduced with [https://gcc.gnu.org/gcc-6/changes.html GCC 6]. As Gentoo is still using an earlier version of GCC, we use ''-march{{=}}broadwell''.
You can also find your [https://wiki.gentoo.org/wiki/Safe_CFLAGS#Find_CPU-specific_options cpu-specific] options manually and set them accordingly. For example, you might be able to add "-mabm -mavx256-split-unaligned-load -mavx256-split-unaligned-store -mrtm" as well.}}
{{Note|Even though they fit the family and model, this set of CFLAGS does NOT work for Skylake Pentium CPUs (e. g. G4400) producing invalid code. ''-march{{=}}native'' works.}}

==== Haswell ==== <!--T:35-->

===== Core i3/i5/i7 & Xeon E3/E5/E7 *V3 ===== <!--T:36-->

<!--T:37-->
<pre>
vendor_id	: GenuineIntel
cpu family	: 6
model		: 60
model name	: Intel(R) Xeon(R) CPU E3-1271 v3 @ 3.60GHz
…
model           : 60
model name      : Intel(R) Core(TM) i7-4770 CPU @ 3.40GHz
</pre>

<!--T:38-->
{{FileBox|filename=/etc/portage/make.conf|lang=bash|1=
CHOST="x86_64-pc-linux-gnu"
CFLAGS="-march=haswell -O2 -pipe"
CXXFLAGS="${CFLAGS}"
}}

==== Ivy Bridge ==== <!--T:40-->

===== Core i3/i5/i7 & Xeon E3/E5/E7 *V2 ===== <!--T:41-->

<!--T:42-->
<pre>
vendor_id       : GenuineIntel
cpu family      : 6
model           : 58
model name      : Intel(R) Core(TM) i7-3610QM CPU @ 2.30GHz 
</pre>

<!--T:43-->
{{FileBox|filename=/etc/portage/make.conf|lang=bash|1=
CHOST="x86_64-pc-linux-gnu"
CFLAGS="-march=ivybridge -O2 -pipe"
CXXFLAGS="${CFLAGS}"
}}

===== Pentium ===== <!--T:44-->

<!--T:45-->
<pre>
vendor_id	: GenuineIntel
cpu family	: 6
model		: 58
model name	: Intel(R) Pentium(R) CPU G2020 @ 2.90GHz
</pre>

<!--T:46-->
{{FileBox|filename=/etc/portage/make.conf|lang=bash|1=
CHOST="x86_64-pc-linux-gnu"
CFLAGS="-march=ivybridge -mno-avx -mno-aes -mno-rdrnd -O2 -pipe"
CXXFLAGS="${CFLAGS}"
}}

==== Sandy Bridge ==== <!--T:47-->

===== Core i3/i5/i7 & Xeon E3/E5/E7 ===== <!--T:48-->

<!--T:49-->
<pre>
vendor_id	: GenuineIntel
cpu family	: 6
…
model		: 42
model name	: Intel(R) Core(TM) i5-2400 CPU @ 3.10GHz
…
model		: 45
model name	: Intel(R) Core(TM) i7-3930K CPU @ 3.20GHz
… 
model		: 42
model name	: Intel(R) Xeon(R) CPU E31245 @ 3.30GHz
… 
model           : 45
model name      : Intel(R) Xeon(R) CPU E5-2407 0 @ 2.20GHz
</pre>

<!--T:50-->
{{FileBox|filename=/etc/portage/make.conf|lang=bash|1=
CHOST="x86_64-pc-linux-gnu"
CFLAGS="-march=sandybridge -O2 -pipe"
CXXFLAGS="${CFLAGS}"
}}

===== Pentium ===== <!--T:51-->
<pre>
vendor_id	: GenuineIntel
cpu family	: 6
model		: 42
model name	: Intel(R) Pentium(R) CPU B960 @ 2.20GHz
</pre>

<!--T:52-->
{{FileBox|filename=/etc/portage/make.conf|lang=bash|1=
CHOST="x86_64-pc-linux-gnu"
CFLAGS="-march=sandybridge -mno-avx -mno-aes -mno-rdrnd -O2 -pipe"
CXXFLAGS="${CFLAGS}"
}}

==== Nehalem ==== <!--T:53-->

===== Core i3/i5/i7 ===== <!--T:54-->

<!--T:55-->
<pre>
vendor_id	: GenuineIntel
cpu family	: 6
model		: 30
model name	: Intel(R) Core(TM) i5-750 CPU @ 2.66GHz
</pre>

<!--T:56-->
{{FileBox|filename=/etc/portage/make.conf|lang=bash|1=
CHOST="x86_64-pc-linux-gnu"
CFLAGS="-march=nehalem -O2 -pipe"
CXXFLAGS="${CFLAGS}"
}}

==== Westmere ==== <!--T:53-->

===== Core i3/i5/i7 ===== <!--T:54-->

<!--T:55-->
<pre>
vendor_id	: GenuineIntel
cpu family	: 6
model		: 37
model name	: Intel(R) Core(TM) i5-650 CPU @ 3.20GHz
</pre>

<!--T:56-->
{{FileBox|filename=/etc/portage/make.conf|lang=bash|1=
CHOST="x86_64-pc-linux-gnu"
CFLAGS="-march=westmere -O2 -pipe"
CXXFLAGS="${CFLAGS}"
}}

==== Intel Core ==== <!--T:57-->

<!--T:58-->
<pre>
vendor_id       : GenuineIntel
cpu family      : 6
…
model		: 15
model name	: Intel(R) Core(TM)2 Duo CPU     T7500  @ 2.20GHz
…
model           : 15
model name      : Intel(R) Xeon(R) CPU            3040  @ 1.86GHz
</pre>

<!--T:59-->
{{FileBox|filename=/etc/portage/make.conf|lang=bash|1=
CHOST="x86_64-pc-linux-gnu"
CFLAGS="-march=core2 -O2 -pipe"
CXXFLAGS="${CFLAGS}"
}}

==== Older microarchitecture ==== <!--T:60-->

===== Pentium M (Dothan) ===== <!--T:61-->

<!--T:62-->
<pre>
vendor_id	: GenuineIntel
cpu family	: 6
model		: 13
model name	: Intel(R) Pentium(R) M processor 2.13GHz
</pre>

<!--T:63-->
{{FileBox|filename=/etc/portage/make.conf|lang=bash|1=
CHOST="i686-pc-linux-gnu"
CFLAGS="-O2 -march=pentium-m -pipe -fomit-frame-pointer"
CXXFLAGS="${CFLAGS}"
}}

===== Pentium 4 (Prescott) =====
* 64-bit capable models: 5x1, 505, 505J, 5x6, 517, 519K, 524, 541, 6xx, and the 3.73(3)GHz Pentium 4 Extreme Edition.
{{Note|Check the /proc/cpuinfo for the lm flag to detect 64-bit CPUs:
{{Cmd|grep lm /proc/cpuinfo}}}}
<pre>
vendor_id	: GenuineIntel
cpu family	: 15
model		: 4
model name	: Intel(R) Pentium(R) 4 CPU XXXGHz
</pre>

{{FileBox|filename=/etc/portage/make.conf|lang=bash|1=
CHOST="x86_64-pc-linux-gnu"
CFLAGS="-O2 -march=nocona -pipe"
CXXFLAGS="${CFLAGS}"
}}

* All other Prescotts
<pre>
vendor_id	: GenuineIntel
cpu family	: 15
model		: 3
model name	: Intel(R) Pentium(R) 4 CPU XXXGHz
</pre>

{{FileBox|filename=/etc/portage/make.conf|lang=bash|1=
CHOST="i686-pc-linux-gnu"
CFLAGS="-O2 -march=prescott -pipe"
CXXFLAGS="${CFLAGS}"
}}

=== AMD === <!--T:64-->

==== A4/A6/A8-XXXX / XXXXM ==== <!--T:65-->

<!--T:66-->
<pre>
vendor_id	: AuthenticAMD
cpu family	: 18
model		: 1
model name	: AMD A8-3500M APU with Radeon(tm) HD Graphics
</pre>

<!--T:67-->
{{FileBox|filename=/etc/portage/make.conf|lang=bash|1=
CHOST="x86_64-pc-linux-gnu"
CFLAGS="-O2 -march=amdfam10 -mcx16 -mpopcnt -pipe"
CXXFLAGS="${CFLAGS}"
}}

==== FX-XXXX ==== <!--T:68-->

<!--T:69-->
<pre>
vendor_id	: AuthenticAMD
cpu family	: 21
model		: 1
model name	: AMD FX(tm)-8150 Eight-Core Processor
</pre>

<!--T:70-->
Make sure and check the number listed by <code>model</code> on your system, the -march flag should be bdverX where X is the model number.

<!--T:71-->
Due to the FPU design of the Bulldozer architecture, -mprefer-avx128 gives better FPU preformance at the cost of precision.

<!--T:104-->
The -mvzeroupper switch will give much less of a preformance penalty when using both SSE and AVX, it isn't much of a performance boost for most apps, but can provide a significant improvement when used with stuff like {{Package|media-video/ffmpeg}}, {{Package|net-misc/bfgminer}} or some apps in games-emulation that have some sections coded in assembly.

<!--T:72-->
{{FileBox|filename=/etc/portage/make.conf|lang=bash|1=
CHOST="x86_64-pc-linux-gnu"
CFLAGS="-O2 -march=bdver1 -mprefer-avx128 -mvzeroupper -pipe"
CXXFLAGS="${CFLAGS}"
}}

==== Geode  LX==== <!--T:73-->
<pre>
vendor_id	: AuthenticAMD
cpu family	: 5
model		: 10
model name	: Geode(TM) Integrated Processor by AMD PCS
</pre>

<!--T:74-->
{{FileBox|filename=/etc/portage/make.conf|lang=bash|1=
CHOST="i486-pc-linux-gnu"
CFLAGS="-Os -pipe -march=geode -mmmx -m3dnow -fno-align-jumps -fno-align-functions -fno-align-labels -fno-align-loops -fomit-frame-pointer"
CXXFLAGS="${CFLAGS}"
}}

== arm == <!--T:75-->
{{Note|To identify the respective ARM core of the SoC on your board, [https://en.wikipedia.org/wiki/List_of_ARM_microarchitectures List of ARM microarchitectures]  and [https://en.wikipedia.org/wiki/List_of_applications_of_ARM_cores List of applications of ARM cores] on Wikipedia may help.}}

=== Cortex-A === <!--T:76-->
==== ARMv7-A/Cortex-A9 MPCore ==== <!--T:77-->

===== with optional VFPv3 FPU ===== <!--T:78-->

<!--T:79-->
<pre>
processor       : 0
model name      : ARMv7 Processor rev 0 (v7l)
BogoMIPS        : 2.00
Features        : half thumb fastmult vfp edsp vfpv3 vfpv3d16 tls 
CPU implementer : 0x41
CPU architecture: 7
CPU variant     : 0x1
CPU part        : 0xc09
CPU revision    : 0

processor       : 1
model name      : ARMv7 Processor rev 0 (v7l)
BogoMIPS        : 2.00
Features        : half thumb fastmult vfp edsp vfpv3 vfpv3d16 tls 
CPU implementer : 0x41
CPU architecture: 7
CPU variant     : 0x1
CPU part        : 0xc09
CPU revision    : 0

Hardware        : NVIDIA Tegra SoC (Flattened Device Tree)
Revision        : 0000
Serial          : 0000000000000000
</pre>

<!--T:80-->
{{FileBox|filename=/etc/portage/make.conf|lang=bash|1=
CHOST="armv7a-hardfloat-linux-gnueabi"
CFLAGS="-O2 -march=armv7-a -mtune=cortex-a9 -mfpu=vfpv3-d16 -mfloat-abi=hard -pipe -fomit-frame-pointer"
CXXFLAGS="${CFLAGS}"
}}
{{Note|1=This ARM core (equipped with the optional vfpv3d16 FPU but missing the NEON extension) is used in the Toshiba AC100/Dynabook AZ/Compal Paz00 Board.}}

==== ARMv8-A/AArch32 (BCM2837) ==== <!--T:77-->

===== with neon FPU ===== <!--T:78-->

<!--T:79-->
<pre>
processor	: 0-3
model name	: ARMv7 Processor rev 4 (v7l)
BogoMIPS	: 38.40
Features	: half thumb fastmult vfp edsp neon vfpv3 tls vfpv4 idiva idivt vfpd32 lpae evtstrm crc32 
CPU implementer	: 0x41
CPU architecture: 7
CPU variant	: 0x0
CPU part	: 0xd03
CPU revision	: 4

Hardware	: BCM2709
Revision        : 0000
Serial          : 0000000000000000
</pre>

<!--T:80-->
{{FileBox|filename=/etc/portage/make.conf|lang=bash|1=
CHOST="armv7a-hardfloat-linux-gnueabi"
CFLAGS="-O2 -pipe -march=armv7-a -mfpu=neon-vfpv4 -mfloat-abi=hard"
# Experimental AArch64 : -march=armv8-a+crc
CXXFLAGS="${CFLAGS}"
}}
{{Note|1=This is the Broadcom chip used in the Raspberry Pi 3.}}

=== ARM11 === <!--T:81-->

==== ARMv6/ARM1176JZF-S ==== <!--T:82-->

<pre>
processor	: 0
model name	: ARMv6-compatible processor rev 7 (v6l)
BogoMIPS	: 697.95
Features	: half thumb fastmult vfp edsp java tls 
CPU implementer	: 0x41
CPU architecture: 7
CPU variant	: 0x0
CPU part	: 0xb76
CPU revision	: 7

Hardware	: BCM2835
Revision	: 0000
Serial		: 000000000XXXXXXX
</pre>

{{FileBox|filename=/etc/portage/make.conf|lang=bash|1=
CHOST="armv6j-hardfloat-linux-gnueabi"
CFLAGS="-O2 -pipe -mcpu=arm1176jzf-s -mfpu=vfp -mfloat-abi=hard"
CXXFLAGS="${CFLAGS}"
}}
{{Note|1=This ARM core is used in the first generation of the Raspberry Pi.}}

==== ARMv6/ARM1136JF-S ==== <!--T:83-->

<!--T:84-->
<pre>
Processor       : ARMv6-compatible processor rev 5 (v6l)
BogoMIPS        : 791.34
Features        : swp half thumb fastmult vfp edsp java 
CPU implementer : 0x41
CPU architecture: 6TEJ
CPU variant     : 0x1
CPU part        : 0xb36
CPU revision    : 5

Hardware        : IMAPX200
Revision        : 0000
Serial          : 0000000000000000
</pre>

<!--T:85-->
{{FileBox|filename=/etc/portage/make.conf|lang=bash|1=
CHOST="armv6j-hardfloat-linux-gnueabi"
CFLAGS="-Os -march=armv6j -mcpu=arm1136jf-s -mfpu=vfp -mfloat-abi=hard -pipe -fomit-frame-pointer"
CXXFLAGS="${CFLAGS}"
}}

== ppc/ppc64 == <!--T:86-->

<!--T:87-->
{{Note|1=<code>-march=native</code> almost never works on PowerPC.}}

=== POWER8 === <!--T:88-->
<pre>
processor       : 0
cpu             : POWER8E (raw), altivec supported
clock           : 3026.000000MHz
revision        : 2.1 (pvr 004b 0201)

timebase        : 512000000
platform        : pSeries
model           : IBM pSeries (emulated by qemu)
machine         : CHRP IBM pSeries (emulated by qemu)
</pre>
<!--T:91-->
{{Note|1=Currently Gentoo does not support POWER8, but safe CFLAGS for it would look like the following.}}
<!--T:90-->
{{FileBox|filename=/etc/portage/make.conf|lang=bash|1=
CHOST="powerpc64le-linux-gnu"
CFLAGS="-mcpu=power8 -mtune=power8 -O2 -pipe -mabi=elfv2 -mabi=altivec -maltivec"
CXXFLAGS="${CFLAGS}"
}}

=== Cell === <!--T:88-->

<!--T:89-->
<pre>
processor	: 0
cpu		: Cell Broadband Engine, altivec supported
clock		: 3192.000000MHz
revision	: 5.1 (pvr 0070 0501)

processor	: 1
cpu		: Cell Broadband Engine, altivec supported
clock		: 3192.000000MHz
revision	: 5.1 (pvr 0070 0501)

timebase	: 79800000
platform	: PS3
model		: SonyPS3
</pre>

<!--T:90-->
{{FileBox|filename=/etc/portage/make.conf|lang=bash|1=
CHOST="powerpc-unknown-linux-gnu"
CFLAGS="-mcpu=cell -mtune=cell -O2 -pipe -mabi=altivec -maltivec"
CXXFLAGS="${CFLAGS}"
}}

<!--T:91-->
{{Note|1=GCC's -mspe and -mabi=spe options are not targetting PS3 systems and IBM Cell. Instead, those options are dedicated to IBM e500. More info: https://lists.debian.org/debian-devel/2011/06/msg00592.html https://wiki.debian.org/PowerPCSPEPort}}

=== G4 ===
==== PPC 7447A ====

<pre>
processor	: 0
cpu		: 7447A, altivec supported
clock		: 1666.666000MHz
revision	: 1.5 (pvr 8003 0105)
bogomips	: 33.28
timebase	: 8320000
platform	: PowerMac
model		: PowerBook5,9
machine		: PowerBook5,9
motherboard	: PowerBook5,9 MacRISC3 Power Macintosh 
detected as	: 287 (PowerBook G4 17")
pmac flags	: 00000018
L2 cache	: 512K unified
pmac-generation	: NewWorld
</pre>

{{FileBox|filename=/etc/portage/make.conf|lang=bash|1=
CHOST="powerpc-unknown-linux-gnu"
CFLAGS="-mcpu=7450 -mtune=7450 -O2 -maltivec -mabi=altivec -fno-strict-aliasing -pipe"
CXXFLAGS="${CFLAGS}"
}}

=== G3 (PPC 7XX) === <!--T:92-->

<!--T:93-->
<pre>
processor       : 0
cpu             : 740/750
clock           : 400.000000MHz
revision        : 131.0 (pvr 0008 8300)
bogomips        : 49.93
timebase        : 24966218
platform        : PowerMac
model           : PowerBook3,1
machine         : PowerBook3,1
motherboard     : PowerBook3,1 MacRISC2 MacRISC Power Macintosh
detected as     : 70 (PowerBook Pismo)
pmac flags      : 0000001f
L2 cache        : 1024K unified
pmac-generation : NewWorld
</pre>

<!--T:94-->
{{FileBox|filename=/etc/portage/make.conf|lang=bash|1=
CHOST="powerpc-unknown-linux-gnu"
CFLAGS="-mcpu=750 -Os -pipe -fno-strict-aliasing"
CXXFLAGS="${CFLAGS}"
}}

== m68k == <!--T:95-->

== See also ==

* [[GCC optimization]]
* [[Project:Quality_Assurance/Backtraces|Gentoo documentation page on backtraces]]
* [[Handbook:Parts/Installation/Stage#CFLAGS_and_CXXFLAGS]]

== External resources ==

* [http://www.gnu.org/software/gcc/onlinedocs GCC Online Documentation] on GNU.org
* [http://software.intel.com/en-us/blogs/2012/09/26/gcc-x86-performance-hints GCC x86 performance hints]

[[Category:Portage]]
