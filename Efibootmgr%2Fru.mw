<languages/>
{{InfoBox stack
|{{InfoBox github|rhinstaller/efibootmgr|header=true}}
}}

{{Metadata|abstract=Приложение efibootmgr взаимодействует с прошивкой UEFI в системе, и это популярное приложение для изменения настроек EFI с целью создания и изменения загрузочных записей, с помощью которых можно загрузить Linux (или другие операционные системы).}}

Приложение {{c|efibootmgr}} взаимодействует с прошивкой UEFI в системе, и это популярное приложение для изменения настроек EFI с целью создания и изменения загрузочных записей, с помощью которых можно загрузить Linux (или любую другую EFI операционную систему).

Приложение {{Package|sys-boot/efibootmgr}} это '''не''' загрузчик. Это утилита, которая взаимодействует с прошивкой EFI в системе, которая работает в качестве загрузчика. С помощью {{c|efibootmgr}} можно создавать, менять местами, обновлять и удалять загрузочные записи.

== Установка ==

=== Ядро ===

Для того чтобы загрузится непосредственно из UEFI в ядре должна быть включена поддержка <var>CONFIG_EFI</var>, <var>CONFIG_EFI_STUB</var> и <var>CONFIG_EFI_VARS</var>:

{{KernelBox|title=Включение поддержки EFI stub|1=
Processor type and features  --->
    [*] EFI runtime service support 
    [*]   EFI stub support
Firmware Drivers  --->
   EFI (Extensible Firmware Interface) Support  --->
       <*> EFI Variable Support via sysfs
}}

=== Emerge ===

У пакета {{Package|sys-boot/efibootmgr}} нет каких-либо USE-флагов. Все что нужно сделать - это установить его:

{{Emerge|sys-boot/efibootmgr}}

== Конфигурация ==

=== EFI vars ===

Для того, чтобы успешно использовать {{c|efibootmgr}}, должна быть доступна файловая система переменных EFI. Следовательно система должна быть уже загружена в режиме EFI (а не через BIOS в режиме MBR), так как иначе переменные EFI сами по себе не будут доступны. Если система загружена в режиме MBR, перезагрузитесь и настройте все необходимое для загрузки EFI режиме. Обычно, для этого нужно, либо настроить встроенное ПО (BIOS), либо выбор в меню загрузки запись содержащую EFI.

Когда система загружена в EFI режиме запустите следующую команду, чтобы проверить доступность efivarfs:

{{RootCmd|mount {{!}} grep efivars|output=<pre>
efivarfs on /sys/firmware/efi/efivars type efivarfs (rw,nosuid,nodev,noexec,relatime)
</pre>}}

Если данная файловая система не смонтирована (она должна быть смонтирована через скрипт инициализации {{Path|sysfs}}), можно смонтировать ее вручную следующей командой:

{{RootCmd|mount -t efivars efivars /sys/firmware/efi/efivars}}

See [https://github.com/OpenRC/openrc/commit/3fd3bfc76dccc3752f4af949ad4076dab26357fb#diff-8312ad0561ef661716b48d09478362f3R6 OpenRC-0.28 news].

== Preconditions ==

If an EFI System Partition (ESP) does not exist, one needs to be created, see [[EFI System Partition]]

=== Работа с загрузочными записями EFI ===

==== Получение списка загрузочных записей ====

Чтобы получить список текущих загрузочных записей, используйте опцию <code>--verbose (-v)</code>:

{{RootCmd|efibootmgr -v|output=<pre>
BootCurrent: 0002
Timeout: 3 seconds
BootOrder: 0003,0003,0002,0000,0004
Boot0000* CD/DVD Drive  BIOS(3,0,00)
Boot0001* Hard Drive    BIOS(2,0,00)
Boot0002* Gentoo        HD(1,800,61800,6d98f360-cb3e-4727-8fed-5ce0c040365d)File(\EFI\boot\bootx64.efi)
Boot0003* Hard Drive    BIOS(2,0,00)P0: ST1500DM003-9YN16G
</pre>}}

==== Создание загрузочной записи ====

Чтобы создать загрузочную запись EFI, нужно передать несколько аргументов программе {{c|efibootmgr}}:

* <code>--create (-c)</code> чтобы создать новую запись;
* <code>--part (-p)</code> за которой следует номер раздела, на котором находится системный раздел EFI;
* <code>--disk (-d)</code> за которой следует диск, на котором находится системный раздел EFI;
* <code>--label (-L)</code> за которой следует метка, которую необходимо использовать для загрузочной записи;
* <code>--loader (-l)</code> за которой следует путь образа EFI для загрузки

{{Important|Путь к образу EFI для загрузки ''должен'' в качестве разделителя в путях содержать {{Key|\}} (обратный слеш) вместо {{Key|/}} (передний слеш).}}

Например:

{{RootCmd|efibootmgr -c -d /dev/sda -p 2 -L "Gentoo" -l "\efi\boot\bootx64.efi"}}

=== Deleting a boot entry ===

Перед удалением записи, сначала определите, какой ID был у записи.

Чтобы удалить запись Gentoo, которая была показана выше (и имеет идентификатор ''Boot0002''), попросите {{c|efibootmgr}} удалить запись с идентификатором 2, передав в качестве аргументов следующие значения: <code>--bootnum (-b)</code> это идентификатор, и опция <code>--delete-bootnum (-B)</code>, означающая, что нужно удалить запись:

{{RootCmd|efibootmgr -b 2 -B}}

== Удаление ==

=== Unmerge ===

{{Unmerge|sys-boot/efibootmgr}}

== Смотрите также ==

* Статья [[EFI_stub_kernel|EFI stub kernel]] объясняет, как настроить ядро Linux, чтобы его можно было загрузить непосредственно из EFI
* [[Handbook:AMD64/Installation/Bootloader/ru#Альтернативный метод 2: efibootmgr|Альтернативный метод 2: efibootmgr]] в Gentoo Handbook
