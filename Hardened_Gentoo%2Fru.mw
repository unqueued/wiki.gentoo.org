<languages />
Gentoo Hardened это проект Gentoo, который предоставляет вам несколько дополнительных сервисов безопасности, по сравнению с обычной установкой Gentoo Linux. Хотя каждый из таких сервисов может быть выбран по отдельности, Gentoo Hardened позволяет использовать несколько таких опций в комплексе и поддерживает PaX, grSecurity, SELinux, TPE, и многое другое.

Запускаете ли вы сервер, имеющий выход в Интернет, или рабочую станцию, принимая во внимание множество угроз, вы можете захотеть улучшить защищенность вашей системы больше, чем просто автоматически применить последние патчи безопасности. Если вы хотите ''защитить'' систему, это значит, что вы принимаете дополнительные контрмеры против атак и других рисков, и обычно это означает некоторый набор действий, которые вы выполняете над системой.

Gentoo Hardened включает в себя несколько активных проектов, которые помогут вам дополнительно защитить вашу систему Gentoo с помощью
* Включения специфических опций в наборе утилит для сборки (то есть, компиляторе, линковщике, и т.д.), например, заставив компьютер выдавать только исполняемые файлы, которые работают независимо от адреса загрузки (PIE), включив защиту от разрушения стека, а также проверку буферов во время компиляции.
* Включения расширений PaX для ядра Linux, что дает дополнительные меры защиты, например, случайное распределение адресного пространства и неисполняемую память.
* Включения расширений grSecurity для ядра Linux, например, дополнительные ограничения chroot, дополнительный аудит, ограничения процессов, и т.д.
* Включения расширений [[Hardened Gentoo/SELinux|SELinux]] в ядре Linux, что позволяет вам использовать систему мандатного управления доступом, что улучшает стандартные ограничения разрешений Linux.
* Включения технологий, относящихся к [[Integrity|целостности]], например, архитектуры измерения целостности, для того, чтобы сделать систему невосприимчивой к несанкционированному изменению.

Естественно, существуют и необходимые утилиты для управления всеми этими расширениями.

== Переключение на защищенный профиль ==

Выберите защищенный (hardened) [[profile|профиль]], чтобы работа с пакетами проводилась защищенным способом:

{{RootCmd|eselect profile list}}
{{RootCmd|eselect profile set [номер hardened профиля]}}
{{RootCmd|source /etc/profile}}

Выбрав определенный профиль, вы, тем самым, выполнили некоторые настройки по умолчанию для вашей системы (маски, USE флаги, и так далее). Это применяется для многих пакетов, включая и набор утилит для сборки. Этот набор утилит используется для сборки и компиляции ваших программ, и включает: набор компиляторов GNU (GCC), binutils (компоновщик, и т.д.), а также библиотеку С GNU (glibc). Пересобрав этот набор, эти новые настройки применятся к нему, что позволит все будущие "компиляции пакетов" проводить в защищенном режиме.

{{emerge|params=--oneshot|binutils gcc virtual/libc}}

The above command rebuilt GCC, which can now be used to compile hardened software.  Make sure that the hardened option is selected for GCC.

{{RootCmd|gcc-config -l
|output=<pre>
[1] i686-pc-linux-gnu-4.5.3 *
[2] i686-pc-linux-gnu-4.5.3-hardenednopie
[3] i686-pc-linux-gnu-4.5.3-hardenednopiessp
[4] i686-pc-linux-gnu-4.5.3-hardenednossp
[5] i686-pc-linux-gnu-4.5.3-vanilla
</pre>}}

In the example output above, the hardened GCC profile is the one without a suffix. If you want to disable PIE or SSP, choose the relevant '''hardenedno'''('''pie'''|'''ssp''') or both, '''hardenednopiessp'''. The '''vanilla''' profile is of course the one with hardening disabled. Finally source your new profile settings:

{{RootCmd|source /etc/profile}}

If you use the "prelink" package, remove it, since it isn't compatible with the hardened profile:

{{emerge|params=--depclean|prelink}}

Now you can reinstall all packages with your new hardened toolchain:

{{emerge|params=--emptytree --verbose|@world}}

Install hardened kernel sources, so that the kernel will *manage your running system* in a hardened way (especially using PaX):

{{emerge|hardened-sources}}

Now configure/compile the sources and add the new kernel to your boot manager (ie., GRUB).

== Tips & Tricks ==

=== Hardened Gentoo/Grsecurity chroot ===

If you want to chroot to a copied environment where the CONFIG_GRKERNSEC_CHROOT is enabled you must use the cd grub and change the root(cd) kernel(cd) initrd(cd) setting to from (cd) to (hdx,y).

Now you can install the grub environment.

=== Per Package Hardening Settings ===

{{Warning|This method is not supported by Gentoo.}}

Changing the GCC profile to deal with specific packages can be a pain. A way to avoid this is to set per-package C(XX)FLAGS using [[:/etc/portage/env|package.env]]. Create the file /etc/portage/env/nossp and add to that:

{{File|/etc/portage/env/nossp|Disable SSP|<pre>
CFLAGS="${CFLAGS} -fno-stack-protector"
CXXFLAGS="${CXXFLAGS} -fno-stack-protector"
</pre>}}

To allow for disabling PIE, create and add to {{Path|/etc/portage/env/nopie}}:

{{File|/etc/portage/env/nopie|Disable PIE|<pre>
CFLAGS="${CFLAGS} -nopie"
CXXFLAGS="${CXXFLAGS} -nopie"
LDFLAGS="${LDFLAGS} -nopie"
</pre>}}

Finally add the package you want to disable either PIE or SSP for to /etc/portage/package.env and the relevant /etc/portage/env/<filename>, for this example {{Package|sys-libs/zlib}} is used here:

{{File|/etc/portage/package.env|Disable PIE for sys-libs/zlib|<pre>
sys-libs/zlib nopie
</pre>}}

== See also ==

For more information, check out the following resources:
* [http://www.gentoo.org/proj/en/hardened/ Gentoo Hardened Project]
* [http://www.gentoo.org/proj/en/hardened/selinux/ Gentoo Hardened SELinux Project]
* http://www.gentoo.org/proj/en/hardened/grsecurity.xml
* http://www.gentoo.org/proj/en/hardened/pax-quickstart.xml

== External resources ==

* http://www.rockfloat.com/howto/gentoo-hardened.html#kernel


[[Category:Security]]
