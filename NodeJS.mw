{{Warning|This is a work in progress!}}

== About Installation ==

This guide will walk through installing NodeJS behind Nginx and using monic to keep node instances alive. Since NodeJS is a single-process application, we will launch multiple instances of the application and load balance using Nginx.

== Install Packages ==

{{Emerge|monit nginx nodejs}}

=== npm ===

Node.js has a [[USE_flag|USE flag]] to include npm, the Node.js package manager. The current stable version of Node.js, 4.x.x, comes with npm 2.x.x, which might be undesirable. For npm 3.x.x, use Node.js 6.x.x (the next LTS release) or later. You can configure which version to pull in by setting keywords, e.g.:
{{FileBox|filename=/etc/portage/package.keywords/nodejs|1=~net-libs/nodejs-6.9.1}}
Also see [[Knowledge_Base:Accepting_a_keyword_for_a_single_package]].

== Configure Monit ==

{{FileBox|filename=/etc/monit.d/my-app|title=Auto restart NodeJS App|1=
check process mysql with pidfile /var/run/my-app/mysqld.pid
    start program = "/bin/bash -c 'rc-service mysql start'"
    stop program  = "/bin/bash -c 'rc-service mysql stop'"
}}

== Configure Nginx ==

{{FileBox|filename=/etc/nginx/nginx.conf|title=Nginx Config|1=
http {
    upstream myapp1 {
        least_conn;
        server srv1.example.com;
        server srv2.example.com;
        server srv3.example.com;
    }

    server {
        listen 80;

        location / {
            proxy_pass http://myapp1;
        }
    }
}
}}
