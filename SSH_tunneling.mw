You need to log in to a server on an internal network, but you can only access the internal network through a gateway machine. If both these machines are running [[SSH]], it is convenient to set up an SSH [[Wikipedia:Tunneling protocol|tunnel]].

== Usage ==

Begin with creating a ssh tunneling session:

{{Cmd|ssh -f <GATEWAY_USERNAME@>GATEWAY -L localhost:CPORT:SERVER:SPORT -N}}

The <code>-f</code> option instructs the ssh instance to go into the background, and <code>-N</code> instructs it to not launch a shell. Followed by:

{{Cmd|ssh -p CPORT <SUSERNAME@>localhost}}

The variables above represent:

; <var>GATEWAY</var> : The hostname/IP address of the gateway machine.
; <var>GATEWAY_USERNAME</var> : The username on the gateway (optional if this username is the same as on the client).
; <var>SERVER</var> : The hostname/IP address of the server you wish to log into.
; <var>SUSERNAME</var> : The username on the server (optional if this username is the same as on the client).
; <var>SPORT</var> : The port number on which the server SSH daemon is listening, by default 22.
; <var>CPORT</var> : The port number of your choosing on which the tunnel will be receiving connections on the client machine (should be greater than 1024 unless you are invoking as root).

You can [[Wikipedia:Secure copy|scp]] files from the server as you would normally by specifying the tunnel port:

{{Cmd|scp -P CPORT localhost:REMOTEPATH LOCALPATH}}

Similarly for sending files to the server:

{{Cmd|scp -P CPORT LOCALPATH localhost:REMOTEPATH}}

=== Tips ===

In order to make this tunneling process less onerous in the future:

* Set these commands as [[Wikipedia:Alias_%28command%29|shell aliases]] (in [[Bash]], usually in {{Path|~/.bashrc}}).
* To avoid typing passwords, copy the client key to the gateway, and the client and gateway keys to the server.
* If you rely upon keeping an unattended connection alive which may become dropped due to timeouts, consider altering the various TCP keepalive settings in the client and server configurations. Perhaps the most robust solution is to install a connection watchdog such as {{Package|net-misc/autossh}} which will babysit an ssh session and restart it if necessary.

== X11 forwarding ==

To enable X11 forwarding, first the <var>X11Forwarding</var> and <var>ForwardX11</var> options must be set to <code>yes</code> for both the X client and server being connected to respectively. In your SSH client connection, add the <code>-Y</code> option to the second invocation above, and optionally the <code>-C</code> switch to also enable compression i.e:

{{Cmd|ssh -YC -p CPORT <SUSERNAME@>localhost}}

The following is required for the forwarding of X11 connections from the remote server to local client to work:

* The SSH daemon on the gateway machine must have TCP forwarding must be enabled, otherwise X11 connections won't be forwarded:

: {{FileBox|filename=/etc/ssh/sshd_config|title=On the gateway|1=
AllowTcpForwarding yes
}}

* The {{c|xauth}} tool must be present on the local X server. Install {{Package|net-misc/openssh}} with the <code>X</code> USE flag set to pull it in or install {{Package|x11-apps/xauth}}.

* X11 forwarding must be enabled in the remote server SSH daemon configuration:

: {{FileBox|filename=/etc/ssh/sshd_config|title=On the server|1=
X11Forwarding yes
}}

== See also ==

* [[SSH jump host]]

[[Category:SSH]]
