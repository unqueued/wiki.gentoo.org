{{InfoBox stack
|{{InfoBox homepage|https://linuxcontainers.org/lxd/introduction/|header=true}}
}}

'''LXD''' is the Linux Containers Daemon, and the successor to LXC. Though both are developed concurrently by St√©phane Graber (and Canonical), LXD is still under active development and is currently suitable for evaluation use only.

For those new to container technology, it would be good to first read the "Virtualization Concepts" section of the [[LXC]] article.

Key features of LXD include:

* Prefers to launch unprivileged containers (secure by default).
* A command-line client (lxc) interacts with a daemon (lxd).
* Configuration is made easier through cascading profiles.
* Configuration changes are performed with the lxc command (no more config files).
* Multiple hosts can be federated together (with a certificate-based trust system).
* A federated setup means that containers can be launched on remote machines and live-migrated between hosts (using CRIU technology).

== Quick start (single host) ==

=== Prepare the system ===

==== Kernel configuration ====

It is a good idea to have most kernel flags required by {{Package|app-emulation/lxc}} and {{Package|sys-process/criu}}.

{{RootCmd|ebuild /usr/portage/app-emulation/lxc/lxc-1.1.2.ebuild setup|output=<pre>
...
 * Checking for suitable kernel configuration options...
 *   CONFIG_NETLINK_DIAG:  needed for lxc-checkpoint
 *   CONFIG_PACKET_DIAG:  needed for lxc-checkpoint
 *   CONFIG_INET_UDP_DIAG:  needed for lxc-checkpoint
 *   CONFIG_INET_TCP_DIAG:  needed for lxc-checkpoint
 *   CONFIG_UNIX_DIAG:  needed for lxc-checkpoint
 *   CONFIG_CHECKPOINT_RESTORE:  needed for lxc-checkpoint
 * Please check to make sure these options are set correctly.
 * Failure to do so may cause unexpected problems.
|ebuild /usr/portage/sys-process/criu/criu-1.6.1.ebuild setup
...
</pre>}}

==== Emerge ====

{{Emerge|lxd}}

Since LXD is not yet stable, the {{Keyword|~amd64}} keyword may need to be unmasked to install the package.

==== Authorize a non-privileged user ====

{{RootCmd|usermod --append --groups lxd erik}}

This will allow a non-root user to interact with the control socket which is owned by the lxd unix group. For the group change to take effect, users may need to log out and log back in again.

==== Configure a bridge ====

LXD's default profile looks for a Linux bridge named lxcbr0.   Edit the {{Path|/etc/conf.d/net}} file for the bridge to be automatically configured by netifrc.

{{RootCmd|cat /etc/conf.d/net|output=<pre>
bridge_lxcbr0="eth0"
config_lxcbr0="dhcp"
</pre>}}
{{RootCmd|/etc/init.d/net.lxcbr0 start}}

If desired, the bridge can be configured to come up automatically in the runlevel.

==== Configure subuid/subgid ====

{{RootCmd
|echo root:1000000:65536 >>/etc/subuid
|echo root:1000000:65536 >>/etc/subgid
}}

In this setup, the user 0-65535 on the container will actually be seen on the host system as user 1000000+uid and 1000000+gid. This protects the host system, since if any container managed to break out of its sandboxed namespace, it could interact with the host system only as a process with an unknown, very high UID/GID.

==== Start the daemon ====

For SysV users:

{{RootCmd|/etc/init.d/lxd start}}

A systemd unit file has also been installed.

{{Path|/etc/conf.d/lxd}} has a few available options related to debug output, but the defaults are adequate for this quick start.

=== Launch a container ===

Add add an image repository at a remote called "images":
{{Cmd|lxc remote add images https://images.linuxcontainers.org}}

This is an untrusted remote, which can be a source of images that have been published with the --public flag.  Trusted remotes are also possible, and are used as container hosts and also to serve private images.  This specific remote is not special to LXD; organizations may host their own images.

{{Cmd|lxc image list images:|output=<pre>
+--------------------------------+--------------+--------+-------------------------+---------+-------------------------------+
|             ALIAS              | FINGERPRINT  | PUBLIC |       DESCRIPTION       |  ARCH   |          UPLOAD DATE          |
+--------------------------------+--------------+--------+-------------------------+---------+-------------------------------+
|                                | 3ae185265c53 | yes    | Centos 6 (amd64)        | x86_64  | Aug 29, 2015 at 10:17pm (CDT) |
|                                | 369ac13f390e | yes    | Centos 6 (amd64)        | x86_64  | Sep 3, 2015 at 12:17pm (CDT)  |
| centos/6/amd64 (1 more)        | 8e54c679f1c2 | yes    | Centos 6 (amd64)        | x86_64  | Sep 3, 2015 at 10:17pm (CDT)  |
|                                | 755542362bbb | yes    | Centos 6 (i386)         | i686    | Aug 29, 2015 at 10:19pm (CDT) |
|                                | b4d26dbc6567 | yes    | Centos 6 (i386)         | i686    | Sep 3, 2015 at 12:20pm (CDT)  |
| centos/6/i386 (1 more)         | 21eeba48a2d4 | yes    | Centos 6 (i386)         | i686    | Sep 3, 2015 at 10:19pm (CDT)  |
|                                | 9fe7ffdbc0ae | yes    | Centos 7 (amd64)        | x86_64  | Aug 29, 2015 at 10:22pm (CDT) |
|                                | d750b910e62d | yes    | Centos 7 (amd64)        | x86_64  | Sep 3, 2015 at 12:23pm (CDT)  |
| centos/7/amd64 (1 more)        | 06c4e5c21707 | yes    | Centos 7 (amd64)        | x86_64  | Sep 3, 2015 at 10:22pm (CDT)  |
|                                | ee229d68be51 | yes    | Debian jessie (amd64)   | x86_64  | Aug 29, 2015 at 6:29pm (CDT)  |
|                                | 69e457e1f4ab | yes    | Debian jessie (amd64)   | x86_64  | Sep 2, 2015 at 6:34pm (CDT)   |
| debian/jessie/amd64 (1 more)   | 2ddd14ff9422 | yes    | Debian jessie (amd64)   | x86_64  | Sep 3, 2015 at 6:30pm (CDT)   |
|                                | 9fac01d1e773 | yes    | Debian jessie (armel)   | armv7l  | Aug 31, 2015 at 7:24pm (CDT)  |
|                                | 67f4fedafd2f | yes    | Debian jessie (armel)   | armv7l  | Sep 1, 2015 at 7:24pm (CDT)   |
...
</pre>}}

There are Gentoo images in the list, although they are not maintained by the Gentoo project.  LXC users may recognize these images as the same ones available using the "download" template.

{{Cmd|lxc launch images:centos/6/amd64 mycentos6|output=<pre>
Creating mycentos6 done.
Starting mycentos6 done.
</pre>}}

{{Cmd|lxc list|output=<pre>
+-----------+---------+----------------+------+-----------+-----------+
|   NAME    |  STATE  |      IPV4      | IPV6 | EPHEMERAL | SNAPSHOTS |
+-----------+---------+----------------+------+-----------+-----------+
| mycentos6 | RUNNING | 192.168.43.240 |      | NO        | 0         |
+-----------+---------+----------------+------+-----------+-----------+
</pre>}}

A shell can be run in the container's context.

{{Cmd|lxc exec mycentos6 /bin/bash|output=<pre>
[root@mycentos6 ~]# ps
  PID TTY          TIME CMD
  428 ?        00:00:00 bash
  438 ?        00:00:00 ps
[root@mycentos6 ~]# ps faux
USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
root       428  0.0  0.0  11500  2648 ?        Ss   16:13   0:00 /bin/bash
root       440  0.0  0.0  13380  1888 ?        R+   16:13   0:00  \_ ps faux
root         1  0.0  0.0  19292  2432 ?        Ss   16:03   0:00 /sbin/init
root       188  0.0  0.0   4124  1316 console  Ss+  16:03   0:00 /sbin/mingetty --nohangup console
root       228  0.0  0.0   9180  1392 ?        Ss   16:03   0:00 /sbin/dhclient -H mycentos6 -1 -q -lf /var/lib/dhclient/dhclient-eth0.leases -pf /var/run/dhc
root       278  0.0  0.0 171372  2544 ?        Sl   16:03   0:00 /sbin/rsyslogd -i /var/run/syslogd.pid -c 5
root       439  0.0  0.0   4120  1472 ?        Ss   16:13   0:00 /sbin/mingetty --nohangup /dev/tty[1-6]
</pre>}}

While the container sees its processes as running as the root user, running <code>ps</code> on the host shows the processes running as UID 1000000.  This is the advantage of unprivileged containers: root is only root in the container, and is nobody special in the host.  It is possible to manipulate the subuid/subgid maps to allow containers access to host resources (for example, write to the X socket) but this must be explicitly allowed.

== Configuration ==

TODO

== Multi-host Setup ==

TODO

== Advanced features ==

=== Live migration ===

TODO

=== Automatic BTRFS integration ===

When LXD detects that {{Path|/var/lib/lxd}} is on a [[Btrfs]] filesystem, it uses Btrfs' snapshot capabilities to ensure that images, containers and snapshots share blocks as much as possible.  No user action is required to enable this behavior.

When the container was launched in the Quick Start section above LXD created subvolumes for the image and container.  The container filesystem is a copy-on-write snapshot of the image.

{{RootCmd|btrfs subvolume list /|output=<pre>
ID 330 gen 4518 top level 5 path var/lib/lxd/images/8e54c679f1c293f909c66097d97de23c66a399d2dc396ade92b3b6aae1c7
ID 331 gen 4595 top level 5 path var/lib/lxd/containers/mycentos6
</pre>}}

{{RootCmd|btrfs subvolume show /var/lib/lxd/images|output=<pre>/8e54c679f1c293f909c66097d97de23c66a399d2dc396ade92b3b6a
/var/lib/lxd/images/8e54c679f1c293f909c66097d97de23c66a399d2dc396ade92b3b6aae1c732fe.btrfs
        Name:                   8e54c679f1c293f909c66097d97de23c66a399d2dc396ade92b3b6aae1c732fe.btrfs
        UUID:                   5530510e-2007-f146-9e0b-8c05480d63de
        Parent UUID:            -
        Received UUID:          -
        Creation time:          2015-09-04 15:03:32 -0500
        Subvolume ID:           330
        Generation:             4518
        Gen at creation:        4517
        Parent ID:              5
        Top level ID:           5
        Flags:                  -
        Snapshot(s):
                                var/lib/lxd/containers/mycentos6
</pre>}}

Making a snapshot of the running container filesystem creates another copy-on-write snapshot.

{{Cmd|lxc snapshot mycentos6 firstsnap}}

{{RootCmd|btrfs subvolume list /|output=<pre>
ID 330 gen 4518 top level 5 path var/lib/lxd/images/8e54c679f1c293f909c66097d97de23c66a399d2dc396ade92b3b6aae1c7
ID 331 gen 4595 top level 5 path var/lib/lxd/containers/mycentos6
ID 332 gen 4584 top level 5 path var/lib/lxd/snapshots/mycentos6/firstsnap
</pre>}}

{{RootCmd|btrfs subvolume show /var/lib/lxd/containers/mycentos6|output=<pre>/var/lib/lxd/containers/mycentos6
        Name:                   mycentos6
        UUID:                   fe6bfd65-d911-e449-a1df-be42d2997f4a
        Parent UUID:            5530510e-2007-f146-9e0b-8c05480d63de
        Received UUID:          -
        Creation time:          2015-09-04 15:03:39 -0500
        Subvolume ID:           331
        Generation:             4595
        Gen at creation:        4518
        Parent ID:              5
        Top level ID:           5
        Flags:                  -
        Snapshot(s):
                                var/lib/lxd/snapshots/mycentos6/firstsnap
</pre>}}

== See also ==

* [[LXC]] - Linux containers.

[[Category:Software]]
