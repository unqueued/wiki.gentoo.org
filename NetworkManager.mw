{{InfoBox stack
|{{InfoBox homepage|http://projects.gnome.org/NetworkManager/|header=true}}
|{{InfoBox wikipedia}}
}}
'''NetworkManager''' is a [[network management|network management software]] for Ethernet, Wifi, DSL, dialup, VPN, [[WiMAX]] and mobile broadband network connections.

{{Note|NetworkManager and other network management services typically don't work together. That includes a standalone instance of dhcpcd. Make sure you have only one network management service running.}}

== Installation ==

NetworkManager requires an implementation of [[udev]] and [[D-Bus]]. On laptops and desktops, it is typically built with [[polkit]] to enable local users to configure it. It also optionally integrates with [[systemd]], [[upower]], [[consolekit]] and others.

It's a good idea to use dhclient from {{Package|net-misc/dhcp}} instead of {{Package|net-misc/dhcpcd}}. While dhcpcd in standalone mode provides some interesting features over dhclient, those will not be used by NetworkManager. Most upstream developers and most users of other distributions do use dhclient and it's therefore much better tested, works correctly with [[IPv6]] and is generally a better DHCP client to be used with NetworkManager.

{{RootCmd|euse -p net-misc/networkmanager -D dhcpcd && euse -p net-misc/networkmanager -E dhclient}}

=== NetworkManager 0.9.8 ===

NetworkManager branch 0.9.8 is the stable version of NetworkManager in Gentoo.

{{Emerge|networkmanager}}

=== NetworkManager 0.9.10 ===

NetworkManager branch 0.9.10 isn't in portage. It would be a good addition
though as it provides large part of features that are getting to the upcoming
1.0 release.

=== NetworkManager live ebuild (future 1.0 release) ===

NetworkManager is changing substantially and its feature set is slowly moving
from a laptop oriented tool to a universal network management service configured
using all sorts of tools from [[nmcli]] through [[nmtui]] to GUI tools like
[[nm-applet]], [[nm-connection-editor]], Gnome Shell's network indicator, Gnome 3
control center, KDE plasma-nm and more.

Make sure you have installed [[Layman]]. Now you can add the [http://gpo.zugaina.org/Overlays/ixit ixit]
overlay which includes a live ebuild for {{Package|net-misc/networkmanager}} and much more.

{{RootCmd|layman -a ixit}}

Now you can install the live ebuild.

{{Emerge|--autounmask-write {{=}}net-misc/networkmanager-9999}}

If anything goes wrong, contact [[User:Pavlix]]. Those are live ebuilds and therefore they can occasionally need updating. I'm also considering starting a separate overlay just for networking related tools, let me know if that would help you.

=== Prerequisites ===

On Gentoo, NetworkManager uses the plugdev group, so add your user to plugdev.

{{RootCmd|gpasswd -a $USER plugdev}}

=== Kernel ===

For Wifi devices enable also the following options:
{{Kernel||<pre>
[*] Networking support  --->
        Networking options  --->
        <*> Packet socket
    [*] Wireless  --->
        <*>   cfg80211 - wireless configuration API
        [*]     cfg80211 wireless extensions compatibility
</pre>}}

Look at the [[udev]] page for kernel configuration needed for this NetworkManager dependency.

=== Software ===
Portage knows the global USE flag ''networkmanager'' for enabling support for NetworkManager in other packages. Enabling this USE flag will pull in {{Package|net-misc/networkmanager}} automatically:
{{RootCmd|euse -E networkmanager}}
The USE flags of networkmanager are:
{{USEflag|package=net-misc/networkmanager
|avahi
|bluetooth+yes
|connection-sharing
|consolekit+yes
|dhclient
|dhcpcd+yes
|doc
|gnutls
|introspection+yes
|modemmanager
|nss+yes
|ppp+yes
|resolvconf
|vala
|wext+yes
|wimax
}}

After setting this you want to update your system so the changes take effect:
{{Emerge|params+=--changed-use --deep|@world}}

Also install a frontend:
* {{Package|gnome-extra/nm-applet}} - [[GNOME]] frontend
* {{Package|kde-misc/plasma-nm}} - [[KDE]] frontend
* {{Package|kde-misc/networkmanagement}} - [[KDE]] frontend
* '''nmcli''' (part of networkmanager) - command line frontend 

There are also some extensions:
* {{Package|net-misc/networkmanager-openconnect}} - VPN connection to a OpenConnect server
* {{Package|net-misc/networkmanager-openswan}} - VPN connection to a OpenSwan server
* {{Package|net-misc/networkmanager-openvpn}} - VPN connection to a OpenVPN server
* {{Package|net-misc/networkmanager-pptp}} - VPN connection to a PPTP server
* {{Package|net-misc/networkmanager-sstp}} - VPN connection to a SSTP server
* {{Package|net-misc/networkmanager-vpnc}} - VPN connection to a Cisco VPN concentrator

== Configuration ==

=== Boot service ===
==== OpenRC ====
You can now start NetworkManager:
{{RootCmd|/etc/init.d/NetworkManager start}}
To start NetworkManager at boot time, add it your default runlevel:
{{RootCmd|rc-update add NetworkManager default}}

Reload [[D-Bus]] so that the NetworkManager changes take effect:
{{RootCmd|/etc/init.d/dbus reload}}

Note that NetworkManager will not connect if other services are also managing connections.  So you need to remove them, if you have them installed.
{{RootCmd|for service in $(rc-update show default {{!}} grep 'net\.' {{!}} awk '{ print $1 }'); do rc-update del $service default; done}}
{{RootCmd|rc-update del dhcpcd default}}

==== Systemd ====
On a systemd-based install, you can start NetworkManager like soː
{{RootCmd|systemctl start NetworkManager}}

To start it at boot timeː
{{RootCmd|systemctl enable NetworkManager}}

=== Setting a hostname ===

If you built NetworkManager with USE=dhclient, you can set a hostname like this:

{{file|/etc/dhcp/dhclient.conf||<pre>
send host-name "yourhostname";
</pre>}}

=== nm-applet and X session startup ===
To be able to get nm-applet started when starting your light X session or light [[desktop environment]], just put the following line in your {{Path|~/.xinitrc}} file:
{{File|~/.xinitrc||<pre>
dbus-launch nm-applet &
</pre>}}

For {{Package|gnome-base/gnome-keyring}} support, add the following lines before the previous line. This will ease password management for GnuPG, ssh and Wifi:
{{File|~/.xinitrc||<pre>
eval $(gnome-keyring-daemon --components=pkcs11,secrets,ssh,gpg)
export GNOME_KEYRING_PID
export GNOME_KEYRING_SOCKET
export SSH_AUTH_SOCK
export GPG_AGENT_INFO
</pre>}}

=== Dnsmasq ===
NetworkManager can be set up to use [[Dnsmasq]] as a local DNS server that passes the DNS queries on to your provider's DNS server. /etc/resolv.conf will be set to point to 127.0.0.1, where dnsmasq runs and processes the queries. This can be useful for example if an application chroots for security reasons and before doing so copies /etc/resolv.conf. Then it would never be informed about changes to the DNS servers as your laptop moves from Wifi to Wifi.

Setup of dnsmasq is simple:
{{File|/etc/NetworkManager/NetworkManager.conf||<pre>
[main]
plugins=keyfile
dns=dnsmasq
</pre>}}

Then restart NetworkManager.

'''DNSSEC'''

Dnsmasq can optionally validate DNSSEC data while passing through queries (must be compiled with the dnssec use flag). This can be accomplished by adding these lines to the NetworkManager dnsmasq config file:

{{File|/etc/NetworkManager/dnsmasq.d/dnssec||<pre>
# DNSSEC setup
dnssec
trust-anchor=.,19036,8,2,49AAC11D7B6F6446702E54A1607371607A1A41855200FD2CE1CDDE32F24E8FB5
dnssec-check-unsigned
</pre>}}

The trusted anchor can be found [https://data.iana.org/root-anchors/root-anchors.xml here]. After this change dnsmasq will return SERVFAIL and no DNS data if the validation fails. If the validation succeeds it sets the ad flag. In case the domain does not support DNSSEC dnsmasq behaves as before.

If your ISP's DNS server does not forward DNSSEC data then this will fail. In that case you can uncomment the last line, but it will defy the purpose of DNSSEC. Google's server 8.8.8.8 provise DNSSEC data.

== Troubleshotting ==
* {{Bug|net-misc/networkmanager|search=package}}
* [https://bugzilla.gnome.org/buglist.cgi?query_format=advanced;order=Importance;bug_status=UNCONFIRMED;bug_status=NEW;bug_status=ASSIGNED;bug_status=REOPENED;bug_status=NEEDINFO;classification=Platform;product=NetworkManager GNOME bugtracker: known bugs]
* [https://live.gnome.org/NetworkManager/Debugging GNOME Wiki]

[[Category:Network management]]
