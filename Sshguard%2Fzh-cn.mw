<languages />


{{InfoBox stack
|{{InfoBox homepage|http://www.sshguard.net/|header=true}}
|{{InfoBox ohloh}}
}}
{{Metadata|abstract=sshguard是一个入侵防御系统，它解析服务器日志，检查恶意行为，然后使用系统防火墙来阻止这些IP地址。}}

'''sshguard''' 是一种入侵防御系统。 sshguard 解析服务器日志，检测恶意行为，然后通过防火墙规则禁止恶意用户登录。 sshguard 是用 C 写的，因此不需要额外的解析器。

== 工作原理 ==

{{Package|app-admin/sshguard}} 是一个持续跟踪一个或多个日志文件的守护进程。它通过分析由失败的登录尝试引发的守护进程的日志活动，通过更新系统的防火墙阻止这些用户进一步的尝试。

不像名字暗示的那样， sshguard 不仅可以解析 SSH 日志。它也支持多种邮件系统和一些 FTP 系统。它支持的服务的详细列表可以在 [http://www.sshguard.net sshguard.net 网站]找到。

== 配置 ==

=== 软件 ===

Install {{Package|app-admin/sshguard}}:

{{Emerge|app-admin/sshguard}}

Also make sure that {{Package|net-firewall/iptables}} is installed and used as the system firewall. At the time of writing, sshguard does not support {{Package|net-firewall/nftables}} yet.

{{Emerge|net-firewall/iptables}}

More information about using and configuring [[Iptables|iptables]] can also be found on the Gentoo wiki.

=== Preparing the firewall ===

When sshguard blocks any malicious users (by blocking their IP addresses), it will use the <tt>sshguard</tt> chain.

Prepare the chain, and make sure it is also triggered when new incoming connections are detected:

{{RootCmd|iptables -N sshguard
|iptables -A INPUT -j sshguard}}

=== Watching logfiles ===

The basic idea behind sshguard is that the administrator passes on the log file(s) to watch as options to the application - there is no native sshguard configuration file.

On Gentoo, the options can be best configured in the {{Path|/etc/conf.d/sshguard}} file:

{{FileBox|filename=/etc/conf.d/sshguard|title=Configuring sshguard to read /var/log/messages|lang=bash|1=
PARDONTIME="3600" # Blocks last at least 1 hour (3600 seconds)
WATCHTIME="360"   # Track IP addresses for 5 minutes (360 seconds)
THRESHOLD="10"    # How many problematic attempts trigger a block
  
LOGFILES="-l /var/log/messages"                      # Watch this file...
LOGFILES="${SSHGUARD_LOGFILES} -l /var/log/auth.log" # And this one
  
SSHGUARD_OPTS="-p ${PARDONTIME} -s ${WATCHTIME} -a ${THRESHOLD} ${LOGFILES}"
}}

Make sure that the log files are accessible for the runtime user that sshguard uses.

=== Service ===

Have sshguard be started by default by adding it to the default runlevel, and then start it:

{{RootCmd|rc-update add sshguard default
|rc-service sshguard start}}

== See also ==

* [[Iptables]], for installing and configuring <tt>iptables</tt> on Gentoo

== External resources ==

The [http://www.sshguard.net/docs/ sshguard documentation] provides all the information needed to further tune the application.


[[Category:Security]]
[[Category:Server]]
