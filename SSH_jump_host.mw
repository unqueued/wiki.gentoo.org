An alternative to [[SSH tunneling]] to access internal machines through gateway is using [http://glandium.org/blog/?p=308 jump hosts].

The idea is to use ProxyCommand to automatically execute ''ssh'' command on remote host to jump to the next host and forward all traffic through.

== Prerequisites ==

* SSH access to the gateway machine and the internal one.
* Gateway machine has Netcat installed.

== Dynamic jumphost list ==

You can use the -J option to jump through a host:

{{Cmd|ssh -J host1 host3}}

If usernames or ports on machines differ, specify them:

{{Cmd|ssh -J user1@host1:port1 user2@host2:port2}}

==== Multiple jumps ====

The same syntax can be used to make jumps over multiple machines:

{{Cmd|ssh -J user1@host1:port1,user2@host2:port2 user3@host3}}

== Static jumphost list ==

Static jumphost list means, that you know the jumphost or jumphosts you need, to reach a host. Therefore you can create a static jumphost 'routing' in {{Path|~/.ssh/config}} file. The advantage in comparison to the dynamic jumphost option is, that you don't have to provide the .ssh config on jumphosts between your machine and all the other jumphosts between you and the final host you want to jump to.

=== Setup ===

{{FileBox|filename=~/.ssh/config|title=ProxyJump Example|1=
### First jumphost. Directly reachable
Host betajump
  HostName jumphost1.example.org

### Host to jump to via jumphost1.example.org
Host behindbeta
  HostName behindbeta.example.org
  ProxyJump  betajump 
}}

=== Usage ===

{{Cmd|ssh behindalpha}}

If usernames on machines differ, specify them by modifing the correspondent ProxyJump line:

{{FileBox|filename=~/.ssh/config|title=Modify correspondent ProxyCommand|1=
ProxyJump  otheruser@behindalpha
}}

It works with scp command, too:

{{Cmd|scp filename behindalphabeta:~/}}

{{Note|The colon and path at the end is needed so that scp recognizes it as remote.}}

==== Multiple jumps ====

The same syntax can be used to make jumps over multiple machines:

{{FileBox|filename=~/.ssh/config|title=Add this text|1=
### First jumphost. Directly reachable
Host alphajump
  HostName jumphost1.example.org

### Second jumphost. Only reachable via jumphost1.example.org
Host betajump
  HostName jumphost2.example.org
  ProxyJump alphajump

### Host only reachable via alphajump and betajump
Host behindalphabeta
  HostName behindalphabeta.example.org
  ProxyJump betajump
}}

{{Cmd|ssh behindalphabeta}}

== Tips ==

To ease the connecting even further:

* Set these commands as [http://en.wikipedia.org/wiki/Alias_%28command%29 shell aliases]
* To avoid typing passwords use [http://www.gentoo.org/doc/en/articles/openssh-key-management-p1.xml OpenSSH keys]

== External resources ==

* [http://glandium.org/blog/?p=308 SSH through jump hosts]

[[category:SSH]]
