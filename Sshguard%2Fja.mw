<languages />

{{InfoBox stack
|{{InfoBox homepage|http://www.sshguard.net/|header=true}}
|{{InfoBox ohloh}}
}}

{{Metadata|abstract=sshguard is an intrusion prevention system that parses server logs, determines malicious activity, and uses the system firewall to block the IP addresses of malicious connections.}}

'''sshguard''' は侵入防止システムです。サーバーのログを精査して害意ある行動を検出し、危害を加えようとする接続元IPアドレスを拒絶するファイアーウォールを用います。sshguard は、C言語で書かれており、インタプリターは不要です。

== 動作の仕組み ==

sshguard は、一つないし複数のログファイルを継続追跡する簡単なデーモンです。他のデーモンが記録したログイン試行失敗のログを精査して、その接続を拒絶するようにシステムファイアーウォールを更新することで、更なる試行を阻止します。

sshguard は、その名称にも拘わらず、 SSH のログのみを精査するわけではありません。多くのメールシステムやいくらかの FTP システムにも対応しています。対応しているサービスの全リストは、[http://www.sshguard.net sshguard.net ウェブサイト] で公開されています。

== インストール ==

=== Emerge ===

{{Package|app-admin/sshguard}} をインストール:

{{Emerge|app-admin/sshguard}}

また、システムファイアーウォールを展開するために、 {{Package|net-firewall/iptables}} もインストールします。なお本稿作成段階では、 sshguard は {{Package|net-firewall/nftables}} には対応していません。

{{Emerge|net-firewall/iptables}}

iptables の利用と設定に関しての詳細は、 [[Iptables|iptables の記事]] も参照してください。

== 設定 ==

=== Preparing the firewall ===

When sshguard blocks any malicious users (by blocking their IP addresses), it will use the <tt>sshguard</tt> chain.

Prepare the chain, and make sure it is also triggered when new incoming connections are detected:

{{RootCmd|iptables -N sshguard
|iptables -A INPUT -j sshguard}}

=== Watching logfiles ===

The basic idea behind sshguard is that the administrator passes on the log file(s) to watch as options to the application - there is no native sshguard configuration file.

On Gentoo, the options can be best configured in the {{Path|/etc/conf.d/sshguard}} file:

{{FileBox|filename=/etc/conf.d/sshguard|title=Configuring sshguard to read /var/log/messages|lang=bash|1=
PARDONTIME="3600" # Blocks last at least 1 hour (3600 seconds)
WATCHTIME="360"   # Track IP addresses for 5 minutes (360 seconds)
THRESHOLD="10"    # How many problematic attempts trigger a block
  
LOGFILES="-l /var/log/messages"                      # Watch this file...
LOGFILES="${LOGFILES} -l /var/log/auth.log"          # And this one
  
SSHGUARD_OPTS="-p ${PARDONTIME} -s ${WATCHTIME} -a ${THRESHOLD} ${LOGFILES}"
}}

Make sure that the log files are accessible for the runtime user that sshguard uses.

=== Service ===

Have sshguard be started by default by adding it to the default runlevel, and then start it:

{{RootCmd|rc-update add sshguard default
|rc-service sshguard start}}

== 参考 ==

* [[Iptables]], for installing and configuring <tt>iptables</tt> on Gentoo

== 外部の情報 ==

The [http://www.sshguard.net/docs/ sshguard documentation] provides all the information needed to further tune the application.


[[Category:Security]]
[[Category:Server]]
