<languages />
{{InfoBox stack
|{{InfoBox homepage|http://cinnamon.linuxmint.com/|header=true}}
|{{InfoBox wikipedia|Cinnamon}}
|{{InfoBox github|linuxmint/Cinnamon}}
}}
Cinnamon est un environnement de bureau moderne, avec une interface traditionnelle qui ne déroutera pas les utilisateurs de Gnome 2, [[LXDE]] ou [[Xfce]]. Il offre des fonctionnalités et des capacités graphiques avancées. «&nbsp;Embranché&nbsp;» (c’est un ''fork'') depuis Gnome Shell et développé pour [http://linuxmint.com/ Linux Mint], il est disponible pour les architectures {{Keyword|amd64}} et {{Keyword|x86}}.

== Installation ==

== Prérequis ==

Cinnamon works great both with and without systemd. To install without systemd dependencies, use {{c|eselect}} to switch to a profile without Gnome, such as <code>default/linux/amd64/13.0/desktop</code>. To install with systemd, use a Gnome-enabled profile such as <code>default/linux/amd64/13.0/desktop/gnome/systemd</code>. The architecture and version can be different in both cases.

Pour obtenir une liste des profils disponibles :

{{RootCmd|eselect profile list|output=<pre>
[1] default/linux/amd64/13.0
[2] default/linux/amd64/13.0/selinux
[3] default/linux/amd64/13.0/desktop
[4] default/linux/amd64/13.0/desktop/gnome
[5] default/linux/amd64/13.0/desktop/gnome/systemd
etc.
</pre>}}

==== OpenRC ====

Sous OpenRC choisir le profil :

{{RootCmd|eselect profile set default/linux/amd64/13.0/desktop}}

Ou bien sélectionner le même profil par son numéro dans la liste ci-dessus&nbsp;:

{{RootCmd|eselect profile set 3}}

Se référer également à l’article [[Gentoo_Without_systemd|Gentoo Without Systemd]] (Gentoo sans systemd).

==== Systemd ====

Sous systemd, choisir le profil de bureau GNOME dont le nom finit par systemd :

{{RootCmd|eselect default/linux/amd64/13.0/desktop/gnome/systemd}}

{{Note|L’architecture du système (<code>amd64</code>) et sa version (<code>13</code>) peuvent différer, il importe seulement que le nom du profil finisse par <code>/gnome/systemd</code>.}}

==== Xorg ====

Pour que Cinnamon fonctionne il faut bien sûr que Xorg soit déjà [[Xorg/Guide|installé et configuré]]. Soyez sûr que le serveur X soit fonctionnel avant de continuer cet article… et si besoin testez-le, en suivant les indications du chapitre [[Xorg/Guide/fr#Utiliser_startx|Utiliser startx]] du guide Gentoo sur Xorg.

Cinnamon, comme les autres applications, est traduit dans beaucoup de langues (Linguas). Ajouter le français dans {{Path|make.conf}} si ça n’a pas été fait lors de l’installation de Gentoo, par la variable <var>LINGUAS</var>&nbsp;:

{{FileBox|filename=/etc/portage/make.conf|lang=bash|title=Paramétrer make.conf avec le code de la langue française|1=
LINGUAS="fr"
}}

Il est recommandé d’installer {{Package|x11-libs/gtk+extra}} et, '''seulement avec une version de Xorg inférieure à 1.7''', {{Package|x11-drivers/xf86-video-modesetting}}, sans lesquels Cinnamon ne fonctionnerait pas correctement&nbsp;:

* Avec une version de Xorg inférieure à 1.17 :
{{Emerge|x11-libs/gtk+extra x11-drivers/xf86-video-modesetting}}

* Starting with Xorg 1.17:
{{Emerge|x11-libs/gtk+extra}}

=== Options de la variable USE  ===

{{USEflag|package=gnome-extra/cinnamon}}

Informations supplémentaires sur Python targets à la page [[Project:Python/PYTHON_TARGETS|PYTHON TARGETS]] du projet Python.

Some USE flags, <code>icu</code>, <code>pulseaudio</code> and <code>gnome-keyring</code>, are needed by Cinnamon's dependencies. If they are not set already, either allow {{c|emerge --ask gnome-extra/cinnamon}} to create or update {{Path|package.use}} (or {{Path|package.use/cinnamon}}, or {{Path|package.use/anotherName}}) itself, or set the USE flags manually.

=== Emerge ===

Après les étapes ci-dessus « émerger » Cinnamon :

{{Emerge|gnome-extra/cinnamon}}

{{Note|The compilation duration for {{Package|net-libs/webkit-gtk}} can be very long, especially on older hardware. Be patient, Cinnamon is worth it!}}

== Configuration du système ==

Avant d’aborder l’aspect visuel de Cinnamon, on paramètre son lancement lors du démarrage ou sur demande d’un utilisateur. On paramètre également les droits des utilisateurs pour qu’ils puissent interagir facilement avec le système.

=== Services ===

Les instructions suivantes concernent OpenRC. Avec systemd, utiliser {{c|systemctl}} comme expliqué dans la  [[Systemd#Enabling.2C_disabling.2C_starting_and_stopping_services|page systemd]].

==== dbus et consolekit ====

Le serveur X et Cinnamon requièrent les services {{c|dbus}} et {{c|consolekit}}, s’assurer qu’ils seront lancés au démarrage :

{{RootCmd
|rc-update add dbus default
|rc-update add consolekit default
}}

Puis lancer ces services sans qu’un redémarrage soit requis :

{{RootCmd
|rc-service dbus start
|rc-service consolekit start
}}

==== NetworkManager ====

[[NetworkManager]] est une dépendance de Cinnamon qui est inutile si le réseau a été configuré lors de l’installation de Gentoo, et qui ne doit pas être activée si un autre service réseau est en cours d’utilisation. Désactiver tout autre service réseau si NetworkManager est utilisé. Par exemple, si le système a été configuré pour utiliser les scripts netifrc, en désactiver les services&nbsp;:

{{RootCmd
|rc-service net.eth0 stop
|rc-update del net.eth0 default
}}

{{Note|Avec {{Package|sys-fs/udev}} les interfaces réseau sont nommées par les [http://www.freedesktop.org/wiki/Software/systemd/PredictableNetworkInterfaceNames/ Noms prévisibles d’interfaces]. Cela donne des noms comme {{Path|enp12s0}}, {{Path|eno1}}, {{Path|enp2s0}}, etc. Avec {{Package|sys-fs/eudev}}, l’embranchement (''fork'') de udev créé par Gentoo pour éviter les dépendances à systemd, le nom de la première interface est souvent {{Path|eth0}}.}}

Activer NetworkManager après la désactivation d’autres services réseau&nbsp;:

{{RootCmd
|rc-service NetworkManager start
|rc-update add NetworkManager default
}}

==== Disabling NetworkManager applet ====

If NetworkManager is not used, it's applet can be disabled in Cinnamon panel as explained in [https://wiki.archlinux.org/index.php/Cinnamon#Disable_the_NetworkManager_applet Arch Linux Wiki Cinnamon page]. Copy {{Path|/etc/xdg/autostart/nm-applet.desktop}} to {{path|~/.config/autostart/nm-applet.desktop}}, then add the disabling command and finally change file ownership:

{{RootCmd
|cp /etc/xdg/autostart/nm-applet.desktop /home/userName/.config/autostart/nm-applet.desktop
|echo <nowiki>'X-GNOME-Autostart-enabled=false'</nowiki> >> /home/userName/.config/autostart/nm-applet.desktop
|chown userName:userName /home/userName/.config/autostart/nm-applet.desktop
}}

=== Sudo ===

Pour qu’un utilisateur ordinaire puisse relancer ou éteindre le système depuis Cinnamon, {{c|sudo}} est requis et doit être paramétré.

Commencer par installer {{Package|app-admin/sudo}} :

{{Emerge|app-admin/sudo}}

Puis modifier la configuration de {{c|sudo}} par la commande {{c|visudo}} :

{{RootCmd|visudo}}

Celle-ci lance l’éditeur de texte par défaut pour générer ou mettre à jour le fichier {{Path|sudoers}}. Remplacer dans le code ci-dessous <code>nomUtilisateur</code> par chaque nom d’utilisateur de Cinnamon&nbsp;:

{{FileBox|filename=/etc/sudoers|lang=bash|1=
nomUtilisateur  ALL=(root) NOPASSWD: /sbin/reboot
nomUtilisateur  ALL=(root) NOPASSWD: /sbin/halt
nomUtilisateur  ALL=(root) NOPASSWD: /sbin/poweroff
nomUtilisateur  ALL=(root) NOPASSWD: /sbin/shutdown
}}

Ou pour tous les utilisateurs du groupe {{c|wheel}} :

{{FileBox|filename=/etc/sudoers|lang=bash|1=
%wheel  ALL=(root) NOPASSWD: /sbin/reboot
%wheel  ALL=(root) NOPASSWD: /sbin/halt
%wheel  ALL=(root) NOPASSWD: /sbin/poweroff
%wheel  ALL=(root) NOPASSWD: /sbin/shutdown
}}

=== Règles et actions de Polkit ===

Policy kit doit être configuré pour qu’un utilisateur ordinaire puisse effectuer depuis Cinnamon des actions demandant des privilèges élevés. Pour lister les actions possibles, dont les noms indiquent (en anglais…) ce qu’elles font, utiliser {{c|pkaction}}&nbsp;:

{{RootCmd|pkaction|output=<pre>
org.cinnamon.settings-daemon.plugins.power.backlight-helper
org.cinnamon.settings-users
org.cinnamon.settingsdaemon.datetimemechanism.configure
org.freedesktop.ModemManager1.Contacts
org.freedesktop.ModemManager1.Control
org.freedesktop.ModemManager1.Device.Control
org.freedesktop.ModemManager1.Firmware
org.freedesktop.ModemManager1.Location
org.freedesktop.ModemManager1.Messaging
org.freedesktop.ModemManager1.USSD
org.freedesktop.NetworkManager.enable-disable-network
org.freedesktop.NetworkManager.enable-disable-wifi
etc.
</pre>}}

Le plus simple est d’autoriser toutes les actions, en testant seulement l’appartenance de l’utilisateur au groupe {{c|wheel}}. Placer un fichier JavaScript d’extension {{Path|.rules}} dans {{Path|/etc/polkit-1/rules.d}}, nommé par exemple {{Path|55-allowing-all-actions.rules}}&nbsp;:

{{FileBox|filename=/etc/polkit-1/rules.d/55-allowing-all-actions.rules|lang=javascript|title=Règle policy kit générale|1=
polkit.addRule (function (action, subject)
{
  if (subject.isInGroup ("wheel"))
  {
    return polkit.Result.YES;
  }
});
}}

Pour n’autoriser que certaines actions, leurs noms doivent être précisés. Pour autoriser un membre du groupe {{c|wheel}} à suspendre, hiberner, éteindre et redémarrer le système, créer un fichier {{Path|55-allowing-actions.rules}} contenant&nbsp;:

{{FileBox|filename=/etc/polkit-1/rules.d/55-allowing-actions.rules|lang=javascript|title=Règles policy kit particulières|1=
polkit.addRule (function (action, subject)
{
  if (action.id == "org.freedesktop.upower.hibernate" {{!}}{{!}}
      action.id == "org.freedesktop.upower.suspend" {{!}}{{!}}
      action.id == "org.freedesktop.consolekit.system.stop" {{!}}{{!}}
      action.id == "org.freedesktop.consolekit.system.restart" &&
      subject.isInGroup ("wheel"))
      {
        return polkit.Result.YES;
      }
});
}}

Des actions très diverses peuvent être autorisées : changer des profils de couleurs, utiliser Nemo (le gestionnaire de fichiers de Cinnamon) en tant que root, monter ou éjecter des volumes, régler la luminosité de l’écran, utiliser NetworkManager, changer le font d’écran, etc. Plusieurs blocs <code>polkit.addRule (function (action, subject){&nbsp;…&nbsp;});</code> peuvent se succéder.

{{Important|Le fichier {{Path|/etc/polkit-1/rules.d/50-default.rules}} existe déjà. Les noms des fichiers ajoutés doivent commencer par un nombre plus grand que 50, '''55''' par exemple, pour être traités après {{Path|50-default.rules}}. Ne pas créer de fichier qui serait traité avant, dont le nom commencerait avec '''45''' par exemple.
}}

=== Lancement de Cinnamon ===

Sans gestionnaire de login, créer dans le répertoire utilisateur un fichier {{Path|.xinitrc}} :

{{FileBox|filename=~/.xinitrc|lang=bash|title=Instruction de lancement de Cinnamon|1=
exec cinnamon-session
}}

Pour lancer Xorg et Cinnamon, exécuter la commande {{c|startx}} après login :

{{Cmd|startx}}

Avec un gestionnaire de login, suivre les [[display manager|instructions]] le concernant.

== Apparence ==

=== Icônes Mint-X ===

{{Warning|Currently —January 2016— master branch icons set on GitHub leads Cinnamon to crash. 17.x-maintenance branch can be used instead, but Mint-X green icons are really too big on desktop; it is not the case with a colored set added to Mint-X icons in 17.x-maintenance branch. If Cinnamon crashes, a safe way is to come back to Adwaita or Gnome icons in Cinnamon Control Center.}}

Cinnamon est installé avec les icônes de Gnome. [https://github.com/linuxmint/mint-x-icons Les icônes Mint-X se trouvent sur GitHub]. Les télécharger, décompresser et placer dans {{Path|/usr/share/icons}}&nbsp;:

{{RootCmd|mv cheminVersArchiveDécompressée/mint-x-icons-master/usr/share/icons/Mint-X /usr/share/icons/Mint-X}}

Puis faire un cache de ces icônes :

{{RootCmd|gtk-update-icon-cache /usr/share/icons/Mint-X}}

Le nouveau jeu d’icônes peut être sélectionné dans le Centre de contrôle de Cinnamon. Les icônes Mint-X sont vertes, des jeux d’autres couleurs peuvent être installés comme Mint-X-Grey ou Mint-X-Orange. Leur faire un cache également.

{{Important|Colored icons sets rely on Mint-X icon set: always install it, with or without colored icons sets.}}

=== Couleur du texte des icônes du bureau ===

{{Note|Desktop icons text color is now white in Cinnamon version 2.6.13, so this chapter applies to older Cinnamon versions… and remains a good introduction to Cinnamon theming.}}

Par défaut la couleur du texte des icônes du bureau de Cinnamon est noire, ce qui n’est pas toujours lisible. La manière de la changer dépend de la version de GTK+ 3 utilisée par le système. Pour connaître cette version&nbsp;:

{{Cmd|emerge --info x11-libs/gtk+}}

* Pour les versions de GTK+ inférieures à 3.13.3, le paramétrage est fait pour tout le système. On change la couleur du texte en insérant des règles CSS dans le fichier {{Path|/usr/share/themes/Adwaita/gtk-3.0/gtk.css}} (Adwaita est le thème par défaut de GTK+), après la ligne <code>@import</code>&nbsp;:

{{FileBox|filename=/usr/share/themes/Adwaita/gtk-3.0/gtk.css|lang=css|title=Règles CSS pour GTK+ &lt; 3.13.3|1=
@import url("resource:///org/gnome/adwaita/gtk-main.css");
 
/* règles CSS ajoutées */
.nemo-desktop.nemo-canvas-item {
  color: #fff;  /* #fff est le blanc en couleurs web, #333 serait un gris foncé */
}
 
.nemo-desktop.nemo-canvas-item:selected {
  background-color: alpha (#fff, 0.2);  /* 0.2 est le niveau de transparence */
}
}}

: La 2<sup>e</sup> règle concerne une icône du bureau sélectionnée et peut être modifiée pour une autre couleur de fond, pour un autre niveau de transparence.

* In more recent GTK+ versions (3.13.3 onward), this must be tuned through a user-specific configuration file. Adwaita is now included in GTK+ as the theme replacing Raleigh, so rules must be set in the user's home directories. The file to edit is {{Path|~/.config/gtk-3.0/gtk.css}} (create {{Path|~/.config/gtk-3.0/}} directory if needed), and the change is now without the <code>@import</code> line. Additionally in this example, the left Nemo side bar is gray colored:

{{FileBox|filename=~/.config/gtk-3.0/gtk.css|lang=css|title=Règles CSS pour GTK+ &ge; 3.13.3|1=
.nemo-desktop.nemo-canvas-item {
  color: #fff;
}
 
.nemo-desktop.nemo-canvas-item:selected {
  background-color: alpha (#fff, 0.2);
}
 
NemoWindow .sidebar, NemoWindow .sidebar .view {
  background-color: #444;
  color: #eee; /* gris clair */
}
}}

=== Thèmes Mint-X ===

Bien sûr Cinnamon est installé avec le thème Cinnamon… [https://github.com/linuxmint/cinnamon-themes Des thèmes Mint-X sont sur GitHub]. Si besoin les télécharger, décompresser et copier dans {{Path|/usr/share/themes}}, ils pourront être choisis dans le Centre de contrôle de Cinnamon.

=== Configurer les thèmes ===

Presque tous les paramètres d’un thème peuvent être modifiés dans le fichier {{Path|cinnamon.css}} du thème concerné.

Exemple avec le thème Cinnamon, qui ne se trouve pas dans {{Path|/usr/share/themes}} mais dans {{Path|/usr/share/cinnamon/theme}}. Commencer par copier le répertoire de ce thème dans un sous-répertoire du dossier {{Path|~/.themes}} d’un utilisateur, nommé par exemple {{Path|autre-cinnamon}}, ce qui sera le nom du nouveau thème&nbsp;:

{{RootCmd
|mkdir /home/nomUtilisateur/.themes/autre-cinnamon
|cp -R /usr/share/cinnamon/theme /home/nomUtilisateur/.themes/autre-cinnamon/cinnamon
|chown -R nomUtilisateur:nomUtilisateur /home/nomUtilisateur/.themes/autre-cinnamon
}}

Éditer {{Path|~/.themes/autre-cinnamon/cinnamon/cinnamon.css}}. Les changements effectués peuvent être vus rapidement en sélectionnant un autre thème, puis en re-sélectionnant le thème en cours d’édition.

== Applications usuelles ==

=== Terminaux ===

* {{Package|lxde-base/lxterminal}} - Requires no dependencies.
* {{Package|x11-terms/xfce4-terminal}} - Requires some dependencies but is better featured than {{Package|lxde-base/lxterminal}}.
* {{Package|x11-terms/gnome-terminal}} Requires systemd.

=== Autres applications ===

Beaucoup d’applications sont disponibles, venant souvent de Gnome et fonctionnant très bien sous Cinnamon.

* Calculatrice ({{Package|gnome-extra/gnome-calculator}})
* Copie d’écran ({{Package|media-gfx/gnome-screenshot}})
* Visionneur d’images ({{Package|media-gfx/eog}})
* Lecteur de PDFs ({{Package|app-text/evince}})
* Moniteur système ({{Package|gnome-extra/gnome-system-monitor}})
* Gestionnaire d’archives ({{Package|app-arch/file-roller}})
* Graveur de CD/DVD ({{Package|app-cdr/brasero}})
* Éditeur de texte ({{Package|app-editors/gedit}})

{{Emerge|gnome-extra/gnome-calculator media-gfx/gnome-screenshot media-gfx/eog app-text/evince gnome-extra/gnome-system-monitor app-arch/file-roller app-cdr/brasero app-editors/gedit}}

== Dépannage ==

Si des problèmes surviennent essayer d’accéder aux messages d’erreur, qui peuvent être affichés sur un terminal séparé (par SSH) ou trouvés dans un fichier de journalisation. Ils seront affichés sur la console si Cinnamon est lancé en ligne de commande plutôt que par un gestionnaire de login. Le fichier de journalisation d’Xorg est {{Path|/var/log/Xorg.0.log}}.

Si les messages d’erreur ou d’avertissement ne suffisent pas au dépannage, lancer Cinnamon avec le paramètre <code>--debug</code> pour obtenir des messages plus détaillés :

{{FileBox|filename=~/.xinitrc|lang=bash|title=Lancement de Cinnamon en mode debug|1=
exec cinnamon-session --debug
}}

Si Cinnamon n’arrive pas à démarrer, la suppression ou le renommage du dossier {{Path|~/.cinnamon}} ne suffit pas. D’autres éléments de Gnome ou Cinnamon doivent être supprimés ou renommés avant redémarrage du serveur X, dans les répertoires {{Path|~/.cache}}, {{Path|~/.config}} et {{Path|~/.local}}. {{Path|~/.gnome2}} peut être supprimé entièrement ou renommé.

== Ressources externes ==

* [http://www.freedesktop.org/software/polkit/docs/latest/index.html Manuel de référence polkit] et [http://www.freedesktop.org/software/polkit/docs/latest/polkit.8.html sa page polkit]
* [https://fr.wikipedia.org/wiki/Couleur_du_Web L’article de Wikipedia sur les couleurs web]
* [https://wiki.gnome.org/Apps Liste d’applications Gnome]
* [http://segfault.linuxmint.com/ Nouvelles de Cinnamon]


[[Category:Desktop_environment]]
