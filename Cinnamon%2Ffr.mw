<languages />
{{InfoBox stack
|{{InfoBox homepage|http://cinnamon.linuxmint.com/|header=true}}
|{{InfoBox wikipedia|Cinnamon_(software)}}
|{{InfoBox github|linuxmint/Cinnamon}}
}}
Cinnamon est un environnement de bureau moderne, avec une interface traditionnelle qui ne déroutera pas les utilisateurs de Gnome 2,[[LXDE]] ou [[Xfce]]. Il offre des fonctionnalités et des capacités graphiques avancées. ''Embranché'' (c’est un ''fork'') depuis Gnome Shell et développé pour [http://linuxmint.com/ Linux Mint], il est disponible pour les architectures {{Keyword|amd64}} et {{Keyword|x86}}.

Installation

Prérequis

Cinnamon fonctionne avec ou sans systemd. Pour l’installer sans dépendances à systemd, choisir par {{c|eselect}} un profil sans Gnome, comme <code>default/linux/amd64/13.0/desktop</code>. Pour l’installer avec systemd, choisir un profil Gnome comme <code>default/linux/amd64/13.0/desktop/gnome</code>. Dans les deux cas l’architecture et la version peuvent être différents.

Pour obtenir une liste des profils disponibles :

{{RootCmd|eselect profile list|output=<pre>
[1] default/linux/amd64/13.0
[2] default/linux/amd64/13.0/selinux
[3] default/linux/amd64/13.0/desktop
[4] default/linux/amd64/13.0/desktop/gnome
[5] default/linux/amd64/13.0/desktop/gnome/systemd
etc.
</pre>}}

==== OpenRC ====

Sous OpenRC choisir le profil :

{{RootCmd|eselect profile set default/linux/amd64/13.0/desktop}}

Ou bien sélectionner le profil correspondant dans la liste ci-dessus :

{{RootCmd|eselect profile set 3}}

Se référer également à l’article [[Gentoo_Without_systemd|Gentoo Without Systemd]] (Gentoo sans systemd).

==== Systemd ====

Avec systemd, choisir le profil dont le nom finit par systemd :

{{RootCmd|eselect default/linux/amd64/13.0/desktop/gnome/systemd}}

{{Note|L’architecture du système (<code>amd64</code>) et sa version (<code>13</code>) peuvent différer, il importe seulement que le nom du profil finisse par <code>/gnome/systemd</code>}}.

==== Xorg ====

Pour que Cinnamon puisse fonctionner, il faut bien sûr que  [[Xorg/Guide|Xorg soit auparavant installé et configuré]]. Soyez sûr que le serveur X soit fonctionnel avant de continuer cet article… et si besoin testez-le, en suivant les indications du chapitre [[Xorg/Guide#Using_startx|Utiliser startx]] du guide Gentoo sur Xorg.

Cinnamon, comme les autres applications, est traduit dans beaucoup de langues (Linguas). Ajouter le français dans {{Path|make.conf}} si ça n’a pas été fait lors de l’installation de Gentoo, par la variable <var>LINGUAS</var> :

{{FileBox|filename=/etc/portage/make.conf|lang=bash|title=Set make.conf for French language code|1=
LINGUAS="fr" # or en, de, it, es, etc.
}}

Il est recommandé d’installer {{Package|x11-libs/gtk+extra}} et {{Package|x11-drivers/xf86-video-modesetting}}, sans lesquels Cinnamon ne fonctionnerait pas correctement :

{{Emerge|x11-libs/gtk+extra x11-drivers/xf86-video-modesetting}}

Deux variables USE, <code>icu</code> et <code>pulseaudio</code>, sont requises par des dépendances de Cinnamon. Si elles ne sont pas déjà utilisées, accepter la proposition que fait {{c|emerge}} de créer ou mettre à jour {{Path|package.use}} ou {{Path|package.use/cinnamon}} ; ou bien indiquer ces variables dans {{Path|/etc/portage/make.conf}}.

{{Note|La compilation de {{Package|net-libs/webkit-gtk}} peut être très longue sur des machines anciennes. Soyez patient, Cinnamon en vaut la peine !}}

=== Options de la variable USE  ===

{{USEflag|package=gnome-extra/cinnamon|desc=Variables USE optionnelles pour {{Package|gnome-extra/cinnamon}}:
|networkmanager++oui
|nls+oui+oui
|python_targets_python2_7+oui+oui+Build with Python 2.7
|python_targets_python3_3+++Build with Python 3.3
|python_targets_python3_4+oui+oui+Build with Python 3.4
}}

Informations supplémentaires sur ''Python targets'' dans la page [[Project:Python/PYTHON_TARGETS|PYTHON TARGETS]].

=== Emerge ===

Après les étapes ci-dessus, ''émerger'' Cinnamon :

{{Emerge|gnome-extra/cinnamon}}

== Configuration du système ==

Avant d’aborder l’aspect visuel de Cinnamon, on paramètre son lancement lors du démarrage ou sur la demande d’un utilisateur. On paramètre également les droits des utilisateurs pour qu’ils puissent interagir facilement avec le système.

=== Services ===

Le serveur X et Cinnamon requièrent les services {{c|dbus}} et {{c|consolekit}}. Les instructions qui suivent concernent OpenRC, sous systemd utiliser {{c|systemctl}}, comme indiqué dans [[Systemd#Enabling.2C_disabling.2C_starting_and_stopping_services|la page systemd]].

Lancer les services nécessaires lors du démarrage :

{{RootCmd
|rc-update add dbus default
|rc-update add consolekit default
}}

Puis lancer ces services sans redémarrer le système :

{{RootCmd
|rc-service dbus start
|rc-service consolekit start
}}

[[NetworkManager]] est une dépendance de Cinnamon qui n’est pas nécessaire si le réseau a été configuré lors de l’installation de Gentoo, et qui ne doit pas être activée si un autre service réseau est présent. Désactiver tout service réseau si vous avez besoin de NetworkManager. Par exemple, si le système a été configuré pour utiliser les scripts netifrc, en désactiver les services :

{{RootCmd
|rc-service net.eth0 stop
|rc-update del net.eth0 default
}}

{{Note|Avec {{Package|sys-fs/udev}} les interfaces réseau utilisent les [http://www.freedesktop.org/wiki/Software/systemd/PredictableNetworkInterfaceNames/noms prévisibles d’interfaces] pour leur attribuer des noms. Cela donne des noms comme {{Path|enp12s0}}, {{Path|eno1}}, {{Path|enp2s0}}, etc. Avec {{Package|sys-fs/eudev}}, l’embranchement (''fork'') de udev créé par Gentoo pour éviter les dépendances à systemd, le nom de la première interface est souvent {{Path|eth0}}.}}

After removing the other network services, add NetworkManager:

{{RootCmd
|rc-service NetworkManager start
|rc-update add NetworkManager default
}}

=== Sudo ===

For an ordinary user to reboot or shutdown the system from Cinnamon, {{c|sudo}} is needed with some settings.

First install {{Package|app-admin/sudo}}:

{{Emerge|app-admin/sudo}}

Next modify the {{c|sudo}} configuration with the {{c|visudo}} command:

{{RootCmd|visudo}}

Visudo runs the default text editor to generate or update a {{Path|sudoers}} file. Replace <code>username</code> in the text below with the username of each user that will be using Cinnamon:

{{FileBox|filename=/etc/sudoers|lang=bash|1=
username  ALL=(root) NOPASSWD: /sbin/reboot
username  ALL=(root) NOPASSWD: /sbin/halt
username  ALL=(root) NOPASSWD: /sbin/poweroff
username  ALL=(root) NOPASSWD: /sbin/shutdown
}}

Or for the {{c|wheel}} group:

{{FileBox|filename=/etc/sudoers|lang=bash|1=
%wheel  ALL=(root) NOPASSWD: /sbin/reboot
%wheel  ALL=(root) NOPASSWD: /sbin/halt
%wheel  ALL=(root) NOPASSWD: /sbin/poweroff
%wheel  ALL=(root) NOPASSWD: /sbin/shutdown
}}

=== Polkit rules and actions ===

For an ordinary user to perform additional highly privileged actions from Cinnamon, policy kit must be configured. Use {{c|pkaction}} to get a list of actions; the names should be self-explanatory:

{{RootCmd|pkaction|output=<pre>
org.cinnamon.settings-daemon.plugins.power.backlight-helper
org.cinnamon.settings-users
org.cinnamon.settingsdaemon.datetimemechanism.configure
org.freedesktop.ModemManager1.Contacts
org.freedesktop.ModemManager1.Control
org.freedesktop.ModemManager1.Device.Control
org.freedesktop.ModemManager1.Firmware
org.freedesktop.ModemManager1.Location
org.freedesktop.ModemManager1.Messaging
org.freedesktop.ModemManager1.USSD
org.freedesktop.NetworkManager.enable-disable-network
org.freedesktop.NetworkManager.enable-disable-wifi
etc.
</pre>}}

The simplest way is to authorize all actions by only testing {{c|wheel}} group membership. Put a JavaScript file in {{Path|/etc/polkit-1/rules.d}}, named for example {{Path|55-allowing-all-actions.rules}}:

{{FileBox|filename=/etc/polkit-1/rules.d/55-allowing-all-actions.rules|lang=javascript|title=Setting general polkit rule|1=
polkit.addRule (function (action, subject)
{
  if (subject.isInGroup ("wheel"))
  {
    return polkit.Result.YES;
  }
});
}}

To only authorize some actions, the action names must be iterated. For a {{c|wheel}} group user to suspend, hibernate, shutdown and restart the system, make a {{Path|55-allowing-actions.rules}} file like so:

{{FileBox|filename=/etc/polkit-1/rules.d/55-allowing-actions.rules|lang=javascript|title=Setting polkit rules|1=
polkit.addRule (function (action, subject)
{
  if (action.id == "org.freedesktop.upower.hibernate" {{!}}{{!}}
      action.id == "org.freedesktop.upower.suspend" {{!}}{{!}}
      action.id == "org.freedesktop.consolekit.system.stop" {{!}}{{!}}
      action.id == "org.freedesktop.consolekit.system.restart" &&
      subject.isInGroup ("wheel"))
      {
        return polkit.Result.YES;
      }
});
}}
Various actions can be added: those to change color profiles, use Nemo (Cinnamon files manager) as root, mount and eject media, set screen backlight, use network manager, change wallpaper, etc. Several <code>polkit.addRule (function (action, subject){&nbsp;…&nbsp;});</code> blocks can be used next to each other as well.

{{Important|{{Path|/etc/polkit-1/rules.d/50-default.rules}} already exists. Newly created file names should begin with '''55''' so they are processed after the {{Path|50-default.rules}} file. Do not make a file which would be processed before it, for instance one beginning with '''45'''.
}}

=== Starting Cinnamon ===

When not using a login/display manager, make a {{Path|.xinitrc}} file in the user's home directory:

{{FileBox|filename=~/.xinitrc|lang=bash|title=Cinnamon launch directive|1=
exec cinnamon-session
}}

Then to start Xorg and Cinnamon, execute {{c|startx}} after logging in:

{{Cmd|startx}}

With a display manager follow the [[display manager]] instructions.

== Theming ==

=== Mint-X icons ===

By default Cinnamon comes with Gnome icons. [https://github.com/linuxmint/mint-x-icons Mint-X icons are on GitHub]. Download, unzip, and put the Mint-X icon set in {{Path|/usr/share/icons}}:

{{RootCmd|mv pathToUnzippedArchive/mint-x-icons-master/usr/share/icons/Mint-X /usr/share/icons/Mint-X}}

Next, make a cache for it:

{{RootCmd|gtk-update-icon-cache /usr/share/icons/Mint-X}}

The new icon set can be selected in Cinnamon Control Center. Mint-X icons are green, but other icon sets with different colors can be installed too, like Mint-X-Grey or Mint-X-Orange. Make sure to create a cache for these as well.

{{Important|Always install the Mint-X icon set with at least one colored icon set as it relies on it.}}

=== Desktop icons text color ===

Par défaut la couleur du texte des icônes du bureau de Cinnamon est noire, ce qui n’est pas toujours lisible. La manière de changer cette couleur dépend de la version de GTK+ 3 utilisée par le système. Pour connaître la version utilisée :

{{Cmd|emerge --info x11-libs/gtk+}}

* In GTK+ versions less than 3.13.3, this setting can only be changed system-wide. Change the text color by adding CSS rules to the {{Path|/usr/share/themes/Adwaita/gtk-3.0/gtk.css}} file (Adwaita is the default theme coming with GTK+), after the <code>@import</code> line:

{{FileBox|filename=/usr/share/themes/Adwaita/gtk-3.0/gtk.css|lang=css|title=CSS rules for GTK+ &lt; 3.13.3|1=
@import url("resource:///org/gnome/adwaita/gtk-main.css");
 
/* added css rules */
.nemo-desktop.nemo-canvas-item {
  color: #fff;  /* #fff is white web color indication, #333 should be dark grey */
}
 
.nemo-desktop.nemo-canvas-item:selected {
  background-color: alpha (#fff, 0.2);  /* 0.2 is transparency level */
}
}}

: The 2<sup>nd</sup> rule concerns the selected desktop icon and can be modified to get another background color or set the transparency.

* In more recent GTK+ versions (3.13.3 onward), this must be tuned through a user-specific configuration file. Adwaita is now included in GTK+ as the theme replacing Raleigh, so rules must be set in the user's home directories. The file to edit is {{Path|~/.config/gtk-3.0/gtk.css}}, and the change is now without the <code>@import</code> line. Additionally in this example, the left Nemo side bar is gray colored:

{{FileBox|filename=~/.config/gtk-3.0/gtk.css|lang=css|title=CSS rules for GTK+ &ge; 3.13.3|1=
.nemo-desktop.nemo-canvas-item {
  color: #fff;
}
 
.nemo-desktop.nemo-canvas-item:selected {
  background-color: alpha (#fff, 0.2);
}
 
NemoWindow .sidebar, NemoWindow .sidebar .view {
  background-color: #444;
  color: #eee; /* light grey */
}
}}

=== Mint-X themes ===

Cinnamon comes with a default cinnamon theme, obviously... The Mint-X themes are [https://github.com/linuxmint/cinnamon-themes available for download] on GitHub. Download them, unzip, and copy to {{Path|/usr/share/themes}} if needed. They can be selected in the Cinnamon Control Center.

=== Playing with themes ===

Almost all theme settings can be changed in the {{Path|cinnamon.css}} file in the theme directory.

For example with the Cinnamon theme, which is not in {{Path|/usr/share/themes}} but in {{Path|/usr/share/cinnamon/theme}}, first copy the theme's directory to a user {{Path|.themes}} sub-directory, named for example {{Path|other-cinnamon}}, which will be the new theme name:

{{RootCmd
|mkdir /home/userName/.themes/other-cinnamon
|cp -R /usr/share/cinnamon/theme /home/userName/.themes/other-cinnamon/cinnamon
|chown -R userName:userName /home/userName/.themes/other-cinnamon
}}

Edit {{Path|~/.themes/other-cinnamon/cinnamon/cinnamon.css}}. The results of the changes can be viewed immediately by selecting another theme then reselecting the theme being changed.

== Common applications ==

=== Terminals ===

* {{Package|lxde-base/lxterminal}} - Requires no dependencies.
* {{Package|x11-terms/xfce4-terminal}} - Requires some dependencies but is better featured than {{Path|lxterminal}}.
* {{Package|x11-terms/gnome-terminal}} Requires systemd.

=== Other popular applications ===

A number of popular applications are available as well, often built for Gnome but working flawlessly in Cinnamon.

* standard calculator ({{Package|gnome-extra/gnome-calculator}})
* screen copy utility ({{Package|media-gfx/gnome-screenshot}})
* image viewer ({{Package|media-gfx/eog}})
* PDF reader ({{Package|app-text/evince}})
* system monitor ({{Package|gnome-extra/gnome-system-monitor}})
* archive manager ({{Package|app-arch/file-roller}})
* disk burning ({{Package|app-cdr/brasero}})
* text editor ({{Package|app-editors/gedit}})

{{Emerge|gnome-extra/gnome-calculator media-gfx/gnome-screenshot media-gfx/eog app-text/evince gnome-extra/gnome-system-monitor app-arch/file-roller app-cdr/brasero app-editors/gedit}}

== Troubleshooting ==

If problems occur, try to get access to the live error messages. These can be displayed on a separate (virtual) terminal or in a log file. If the messages cannot be found, try starting Cinnamon from the command line rather than through a display manager. Alternatively have a look at {{Path|/var/log/Xorg.0.log}}.

When the error or warning messages are not sufficient to troubleshoot Cinnamon, start it with the <code>--debug</code> parameter:

{{FileBox|filename=~/.xinitrc|lang=bash|title=Cinnamon debug launch|1=
exec cinnamon-session --debug
}}

If Cinnamon cannot launch, deleting (or renaming) {{Path|.cinnamon}} in the home directory is not enough: other Cinnamon or Gnome items must be deleted (or renamed) too before X restarts. These can be found in the XDG directories {{Path|.cache}}, {{Path|.config}} and {{Path|.local}}. {{Path|.gnome2}} can be deleted (or renamed) entirely.

== External resources ==

* [http://www.freedesktop.org/software/polkit/docs/latest/index.html polkit Reference Manual] and [http://www.freedesktop.org/software/polkit/docs/latest/polkit.8.html polkit page]
* The [https://en.wikipedia.org/wiki/Web_colors web colors Wikipedia article]
* An extensive [https://wiki.gnome.org/Apps Gnome applications list]
* [http://segfault.linuxmint.com/ Cinnamon announcements]


[[Category:Desktop_environment]]
