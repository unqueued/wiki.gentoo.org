{{InfoBox stack
|{{InfoBox homepage|http://smarden.org/runit/|header=true}}
|{{InfoBox wikipedia}}
|{{InfoBox package|sys-process/runit}}
|{{InfoBox ohloh}}
}}

{{c|runit}} is [[Article description::an init replacement with service monitoring/supervision.]] It can be used in conjunction with OpenRC as an alternative to sysvinit or even replacing OpenRC as service manager.

== Installation ==

=== USE flags ===

{{USEflag|package=sys-process/runit}}

=== Emerge ===

{{Emerge|sys-process/runit}}

== Configuration ==

=== PID 1 - init replacement ===

runit can be used as the system init. To do this, simply add <code>init=/sbin/runit-init</code> to the bootloader's kernel command-line and reboot. OpenRC (sysvinit) will remain installed and you go back to it at any time by reverting the change.

Out of the box {{c|runit-init}} has a very minimal configuration which will only get to a console login. Although it would be optimal to have all the daemons started up in a single consistent way, users are free to mix and match between runit and OpenRC as desired. Init scripts can be found in the "default" runlevel, which can be started  automatically on boot with the existing "local" service:

{{FileBox|filename=/etc/local.d/rc-default.start|title=Start up the default runlevel after boot|lang=bash|1=
#!/bin/sh
rc default}}
{{RootCmd|chmod u+x /etc/local.d/rc-default.start}}
{{RootCmd|rc-update add local boot}}

Alternatively, add <code>RUNLEVEL=S /sbin/rc default</code> to {{Path|/etc/runit/1}} as seen below:

{{FileBox|filename=/etc/runit/1|1=
RUNLEVEL=S /sbin/rc sysinit
RUNLEVEL=S /sbin/rc boot
RUNLEVEL=S /sbin/rc default
}}

Or, for those who prefer to do it manually:

{{RootCmd|rc default}}

==== Reboot and shutdown ====

Runit is not directly compatible with sysvinit's {{c|telinit}}, {{c|halt}}, {{c|poweroff}}, {{c|reboot}}, and {{c|shutdown}} commands, however many programs (e.g. desktop environments) expect to be able to call some of these during operation.

sysvinit's functionality can be restored using some one-liner, workaround shell scripts:

{{FileBox|filename=$PATH/shutdown|lang=bash|1=
#!/bin/sh
runit-init 0
}}

{{FileBox|filename=$PATH/reboot|lang=bash|1=
#!/bin/sh
runit-init 6
}}

=== Init and service manager ===

Runit can also replace OpenRC as the service manager. To achieve this, delete all lines starting with <code>RUNLEVEL=S</code> in {{Path|/etc/runit/1}}. However, one will have to replace the boot scripts and OpenRC's service scripts with it's own (or [https://github.com/powerman/powerman-overlay use an overlay]) that do the same tasks (to see what tasks are being executed by OpenRC, one could run {{c|rc-status sysinit}} and {{c|rc-status boot}}).

=== OpenRC supervision service ===

Runit can supervise processes without running as init, or even necessarily as root:

{{Cmd|mkdir /path/to/service-dir/}}

{{GenericCmd|(Create your service directories and run scripts here, using the same layout as /etc/runit/runsvdir/all/)}}

{{Cmd|chmod a+x /path/to/service-dir/*/run}}

==== Local service ====

OpenRC can start this for you using {{Path|/etc/init.d/local}} (see {{Path|/etc/local.d/README}} for more details):

{{FileBox|filename=/etc/local.d/runsvdir.start|lang=bash|1=
#!/bin/sh
# Remember to add --user if you don't want to run as root!
start-stop-daemon --start --background --make-pidfile \
    --pidfile /run/runsvdir.pid \
    --exec /usr/bin/runsvdir -- /path/to/service-dir/
}}

{{FileBox|filename=/etc/local.d/runsvdir.stop|lang=bash|1=
#!/bin/sh
start-stop-daemon --stop --pidfile /run/runsvdir.pid
}}

==== OpenRC service ====

This does the same as the {{Path|local.d}} script above, but using OpenRC proper. As such, you can use the extra features it provides like init script multiplexing.

{{FileBox|filename=/etc/init.d/runsvdir|lang=bash|1=
#!/sbin/openrc-run
command="runsvdir"
command_args="/etc/service"
pidfile="/run/${SVCNAME}.pid"
command_background="true"
description="starts and monitors a collection of runsv(8) processes"
retry="SIGHUP/5"

depend() {
    need localmount
}
}}

== See also ==

* [[Comparison of init systems]]

== External resources ==

* [https://wiki.archlinux.org/index.php/runit Arch Linux Wiki]
* [https://forums.gentoo.org/viewtopic-p-7605220.html Gentoo Forums]
* [https://wiki.voidlinux.eu/Runit Void Linux Wiki]
* [https://bitbucket.org/avery_payne/supervision-scripts/ supervision-scripts]: a large, modular collection of scripts that can be used with runit.
* [https://github.com/powerman/powerman-overlay powerman-overlay]: an overlay which contains many runit service files.

[[Category:Init systems]]
[[Category:Process Supervision]]
[[Category:Daemons]]
