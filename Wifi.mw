<translate>
{{InfoBox stack
|{{InfoBox homepage|http://wireless.kernel.org/|header=true}}
|{{InfoBox wikipedia|Wi-Fi}}
}}

This article describes the setup of a Wifi network device.

== Wifi during installation  ==

If a Wifi connection is needed while installing Gentoo, note that the Gentoo minimal install CD has a limited number of drivers available, and provides only wpa_cli (and not wpa_gui) for configuring for WPA/WPA2/Enterprise connections.

If the minimal install CD does not contain the required drivers or the graphical frontend to [[wpa_supplicant]] is preferred, choose a different live CD such as the [http://sysresccd.org System Rescue CD]. Be aware that some [[Installation_alternatives#Installation_from_non-Gentoo_LiveCDs|special steps]] may be required when using a non-Gentoo live CD.

== Hardware detection ==

First detect the Wifi controllers. {{c|[[Hardware detection#lspci|lspci]]}} or {{c|[[Hardware detection#lsusb|lsusb]]}} are command-line tools that can be used for this task. 

If a Linux (LiveCD/USB) is booted that makes a Wifi connection:

{{RootCmd|lspci -k}}

The driver will be identified with <code>Kernel driver in use:</code>.

If the booted system does not make a Wifi connection, then obtain a full list of hardware identifiers from the current system. This list can be used to identify the proper driver later:

{{RootCmd|lspci -n}}

Copy the list of PCIID's that the command produces and paste it at http://kmuto.jp/debian/hcl/.

For USB devices, a similar approach can be taken. First obtain the list of detected USB devices on the system:

{{Cmd|lsusb}}

This command produces the PCI ID, manufacturer, make, model, and/or chipset of every USB device attached to the system. Of these, the chipset may be the most useful information. Googling ''linuxwireless.org <chipset>'' is often the shortest way to find a USB NIC driver and firmware name.

Alternatively, {{c|lshw}} can be used to obtain the necessary information:

{{RootCmd|lshw {{!}} grep -i driver}}

This command produces a list of all drivers, regardless of the device being PCI or USB based.

== Kernel ==

With the drivers identified, it is time to configure the Linux kernel.

=== IEEE 802.11 ===

{{:Wifi/IEEE 802.11}}

=== WEXT ===

The "cfg80211 wireless extensions compatibility" option aka WEXT will support old [[Handbook:Parts/Networking/Wireless#Wireless_tools|wireless-tools]] & [https://wireless.wiki.kernel.org/en/users/documentation/iw/replace-iwconfig iwconfig].
{{KernelBox|1=
[*] Networking support  --->
    [*] Wireless  --->
        [*]     cfg80211 wireless extensions compatibility
}}

=== Device drivers ===

Next the right set of corresponding kernel options need to be enabled, based on the drivers and hardware detected previously. The [http://forums.gentoo.org/viewtopic-p-7640140.html#7640140 recommendation] is to build [[Kernel_Modules#Compile-in-kernel_modules_vs_Loadable_kernel_modules_.28LKMs.29|drivers as modules]]. Also be sure to enable AES cipher support in the kernel if the wireless network uses WPA or WPA2 encryption.

{{KernelBox|<pre>
    Device Drivers  --->
    [*] Network device support  --->
        [*] Wireless LAN  --->
 
            Select the driver for your Wifi network device, e.g.:
            <M> Broadcom 43xx wireless support (mac80211 stack) (b43)
            [M]    Support for 802.11n (N-PHY) devices
            [M]    Support for low-power (LP-PHY) devices
            [M]    Support for HT-PHY (high throughput) devices
            <M> Intel Wireless WiFi Next Gen AGN - Wireless-N/Advanced-N/Ultimate-N (iwlwifi)
            <M>    Intel Wireless WiFi DVM Firmware support                             
            <M>    Intel Wireless WiFi MVM Firmware support
            <M> Intel Wireless WiFi 4965AGN (iwl4965)
            <M> Intel PRO/Wireless 3945ABG/BG Network Connection (iwl3945)
            <M> Ralink driver support  --->
                <M>   Ralink rt27xx/rt28xx/rt30xx (USB) support (rt2800usb)
 
-*- Cryptographic API --->
    -*- AES cipher algorithms
    -*- AES cipher algorithms (x86_64)
    <*> AES cipher algorithms (AES-NI)
</pre>}}

{{Important|In case the driver is built into the kernel (<code><*></code>) instead of as a module (<code><M></code>), then the firmware needs to be built [[Kernel_Modules#Compile-in-kernel_modules_vs_Loadable_kernel_modules_.28LKMs.29|into the kernel]] as well.
<br />Do not forget to [[Kernel/Rebuild|rebuild the kernel]] after changing its configuration.}}

=== LED support ===

To enable LED triggers for different packet receive/transmit events, compile the kernel with the following options:

{{KernelBox|<pre>
Device Drivers  --->
    [*] LED Support  --->
        <*>   LED Class Support
 
[*] Networking support  --->
    [*] Wireless  --->
        [*] Enable LED triggers
</pre>
}}

== Firmware ==

In addition to the kernel driver, some chipsets also require firmware. If required, locate it on the following list and install it:

{{Emerge|sys-kernel/linux-firmware}}

<div class="mw-collapsible">
{| class="table table-condensed table-striped"
|-
! Wifi device
! Driver
! Firmware
! Note
|-
| Atheros AR9271 & AR7010 
| ath9k_htc
| {{Package|sys-kernel/linux-firmware}}
|
|-
| Broadcom 43xx wireless support
| b43 / b43legacy
| {{Package|sys-firmware/b43-firmware}}
| aircrack-ng ready, most probably the best choice [http://wireless.kernel.org/en/users/Drivers/b43#Supported_devices if your bcm43xx device is supported]
|-
| Broadcom 43xx wireless support (e.g. 4313)
| brcmsmac / brcmfmac
| {{Package|sys-kernel/linux-firmware}}
| no powersave, LED support and [http://wireless.kernel.org/en/users/Drivers/brcm80211#To_be_done_for_softmac_driver other features]
|-
| Broadcom 43xx wireless support
| wl
| {{Package|net-wireless/broadcom-sta}}
| proprietary, no AP or Monitor modes, [http://wireless.kernel.org/en/users/Drivers/b43#Comparison_of_recent_drivers comparision of bcm43xx drivers]
|-
| Intel PRO/Wireless 2200BG
| ipw2200
| {{Package|sys-firmware/ipw2200-firmware}}
|
|-
| [[Intel Corporation PRO/Wireless 3945ABG|Intel PRO/Wireless 3945ABG/BG]]
| iwl3945
| {{Package|sys-kernel/linux-firmware}}
|
|-
| Intel Wireless WiFi 4965AGN
| iwl4965
| {{Package|sys-kernel/linux-firmware}}
|
|-
| Intel Wireless WiFi 5100AGN, 5150AGN, 5300AGN, 5350AGN
| [[iwlwifi]]
| {{Package|sys-kernel/linux-firmware}}
|
|-
| Intel Centrino Wireless-N 1000
| [[iwlwifi]]
| {{Package|sys-firmware/iwl1000-ucode}} or {{Package|sys-kernel/linux-firmware}}
|
|-
| Intel Centrino Ultimate-N 6300, Advanced-N 6200
| [[iwlwifi]]
| {{Package|sys-firmware/iwl6000-ucode}} or {{Package|sys-kernel/linux-firmware}}
|
|-
| Intel Centrino Advanced-N + WiMAX 6250, Wireless-N + WiMAX 6150 
| [[iwlwifi]]
| {{Package|sys-firmware/iwl6050-ucode}} or {{Package|sys-kernel/linux-firmware}}
|
|-
| Intel Centrino Advanced-N 6205
| [[iwlwifi]]
| {{Package|sys-firmware/iwl6005-ucode}} or {{Package|sys-kernel/linux-firmware}}
|
|-
| Intel Centrino Advanced-N 6230, Wireless-N 1030, Wireless-N 130
| [[iwlwifi]]
| {{Package|sys-firmware/iwl6030-ucode}} or {{Package|sys-kernel/linux-firmware}}
|
|-
| Intel Centrino Wireless-N 2200, 2230
| [[iwlwifi]]
| {{Package|sys-kernel/linux-firmware}}
|
|-
| Intel Centrino Wireless-N 100, 105, 135
| [[iwlwifi]]
| {{Package|sys-kernel/linux-firmware}}
|
|-
| Intel Wireless 3160
| [[iwlwifi]]
| {{Package|sys-firmware/iwl3160-ucode}} or {{Package|sys-kernel/linux-firmware}}
| Requires kernel parameter Device-Drivers->Network device support->Wireless LAN->Intel Wireless WiFi MVM Firmware support
|-
| Intel Wireless 7260
| [[iwlwifi]]
| {{Package|sys-firmware/iwl7260-ucode}} or {{Package|sys-kernel/linux-firmware}}
| Requires kernel parameter Device-Drivers->Network device support->Wireless LAN->Intel Wireless WiFi MVM Firmware support
|-
| Ralink driver support
| e.g. rt2800usb
| {{Package|sys-kernel/linux-firmware}}
|
|}
</div>

If the driver requires firmware but does not appear on the list, it will be necessary to download it manually and place it in {{Path|/lib/firmware}}.

== Testing ==

After a reboot with the new kernel or after loading the modules, the device can be checked for availability by using using one of following methods:
* Using the {{Path|/sys}} file system
* Using the {{c|ip}} command
* Using the {{c|ifconfig}} command
* Using the {{c|iw}} command

{{Note|The name of the device may be different, e.g. eth1 or ath0 or a name as described in [[Handbook:Parts/Networking/Advanced#Network_interface_naming|Network interface naming]] if {{Package|sys-fs/udev}} version 200 or greater is used with default configuration.}}

If none of these methods work be sure to check {{c|dmesg}} output for errors. It is likely a kernel driver or module has not been loaded properly:

{{Cmd|dmesg}}

=== /sys file system ===

Get the device name by listing the {{Path|/sys/class/net}} directory using the {{c|tree}} command ({{Package|app-text/tree}}):

{{Cmd|tree {{Path|/sys/class/net}}|output=<pre>
/sys/class/net/
├── enp2s14 -> ../../devices/pci0000:00/0000:00:1e.0/0000:02:0e.0/net/enp2s14
├── lo -> ../../devices/virtual/net/lo
├── sit0 -> ../../devices/virtual/net/sit0
└── wlp8s0 -> ../../devices/pci0000:00/0000:00:1c.0/0000:08:00.0/net/wlp8s0</pre>}}

=== ip command ===

To obtain the device name and verify that the wireless card is detected, execute the following {{c|ip}} command ({{package|sys-apps/iproute2}}):

{{Cmd|ip addr|output=<pre>
3: wlan0:   ...
</pre>}}

=== ifconfig command ===

The {{c|ifconfig}} command is provided through the {{package|sys-apps/net-tools}}) package. Use {{c|ifconfig -a}} to list all detected network cards, even those that are not enabled/active yet:

{{Cmd|ifconfig -a|output=<pre>
wlan0     ...
</pre>}}

A network card can be activated as follows:

{{RootCmd|ifconfig -v wlan0 up|output=<pre>
SIOCSIFFLAGS: Operation not possible due to RF-kill
WARNING: at least one error occurred. (-1)
</pre>}}

In this example, enabling the wireless card failed as a radio frequency kill state is set (usually to keep power consumption at bay and not connect by accident to a wireless network).

=== iwconfig command ===

The {{c|iwconfig}} command is provided by the {{Package|net-wireless/wireless-tools}} package. This command works if the kernel has the [[#WEXT|wireless extensions stack]] enabled. Non-wireless interfaces will be listed with "no wireless extensions":

{{RootCmd|iwconfig|output=<pre>wlan0     IEEE 802.11abg  ESSID:"..."  
          Mode:Managed  Frequency:2.462 GHz  Access Point: ..:..:..:..:..:..   
          ...   
          Link Quality=52/70  Signal level=-58 dBm  
          Rx invalid nwid:0  Rx invalid crypt:0  Rx invalid frag:0
          Tx excessive retries:0  Invalid misc:434   Missed beacon:0

lo        no wireless extensions.
sit0      no wireless extensions.
eth0      no wireless extensions.
</pre>}}

=== iw command ===

If the wireless network card driver supports the nl80211 stack, then the {{c|iw}} command as offered by the {{Package|net-wireless/iw}} package can show the detected wireless cards:

{{RootCmd|iw dev|output=<pre>
   phy#0
	Interface wlan0
		ifindex 4
		type managed
</pre>}}

== Troubleshooting ==

* [https://forums.gentoo.org/viewtopic-p-7888312.html#7888312 Forum thread: wireless lan can't get ip from access point] which explains about 169.254.x.x ([[wikipedia:Link-local_address|link local address]]) being a wrong IP address
* [https://forums.gentoo.org/viewtopic-p-7647960.html#7647960 Forum thread: iwlwifi fails to load after upgrade to 3.17.0]
* [https://forums.gentoo.org/viewtopic-t-1016976-start-3.html Forum thread: Where is my network !?]

== See also ==

* [[AC1200 Wireless Adapters]]

== External resources ==

* [https://wireless.wiki.kernel.org/en/developers/documentation/wireless-extensions Wireless extensions] on the Linux kernel wiki, wireless section

</translate>

[[Category:Network devices]]
[[Category:Network_management]]
