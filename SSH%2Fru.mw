<languages />

{{InfoBox stack
|{{InfoBox Домашняя страница|http://www.openssh.org|header=true}}
|{{InfoBox Википедия|Secure Shell}}
}}
'''SSH''' ('''S'''ecure '''SH'''ell) это программа терминала, использующая шифрование, которая заменяет классическую программу [[Wikipedia:telnet|telnet]] на Unix и подобных ей операционных системах.

Кроме удаленного терминального доступа (который предоставляет главная программа '''ssh'''), пакет программ SSH вырос, и включает, например, '''scp''' (очень часто), и '''sftp''' (менее часто).

Изначально SSH была не свободной программой. Однако сегодня самой популярной и де-факто стандартной версией SSH является версия OpenSSH из операционной системы [http://www.openbsd.org/ OpenBSD], которая предустановлена на Gentoo.

== Запускаем OpenSSH ==

=== Сервер ===
Сервер OpenSSH может контролироваться, как и любой другой сервис, управляемый [[OpenRC]], с помощью '''/etc/init.d/ssh start''', '''/etc/init.d/ssh stop''', и '''/etc/init.d/ssh restart'''.

Заметьте, что активные соединения к серверу остаются нетронутыми, когда вы набираете '''/etc/init.d/ssh restart''', в то время как '''/etc/init.d/ssh stop''', и, за ней, '''/etc/init.d/ssh start''' могут вызвать обрыв соединения.

== Конфигурация ==

=== Конфигурация сервера ===
Сервер SSH обычно конфигурируется в файле {{Path|/etc/ssh/sshd_config}}, хотя возможно провести дополнительную конфигурацию в файле OpenRC {{Path|/etc/conf.d/sshd}}, включая изменение местоположения первого файла. Для более детальной информации о том, как сконфигурировать сервер, смотри [[man page|man-страницу]] ''sshd_config''.

Вы также можете изучить этот [https://dev.gentoo.org/~swift/docs/security_benchmarks/openssh.html гайд] для конфигурации, ориентированной на безопасность.

=== Конфигурация клиента ===
Клиент '''ssh''' и относящиеся к нему программы ('''scp''', '''sftp''' и другие) конфигурируются в файле {{Path|/etc/ssh/ssh_config}}. Для более детальной информации по конфигурации этих программ, смотри man-страницу ''ssh_config''.

=== Безпарольная аутентификация ===
Очень полезна для работы с [[git]] сервером.

==== Клиент ====
На вашем клиенте запустите
{{Cmd|ssh-keygen -t rsa}}
Затем нажмите enter около 5 раз для генерации вашего ключа.
Перенесите клиентский файл ~/.ssh/id_rsa.pub на сервер, к тому пользователю, которым вы входите, в ~/.ssh/authorized_keys

==== Сервер ====
Добавьте пользователя с помощью useradd

Затем поместите клиентский файл id_rsa.pub в файл нового пользователя ~/.ssh/authorized_keys.

==== Single Machine Testing ====
{{Cmd|ssh-keygen -t rsa}}
enter 5 times

{{Cmd|mv ~/.ssh/id_rsa.pub ~/.ssh/authorized_keys}}
{{Cmd|ssh localhost}}

== Troubleshooting ==
There are 3 different levels of debug modes.  ''-v'' Causes ssh to print debugging messages about its progress.  This is helpful in debugging connection, authentication, and configuration problems.  Multiple -v options increase the verbosity.  The maximum is 3.

debug1 mode:
{{Cmd|ssh example.org -v}}

debug2 mode:
{{Cmd|ssh example.org -vv}}

debug3 mode:
{{Cmd|ssh example.org -vvv}}

=== Death of Long-lived Connections ===
Many internet access devices perform network address translation ([[NAT]]), a process that enables devices on a private network such as that typically found in a home or business place to access foreign networks, such as the internet, despite only having a single IP address on that network.  Unfortunately, not all NAT devices are created equal, and some of them incorrectly close long-lived, occasional-use TCP connections such as those used by SSH.  This is generally observable as a sudden inability to interact with the remote server, though the '''ssh''' client program has not exited.

In order to resolve the issue, OpenSSH clients and servers can be configured to send a 'keep alive', or invisible message aimed at maintaining and confirming the live status of the link.
* To enable keep alive '''for all clients connecting to your local server''', set ''ClientAliveInterval 30'' (or some other value, in seconds) within the {{Path|/etc/ssh/sshd_config}} file.
* To enable keep alive '''for all servers connected to by your local client''', set ''ServerAliveInterval 30'' (or some other value, in seconds) within the {{Path|/etc/ssh/ssh_config}} file.

== See also ==
* [https://dev.gentoo.org/~swift/docs/security_benchmarks/openssh.html Securing OpenSSH] - Gentoo developer documentation.
* [http://www.gentoo.org/doc/en/articles/openssh-key-management-p1.xml OpenSSH Key Management Part1] - Gentoo documentation, have a look at all 3 parts.
* [http://www.gentoo.org/doc/en/keychain-guide.xml Gentoo Linux Keychain Guide]
* [[autossh]] - Detects when SSH connections drop and auto-reconnects.


[[Category:SSH]]
[[Category:Server]]
[[Category:Daemons]]
