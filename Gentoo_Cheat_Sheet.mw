This is [[Article description::a reference card of useful commands for administrating Gentoo systems.]] Newcomers and grey beards alike are encouraged to add their helpful tips below.

== Package management ==

=== Sync methods ===

Sync all repositories that are set to auto-sync including the Gentoo ebuild repository:

{{RootCmd|emaint -a sync}}

Sync the Gentoo ebuild repository using the mirrors by obtaining a snapshot that is (at most) a day old:

{{RootCmd|emerge-webrsync}}

Sync [[Custom repository|custom package repository]] and the Gentoo ebuild repository using [[eix]]:

{{RootCmd|eix-sync}}

{{package|app-portage/eix}} can be installed by issuing:

{{RootCmd|emerge -a eix}}

Gather more information on {{c|eix}} by reading its manual:

{{Cmd|man eix}}

=== Package listings ===

qlist is provided by {{package|app-portage/portage-utils}}

List installed packages with version number and name of used overlay:

{{RootCmd|qlist -IRv}}

=== Package installation and removal ===

In the following tips {{Package|www-client/firefox}} will be used as an example, substitute Firefox with the package of interest to perform the actions on another package.

List what packages would be installed without installing them:

{{RootCmd|emerge -pv www-client/firefox}}

Install a specific version of a package (Use '\=' if your shell attaches meaning to '='):

{{RootCmd|emerge {{=}}www-client/firefox-24.8.0}}

Install a package but excluding it from the world file:

{{RootCmd|emerge --oneshot www-client/firefox}}
or
{{RootCmd|emerge -1 www-client/firefox}}

Remove a package that no other packages depend on:

{{RootCmd|emerge -cav www-client/firefox}}

Remove a package even if it is needed by other packages:

{{RootCmd|emerge -C www-client/firefox}}

{{Warning|Use with caution. This can break software.  Best if used to temporarily remove to satisfy a hard block.}}

Remove packages no longer needed:

{{RootCmd|emerge -av --depclean}}

As a safety measure, depclean will not remove any packages unless '''all''' required dependencies have been resolved. As a consequence of this, it often becomes necessary to run:

{{RootCmd|emerge --update --newuse --deep @world}}

Avoid unnecessary rebuilds when USE flags only get added to or dropped from the repository:

{{RootCmd|emerge --update --changed-use --deep @world}}

=== Package upgrades ===

Upgrade all installed packages, dependencies, and deep dependencies that are outdated or have USE flag changes (avoiding unnecessary rebuilds when USE changes have no impact):

{{RootCmd|emerge -uDU --keep-going --with-bdeps{{=}}y @world}}

=== Package troubleshooting ===

Check for and rebuild missing libraries:

{{RootCmd|revdep-rebuild -v}}

{{c|equery}} is part of {{package|app-portage/gentoolkit}}. You can obtain it by issuing this command:

{{RootCmd|emerge -a gentoolkit}}

Tell which installed package provides a command using [[equery]]:

{{Cmd|equery b `which vim`}}

Tell which packages depend on a specific package (cat/pkg in the example) using [[equery]]:

{{Cmd|equery d www-client/firefox}}

Get information about a package using [[eix]]:

{{RootCmd|eix www-client/firefox}}

=== Portage enhancements ===

A graphical user interface to use with the Portage tree:

{{RootCmd|porthole}}

Manage configuration changes after an emerge completes:

{{RootCmd|dispatch-conf}}

=== After installations or updates ===

Rebuilds packages that depend on an recently updated library:

{{RootCmd|revdep-rebuild}}

After updating [[perl]]-core packages:

{{RootCmd|perl-cleaner --all}}

or if previous didn't help:

{{RootCmd|perl-cleaner --reallyall -- -av}}

For [[haskell]] packages:

{{RootCmd|haskell-updater}}

== USE flags ==

Obtain descriptions and usage of the USE flag <code>X</code> using [[Gentoolkit#euse|euse]]:

{{Cmd|euse -i X}}

Gather more information on {{c|euse}} by reading its manual page:

{{Cmd|man euse}}

Obtain a description of the <code>png</code> USE flag:

{{Cmd|euse -i {{!}} grep png}}

Show what packages have the <code>mysql</code> USE flag:

{{Cmd|equery hasuse mysql}}

Show what packages are currently built with the <code>mysql</code> USE flag:

{{Cmd|eix --installed-with-use mysql}}

Show what USE flags are available for a specific package:

{{Cmd|equery uses <package-name>}}

Quickly add a required USE flag for a package install:

{{RootCmd|echo 'dev-util/cmake -qt4' >> /etc/portage/package.use}}

=== Important Portage files<ref group="i">[[:/etc/portage]]</ref> ===

* {{Path|[[:/etc/portage/make.conf]]}} - Global settings (USE flags, compiler options).
* {{Path|[[:/etc/portage/package.use]]}} - USE flags of individual packages. Can also be a folder containing multiple files.
* {{Path|[[:/etc/portage/package.accept_keywords]]}} - Keyword individual packages; e.g. {{Keyword|~amd64}}, {{Keyword|~x86}}, or {{Keyword|∼arm}}.
* {{Path|[[:/etc/portage/package.license]]}} - Accepted licenses
* {{Path|[[World_set_(Portage)|/var/lib/portage/world]]}} - List of explicitly installed package atoms.
* {{Path|/var/db/pkg}} - Contains for every installed package a set of files about the installation.

== Log management ==

=== genlop ===

[[genlop]] is a Portage log processor, also estimating build times when emerging packages.

Install {{c|genlop}} by issuing:

{{RootCmd|emerge -a app-portage/genlop}}

You can gather more information on {{package|app-portage/genlop}} by reading its manual page:

{{RootCmd|man genlop}}

View the last 10 emerges (installs):

{{RootCmd|genlop -l {{!}} tail -n 10}}

View how long emerging LibreOffice took:
 
{{RootCmd|genlop -t libreoffice}}

Estimate how long {{c|emerge -uND --with-bdeps{{=}}y @world}} will take:

{{RootCmd|emerge -pU @world {{!}} genlop --pretend}}

Watch the latest merging ebuild during system upgrades:

{{RootCmd|watch genlop -unc}}

== Services ==

Obtain root shell (if the current user is listed in the sudoers list):

{{Cmd|sudo -i}}

=== OpenRC ===

Start the ssh daemon in the default runlevel at boot:

{{RootCmd|rc-update add sshd default}}

Start the sshd service now:

{{RootCmd|rc-service sshd start}}

Check if the sshd service is running:

{{RootCmd|rc-service sshd status}}

=== systemd ===

Start the ssh daemon at boot:

{{RootCmd|systemctl enable sshd}}

Start the sshd service now:

{{RootCmd|systemctl start sshd}}

Check if the sshd service is running:

{{RootCmd|systemctl status sshd}}

== Gentoo Monthly Newsletter (GMN) ==

Search packages in Portage by regular expressions:

{{RootCmd|emerge -s "%^python$"}}

Overlays vary from very small to very large in size. As a result they slow down the majority of Portage operations. That happens because overlays do not contain metadata caches. The cache is used to speed up searches and the building of dependency trees. A neat trick is to generate local metadata cache after syncing overlays.

{{RootCmd|emerge --regen}}

This trick also works in conjunction with eix. {{c|eix-update}} can use metadata cache generated by {{c|emerge –-regen}} to speed up things. To enable this, add the following variable to {{path|/etc/eixrc/00-eixrc}}:

{{FileBox|filename=/etc/eixrc/00-eixrc|1=
OVERLAY_CACHE_METHOD="assign"
}}

=== qcheck ===

Use {{c|qcheck}} to verify installed packages:

{{RootCmd|qcheck -e vim-core}}

{{c|qcheck}} comes with {{package|app-portage/portage-utils}} and can be installed by running this command:

{{RootCmd|emerge -a app-portage/portage-utils}}

Learn more about {{c|qcheck}} by reading its manual page:

{{cmd|man qcheck}}

== See also ==

{{reflist|group="i"}}

== External resources ==

* [https://github.com/jonasstein/gentoo-cheat Original gentoo-cheat repository]
* [https://forums.gentoo.org/viewtopic-p-7370146.html Forum post about gentoo-cheat]
* [http://bradleymacomber.com/ref/Gentoo/ Another Gentoo cheat sheet]
* [https://forums.gentoo.org/viewtopic-t-529919.html Collection of Gentoo tips]
* [http://wikigentoo.ksiezyc.pl/Newbie_cheat_sheet.htm Newbie cheat sheet]

== References ==

{{reflist}}

[[Category:Core system]]
[[Category:Portage]]
