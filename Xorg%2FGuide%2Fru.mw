<languages />

{{Metadata|abstract=Xorg - это сервер оконной системы X Window, который позволяет пользователю организовать для себя графическую рабочую среду. Это руководство объясняет что такое Xorg, как его установить и за что отвечают различные параметры конфигурации.}}

Xorg - это сервер оконной системы [[X server|X Window server]], который позволяет пользователю организовать для себя графическую рабочую среду. Это руководство объясняет что такое Xorg, как его установить и за что отвечают различные параметры конфигурации.

== Что такое сервер оконной системы X Window? ==

=== Графический интерфейс против командной строки ===

Среднестатистический пользователь может быть встревожен мыслью о том, что ему придётся вводить команды. Почему бы ему не щёлкать мышью с той свободой, какую предоставляет Gentoo (и вообще Linux)? Конечно же, это возможно! Linux предлагает широкий выбор бросающихся в глаза пользовательских интерфейсов и сред, которые можно установить поверх существующей установки. 

Это один из огромных сюрпризов для новых пользователей: графический интерфейс ничего более, чем приложение, запущенное на их системе. Это не часть ядра Linux и вообще не внутренняя часть системы. Это мощное средство для полной поддержки графических возможностей рабочей станции. 

Стандарты важны, и стандарт для отрисовки и перемещения окон на экране, взаимодействующий с мышью, клавиатурой и другим оборудованием, а также включающий иные важные аспекты, был создан и назван ''X Window System'', обычно сокращенный до ''X11'' или просто ''X''. Он используется на Unix, Linux и Unix-подобных операционных системах по всему миру. 

Приложением, которое дает возможность пользователям Linux запускать графический интерфейс и использующее стандарт X11, является Xorg-X11, форк проекта XFree86. В XFree86 используется не совместимая с GPL лицензия; следовательно, рекомендуется использовать Xorg. Официальное дерево Portage больше не предоставляет пакет XFree86.

=== Проект X.org ===

Проект [http://www.x.org X.org] создан и поддерживается как свободно распространяемая реализация системы X11 с открытым исходным кодом. А также это основанная на X11 инфраструктура рабочего стола. 

Xorg обеспечивает интерфейс между вашим аппаратным обеспечением и графическим программным обеспечением, которое вы хотите запустить. Помимо этого, Xorg умеет работать в сети, что позволяет запускать программу на одной системе, а смотреть на другой. 

== Установка ==

До того, как вы установите Xorg, вам необходимо подготовить систему к этому. Во-первых, настроим ядро для поддержки устройств ввода и видеокарт. Затем, мы подготовим {{Path|[[:/etc/portage/make.conf]]}} так, чтобы нужные драйверы и Xorg пакеты были собраны и установлены. 

=== Поддержка устройств ввода ===

По умолчанию, Xorg использует <code>[[evdev]]</code>, общий драйвер для устройств ввода. Вам нужно включить поддержку для <code>evdev</code> путем внесения изменений в вашу конфигурацию ядра. Смотрите [[Kernel/Gentoo_Kernel_Configuration_Guide/ru|руководство по конфигурации ядра]], если вы не знаете как настроить ваше ядро. 

{{KernelBox|title=Включение поддержки evdev в ядре|<pre>
Device Drivers --->
  Input device support --->
  <*>  Event interface
</pre>
}}

=== Установка режима в ядре ===

Современные видео драйверы с открытым исходным кодом полагаются на (kernel mode setting KMS). KMS предоставляет улучшенную графическую загрузку с меньшим мерцанием, более быстрым переключением пользователей, встроенной в кадровый буфер консолью, плавным переключением из консоли в Xorg и другие возможности.

{{Important|KMS конфликтует со старыми драйверами кадрового буфера, которые должны оставаться в состоянии '''disabled''' в настройке ядра.}}

Начальная подготовка ядра для KMS. На этом шаге не имеет значения, какой Xorg видео драйвер будет использоваться. 

{{KernelBox|title=Отключение поддержки старого кадрового буффера и включение вместо него поддержки основного кадрового буфера для консоли|<pre>
Device Drivers --->
   Graphics support --->
      Frame Buffer Devices --->
         <*> Support for frame buffer devices --->
         ## (Отключите все драйвера, включая VGA, Intel, nVidia и ATI, оставьте поддержку кадрового буфера EFI, только если вы используете UEFI)
 
    ## (Дальше, включите кадровый буфер для консоли. Его использует KMS.)
    Console display driver support --->
      <*>  Framebuffer Console Support
</pre>
}}

Далее настройте ядро для использования правильного KMS драйвера для видеокарты. Intel, nVidia и AMD/ATI являются распространенными видеокартами, поэтому смотрите соответствующие настройки ниже для каждой видеокарты. 

Для видеокарт Intel смотрите [[Intel#Kernel|kernel section of the Intel article]].

Для видеокарт nVidia: 

{{KernelBox|title=Настройки nVidia|<pre>
Device Drivers --->
   Graphics support --->
      Direct Rendering Manager (XFree86 4.1.0 and higher DRI support) --->
         <*>  Nouveau (nVidia) cards
</pre>
}}

Для новых AMD/ATI карт ([[ATI_FAQ|RadeonHD 2000 and up]]), установите пакет {{Package|x11-drivers/radeon-ucode}} или {{Package|sys-kernel/linux-firmware}}. Когда один из этих пакетов будет установлен, настройте ядро как написано в [[Radeon#Firmware|firmware section]] из [[Radeon|Radeon article]]: 

{{KernelBox|title=Настройка AMD/ATI|<pre>
## (Установка ядра на использование прошивки radeon-ucode)
Device Drivers --->
   Generic Driver Options --->
   [*]  Include in-kernel firmware blobs in kernel binary
  ## # Только для карт ATI, (см. страницу Radeon для детализации включенных в прошивку файлов)
   (radeon/<CARD-MODEL>.bin ...)
  ## # Определение корневой директории
   (/lib/firmware/) External firmware blobs to build into the kernel binary
 
## (Включить поддержку Radeon в KMS)
Device Drivers --->
   Graphics support --->
   <*>  Direct Rendering Manager --->
   <*>    ATI Radeon
   [*]      Enable modesetting on radeon by default
   [ ]      Enable userspace modesetting on radeon (DEPRECATED)
</pre>
}}

{{Note|Старые карты Radeon(серия X1900 и старше) не нуждаются в пакете {{Package|x11-drivers/radeon-ucode}} или другой прошивке. Для них достаточно включить DRM и поддержку ATI Radeon.}}

{{Note|Ядро Linux >{{=}} 3.9 не имеет оции ''Enable modesetting on radeon by default'', поскольку она уже установлена. Не пугайтесь, если не найдете этой опции в новых версиях ядра.}}

Выйдете из конфигурации ядра, [[Kernel/Rebuild|пересоберите ядро и перезагрузитесь]].

Сейчас, когда KMS настроен, продолжите подготовку {{Path|[[:/etc/portage/make.conf]]}} в следующем разделе.

=== Настройка make.conf ===

Когда ядро подготовлено, две важные переменные в файле {{Path|[[:/etc/portage/make.conf]]}} должны быть определены перед установкой Xorg. 

Первая переменная <var>[[:/etc/portage/make.conf#VIDEO_CARDS|VIDEO_CARDS]]</var>. Она используется для установки видео драйвера, который вы намереваетесь использовать и который обычно совпадает с используемой вами видеокартой. Наиболее используемые значения это <code>nouveau</code> для карт nVidia и <code>radeon</code> для ATI. Оба драйвера являются активно разрабатывающимися, хорошо поддерживаемыми драйверами с открытым исходным кодом. 

{{Note|Вы также можете попробовать проприетарные драйверы от nVidia и AMD/ATI, <code>nvidia</code> и <code>fglrx</code> соотвественно. Однако, настройка этих драйверов выходит за рамки этого руководства. Пожалуйста, смотрите [[NVidia/nvidia-drivers|Gentoo Linux nVidia Guide]] и [[ATI_FAQ|Gentoo Linux ATI FAQ]]. Если вы не знаете, какие драйверы выбрать, обратитесь к этим руководствам за информацией.}}

<code>intel</code> може быть использован для персональных и планшетных компьютеров с графическими чипами Intel. 

{{Note|Переменная <var>VIDEO_CARDS</var> может содержать несколько значений, разделенных символом пробела.}}

Вторая переменная <var>INPUT_DEVICES</var> используется для определения драйверов, которые будут собраны для устройств ввода. В большинстве случаев, установка значения <code>[[evdev]]</code> должна работать корректно. Если вы используете альтернативные устройства ввода, такие как тачпад, убедитесь, что добавили нужное значение в <var>INPUT_DEVICES</var>. 

Решите, какие драйверы будут использоваться и установите необходимые значения в файл {{Path|[[:/etc/portage/make.conf]]}}: 

{{CodeBox|title=Простая настройка make.conf|lang=bash|1=
## (Для мыши, клавиатуры и тачпада)
INPUT_DEVICES="evdev synaptics"
## (Для карт nVidia)
VIDEO_CARDS="nouveau"
## (Для карт AMD/ATI)
VIDEO_CARDS="radeon"
}}

Если предложенные настройки не работают при установке пакета {{Package|x11-base/xorg-drivers}}, проверьте все доступные варианты и выберите те, которые применимы к системе. Этот пример для системы с клавиатурой, мышью, тачпадом и видеокартой Radeon. 

{{Emerge|x11-base/xorg-drivers|params+=--verbose|output=<pre>
 
These are the packages that would be merged, in order:
 
Calculating dependencies... done!
[ebuild   R   ]  x11-base/xorg-drivers-1.9  INPUT_DEVICES="evdev synaptics
-acecad -aiptek -elographics% -fpit% -joystick -keyboard -mouse -penmount -tslib
-virtualbox -vmmouse -void -wacom"
VIDEO_CARDS="radeon -apm -ark -ast -chips -cirrus -dummy -epson -fbdev -fglrx
(-geode) -glint -i128 (-i740) (-impact) -intel -mach64 -mga -neomagic (-newport)
-nouveau -nv -nvidia -r128 -rendition -s3 -s3virge -savage -siliconmotion -sis
-sisusb (-sunbw2) (-suncg14) (-suncg3) (-suncg6) (-sunffb) (-sunleo) (-suntcx)
-tdfx -tga -trident -tseng -v4l -vesa -via -virtualbox -vmware (-voodoo) (-xgi)"
0 kB
</pre>
}}

После настройки всех необходимых переменных Xorg может быть установлен:

{{Emerge|x11-base/xorg-server}}

{{Note|Мета-пакет {{Package|x11-base/xorg-x11}} может быть установлен вместо более легковесного {{Package|x11-base/xorg-server}}. Функционально {{Package|x11-base/xorg-x11}} и {{Package|x11-base/xorg-server}} одинаковы, однако {{Package|x11-base/xorg-x11}} содержит больше пакетов, которые, вероятно, не требуются для большинства систем. Дополнительные пакеты включают большой ассортимент шрифтов для многих языков. В них нет необходимости для работы X11.}}

Когда установка завершена, некоторые переменные окружения необходимо заново инициализировать перед тем, как продолжать. Используйте команду:

{{RootCmd
|env-update
|source /etc/profile
}}

=== Пользователи NVidia ===

Для пользователей NVidia имеется возможность запустить {{c|nvidia-xconfig}} с целью генерации файла {{Path|xorg.conf}} для выбранной видеокарты. Без этого шага {{Path|xorg.conf}} необходимо создать вручную как описано ниже. Отсутствующий {{Path|xorg.conf}} иногда будет выводить ошибку "No screens found" при попытке выполнить {{c|startx}}.

Драйвер NVidia будет работать только после перезагрузки, так что сделайте это после выполнения {{c|nvidia-xconfig}}.

{{RootCmd|nvidia-xconfig}}

Возможно и рекомендуется установить для OpenGL аппаратный рендеринг вместо программного:

{{RootCmd|eselect opengl set nvidia}}

== Конфигурация ==

[[X server]] разработан для работы «из коробки», поэтому нет необходимости вручную редактировать файлы настройки. Сервер сам должен определить и настроить устройства - мониторы, клавиатуры и мыши.

Попробуйте [[#Using_startx|using startx]] без предварительного редактирования файлов настройки. Если Xorg не запустится, или еще что-то, тогда необходима ручная настройка. Она приводится в следующем разделе. 

{{Note|Если изменения были сделаны в ядре, не забывайте '''перезапускать систему''' ''до'' использования {{c|startx}}. Если ядро было обновлено до более новой версии, скорее всего потребуется обновление файлов настройки системного загрузчика.}}

=== Каталог {{Path|xorg.conf.d}} ===

{{Important|Настройку файлов в {{Path|[[Xorg.conf#xorg.conf.d.2C_xorg.conf|xorg.conf.d]]}} следует рассматривать как последнюю. Если возможно, она желательна для запуска Xorg без каких-либо еще настроек.}}

Most of the configuration files for Xorg are stored in {{Path|[[Xorg.conf#xorg.conf.d.2C_xorg.conf|/etc/X11/xorg.conf.d/]]}}. Each file is given a unique name and ends in {{Path|.conf}}. The file names in Xorg's configuration directory will be read in alpha numeric order. For example, {{Path|10-evdev.conf}} will be read before {{Path|20-synaptics.conf}}; {{Path|a-evdev.conf}} will be read before {{Path|b-synaptics.conf}}, and so on. The files in this directory are not required to be numbered, but doing so will help to keep them organized. Organization is helpful when debugging faulty configuration files.

{{Note|Xorg provides example configurations in {{Path|/usr/share/doc/xorg-server-${version}/xorg.conf.example.bz2}}. These can be used to create custom configuration files in {{Path|[[Xorg.conf#xorg.conf.d.2C_xorg.conf|/etc/X11/xorg.conf.d/]]}}. The examples are heavily commented, but if more documentation regarding the syntax is needed, {{c|man xorg.conf}} is always available. Other examples can be found in the section [[#Other_resources|Other resources]] at the end of this guide.}}

=== Использование startx ===

Try {{c|startx}} to start up the [[X server]]. {{c|startx}} is a script (it's installed by {{Package|x11-apps/xinit}}) that executes an ''X session''; that is, it starts the [[X server]] and some graphical applications on top of it. It decides which applications to run using the following logic: 

* If a file named {{Path|.xinitrc}} exists in the home directory, it will execute the commands listed there.

*  Otherwise, it will read the value of the <var>XSESSION</var> variable from the {{Path|/etc/env.d/90xsession}} file and execute the relevant session accordingly. Values for <var>XSESSION</var> are available in {{Path|/etc/X11/Sessions/}}. To set a system wide default session run:

: {{RootCmd|echo XSESSION{{=}}"Xfce4" > /etc/env.d/90xsession}}

: This will create the {{Path|90xsession}} file and set the default X session to [[Xfce/Guide|Xfce]]. Remember to run {{c|env-update}} after making changes to {{Path|90xsession}}.

{{Cmd|startx}}

If no window manager has been installed a solid black screen will appear. Since this can also be a sign that something is wrong, the {{Package|x11-wm/twm}} and {{Package|x11-terms/xterm}} packages can be installed only to test X. 

Once the programs are installed, run {{c|startx}} again. A few {{c|xterm}} windows should appear, making it easy to verify the [[X server]] is working correctly. Once satisfied with the results, unmerge {{Package|x11-wm/twm}} and {{Package|x11-terms/xterm}} if installed in the step above to remove the testing packages. They will not be needed to setup a proper desktop environment.

The session (program to start) could also be given as an argument to {{c|startx}}:

{{Cmd|startx /usr/bin/startfluxbox}}

You can also pass X11 server options, by preceding them with a double dash:

{{Cmd|startx -- vt7}}

=== Tweaking X settings ===

==== Setting the screen resolution ====

If the screen resolution looks to be wrong, you will need to check two sections in your {{Path|[[Xorg.conf#xorg.conf.d.2C_xorg.conf|xorg.conf.d]]}} configuration. First of all, you have the ''Screen'' section which lists the resolutions that your [[X server]] will run at. This section might not list any resolutions at all. If this is the case, Xorg will estimate the resolutions based on the information in the second section, ''Monitor''. 

Now let us change the resolution. In the next example from {{Path|/etc/X11/xorg.conf.d/40-monitor.conf}} we add the <code>PreferredMode</code> line so that our [[X server]] starts at 1440x900 by default. The <code>Option</code> in the <code>Device</code> section must match the name of your monitor (<code>DVI-0</code>), which can be obtained by running {{c|xrandr}}. Install {{c|xrandr}} ({{c|emerge xrandr}}) just long enough to get this information. The argument after the monitor name (in the <code>Device</code> section) must match the <code>Identifier</code> in the <code>Monitor</code> section. 

{{RootCmd|nano -w /etc/X11/xorg.conf.d/40-monitor.conf|output=<pre>
Section "Device"
  Identifier  "RadeonHD 4550"
  Option      "Monitor-DVI-0" "DVI screen"
EndSection
Section "Monitor"
  Identifier  "DVI screen"
  Option      "PreferredMode" "1440x900"
EndSection
</pre>
}}

Run X ({{c|startx}}) to discover it uses the desired resolution.

==== Multiple monitors ====

More than one monitor in can be established in {{Path|[[Xorg.conf#xorg.conf.d.2C_xorg.conf|/etc/X11/xorg.conf.d/]]}}. Give each monitor a unique identifier, then list its physical position, such as "RightOf" or "Above" another monitor. The following example shows how to configure a DVI and a VGA monitor, with the VGA monitor as the right-hand screen: 

{{RootCmd|nano -w /etc/X11/xorg.conf.d/40-monitor.conf|output=<pre>
Section "Device"
  Identifier "RadeonHD 4550"
  Option     "Monitor-DVI-0" "DVI screen"
  Option     "Monitor-VGA-0" "VGA screen"
EndSection
Section "Monitor"
  Identifier "DVI screen"
EndSection
Section "Monitor"
  Identifier "VGA screen"
  Option     "RightOf" "DVI screen"
EndSection
</pre>
}}

==== Configuring the keyboard ====

To setup X to use an international keyboard create the appropriate config file in {{Path|[[Xorg.conf#xorg.conf.d.2C_xorg.conf|/etc/X11/xorg.conf.d/]]}}. This example features a Czech keyboard layout: 

{{RootCmd|nano -w /etc/X11/xorg.conf.d/30-keyboard.conf|output=<pre>
Section "InputClass"
        Identifier "keyboard-all"
        Driver "evdev"
        Option "XkbLayout" "us,cz"
        Option "XkbModel" "logitech_g15"
        Option "XkbRules" "xorg"
        Option "XkbOptions" "grp:alt_shift_toggle,grp:switch,grp_led:scroll,compose:rwin,terminate:ctrl_alt_bksp"
        Option "XkbVariant" ",qwerty"
        MatchIsKeyboard "on"
EndSection
</pre>
}}

For methods of switching the keyboard layout see the [[Keyboard_layout_switching#X11|Keyboard layout switching]] article.

The "terminate" command (<code>terminate:ctrl_alt_bksp</code>) lets users kill the X session by using the {{Key|Ctrl}}+{{Key|Alt}}+{{Key|Backspace}} key combination. This will, however, make X exit disgracefully -- something that users might want to avoid. It can be useful when programs have frozen the display entirely, or when configuring and tweaking the Xorg environment. Be careful when killing the desktop with this key combination - most programs really do not like it when they are ended this way. Some, if not all, of the information that has not been written to the disk (information stored in "open documents") will be lost.

==== Finishing up ====

Run {{c|startx}} and be happy about the result. Congratulations, you now (hopefully) have a working Xorg! The next step is to install a useful window manager or desktop environment such as [[KDE]], [[GNOME]], or [[Xfce]]. Information on installing these desktop environments can be found here on the wiki.

== Смотрите также ==

* [[Wayland]] - The next generation window manager for Linux.

== Ссылки ==

=== Creating and editing config files ===

First of all, {{c|man xorg.conf}} and {{c|man evdev}} provide quick yet complete references about the syntax used by these configuration files. Be sure to have them open on a terminal when editing Xorg configuration files! 

There are also many online resources on editing config files in {{Path|/etc/X11/}}. Only a few are listed here; use a choice favorite search engine to find more.

=== Другие ресурсы ===

More information about installing and configuring various graphical desktop environments and applications can be found in the [[Category:Desktop|Gentoo desktop resources]] section of our documentation. 

When upgrading to xorg-server 1.9 or higher, be sure to read the [[X_server/upgrade|migration guide]]. 

X.org provides many [http://www.x.org/wiki/FAQ FAQs] on their website, in addition to their other documentation.

{{Migrated|originalauthors=swift, nightmorph}}
[[Category:X.Org]]
