<languages />
{{InfoBox stack
|{{InfoBox project|Overlays|header=true}}
}}

'''ebuild リポジトリ'''(いわゆる'''オーバーレイ'''としても知られています)は [[Acticle description::Gentoo ベースのシステムのパッケージマネージャーにパッケージを追加・拡張するために使われるディレクトリー構造およびファイル]]です。ebuild リポジトリは1つ、あるいは複数の [[EAPI|ebuild API]] に合致する ebuild を含むことができます。

Gentoo システムのメインリポジトリは [https://gitweb.gentoo.org/repo/gentoo.git/tree/ Gentoo ebuild リポジトリ]として知られています。これは Gentoo の公式開発者たちおよび([[Project:Proxy Maintainers|Proxy Maintainers]] プロジェクトを通じて)コミュニティーメンバーによって維持管理されている [[ebuild]] で構成されています。システム管理者は以下で説明するさまざまなユーティリティーや方法を使用して追加のリポジトリをシステムに追加することができます。

== リポジトリ ==

ebuild リポジトリは単なる[[Repository format|ファイルの集合]]（ebuild、メタデータファイル ...）です。これらは公開リポジトリ（[[Project:Portage/Sync#Portage_configuration|git, CVS, SVN ...]]）から取り寄せたり、tarballとしてダウンロードして手動でシステム上に展開したりすることで利用できます。[https://repos.gentoo.org 信用できる]第三者よって管理されているリポジトリを利用することをおすすめします。すべてのebuildリポジトリはインストールされると、Portageがどのソフトウェアをインストールするか決定するときに、ebuildリポジトリ内のファイルに目を通すようになります。もしもセキュリティ上の危険があるコードがオーバーレイに存在すれば、セキュリティ上の危険があるパッケージがシステムにインストールされるかもしれないからです。

リポジトリを扱うための現時点におけるデフォルトのアプローチは {{Path|[[:/etc/portage/repos.conf]]}} を使うものです。この場所は、他の多くの Portage 関連の場所と同様にディレクトリーでも構いません。

{{Path|/etc/portage/repos.conf/}} 内のリポジトリ定義は、Portage に対してリポジトリが更新可能かどうか、またどのように更新するかという情報も提供します。これにより {{c|emerge --sync}} を実行することでリポジトリを同様に更新することができます。

非推奨ではあるものの、{{Path|/etc/portage/make.conf}} 内の <var>PORTDIR_OVERLAY</var> 変数を使う方法もまだサポートされています。この変数にはリポジトリがある1つまたはそれ以上のファイルシステム上の場所を追加指定できます。{{Path|[[:/etc/portage/repos.conf]]/}} ディレクトリーを使うことを強くお勧めします。

より詳しくは、 [[:/etc/portage/repos.conf|/etc/portage/repos.conf]] 及び [[Project:Portage/Sync#Operation|Portage/Sync]] の記事を参照してください

=== 優先順位について ===

それぞれの ebuild リポジトリは、パッケージマネージャーに対する固有の優先度を保持します。特定のバージョンが複数の ebuild リポジトリ内に見つかって処理方法が不明確になった場合に備えるための仕様です。優先度値のより高い（たとえば60）リポジトリ内の ebuild が、優先度の低い（たとえば50）リポジトリ内の ebuild に先んじて処理されます。

優先度を含んだebuildリポジトリのリストは、以下のコマンドの出力で得られます（"Repositories"の欄を探してください）:

{{Cmd|emerge --info --verbose}}

{{Cmd|portageq repos_config /}}

Gentoo ebuild リポジトリには -1000 という優先度が設定されます。すなわち、より高い優先度が割り当てられていれば、他のすべてのリポジトリが先んじて処理されます。この挙動は既定の仕様です。なぜなら、ebuild リポジトリとは、Gentooリポジトリの上に覆い被せる (''lay over/on top'') ように設計されたものなのですから。

== 各種ソフトウェア ==

多くのツールがebuildリポジトリをサポート、または統合的に扱っています。

=== Layman ===

{{c|layman}}アプリケーションは、複数の追加ebuildリポジトリを更新・管理することを容易にします。{{c|layman}}はコマンドラインアプリケーションで、{{c|layman}}を通じて公に利用可能なebuildリポジトリを一覧表示、購読、購読解除、更新することができます。 

It supports both the {{Path|[[Layman#make.conf_method_.28force_old_method.29|make.conf]]}} as well as {{Path|[[Layman#repos.conf_method_.28default.29|repos.conf]]}} method.
* When using the {{Path|[[Layman#make.conf_method_.28force_old_method.29|make.conf]]}} method, {{c|layman}} manages a dedicated configuration file which should be sourced in by {{Path|make.conf}}
* When using {{Path|[[Layman#repos.conf_method_.28default.29|repos.conf]]}}, {{c|layman}} manages the {{Path|[[Layman#repos.conf_method_.28default.29|/etc/portage/repos.conf/layman.conf]]}} file directly

より詳しくは [[Layman]] の記事及び[[Project:Portage/Sync#Layman_configuration]] を参照してください。

=== emaint ===

[[Project:Portage/Sync#Operation|Sync (Portage project)]] 記事および {{c|man 1 emaint}} を参照してください。

=== eix ===

{{c|eix-sync}} is a wrapper starting {{c|emerge --sync}} (which in turn starts {{c|emaint sync --auto}}) followed by {{c|eix-update}}.  For further details see the [[Eix]] article and {{c|man 1 eix}}.

=== eselect-repository ===

{{c|eselect repository}} maintains {{Path|/etc/portage/repos.conf}} entries for Portage to access and synchronize.  See [[Eselect/Repository]] article for details.

== Usage ==

=== Emerging a duplicate package ===

When working with ebuild repositories it is possible to encounter a situation where multiple versions of the same package are available from different ebuild repositories. Instruct [[Portage]] to install a specific package from a specific ebuild repository with the <code>::</code> notation:

{{Emerge|category/atom::repository-name}}

The same notation can be used for different emerge instructions, including uninstalling a package through <code>--depclean</code>.

== Best practices ==

=== キャッシュの生成について ===

portage は、ebuildリポジトリが多量にインストールされている場合には、パッケージの前提関係を解決するような処理に長い時間を要するかもしれません。これは、ebuildリポジトリには一般的に、メタデータキャッシュが含まれていないためです。

ローカルのメタデータキャッシュを生成するには、ebuildリポジトリとの同期後に {{c|emerge --regen}} を実行してください:

{{RootCmd
|layman -S
|( ulimit -n 4096 && emerge --regen )}}

Be careful, because {{c|emerge --regen}} takes a lot of time and it's not recommended for rsync users as rsync updates the cache using server-side caches (most of users of portage are rsync users). Rsync users should simply run {{c|emerge --sync}} (or {{c|eix-sync}}) to regenerate the cache. It's probably only users of very large ebuild repositories should try {{c|emerge --regen}}.

=== Masking installed but unsafe ebuild repositories ===

When using large ebuild repositories or those with unknown/low quality it is best practice to hardmask the whole ebuild repository and only accept specific ebuilds on a case-by-case basis:

{{FileBox|filename=/etc/portage/package.mask|ebuildリポジトリ内の全てのパッケージをマスクする|lang=bash|1=
*/*::ebuild repository-name
}}

その後に、インストールするパッケージのマスクを外します。

{{FileBox|filename=/etc/portage/package.unmask|ebuildリポジトリ内の特定パッケージのマスクを外す|lang=bash|1=
foo/bar::ebuild repository-name
}}

== 参考 ==

* [[Project:Overlays|Overlays project]] - The official Gentoo project for ebuild repositories' support.
* [[Project:Overlays/Overlays guide|Overlays guide (Overlay project)]] - A user guide written by the Overlay project.
* [[Project:Overlays/Old Dev Guide|Developer's guide to Gentoo overlays]] - This document is kept only for historical purposes. The current guide is maintained as [[Project:Overlays/Overlays guide]].
* [[Handbook:Parts/Portage/CustomTree#Defining_a_custom_repository|Defining a custom repository]] - Section in the Gentoo Handbook

== 外部の情報 ==

* https://repos.gentoo.org
* https://github.com/gentoo/
* https://gpo.zugaina.org/Overlays


[[Category:Portage]]
