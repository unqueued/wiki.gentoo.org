<languages />
{{InfoBox stack
|{{InfoBox project|Overlays|header=true}}
}}

Within Gentoo Linux, users already have one [https://devmanual.gentoo.org/general-concepts/tree/ "main" package repository]. The [https://gitweb.gentoo.org/repo/gentoo.git/tree/ main repository] contains all the software packages (called ebuilds) maintained by Gentoo developers. Additional package trees are usually hosted by ''repositories''. Users can add such additional repositories to their system.

== リポジトリ ==

Package repositories are nothing more (or less) than a [[Repository format|set of files]] (ebuilds, metadata files, ChangeLog entries ...). These can be pulled in from public repositories ([[Project:Portage/Sync#Portage_configuration|git, CVS, SVN ...]]) or downloaded as tarballs and extracted manually onto the system. It is advised to use managed repositories by [https://overlays.gentoo.org trusted] third parties; any installed ebuild repository will cause Portage to look through the overlaid files when deciding which software to install. If compromised code is in the ebuild repository, then compromised packages could be installed on the system.

The now default approach for handling repositories is through {{Path|[[:/etc/portage/repos.conf]]}} which, like many other Portage related locations, can be a directory as well.

Repository definitions inside {{Path|/etc/portage/repos.conf/}} also inform Portage if and how the repository can be updated. With it, calling {{c|emerge --sync}} will automatically update the repositories as well.

A deprecated, yet still supported method is to use the <var>PORTDIR_OVERLAY</var> variable inside {{Path|/etc/portage/make.conf}}. This variable can point to one or more additional locations on the file system where repositories are available. The use of the {{Path|[[:/etc/portage/repos.conf]]/}} directory is highly preferred.

より詳しくは、 [[:/etc/portage/repos.conf|/etc/portage/repos.conf]] 及び [[Project:Portage/Sync#Operation|Portage/Sync]] の記事を参照してください

=== 優先順位について ===

それぞれのオーバーレイは、固有の優先度を保持します。特定のバージョンが複数のオーバーレイ内に見つかって処理方法が不明確になった場合に備えるための仕様です。優先度値のより高い（たとえば60）オーバーレイ内の ebuild が、優先度の低い（たとえば50）オーバーレイ内の ebuild に先んじて処理されます。

優先度を含んだオーバーレイのリストは、以下のコマンドの出力で得られます（"Repositories"の欄を探してください）:

{{Cmd|emerge --info --verbose}}

{{Cmd|portageq repos_config /}}

The Gentoo repository will have a priority of -1000. That means that all other ebuild repositories generally take precedence as they are assigned a higher priority. That is the default behavior, because ebuild repositories are designed to "lay over/on top" of the Gentoo repository.

== Available software ==

多くのツールがオーバーレイをサポート、または統合的に扱っています。

=== Layman ===

{{c|layman}}アプリケーションは、複数の追加オーバーレイを更新・管理することを容易にします。{{c|layman}}はコマンドラインアプリケーションで、{{c|layman}}を通じて公に利用可能なオーバーレイを一覧表示、購読、購読解除、更新することができます。 

It supports both the {{Path|[[Layman#make.conf_method_.28force_old_method.29|make.conf]]}} as well as {{Path|[[Layman#repos.conf_method_.28default.29|repos.conf]]}} method.
* When using the {{Path|[[Layman#make.conf_method_.28force_old_method.29|make.conf]]}} method, {{c|layman}} manages a dedicated configuration file which should be sourced in by {{Path|make.conf}}
* When using {{Path|[[Layman#repos.conf_method_.28default.29|repos.conf]]}}, {{c|layman}} manages the {{Path|[[Layman#repos.conf_method_.28default.29|/etc/portage/repos.conf/layman.conf]]}} file directly

より詳しくは [[Layman]] の記事及び[[Project:Portage/Sync#Layman_configuration]] を参照してください。

=== emaint ===

See the [[Project:Portage/Sync#Operation|Sync (Portage project)]] article and {{c|man 1 emaint}}.

=== eix ===

{{c|eix-sync}} is a wrapper starting {{c|emerge --sync}} (which in turn starts {{c|emaint sync --auto}}) followed by {{c|eix-update}}.  For further details see the [[Eix]] article and {{c|man 1 eix}}.

== Usage ==

=== Emerging a duplicate package ===

When working with ebuild repositories it is possible to encounter a situation where multiple versions of the same package are available from different ebuild repositories. Instruct [[Portage]] to install a specific package from a specific ebuild repository with the <code>::</code> notation:

{{Emerge|category/atom::ebuild repository-name}}

== Best practices ==

=== キャッシュの生成について ===

portage は、オーバーレイが多量にインストールされている場合には、パッケージの前提関係を解決するような処理に長い時間を要するかもしれません。これは、オーバーレイには一般的に、メタデータキャッシュが含まれていないためです。

Generate a local metadata cache by running {{c|emerge --regen}} after syncing the ebuild repositories:

{{RootCmd
|layman -S
|( ulimit -n 4096 && emerge --regen )}}

Be careful, because {{c|emerge --regen}} takes a lot of time and it's not recommended for rsync users as rsync updates the cache using server-side caches (most of users of portage are rsync users). Rsync users should simply run {{c|emerge --sync}} (or {{c|eix-sync}}) to regenerate the cache. It's probably only users of very large ebuild repositories should try {{c|emerge --regen}}.

=== Masking when using unsafe ebuild repositories ===

巨大なオーバーレイや、よく知らない・低品質なオーバーレイを利用するなら、そのオーバレイ全体に対してハードマスクをかけるのが最善でしょう。

{{FileBox|filename=/etc/portage/package.mask|オーバーレイ内の全てのパッケージをマスクする|lang=bash|1=
*/*::overlay-name
}}

その後に、インストールするパッケージのマスクを外します。

{{FileBox|filename=/etc/portage/package.unmask|オーバーレイ内の特定パッケージのマスクを外す|lang=bash|1=
foo/bar::overlay-name
}}

== 参考 ==

* [[Project:Overlays|Overlays project]] - The official Gentoo project for ebuild repositories' support.
* [[Project:Overlays/Overlays guide|Overlays guide (Overlay project)]] - A user guide written by the Overlay project.
* [[Project:Overlays/Dev Guide|Developer's guide to Gentoo overlays]] - This document is kept only for historical purposes. The current guide is maintained as [[Project:Overlays/Overlays guide]].
* [[Handbook:Parts/Portage/CustomTree#Defining_a_custom_repository|Defining a custom repository]] - Section in the Gentoo Handbook

== 外部の情報 ==

* https://overlays.gentoo.org
* https://github.com/gentoo/


[[Category:Portage]]
