<languages />
{{InfoBox stack
|{{InfoBox gdoc|Overlays|text=Overlays Gentoo Project|header=true}}
}}

Gentoo Linuxでは、ユーザには既に、かつて同義語的に[https://devmanual.gentoo.org/general-concepts/tree ''Portage ツリー'']と呼ばれていた[https://gitweb.gentoo.org/repo/gentoo.git/tree/ ''メインの''リポジトリ]が与えられています。この用語は、[[Portage]]以外の[[Package Manager Specification|パッケージマネージャ]]がGentooのパッケージリポジトリと相互作用できるようになってからは、段階的に廃止するべきとされています。この[https://gitweb.gentoo.org/repo/gentoo.git/tree/ メインのリポジトリ]は、Gentoo 開発者たちによって維持管理されている全てのソフトウェアパッケージ ([[Ebuild|ebuild]] と呼ばれているもの)で構成されています。しかしユーザは、この Portage ツリーに対して更に追加のリポジトリを付け加えることもできます。追加のパッケージツリーは通常、''リポジトリ''によって提供されています。ユーザはこうした追加のリポジトリをメインのツリーに対して覆い被せる("lay over")ことができ、そこからこれを''overlay''と呼んでいます。

== リポジトリ ==

パッケージリポジトリは単なる[[Repository format|ファイルの集合]]（ebuild、メタデータファイル、更新履歴エントリ ...）です。これらは公開リポジトリ（[[Project:Portage/Sync#Portage_configuration|git, cvs, svn ...]]）から取り寄せたり、tarballとしてダウンロードして手動でシステム上に展開したりすることで利用できます。信用できる第三者よって管理されているリポジトリを利用することをおすすめします。すべてのオーバーレイはインストールされると、Portageがどのソフトウェアをインストールするか決定するときに、オーバーレイ内のファイルに目を通すようになります。もしもセキュリティ上の危険があるコードがオーバーレイに存在すれば、セキュリティ上の危険があるパッケージがシステムにインストールされるかもしれないからです。

The now default approach for handling repositories is through {{Path|[[:/etc/portage/repos.conf]]}} which, like many other Portage related locations, can be a directory as well.

Repository definitions inside {{Path|/etc/portage/repos.conf/}} also inform Portage if and how the repository can be updated. With it, calling {{c|emerge --sync}} will automatically update the repositories as well.

A deprecated, yet still supported method is to use the <var>PORTDIR_OVERLAY</var> variable inside {{Path|/etc/portage/make.conf}}. This variable can point to one or more additional locations on the file system where repositories are available. The use of the {{Path|[[:/etc/portage/repos.conf]]/}} directory is highly preferred.

より詳しくは、 [[:/etc/portage/repos.conf|/etc/portage/repos.conf]] 及び [[Project:Portage/Sync#Operation|Portage/Sync]] の記事を参照してください

=== 優先順位について ===

それぞれのオーバーレイは、固有の優先度を保持します。特定のバージョンが複数のオーバーレイ内に見つかって処理方法が不明確になった場合に備えるための仕様です。優先度値のより高い（たとえば60）オーバーレイ内の ebuild が、優先度の低い（たとえば50）オーバーレイ内の ebuild に先んじて処理されます。

優先度を含んだオーバーレイのリストは、以下のコマンドの出力で得られます（"Repositories"の欄を探してください）:

{{Cmd|emerge --info --verbose}}

{{Cmd|portageq repos_config /}}

Gentoo Portage ツリーには -1000 という優先度が設定されます。すなわち、他のすべてのオーバーレイのほうに高い優先度が割り当てられているので、これらが先んじて処理されます。この挙動は既定の仕様です。なぜなら、オーバーレイとは、portage ツリーの上に覆い被せる (''lay over/on top'') ように設計されたものなのですから。

== 支援ツール ==

多くのツールがオーバーレイをサポート、または統合的に扱っています。

=== Layman ===

{{c|layman}}アプリケーションは、複数の追加オーバーレイを更新・管理することを容易にします。{{c|layman}}はコマンドラインアプリケーションで、{{c|layman}}を通じて公に利用可能なオーバーレイを一覧表示、購読、購読解除、更新することができます。 

It supports both the {{Path|[[Layman#Using_.27make.conf.27_method_.28older_method.29|make.conf]]}} as well as {{Path|[[Layman#Using_.27repos.conf.27_method_.28default_method_for_app-portage.2Flayman-2.3.0_or_later_.29|repos.conf]]}} method.
* When using the {{Path|[[Layman#Using_.27make.conf.27_method_.28older_method.29|make.conf]]}} method, {{c|layman}} manages a dedicated configuration file which should be sourced in by {{Path|make.conf}}
* When using {{Path|[[Layman#Using_.27repos.conf.27_method_.28default_method_for_app-portage.2Flayman-2.3.0_or_later_.29|repos.conf]]}}, {{c|layman}} manages the {{Path|[[Layman#Using_.27repos.conf.27_method_.28default_method_for_app-portage.2Flayman-2.3.0_or_later_.29|/etc/portage/repos.conf/layman.conf]]}} file directly

より詳しくは [[Layman]] の記事及び[[Project:Portage/Sync#Layman_configuration]] を参照してください。

=== emaint ===

[[Project:Portage/Sync#Operation]] 及び {{c|man 1 emaint}} を参照してください。

=== eix ===

{{c|eix-sync}} is a wrapper starting {{c|emerge --sync}} (which in turn starts {{c|emaint sync --auto}}) followed by {{c|eix-update}}.  For further details see the [[Eix]] article and {{c|man 1 eix}}.

== Best practices ==

=== キャッシュの生成について ===

portage は、オーバーレイが多量にインストールされている場合には、パッケージの前提関係を解決するような処理に長い時間を要するかもしれません。これは、オーバーレイには一般的に、メタデータキャッシュが含まれていないためです。

ローカルのメタデータキャッシュを生成するには、オーバーレイとの同期後に {{c|emerge --regen}} を実行してください:

{{RootCmd
|layman -S
|( ulimit -n 4096 && emerge --regen )}}

Be careful, because {{c|emerge --regen}} takes a lot of time and it's not recommended for rsync users as rsync updates the cache using server-side caches (most of users of portage are rsync users). Rsync users should simply run {{c|emerge --sync}} (or {{c|eix-sync}}) to regenerate the cache. It's probably only users of very large overlays should try {{c|emerge --regen}}.

=== Masking when using unsafe overlays ===

巨大なオーバーレイや、よく知らない・低品質なオーバーレイを利用するなら、そのオーバレイ全体に対してハードマスクをかけるのが最善でしょう。

{{FileBox|filename=/etc/portage/package.mask|オーバーレイ内の全てのパッケージをマスクする|lang=bash|1=
*/*::overlay-name
}}

その後に、インストールするパッケージのマスクを外します。

{{FileBox|filename=/etc/portage/package.unmask|オーバーレイ内の特定パッケージのマスクを外す|lang=bash|1=
foo/bar::overlay-name
}}

== 参考 ==

* [[Project:Overlays]] - The official Gentoo project for overlays support.
* [[Project:Overlays/Overlays_guide]] - A user guide written by the Overlay project.
* [[Project:Overlays/Dev_Guide|Developers' Guide To Gentoo Overlays]]

== 外部の情報 ==

* https://overlays.gentoo.org
* https://github.com/gentoo/


[[Category:Portage]]
