<languages />
{{InfoBox stack
|{{InfoBox project|Overlays|header=true}}
}}

An '''ebuild repository''', colloquially known as an '''overlay''', is [[Article description::a structure of directories and files used to add and extend packages available to the system's package manager.]] Ebuild repositories are also used by Gentoo developers as training ground and staging area for new ebuilds. Ebuild repositories can contain ebuilds of one or more [[EAPI]]s.

Systems that have Gentoo installed typically have a single ebuild repository available on the system. This main repository, known as the [https://gitweb.gentoo.org/repo/gentoo.git/tree/ Gentoo ebuild repository], contains [[ebuild]]s maintained by official Gentoo developers and members of the community (through the [[Project:Proxy Maintainers|Proxy Maintainers]] project). System administrators can add additional ebuild repositories to the system using various utilities and methods described below.

== リポジトリ ==

Ebuild repositories are nothing more (or less) than a [[Repository format|set of files]] (ebuilds, metadata files, ...). These can be pulled in from public repositories ([[Project:Portage/Sync#Portage_configuration|git, CVS, SVN ...]]) or downloaded as tarballs and extracted manually onto the system. It is advised to use managed repositories by [https://repos.gentoo.org trusted] third parties; any installed ebuild repository will cause Portage to look through the overlaid files when deciding which software to install. If compromised code is in the ebuild repository, then compromised packages could be installed on the system.

The now default approach for handling repositories is through {{Path|[[:/etc/portage/repos.conf]]}} which, like many other Portage related locations, can be a directory as well.

Repository definitions inside {{Path|/etc/portage/repos.conf/}} also inform Portage if and how the repository can be updated. With it, calling {{c|emerge --sync}} will automatically update the repositories as well.

A deprecated, yet still supported method is to use the <var>PORTDIR_OVERLAY</var> variable inside {{Path|/etc/portage/make.conf}}. This variable can point to one or more additional locations on the file system where repositories are available. The use of the {{Path|[[:/etc/portage/repos.conf]]/}} directory is highly preferred.

より詳しくは、 [[:/etc/portage/repos.conf|/etc/portage/repos.conf]] 及び [[Project:Portage/Sync#Operation|Portage/Sync]] の記事を参照してください

=== 優先順位について ===

それぞれのebuildリポジトリは、固有の優先度を保持します。特定のバージョンが複数のebuildリポジトリ内に見つかって処理方法が不明確になった場合に備えるための仕様です。優先度値のより高い（たとえば60）ebuildリポジトリ内の ebuild が、優先度の低い（たとえば50）ebuildリポジトリ内の ebuild に先んじて処理されます。

優先度を含んだebuildリポジトリのリストは、以下のコマンドの出力で得られます（"Repositories"の欄を探してください）:

{{Cmd|emerge --info --verbose}}

{{Cmd|portageq repos_config /}}

Gentoo リポジトリには -1000 という優先度が設定されます。すなわち、他のすべてのebuildリポジトリのほうに高い優先度が割り当てられているので、これらが先んじて処理されます。この挙動は既定の仕様です。なぜなら、ebuildリポジトリとは、Gentooリポジトリの上に覆い被せる (''lay over/on top'') ように設計されたものなのですから。

== 各種ソフトウェア ==

多くのツールがebuildリポジトリをサポート、または統合的に扱っています。

=== Layman ===

{{c|layman}}アプリケーションは、複数の追加ebuildリポジトリを更新・管理することを容易にします。{{c|layman}}はコマンドラインアプリケーションで、{{c|layman}}を通じて公に利用可能なebuildリポジトリを一覧表示、購読、購読解除、更新することができます。 

It supports both the {{Path|[[Layman#make.conf_method_.28force_old_method.29|make.conf]]}} as well as {{Path|[[Layman#repos.conf_method_.28default.29|repos.conf]]}} method.
* When using the {{Path|[[Layman#make.conf_method_.28force_old_method.29|make.conf]]}} method, {{c|layman}} manages a dedicated configuration file which should be sourced in by {{Path|make.conf}}
* When using {{Path|[[Layman#repos.conf_method_.28default.29|repos.conf]]}}, {{c|layman}} manages the {{Path|[[Layman#repos.conf_method_.28default.29|/etc/portage/repos.conf/layman.conf]]}} file directly

より詳しくは [[Layman]] の記事及び[[Project:Portage/Sync#Layman_configuration]] を参照してください。

=== emaint ===

[[Project:Portage/Sync#Operation|Sync (Portage project)]] 記事および {{c|man 1 emaint}} を参照してください。

=== eix ===

{{c|eix-sync}} is a wrapper starting {{c|emerge --sync}} (which in turn starts {{c|emaint sync --auto}}) followed by {{c|eix-update}}.  For further details see the [[Eix]] article and {{c|man 1 eix}}.

== Usage ==

=== Emerging a duplicate package ===

When working with ebuild repositories it is possible to encounter a situation where multiple versions of the same package are available from different ebuild repositories. Instruct [[Portage]] to install a specific package from a specific ebuild repository with the <code>::</code> notation:

{{Emerge|category/atom::repository-name}}

The same notation can be used for different emerge instructions, including uninstalling a package through <code>--depclean</code>.

== Best practices ==

=== キャッシュの生成について ===

portage は、ebuildリポジトリが多量にインストールされている場合には、パッケージの前提関係を解決するような処理に長い時間を要するかもしれません。これは、ebuildリポジトリには一般的に、メタデータキャッシュが含まれていないためです。

ローカルのメタデータキャッシュを生成するには、ebuildリポジトリとの同期後に {{c|emerge --regen}} を実行してください:

{{RootCmd
|layman -S
|( ulimit -n 4096 && emerge --regen )}}

Be careful, because {{c|emerge --regen}} takes a lot of time and it's not recommended for rsync users as rsync updates the cache using server-side caches (most of users of portage are rsync users). Rsync users should simply run {{c|emerge --sync}} (or {{c|eix-sync}}) to regenerate the cache. It's probably only users of very large ebuild repositories should try {{c|emerge --regen}}.

=== Masking installed but unsafe ebuild repositories ===

巨大なebuildリポジトリや、よく知らない・低品質なebuildリポジトリを利用するなら、そのebuildリポジトリ全体に対してハードマスクをかけるのが最善でしょう。

{{FileBox|filename=/etc/portage/package.mask|ebuildリポジトリ内の全てのパッケージをマスクする|lang=bash|1=
*/*::ebuild repository-name
}}

その後に、インストールするパッケージのマスクを外します。

{{FileBox|filename=/etc/portage/package.unmask|ebuildリポジトリ内の特定パッケージのマスクを外す|lang=bash|1=
foo/bar::ebuild repository-name
}}

== 参考 ==

* [[Project:Overlays|Overlays project]] - The official Gentoo project for ebuild repositories' support.
* [[Project:Overlays/Overlays guide|Overlays guide (Overlay project)]] - A user guide written by the Overlay project.
* [[Project:Overlays/Old Dev Guide|Developer's guide to Gentoo overlays]] - This document is kept only for historical purposes. The current guide is maintained as [[Project:Overlays/Overlays guide]].
* [[Handbook:Parts/Portage/CustomTree#Defining_a_custom_repository|Defining a custom repository]] - Section in the Gentoo Handbook

== 外部の情報 ==

* https://repos.gentoo.org
* https://github.com/gentoo/
* https://gpo.zugaina.org/Overlays


[[Category:Portage]]
