<languages />
Chroot (Change Root) は新しくメインのシステムから論理的に分離された環境を作るために見掛け上のrootディレクトリを変更する目的で使われるUnixシステムのユーティリティです。この新しい環境は"chroot jail(訳注:監獄)"として知られています。jailの中にいるユーザーからは閉じこめられている環境の外側にあるファイルを見ることもアクセスすることもできません。

chrootの主な使い方の一つとして、現在のシステムの上に分離されたLinuxシステムをソフトウェアの互換性やテストの為に作るものがあります。ハイパーバイザーのオーバーヘッドが無いので、これはしばしば軽量な仮想化の代替としてみられます。

== 環境構築 ==
新規インストールの際にまず一番最初にする必要があることは、chrootして住むための{{Path|/mnt/mychroot}}のようなディレクトリを作ることです:

{{Cmd
|mkdir /mnt/mychroot
|cd /mnt/mychroot
}}

もしパーティションに既にインストールされたシステムをマウントしたい場合は、こうします:

{{Cmd
|mkdir /mnt/mychroot
|mount /dev/DEVICE /mnt/mychroot
}}

DEVICEをあなたが既にインストールしたパーティションに置き替えてください。

もしあなたが居るルートディレクトリのサブディレクトリに既にインストールし終わっているのなら上のステップは必要ありません。

== 新規インストールのためのシステムファイルとportageツリーの展開 ==
新しいインストールを構築し終っているなら、次のステップはstage3とportage tarballをダウンロードして正しいchrootの場所に設置することです。この手続についてのより詳しい情報は[http://www.gentoo.org/doc/ja/handbook/handbook-amd64.xml?part=1&chap=5 Gentoo Handbook]のセクション5a及び5bをご覧ください。

{{RootCmd
|links http://distfiles.gentoo.org/releases/amd64/current-stage3/
|tar xvjpf stage3-*.tar.bz2 -C /mnt/mychroot
|links http://distfiles.gentoo.org/snapshots/
|tar xvjf portage-*.tar.bz2 -C /mnt/mychroot/usr
}}

== 設定 ==
chrootに入る前にいくつかのディレクトリをマウントしておかなければなりません。

{{RootCmd
|mount -o bind /dev /mnt/mychroot/dev
|mount -t proc none /mnt/mychroot/proc
|mount -o bind /sys /mnt/mychroot/sys
|mount -o bind /tmp /mnt/mychroot/tmp
}}

そしていくつかの基本的な設定ファイルもホストからコピーしておく必要がありますが、既存のシステムを使っている場合は{{Path|make.conf}}をコピーしてはいけません。

{{Cmd
|cp /etc/portage/make.conf /mnt/mychroot/etc/portage # 既存のシステムを使う場合、このコマンドは省いてください。
|cp /etc/resolv.conf /mnt/mychroot/etc
}}

一度完了すれば新しいchroot環境に入ることができます。

{{RootCmd
|chroot /mnt/mychroot /bin/bash
|env-update
|source /etc/profile
|<nowiki>export PS1="(chroot) $PS1"</nowiki>
}}

When creating a new installation, you can sync portage to make sure everything is up to date.

{{RootCmd
|emerge --sync
}}

The system is now ready. You can install software, mess with settings, test experimental packages and configurations without having any effect on your main system. To leave the chroot simply type "exit" or press {{Key|Ctrl}} + {{Key|D}}, this will return you back to your normal environment. Don't forget to umount directories you've mounted.

==Init scripts==
If you need to do this often, you can speed up the mounting of the directories needed for a chroot by using an init script:

{{File|/etc/init.d/mychroot||
 #!/sbin/runscript

 depend() {
   need localmount
   need bootmisc
 }

 start() {
     ebegin "Mounting chroot directories"
     mount -o bind /dev /mnt/mychroot/dev > /dev/null &
     mount -t proc none /mnt/mychroot/proc > /dev/null &
     mount -o bind /sys /mnt/mychroot/sys > /dev/null &
     mount -o bind /tmp /mnt/mychroot/tmp > /dev/null &
     eend $? "An error occurred while mounting chroot directories"
}

 stop() {
     ebegin "Unmounting chroot directories"
     umount -f /mnt/mychroot/dev > /dev/null &
     umount -f /mnt/mychroot/proc > /dev/null &
     umount -f /mnt/mychroot/sys > /dev/null &
     umount -f /mnt/mychroot/tmp > /dev/null &
     eend $? "An error occurred while unmounting chroot directories"
 }
}}

If you use a different directory or partition, add the necessary mounting commands in start() and change {{Path|/mnt/chroot}} if you use a different name.

==See also==
* [http://www.gentoo.org/proj/en/base/x86/chroot.xml Gentoo x86 Chroot Setup Guide]


[[Category:Core system]]
