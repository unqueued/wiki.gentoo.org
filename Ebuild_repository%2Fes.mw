<languages />
{{InfoBox stack
|{{InfoBox gdoc|Overlays|text=Proyecto de Overlays de Gentoo|header=true}}
}}

Within Gentoo Linux, users already have one [https://gitweb.gentoo.org/repo/gentoo.git/tree/ "main" package repository], in the past synonymously referred to as [https://devmanual.gentoo.org/general-concepts/tree/ the "Portage tree"], although this term should be phased out since [[Package Manager Specification|package managers]] other than [[Portage]] can interact with package repositories in Gentoo. The [https://gitweb.gentoo.org/repo/gentoo.git/tree/ main repository] contains all the software packages (called ebuilds) maintained by Gentoo developers. Additional package trees are usually hosted by ''repositories''. Users can add such additional repositories to the tree that are "laid over" the main tree - hence the name, overlays.

== Repositorios ==

Package repositories are nothing more (or less) than a [[Repository format|set of files]] (ebuilds, metadata files, ChangeLog entries ...). These can be pulled in from public repositories ([[Project:Portage/Sync#Portage_configuration|git, cvs, svn ...]]) or downloaded as tarballs and extracted manually onto the system. It is advised to use managed repositories by trusted third parties; any installed overlay will cause Portage to look through the overlaid files when deciding which software to install. If compromised code is in the overlay, then compromised packages could be installed on the system.

The now default approach for handling repositories is through {{Path|[[:/etc/portage/repos.conf]]}} which, like many other Portage related locations, can be a directory as well.

Repository definitions inside {{Path|/etc/portage/repos.conf/}} also inform Portage if and how the repository can be updated. With it, calling {{c|emerge --sync}} will automatically update the repositories as well.

A deprecated, yet still supported method is to use the <var>PORTDIR_OVERLAY</var> variable inside {{Path|/etc/portage/make.conf}}. This variable can point to one or more additional locations on the file system where repositories are available. The use of the {{Path|[[:/etc/portage/repos.conf]]/}} directory is highly preferred.

Para más información leer sobre [[:/etc/portage/repos.conf|/etc/portage/repos.conf]] y el  [[Project:Portage/Sync#Operation|artículo de Portage/Sync]].

=== Prioridades ===

Each overlay has its unique priority. This makes sure that in the case of a specific version being found in several overlays, the resolution is unambiguous. Ebuilds from overlays with higher priority numbers (for example 60) take precedence over ebuilds from overlays with lower priorities (such as 50).

The list of overlays with their priorities can be obtained through the output of the following commands (look for the "Repositories" string):

{{Cmd|emerge --info --verbose}}

{{Cmd|portageq repos_config /}}

El árbol Portage por defecto de Gentoo tiene una prioridad de -1000. Esto implica que, por lo general, el resto de overlays tienen mayor precedencia ya que se les asigna un prioridad mayor. Este es el comportamiento por defecto ya que los overlays se han diseñado para "colocarse encima" del árbol portage.

== Herramientas de soporte ==

Existen algunas herramientas de soporte para integrar los overlays.

=== Layman ===

La aplicación {{c|layman}} facilita la gestión y actualización de múltiples overlays adicionales. Se trata de una aplicación de la línea de órdenes a través de la cual se pueden listar los overlays disponibles al público, suscritos o no suscritos así como la actualización de esos repositorios. 

Se ofrece soporte tanto para el método {{Path|[[Layman#Using_.27make.conf.27_method_.28older_method.29|make.conf]]}} como para el método {{Path|[[Layman#Using_.27repos.conf.27_method_.28default_method_for_app-portage.2Flayman-2.3.0_or_later_.29|repos.conf]]}}.
* Cuando se utiliza el método {{Path|[[Layman#Using_.27make.conf.27_method_.28older_method.29|make.conf]]}}, {{c|layman}} gestiona un archivo dedicado de configuración que debe ser cargado por {{Path|make.conf}}
* Cuando se utiliza {{Path|[[Layman#Using_.27repos.conf.27_method_.28default_method_for_app-portage.2Flayman-2.3.0_or_later_.29|repos.conf]]}}, {{c|layman}} gestiona el fichero {{Path|[[Layman#Using_.27repos.conf.27_method_.28default_method_for_app-portage.2Flayman-2.3.0_or_later_.29|/etc/portage/repos.conf/layman.conf]]}} directamente.

Para más información, consultar [[Layman]] y [[Project:Portage/Sync#Layman_configuration]].

=== emaint ===

Echar un vistazo a [[Project:Portage/Sync#Operation]] y a {{c|man 1 emaint}}.

=== eix ===

{{c|eix-sync}} es un envoltorio para {{c|emerge --sync}} (que de hecho arranca {{c|emaint sync --auto}}) seguido de {{c|eix-update}}. Para más detalles, leer el artículo sobre [[Eix]] y su página del manual {{c|man 1 eix}}.

Buenas prácticas

=== Generación de cache ===

Cuando se instalan overlays muy voluminosos, a portage le puede llevar mucho tiempo realizar operaciones como la resolución de dependencias. Esto es debido a que los overlays no suelen contener una caché para los metadatos.

Generate a local metadata cache by running {{c|emerge --regen}} after syncing the overlays:

{{RootCmd
|layman -S
|( ulimit -n 4096 && emerge --regen )}}

Be careful, because {{c|emerge --regen}} takes a lot of time and it's not recommended for rsync users as rsync updates the cache using server-side caches (most of users of portage are rsync users). Rsync users should simply run {{c|emerge --sync}} (or {{c|eix-sync}}) to regenerate the cache. It's probably only users of very large overlays should try {{c|emerge --regen}}.

=== Enmascaramiento cuando se utilicen overlays no seguros ===

Cuando se utilizan overlays con muchos paquetes o se cree que son de baja o desconocida calidad, es una buena práctica enmascarar todo el overlay.

{{FileBox|filename=/etc/portage/package.mask|title=Enmascarar todos los paquetes de un overlay|lang=bash|1=
*/*::overlay-name
}}

Después de esto, desenmascarar los paquetes que se instalarán.

{{FileBox|filename=/etc/portage/package.unmask|title=Desenmascarar un paquete específico en un overlay|lang=bash|1=
foo/bar::overlay-name
}}

== Véase también ==

* [[Project:Overlays]]. El proyecto oficial de Gentoo de soporte de overlays.
* [[Project:Overlays/User_Guide]]. Una guía de usuario escrita por el proyecto Overlay.
* [[Project:Overlays/Dev_Guide|Guía del desarrollador de Overlays en Gentoo]]

== Recursos externos ==

* https://overlays.gentoo.org
* https://github.com/gentoo/


[[Category:Portage]]
