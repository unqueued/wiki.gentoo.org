<languages />
{{InfoBox stack
|{{InfoBox wikipedia|header=true}}
|{{InfoBox homepage|http://www.freedesktop.org/wiki/Software/fontconfig/}}
}}

Библиотека {{c|fontconfig}} предназначена для обеспечения единого места, где можно выбрать шрифт и настройки для всех приложений с графическим интерфейсом. {{c|fontconfig}} является основополагающей библиотекой, хотя разные [[:Category:Desktop environment|окружения рабочего стола]] могут предоставлять свои средства конфигурации шрифтов.

== Конфигурация ==

{{Note|Изменения в файлах {{c|fontconfig}} отобразятся только в тех приложениях, которые были запущены после изменений!}}

=== Общие сведения ===

{{c|fontconfig}} использует XML-файлы в директории {{Path|/etc/fonts/}}, чтобы генерировать свою внутреннюю конфигурацию. По умолчанию она парсит {{Path|/etc/fonts/fonts.conf}} (пользователю не следует самостоятельно вносить изменения в этот файл!), который хранит некоторые разумные значения, а также зачастую содержит код для парсинга файлов из {{Path|/etc/fonts/conf.d/}}. Кроме этого, существует директория {{Path|/etc/fonts/conf.avail/}}, в которой находятся всевозможные конфигурационные файлы, каждый из которых покрывает тот или иной аспект {{c|fontconfig}}. Можно создавать символьные ссылки на необходимые файлы в {{Path|/etc/fonts/conf.d/}}. Порядок выполнения зависит от имён файлов; именно поэтому каждое имя начинается с двузначного числа, первая цифра которого (разряд десятков) указывает, на что влияет файл (иначе говоря, класс конфигурационного файла).

=== Специфика Gentoo ===

Gentoo предоставляет модуль [[eselect]] ({{c|eselect fontconfig}}), который в точности осуществляет описанное общим способом — управляет символьными ссылками в {{Path|/etc/fonts/conf.avail/}}, добавляя или удаляя их из директории {{Path|/etc/fonts/conf.d/}}. По понятным причинам изменения конфигурации на уровне системы требуют соответствующих прав доступа.

Следующие подсекции поясняют работу с модулем eselect {{c|fontconfig}}.

==== Список доступных файлов ====

Команда {{c|list}} отображает доступные файлы {{c|fontconfig}} и помечает активные звёздочкой (<code>*</code>).

{{RootCmd|eselect fontconfig list
|output=<pre>
Available fontconfig .conf files (* is enabled):
  [1]   10-autohint.conf *
  [2]   10-no-sub-pixel.conf
  [3]   10-sub-pixel-bgr.conf
  [4]   10-sub-pixel-rgb.conf
  [5]   10-sub-pixel-vbgr.conf
  [6]   10-sub-pixel-vrgb.conf
  [7]   10-unhinted.conf
  [8]   11-lcdfilter-default.conf
  [9]   11-lcdfilter-legacy.conf
  ...
</pre>}}

{{Warning|Содержимое {{Path|fonts.avail}} в разных системах отличается, поэтому вывод ''будет'' отличаться. Никогда не используйте не глядя номера из списков, приведённых, например, в блогах или wiki-статьях.}}

==== Активация файлов ====

Файлы могут быть активированы по имени или по номеру в скобках. Следующие две команды выполняют одно и то же действие:

{{RootCmd
|eselect fontconfig enable 10-sub-pixel-rgb.conf
|eselect fontconfig enable 4
}}

==== Деактивация файлов ====

Файлы могут быть деактивированы аналогичным образом:

{{RootCmd
|eselect fontconfig disable 10-sub-pixel-rgb.conf
|eselect fontconfig disable 4
}}

=== Пользовательская конфигурация для всей системы ===

Чтобы создать пользовательский файл {{c|fontconfig}}, влияющий на всю систему, активируйте {{Path|51-local.conf}} и создайте {{Path|/etc/fonts/local.conf}} (это XML-файл).

{{FileBox|filename=/etc/fonts/local.conf|title=Пример файла, устанавливающего желаемый порядок резервных шрифтов для sans-serif|lang=xml|1=
<?xml version="1.0"?>
<!DOCTYPE fontconfig SYSTEM "fonts.dtd">
<fontconfig>
  <alias>
    <family>sans-serif</family>
    <prefer>
      <family>Ubuntu</family>
      <family>TakaoPGothic</family>
      <family>Droid Sans</family>
    </prefer>
    <default><family>DejaVu Sans</family></default>
  </alias>
</fontconfig>
}}

=== Конфигурация для каждого пользователя отдельно ===

Чтобы создать файлы {{c|fontconfig}} для каждого пользователя, активируйте {{Path|50-user.conf}} (может быть активирован по умолчанию) и сделайте так, чтобы пользователи использовали {{Path|~/config/fontconfig/fonts.conf}}. Этот файл имеет тот же формат XML, что и {{Path|local.conf}}.

{{Note|Это — один из способов, посредством которых среда рабочего стола может влиять на отображение шрифтов. Возможно, перед созданием индивидуальных настроек имеет смысл это выключить, чтобы убедиться, что отображаемые шрифты действительно определяются общесистемными настройками. Выключение этого также делает отображение шрифтов более равномерным для всех пользователей.}}

{{Note|Вместо файла {{Path|~/.fonts.conf}} рекомендуется использовать местонахождение, указанное в переменной <var>$XDG_CONFIG_HOME</var>. По умолчанию, она указывает на {{Path|~/.config}}.}}

=== Проверка конфигурации ===

Проверьте замену шрифта по умолчанию, например, для Arial:

{{Cmd|fc-match Arial}}

== Сглаживание, хинтинг и субпиксельное отображение ==

Тонкости отображения также могут быть настроены. В следующих секциях показана настройка ''сглаживания'', ''хинтинга'' и ''субпиксельного отображения''.

{| class="table table-striped table-condensed"
|-
! scope="col" width="25%" | Параметр
! Описание
|-
| Сглаживание
| по умолчанию включено, делает шрифты менее угловатыми.
|-
| Хинтинг
| является попыткой справиться с малым количеством пикселей на единицу площади текущих дисплеев. Корректный хинтинг делает символы более чёткими, но, так как метрики шрифта не меняются (и, собственно, не должны меняться), влияет на то, как отображаемый текст выглядит в целом.
|-
| Субпиксельное отображение
| использует тот факт, что жидкокристаллическая матрица имеет три основных цвета, чтобы фактически утроить разрешение шрифта, но может заставить символы быть не совсем чёрными. Чтобы не допустить этого, следует использовать субпиксельное отображение совместно с {{c|lcdfilter}} (доступно для свежих версий {{c|fontconfig}}), однако это может слишком сильно размыть шрифт. Наконец, это зависит от личных предпочтений пользователя.
|}

=== Форсирование хинтинга ===

Стандартное поведение {{c|fontconfig}} в отношении хинтинга практически не документировано, но его можно сделать целенаправленно субоптимальным посредством создания общесистемного значения по умолчанию.

# [[#Пользовательская конфигурация для всей системы|Активируйте {{Path|/etc/fonts/local.conf}}]]
# Отредактируйте файл {{Path|local.conf}}, включив полный хинтинг по умолчанию 

Этот фрагмент файла {{Path|local.conf}} включает полный хинтинг:

{{FileBox|filename=/etc/fonts/local.conf|title=Установка полного хинтинга|lang=xml|1=
<match target="font">
  <edit mode="assign" name="hintstyle">
    <const>hintfull</const>
  </edit>
</match>
}}

{{Note|Большая часть шрифтов лучше выглядит с полным хинтингом, некоторым требуется легкий хинтинг или, реже, другие настройки хинтинга. По тем или иным причинам, некоторые шрифты всегда выглядят некрасиво.}}

=== Использование субпиксельного отображения ===

Важно определить субпиксельный формат матрицы жидкокристаллического дисплея. Обычно это RGB ({{Path|10-sub-pixel-rgb.conf}}), однако для того, чтобы точно его установить, нужно либо обратиться к спецификации дисплея, либо воспользоваться этим [http://www.lagom.nl/lcd-test/subpixel.php тестом субпиксельного формата].

После того, как субпиксельный формат определен, активируйте соответствующий файл {{Path|10-sub-pixel-''<matrix type>''.conf}}.

{{RootCmd|eselect fontconfig enable 10-sub-pixel-rgb.conf}}

Для субпиксельного отображения настоятельно рекомендуется использовать {{c|lcdfilter}}, если он доступен. Он доступен в различных вариантах, однако {{Path|11-lcdfilter-default.conf}}, использующийся по умолчанию, должен подойти для всех наиболее распространенных шрифтов.

{{RootCmd|eselect fontconfig enable 11-lcdfilter-default.conf}}

{{Warning|USE-флаг <code>bindist</code> пакета {{Package|media-libs/freetype}} полностью отключает субпиксельное отображение по причине потенциальных проблем с патентами. Убедитесь, что этот USE-флаг выключен для этого пакета.}}

=== О autohinter ===

Autohinter пытается осуществлять автоматический хинтинг, игнорируя существующую информацию о хинтинге. До недавнего времени он использовался по умолчанию, поскольку TrueType2 был защищен патентами. Однако срок патентов истек, и сейчас нет никаких причин для его использования. С технической точки зрения, он работает лучше для шрифтов с неправильной или отсутствующей информацией о хинтинге, однако для шрифтов с хорошей информацией о хинтинге он весьма неоптимален. Системные шрифты, как правило, относятся ко второй категории, поэтому autohinter использовать не следует.

{{Warning|Autohinter не совместим с субпиксельным отображением, поэтому не используйте их вместе!}}

== Infinality ==

Infinality — это (несколько противоречивый) набор патчей для FreeType и сопутствующих файлов {{c|fontconfig}}. Целью Infinality является реализация более высококачественного отображения шрифтов, включая эмуляцию стилей отображения шрифтов других операционных систем.

{{Note|Как обычно, при работе с программным обеспечением, находящимся в разработке, лучше всегда использовать последнюю версию, за исключением случаев, когда с ней есть известные проблемы.}}

=== Включение Infinality ===

Включите USE-флаг 'infinality' либо вручную отредактировав файл {{Path|make.conf}}, либо с помощью утилиты euse.

{{RootCmd|euse -E infinality}}

{{Note|euse часть {{Package|app-portage/gentoolkit}}.}}

Затем пересоберите программы, на которые влияет этот USE-флаг.

{{Emerge|params+=-uvDU|@world}}

Активируйте {{Path|52-infinality.conf}}, если сообщения, отображаемые после пересборки, не требуют этого не делать.

{{RootCmd|eselect fontconfig enable 52-infinality.conf}}

=== Настройка Infinality ===

Infinality можно настроить различными способами, включая индивидуальные конфигурации, однако наиболее простым способом является использование готовых профилей, включенных в пакет {{Package|media-libs/fontconfig-infinality}}. Этот пакет, вместе с модулями eselect, должен устанавливаться как зависимость USE-флага <code>infinality</code>.

==== Быстрая и приемлимая конфигурация ====

{{RootCmd|eselect infinality set infinality
|eselect lcdfilter set infinality}}

{{Note|Как и в других случаях, изменения {{c|fontconfig}} влияют только на приложения, запущенные после внесения изменений.}}

Также рекомендуется выключить все настройки {{c|fontconfig}} кроме {{Path|52-infinality.conf}}, так как они вмешиваются в отображение стилей infinality:

{{RootCmd|eselect fontconfig disable <number>}}

Некоторые настройки {{c|fontconfig}} не влияют на отображение шрифтов, но определяют шрифты по умолчанию для типов шрифтов (таких как Monospace, sans-serif и так далее). Такие настройки (например, конфигурации {{Path|62-croscore-*.conf}}) можно оставить включенными.

==== Объяснение ====

Infinality предоставляет переменные окружения FreeType, которые могут использоваться для настройки возможностей, реализуемых патчами infinality, а также файлы {{c|fontconfig}} для использования с этими изменениями. Управление наборами файлов {{c|fontconfig}} на Gentoo осуществляется с помощью {{c|eselect infinality}}, а поведение FreeType настраивается с помощью {{c|eselect lcdfilter}}.

Эти модули eselect работают, как обычно:

* Выведение списка доступных наборов файлов fontconfig.
: {{RootCmd|eselect infinality list}}
* Выведение списка доступных наборов переменных FreeType.
: {{RootCmd|eselect lcdfilter list}}
* Разумеется, оба набора должны находиться в соответствии друг с другом, за исключением ситуации, когда возможны различные соответствия, как в нижеследующем примере.
: {{RootCmd|eselect infinality set win7|eselect lcdfilter set windows-7-light}}

== Выбор шрифтов ==

Choosing the right font can be trickier than deciding on the right hinting type. For one reason or another fonts will not be perfect but it's certainly doable to make that same fonts look better than, say, Windows 7 default font configuration. 

{| class="table table-striped table-condensed"
|-
! scope="col" width="25%" |Font family
! Good
! Bad
|-
|Liberation ({{Package|media-fonts/liberation-fonts}}) || Metric compatible with MS TrueType corefonts, decent, modern look. Gentoo fonts team recommendation for default Latin fonts. || A few glyphs may have hinting trouble.
|-
|Noto ({{Package|media-fonts/noto}}) || Google's font family that aims to support all the world's languages. Goes well with Liberation or Droid. Includes Adobe's Source Han Sans fonts for CJK. Recommended as fallback for glyphs not covered by Liberation. || Big download.
|-
|DejaVu ({{Package|media-fonts/dejavu}}) || Many styles, covers a lot of code points || Exceptionally wide - even condensed is wider than same height monospace (not to mention average sans-serif font), overall second to Verdana (an MS font) in width.
|-
|Droid ({{Package|media-fonts/droid}}) || Covers a lot of code points and scripts || Very dry, wide yet thin glyphs is probably the most memorable aspect of Droid font family. Clearly designed with handheld devices and their small screens in mind.
|-
|Gentium Plus ({{Package|media-fonts/sil-gentium}}) || Fairly distinctive, might appeal to people who like narrow fonts || Only serif, as with other SIL fonts hinting is questionable.
|-
|Ubuntu ({{Package|media-fonts/ubuntu-font-family}}) || A distinctive font with style which might not appeal to everyone, overall looks good as well as covering a fair bit of code points. || Only default sans-serif is truly polished, narrow and monospaced versions are unfinished. No known serif font that would accompany it well.
|-
|URW ({{Package|media-fonts/urw-fonts}}) || Metric compatible with popular Adobe fonts (among others?) || Seem to require slight hinting.
|-<!--Keep below open source fonts.-->
|MS TrueType corefonts ({{Package|media-fonts/corefonts}}) || Includes most fonts used in documents or on web || MS does not distribute them nowadays so the available fonts are from many years ago and do not reflect the current state of them. Obviously lacks fonts introduced later. Require full hinting.
|-<!--Always keep this entry at the bottom as the only reason it's included is to warn people against using it!-->
|Unifont ({{Package|media-fonts/unifont}}) || Covers a lot of code points. || In addition to being ''ugly as sin'' it also fails basic requirements to be considered a typeface - is it sans-serif, is it serif? Please never use this.
|}

== Ссылки ==

* In-depth articles from Arch Linux wiki on:
** [https://wiki.archlinux.org/index.php/Font_configuration Font configuration]
** [https://wiki.archlinux.org/index.php/Infinality Infinality]
* [http://freedesktop.org/software/fontconfig/fontconfig-user.html Official {{c|fontconfig}} documentation for users]
* [[Wikipedia:Hinting|Wikipedia article on font hinting]]

[[Category:Desktop]]
