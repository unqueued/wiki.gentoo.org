<languages />
{{InfoBox stack
|{{InfoBox wikipedia|header=true}}
|{{InfoBox homepage|http://www.freedesktop.org/wiki/Software/fontconfig/}}
}}

Библиотека {{c|fontconfig}} ({{Package|media-libs/fontconfig}}) предназначена для обеспечения единого места, где можно выбрать шрифт и настройки для всех приложений с графическим интерфейсом. {{c|fontconfig}} является основополагающей библиотекой, хотя разные [[desktop environment|окружения рабочего стола]] могут предоставлять свои настройки шрифтов и утилиты для их конфигурации.

== Установка ==

Почти наверняка {{c|fontconfig}} уже установлен, когда он вдруг понадобится. Если это не так, убедитесь, что правильно настроили графическую подсистему (например, [[X]] или [[Wayland]]) и [[desktop environment|окружение рабочего стола]].

=== USE-флаги ===

{{c|fontconfig}} не содержит много USE-флагов.

{{USEflag|package=media-libs/fontconfig}}

== Конфигурация ==

{{Note|Изменения в файлах {{c|fontconfig}} отобразятся только в тех приложениях, которые были запущены после изменений!}}

=== Общие сведения ===

Чтобы сгенерировать свою внутреннюю конфигурацию {{c|fontconfig}} использует XML-файлы в каталоге {{Path|/etc/fonts/}}. По умолчанию она парсит {{Path|/etc/fonts/fonts.conf}} (пользователю не следует самостоятельно вносить изменения в этот файл!), который хранит некоторые разумные значения, а также зачастую содержит код для парсинга файлов из {{Path|/etc/fonts/conf.d/}}. Кроме этого, есть каталог {{Path|/etc/fonts/conf.avail/}}, в котором находятся всевозможные конфигурационные файлы, каждый из которых покрывает тот или иной аспект {{c|fontconfig}}. Можно создавать символьные ссылки на необходимые файлы в {{Path|/etc/fonts/conf.d/}}. Порядок выполнения зависит от имён файлов; именно поэтому каждое имя начинается с двузначного числа, первая цифра которого (разряд десятков) указывает, на что влияет файл (иначе говоря, класс конфигурационного файла).

=== Специфика Gentoo ===

Gentoo предоставляет модуль [[eselect]] ({{c|eselect fontconfig}}), который в точности осуществляет описанное общим способом — управляет символьными ссылками в {{Path|/etc/fonts/conf.avail/}}, добавляя или удаляя их из каталога {{Path|/etc/fonts/conf.d/}}. По понятным причинам изменение конфигурации для всей системы требует соответствующих прав доступа.

Следующие подразделы поясняют работу с модулем eselect {{c|fontconfig}}.

==== Список доступных файлов ====

Команда {{c|list}} отображает доступные файлы {{c|fontconfig}} и помечает активные звёздочкой (<code>*</code>).

{{RootCmd|eselect fontconfig list
|output=<pre>
Available fontconfig .conf files (* is enabled):
  [1]   10-autohint.conf *
  [2]   10-no-sub-pixel.conf
  [3]   10-sub-pixel-bgr.conf
  [4]   10-sub-pixel-rgb.conf
  [5]   10-sub-pixel-vbgr.conf
  [6]   10-sub-pixel-vrgb.conf
  [7]   10-unhinted.conf
  [8]   11-lcdfilter-default.conf
  [9]   11-lcdfilter-legacy.conf
  ...
</pre>}}

{{Warning|Содержимое {{Path|fonts.avail}} в разных системах отличается, поэтому вывод ''будет'' отличаться. Никогда не используйте не глядя номера из списков, приведённых, например, в блогах или wiki-статьях.}}

==== Активация файлов ====

Файлы могут быть активированы по имени или по номеру в скобках. Следующие две команды выполняют одно и то же действие:

{{RootCmd
|eselect fontconfig enable 10-sub-pixel-rgb.conf
|eselect fontconfig enable 4
}}

==== Деактивация файлов ====

Файлы могут быть деактивированы аналогичным образом:

{{RootCmd
|eselect fontconfig disable 10-sub-pixel-rgb.conf
|eselect fontconfig disable 4
}}

=== Пользовательская конфигурация для всей системы ===

Чтобы создать пользовательский файл {{c|fontconfig}}, влияющий на всю систему, активируйте {{Path|51-local.conf}} и создайте {{Path|/etc/fonts/local.conf}} (это XML-файл).

{{FileBox|filename=/etc/fonts/local.conf|title=Пример файла, устанавливающего желаемый порядок резервных шрифтов для sans-serif|lang=xml|1=
<?xml version="1.0"?>
<!DOCTYPE fontconfig SYSTEM "fonts.dtd">
<fontconfig>
  <alias>
    <family>sans-serif</family>
    <prefer>
      <family>Ubuntu</family>
      <family>TakaoPGothic</family>
      <family>Droid Sans</family>
    </prefer>
    <default><family>DejaVu Sans</family></default>
  </alias>
</fontconfig>
}}

Поясним. Это настройка сообщает, что когда речь идет о шрифтах из группы sans-serif, мы ''предпочитаем'' использование шрифтов Ubuntu, TakaoPGothic и Droid Sans (в таком порядке) вместо DejaVu Sans (которые могут быть как выбор ''по умолчанию'' только тогда, когда это необходимо). Очевидно, что здесь можно сделать другой выбор.

=== Конфигурация для каждого пользователя отдельно ===

Чтобы создать файлы {{c|fontconfig}} для каждого пользователя, активируйте {{Path|50-user.conf}} (может быть активирован по умолчанию) и сделайте так, чтобы пользователи использовали {{Path|~/config/fontconfig/fonts.conf}}. Этот файл имеет тот же формат XML, что и {{Path|local.conf}}.

{{Note|Это один из способов, благодаря которому окружение рабочего стола может влиять на отображение шрифтов. Возможно, имеет смысл выключить эту настройку, чтобы убедиться, что при настройке отображаются только действительно общесистемные настройки. Выключение этой настройки также дает более универсальное отображение шрифтов для всех пользователей.}}

{{Note|Ранее используемый {{Path|~/.fonts.conf}} теперь устарел в пользу месторасположения, указанного в переменной <var>$XDG_CONFIG_HOME</var>. По умолчанию переменная указывает на {{Path|~/.config}}.}}

=== Проверка конфигурации ===

Проверьте замену шрифта по умолчанию, например, для Arial:

{{Cmd|fc-match Arial}}

== Сглаживание, хинтинг и субпиксельное отображение ==

Тонкости отображения также могут быть настроены. В следующих разделах показана настройка ''сглаживания'', ''хинтинга'' и ''субпиксельного отображения''.

{| class="table table-striped table-condensed"
|-
! scope="col" width="25%" | Параметр
! Описание
|-
| Сглаживание
| по умолчанию включено, делает шрифты менее угловатыми.
|-
| Хинтинг
| попытка справиться с малым количеством пикселей на единицу площади текущих дисплеев. Корректный хинтинг делает символы более чёткими, но, так как метрики шрифта не меняются (и, собственно, не должны меняться), влияет на то, как отображаемый текст выглядит в целом.
|-
| Субпиксельное отображение
| использует тот факт, что жидкокристаллическая матрица имеет три основных цвета, чтобы фактически утроить разрешение шрифта, но может заставить символы быть не совсем чёрными. Чтобы не допустить этого, следует использовать субпиксельное отображение совместно с {{c|lcdfilter}} (доступно в свежих версиях {{c|fontconfig}}), однако это может слишком сильно размыть шрифт. Наконец, это зависит от личных предпочтений пользователя.
|}

=== Форсирование хинтинга ===

Стандартное поведение {{c|fontconfig}} в отношении хинтинга практически не документировано, но его можно сделать целенаправленно субоптимальным посредством создания общесистемного значения по умолчанию.

# [[#Пользовательская конфигурация для всей системы|Активируйте {{Path|/etc/fonts/local.conf}}]]
# Отредактируйте файл {{Path|local.conf}}, включив полный хинтинг по умолчанию 

Этот фрагмент файла {{Path|local.conf}} включает полный хинтинг:

{{FileBox|filename=/etc/fonts/local.conf|title=Установка полного хинтинга|lang=xml|1=
<match target="font">
  <edit mode="assign" name="hintstyle">
    <const>hintfull</const>
  </edit>
</match>
}}

{{Note|Большая часть шрифтов лучше выглядит с полным хинтингом, некоторым требуется легкий хинтинг или, реже, другие настройки хинтинга. По тем или иным причинам, некоторые шрифты всегда выглядят некрасиво.}}

=== Использование субпиксельного отображения ===

Важно определить субпиксельный формат матрицы жидкокристаллического дисплея. Обычно это RGB ({{Path|10-sub-pixel-rgb.conf}}), однако для того, чтобы точно его установить, нужно либо обратиться к спецификации дисплея, либо воспользоваться этим [http://www.lagom.nl/lcd-test/subpixel.php тестом субпиксельного формата].

После того, как субпиксельный формат определен, активируйте соответствующий файл {{Path|10-sub-pixel-''<matrix type>''.conf}}.

{{RootCmd|eselect fontconfig enable 10-sub-pixel-rgb.conf}}

Для субпиксельного отображения настоятельно рекомендуется использовать {{c|lcdfilter}}, если он доступен. Он доступен в различных вариантах, однако {{Path|11-lcdfilter-default.conf}}, использующийся по умолчанию, должен подойти для всех наиболее распространенных шрифтов.

{{RootCmd|eselect fontconfig enable 11-lcdfilter-default.conf}}

{{Warning|USE-флаг <code>bindist</code> пакета {{Package|media-libs/freetype}} полностью отключает субпиксельное отображение по причине потенциальных проблем с патентами. Чтобы воспользоваться субпиксельным отображением, USE-флаг должен быть в этом пакете (то есть <code>-bindist</code>).}}

=== О autohinter ===

Autohinter пытается осуществлять автоматический хинтинг, игнорируя существующую информацию о хинтинге. До недавнего времени он использовался по умолчанию, поскольку TrueType2 был защищен патентами. Однако срок патентов истек, и сейчас нет никаких причин для его использования. С технической точки зрения, он работает лучше для шрифтов с неправильной или отсутствующей информацией о хинтинге, однако для шрифтов с хорошей информацией о хинтинге он весьма неоптимален. Системные шрифты, как правило, относятся ко второй категории, поэтому autohinter использовать не следует.

{{Warning|Autohinter не совместим с субпиксельным отображением, поэтому не используйте их вместе!}}

== Infinality ==

Infinality — это (несколько противоречивый) набор патчей для FreeType и сопутствующих файлов {{c|fontconfig}}. Целью Infinality является реализация более высококачественного отображения шрифтов, включая эмуляцию стилей отображения шрифтов других операционных систем.

{{Note|Как обычно, при работе с программным обеспечением, находящимся в разработке, лучше всегда использовать последнюю версию, за исключением случаев, когда с ней есть известные проблемы.}}

=== Включение Infinality ===

Включите USE-флаг 'infinality' либо вручную отредактировав файл {{Path|make.conf}}, либо с помощью утилиты {{c|[[euse/ru|euse]]}}.

{{RootCmd|euse -E infinality}}

Затем пересоберите программы, на которые влияет этот USE-флаг.

{{Emerge|params+=-uvDU|@world}}

Активируйте {{Path|52-infinality.conf}}, если сообщения, отображаемые после пересборки, не требуют этого не делать.

{{RootCmd|eselect fontconfig enable 52-infinality.conf}}

=== Настройка Infinality ===

Infinality можно настроить различными способами, включая индивидуальные конфигурации, однако наиболее простым способом является использование готовых профилей, включенных в пакет {{Package|media-libs/fontconfig-infinality}}. Этот пакет, вместе с модулями eselect, должен устанавливаться как зависимость USE-флага <code>infinality</code>.

==== Быстрая и приемлимая конфигурация ====

{{RootCmd|eselect infinality set infinality
|eselect lcdfilter set infinality}}

{{Note|Как и в других случаях, изменения {{c|fontconfig}} влияют только на приложения, запущенные после внесения изменений.}}

Также рекомендуется выключить все настройки {{c|fontconfig}} кроме {{Path|52-infinality.conf}}, так как они вмешиваются в отображение стилей infinality:

{{RootCmd|eselect fontconfig disable <number>}}

Некоторые настройки {{c|fontconfig}} не влияют на отображение шрифтов, но определяют шрифты по умолчанию для типов шрифтов (таких как Monospace, sans-serif и так далее). Такие настройки (например, конфигурации {{Path|62-croscore-*.conf}}) можно оставить включенными.

==== Объяснение ====

Infinality предоставляет переменные окружения FreeType, которые могут использоваться для настройки возможностей, реализуемых патчами infinality, а также файлы {{c|fontconfig}} для использования с этими изменениями. Управление наборами файлов {{c|fontconfig}} на Gentoo осуществляется с помощью {{c|eselect infinality}}, а поведение FreeType настраивается с помощью {{c|eselect lcdfilter}}.

Эти модули eselect работают, как обычно:

* Выведение списка доступных наборов файлов fontconfig.
: {{RootCmd|eselect infinality list}}
* Выведение списка доступных наборов переменных FreeType.
: {{RootCmd|eselect lcdfilter list}}
* Разумеется, оба набора должны находиться в соответствии друг с другом, за исключением ситуации, когда возможны различные соответствия, как в нижеследующем примере.
: {{RootCmd|eselect infinality set win7|eselect lcdfilter set windows-7-light}}

== Выбор шрифтов ==

Выбор нужного шрифта может быть более трудной задачей, чем выбор правильного типа хинтинга. По той или иной причине, некоторые шрифты никогда не будут идеальными, однако возможно сделать их внешний вид лучше, чем, скажем, в стандартной конфигурации шрифтов в Windows 7. 

Вот некоторые рекомендации относительно хорошо известных шрифтов в Gentoo:

{| class="table table-striped table-condensed"
|-
! scope="col" width="25%" |Семейство шрифтов
! Pros
! Cons
|-
|Liberation<br />{{Package|media-fonts/liberation-fonts}}
| [[Wikipedia:Red Hat|Red Hat's]] fonts, which are metric-compatible with MS TrueType [[Wikipedia:Corefonts|corefonts]], have a decent, modern look. This is the [[Project:Fonts|Gentoo Fonts team]] recommendation for default Latin fonts. Covers about 2,600 code points.
| Latin, Greek, Cyrillic, and Hebrew only. A few glyphs may have hinting trouble.
|-
|Linux Libertine<br />{{Package|media-fonts/libertine}}
| Very similar to Liberation, covering about 2,700 code points. Linux Libertine itself is proportional serif only, but the package contains less extensive sans and mono fonts, as well. Can be used as a fallback for some glyphs not in Liberation.
| Latin, Greek, Cyrillic, and Hebrew only. Sans and mono fonts are limited.
|-
|Noto<br />{{Package|media-fonts/noto}}
| Google's font family that aims to support all the world's languages (so, well over 60,000 code points). It goes well with Liberation or Droid. Adobe's Source Han Sans fonts are included for [[Wikipedia:CJK|CJK]]. Recommended as a fallback for many glyphs not covered by Liberation.
| Big download.
|-
|DejaVu<br />{{Package|media-fonts/dejavu}}
| Many styles and covers a lot of code points (about 6,100 for sans).
| Exceptionally wide — even condensed is wider than same-height monospace. Overall second to [[Wikipedia:Verdana|Verdana]] (an MS font) in width. Sans-serif font is only average.
|-
|Droid<br />{{Package|media-fonts/droid}}
| Covers a lot of code points and scripts.
| Very dry, wide yet thin glyphs. Clearly designed with handheld devices and their small screens in mind.
|-
|Gentium Plus<br />{{Package|media-fonts/sil-gentium}}
| Fairly distinctive; might appeal to people who like narrow fonts.
| Serif only. As with other [[Wikipedia:SIL International|SIL]] fonts, the hinting is questionable.
|-
|Ubuntu<br />{{Package|media-fonts/ubuntu-font-family}}
| Used in [[Wikipedia:Ubuntu (operating system)|Ubuntu]] (obviously). A distinctive font family with a style which might not appeal to everyone. Overall looks good and covers a fair number of code points.
| Only the sans-serif font is truly polished; narrow and monospaced versions are unfinished. No known serif font that would accompany it well.
|-
|URW<br />{{Package|media-fonts/urw-fonts}}
| Metric compatible with popular Adobe fonts (among others?).
| Seem to require slight hinting.
|-<!--Keep these below the open-source fonts.-->
|MS TrueType corefonts<br />{{Package|media-fonts/corefonts}}
| Includes most fonts used in documents and on the web.
| MS does not distribute them nowadays, so the available fonts are from many years ago and do not reflect their current state (not to mention the state of the art). Obviously, lacks fonts introduced more recently. Require full hinting.
|-<!--Always keep this entry at the bottom as the only reason it's included is to warn people against using it!-->
|Unifont<br />{{Package|media-fonts/unifont}}
| Covers a lot of code points.
| In addition to being ''ugly as sin'', it also fails some basic requirements to be considered a typeface. Is it sans-serif? Is it serif? ''Please never use this.''
|}

== Внешние ресурсы ==

* Подробные статьи на Arch Linux wiki по:
** [https://wiki.archlinux.org/index.php/Font_configuration Настройке шрифтов]
** [https://wiki.archlinux.org/index.php/Infinality Infinality]
* [http://freedesktop.org/software/fontconfig/fontconfig-user.html Официальная документация для пользователей {{c|fontconfig}}]
* [[Wikipedia:Hinting|Статья на Wikipedia о хинтинге шрифтов]]

[[Category:Desktop]]
