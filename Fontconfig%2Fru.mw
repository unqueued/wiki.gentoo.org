<languages />
{{InfoBox stack
|{{InfoBox wikipedia|header=true}}
|{{InfoBox homepage|http://www.freedesktop.org/wiki/Software/fontconfig/}}
}}

Библиотека {{c|fontconfig}} предназначена для обеспечения единого места, где можно выбрать шрифт и настройки для всех приложений с графическим интерфейсом. {{c|fontconfig}} является основополагающей библиотекой, хотя разные [[:Category:Desktop environment|окружения рабочего стола]] могут предоставлять свои средства конфигурации шрифтов.

== Installing ==

When {{c|fontconfig}} is needed, it will almost certainly be installed already. If not, make sure to set up the graphical subsystem (i.e., [[X]] or [[Wayland]]) and [[desktop environment]] properly.

=== USE flags ===

{{c|fontconfig}} doesn't know many USE flags.

{{USEflag|package=media-libs/fontconfig}}

== Конфигурация ==

{{Note|Изменения в файлах {{c|fontconfig}} отобразятся только в тех приложениях, которые были запущены после изменений!}}

=== Общие сведения ===

Чтобы сгенерировать свою внутреннюю конфигурацию {{c|fontconfig}} использует XML-файлы в каталоге {{Path|/etc/fonts/}}. По умолчанию она парсит {{Path|/etc/fonts/fonts.conf}} (пользователю не следует самостоятельно вносить изменения в этот файл!), который хранит некоторые разумные значения, а также зачастую содержит код для парсинга файлов из {{Path|/etc/fonts/conf.d/}}. Кроме этого, есть каталог {{Path|/etc/fonts/conf.avail/}}, в котором находятся всевозможные конфигурационные файлы, каждый из которых покрывает тот или иной аспект {{c|fontconfig}}. Можно создавать символьные ссылки на необходимые файлы в {{Path|/etc/fonts/conf.d/}}. Порядок выполнения зависит от имён файлов; именно поэтому каждое имя начинается с двузначного числа, первая цифра которого (разряд десятков) указывает, на что влияет файл (иначе говоря, класс конфигурационного файла).

=== Специфика Gentoo ===

Gentoo предоставляет модуль [[eselect]] ({{c|eselect fontconfig}}), который в точности осуществляет описанное общим способом — управляет символьными ссылками в {{Path|/etc/fonts/conf.avail/}}, добавляя или удаляя их из каталога {{Path|/etc/fonts/conf.d/}}. По понятным причинам изменение конфигурации для всей системы требует соответствующих прав доступа.

Следующие подразделы поясняют работу с модулем eselect {{c|fontconfig}}.

==== Список доступных файлов ====

Команда {{c|list}} отображает доступные файлы {{c|fontconfig}} и помечает активные звёздочкой (<code>*</code>).

{{RootCmd|eselect fontconfig list
|output=<pre>
Available fontconfig .conf files (* is enabled):
  [1]   10-autohint.conf *
  [2]   10-no-sub-pixel.conf
  [3]   10-sub-pixel-bgr.conf
  [4]   10-sub-pixel-rgb.conf
  [5]   10-sub-pixel-vbgr.conf
  [6]   10-sub-pixel-vrgb.conf
  [7]   10-unhinted.conf
  [8]   11-lcdfilter-default.conf
  [9]   11-lcdfilter-legacy.conf
  ...
</pre>}}

{{Warning|Содержимое {{Path|fonts.avail}} в разных системах отличается, поэтому вывод ''будет'' отличаться. Никогда не используйте не глядя номера из списков, приведённых, например, в блогах или wiki-статьях.}}

==== Активация файлов ====

Файлы могут быть активированы по имени или по номеру в скобках. Следующие две команды выполняют одно и то же действие:

{{RootCmd
|eselect fontconfig enable 10-sub-pixel-rgb.conf
|eselect fontconfig enable 4
}}

==== Деактивация файлов ====

Файлы могут быть деактивированы аналогичным образом:

{{RootCmd
|eselect fontconfig disable 10-sub-pixel-rgb.conf
|eselect fontconfig disable 4
}}

=== Пользовательская конфигурация для всей системы ===

Чтобы создать пользовательский файл {{c|fontconfig}}, влияющий на всю систему, активируйте {{Path|51-local.conf}} и создайте {{Path|/etc/fonts/local.conf}} (это XML-файл).

{{FileBox|filename=/etc/fonts/local.conf|title=Пример файла, устанавливающего желаемый порядок резервных шрифтов для sans-serif|lang=xml|1=
<?xml version="1.0"?>
<!DOCTYPE fontconfig SYSTEM "fonts.dtd">
<fontconfig>
  <alias>
    <family>sans-serif</family>
    <prefer>
      <family>Ubuntu</family>
      <family>TakaoPGothic</family>
      <family>Droid Sans</family>
    </prefer>
    <default><family>DejaVu Sans</family></default>
  </alias>
</fontconfig>
}}

To be clear, this says that when it comes to sans-serif fonts, we ''prefer'' using Ubuntu, TakaoPGothic, and Droid Sans fonts (in that order) over DejaVu Sans (which can be used as a ''default'' choice only when necessary). Obviously, different choices can be made here.

=== Конфигурация для каждого пользователя отдельно ===

Чтобы создать файлы {{c|fontconfig}} для каждого пользователя, активируйте {{Path|50-user.conf}} (может быть активирован по умолчанию) и сделайте так, чтобы пользователи использовали {{Path|~/config/fontconfig/fonts.conf}}. Этот файл имеет тот же формат XML, что и {{Path|local.conf}}.

{{Note|Это один из способов, благодаря которому окружение рабочего стола может влиять на отображение шрифтов. Возможно, имеет смысл выключить эту настройку, чтобы убедиться, что при настройке отображаются только действительно общесистемные настройки. Выключение этой настройки также дает более универсальное отображение шрифтов для всех пользователей.}}

{{Note|Ранее используемый {{Path|~/.fonts.conf}} теперь устарел в пользу месторасположения, указанного в переменной <var>$XDG_CONFIG_HOME</var>. По умолчанию переменная указывает на {{Path|~/.config}}.}}

=== Проверка конфигурации ===

Проверьте замену шрифта по умолчанию, например, для Arial:

{{Cmd|fc-match Arial}}

== Сглаживание, хинтинг и субпиксельное отображение ==

Тонкости отображения также могут быть настроены. В следующих разделах показана настройка ''сглаживания'', ''хинтинга'' и ''субпиксельного отображения''.

{| class="table table-striped table-condensed"
|-
! scope="col" width="25%" | Параметр
! Описание
|-
| Сглаживание
| по умолчанию включено, делает шрифты менее угловатыми.
|-
| Хинтинг
| попытка справиться с малым количеством пикселей на единицу площади текущих дисплеев. Корректный хинтинг делает символы более чёткими, но, так как метрики шрифта не меняются (и, собственно, не должны меняться), влияет на то, как отображаемый текст выглядит в целом.
|-
| Субпиксельное отображение
| использует тот факт, что жидкокристаллическая матрица имеет три основных цвета, чтобы фактически утроить разрешение шрифта, но может заставить символы быть не совсем чёрными. Чтобы не допустить этого, следует использовать субпиксельное отображение совместно с {{c|lcdfilter}} (доступно в свежих версиях {{c|fontconfig}}), однако это может слишком сильно размыть шрифт. Наконец, это зависит от личных предпочтений пользователя.
|}

=== Форсирование хинтинга ===

Стандартное поведение {{c|fontconfig}} в отношении хинтинга практически не документировано, но его можно сделать целенаправленно субоптимальным посредством создания общесистемного значения по умолчанию.

# [[#Пользовательская конфигурация для всей системы|Активируйте {{Path|/etc/fonts/local.conf}}]]
# Отредактируйте файл {{Path|local.conf}}, включив полный хинтинг по умолчанию 

Этот фрагмент файла {{Path|local.conf}} включает полный хинтинг:

{{FileBox|filename=/etc/fonts/local.conf|title=Установка полного хинтинга|lang=xml|1=
<match target="font">
  <edit mode="assign" name="hintstyle">
    <const>hintfull</const>
  </edit>
</match>
}}

{{Note|Большая часть шрифтов лучше выглядит с полным хинтингом, некоторым требуется легкий хинтинг или, реже, другие настройки хинтинга. По тем или иным причинам, некоторые шрифты всегда выглядят некрасиво.}}

=== Использование субпиксельного отображения ===

Важно определить субпиксельный формат матрицы жидкокристаллического дисплея. Обычно это RGB ({{Path|10-sub-pixel-rgb.conf}}), однако для того, чтобы точно его установить, нужно либо обратиться к спецификации дисплея, либо воспользоваться этим [http://www.lagom.nl/lcd-test/subpixel.php тестом субпиксельного формата].

После того, как субпиксельный формат определен, активируйте соответствующий файл {{Path|10-sub-pixel-''<matrix type>''.conf}}.

{{RootCmd|eselect fontconfig enable 10-sub-pixel-rgb.conf}}

Для субпиксельного отображения настоятельно рекомендуется использовать {{c|lcdfilter}}, если он доступен. Он доступен в различных вариантах, однако {{Path|11-lcdfilter-default.conf}}, использующийся по умолчанию, должен подойти для всех наиболее распространенных шрифтов.

{{RootCmd|eselect fontconfig enable 11-lcdfilter-default.conf}}

{{Warning|The <code>bindist</code> USE flag in {{Package|media-libs/freetype}} disables sub-pixel rendering altogether due to potential patenting issues. In order to use sub-pixel rendering, the USE flag must be disabled (i.e., <code>-bindist</code>) for this package.}}

=== О autohinter ===

Autohinter пытается осуществлять автоматический хинтинг, игнорируя существующую информацию о хинтинге. До недавнего времени он использовался по умолчанию, поскольку TrueType2 был защищен патентами. Однако срок патентов истек, и сейчас нет никаких причин для его использования. С технической точки зрения, он работает лучше для шрифтов с неправильной или отсутствующей информацией о хинтинге, однако для шрифтов с хорошей информацией о хинтинге он весьма неоптимален. Системные шрифты, как правило, относятся ко второй категории, поэтому autohinter использовать не следует.

{{Warning|Autohinter не совместим с субпиксельным отображением, поэтому не используйте их вместе!}}

== Infinality ==

Infinality — это (несколько противоречивый) набор патчей для FreeType и сопутствующих файлов {{c|fontconfig}}. Целью Infinality является реализация более высококачественного отображения шрифтов, включая эмуляцию стилей отображения шрифтов других операционных систем.

{{Note|Как обычно, при работе с программным обеспечением, находящимся в разработке, лучше всегда использовать последнюю версию, за исключением случаев, когда с ней есть известные проблемы.}}

=== Включение Infinality ===

Включите USE-флаг 'infinality' либо вручную отредактировав файл {{Path|make.conf}}, либо с помощью утилиты euse.

{{RootCmd|euse -E infinality}}

Затем пересоберите программы, на которые влияет этот USE-флаг.

{{Emerge|params+=-uvDU|@world}}

Активируйте {{Path|52-infinality.conf}}, если сообщения, отображаемые после пересборки, не требуют этого не делать.

{{RootCmd|eselect fontconfig enable 52-infinality.conf}}

=== Настройка Infinality ===

Infinality можно настроить различными способами, включая индивидуальные конфигурации, однако наиболее простым способом является использование готовых профилей, включенных в пакет {{Package|media-libs/fontconfig-infinality}}. Этот пакет, вместе с модулями eselect, должен устанавливаться как зависимость USE-флага <code>infinality</code>.

==== Быстрая и приемлимая конфигурация ====

{{RootCmd|eselect infinality set infinality
|eselect lcdfilter set infinality}}

{{Note|Как и в других случаях, изменения {{c|fontconfig}} влияют только на приложения, запущенные после внесения изменений.}}

Также рекомендуется выключить все настройки {{c|fontconfig}} кроме {{Path|52-infinality.conf}}, так как они вмешиваются в отображение стилей infinality:

{{RootCmd|eselect fontconfig disable <number>}}

Некоторые настройки {{c|fontconfig}} не влияют на отображение шрифтов, но определяют шрифты по умолчанию для типов шрифтов (таких как Monospace, sans-serif и так далее). Такие настройки (например, конфигурации {{Path|62-croscore-*.conf}}) можно оставить включенными.

==== Объяснение ====

Infinality предоставляет переменные окружения FreeType, которые могут использоваться для настройки возможностей, реализуемых патчами infinality, а также файлы {{c|fontconfig}} для использования с этими изменениями. Управление наборами файлов {{c|fontconfig}} на Gentoo осуществляется с помощью {{c|eselect infinality}}, а поведение FreeType настраивается с помощью {{c|eselect lcdfilter}}.

Эти модули eselect работают, как обычно:

* Выведение списка доступных наборов файлов fontconfig.
: {{RootCmd|eselect infinality list}}
* Выведение списка доступных наборов переменных FreeType.
: {{RootCmd|eselect lcdfilter list}}
* Разумеется, оба набора должны находиться в соответствии друг с другом, за исключением ситуации, когда возможны различные соответствия, как в нижеследующем примере.
: {{RootCmd|eselect infinality set win7|eselect lcdfilter set windows-7-light}}

== Выбор шрифтов ==

Выбор нужного шрифта может являться более трудной задачей, чем выбор правильного типа хинтинга. По той или иной причине, шрифты не будут выглядеть идеально, однако заставить те же самые шрифты выглядеть лучше, чем, например, в стандартной конфигурации шрифтов в Windows 7, вполне возможно. 

Here are some recommendations regarding well known fonts in Gentoo:

{| class="table table-striped table-condensed"
|-
! scope="col" width="25%" |Семейство шрифтов
! Достоинства
! Недостатки
|-
|Liberation ({{Package|media-fonts/liberation-fonts}}) || Метрика совместима с MS TrueType corefonts, подходящий современный вид. Рекомендуются командой шрифтов Gentoo в качестве шрифтов Latin по умолчанию. || У некоторых глифов могут быть проблемы с хинтингом.
|-
|Noto ({{Package|media-fonts/noto}}) || Семейство шрифтов Google, имеющее целью поддержку всех языков мира. Хорошо сочетается с Liberation и Droid. Включает Source Han Sans шрифты для CJK от Adobe. Рекомендуется в качестве запасного варианта для глифов, не поддерживающихся в Liberation. || Большая загрузка.
|-
|DejaVu ({{Package|media-fonts/dejavu}}) || Множество стилей, поддерживают множество code points. || Чрезмерно широкие — даже узкие варианты шире, чем monospace той же высоты (не говоря о типичном шрифте sans-serif), на втором месте по ширине после Verdana (шрифт MS).
|-
|Droid ({{Package|media-fonts/droid}}) || Поддерживают множество code points и сценариев. || Очень тонкие но при этом широкие глифы — наверное, самый бросающийся в глаза аспект семейства шрифтов Droid. Явно ориентированы на мобильные устройства с их небольшими экранами.
|-
|Gentium Plus ({{Package|media-fonts/sil-gentium}}) || Довольно своеобразные, могут понравиться любителям узких шрифтов. || Только serif, так как с другими шрифтами SIL хинтинг дает сомнительные результаты.
|-
|Ubuntu ({{Package|media-fonts/ubuntu-font-family}}) || Своеобразный шрифт, стиль которого, возможно, понравится не всем. В целом выглядит неплохо, также поддерживает довольно много code points. || Только использующийся по умолчанию sans-serif доработан как следует. Узкий и monospace варианты незакончены. Нет известного шрифта serif, который бы хорошо с ним сочетался.
|-
|URW ({{Package|media-fonts/urw-fonts}}) || Метрика совместима с популярными шрифтами от Adobe (среди прочих?) || По-видимому, требует легкий хинтинг.
|-<!--Keep below open source fonts.-->
|MS TrueType corefonts ({{Package|media-fonts/corefonts}}) || Включает в себя большую часть шрифтов, используемых в документах и на веб. || В настоящее время MS не распространяет эти шрифты, поэтому доступные шрифты являются шрифтами многолетней давности и не отражают их текущее состояние. Разумеется, отсутствуют шрифты, которые были добавлены позже. Требуют полный хинтинг.
|-<!--Always keep this entry at the bottom as the only reason it's included is to warn people against using it!-->
|Unifont ({{Package|media-fonts/unifont}}) || Поддерживает множество code points. || Помимо кошмарного вида, этот шрифт также не удовлетворяет базовым требованиям для того, чтобы считаться гарнитурой (typeface) — это sans-serif или serif? Не используйте этот шрифт.
|}

== Внешние ресурсы ==

* Подробные статьи на Arch Linux wiki по:
** [https://wiki.archlinux.org/index.php/Font_configuration Настройке шрифтов]
** [https://wiki.archlinux.org/index.php/Infinality Infinality]
* [http://freedesktop.org/software/fontconfig/fontconfig-user.html Официальная документация для пользователей {{c|fontconfig}}]
* [[Wikipedia:Hinting|Статья на Wikipedia о хинтинге шрифтов]]

[[Category:Desktop]]
