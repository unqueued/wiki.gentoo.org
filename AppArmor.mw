{{InfoBox stack
|{{InfoBox homepage|http://wiki.apparmor.net|header=true}}
|{{InfoBox wikipedia}}
}}
'''AppArmor''' is a MAC (Mandatory Access Control) system, implemented upon LSM (Linux Security Modules). 

== Installation ==

=== Kernel ===
==== Patches ====
While the Linux kernel already supports AppArmor natively, the userspace utilities depend on a number of patches produced by the AppArmor developers that have not yet been accepted upstream. Depending upon the version of the kernel you are using, the patches are included in the AppArmor tarball, or can be found in version-specific [https://git.kernel.org/cgit/linux/kernel/git/jj/linux-apparmor.git/refs/heads git branches].

These patches do not apply cleanly to {{package|sys-kernel/hardened-sources}} so a [https://github.com/kensington/apparmor-grsec rebased] version for the latest kernel is provided for convenience.

==== Configuration ====
You need to activate the following kernel options:
{{Kernel||<pre>
Security options  --->
    [*] AppArmor support
    (1)   AppArmor boot parameter default value
    [*]   Enable AppArmor 2.4 compatability
          Default security module (AppArmor)  --->
</pre>}}

Note that the ''Enable AppArmor 2.4 compatability'' option will only be available if you are using the kernel patches.

=== Software ===
Install {{Package|sys-apps/apparmor}} and {{Package|sys-apps/apparmor-utils}} from ''sunrise'' [[overlay]].

== Configuration ==

=== GRUB and GRUB2 ===
{{File|/boot/grub/grub.conf|Example GRUB config for apparmor with simple kernel|<pre>
title=Gentoo with apparmor
root (hd0,0)
kernel /vmlinuz root=/dev/sda2 apparmor=1 security=apparmor
</pre>}}

or 

{{File|/etc/default/grub|Adding apparmor to grub 2|<pre>
GRUB_CMDLINE_LINUX_DEFAULT="apparmor=1 security=apparmor"
</pre>}}
You should apply changes running 

{{RootCmd|grub2-mkconfig -o /boot/grub2/grub.cfg}}


(optionally) Adding entry in fstab 
{{File|/etc/fstab|Securityfs entry for fstab|<pre>
 none     /sys/kernel/security securityfs defaults            0      0
</pre>}}

=== Boot service ===
Adding it to boot runlevel:
{{RootCmd|rc-update add apparmor boot}}

== Securing Skype ==
Put provided below as file to {{Path|/etc/apparmor.d/}}. Don't forget modifying it for yourself.

{{File|usr.bin.skype|AppArmor profile for Skype|<pre>
# Apparmor profile for Skype 
#include

/usr/bin/skype {
#include
#include
#include
#include
#include
#include
#include
#include
#include
#include
#include

deny /etc/group m,
deny /etc/passwd r,
deny /proc/sys/kernel/osrelease r,
deny /proc/sys/kernel/ostype r,
deny @{HOME}/.mozilla/ r,
deny @{HOME}/.mozilla/*/ r,
deny @{HOME}/.mozilla/*/*/ r,
deny @{HOME}/.mozilla/*/*/bookmarkbackups/ r,
deny @{HOME}/.mozilla/*/*/chrome/ r,
deny @{HOME}/.mozilla/*/*/extensions/ r,
deny @{HOME}/.mozilla/*/*/prefs.js r,

/dev/ r,
/dev/shm/pulse* mrw,
/dev/video* mrw,
/etc/ssl/certs/ r,
/etc/ssl/certs/** r,
/etc/xdg/Trolltech.conf rk,
/proc/*/cmdline r,
/proc/*/fd/ r,
/proc/*/net/arp r,
/sys/devices/system/cpu/ r,
/sys/devices/system/cpu/** r,
# /usr/bin/pulseaudio px -> usr.bin.skype,
/usr/bin/pulseaudio mrw,
/usr/bin/skype mr,
/usr/lib/pango/*.so mr,
/usr/lib{,32,64}/** mr,
/usr/share/ca-certificates/** mr,
/usr/share/fonts/** mr,
/usr/share/skype/** mrk,
/usr/share/skype/sounds/*.wav rk,
/var/cache/libx11/compose/* r,
owner /{run,dev}/shm/pulse-shm* rwk,
/{run,dev}/shm/pulse-shm* m,
@{HOME}/.Skype/ rw,
@{HOME}/.Skype/** rwk,
@{HOME}/.config/* rk,
@{HOME}/.kde4/share/config/kioslaverc r,
} 
</pre>}}

[[Category:Security]]
