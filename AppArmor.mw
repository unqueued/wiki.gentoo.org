
== Introduction ==

AppArmor is a MAC (Mandatory Access Control) system, implemented upon LSM (Linux Security Modules). 

=== Installing and Setup AppArmor ===

It can be done by installing {{Package| sys-apps/apparmor}} and {{Package| sys-apps/apparmor-utils}} from [sunrise} overlay 

=== Kernel ===
We need readjusting kernel 
{{Kernel||<pre>
     Security options  --->
          [*] AppArmor support
          (1)   AppArmor boot parameter default value
              Default security module (AppArmor)  --->
</pre>}}

=== GRUB and GRUB2 ===

{{File|/boot/grub/grub.conf|Example GRUB config for apparmor with simple kernel|<pre>
title=Gentoo with apparmor
root (hd0,0)
kernel /vmlinuz root=/dev/sda2 apparmor=1 security=apparmor
</pre>}}

or 

{{File|/etc/default/grub|Adding apparmor to grub 2|<pre>
GRUB_CMDLINE_LINUX_DEFAULT="apparmor=1 security=apparmor"
</pre>}}
You should apply changes running 

{{RootCmd|grub2-mkconfig -o /boot/grub2/grub.cfg}}


(optionally) Adding entry in fstab 
{{File|/etc/fstab|Securityfs entry for fstab|<pre>
 none     /sys/kernel/security securityfs defaults            0      0
</pre>}}


Adding it to boot runlevel
{{RootCmd|rc-update add apparmor boot}}

Securing Skype

Put provided below as file to /etc/apparmor.d/

{{File|usr.bin.skype|Apparmor profile for Skype|<pre>
# Apparmor profile for Skype 
#include

/usr/bin/skype {
#include
#include
#include
#include
#include
#include
#include
#include
#include
#include
#include

deny /etc/group m,
deny /etc/passwd r,
deny /proc/sys/kernel/osrelease r,
deny /proc/sys/kernel/ostype r,
deny @{HOME}/.mozilla/ r,
deny @{HOME}/.mozilla/*/ r,
deny @{HOME}/.mozilla/*/*/ r,
deny @{HOME}/.mozilla/*/*/bookmarkbackups/ r,
deny @{HOME}/.mozilla/*/*/chrome/ r,
deny @{HOME}/.mozilla/*/*/extensions/ r,
deny @{HOME}/.mozilla/*/*/prefs.js r,

/dev/ r,
/dev/shm/pulse* mrw,
/dev/video* mrw,
/etc/ssl/certs/ r,
/etc/ssl/certs/** r,
/etc/xdg/Trolltech.conf rk,
/proc/*/cmdline r,
/proc/*/fd/ r,
/proc/*/net/arp r,
/sys/devices/system/cpu/ r,
/sys/devices/system/cpu/** r,
# /usr/bin/pulseaudio px -> usr.bin.skype,
/usr/bin/pulseaudio mrw,
/usr/bin/skype mr,
/usr/lib/pango/*.so mr,
/usr/lib{,32,64}/** mr,
/usr/share/ca-certificates/** mr,
/usr/share/fonts/** mr,
/usr/share/skype/** mrk,
/usr/share/skype/sounds/*.wav rk,
/var/cache/libx11/compose/* r,
owner /{run,dev}/shm/pulse-shm* rwk,
/{run,dev}/shm/pulse-shm* m,
@{HOME}/.Skype/ rw,
@{HOME}/.Skype/** rwk,
@{HOME}/.config/* rk,
@{HOME}/.kde4/share/config/kioslaverc r,

} 
</pre>}}
