{{Lowercase title}}
{{InfoBox stack
|{{InfoBox todo|Instructions for configuring a static IP|header=true}}
}}
To install a desktop environment such as GNOME3 requires the use of systemd but the present [https://www.gentoo.org/doc/en/handbook/ Gentoo Handbook]  is based on the use of Openrc. It just indicates that changes have to be made when using systemd but never tells the user where the changes occur. 
As for the systemd page, it mainly concentrate on an update starting from an existing system. Thus, it can be a kind of challenge, specially for a new comer to Gentoo, to install a GNOME3 desktop from scratch.
The purpose of this page is to indicate where changes have to be made to the current [https://www.gentoo.org/doc/en/handbook/ Gentoo Handbook]  to do so.
The indications given refer mainly to an amd64 install.
== Base System Installation ==
Hereafter are the modifications to bring to the [https://www.gentoo.org/doc/en/handbook/ Gentoo Handbook] for an amd64 platform.
=== Part 1 to 5 of the handbook ===
No change here.

===Installing the Gentoo Base System ===
==== Choosing the right profile ====
{{RootCmd|eselect profile list|output=<pre>
Available profile symlink targets:
  [1]   default/linux/amd64/13.0
  [2]   default/linux/amd64/13.0/selinux
  [3]   default/linux/amd64/13.0/desktop
  [4]   default/linux/amd64/13.0/desktop/gnome
  [5]   default/linux/amd64/13.0/desktop/gnome/systemd 
  [6]   default/linux/amd64/13.0/desktop/kde
  [7]   default/linux/amd64/13.0/desktop/kde/systemd
  [8]   default/linux/amd64/13.0/developer
  [9]   default/linux/amd64/13.0/no-multilib
  [10]  default/linux/amd64/13.0/x32
  [11]  hardened/linux/amd64
  [12]  hardened/linux/amd64/selinux
  [13]  hardened/linux/amd64/no-multilib
  [14]  hardened/linux/amd64/no-multilib/selinux
  [15]  hardened/linux/amd64/x32
  [16]  hardened/linux/uclibc/amd64

</pre>}}
{{RootCmd|eselect profile set 5}}
{{RootCmd|eselect profile list|output=<pre>
Available profile symlink targets:
  [1]   default/linux/amd64/13.0
  [2]   default/linux/amd64/13.0/selinux
  [3]   default/linux/amd64/13.0/desktop
  [4]   default/linux/amd64/13.0/desktop/gnome
  [5]   default/linux/amd64/13.0/desktop/gnome/systemd *
  [6]   default/linux/amd64/13.0/desktop/kde
  [7]   default/linux/amd64/13.0/desktop/kde/systemd
  [8]   default/linux/amd64/13.0/developer
  [9]   default/linux/amd64/13.0/no-multilib
  [10]  default/linux/amd64/13.0/x32
  [11]  hardened/linux/amd64
  [12]  hardened/linux/amd64/selinux
  [13]  hardened/linux/amd64/no-multilib
  [14]  hardened/linux/amd64/no-multilib/selinux
  [15]  hardened/linux/amd64/x32
  [16]  hardened/linux/uclibc/amd64

</pre>}}

===  Configuring the kernel ===
Do not emerge genkernel here but genkernel-next instead.
{{RootCmd|emerge genkernel-next}}

If you plan to include support for your graphic card and in case this graphic card requires proprietary binary blobs, emerge linux-firmware otherwise kernel will not compile.
{{RootCmd|emerge linux-firmware }}

May not be necessary at this stage but doesn't harm, add VIDEO_CARDs="<your card type>" in {{Path|/etc/portage/make.conf}}.

Use option ''menuconfig'' with genkernel
{{RootCmd|genkernel  --menuconfig all}}
Select the systemd init system without disabling Openrc

{{Kernel|Quick setup using gentoo-sources|<pre>
Gentoo Linux --->
        Support for init systems, system and service managers --->
                [*]Openrc 
                [*] systemd
</pre>}}

Include settings for your graphic card referring to the ad hoc page on this wiki, most currently [[radeon]] and [[NVidia/nvidia-drivers]].

Create the symlink for {{Path|/etc/mtab}} (see [[Systemd#/etc/mtab|this]] for details)
{{RootCmd|ln -sf /proc/self/mounts /etc/mtab}}

=== Configuring your system ===
No change.

=== Installing Necessary system Tools ===
==== System Logger ====
syslog-ng conflicts with systemd[https://wiki.gentoo.org/wiki/Systemd#syslog-ng_conflicts_with_systemd] systemd creates {{Path|/dev/log}} as datagram socket [https://bugzilla.redhat.com/show_bug.cgi?id=770810#c10] [https://fedoraproject.org/wiki/Common_F16_bugs#systemd-syslog-ng-problems] so you will need to tell syslog-ng to read from a ''unix-dgram'' instead of a ''unix-stream'' if you are hitting problems and are using "wrong" stream:
{{File|/etc/syslog-ng/syslog-ng.conf||<pre>
unix-stream('/dev/log');
</pre>}}
should be replaced with:
{{File|/etc/syslog-ng/syslog-ng.conf||<pre>
unix-dgram('/dev/log');
</pre>}} in order to use the syslog-ng service in systemd.

==== Networking tools ====
dhcpcd will not be started at boot unless you enable dhcpcd.service with systemd.
Refer to the [[Systemd| systemd]] page to know how to do it before rebooting.
Otherwise you will be able to do so after boot with 
{{RootCmd|systemctl enable dhcpcd.service}}
{{RootCmd|systemctl start dhcpcd.service}}
==== Installing systemd itself ====
In a first stage install dbus with temporary -systemd USE flag:
{{RootCmd|<pre>USE="-systemd" emerge sys-apps/dbus </pre>}}
then emerge systemd
{{RootCmd|emerge sys-apps/systemd}}
{{Note|You don't have to add systemd flag to {{Path|/etc/portage/make.conf}} as it is already set into the chosen profile.}}

=== Configuring the Bootloader ===
After emerging {{Package|sys-boot/grub}}, edit '''{{Path|/etc/default/grub}}'''  and add the following line (if using ext4 for root partition)
{{File|/etc/default/grub|Example grub2-mkconfig config for systemd|<pre>
# Append parameters to the linux kernel command line
GRUB_CMDLINE_LINUX="rootfstype=ext4 real_init=/usr/lib/systemd/systemd"</pre>
}}
Then run:
{{RootCmd|mkdir /boot/grub}}
{{RootCmd|grub2-mkconfig -o /boot/grub/grub.cfg}}

===Finalizing your Gentoo Installation ===
It may be necessary to enable and start dcpcd.service and to use systemd to define keyboard layout (see the systemd page).

== X server Installation ==

=== Install x11-base/xorg-drivers ===


==== /etc/portage/make.conf ====
Don't forget to add the following lines to the {{Path|/etc/portage/make.conf}} file:
{{File|/etc/portage/make.conf||<pre>
VIDEO_CARDS="radeon"
</pre>}}
{{Note|Replace radeon according to your card brand}}

{{File|/etc/portage/make.conf||<pre>
INPUT_DEVICESÂ ="evdev"
</pre>}}

Then emerge the drivers:
{{Emerge|emerge x11-base/xorg-drivers}}

==== Kernel settings ====
Follow the page X server to set the kernel paramaters for evdev and  the kernel parameters for your graphic card if not already done. Recompile the kernel
=== Check startx ===
In order to check the x server install xterm and twm
{{Emerge| xterm twm }}
Then use the following command:
{{RootCmd|startx}}
If everything is correct you should see a graphic page with some terminals inside. Quit with {{Key|Ctrl}}-{{Key|Alt}}-{{Key|Del}} and unmerge xterm and twm.

== Gnome3 Installation ==
You are now ready to install GNOME 3:
{{emerge|gnome}}

{{Note|In my case, to solve a conflict between to versions of openssl one using the ''bindist'' USE flag and the other using the ''-bindist'' use flag, I had to add the ''bindist'' USE flag to Openssh in {{Path|/etc/portage/package.use}} and update the system prior to emerging gnome.}}
In order to have the Gnome Display Manager after boot, enable it:
{{RootCmd| systemctl enable gdm.service}}

Reboot and enjoy Gnome3 !

[[Category:Init systems]]
