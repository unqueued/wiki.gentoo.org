<languages />


{{Metadata|abstract=Este documento cubre la instalación y mantenimiento de impresoras mediante CUPS y Samba. Cubre la instalación local y la instalación en red y también muestra instrucciones acerca de cómo usar impresoras compartidas desde otros sistemas operativos.}}

Este documento cubre la instalación y mantenimiento de impresoras mediante CUPS y Samba. Cubre la instalación local y la instalación en red y también muestra instrucciones acerca de cómo usar impresoras compartidas desde otros sistemas operativos.

== La impresión y Gentoo Linux ==

=== Utilizar las herramientas adecuadas ===

Linux ofrece buen soporte para las impresoras. La herramienta adecuada para este trabajo es CUPS ( [http://www.cups.org Common Unix Printing System] ). Desde el comienzo de este proyecto allá por 1999, la instalación y el mantenimiento de CUPS ha mejorado sustancialmente. 

En este documento mostraremos como usar CUPS para configurar una impresora local o en red. No entraremos en mucho detalle ya que el proyecto dispone de un [http://www.cups.org/documentation.php magnífica documentación] para un uso avanzado. 

== Configurar su núcleo ==

=== Introducción ===

Cuando quiera instalar una impresora en su sistema, necesitará saber cómo se conectará la impresora a su sistema. ¿Lo hace a través de un puerto local como LPT o USB, o está en red?. Y si lo está, ¿Utiliza el protocolo de impresión de Internet (IPP) o a través del protocolo SMB-CIFS de Microsoft Windows (Compartir recursos en Microsoft Windows)? 

La siguientes secciones indican la configuración mínima de núcleo que necesita. Por supuesto, esto depende de cómo va a conectar la impresora a su sistema, por lo que para su comodidad hemos separado las indicaciones.

Por tanto, vaya a {{Path|/usr/src/linux}} y lance <code>make menuconfig</code> para entrar en la configuración del núcleo. Si utilizó <code>genkernel</code> para configurar su núcleo, entonces debería realizar estos pasos para asegurarse de que no ha olvidado nada. 

En los siguientes ejemplos de configuración hemos añadido el soporte necesario ''en'' el núcleo, no como módulos. Esto no es obligatorio. Si así lo desea, puede fácilmente utilizar soporte modular. No olvide cargar los módulos apropiados a continuación. 

Ahora vaya a la sección apropiada para configurar (o comprobar) su núcleo. 

=== Impresora conectada localmente (LPT) ===

El puerto LPT se usa normalmente para identificar el puerto paralelo de la impresora. Es necesario activar previamente el soporte para el puerto paralelo, exactamente "PC-style parallel port support" (a menos que sea usuario de SPARC), después de ésto, habilitaremos el soporte para una impresora a través del puerto paralelo. 

{{Kernel|Configuración para una impresora conectada al puerto paralelo|<pre>
Device Drivers -->
  <*> Parallel port support
  <*> PC-style hardware

Device Drivers -->
  Character Devices -->
    <*> Parallel printer support
     [*] IEEE 1284 transfer modes
</pre>
}}

{{Note/es|Algunos usuarios necesitarán activar otras opciones en la sección <code>Parallel port support</code>. Hay que comprobar la opción de ayuda <code>(Help)</code> en la configuración del núcleo para más información.}}

Eso es todo. Salga de la configuración del núcleo y reconstrúyalo. No hay que olvidar copiar la imagen del núcleo a la localización {{Path|/boot}} (y no olvidar montar {{Path|/boot}} si es necesario) así como actualizar el cargador de arranque antes de reiniciar su sistema. 

Ahora continúe con CUPS.

=== Impresora conectada localmente (USB) ===

Para habilitar la impresión USB, simplemente necesitará el soporte USB en su núcleo: 

{{Kernel|Configuración de una impresora con puerto USB|<pre>
Device Drivers -->
 USB Support -->
  <*> Support for Host-side USB
  (...)
  --- USB Host Controller Drivers
  (Seleccione el HCD que utilice su sistema. Si no sabe cuál seleccionar, lance "lspci -v | grep HCI" desde otro terminal)
  <*> EHCI HCD (USB 2.0) support ( o )
  <*> OHCI HCD support ( o )
  <*> UHCI HCD (most Intel and VIA) support
</pre>
}}

Eso es todo. Salga de la configuración del núcleo y reconstrúyalo. No hay que olvidar copiar la imagen del núcleo a la localización {{Path|/boot}} (y no olvidar montar {{Path|/boot}} si es necesario) así como actualizar el cargador de arranque antes de reiniciar su sistema. 

Ahora continúe con CUPS. 

=== Impresora remota (IPP) ===

Para poder conectar a una impresora remota a través del protocolo de impresión de Internet (Internet Printing Protocol) el núcleo solo
necesita soporte de red. Asumiendo que el núcleo ya lo tiene, continuamos con CUPS. 

=== Impresora remota (SMB-CIFS) ===

Su núcleo debe ofrecer soporte para SMB CIFS: 

{{Kernel|Configuración de impresora SMB-CIFS|<pre>
File systems -->
 Network File Systems -->
  <*> SMB file system support (to mount Windows shares etc.)
  <*> CIFS support (advanced network file system for Samba, Windows and other CIFS compliant servers)
</pre>
}}

Eso es todo. Salga de la configuración del núcleo y reconstrúyalo. No hay que olvidar copiar la imagen del núcleo a la localización {{Path|/boot}} (y no olvidar montar {{Path|/boot}} si es necesario) así como actualizar el cargador de arranque antes de reiniciar su sistema. 

Ahora continúe con CUPS. 

== Instalar y Configurar CUPS ==

=== Instalación ===

Instalar CUPS con Gentoo es muy sencillo. CUPS dispone de algunas características opcionales que le pueden interesar. Para activar o desactivar estas características, usaremos los ajustes USE
asociados a las mismas. 

{| class="wikitable" style="text-align: left;"
|-
! Parámetro USE
! Impacto en CUPS
|-
| X
| Le permite utilizar el menú de escritorio para cargar la
página web de configuración de CUPS con su navegador favorito.
|-
| dbus
| Añade soporte para el bus de mensajes del sistema <code>dbus</code>.
|-
| pam
| Si necesita autenticación para los trabajos de impresión a través de los
Módulos Enchufables de Autenticación (PAM), esto activará soporte PAM para CUPS.
|-
| ssl
| Si quiere autenticación o privacidad remota, necesita soporta para la capa segura de los zócalos (Secure Socket Layer) permitiendo
sesiones de impresión cifradas. El soporte para SSL debe estar disponible en todos los sistemas que participan en su red.
|-
| usb
| Soporte para trabajar con impresoras conectadas a través de USB.
|-
|}

Compruebe los ajustes USE actuales. Si quiere modificar alguno de ellos tan solo para CUPS, añádalos a {{Path|/etc/portage/package.use}}. 

{{RootCmd|emerge -pv cups|output=<pre>
[ebuild N ] net-print/cups-1.7.3 USE="X acl dbus pam ssl threads usb -debug -gnutls -java -kerberos -lprng-compat -python (-selinux) -static-libs -systemd -xinetd -zeroconf" ABI_X86="(64) (-32) (-x32)" LINGUAS="ca es fr it ja pt_BR ru"
PYTHON_SINGLE_TARGET="python2_7"
PYTHON_TARGETS="python2_7" 0 kB
</pre>}}

Si está satisfecho con el resultado, haga que portage instale CUPS. 

{{Emerge|cups}}

Para habilitar el soporte para SAMBA, se necesita instalar {{Package|net-fs/samba}} con soporte para CUPS. Actualice el fichero o directorio {{Path|/etc/portage/package.use}} para habilitar el ajuste USE <code>cups</code>:

{{File|/etc/portage/package.use||
<pre>net-fs/samba cups</pre>
}}

A continuación (re)instale Samba:

{{Emerge|net-fs/samba}}

{{Important/es|Cualquier usuario que necesite imprimir, debería añadirse al grupo <code>lp</code>:

{{RootCmd|gpasswd -a username lp}}

Para poder añadir impresora y poder editarlas a través de la interfaz web de cups, los usuarios deben añadirse al grupo <code>lpadmin</code>: 

{{RootCmd|gpasswd -a username lpadmin}}
}}

Si la impresora es local en nuestro sistema, necesitará cargar CUPS de forma automática en el inicio. Asegúrese de que su impresora está conectada antes de iniciar CUPS. 

{{RootCmd|/etc/init.d/cupsd start
|rc-update add cupsd default}}

=== Configuración ===

La configuración por defecto del servidor CUPS en {{Path|/etc/cups/cupsd.conf}} es suficiente para la mayoría de los usuarios. Sin embargo, algunos usuarios pueden necesitar cambios a la configuraicón de CUPS. 

En las siguientes secciones cubrimos algunos cambios que se necesitan a menudo: 

* Permitimos a otros sistemas que utilicen la impresora conectada a esta estación de trabajo Linux.
* Concedemos acceso a la administración de CUPS desde sistemas remotos.
* Configuramos CUPS para que ofrezca soporte a los controladores PCL de Windows. Esto se recomienda si quiere que los sistemas Windows puedan utilizar una impresora compartida con Samba ya que la mayoría de los controladores Windows son PCL.
* Configuramos este sistema para que utilice una impresora conectada a otro sistema (no a través de un recurso Windows compartido).

=== Acceso a impresoras remotas ===

If you want other systems to use your printer through IPP you need to explicitly grant access to the printer in {{Path|/etc/cups/cupsd.conf}} . If you want to share your printer using SAMBA, this change is not needed. 

Open up {{Path|/etc/cups/cupsd.conf}} in your favorite editor and add in an <code>Allow</code> line for the system(s) that should be able to reach to your printer. In the next example, we grant access to the printer from localhost and from any system whose IP address starts with <code>192.168.0</code> . 

{{File|/etc/cups/cupsd.conf|Permitir acceso remote a la impresora|<pre>
<Location />
  Order allow,deny
  Allow localhost
  Allow from 192.168.0.*
</Location>
</pre>}}

This broadcasts browsing information to the clients on the network. This is so that they know the printer is available:

{{File|/etc/cups/cupsd.conf|Información de difusión|<pre>
BrowseAddress 192.168.0.*:631
</pre>
}}

Also, you will need to specify which port CUPS listens to, so that it will respond to printing requests from other machines on your network. 

{{File|/etc/cups/cupsd.conf|Configuración del puerto|<pre>
Listen *:631
#Listen localhost:631
</pre>
}}

{{Note|If you are still using CUPS 1.1 (which is now deprecated), then you will need to use a different syntax for remote printing requests:
{{Code|Deprecated CUPS 1.1 configuration|<pre>
Port 631
(Make sure the next two lines are commented out)
#Listen 127.0.0.1:631
#Listen localhost:631
</pre>
}}
}}

=== CUPS Remote Administration ===

If you are interested in remote administration, you need to grant access from other systems than just localhost to the CUPS administration. Edit {{Path|/etc/cups/cupsd.conf}} and have it explicitly grant access to the systems you want. For instance, to grant access to the system with IP address of 192.168.0.3: 

{{File|/etc/cups/cupsd.conf|Permitir acceso remoto|<pre>
<Location /admin>
(...)
  Encryption Required
  Order allow,deny
  Allow localhost
  Allow 192.168.0.3
</Location>
</pre>
}}

Do not forget to restart CUPS after making changes to {{Path|/etc/cups/cupsd.conf}} by running <code>/etc/init.d/cupsd restart</code> . 

=== Enable Support for Windows PCL Drivers ===

PCL drivers send raw data to the print server. To enable raw printing on CUPS, you need to edit {{Path|/usr/share/cups/mime/mime.types}} and uncomment the line <code>application/octet-stream</code> if it is not already uncommented. Then you need to edit {{Path|/usr/share/cups/mime/mime.convs}} and do the same, if it is not already uncommented. 

{{File|/usr/share/cups/mime/mime.types|Habilitar el soporte para impresión en crudo|<pre>
application/octet-stream
</pre>}}

{{File|/usr/share/cups/mime/mime.convs||<pre>
application/octet-stream application/vnd.cups-raw 0 -
</pre>
}}

Do not forget to restart CUPS after making these changes by running <code>/etc/init.d/cupsd restart</code> . 

=== Setting Up a Remote Printer ===

If the printers are attached to a remote CUPS-powered server you can easily set up your system to use the remote printer by changing the {{Path|/etc/cups/client.conf}} file. 

Assuming the printer is attached to a system called <code>printserver.mydomain</code> , open up {{Path|/etc/cups/client.conf}} with your favorite editor and set the <code>ServerName</code> directive: 

{{File|/etc/cups/client.conf||<pre>
# (Sustituya servidorimpresion.midominio por el nombre de su servidor de impresión)
ServerName servidorimpresion.midominio
</pre>
}}

The remote system will have a default printer setting which you will be using. If you want to change the default printer, use <code>lpoptions</code> : 

En primer lugar, liste las impresoras disponibles:

{{RootCmd|lpstat -a|output=<pre>
hpljet5p accepting requests since Jan 01 00:00
hpdjet510 accepting requests since Jan 01 00:00
</pre>}}

Set the HP LaserJet 5P as the default printer:

{{RootCmd|lpoptions -d hpljet5p}}


== Configuring a Printer ==

=== Introduction ===

If the printer you want to configure is remotely available through a different print server (running CUPS) you do not need to follow these instructions. Instead, read [[#Setting_Up_a_Remote_Printer]] . 

=== Detecting the Printer ===

If you have a USB printer or your parallel port printer was powered on when you booted your Linux system, you might be able to retrieve information from the kernel stating that it has successfully detected your printer. However this is merely an indication and not a requirement. 

{{Cmd|dmesg {{!}} grep -i print|output=<pre>
parport0: Printer, Hewlett-Packard HP LaserJet 2100 Series
</pre>}}

Para una impresora USB:

{{Cmd|lsusb|output=<pre>
(...)
Bus 001 Device 007: ID 03f0:1004 Hewlett-Packard DeskJet 970c/970cse
</pre>
}}

=== Installing the Printer ===

To have the printer installed on your system, fire up your browser and have it point to [http://localhost:631 http://localhost:631] . You will be greeted by the CUPS web interface from which you can perform all administrative tasks. 


{{Note|If you use an HTTPS connection to CUPS, the first time you access the interface it ''may'' take a very long time before the site comes up. This is because the first request triggers the generation of the CUPS SSL certificates which can be a very time-consuming job.}}

Go to ''Administration'' and enter your root login and password information at the box. Then, when you have reached the administrative interface, click on ''Add Printer'' . You will be greeted by a new screen allowing you to enter the following information: 

* The ''spooler name'' , a short but descriptive name used on your system to identify the printer. This name should not contain spaces or any special characters. For instance, for the HP LaserJet 5P you could say <code>hpljet5p</code> .
* The ''location'' , a description where the printer is physically located (for instance in your room, or in the kitchen right next to your dish washer, ...). This is to help maintaining several printers.
* The ''description'' in which you should place a full description of the printer. A common use is the full printer name (like "HP LaserJet 5P").

The next screen asks you for the device where the printer listens to. You will have the choice of several devices. The next table covers a few possible devices, but the list is not exhaustive. 

{| class="wikitable" style="text-align: left;"
|-
! Dispositivo
! Descripción
|-
| AppSocket/HP JetDirect
| Este dispositivo especial permite acceder a impresoras en red a través de un zócalo HP JetDirect. Solo las impresoras específicas ofrecen este soporte.
|-
| Internet Printing Protocol (IPP o HTTP)
| Utilice esta opción para acceder a su imprsora remota a través del protocolo IPP
bien directamente (IPP) o a través de HTTP.
|-
| Equipo o impresora LPD/LPR
| Seleccione ésta opción si la impresora es remota y está conectada a un servidor LPD/LPR.
|-
| Puerto paralelo #1
| Seleccione esta opción cuando la impresora es local y está conectada a su puerto
paralelo (LPT). Cuando la impresora se detecta automáticamente su nombre se añade también al dispositivo
|-
| Impresora USB #1
| Seleccione esta opción cuando la impresora es local y está conectada a un puerto USB.
Se debería añadir el nombre de la impresora al nombre del dispositivo de forma automática. 
|-
|}

If you are installing a remote printer, you will be asked for the URI to the printer: 

* An LPD printer server requires a <code>lpd://hostname/queue</code> syntax
* An HP JetDirect printer requires a <code>socket://hostname</code> syntax
* An IPP printer requires a <code>ipp://hostname/printers/printername</code> or <code>http://hostname:631/printers/printername</code> syntax.

Next, select the printer manufacturer in the adjoining screen and the model type and number in the subsequent one. For many printers you will find multiple drivers. You can either select one now or search on [http://www.linuxprinting.org/printer_list.cgi LinuxPrinting.org's Printer List] for a good driver. You can change drivers easily later on. 

Once the driver is selected, CUPS will inform you that the printer has been added successfully to the system. You can now go to the printer management page on the administration interface and select <code>Configure Printer</code> to change the printer settings (resolution, page format, ...). 

=== Testing and Reconfiguring the Printer ===

To verify if the printer is working correctly, go to the printer administration page, select your printer and click on <code>Print Test Page</code> . 

If the printer does not seem to work correctly, click on <code>Modify Printer</code> to reconfigure the printer. You will be greeted with the same screens as during the first installation but the defaults will now be your current configuration. 

If you have no idea why your printer does not function, you might get a clue by looking at {{Path|/var/log/cups/error_log}} . In the next example we find out that there is a permission error, probably due to a wrong <code>Allow</code> setting in {{Path|/etc/cups/cupsd.conf}} . 

{{RootCmd|tail /var/log/cups/error_log|output=<pre>
(...)
E [11/Jun/2005:10:23:28 +0200] [Job 102] Unable to get printer status (client-error-forbidden)!
</pre>
}}

=== Installing the Best Driver ===

Many printer drivers exist; to find out which one has the best performance for your printer, visit the [http://www.linuxprinting.org/printer_list.cgi LinuxPrinting Printer List] . Select your brand and type to find out what driver the site recommends. For instance, for the HP LaserJet 5P, the site recommends the <code>ljet4</code> driver. 

Download the PPD file from the site and place it in {{Path|/usr/share/cups/model}} , then run <code>/etc/init.d/cupsd restart</code> as root. This will make the driver available through the CUPS web interface. Now reconfigure your printer as described above.

== Using Special Printer Drivers ==

=== Introduction ===

Some printers require specific drivers or provide additional features that are not enabled through the regular configuration process as described above. This chapter will discuss a selection of printers and how they are made to work with Gentoo Linux. 

=== Gutenprint Driver ===

The [http://gutenprint.sourceforge.net gutenprint] drivers are high-quality, open source printer drivers for various Canon, Epson, HP, Lexmark, Sony, Olympus and PCL printers supporting CUPS, ghostscript, The Gimp and other applications. 

Gentoo's Portage Tree contains an ebuild for the gutenprint drivers. Just use <code>emerge</code> to install them. Note that the ebuild listens to quite a few USE flags (such as <code>cups</code> and <code>ppds</code> ). You must have enabled at least these two flags! 

{{Emerge|gutenprint}}

When the emerge process has finished, the gutenprint drivers will be available through the CUPS web interface. 

=== Controlador HPLIP ===

Lea el artículo sobre el [[HPLIP|Controlador HPLIP]]

=== PNM2PPA Driver ===

PPA is an HP technology that focuses on sending low-level processing to the system instead of to the printer which makes the printer cheaper but more resource consuming. 

If the [http://www.linuxprinting.org/printer_list.cgi LinuxPrinting] site informs you that the [http://pnm2ppa.sourceforge.net/ pnm2ppa] driver is your best option, you need to install the <code>pnm2ppa</code> filter on your system: 

{{Emerge|pnm2ppa}}

Once installed, download the PPD file for your printer from the [http://www.linuxprinting.org/printer_list.cgi LinuxPrinting] site and put it in {{Path|/usr/share/cups/model}} . Next, configure your printer using the steps explained above. 

== Printing From and To Microsoft Windows ==

{{Note|You should read our [[Samba/HOWTO|Samba/CUPS Guide]] for more detailed information on setting up CUPS with Samba.}}

=== Configuring a Windows Client for IPP ===

Microsoft Windows supports IPP (Windows 9x and ME users need to [http://support.microsoft.com/default.aspx?scid=kb;en-us;294439 install] it separately). To install a printer that is attached to your Linux box on Windows, fire up the <code>Add Printer</code> wizard and select <code>Network Printer</code> . When you are asked for the URI, use the <code>http://hostname:631/printers/queue</code> syntax. 

=== Configuring a Windows Client for a Samba Shared Printer ===

To share the printer on the SMB-CIFS network, you must have SAMBA installed and configured correctly. How to do this is beyond the scope of this document, but we will quickly deal with the configuration of SAMBA for shared printers. 

Open {{Path|/etc/samba/smb.conf}} with your favorite editor and add a <code>[printers]</code> section to it: 

{{Code|Añadir una sección [printers]|<pre>
[printers]
  comment = All printers
  path = /var/spool/samba
  browseable = no
  guest ok = no
  writable = no
  printable = yes
  public = yes
  printer name = hpljet5p
</pre>
}}

Now navigate to the top of the {{Path|smb.conf}} file until you are inside the <code>[global]</code> section. Then locate the <code>printcap name</code> and <code>printing</code> settings and set each of them to <code>cups</code> : 

{{Code|Cambiar al sección [global]|<pre>
[global]
  (...)
  printcap name = cups
  printing = cups
</pre>
}}

Make sure you enabled the [[#Enable_Support_for_Windows_PCL_Drivers|windows pcl]] support in CUPS. Then, restart the <code>smb</code> service to have the changes take effect.

=== Configuring a Linux Client for a Windows Print Server ===

First of all, make sure that the printer is shared on your Windows system and that you have emerged <code>samba</code> with the <code>cups</code> USE-flag enabled as instructed above.

To find the desired printer's URI, run the following command, substituting "server" with the computer that you want to probe for samba-shared printers:

{{Cmd|smbclient -N '\\server\'}}

Next, in the CUPS web interface, configure your printer as described previously. You will notice that CUPS has added another driver called <code>Windows Printer via SAMBA</code> . Select it and use the <code>smb://username:password@workgroup/server/printername</code> or <code>smb://server/printername</code> syntax for the URI.

{{Important|Any special characters in the above URI need to be appropriately quoted. For example:
<code>smb://BEN-DESKTOP/HP Color LaserJet CP1510 series PCL6</code>
  
becomes:
  
<code>smb://BEN-DESKTOP/HP%20Color%20LaserJet%20CP1510%20series%20PCL6</code>
  
  
You can get this result string by running the following command:
{{Cmd|python2 -c 'import urllib; print "smb://" + urllib.quote("BEN-DESKTOP/HP Color LaserJet CP1510 series PCL6")'}}
}}

== Printing-related Applications ==

=== Introduction ===

Many tools exist that help you configure a printer, use additional printing filters, add features to your printing capabilities, etc. This chapter lists a few of them. The list is not exhaustive and not meant to discuss each tool in great detail. 

=== Gtk-LP - A Gtk-powered Printer Configuration Tool ===

With [http://gtklp.sourceforge.net/index.shtml Gtk-LP] you can install, modify and configure your printer from a stand-alone Gtk application. It uses CUPS and provides all standard CUPS capabilities as well. Definitely worth checking out if you dislike the CUPS Web interface or want a stand-alone application for your day-to-day printing routines. 

Para instalarlo, haga emerge de <code>gtklp</code> : 

{{Emerge|gtklp}}

== Resolución de problemas ==

=== Error: Unable to convert file 0 to printable format ===

Si tiene problemas al imprimir y se muestra el siguiente mensaje en {{Path|/var/log/cups/error_log}}: 

{{Code|Error log|<pre>
Unable to convert file 0 to printable format
</pre>
}}

Necesitará volver a hacer emerge de  <code>ghostscript-gpl</code> con el ajuste USE <code>cups</code>. Puede, bien añadir <code>cups</code> a sus ajustes USE en {{Path|/etc/portage/make.conf}} o puede habilitarlos solo para <code>ghostscript-gpl</code> como se muestra a continuación: 

{{RootCmd|echo "app-text/ghostscript-gpl cups" >> /etc/portage/package.use}}

A continuación haga emerge de <code>ghostscript-gpl</code>. Cuando haya terminado la compilación, asegúrese de reiniciar <code>cupsd</code> a continuación: 

{{RootCmd|/etc/init.d/cupsd restart}}

== Agradecimientos ==

Nos gustarían dar las gracias a los siguientes autores y editores por sus contribuciones a esta guía:


* swift
* nightmorph
