<languages />


{{Metadata|abstract=Este documento cubre la instalación y mantenimiento de impresoras mediante CUPS y Samba. Cubre la instalación local y la instalación en red y contiene instrucciones acerca de cómo usar impresoras compartidas desde otros sistemas operativos.}}

Este documento cubre la instalación y mantenimiento de impresoras mediante CUPS y Samba. Cubre la instalación local y la instalación en red y contiene instrucciones acerca de cómo usar impresoras compartidas desde otros sistemas operativos.

== La impresión y Gentoo Linux ==

=== Utilizar las herramientas adecuadas ===

Linux ofrece buen soporte para las impresoras. La herramienta adecuada para este trabajo es CUPS ([http://www.cups.org Common Unix Printing System]). Desde el comienzo de este proyecto allá por 1999, la instalación y el mantenimiento de CUPS ha mejorado sustancialmente. 

En este documento mostraremos como usar CUPS para configurar una impresora local o en red. No se entrará en mucho detalle ya que el proyecto dispone de un [http://www.cups.org/documentation.php magnífica documentación] para un uso avanzado. 

== Configurar su núcleo ==

=== Introducción ===

Cuando un usuario quiere instalar una impresora en un sistema, el primer paso es saber cómo se conecta la impresora al sistema. ¿Lo hace a través de un puerto local como LPT o USB, o está en red?. En este último caso, ¿Utiliza el protocolo de impresión de Internet (IPP) o el protocolo CIFS de Microsoft Windows (Compartir recursos en Microsoft Windows)? 

La siguientes secciones indican la configuración mínima de núcleo que se necesita para conectar una impresora en Gentoo. Por supuesto, esto depende de ''cómo'' se va a conectar la impresora al sistema, por lo que para mayor comodidad se han separado las indicaciones.

Vaya a {{Path|/usr/src/linux}} y lance <kbd>make menuconfig</kbd> para entrar en la configuración del núcleo. Si se ha utilizado <kbd>genkernel</kbd> para configurar el núcleo, entonces se deberían realizar estos pasos para asegurarse de que se no ha olvidado nada. No se puede confiar únicamente en <code>genkernel</code> para configurar todo dentro del sistema de forma automática. La impresión es un área en la que es complicado ajustar todo de forma automática.

En los siguientes ejemplos de configuración se ha añadido el soporte necesario ''en'' el núcleo, no como módulos. No es obligatorio construir el núcleo de esta forma. Si se desea soporte modular, simplemente ¡No olvide que después se deben cargar los módulos apropiados!. 

Ahora vaya a la sección apropiada para configurar (o comprobar) el núcleo.

=== Impresora conectada localmente (LPT) ===

El puerto LPT se usa normalmente para identificar el puerto paralelo de la impresora. Es necesario activar previamente el soporte para el puerto paralelo, exactamente "PC-style parallel port support" (a menos que se esté utilizan un sistema SPARC), después de ésto, habilitaremos el soporte para una impresora a través del puerto paralelo. 

{{KernelBox|title=Configuración para una impresora conectada al puerto paralelo|<pre>
Device Drivers -->
  <*> Parallel port support
  <*> PC-style hardware
     [*] IEEE 1284 transfer modes
  Character Devices -->
    <*> Parallel printer support
</pre>
}}

{{Note/es|Algunos usuarios podrían  activar otras opciones en la sección <code>Parallel port support</code>. Hay que comprobar la opción de ayuda <code>(Help)</code> en la configuración del núcleo para más información.}}

Eso es todo. Salga de la configuración del núcleo y reconstrúyalo con la siguiente orden:

{{RootCmd|make && make modules_install}}

No olvide copiar la nueva imagen compilada del núcleo a la localización {{Path|/boot}}. Si es necesario, se debe montar {{Path|/boot}}, así como actualizar la configuración del cargador de arranque antes de reiniciar su sistema. Por ejemplo, si utiliza GRUB2 estos pasos se pueden realizar lanzando las siguientes órdenes:

{{RootCmd|mount /boot}}
{{RootCmd|make install}}
{{RootCmd|grub2-mkconfig -o /boot/grub.grub.cfg}}

Ahora continúe con CUPS.

=== Impresora conectada localmente (USB) ===

Para imprimir a través de USB, el soporte para USB debe estar habilitado en el núcleo: 

{{KernelBox|title=Configuración de una impresora con puerto USB|<pre>
Device Drivers -->
 USB Support -->
  <*> Support for Host-side USB
  (...)
  --- USB Host Controller Drivers
  (Seleccione el HCD que utilice su sistema. Si no sabe cuál seleccionar, lance "lspci -v | grep HCI" desde otro terminal)
  <*> EHCI HCD (USB 2.0) support ( o )
  <*> OHCI HCD support ( o )
  <*> UHCI HCD (most Intel and VIA) support
</pre>
}}

Exit the kernel configuration and rebuild the kernel. Do not forget to copy the new kernel image to the {{Path|/boot}} location (if necessary mount the {{Path|/boot}} partition before copying the kernel) and update the boot loader configuration prior to rebooting the system. Note the root commands listed in the '''LPT Printer Configuration''' step above for how to perform these steps.

Ahora continúe con CUPS.

=== Impresora remota (IPP) ===

To be able to connect to a remotely attached printer through the Internet Printing Protocol the kernel needs to have networking support. Assuming the kernel has that already, continue with CUPS. 

=== Impresora conectada en remoto (CIFS) ===

El núcleo debe ofrecer soporte para CIFS: 

{{KernelBox|title=Configuración de impresora CIFS|<pre>
File systems -->
 Network File Systems -->
   <*> CIFS support (advanced network filesystem, SMBFS successor)  
</pre>
}}

After configuration for CIPS is complete, exit the kernel configuration and rebuild the kernel. Do not forget to copy the new kernel image to the {{Path|/boot}} location (and don't forget to mount {{Path|/boot}} if needed) and update the boot loader configuration prior to rebooting the system. Note the root commands in the '''LPT Printer Configuration''' step above for how to perform these steps.

Ahora continúe con CUPS.

== Instalar y Configurar CUPS ==

=== Instalación ===

Installing CUPS with Gentoo is a breeze. CUPS has a few optional features that might be of interest. To enable or disable those features, use the '''USE''' flags associated with them.

{{USEflag|package=net-print/cups
|X+++Allows the user to use a desktop menu to load the CUPS configuration webpage into a preferred browser.
|dbus+++Adds support for the <code>dbus</code> system message bus.
|pam+++If print job authentication through the Pluggable Authentication Modules is needed, this will activate PAM support for CUPS.
|ssl+++If remote authentication and/or privacy is required support for the Secure Socket Layer must be enabled which will allow for encrypted printing sessions. Support for SSL must be available on all participating systems on the network.
|usb+++Support for working with printers connected via USB.
}}

Check the current '''USE''' flag settings. To deviate from the current USE settings for CUPS alone, add the appropriate USE flags to {{Path|/etc/portage/package.use}} file. 

{{RootCmd|emerge -pv cups|output=<pre>
[ebuild N ] net-print/cups-1.7.3 USE="X acl dbus pam ssl threads usb -debug -gnutls -java -kerberos -lprng-compat -python (-selinux) -static-libs -systemd -xinetd -zeroconf" ABI_X86="(64) (-32) (-x32)" LINGUAS="ca es fr it ja pt_BR ru"
PYTHON_SINGLE_TARGET="python2_7"
PYTHON_TARGETS="python2_7" 0 kB
</pre>}}

When happy with the result, have Portage install CUPS. 

{{Emerge|cups}}

To enable SAMBA support, {{Package|net-fs/samba}} needs to be installed with CUPS support. Update the {{Path|/etc/portage/package.use}} file or directory to enable the <code>cups</code> '''USE''' flag:

{{FileBox|filename=/etc/portage/package.use|title=Habilitar el ajuste USE cups para samba|1=<pre>
net-fs/samba cups
</pre>
}}

A continuación (re)instale Samba:

{{Emerge|net-fs/samba}}

{{Important/es|Cualquier usuario que necesite imprimir, debería añadirse al grupo <code>lp</code>:

{{RootCmd|gpasswd -a username lp}}

Para poder añadir impresora y poder editarlas a través de la interfaz web de CUPS, los usuarios deben añadirse al grupo <code>lpadmin</code>: 

{{RootCmd|gpasswd -a username lpadmin}}
}}

If the printer is attached to the system locally, and the printer needs to be available every boot, the CUPS daemon will need to load automatically on start-up. Make sure the printer is attached and powered on before the CUPS daemon is started. 

{{RootCmd|/etc/init.d/cupsd start
|rc-update add cupsd default}}

=== Configuración ===

The default CUPS server configuration located in {{Path|/etc/cups/cupsd.conf}} is sufficient for most users. However, some users might need to make changes to the CUPS configuration.

En las siguientes secciones se cubren algunos cambios que se necesitan a menudo: 

* Allow other systems to use the printer attached to this Linux workstation.
* Grant access to the CUPS administration from remote systems.
* Configure CUPS to support Windows PCL drivers. This is advised for Windows systems to be able to use a SAMBA-shared printer since most Windows drivers are PCL drivers.
* Configure this system to use a printer attached to another system (not Windows share).

=== Acceso a impresoras remotas ===

For other systems to use the printer through IPP, explicit access to the printer must be granted in the {{Path|/etc/cups/cupsd.conf}} file. To share the printer using SAMBA, this change is not needed. 

Open up {{Path|/etc/cups/cupsd.conf}} in a favorite text editor and add in an <code>Allow</code> line for the system(s) that should be able to reach to the printer. In the next example, access is granted to the printer from localhost and from any system whose IP address starts with <code>192.168.0</code>. 

{{FileBox|filename=/etc/cups/cupsd.conf|title=Permitir acceso remote a la impresora|1=<pre>
<Location />
  Order allow,deny
  Allow localhost
  Allow from 192.168.0.*
</Location>
</pre>}}

This line broadcasts browsing information to the clients on the network; it will let network users know when the printer is available:

{{FileBox|filename=/etc/cups/cupsd.conf|title=Broadcast info|1=<pre>
BrowseAddress 192.168.0.*:631
</pre>
}}

The port CUPS listens to will also need to be specified so that it will respond to printing requests from other machines on the network:

{{FileBox|filename=/etc/cups/cupsd.conf|title=Configuración del puerto|1=<pre>
Listen *:631
#Listen localhost:631
</pre>
}}

{{Note|If using CUPS 1.1 (which is now deprecated), a different syntax is required for remote printing requests:
{{CodeBox|title=Deprecated CUPS 1.1 configuration|<pre>
Port 631
(Make sure the next two lines are commented out)
#Listen 127.0.0.1:631
#Listen localhost:631
</pre>
}}
}}

=== Administración remota de CUPS ===

If remote administration is needed, then access to the CUPS administration will need to be granted from more systems than the localhost. Edit the {{Path|/etc/cups/cupsd.conf}} file and have explicit access granted to each system that requires access. For instance, to grant access to a system with an IP address of 192.168.0.3: 

{{FileBox|filename=/etc/cups/cupsd.conf|title=Allowing remote access|1=pre>
<Location /admin>
(...)
  Encryption Required
  Order allow,deny
  Allow localhost
  Allow 192.168.0.3
</Location>
</pre>
}}

Do not forget to restart the CUPS daemon after making changes to {{Path|/etc/cups/cupsd.conf}} by issuing the <kbd>/etc/init.d/cupsd restart</kbd> command. 

=== Habilitar soporte para los controladores PCL de Windows ===

PCL drivers send raw data to the print server. To enable raw printing on CUPS, edit {{Path|/usr/share/cups/mime/mime.types}} and uncomment the <code>application/octet-stream</code> line if it is not already uncommented. Then edit {{Path|/usr/share/cups/mime/mime.convs}} and do the same, if it is not already uncommented. 

{{FileBox|filename=/usr/share/cups/mime/mime.types|title=Enable support for raw printing|1=<pre>
application/octet-stream
</pre>}}

{{FileBox|filename=/usr/share/cups/mime/mime.convs|1=<pre>
application/octet-stream application/vnd.cups-raw 0 -
</pre>
}}

No olvide reiniciar el demonio de CUPS después de aplicar estos cambios. Para ello, lance <kbd>/etc/init.d/cupsd restart</kbd>. 

=== Configurar una impresora remota ===

If the printers are attached to a remote CUPS-powered server the system can be easily configured to use the remote printer by modifying the {{Path|/etc/cups/client.conf}} file. 

Assuming the printer is attached to a system called <code>printserver.mydomain</code>, open up {{Path|/etc/cups/client.conf}} with a favorite text editor and set the <code>ServerName</code> directive: 

{{FileBox|filename=/etc/cups/client.conf|1=<pre>
# (Sustituya servidorimpresion.midominio por el nombre de su servidor de impresión)
ServerName servidorimpresion.midominio
</pre>
}}

The remote system will have a default printer setting which will be used. To change the default printer, use the <kbd>lpoptions</kbd> command.

En primer lugar, liste las impresoras disponibles:

{{RootCmd|lpstat -a|output=<pre>
hpljet5p accepting requests since Jan 01 00:00
hpdjet510 accepting requests since Jan 01 00:00
</pre>}}

Defina la impresora HP LaserJet 5P como impresora por defecto:

{{RootCmd|lpoptions -d hpljet5p}}

== Configurar una impresora ==

=== Introducción ===

If the printer to be configured is remotely available through a different print server (running CUPS) then the following instructions are not needed. Instead, read [[#Setting_Up_a_Remote_Printer|Setting Up a Remote Printer]]. 

=== Detectar la impresora ===

If a USB printer or parallel port printer was powered on when the Linux system booted, it might be possible to retrieve information from the kernel stating successful detection of the printer. This is merely an indication of print detection and not a requirement. 

{{Cmd|dmesg {{!}} grep -i print|output=<pre>
parport0: Printer, Hewlett-Packard HP LaserJet 2100 Series
</pre>}}

Para una impresora USB:

{{Cmd|lsusb|output=<pre>
(...)
Bus 001 Device 007: ID 03f0:1004 Hewlett-Packard DeskJet 970c/970cse
</pre>
}}

=== Instalar la impresora ===

To have the printer installed on the system, fire up a browser and point it to [http://localhost:631 http://localhost:631]. The CUPS web interface should be displayed from which all administrative tasks can be performed. 


{{Note|If an HTTPS connection to CUPS is used the first time the interface is accessed it ''may'' take a very long time before the page appears. This is because the first request triggers the generation of CUPS SSL certificates which can be a time-consuming job.}}

Go to {{Path|Administration}} and enter the root login and password information of the box. Then, when the administrative interface has been reached, click on {{Path|Add Printer}}. A new screen will be displayed allowing the following information to be entered: 

* The ''spooler name'', a short but descriptive name used on the system to identify the printer. This name should not contain spaces or any special characters. For instance, for the HP LaserJet 5P could be titled <code>hpljet5p</code>.
* The ''location'', a description where the printer is physically located (for instance "bedroom", or "in the kitchen right next to the dish washer", etc.). This is to aid in maintaining several printers.
* The ''description'' should contain a full description of the printer. A common use is the full printer name (like "HP LaserJet 5P").

The next screen requests the device the printer listens to. The choice of several devices will be presented. The next table covers a few possible devices, but the list is not exhaustive.

{| class="wikitable" style="text-align: left;"
|-
! Dispositivo
! Descripción
|-
| AppSocket/HP JetDirect
| Este dispositivo especial permite acceder a impresoras en red a través de un zócalo HP JetDirect. Solo las impresoras específicas incluyen soporte para esta opción.
|-
| Internet Printing Protocol (IPP o HTTP)
| Utilizar esta opción para acceder a la imprsora remota a través del protocolo IPP bien directamente (IPP) o a través de HTTP.
|-
| Equipo o impresora LPD/LPR
| Seleccione ésta opción si la impresora es remota y está conectada a un servidor LPD/LPR.
|-
| Puerto paralelo #1
| Seleccionada cuando la impresora es local y está conectada a un puerto paralelo (LPT). Cuando la impresora se detecta automáticamente su nombre se añade al dispositivo.
|-
| Impresora USB #1
| Seleccionada cuando la impresora es local y está conectada a un puerto USB. Se debería añadir el nombre de la impresora al nombre del dispositivo de forma automática. 
|-
|}

Si se está instalando una impresora remota, se le pedirá la URL de la impresora: 

* An LPD printer server requires a <code>lpd://hostname/queue</code> syntax.
* An HP JetDirect printer requires a <code>socket://hostname</code> syntax.
* An IPP printer requires a <code>ipp://hostname/printers/printername</code> or <code><nowiki>http://hostname:631/printers/printername</nowiki></code> syntax.

Next, select the printer manufacturer in the adjoining screen along with the model type and number in the subsequent screen. For many printers multiple drivers will be available. Select one now or search on [http://www.openprinting.org/printer_list.cgi OpenPrinting Printer List] for a good driver. Drivers are easily able to be changed later. 

Once the driver is selected, CUPS will inform that the printer has been added successfully to the system. Navigate to the printer management page on the administration interface and select {{Path|Configure Printer}} to change the printer's settings (resolution, page format, ...).

=== Probar y reconfigurar la impresora ===

To verify if the printer is working correctly, go to the printer administration page, select the printer and click on {{Path|Print Test Page}}. 

If the printer does not seem to work correctly, click on {{Path|Modify Printer}} to reconfigure the printer. The same screens as during the first installation will appear but the defaults will now be the current configuration. 

If the printer does not function, clues may be found by looking at the CUPS error log located at {{Path|/var/log/cups/error_log}} In the next example a permission error is discovered, probably due to a wrong {{Path|Allow}} setting in the {{Path|/etc/cups/cupsd.conf}} file.

{{RootCmd|tail /var/log/cups/error_log|output=<pre>
(...)
E [11/Jun/2005:10:23:28 +0200] [Job 102] Unable to get printer status (client-error-forbidden)!
</pre>
}}

=== Instalar el mejor controlador ===

Many printer drivers exist; to find out which one has the best performance the job, visit the [http://www.openprinting.org/printer_list.cgi OpenPrinting Printer List]. Select the brand and type/model of the printer to find out what driver the site recommends. For instance, for the HP LaserJet 5P, the site recommends the <code>ljet4</code> driver. 

Download the PPD file from the site and place it in {{Path|/usr/share/cups/model}} then run <kbd>/etc/init.d/cupsd restart</kbd> as root. This will make the driver available through the CUPS web interface. Now reconfigure the printer as described above.

== Usar controladores especiales de la impresora ==

=== Introducción ===

Some printers require specific drivers or provide additional features that are not enabled through the regular configuration process (described above). This chapter will discuss a selection of printers and how they are made to work with Gentoo Linux. 

=== Controlador Gutenprint ===

The [http://gutenprint.sourceforge.net gutenprint] drivers are high-quality, open source printer drivers for various Canon, Epson, HP, Lexmark, Sony, Olympus and PCL printers supporting CUPS. They also support ghostscript, The Gimp, and other applications. 

Gentoo's Portage tree contains an ebuild for the gutenprint drivers. Run <kbd>emerge gutenprint</kbd> to install them. Note the ebuild requests to quite a few '''USE''' flags. At minimum <code>cups</code> and <code>ppds</code> must enabled for gutenprint drivers to work properly.

{{Emerge|gutenprint}}

Cuando el proceso de emerge haya finalizado, los controladores gutenprint estarán disponibles a través de la interfaz web de CUPS.

=== Controlador HPLIP ===

Lea el artículo sobre el [[HPLIP|Controlador HPLIP]]

=== Controlador PNM2PPA ===

PPA is an HP technology that focuses on sending low-level processing to the system instead of the printer which makes the printer cheaper but more resource consuming. 

If the [http://www.openprinting.org/printer_list.cgi OpenPrinting] site informs the [http://pnm2ppa.sourceforge.net/ pnm2ppa] driver is the best option, then the <code>pnm2ppa</code> filter will need to be installed on the system: 

{{Emerge|pnm2ppa}}

Once installed, download the PPD file for the printer [http://www.openprinting.org/printer_list.cgi OpenPrinting] and put it in the {{Path|/usr/share/cups/model}} folder. Then configure the printer using the steps explained above.

== Imprimir desde y hacia Microsoft Windows ==

{{Note|You should read the [[Samba/HOWTO|Samba/CUPS Guide]] for more detailed information on setting up CUPS with Samba.}}

=== Configurar un cliente Windows para IPP ===

Microsoft Windows supports IPP (Windows 9x and ME users need to [http://support.microsoft.com/default.aspx?scid=kb;en-us;294439 install] it separately). To install a printer on Windows that is attached to a Linux box, fire up the {{Path|Add Printer}} wizard and select {{Path|Network Printer}}. When asked for the URI, use the <code><nowiki>http://hostname:631/printers/queue</nowiki></code> syntax. 

=== Configurar un cliente Windows para una impresora compartida a través de Samba ===

To share the printer on the CIFS network SAMBA must be installed and configured correctly. Doing this is beyond the scope of this article, however a quick configuration of SAMBA for shared printers will be covered. 

Open {{Path|/etc/samba/smb.conf}} with a favorite text editor and add a <code>[printers]</code> section to it: 

{{CodeBox|title=[printers] section|1=<pre>
[printers]
  comment      = All printers
  path         = /var/spool/samba
  browseable   = no
  guest ok     = no
  writable     = no
  printable    = yes
  public       = yes
  printer name = hpljet5p
</pre>
}}

Navigate to the top of the {{Path|smb.conf}} file until inside the <code>[global]</code> section. Locate the <code>printcap name</code> and <code>printing</code> settings and set each of them to <code>cups</code> (see the example below):

{{CodeBox|title=Changing the [global] section of smb.conf|1=<pre>
[global]
  (...)
  printcap name = cups
  printing      = cups
</pre>
}}

Make sure to enable [[#Enable_Support_for_Windows_PCL_Drivers|windows pcl]] support in CUPS. Then, restart the smb service to have the changes take effect.

=== Configurar un cliente Linux para un servidor de impresión Windows ===

First make sure the printer is shared on Windows systems and that <code>samba</code> has been emerged with the <code>cups</code> '''USE''' flag enabled (as instructed above).

To find the desired printer's URI, run the following command, substituting <code>server</code> with the computer that is to probe for samba-shared printers:

{{Cmd|smbclient -N '\\servidor\'}}

In the CUPS web interface, configure the printer as previously described. Notice CUPS has added another driver called <code>Windows Printer via SAMBA</code>. Select it and use the <code>smb://username:password@workgroup/server/printername</code> or <code>smb://server/printername</code> syntax for the URI.

{{Important|Any special characters in the above URI need to be appropriately quoted. For example:
<code>smb://BEN-DESKTOP/HP Color LaserJet CP1510 series PCL6</code>
  
becomes:
  
<code>smb://BEN-DESKTOP/HP%20Color%20LaserJet%20CP1510%20series%20PCL6</code>
  
  
This result string can be obtained by running the following command:
{{Cmd|python2 -c 'import urllib; print "smb://" + urllib.quote("BEN-DESKTOP/HP Color LaserJet CP1510 series PCL6")'}}
}}

== Aplicaciones relacionadas con la impresión ==

=== Introducción ===

Many tools exist to help configure a printer, use additional printing filters, add features to printing capabilities, etc. This chapter will list a few of them. Be aware the list is not exhaustive and not meant to discuss each tool in great detail. 

=== Gtk-LP. Una herramienta de configuración de impresión basada en Gtk ===

With [http://gtklp.sourceforge.net/index.shtml Gtk-LP] installation, modification and configuration of a printer can be performed from a stand-alone Gtk application. It uses CUPS and provides all standard CUPS capabilities. It is definitely worth checking out if the CUPS Web interface is disliked or if a stand-alone application for day-to-day printing routines is desired. 

Para instalarlo, haga emerge de gtklp: 

{{Emerge|gtklp}}

== Resolución de problemas ==

=== Error: Unable to convert file 0 to printable format ===

Si tiene problemas al imprimir y se muestra el siguiente mensaje en {{Path|/var/log/cups/error_log}}: 

{{CodeBox|title=Error log|1=<pre>
Unable to convert file 0 to printable format
</pre>
}}

Re-emerge {{Package|app-text/ghostscript-gpl}} with the <code>cups</code> '''USE''' flag. You can either add <code>cups</code> to the system '''USE''' flags in {{Path|/etc/portage/make.conf}} or enable it only for ghostscript-gpl as shown: 

{{RootCmd|echo "app-text/ghostscript-gpl cups" >> /etc/portage/package.use}}

Then run <kbd>emerge app-text/ghostscript-gpl</kbd>. When it has finished compiling, be sure to restart <code>cupsd</code> afterward: 

{{RootCmd|/etc/init.d/cupsd restart}}


{{Migrated|originalauthors=swift, nightmorph}}
