<languages />


{{Metadata|abstract=Данное руководство знакомит пользователя с основами LDAP и описывает, как можно настроить OpenLDAP для осуществления аутентификации в рамках группы компьютеров.}}


Данное руководство знакомит пользователя с основами LDAP и описывает, как можно настроить OpenLDAP для осуществления аутентификации в рамках группы компьютеров.


== Введение в OpenLDAP ==

=== Что такое LDAP? ===

LDAP означает ''Легковесный протокол доступа к каталогу'' (Lightweight Directory Access Protocol). Основанный на X.500, он включает в себя большую часть его основных функций, за исключением более редких, которые есть у X.500. Что же такое X.500 и зачем нужен LDAP? 

X.500 является моделью для сервисов каталога (Directory Services) в концепции OSI. Он содержит определения пространства имен (namespace) и протоколы для запросов и обновления каталога. Однако, существует немало случаев, когда полноценная функциональность X.500 не требуется. Встречайте LDAP. Как и X.500, он обеспечивает модель данные/пространство имен для каталога и протокола. Однако LDAP разработан для прямой работы через стек TCP/IP. Можно считать LDAP сокращенной версией X.500. 

=== Что такое каталог (directory)? ===

Каталог — это специализированная база данных, созданная для частых запросов, но нечастых обновлений. В отличие от обычных баз данных, каталог не поддерживает транзакции (transaction) или функциональности отката (roll-back). Каталоги легко дублируются для улучшения доступности и надежности. При дублировании каталогов допускаются временные противоречия при условии, что позже они будут синхронизированы. 

=== Как осуществляется структурирование информации? ===

Вся информация в каталоге структурирована иерархически. Более того, для того, чтобы внести данные в каталог, каталог должен знать, как хранить эти данные в дереве. Рассмотрим вымышленную компанию и дерево, подобное Интернет: 

{{CodeBox|title=Организационная структура для GenFic, вымышленной компании Gentoo (Fictional Gentoo company)|1=
dc:         com
             {{!}}
dc:        genfic         ## (Организация)
          /      \
ou:    Люди    серверы    ## (Организационные единицы)
      /    \     ..
uid: ..   John            ## (Специфические данные OU)
}}

Поскольку данные не записываются в базу в подобной манере ascii-art, каждый элемент этого дерева должен быть определен. Для названий элементов LDAP использует схему наименований. Большая часть дистрибутивов LDAP (включая OpenLDAP) включает в себя определенное количество предопределенных (и одобренных) схем, таких как ''inetOrgPerson'', или часто используемая схема для определения пользователей, которую могут использовать Unix/Linux-системы, которая называется ''posixAccount''. Существуют утилиты графического интерфейса, основанные на веб, для упрощения управления LDAP: раздел [[#Работа с OpenLDAP|Работа с OpenLDAP]] содержит неполный список таких утилит.

Заинтересованным пользователям рекомендуется прочитать [http://www.openldap.org/doc/admin24/ OpenLDAP Admin Guide].

=== Итак, для чего же его можно использовать? ===

LDAP можно использовать для разнообразных нужд. В этой статье описывается централизованное управление пользователями, хранение всех учетных записей пользователей в одном местонахождении LDAP (что не означает, что оно находится на одном сервере — LDAP поддерживает высокую доступность (high availability) и резервирование (redundancy)), однако LDAP может использоваться и в других целях. 

* инфраструктура открытых ключей

* общий календарь

* общая адресная книга

* хранилище для DHCP, DNS, ...

* System Class Configuration Directives (отслеживание нескольких конфигураций сервера)

* централизованная аутентификация (PosixAccount)

* ...

== Настройка сервера OpenLDAP  ==

Это руководство использует домен genfic.com в качестве примера. Естественно, вам нужно будет изменить это название. Однако убедитесь, что верхний элемент является официальным доменом верхнего уровня (net, com, cc, be, ...).


Сначала установим OpenLDAP. Убедитесь в том, что USE-флаги ''berkdb, crypt, gnutls, ipv6, sasl, ssl, syslog, -minimal'' и ''tcpd'' установлены.

{{Emerge|openldap}}


У OpenLDAP есть основной пользователь, "rootdn" (Root Distinguished Name), встроенный в приложение. В отличие от традиционного пользователя root Unix, пользователю rootdn необходимо предоставить соответствующие права доступа. Пользователя rootdn можно использовать только в контексте конфигурации, однако его также можно использовать в определении каталога. В этом случае пользователь может аутентифицироваться как rootdn либо с помощью пароля конфигурации, либо с помощью пароля дерева (основанного на каталоге).

В целях верификации, пароли пользователей (как пользователей rootdn, так и других) можно хранить в виде простого текста, либо в хешированном (hashed) виде. Доступно несколько хеш-алгоритмов, но не рекомендуется использовать слабые алгоритмы (вплоть до MD5). На данный момент, SHA считается достаточно безопасным с точки зрения криптографии.

В нижеприведенной команде хешированное значение создается для данного пароля; результат этой команды можно использовать в файле конфигурации {{Path|slapd.conf}} либо во внутреннем определении пользователя в справочнике:

{{RootCmd|slappasswd|output=<pre>
New password: my-password
Re-enter new password: my-password
{SSHA}EzP6I82DZRnW+ou6lyiXHGxSpSOw2XO4
</pre>
}}


Теперь отредактируйте конфигурацию сервера LDAP в файле {{Path|/etc/openldap/slapd.conf}}. Предоставленный файл {{Path|slapd.conf}}, взят из оригинального архива исходного кода openLDAP. Ниже приведен пример файла конфигурации, которым его можно заменить. 

{{FileBox|filename=/etc/openldap/slapd.conf|1=
include	/etc/openldap/schema/core.schema
include /etc/openldap/schema/cosine.schema
include /etc/openldap/schema/inetorgperson.schema
include /etc/openldap/schema/nis.schema
include	/etc/openldap/schema/misc.schema
 
pidfile  /var/run/openldap/slapd.pid
argsfile /var/run/openldap/slapd.args
 
## ## ServerID, используемый в случае дублирования
serverID 0 
loglevel 0
 
## ## Раздел Certificate/SSL
TLSCipherSuite normal
TLSCACertificateFile /etc/openldap/ssl/ldap.crt
TLSCertificateFile /etc/openldap/ssl/ldap.pem
TLSCertificateKeyFile /etc/openldap/ssl/ldap.key
TLSVerifyClient never
 
## ## Управление доступом
access to dn.base="" by * read
access to dn.base="cn=Subschema" by * read
access to *
  by self write
  by users read
  by anonymous read
 
## ## Определение базы данных
database hdb
suffix "dc=genfic,dc=com"
checkpoint 32 30
rootdn "cn=Manager,dc=genfic,dc=com"
## ## rootpwd, сгенерированный ранее с помощью команды slappasswd
rootpw "{SSHA}EzP6I82DZRnW+ou6lyiXHGxSpSOw2XO4" 
directory "/var/lib/openldap-data"
index objectClass eq
 
## ## Синхронизация (с другим сервером LDAP)
syncrepl rid=000
  provider=ldap://ldap2.genfic.com
  type=refreshAndPersist
  retry="5 5 300 +"
  searchbase="dc=genfic,dc=com"
  attrs="*,+"
  bindmethod="simple"
  binddn="cn=ldapreader,dc=genfic,dc=com"
  credentials="ldapsyncpass"
 
index entryCSN eq
index entryUUID eq
 
mirrormode TRUE
 
overlay syncprov
syncprov-checkpoint 100 10
}}

Для более подробного анализа файла конфигурации рекомендуем изучить OpenLDAP Administrator's Guide. 

=== Проверка конфигурации ===

После изменения файла {{Path|slapd.conf}}, его можно проверить с помощью следующей команды.

{{Cmd|slaptest -v -d 1 -f /etc/openldap/slapd.conf}}

Или используя OLC:

{{Cmd|slaptest -v -d 1 -F /etc/openldap/slapd.d}}

Измените уровень отладки ("-d 1" выше), чтобы получить больше информации. Если все в порядке, будет отображено сообщение ''config file testing succeeded''. В случае ошибки, <code>slaptest</code> выведет номер строки в файле {{Path|slapd.conf}}, содержащей ошибку.

Обратите внимание, что, начиная с версии 2.4.23, OpenLDAP перешел с традиционных файлов конфигурации ({{Path|slapd.conf}}) на OLC (OnLineConfiguration, также известный по структуре <code>cn=config</code>), в качестве метода конфигурации, используемого по умолчанию. Одно из преимуществ использования OLC в том, что динамический back-end (cn=config) не требует перезапуска сервера после обновления конфигурации. Существующие пользователи могут перейти на новый метод конфигурации, запустив команду <code>slaptest</code> одновременно с параметрами -f и -F. По традиции, OLC хранится в ldif back-end (что сохраняет преимущества удобочитаемости для человека) в каталоге {{Path|/etc/openldap/slapd.d}}. В Gentoo преобразование конфигурации пока не требуется, однако поддержка на данный момент документированного подхода в будущем будет убрана.

Чтобы иметь возможность изменения конфигурации сервера OpenLDAP, необходимо определить как минимум доступ для записи (или, как правило, для управления) в <code>cn=config</code>.

В нижеследующем примере показано, как можно предоставить доступ для управления к OLC (база данных ''cn=config'') для системного администратора (пользователя root), добавив соответствующие строки в конец файла {{Path|slapd.conf}}:

{{FileBox|filename=/etc/openldap/slapd.conf|title=Предоставление прав управления пользователю Linux root в cn{{=}}config|1=
database config
access to *
        by dn.exact="gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth" manage
        by * none
}}

{{RootCmd|mkdir /etc/openldap/slapd.d}}
{{RootCmd|slaptest -f /etc/openldap/slapd.conf -F /etc/openldap/slapd.d}}
{{RootCmd|chown -R ldap /etc/openldap/slapd.d}}

Запуск этой команды переместит и преобразует конфигурацию. После этого предполагается обновление конфигурации с помощью специально подготовленных файлов ldif. Лишь в том случае, если вы с ними не знакомы, следует редактировать {{Path|slapd.conf}} и повторно преобразовать его в {{Path|slapd.d/}}. Не забудьте проверить права доступа каталога.

Для дополнительных инструкций прочитайте in-line комментарии сгенерированных файлов.

Нижеприведенная строка включает метод конфигурации {{Path|slapd.d/}}. 

{{FileBox|filename=/etc/conf.d/slapd|lang=bash|1=
OPTS="-F /etc/openldap/slapd.d -h 'ldaps:// ldap:// ldapi://%2fvar%2frun%2fopenldap%2fslapd.sock'"
}}

Наконец, создайте структуру {{Path|/var/lib/openldap-data}}: 

{{RootCmd|mkdir -p /var/lib/openldap-data
|chown ldap:ldap /var/lib/openldap-data
|chmod 700 /var/lib/openldap-data}}


Запустите slapd: 

{{RootCmd|/etc/init.d/slapd start}}

Если он не запускается, установите переменную ''loglevel'' в файле {{Path|slapd.conf}} в значение 4 или больше и обратитесь за информацией к файлу {{Path|/var/log/messages}}.

==== Пример обновления LDIF в стиле OLC ====

Ниже приводится несколько примеров обновления конфигурации в стиле OLC.

Например, чтобы изменить местонахождение каталога конфигурации OLC:

{{FileBox|filename=fix-configs.ldif|1=
dn: cn=config
changetype: modify
delete: olcConfigFile
dn: cn=config
changetype: modify
replace: olcConfigDir
olcConfigDir: /etc/openldap/slapd.d
}}

Чтобы изменить уровень журнала, используемого процессом OpenLDAP:

{{FileBox|filename=loglevel.ldif|1=
dn: cn=config
changetype: modify
replace: olcLogLevel
olcLogLevel: stats sync
}}

Чтобы применить изменения, запустите следующую команду:

{{RootCmd|ldapmodify -Y EXTERNAL -H ldapi:/// -f loglevel.ldif}}

== Настройка клиентских утилит OpenLDAP == 

Отредактируйте файл конфигурации клиента LDAP. Этот файл читается командой ldapsearch и другими ldap-утилитами командной строки.

{{FileBox|filename=/etc/openldap/ldap.conf|title=Добавьте следующее|1=
BASE         dc=genfic, dc=com
URI          ldap://ldap.genfic.com:389/ ldap://ldap1.genfic.com:389/ ldap://ldap2.genfic.com:389/
TLS_REQCERT  allow
TIMELIMIT    2
}}

Запущенный сервер можно протестировать с помощью следующей команды: 

{{Cmd|ldapsearch -x -D "cn{{=}}Manager,dc{{=}}genfic,dc{{=}}com" -W}}

В случае возникновения ошибки, попробуйте добавить -d 255 для увеличения детализации вывода.

== Настройка клиента для централизованной аутентификации  ==

Существует целый ряд методов/утилит для осуществления удаленной аутентификации. Некоторые дистрибутивы также предоставляют свои собственные конфигурационные утилиты, легкие в использовании. Ниже приводится ряд утилит в произвольном порядке. Существует возможность одновременного сочетания локальных пользователей и центрально авторизованных учетных записей. Это важно, поскольку, например, если LDAP сервер недоступен, по-прежнему можно войти в систему в качестве пользователя root.

* SSSD (Single Sign-on Services Daemon). Его основная функция — обеспечение доступа к identity и аутентификационного удаленного ресурса посредством общей структуры, которая способна предоставлять кеширование и оффлайн поддержку для системы. Он предоставляет модули PAM и NSS, и в будущем будет поддерживать интерфейсы D-Bus для расширенной пользовательской информации. Он также предоставляет лучшую базу данных для хранения локальных пользователей, а также расширенных пользовательских данных.

* Используйте <code>pam_ldap</code> для входа на сервер LDAP и аутентификации. Пароли ''не'' посылаются по сети в виде простого текста.  

* NSLCD (Name Service Look up Daemon). Схож с SSSD, но старше его.

* NSS (Name Service Switch) с использованием традиционного модуля <code>pam_unix</code> для загрузки хешей паролей по сети. Чтобы разрешить пользователям обновлять пароли, этот метод нужно использовать совместно с методом <code>pam_ldap</code>.

Первые два варианта демонстрируются ниже, с минимальным необходимым количеством параметров конфигурации.

=== Настройка клиента PAM метод SSSD ===

Здесь представлен более краткий метод. Ниже приводятся три файла, которые необходимо отредактировать. 

{{FileBox|filename=/etc/sssd/sssd.conf|lang=ini|1=
[sssd]
config_file_version = 2
services = nss, pam
domains = genfic
debug_level = 5
  
[nss]
filter_users = root,ldap,named,avahi,haldaemon,dbus,radiusd,news,nscd
  
[domain/genfic]
id_provider = ldap
auth_provider = ldap
ldap_search_base = dc=genfic,dc=com
ldap_tls_reqcert = never
# основной и резервный серверы ldap [первый сервер и],[второй сервер]
ldap_uri = ldap://X.X.X.X,ldap://X.X.X.X
}}


Добавьте sss в конце как показано ниже, чтобы включить передачу поиска имени системному сервису sssd. После завершения редактирования запустите демон sssd.

{{FileBox|filename=/etc/nsswitch.conf|title=Пример файла nsswitch.conf с поддержкой SSSD|1=
passwd:     files sss
shadow:     files sss
group:      files sss
  
netgroup:   files sss
automount:  files sss
sudoers:    files sss
}}

Последний файл является наиболее важным. Откройте дополнительный root-терминал перед тем, как его редактировать. Строки, заканчивающиеся символом <code>#</code>, добавлены для включения удаленной аутентификации. Обратите внимание на использование {{Path|pam_mkhomedir.so}} для поддержки создания домашних каталогов пользователей.

{{FileBox|filename=/etc/pam.d/system-auth|title=Включение поддержки pam_sss|1=
#%PAM-1.0
# This file is auto-generated.
# User changes will be destroyed the next time authconfig is run.
auth        required      pam_env.so
auth        sufficient    pam_unix.so nullok try_first_pass
auth        requisite     pam_succeed_if.so uid >= 500 quiet
auth        sufficient    pam_sss.so use_first_pass                                         #
auth        required      pam_deny.so
  
account     required      pam_unix.so
account     sufficient    pam_localuser.so
account     sufficient    pam_succeed_if.so uid < 500 quiet
account     [default=bad success=ok user_unknown=ignore] pam_sss.so                         #
account     required      pam_permit.so
  
password    requisite     pam_cracklib.so try_first_pass retry=3
password    sufficient    pam_unix.so md5 shadow nullok try_first_pass use_authtok
password    sufficient    pam_sss.so use_authtok                                            #
password    required      pam_deny.so
  
session     required      pam_mkhomedir.so skel=/etc/skel/ umask=0077
session     optional      pam_keyinit.so revoke
session     required      pam_limits.so
session     [success=1 default=ignore] pam_succeed_if.so service in crond quiet use_uid
session     required      pam_unix.so
session     optional      pam_sss.so                                                        #
}}

Теперь попробуйте войти в систему с другого компьютера.

=== Настройка клиента PAM метод модуль pam_ldap ===

Сначала настроим PAM таким образом, чтобы разрешить авторизацию LDAP. Установите {{Package|sys-auth/pam_ldap}}, чтобы PAM поддерживал авторизацию LDAP, и {{Package|sys-auth/nss_ldap}}, чтобы система могла справиться с серверами LDAP для дополнительной информации (используется файлом {{Path|nsswitch.conf}}). 

{{Emerge|pam_ldap nss_ldap}}

Последний файл является наиболее важным. Откройте несколько резервных root-терминалов перед тем, как его редактировать. Строки, заканчивающиеся символом <code>#</code>, добавлены для включения удаленной аутентификации.

{{FileBox|filename=/etc/pam.d/system-auth|1=
#%PAM-1.0
 
auth       required     pam_env.so
auth       sufficient   pam_unix.so try_first_pass likeauth nullok
auth       sufficient   pam_ldap.so use_first_pass                                                    #
auth       required     pam_deny.so
 
account    sufficient   pam_ldap.so                                                                   #
account    required     pam_unix.so
 
password   required     pam_cracklib.so difok=2 minlen=8 dcredit=2 ocredit=2 try_first_pass retry=3
password   sufficient   pam_unix.so try_first_pass use_authtok nullok md5 shadow
password   sufficient   pam_ldap.so use_authtok use_first_pass                                        #
password   required     pam_deny.so
 
session    required     pam_limits.so
session    required     pam_unix.so
session    optional     pam_ldap.so                                                                   #
}}

Теперь отредактируйте {{Path|/etc/ldap.conf}} следующим образом: 

{{FileBox|filename=/etc/ldap.conf|1=
## #host 127.0.0.1
## #base dc=padl,dc=com
 
base dc=genfic,dc=com
## #rootbinddn uid=root,ou=People,dc=genfic,dc=com
bind_policy soft
bind_timelimit 2
ldap_version 3
nss_base_group ou=Group,dc=genfic,dc=com
nss_base_hosts ou=Hosts,dc=genfic,dc=com
nss_base_passwd ou=People,dc=genfic,dc=com
nss_base_shadow ou=People,dc=genfic,dc=com
pam_filter objectclass=posixAccount
pam_login_attribute uid
pam_member_attribute memberuid
pam_password exop
scope one
timelimit 2
uri ldap://ldap.genfic.com/ ldap://ldap1.genfic.com ldap://ldap2.genfic.com
}}

Далее скопируйте файл (OpenLDAP) {{Path|ldap.conf}} с сервера на клиент, чтобы клиенты знали об окружении LDAP: 

{{RootCmd|scp ldap-server:/etc/openldap/ldap.conf /etc/openldap}}

Наконец, настройте клиентов таким образом, чтобы они проверяли LDAP на наличие системных учетных записей: 

{{FileBox|filename=/etc/nsswitch.conf|1=
passwd:         files ldap
group:          files ldap
shadow:         files ldap
}}

Возможно, вы заметили, что одна из строк, скопированных в файл {{Path|/etc/ldap.conf}}, была закомментирована (строка <code>rootbinddn</code>): она нужна только в том случае, если требуется изменять пароли пользователей пользователем root. В этом случае нужно поместить пароль пользователя root с помощью команды echo в файл {{Path|/etc/ldap.secret}} в виде простого текста. Это '''ОПАСНО''', и права доступа к этому файлу следует установить в 600. Возможный вариант — держать этот файл пустым, и в случае возникновения необходимости изменить чей-либо пароль, находящийся и в LDAP и в {{Path|/etc/passwd}}, поместить в этот файл пароль на 10 секунд, пока производится изменение пароля пользователя, после чего удалить его.

== Перенесение существующих данных на LDAP ==

Настройка OpenLDAP для централизованного администрирования и управления привычными объектами Linux/Unix непроста, но, благодаря некоторым утилитам и сценариям, доступным в Интернете, задача перенесения системы с администрирования одной системы на центрально управляемую систему на основе OpenLDAP не так уж сложна. 

Загрузите сценарии с [http://www.padl.com/OSS/MigrationTools.html http://www.padl.com/OSS/MigrationTools.html]. Вам понадобятся утилиты перенесения и сценарий {{Path|make_master.sh}}. 

Затем распакуйте утилиты и скопируйте сценарий {{Path|make_master.sh}} в распакованное местонахождение: 

{{RootCmd|mktemp -d|output=<pre>
/tmp/tmp.zchomocO3Q
</pre>}}

{{RootCmd|cd /tmp/tmp.zchomocO3Q
|tar xvzf /path/to/MigrationTools.tgz
|mv /path/to/make_master.sh MigrationTools-47
|cd MigrationTools-47</pre>}}

Следующий шаг — перенести информацию с системы на OpenLDAP. Это осуществляется с помощью сценария {{Path|make_master.sh}}, после предоставления ему информации о структуре и окружении LDAP. 

На момент написания, утилитам требуется следующий ввод: 

{| class="wikitable" style="text-align: left;" 
|- 
! Ввод
! Описание
! Пример
|- 
| LDAP BaseDN
| Базовое местонахождение (root) дерева
| dc=genfic,dc=com
|- 
| Почтовый домен
| Домен, используемый для адресов электронной почты
| genfic.com
|- 
| Почтовый хост
| FQDN инфраструктуры почтового сервера
| smtp.genfic.com
|- 
| LDAP Root DN
| Информация об административной учетной записи структуры LDAP
| cn=Manager,dc=genfic,dc=com
|- 
| Пароль пользователя Root LDAP
| Пароль для административной учетной записи, cfr ранее команда <code>slappasswd</code>
| 
|-
|}

Утилита также запросит, какие учетные записи и настройки следует перенести. 

{{Warning| Вносить изменения в pam.d/system-auth не требуется}}

== Дублирование ==

=== Высокая доступность ===

Настройка дублирования изменений на нескольких системах LDAP. В данном руководстве дублирование в OpenLDAP настраивается с помощью специальной учетной записи ( <code>ldapreader</code> ), у которой есть права чтения на основном сервере LDAP и которая загружает изменения с основного сервера на вспомогательный. 

Далее эта настройка дублируется, что позволяет вспомогательному серверу LDAP выполнять роль основного. Благодаря внутренней структуре OpenLDAP, если изменения уже присутствуют в структуре LDAP, повторно они не применяются.

=== Настройка дублирования ===

Для того, чтобы настроить дублирование, сначала настройте второй сервер OpenLDAP подобно тому, как описано выше. Однако обратите внимание на то, что в файле конфигурации:

* ''sync replication provider'' указывает на ''другую'' систему

* У каждой системы OpenLDAP свой ''serverID''

Далее создайте синхронизационную учетную запись. Создадим файл LDIF (формат, используемый для ввода данных на серверах LDAP) и добавим его на каждом сервере LDAP: 

{{Cmd|slappasswd -s myreaderpassword|output=<pre>
 {SSHA}XvbdAv6rdskp9HgFaFL9YhGkJH3HSkiM
</pre>}}

{{Cmd|cat ldapreader.ldif|output=<pre>
dn: cn=ldapreader,dc=genfic,dc=com
userPassword: {SSHA}XvbdAv6rdskp9HgFaFL9YhGkJH3HSkiM
objectClass: organizationalRole
objectClass: simpleSecurityObject
cn: ldapreader
description: LDAP reader used for synchronization
</pre>}}

{{Cmd|ldapadd -x -W -D "cn{{=}}Manager,dc{{=}}genfic,dc{{=}}com" -f ldapreader.ldif|output=<pre>
Password: ## enter the administrative password
</pre>}}

== Настройки безопасности сервера LDAP ==

=== Права доступа OpenLDAP ===

Файл {{Path|/etc/openldap/slapd.conf}} позволяет указать ACLs (права доступа), определяющие, какие данные пользователи могут считывать и/или записывать: 

{{FileBox|filename=/etc/openldap/slapd.conf|1=
access to attrs=userPassword,gecos,description,loginShell
  by self write
  
access to *
  by dn="uid=root,ou=People,dc=genfic,dc=com" write
  by users read
  by anonymous auth
}}

Этот пример обеспечивает пользователю доступ ко всем данным, которые он должен иметь возможность изменить. Если эта информация принадлежит вам, тогда у вас есть право записи; если это информация другого пользователя, тогда у вас есть право чтения; анонимные пользователи могут отправить имя пользователя/пароль, чтобы войти в систему. Существуют четыре уровня привилегий, от низшего к высшему: <code>auth search read write</code>. 

Следующий ACL обеспечивает несколько лучшую безопасность, поскольку он не разрешает обычным пользователям передавать другим свой shadowed пароль: 

{{FileBox|filename=/etc/openldap/slapd.conf|1=
access to attrs="userPassword"
  by dn="uid=root,ou=People,dc=genfic,dc=com" write
  by dn="uid=John,ou=People,dc=genfic,dc=com" write
  by anonymous auth
  by self write
  by * none
 
access to *
  by dn="uid=root,ou=People,dc=genfic,dc=com" write
  by dn="uid=John,ou=People,dc=genfic,dc=com" write
  by * search
}}

Этот пример обеспечивает пользователям root и John доступ для чтения/записи/поиска любой информации в дереве под {{Path|dc{{=}}genfic,dc{{=}}com}}. Он также позволяет пользователям изменять свои <code>userPassword</code>'s. Что касается последней строки, у всех остальных есть только возможность поиска, что означает, что они могут заполнить фильтр поиска, но не могут прочитать результат поиска. Теперь у вас есть возможность иметь несколько ACLs, однако общим правилом является обработка снизу вверх, так что верхний уровень должен быть наиболее ограниченным.

== Работа с OpenLDAP ==

=== Обслуживание справочника ===

Можно приступать к использованию справочника для аутентификации пользователей в apache/proftpd/qmail/samba. Управление можно осуществлять с помощью [https://www.ldap-account-manager.org/lamcms/ LAM (Ldap Account Manager)], phpldapadmin, diradm, jxplorer или lat. Эти утилиты обеспечивают легкие в использовании интерфейсы управления.

== Благодарности ==

Мы хотели бы поблагодарить Matt Heler за то, что он одолжил нам свой компьютер в целях написания данного руководства. Также спасибо замечательным ребятам на #ldap @ irc.freenode.net. 

[[Category:Server and Security]] {{Migrated|originalauthors=Benjamin Coles, swift, Brandon Hale, Benny Chuang, jokey, nightmorph}}
