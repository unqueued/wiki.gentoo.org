<languages />
この記事では、'''GRUB2'''の最も単純な導入・実行方法について述べています。より高度な情報は、[[GRUB2]] の記事をみてください。[[GRUB|GRUB レガシー]]から GRUB2 への移行については、[[GRUB2 Migration]]の記事をみてください。

== GRUB2 ソフトウェアのインストール ==

{{Package|sys-boot/grub}} パッケージは複数のスロットがあり、grub-0.97 と grub-2.xx の両方を同時にインストールすることも可能です。しかし、両方のバージョンの GRUB を同時にインストールしていても、ブートローダとして実際に使えるのは一方のみで、両方を同時に使うことは不可能です。

GRUB2 をインストールするにはまず、システム上の {{Path|make.conf}}で <var>GRUB_PLATFORMS</var> 変数に適切な値を1つ以上設定します。もしも設定がなければ、GRUB2 は当該システムに使われているプラットフォームを推定して動作することになるでしょう。例えば、{{Keyword|x86}} や {{Keyword|amd64}} アーキテクチャであれば <code>pc</code> (MBR 方式のインストール)が推定されます。

{{FileBox|filename=/etc/portage/make.conf|title=GRUB_PLATFORMS の例|lang=bash|1=
# 一般的な PC (BIOS)
GRUB_PLATFORMS="pc"
 
# amd64 (x86_64) の UEFI
GRUB_PLATFORMS="efi-64"
 
# UEFI と PC の両方
GRUB_PLATFORMS="efi-64 pc"
}}

変数を設定したら、ソフトウェアを emerge:

{{emerge|sys-boot/grub:2}}

== GRUB2 ブートローダを有効にする ==

マウントしていなければまず、{{Path|/boot}} をマウント:

{{RootCmd|mount /boot}}

EFI 方式を使用するには、[[EFI System Partition]](ESP)が {{Path|/boot/efi}} のパスでアクセス可能（マウントされている）ことが必要です。{{Path|/boot/efi}} が個別のマウントポイントでもかまいませんし、{{Path|/boot}} 全体が FAT ファイルシステムでフォーマットされていてもかまいません（そうすると{{Path|/boot}} は大きな EFI システムパーティションになるでしょう）。

{{Path|/boot/efi}} のみが FAT である場合は:

{{RootCmd|mount /boot/efi}}

{{c|grub-install}} ユーティリティを実行すると、{{Path|/boot/grub}} に適切なファイルがコピーされます。PC プラットフォームではさらに、ブートイメージがマスターブートレコード(MBR)あるいはパーティションのブートセクタに書き込まれます。

MBR に GRUB2 をインストールする場合:

{{RootCmd|grub-install /dev/sda||output=<pre>
Installation finished. No error reported.
</pre>}}

EFI 対応システムに GRUB2 をインストールする場合:

{{RootCmd|grub-install --target{{=}}x86_64-efi|output=<pre>
Installation finished. No error reported.
</pre>}}

{{Important|EFI 対応システムへの GRUB2 のインストールがうまくいかないときは、{{Path|/etc/portage/make.conf}} に<var>GRUB_PLATFORMS</var> が正しく設定されているか確認してください}}

{{c|grub-install}} コマンドは <code>--target</code> オプションを指定することで CPU・プラットフォームを特定することが可能です。もし指定されていなければ、{{c|grub-install}} は、推定をします: 例えば {{Keyword|x86}} や {{Keyword|amd64}} のシステムであれば、<code>i386-pc</code> の値がデフォルトになります。

=== 自動設定 ===

GRUB2 は従前と同様、{{c|grub-mkconfig}} プログラムも使って設定ファイルを生成するようになっています。

{{c|grub-mkconfig}} は、{{Path|/etc/grub.d}} 内のテンプレート項目に基づいて設定ファイルを生成します。デフォルトのテンプレートは、およそ一般的なブート設定を網羅しているはずです。

{{Cmd|ls /etc/grub.d|output=<pre>
00_header  10_linux  20_linux_xen  30_os-prober  40_custom  41_custom  README
</pre>}}

これらテンプレートの動作は、{{Path|/etc/default/grub}} 内の変数で定められます。 [http://www.gnu.org/software/grub/manual/html_node/Simple-configuration.html GRUB マニュアル] に詳しい情報があります。

=== カーネルの命名ルール ===

{{c|grub-mkconfig}} が Linux カーネルの所在を検知するには、カーネルのファイル名が {{Path|vmlinuz-}} か {{Path|kernel-}} で始まっていなければなりません。

例えば:

{{CodeBox|title=GRUB2 が検知可能なカーネルの名称例|<pre>
 /boot/vmlinuz-3.4.3
 /boot/kernel-2.6.39-gentoo
 /boot/kernel-genkernel-x86_64-3.17.1-gentoo-r1
</pre>}}

[[initramfs]] を使用する場合は、{{Path|initramfs-}} か {{Path|initrd-}} で始まり、{{Path|.img}} で終わらねばなりません。バージョンはいずれかのカーネルイメージと一致している必要があります。{{c|[[genkernel]]}} で生成したファイル名も機能するでしょう。

例えば:

{{CodeBox|title=GRUB2 が検知可能な initramfs のファイル名称例|<pre>
 /boot/initrd.img-3.4.3
 /boot/initrd-3.4.3.img
 /boot/initrd-3.4.3.gz
 /boot/initrd-3.4.3
 /boot/initramfs-3.4.3.img
 /boot/initramfs-genkernel-3.4.3-gentoo
 /boot/initramfs-genkernel-x86_64-2.6.39-gentoo
</pre>}}

{{Path|grub.cfg}} ファイルを生成するには、{{c|grub-mkconfig}} を次のように実行:

{{RootCmd|grub-mkconfig -o /boot/grub/grub.cfg|output=<pre>
Generating grub.cfg ...
Found linux image: /boot/vmlinuz-3.2.9
done
</pre>}}

=== カーネル展開メッセージの抑制 ===

ブート時のカーネルイメージ展開メッセージを抑制するには、{{Path|/etc/default/grub}} 内の<var>GRUB_CMDLINE_LINUX_DEFAULT</var> 変数に <code>quiet</code> を追加します。

{{FileBox|filename=/etc/default/grub|title=展開メッセージの抑制例|lang=bash|1=
GRUB_CMDLINE_LINUX_DEFAULT="quiet"
}}

=== Systemd ===

GRUB2 を使用して systemd をブートするには、<var>GRUB_CMDLINE_LINUX</var> 変数を次のようにします:

{{FileBox|filename=/etc/default/grub|title=Systemd の例|lang=bash|1=
GRUB_CMDLINE_LINUX="init=/usr/lib/systemd/systemd"
}}

=== ほかの OS をロードするには ===

{{c|grub-mkconfig}} はまた、''ほかの'' オペレーティングシステムをロードするための設定を生成することも可能です。そのためには、{{Package|sys-boot/os-prober}} パッケージが必要です。

Windows をブートするには、{{Package|sys-fs/ntfs3g}} パッケージのインストールもまた必要です。そうすることで、{{c|grub-mkconfig}} ユーティリティは、 NTFS ファイルシステムを読み込むことも可能になります。

== マニュアルで設定 ==

{{c|grub-mkconfig}} を使用しなくとも、{{Path|grub.cfg}} ファイルを自ら編集することも可能ではあります。

以下は、GRUB レガシーの形式について経験のあるユーザのために、GRUB レガシーでの設定からの情報に基づいて GRUB2 の設定ファイルをどのように書くかを示した例です。

{|
! style="text-align: left;" | {{Path|grub.conf}} (GRUB Legacy)
|
! style="text-align: left;" | {{Path|grub.cfg}} (GRUB 2)
|-
| style="background: rgb(250,250,250); vertical-align: top; border: 1px solid black; padding: 5px 7px;" | <code style="color: gray; margin: 0; padding: 0; border: 0; background: transparent; line-height: normal;">timeout 5<br />
<br />
<span style="font-weight: bold; color: maroon;">title</span> Gentoo Linux 3.2.12<br />
root <span style="font-weight: bold; color: maroon;">(</span>hd0,<span style="font-weight: bold; color: maroon;">0)</span><br />
<span style="font-weight: bold; color: maroon;">kernel</span> /boot/kernel-3.2.12-gentoo root=/dev/sda3</code>
| style="vertical-align: middle; font-size: 50px; color: gray;" | ⇨
| style="background: rgb(250,250,250); vertical-align: top; border: 1px solid black; padding: 5px 7px;" | <code style="color: gray; margin: 0; padding: 0; border: 0; background: transparent; line-height: normal;">timeout<span style="font-weight: bold; color: green;">=</span>5<br />
<br />
<span style="font-weight: bold; color: green;">menuentry</span> <span style="font-weight: bold; color: green;">'</span>Gentoo Linux 3.2.12<span style="font-weight: bold; color: green;">'</span> <span style="font-weight: bold; color: green;">{</span><br />
<span style="display: inline-block; width: 4ex; overflow: hidden;">	</span>root<span style="font-weight: bold; color: green;">=</span>hd0,<span style="font-weight: bold; color: green;">1</span><br />
<span style="display: inline-block; width: 4ex; overflow: hidden;">	</span><span style="font-weight: bold; color: green;">linux</span> /boot/kernel-3.2.12-gentoo root=/dev/sda3<br />
<span style="font-weight: bold; color: green;">}</span>
|}

{{Note|GRUB レガシーのパーティション番号は 0 から始まりますが、GRUB2 では 1 から始まります。しかし、いずれのGRUB も、ドライブ番号は 0 から始まります。}}

== 参考 ==

*[[GRUB2]] - GRUB2 に関するより多くの情報と情報源を記載している'完全版'の記事


[[Category:Bootloaders]]
