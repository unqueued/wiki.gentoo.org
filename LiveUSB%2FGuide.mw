{{Metadata|abstract=This article explains how to create a Gentoo LiveUSB or, in other words, how to emulate a x86 or AMD64 Gentoo LiveCD using a USB drive.}}

This article explains how to create a ''Gentoo LiveUSB'' or, in other words, how to emulate a x86 or AMD64 Gentoo LiveCD using a USB drive. This is particularly useful for installing Gentoo on a modern laptop with no CD-ROM drive.

Although the instructions found in this document aim at emulating a Gentoo LiveCD using a USB drive, they should work for any arbitrary block device as long as the device names are adjusted accordingly.

{{Note|In Gentoo the {{Package|sys-boot/unetbootin}} package provides a much easier alternative to create a bootable USB stick from any bootable CD image. See the [[LiveUSB/Guide#Linux|Linux section]] below for instructions on the manual creation of a LiveUSB in Gentoo.}}

__TOC__

== Prerequisites ==

In order to use a Gentoo LiveUSB the following will be needed: 

* Bootable USB drive with at ''least'' 1GB (the bigger the better);
* i686 or x86_64 computer with support for booting from USB

Access to the following is needed for creating a LiveUSB: 

* A computer running Gentoo (or alternatively another Linux distribution);
* A computer running Microsoft Windows with the appropriate software (see the [[LiveUSB/Guide#Windows|Windows section]] below)

== Linux ==

=== Preparing the USB drive (manual mode) ===

==== Partitioning the drive ====

{{Warning|These instructions will erase all data from the USB drive. Make sure to backup any pre-existing data first.}}

{{Important|This article assumes that the {{Path|/dev/sdc}} device node corresponds to the USB drive. If other SCSI-like devices exist be sure to use the correct device node. Major data loss could occur if the wrong device node is selected!}}

Create a FAT16 partition on the USB drive and mark it bootable using <tt>fdisk</tt>. An example partitioning scheme can be seen below: 

{{Note|If the USB drive is 4GB or larger, use partition type <code>b</code> (W95 FAT32).}}

{{RootCmd|fdisk -l /dev/sdc|output=<pre>
Disk /dev/sdc: 2063 MB, 2063597056 bytes
255 heads, 63 sectors/track, 250 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes
  
   Device Boot      Start         End      Blocks   Id  System
/dev/sdc1   *           1         250     2008124+   6  FAT16
</pre>
}}

==== Creating the filesystem ====

Create a FAT16 filesystem on the USB drive using <tt>mkdosfs</tt>: 

{{Note|If the drive is 4GB or larger, use <code>-F 32</code> to create a FAT32 filesystem.}}

{{Emerge|sys-fs/dosfstools}}

{{RootCmd|mkdosfs -F 16 /dev/sdc1|output=<pre>
mkfs.fat 3.0.22 (2013-07-19)
</pre>
}}

==== Installing a Master Boot Record (MBR) ====

Install the precompiled Master Boot Record (MBR) from <tt>syslinux</tt> on the USB drive: 

{{Emerge|--verbose sys-boot/syslinux}}

{{RootCmd|dd if{{=}}/usr/share/syslinux/mbr.bin of{{=}}/dev/sdc|output=<pre>
0+1 records in
0+1 records out
440 bytes (440 B) copied, 0.00522668 s, 84.2 kB/s
</pre>
}}

=== Copying the files ===

==== Mounting the Gentoo Minimal Installation CD ====

Download a Gentoo Minimal Installation CD for the system's architecture from a the main site's [https://www.gentoo.org/downloads/ download page] and mount the ISO image on {{Path|/mnt/cdrom}} as shown below: 

{{RootCmd
|mkdir -p /mnt/cdrom
|mount -o loop,ro -t iso9660 /path/to/isofile.iso /mnt/cdrom
}}

Adjust the <code>/path/to/isofile.iso</code> as necessary to the location of the downloaded Minimal Installation CD ISO.

{{Note|If a ''Could not find any loop device'' error message is displayed when mounting the ISO, a kernel recompile may be required. Verify the <code>Loopback device support</code> option in the kernel configuration has been enabled. For more information on kernel configuration see the [[Kernel/Configuration|kernel configuration article]].}}

==== Mounting the LiveUSB ====

Mount the newly formatted USB drive on {{Path|/mnt/usb}} as shown below: 

{{RootCmd
|mkdir -p /mnt/usb
|mount -t vfat /dev/sdc1 /mnt/usb}}

==== Copying the files ====

Copy the files from the Minimal Installation CD to the LiveUSB. The files need to be reordered since <tt>syslinux</tt> will be used as the bootloader instead of <tt>isolinux</tt>: 

{{RootCmd|cp -r /mnt/cdrom/* /mnt/usb
|mv /mnt/usb/isolinux/* /mnt/usb
|mv /mnt/usb/isolinux.cfg /mnt/usb/syslinux.cfg
|rm -rf /mnt/usb/isolinux*
|mv /mnt/usb/memtest86 /mnt/usb/memtest}}

Unmount the ISO image: 

{{RootCmd|umount /mnt/cdrom}}

==== Adjusting the bootloader configuration ====

Adjust the syslinux configuration file using <tt>sed</tt> as shown below. The <code>slowusb</code> parameter will introduce some extra delays before attempting to mount the filesystem. This is needed to allow the USB drive to settle upon detection. 

{{RootCmd|sed -i -e "s:cdroot:cdroot slowusb:" -e "s:kernel memtest86:kernel memtest:" /mnt/usb/syslinux.cfg}}

=== Installing a bootloader ===

==== Unmounting the drive ====

Make sure the USB drive has been unmounted before installing the bootloader: 

{{RootCmd|umount /mnt/usb}}

==== Installing syslinux ====

Finally install the <tt>syslinux</tt> bootloader on the USB drive: 

{{RootCmd|syslinux /dev/sdc1}}

{{Important|<tt>syslinux /dev/sdc1</tt> will need to be re-ran each time the {{Path|syslinux.cfg}} file is modified in order for the configuration changes to take affect.}}

== Windows ==

=== Rufus ===

Rufus is a free and open source project created to successfully image USB drives with a verity of operating systems. It tends to be faster than the Universal USB installer (see in the next section).

Rufus can be downloaded from the project's homepage: http://rufus.akeo.ie/

Rufus is so easy to use that instructions for its use are not needed for this article. Seriously, go check it out! If questions do come up, check out Rufus' [https://github.com/pbatard/rufus/wiki/FAQ FAQ page].

=== Universal USB Installer ===

Universal USB installer is one of the oldest Linux-capable LiveUSB creators for Windows systems. It supports most Linux distributions, and has a simple, helpful wizard for selecting the Linux distribution. For Gentoo Minimal Installation CDs, however, select the {{Path|Try Unlisted Linux ISO}} which is at the very bottom of the list. Select the proper USB drive to format and extract Linux to, and click {{Path|Create}}.

Universal USB installer can be downloaded from its homepage: http://www.pendrivelinux.com/universal-usb-installer-easy-as-1-2-3/

== dd ==

When using the latest install ISOs (installcds or livedvd), it is sufficient to directly copy the ISO contents on the USB device. The <tt>dd</tt> command can be used to accomplish this. For instance, assuming the USB device is at {{Path|/dev/sdc}}:

{{RootCmd|dd if{{=}}/path/to/image.iso of{{=}}/dev/sdc bs{{=}}8192k}}

On Windows, the <tt>dd</tt> command is also available through various projects, such as [http://gnuwin32.sourceforge.net/ GNUWin32] or [http://www.chrysocome.net/dd Chrysocome].

The remainder of this document explains how to setup a manual vfat partition that is writable using the [[syslinux]] bootloader instead of isolinux.


== Using the LiveUSB ==

== Booting ==

Insert the USB drive and turn on the computer, make sure the BIOS (or EFI firmware) has been set to boot from USB. If all goes well a standard syslinux prompt should appear on the screen. 

Follow the generic installation instructions found in the [[Handbook:Main_Page|Gentoo Handbook]] appropriate to the system's architecture from here on to install Gentoo! 

[[Category:Core system]] {{Migrated|originalauthors=brix, neysx}}
