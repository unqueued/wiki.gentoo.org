<languages />


{{Metadata|abstract=독자 여러분에게 기존 GRUB에서 GRUB2로 유연하게 옮겨가는 방안을 알려드리는게 이 안내서의 목표입니다.}}

The goal of this guide is to provide readers with a smooth migration from [[GRUB Legacy]] to [[GRUB2]].

=== 배경 ===

=== GRUB 이란 무엇일까요? ===

GRUB은 비 임베디드 리눅스 장치에서 대부분 존재하는 부트로더중 하나입니다. GRUB의 역할은 디스크에서 메모리로 리눅스 커널을 불러오도록 갖추고 리눅스 커널을 실행하는 것입니다. 

=== 왜 옮겨야 하나요? ===

먼저, 이전 GRUB은 더이상 업데이트를 받지 않으므로 관리하지 않습니다. 이전 GRUB은 개발자들이 오늘날 더이상 제대로 된 상태로 유지할 수 없다는 다양한 고려 사항이 발생함에도 불구, 안전하다는 느낌에 빠질 때마다 계속 만들었습니다. 예를 들어 이전 GRUB은 2TB 이상의 디스크로는 부팅할 수 없으며 새 파일 시스템으로는 {{Path|/boot}}를 대체할 수 없다고 간주합니다. 

GRUB2는 좀 더 견고하고, 가벼우며, 강력함을 목표로 하였으며, 더욱 깔끔한 코드를 기반으로 유지 관리합니다. GRUB2는 이전 버전과는 달리 더 많은 하드웨어 설정, 파일 시스템, 드라이브 배치를 지원합니다. 

== GRUB2로 옮겨가기 ==

GRUB2로 옮겨가는 것은 꽤 간단합니다. 꾸러미 관리자가 보통 업그레이드 과정을 처리하는걸로 같이 끝냅니다. 자동으로 끌어오지 않았다면 <code>sys-boot/grub:2</code> 꾸러미 요소로 언제든 설치할 수 있습니다.

{{Emerge|sys-boot/grub:2}}

=== 부트 드라이브 ===

첫번째 중요한 부분은 어떤 드라이브가 부팅이 가능한지에 대한 이해입니다. 젠투 핸드북을 쭉 따라온 분이라면 {{Path|/dev/sda}}입니다. 잘 모르겠다면, 기존의 GRUB 설정을 살펴보는게 가장 쉬운 방법입니다. 주로 살펴볼 부분은{{Path|/boot/grub/grub.conf}} 파일입니다. 

{{Note|이 파일을 살펴볼 때 {{Path|/boot}} 분할 영역을 마운트했는지 확인하십시오. 확인 방법은 다음과 같이 간단합니다
{{RootCmd|mount /boot}}
}}

{{Path|grub.conf}}의 내용은 다음과 같습니다:

{{FileBox|filename=/boot/grub/grub.conf|1=
default 0
timeout 30
splashimage=(hd0,0)/boot/grub/splash.xpm.gz
  
title Gentoo Linux 3.2.12
root (hd0,0)
kernel /boot/kernel-3.2.12-gentoo root=/dev/sda3 quiet dolvm
initrd /boot/initramfs-genkernel-x86_64-3.2.12-gentoo
}}

위 파일 내용을 근거로 <code>(hd0)</code>가 부트 드라이브임을 알아낼 수 있지만 이걸 실제 장치로 대응해야 합니다. 이를 알려면 {{Path|/boot/grub/device.map}} 살펴보십시오. 예제는 아래에 있습니다. 

{{FileBox|filename=/boot/grub/device.map|1=
(fd0) /dev/fd0
(hd0) /dev/sda
(hd1) /dev/sdb
}}

{{Note/ko|{{Path|/boot/grub/device.map}}이 정확하지 않은 것 같다면, 다음 명령으로 파일을 다시 만드십시오:
{{RootCmd|grub-install --recheck /dev/sda}}
}}

위 파일을 기반으로 {{Path|/dev/sda}}가 부팅 드라이브임을 알고 있습니다.

=== GRUB2 설치 및 설정 ===

다음 단계에서는 예전의 GRUB을 드라이브의 주 부트 레코드(MBR)에서 제거하지 않고 {{Path|/boot}} 파티션에 GRUB2를 설치하고 설정합니다. 아래 예제는 {{Path|/dev/sda}}를 사용하지만 여러분에게 맞는 드라이브 경로로 바꿔야 합니다.

우선 {{Path|/boot/grub}}로 필요한 GRUB2 파일을 설치합니다.

{{RootCmd|grub-install --grub-setup{{=}}/bin/true /dev/sda|output=<pre>
Installation finished. No error reported.
</pre>}}

{{Warning|The option <code>--grub-setup{{=}}/bin/true</code> tells {{c|grub-install}} to ''not'' install GRUB2 in the MBR. If this option is omitted, GRUB Legacy will be overwritten and [[#Chainloading GRUB2 from GRUB Legacy to test the setup|chainloading GRUB2 from GRUB Legacy later on]] will not be possible.}}

{{Note|If GRUB2 was emerged with the <code>multislot</code> USE flag, the {{c|grub-install}} command will still refer to GRUB Legacy. In this case, use {{c|grub2-install}} instead — and use {{c|grub2-mkconfig}} in place of {{c|grub-mkconfig}} in the next step.}}

Now we can scan the available kernels and generate a suitable config file to {{Path|/boot/grub/grub.cfg}}. Skip this step when using a [[GRUB2_Quick_Start#Manual_configuration|Manual Configuration]].

{{RootCmd|grub-mkconfig -o /boot/grub/grub.cfg|output=<pre>
Generating grub.cfg ...
Found linux image: /boot/kernel-3.2.12-gentoo
Found initrd image: /boot/initramfs-genkernel-x86_64-3.2.12-gentoo
done
</pre>
}}

{{Warning|GRUB2 uses the configuration file {{Path|/boot/grub/grub.'''cfg'''}} whereas GRUB Legacy used {{Path|/boot/grub/grub.'''conf'''}} so please make sure not to use the old file by mistake, e.g. by using tab-completion if the old file is still there.}}

{{Note|{{c|grub-mkconfig}} has strict naming requirements for kernels and initramfs images. A kernel must be named <code>kernel-${version}</code> or <code>vmlinuz-${version}</code> while an initramfs must be named <code>initramfs-${version}.img</code>, <code>initramfs-genkernel-${version}</code>, <code>initramfs-genkernel-${arch}-${version}</code>, <code>initrd-${version}.img</code>, <code>initrd.img-${version}</code>, <code>initrd-${version}.gz</code>, or <code>initrd-${version}</code>. These files must be available in {{Path|/boot}}.}}

{{Note|The file {{Path|/etc/default/grub}} controls the operation of {{c|grub-mkconfig}}. If parameters need to be passed on to the kernel (for instance when using genkernel and booting from LVM or software RAID), edit that file before generating {{Path|/boot/grub/grub.cfg}} like so:
{{RootCmd|nano /etc/default/grub}}
Have a look at [[GRUB2#Configuration|GRUB2 configuration]] on the Gentoo Wiki or the [http://www.gnu.org/software/grub/manual/html_node/Simple-configuration.html official GRUB2 manual] to decide how to modify the file. Most users will need to change <code>GRUB_CMDLINE_LINUX</code> to specify parameters to be passed on the kernel command line.}}

=== 설정을 시험하기 위해 이전 GRUB에서 GRUB2 이어서 불러오기 ===

깨진 GRUB 설정은 시스템 부팅을 불가능하게 한다는 의미를 지닐 수 있으므로, GRUB2 설정을 완전히 두기 전에 시험하려 합니다. 이를 위해 예전 GRUB에서 GRUB2로 그대로 이어서 불러오도록 하겠습니다. {{Path|/boot/grub/grub.conf}}에 새 섹현을 추가하면 됩니다. 예제는 다음과 같습니다. 

{{Note/ko|예제에서 사용한 바와 같이 <code>(hd0,0)</code>과 실제 루트 분할 영역이 다를 수 있음을 알아두시고, {{Path|/boot/grub/grub.conf}} 설정 파일에서 같은 루트 값을 다시 사용하는지 확인하십시오.}}

{{FileBox|filename=/boot/grub/grub.conf|1=
default 0
timeout 30
splashimage=(hd0,0)/boot/grub/splash.xpm.gz
  
title GRUB2 Chainload
root (hd0,0)
kernel /boot/grub/i386-pc/core.img
boot
  
title Gentoo Linux 3.2.12
root (hd0,0)
kernel /boot/kernel-3.2.12-gentoo root=/dev/sda3 quiet dolvm
initrd /boot/initramfs-genkernel-x86_64-3.2.12-gentoo
}}

여기서 머신을 재부팅해야하고, 머신이 부팅할 때 GRUB 메뉴에서 <code>GRUB2 Chainload</code>를 선택해야 합니다. GRUB 2.0.0 이상과 같이 자체적으로 알려주는 다른 GRUB 메뉴가 상단에 함께 나타나고, 시스템에 있는 부팅 커널을 보여줍니다. 이게 동작하지 않으며 그냥 시스템을 껐다 켜고, <code>GRUB2 Chainload</code> 대신 일반 부트 옵션을 고르십시오. 

=== 이전 GRUB 대체하고 제거 ===

여기서 모든 동작이 성공적으로 끝났다면, 예전 GRUB을 바꾸고 시스템에서 제거할 수 있습니다. 

{{Warning|시스템을 다시 부팅했으므로 {{Path|/boot}} 분할 영역을 다시 마운트해야합니다. 단지 예제에서 보여준 것 처럼 {{Path|/dev/sda}} 대신 올바른 부팅 드라이브를 사용하는지 확인하십시오. {{c|grub-install}}을 실행하기 전 {{Path|/boot}}를 마운트하지 않으면, 시스템을 부팅할 수 없게 만듭니다.}}

{{RootCmd|grub-install /dev/sda|output=<pre>
Installation finished. No error reported.
</pre>
}}

여기서 꾸러미 관리자를 사용하여 <code>sys-boot/grub:0</code>을 제거할 수 있습니다. 

{{RootCmd|emerge -avC "{{=}}sys-boot/grub-0.97*"}}

이제 옮기는 과정이 끝났습니다.

== GRUB2 유지 관리 ==

새 커널을 설치하는 언제든지, 다음 단계를 진행하여 GRUB2 설정이 ([[GRUB2_Quick_Start/ko#.EC.A7.81.EC.A0.91_.EC.84.A4.EC.A0.95|직접 설정]] 방식을 따라가지 않는다면)새 커널을 인식하도록 해야 합니다. 

{{Note/ko|이 단계에서 {{Path|/boot}} 분할 영역을 마운트했는지 확인하십시오.}}

{{RootCmd|grub-mkconfig -o /boot/grub/grub.cfg|output=<pre>
Generating grub.cfg ...
Found linux image: /boot/kernel-3.3.8-gentoo
Found initrd image: /boot/initramfs-genkernel-x86_64-3.3.8-gentoo
Found linux image: /boot/kernel-3.2.12-gentoo
Found initrd image: /boot/initramfs-genkernel-x86_64-3.2.12-gentoo
done
</pre>
}}


[[Category:Bootloaders]]

{{Migrated|originalauthors=Cardoe}}
