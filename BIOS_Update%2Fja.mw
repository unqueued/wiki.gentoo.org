<languages />
ハードウェア製造者はしばしば [[BIOS]] やそのほかファームウェアのアップデートを提供しています。GNU/Linux でのアップデートの適用（しばしば「フラッシュ」と呼ばれる）は、すんなり行かず、いくらかの作業が必要なこともあります。

{{Warning/ja|ハードウェアが順調に動作しているならおよそ、BIOS をアップグレードする必要はありません。万が一失敗すると、BIOS やシステム上のファームウェアに原状回復不可能な損傷を来すことがあるうえ、ハードウェアのメーカー保証も失うことがあります。万全の注意をはらって進めてください！}}

== ファームウェアの情報収集 ==

まず、マザーボードの製造業者と該当モデルを調べます。システム添付の取扱説明書を調べましょう。通常は、取扱説明書を見れば必要な情報がわかります。

{{package|sys-apps/dmidecode}} を利用すると、システムのハードウェアに関する情報がさらに得られるかもしれません。{{c|dmidecode}} は、マザーボードの DMI テーブルを調査し、ファームウェアやハードウェア構成部品に関する詳細な情報を提供します。

{{RootCmd|dmidecode -t bios -t baseboard}}

また、マザーボードを物理的に確認すれば、必要な情報がマザーボード自体から見つかるかもしれません。

{{Warning/ja|マザーボードを確認するためにコンピュータを開けてしまうと、製品保証がなくなることもあります。}}

つぎに、製造業者のファームウェアの更新を探して、ハードウェアの更新に必要なパッケージをダウンロードします。ファームウェアの更新パッケージは、.zip や .exe、.iso などの形式であることが一般的です。 

{{Cmd|unzip 7235v1A.zip
|output=<pre>Archive:  7235v1A.zip
   creating: 7235v1A/
inflating: 7235v1A/7235v1x.txt
inflating: 7235v1A/AWFL865.EXE
inflating: 7235v1A/How to flash the BIOS.DOC
inflating: 7235v1A/W7235IMS.1A0
</pre>}}

== BIOS 更新方法 ==

多くのBIOSでは、外付けのフラッシュメモリやフロッピーディスクから新しいバイナリイメージを読み込ませる方法があります。BIOSセットアップ内の記述を見て確認してください。もしもこのような方法がなければ、次のセクションに進んでください。

== CDブート ==

製造業者によっては、CD-ROMのブートイメージで提供しています。このファイルは拡張子が {{Path|.iso}} で、空きのCD-R (CD-RW)　ディスクに書き込まなければなりません:
例えば {{c|cdrecord}} のようなツールを用いると書き込めます:

{{RootCmd|cdrecord BOOT-CD.iso}}

{{Note/ja|{{c|cdrecord}} には２種類のパッケージがあります: {{Package|app-cdr/cdrtools}} と {{Package|app-cdr/cdrkit}} です。}}

BIOS のブートメニューで CD からのブートを選び、製造業者のウェブサイトや取扱説明書に記載のある指示に従います。

== FreeDOS 環境 ==

FreeDOS を用いると、DOSベースのBIOS更新ユーティリティの実行が可能です。そのためには、必要な BIOS 更新ツールを含む「カスタム」 FreeDOS イメージを作成しなければなりません。カスタムイメージ作成後は、以下の方法のいずれかでイメージをブートしましょう。

FreeDOS とツール類のダウンロードは:

* [http://www.ibiblio.org/pub/micro/pc-stuff/freedos/files/distributions/1.0/ FreeDOS] - {{Path|fdboot.img}} ファイルをダウンロード
* [http://www.ibiblio.org/pub/micro/pc-stuff/freedos/files/dos/sys/sys-freedos-linux/ FreeDOS ブートセクタ] - {{Path|sys-freedos-linux.zip}} ファイルをダウンロード
* DOSベースのBIOS更新用プログラムと新しいBIOSを、製造業者のウェブサイトからダウンロード

=== カスタム FreeDOS イメージの作成 ===

まず、必要なソフトウェアのダウンロードと、カーネルのループバックデバイスの有効化:

{{KernelBox|title=enable loopback device|1=
Device Drivers  --->
    [*] Block devices  --->
        <M>   Loopback device support
}}

もしもモジュールがまだロードされていなければ、{{c|modprobe}} を用いてロード:

{{RootCmd|modprobe loop}}

必要なソフトウェアをインストール:

{{Emerge|dev-lang/nasm app-arch/unzip sys-fs/dosfstools}}

20MB以下のイメージファイルを {{c|dd}} コマンドで作成します。SystemRescueCD のものと置き換えるには、ファイル名が {{Path|freedos.img}} である必要があります。

{{RootCmd|dd if{{=}}/dev/null of{{=}}freedos.img bs{{=}}1024 seek{{=}}20480}}

ファイルシステムにイメージを書き込みます:

{{RootCmd|mkfs.fat freedos.img}}

ブートセクタをイメージファイルに書き込みます:

{{RootCmd|unzip sys-freedos-linux.zip && ./sys-freedos.pl --disk{{=}}freedos.img}}

それから、FreeDOS のファイルを新たなイメージにコピーします。

マウントポイントを作成します:

{{RootCmd|mkdir -p /mnt/freedos /mnt/freedos_new}}

オリジナルのイメージをマウントします:

{{RootCmd|mount -o loop fdboot.img /mnt/freedos}}

新たなイメージをマウントします:

{{RootCmd|mount -o loop freedos.img /mnt/freedos_new}}

FreeDOS のシステムファイルを、新たなイメージにコピーします:

{{RootCmd|cp -ar /mnt/freedos/* /mnt/freedos_new/}}

次に、書込み用プログラムと新たな BIOS を、イメージファイルにコピーします:

{{RootCmd|cp -ar FLASH-PROGRAM BIOS-UPDATE /mnt/freedos_new}}

イメージを２つともアンマウントします:

{{RootCmd|umount /mnt/freedos_new /mnt/freedos}}

{{Note/ja|DOS では、8 文字（および拡張子３文字）の長さまでしかファイル名を表示不可能です。この制限を超えるファイルがあれば、制限を満たすようにファイル名を変更するとよいでしょう。}}

=== FreeDOS を起動するために SystemRescueCD を使用する  ===

SystemRescueCDは、FreeDOS から作られています。オリジナルのイメージから置き換えて、ファームウェア更新に必要なプログラムを含むブート可能フラッシュメモリスティックを作成可能です。

==== SystemRescueCD のダウンロードと LiveUSBメモリの作成 ====

* [http://www.sysresccd.org/Download SystemRescueCD] - 通常の ISO イメージをダウンロード

==== ブート可能なメモリスティックの作成 ====

デフォルトの手段で、SystemRescueCDの起動ディスクを作成します。{{Path|usb_inst.sh}} のスクリプトを実行すれば、インストールの案内があります。

{{Warning/ja|メモリスティック内のデータがすべて消去されます！ この作業の前に、メモリスティック内の全てのデータがバックアップ済であることを確かめてください！}}

{{Path|/mnt}} の作成:

{{RootCmd|mkdir /mnt/SysRescueCD}}

CD イメージのマウント:

{{RootCmd|mount -o loop systemrescuecd-x86-VERSION.iso /mnt/SysRescueCD}}

インストールスクリプトの実行:

{{RootCmd|/mnt/SysRescueCD/usb_inst.sh}}

CD イメージのアンマウント:

{{RootCmd|umount /mnt/SysRescueCD}}

==== FreeDOS イメージの置換 ====

SystemRescueCD のメモリスティックにあるオリジナルの FreeDOS イメージを置き換えます。

SystemRescueCDのメモリスティックをマウント ({{Path|/dev/sdX1}} は、実際のメモリスティックのブロックデバイス名に置き換えて読んでください):

{{RootCmd|mount /dev/sdX1 /mnt/SysRescueCD}}

{{Path|freedos.img}} ファイルの置換:

{{RootCmd|cp freedos.img /mnt/SysRescueCD/bootdisk/}}

SystemRescueCD のメモリスティックのアンマウント:

{{RootCmd|umount /mnt/SysRescueCD}}

=== GRUB から直接に、FreeDOS イメージを起動する ===

もし外部メディアを使用せずに FreeDOS をブートするならば、syslinux 内の {{c|memdisk}} ツールを利用して、grub (あるいは他のブートローダ)で FreeDOS イメージを直接ブート可能にします。

{{Emerge|sys-boot/syslinux}}

（必要ならば）{{Path|/boot}} パーティションをマウント:

{{RootCmd|mount /boot}}

{{Path|/boot}} に、{{c|memdisk}} バイナリと FreeDOS イメージをコピー:

{{RootCmd|cp /usr/share/syslinux/memdisk /boot}}
{{RootCmd|cp freedos.img /boot}}

{{Path|/boot/grub/grub.conf}} を編集し、FreeDOS のエントリを追加:

{{FileBox|filename=/boot/grub/grub.conf|title=grub.conf のエントリ例|1=
title FreeDOS (BIOS update)
kernel /boot/memdisk floppy
initrd /boot/freedos.img
}}

=== BIOS の更新 ===

マシンを再起動させ、USBメモリスティック ''あるいは'' 新たな grub エントリを選んで、ブートします。SystemRescueCDを使用している場合には、GRUB のコマンドラインで以下を入力:

{{GenericCmd|freedos}}

新たに作成した FreeDOS イメージが起動し、DOS プロンプトが出迎えてくれるでしょう:

{{CodeBox|C:\}}

そこで、製造業者の説明に従ってBIOSの更新を始めます。ちなみに、DOS では以下のコマンドが役にたちます:

; {{c|cd <dir>}}
: ディレクトリの変更

; {{c|dir}}
: 現在のディレクトリ内のファイルの一覧表示

; {{c|type [drive][path]filename}}
: ファイルの内容を表示

== flashrom ==

マザーボードによっては、システム起動中に（{{package|sys-apps/flashrom}} を通じて）直接に更新することができます。この場合に必要なのは BIOS イメージだけです。この場合はまず[http://flashrom.org/Supported_hardware 対応ハードウェア]のリストを確認してください。

ハードウェアが対応していれば、新たな BIOS イメージをチェック:

{{RootCmd|flashrom -v W7235IMS.1A0}}

すべて確認したら、これを書き込みましょう:

{{RootCmd|flashrom -vw W7235IMS.1A0}}

== 参考 ==

* [[BIOS]]
* [[Bootable DOS USB stick]]

[[Category:Core system]]
