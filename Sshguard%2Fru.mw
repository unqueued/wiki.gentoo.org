<languages />

{{InfoBox stack
|{{InfoBox homepage|http://www.sshguard.net/|header=true}}
|{{InfoBox ohloh}}
}}

{{Metadata|abstract=sshguard — это система предотвращения вторжений, которая разбирает логи сервера, определяет подозрительную активность и затем использует системный межсетевой экран, чтобы блокировать IP-адреса злонамеренных подключений.}}

'''sshguard''' is an intrusion prevention system that parses server logs, determines malicious activity, and uses the system firewall to block the IP addresses of malicious connections. sshguard is written in C so it does not tax an interpretor.

== Как это работает ==

sshguard is a simple daemon that continuously tracks one or more log files. It parses the log events that daemons send out in case of failed login attempts and then blocks any further attempts from those connections by updating the system's firewall.

Несмотря на название, sshguard разбирает не только логи SSH. Он также поддерживает многие почтовые системы, а также некоторые системы FTP. Полный список поддерживаемых устройств можно найти на [http://www.sshguard.net sshguard.net сайте программы].

== Installation ==

=== Emerge ===

Установите {{Package|app-admin/sshguard}}:

{{Emerge|app-admin/sshguard}}

Also make sure that {{Package|net-firewall/iptables}} is installed and used as the system firewall. At the time of writing, sshguard does not yet support {{Package|net-firewall/nftables}}.

{{Emerge|net-firewall/iptables}}

More information about using and configuring IPtables can also be found on the [[Iptables|IPtables article]].

== Configuration ==

=== Подготовка файрвола ===

Когда sshguard блокирует какого-либо вредоносного пользователя (блокируя его IP адрес), он будет использовать цепочку <tt>sshguard</tt>.

Подготовьте цепочку и удостоверьтесь, что она вызывается при обнаружении новых входящих соединений:

{{RootCmd|iptables -N sshguard
|iptables -A INPUT -j sshguard}}

=== Просмотр logfiles ===

Базовая идея, стоящая за sshguard состоит в том, что администратор указывает файлы логов, которые необходимо просматривать в качестве опций. Не существует файла настроек конкретно для программы sshguard.

На Gentoo опции лучше всего определять в файле {{Path|/etc/conf.d/sshguard}}:

{{FileBox|filename=/etc/conf.d/sshguard|title=Configuring sshguard to read /var/log/messages|lang=bash|1=
PARDONTIME="3600" # Blocks last at least 1 hour (3600 seconds)
WATCHTIME="360"   # Track IP addresses for 5 minutes (360 seconds)
THRESHOLD="10"    # How many problematic attempts trigger a block
  
LOGFILES="-l /var/log/messages"                      # Watch this file...
LOGFILES="${LOGFILES} -l /var/log/auth.log"          # And this one
  
SSHGUARD_OPTS="-p ${PARDONTIME} -s ${WATCHTIME} -a ${THRESHOLD} ${LOGFILES}"
}}

Убедитесь в том, что файлы логов доступны пользователю, под которым работает sshguard.

=== Запуск в качестве сервиса ===

Запускайте sshguard по умолчанию, добавив его к уровню запуска default, а затем запустите его:

{{RootCmd|rc-update add sshguard default
|rc-service sshguard start}}

== Смотри также ==

* [[Iptables]], информация по установке и настройке <tt>iptables</tt> на Gentoo

== Внешние источники ==

[http://www.sshguard.net/docs/ Документация по sshguard] дает всю необходимую информацию для дальнейшей настройки приложения.


[[Category:Security]]
[[Category:Server]]
