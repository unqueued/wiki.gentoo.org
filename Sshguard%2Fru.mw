<languages />


{{InfoBox stack
|{{InfoBox homepage|http://www.sshguard.net/|header=true}}
|{{InfoBox ohloh}}
}}
{{Metadata|abstract=sshguard это система предотвращения вторжений, которая разбирает логи сервера, определяет подозрительную активность и затем использует системный файрвол, чтобы блокировать данные IP-адреса.}}

'''sshguard''' это система предотвращения вторжений. sshguard разбирает логи сервера, определяет подозрительную активность и банит вредоносных пользователей с помощью правил файрвола. sshguard написан на C, поэтому он не нагружает систему.

== Как это работает ==

Пакет {{Package|app-admin/sshguard}} это простой демон, который постоянно отслеживает изменения в одном или более файле логов. Он разбирает события логов, которые демоны посылают в случае неудавшихся попыток логина, а затем блокирует любые дальнейшие попытки логина от вредоносных пользователей, обновляя правила системного файрвола.

Несмотря на название, sshguard разбирает не только логи SSH. Он также поддерживает многие почтовые системы, а также некоторые системы FTP. Полный список поддерживаемых устройств можно найти на [http://www.sshguard.net sshguard.net сайте программы].

== Настройка ==

=== Программное обеспечение ===

Установите {{Package|app-admin/sshguard}}:

{{Emerge|app-admin/sshguard}}

Также удостоверьтесь, что пакет {{Package|net-firewall/iptables}} установлен и используется в качестве системного файрвола. Во время написания данной статьи, sshguard еще не поддерживал {{Package|net-firewall/nftables}}.

{{Emerge|net-firewall/iptables}}

Более детальная информация об использовании и настройке [[Iptables|iptables]] может быть найдена на Gentoo wiki.

=== Подготовка файрвола ===

Когда sshguard блокирует какого-либо вредоносного пользователя (блокируя его IP адрес), он будет использовать цепочку <tt>sshguard</tt>.

Подготовьте цепочку и удостоверьтесь, что она вызывается при обнаружении новых входящих соединений:

{{RootCmd|iptables -N sshguard
|iptables -A INPUT -j sshguard}}

=== Просмотр logfiles ===

Базовая идея, стоящая за sshguard состоит в том, что администратор указывает файлы логов, которые необходимо просматривать в качестве опций. Не существует файла настроек конкретно для программы sshguard.

На Gentoo опции лучше всего определять в файле {{Path|/etc/conf.d/sshguard}}:

{{FileBox|filename=/etc/conf.d/sshguard|title=Настройка sshguard на чтение /var/log/messages|lang=bash|1=
PARDONTIME="3600" # Блокирует на 1 час (3600 секунд)
WATCHTIME="360"   # Отслеживает IP адреса 5 минут (360 секунд)
THRESHOLD="10"    # Сколько неудавшихся попыток приводят к блокировке
  
LOGFILES="-l /var/log/messages"                      # Просматривать данный файл...
LOGFILES="${SSHGUARD_LOGFILES} -l /var/log/auth.log" # И этот тоже
  
SSHGUARD_OPTS="-p ${PARDONTIME} -s ${WATCHTIME} -a ${THRESHOLD} ${LOGFILES}"
}}

Убедитесь в том, что файлы логов доступны пользователю, под которым работает sshguard.

=== Запуск в качестве сервиса ===

Запускайте sshguard по умолчанию, добавив его к уровню запуска default, а затем запустите его:

{{RootCmd|rc-update add sshguard default
|rc-service sshguard start}}

== Смотри также ==

* [[Iptables]], информация по установке и настройке <tt>iptables</tt> на Gentoo

== Внешние источники ==

[http://www.sshguard.net/docs/ Документация по sshguard] дает всю необходимую информацию для дальнейшей настройки приложения.


[[Category:Security]]
[[Category:Server]]
