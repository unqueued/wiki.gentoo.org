<languages />
硬件生产商经常会提供 BIOS 和其他固件的更新。要安装（经常被称成为“刷新）这些更新并不很简单，有时需要一些额外的工作。

{{Warning/zh-cn|如果硬件正常工作，通常不需要升级 BIOS。如果升级出现问题，可能会对 BIOS 活着系统固件造成永久性损害，并且你可能失去保修资格。操作时千万小心！}}

== 获取固件信息 ==

首先你需要确认主板生产商和型号。请检查系统附带的用户手册，通常用户手册涵盖所有需要的信息。

你也可以用 {{package|sys-apps/dmidecode}} 来获取一些信息。<code>dmicode</tt> 通过查看主板上的 DMI table 来提供关于固件和硬件模块的丰富细节。

{{RootCmd|dmidecode -t bios -t baseboard}}

最后，如果可以直接查看主板，需要的信息或许会直接在主板上找到。

{{Warning/zh-cn|直接查看电脑主板可能会导致失去保修！}}

在硬件厂商的网站搜索固件更新，下载硬件更新必要的包。硬件生产商通常会将硬件升级文件打包为zip，exe 或者 iso 格式。 

{{Cmd|unzip 7235v1A.zip
|output=<pre>Archive:  7235v1A.zip
   creating: 7235v1A/
inflating: 7235v1A/7235v1x.txt
inflating: 7235v1A/AWFL865.EXE
inflating: 7235v1A/How to flash the BIOS.DOC
inflating: 7235v1A/W7235IMS.1A0
</pre>}}

== BIOS 选项 ==

Many BIOSes have an option to read the new binary image from an external memory stick or floppy disk. Enter the BIOS setup and look for the option. If the BIOS does not support this, continue with the next section.

== 引导光盘 ==

Often the manufacturer offers a CD-ROM image to download as a boot medium. The file should have an {{Path|.iso}} file extension which should be properly burned to an empty CD-R(W). One of the tools that supports this is <tt>cdrecord</tt>:

{{RootCmd|cdrecord BOOT-CD.iso}}

{{Note|<tt>cdrecord</tt> is provided by two packages. Choose one of the following: {{Package|app-cdr/cdrtools}} and {{Package|app-cdr/cdrkit}}.}}

Choose from the BIOS boot menu to boot from CD and follow the instructions on the manufacturers website or in the user manual.

== FreeDOS environment ==

FreeDOS can be used to run DOS-based BIOS update utilities. A "custom" FreeDOS image which includes the necessary BIOS tools must be created. After the custom image has been generated, boot the image via one of the methods shown below.

下载 FreeDOS 和工具:

* [http://www.ibiblio.org/pub/micro/pc-stuff/freedos/files/distributions/1.0/ FreeDOS] - Download the {{Path|fdboot.img}} file.
* [http://www.ibiblio.org/pub/micro/pc-stuff/freedos/files/dos/sys/sys-freedos-linux/ FreeDOS bootsector] - Download the {{Path|sys-freedos-linux.zip}} file.
* The DOS-Flash program and new BIOS from the manufacturers website.

=== Create a custom FreeDOS image ===

First download the required software and enable the loopback device in the kernel:

{{KernelBox|title=启用 loopback device|1=
Device Drivers  --->
    [*] Block devices  --->
        <M>   Loopback device support
}}

If the module has not been loaded use <tt>modprobe</tt> to load it:

{{RootCmd|modprobe loop}}

Install the required software:

{{Emerge|dev-lang/nasm app-arch/unzip sys-fs/dosfstools}}

Create an image file of ~20MB using the <tt>dd</tt> command. The name needs to be {{Path|freedos.img}} when replacing the one on the SystemRescueCD):

{{RootCmd|dd if{{=}}/dev/null of{{=}}freedos.img bs{{=}}1024 seek{{=}}20480}}

为镜像创建文件系统：

{{RootCmd|mkfs.msdos freedos.img}}

将 bootsector 写入镜像文件：

{{RootCmd|unzip sys-freedos-linux.zip && ./sys-freedos.pl --disk{{=}}freedos.img}}

Now copy the FreeDOS files to the new image.

Create the mountpoints:

{{RootCmd|mkdir -p /mnt/freedos /mnt/freedos_new}}

挂载原来的镜像：

{{RootCmd|mount -o loop fdboot.img /mnt/freedos}}

挂载新的镜像：

{{RootCmd|mount -o loop freedos.img /mnt/freedos_new}}

Copy the FreeDOS system files to the new image:

{{RootCmd|cp -ar /mnt/freedos/* /mnt/freedos_new/}}

Now copy the flash program and the new BIOS to the image file:

{{RootCmd|cp -ar FLASH-PROGRAM BIOS-UPDATE /mnt/freedos_new}}

卸载两个镜像：

{{RootCmd|umount /mnt/freedos_new /mnt/freedos}}

{{Note|DOS can only display names up to a length of 8 characters. It is a good idea to rename some of the files if their filenames are longer than this limit.}}

=== 使用 SystemRescueCD 启动 FreeDOS ===

The SystemRescueCD comes with a version of FreeDOS. This version can replace the original image and create a bootable memory stick which contains the needed programs to flash the firmware.

==== 下载 SystemRescueCD 并准备 LiveUSB ====

* [http://www.sysresccd.org/Download SystemRescueCD] - Download the normal ISO image.

==== Create a bootable memory stick ====

Use the default method to create the SystemRescueCD boot medium, the script {{Path|usb_inst.sh}} will provide guidance through the installation.

{{Warning|This will delete any data on the memory stick! Be sure all data has been properly backed up before using the memory stick for this task!}}

在 {{Path|/mnt}} 下创建目录:

{{RootCmd|mkdir /mnt/SysRescueCD}}

挂载 CD 镜像：

{{RootCmd|mount -o loop systemrescuecd-x86-VERSION.iso /mnt/SysRescueCD}}

运行安装脚本：

{{RootCmd|/mnt/SysRescueCD/usb_inst.sh}}

卸载 CD 镜像:

{{RootCmd|umount /mnt/SysRescueCD}}

==== 替换 FreeDOS 镜像 ====

It is time to replace the original FreeDOS image on the SystemRescueCD memory stick.

Mount the SystemRescueCD memory stick ({{Path|/dev/sdX1}} needs to be replaced by the device name of the memory stick):

{{RootCmd|mount /dev/sdX1 /mnt/SysRescueCD}}

替换 {{Path|freedos.img}} 文件：

{{RootCmd|cp freedos.img /mnt/SysRescueCD/bootdisk/}}

卸载 SytemRescueCD 记忆棒：

{{RootCmd|umount /mnt/SysRescueCD}}

=== 在 GRUB 中直接启动 FreeDOS 镜像 ===

To boot FreeDOS without any external media use the <tt>memdisk</tt> tool from syslinux to allow grub (or another bootloader) to boot the FreeDOS image directly.

{{Emerge|sys-boot/syslinux}}

Mount the {{Path|/boot}} partition (if needed):

{{RootCmd|mount /boot}}

Copy the <tt>memdisk</tt> binary and the newly built FreeDOS image to {{Path|/boot}}:

{{RootCmd|cp /usr/share/syslinux/memdisk /boot}}
{{RootCmd|cp freedos.img /boot}}

编辑 {{Path|/boot/grub/grub.conf}} 文件， 给FreeDOS添加一条：

{{FileBox|filename=/boot/grub/grub.conf|title=grub.conf 条目实例|1=
title FreeDOS (BIOS update)
kernel /boot/memdisk floppy
initrd /boot/freedos.img
}}

=== BIOS update ===

Restart and choose to boot from the USB memory stick ''or'' the new grub entry. When using SystemRescueCD, in the GRUB command line type:

{{GenericCmd|freedos}}

This should boot into the new FreeDOS image. The DOS prompt should appear:

{{CodeBox|C:\}}

Now start the BIOS update by following the manufacturers instructions. Some useful commands in DOS:

; <tt>cd <dir></tt>
: Change to the directory.

; <tt>dir</tt>
: List the files in the current directory.

; <tt>type </tt>
: Display the contents of a file.

== Flashrom ==

Some motherboards can support flashing (via the {{Package|sys-apps/flashrom}} package) directly from the system. In this case the only needed component is the BIOS image. Before continuing this path, first check the list of [http://flashrom.org/Supported_hardware supported hardware].

If the hardware is supported, verify the new BIOS image:

{{RootCmd|flashrom -v W7235IMS.1A0}}

If everything checks out, then flash it:

{{RootCmd|flashrom -vw W7235IMS.1A0}}

== 参考 ==

* [[Bootable DOS USB stick]]

[[Category:Core system]]
