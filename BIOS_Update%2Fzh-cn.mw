<languages />
硬件生产商经常会提供[[BIOS]] 和其他固件的更新。要安装（经常被称成为“刷新）这些更新并不很简单，有时需要一些额外的工作。

{{Warning/zh-cn|如果硬件正常工作，通常不需要升级 BIOS。如果升级出现问题，可能会对 BIOS 活着系统固件造成永久性损害，并且你可能失去保修资格。操作时千万小心！}}

== 获取固件信息 ==

首先你需要确认主板生产商和型号。请检查系统附带的用户手册，通常用户手册涵盖所有需要的信息。

你也可以用 {{package|sys-apps/dmidecode}} 来获取一些信息。{{c|dmidecode}} 通过查看主板上的 DMI table 来提供关于固件和硬件模块的丰富细节。

{{RootCmd|dmidecode -t bios -t baseboard}}

最后，如果可以直接查看主板，需要的信息或许会直接在主板上找到。

{{Warning/zh-cn|直接查看电脑主板可能会导致失去保修！}}

在硬件厂商的网站搜索固件更新，下载硬件更新必要的包。硬件生产商通常会将硬件升级文件打包为zip，exe 或者 iso 格式。 

{{Cmd|unzip 7235v1A.zip
|output=<pre>Archive:  7235v1A.zip
   creating: 7235v1A/
inflating: 7235v1A/7235v1x.txt
inflating: 7235v1A/AWFL865.EXE
inflating: 7235v1A/How to flash the BIOS.DOC
inflating: 7235v1A/W7235IMS.1A0
</pre>}}

== BIOS 选项 ==

很多 BIOS 有一个选项可以从外部记忆棒或者软盘读取二进制映像。进入 BIOS 设置并查找此选项。如果 BIOS 不支持此选项，请继续下一节。

== 引导光盘 ==

通常硬件厂商会提供一个光盘镜像的下载，作为引导媒介。该文件应该以 {{Path|.iso}} 为后缀，可以烧录到一张空的 CD-R(W)中。支持烧录的工具之一是 {{c|cdrecord}}:

{{RootCmd|cdrecord BOOT-CD.iso}}

{{Note/zh-cn|两个包都提供{{c|cdrecord}} 命令。你只需要安装其中的一个: {{Package|app-cdr/cdrtools}} 和 {{Package|app-cdr/cdrkit}}}}

在 BIOS 启动菜单中选择从光盘启动，按照你的硬件厂商网站上的说明进行更新。

== FreeDOS 环境 ==

FreeDOS 可以用来运行基于 DOS 的 BIOS 更新工具。首先必须首创建一个“定制”的 FreeDOS 镜像，包含必要的 BIOS 工具。然后通过下面的方法用这个镜像启动。

下载 FreeDOS 和工具:

* [https://www.ibiblio.org/pub/micro/pc-stuff/freedos/files/distributions/1.0/ FreeDOS] - 下载{{Path|fdboot.img}} 文件。
* [https://www.ibiblio.org/pub/micro/pc-stuff/freedos/files/dos/sys/sys-freedos-linux/ FreeDOS bootsector] - 下载 {{Path|sys-freedos-linux.zip}} 文件。
* DOS-Flash 程序和你的硬件厂商网站提供的新的BIOS。

=== 定制 FreeDOS 镜像 ===

首先下载安装必要的软件，并在内核中启用 loopback device 选项：

{{KernelBox|title=启用 loopback device|1=
Device Drivers  --->
    [*] Block devices  --->
        <M>   Loopback device support
}}

如果模块还没有加载使用{{c|modprobe}} 加载：

{{RootCmd|modprobe loop}}

安装必要的软件：

{{Emerge|dev-lang/nasm app-arch/unzip sys-fs/dosfstools}}

使用{{c|dd}}创建一个大小约 20M 的镜像文件。文件名必须是 {{Path|freedos.img}}，用于替换 SystemRescueCD 中的文件：

{{RootCmd|dd if{{=}}/dev/null of{{=}}freedos.img bs{{=}}1024 seek{{=}}20480}}

为镜像创建文件系统：

{{RootCmd|mkfs.fat freedos.img}}

将 bootsector 写入镜像文件：

{{RootCmd|unzip sys-freedos-linux.zip && ./sys-freedos.pl --disk{{=}}freedos.img}}

现在拷贝 FreeDOS 文件到新镜像。

创建加载点：

{{RootCmd|mkdir -p /mnt/freedos /mnt/freedos_new}}

挂载原来的镜像：

{{RootCmd|mount -o loop fdboot.img /mnt/freedos}}

挂载新的镜像：

{{RootCmd|mount -o loop freedos.img /mnt/freedos_new}}

拷贝 FreeDOS 系统文件到新镜像：

{{RootCmd|cp -ar /mnt/freedos/* /mnt/freedos_new/}}

现在拷贝 flash 刷新程序和新的 BIOS 到镜像文件：

{{RootCmd|cp -ar FLASH-PROGRAM BIOS-UPDATE /mnt/freedos_new}}

卸载两个镜像：

{{RootCmd|umount /mnt/freedos_new /mnt/freedos}}

{{Note/zh-cn|DOS 下文件名最多只能显示8个字符。如果文件名长度超过此限制，对这些文件进行重命名是个好主意。}}

=== 使用 SystemRescueCD 启动 FreeDOS ===

SystemRescueCD 自带一个版本的 FreeDOS，这个版本可以替换掉原有的镜像，创建一个包含刷新我们的固件所必须的程序的、可以启动的记忆棒。

==== 下载 SystemRescueCD 并准备 LiveUSB ====

* [https://www.sysresccd.org/Download SystemRescueCD] -下载 ISO 镜像

==== 创建一个可启动的记忆棒 ====

使用默认的方法创建 SystemRescueCD 启动媒介, 脚本 {{Path|usb_inst.sh}} 将会引导安装过程。

{{Warning/zh-cn|这会删除记忆棒上所有的数据。确保使用前的记忆棒任务所有数据已经正确备份!}}

在 {{Path|/mnt}} 下创建目录:

{{RootCmd|mkdir /mnt/SysRescueCD}}

挂载 CD 镜像：

{{RootCmd|mount -o loop systemrescuecd-x86-VERSION.iso /mnt/SysRescueCD}}

运行安装脚本：

{{RootCmd|/mnt/SysRescueCD/usb_inst.sh}}

卸载 CD 镜像:

{{RootCmd|umount /mnt/SysRescueCD}}

==== 替换 FreeDOS 镜像 ====

是时候替换掉记忆棒中的 SystemRescueCD 原有的 FreeDOS 镜像了。

挂载SystemRescueCD记忆棒 ({{Path|/dev/sdX1}}需要修过为记忆棒设备名称):

{{RootCmd|mount /dev/sdX1 /mnt/SysRescueCD}}

替换 {{Path|freedos.img}} 文件：

{{RootCmd|cp freedos.img /mnt/SysRescueCD/bootdisk/}}

卸载 SytemRescueCD 记忆棒：

{{RootCmd|umount /mnt/SysRescueCD}}

=== 在 GRUB 中直接启动 FreeDOS 镜像 ===

如果你不想借助其他媒介，直接从 grub （或者其他启动器）中直接启动你的FreeDOS镜像，你可以使用 syslinux 中的{{c|memdisk}} 工具。

{{Emerge|sys-boot/syslinux}}

挂载你的{{Path|/boot}}分区 （如果需要的话）：

{{RootCmd|mount /boot}}

拷贝{{c|memdisk}}和你新建的 FreeDOS 镜像到 {{Path|/boot}}:

{{RootCmd|cp /usr/share/syslinux/memdisk /boot}}
{{RootCmd|cp freedos.img /boot}}

编辑 {{Path|/boot/grub/grub.conf}} 文件， 给FreeDOS添加一条：

{{FileBox|filename=/boot/grub/grub.conf|title=grub.conf 条目实例|1=
title FreeDOS (BIOS update)
kernel /boot/memdisk floppy
initrd /boot/freedos.img
}}

=== BIOS 升级  ===

重启并选择从 USB 启动或者你新加的 grub 启动项。如果使用SystemRescueCD，在 GRUB 命令行中输入：

{{GenericCmd|freedos}}

这将启动到我们新的 FreeDOS 镜像，你应该会看到 DOS 提示符：

{{CodeBox|C:\}}

现在你可以按照生产商的提示升级 BIOS。一些有用的 DOS 命令：

; {{c|cd <dir>}}
: 改变目录。

; {{c|dir}}
: 列出当前目录中的文件。

; {{c|type [drive][path]filename}}
: 显示一个文件的内容。

== Flashrom ==

一些主板能支持 flashing (直接从系统升级通过2个{{Package|sys-apps/flashrom}} 包) 。在这种情况下,只需要下载BIOS镜像文件，继续之前,首先查看列表[https://flashrom.org/Supported_hardware supported hardware]。

如果硬件支持，首先我们检查我们新的 BIOS 镜像：

{{RootCmd|flashrom -v W7235IMS.1A0}}

如果没有问题，让我们进行更新：

{{RootCmd|flashrom -vw W7235IMS.1A0}}

== 参考 ==

* [[BIOS]]
* [[Bootable DOS USB stick]]

[[Category:Core system]]
[[Category:Firmware]]
