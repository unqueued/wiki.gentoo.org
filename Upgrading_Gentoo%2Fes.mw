<languages />

{{Metadata|abstract=Este documento explica cómo las nuevas versiones de Gentoo afectan a instalaciones ya existentes.}}

Este documento explica cómo las nuevas versiones de Gentoo afectan a instalaciones ya existentes.

== Actualizaciones ==

=== Filosofía ===

Aquí en la tierra de Gentoo, el concepto de actualización es muy distinto comparado al resto del mundo Linux. Es un hecho conocido que Gentoo no está familiarizado con la forma "clásica" de actualizar software: esperar una nueva versión, descargarla, grabarla, ponerla en
el lector de CDROM y luego seguir las instrucciones de actualización. 

Los usuarios de Gentoo ya saben sin embargo que este proceso es extremadamente frustrante para aquellos usuarios avanzados que quieren tener su sistema siempre a la última. Seguramente incluso usuarios avanzados de otras distribuciones tengan la misma sensación, dada la popularidad y expansión de herramientas como apt o apt-rpm que hacen posible disponer de actualizaciones de forma rápida y frecuente. Sin embargo, ninguna distribución es más adecuada que Gentoo para satisfacer a este tipo de usuarios exigentes. Desde el principio Gentoo se diseñó en torno al concepto 
de actualizaciones rápidas e incrementales. 

Ideally, users install software once and never bother with releases: just follow the instructions in [[Handbook:X86/Working/Portage|A Portage Introduction]] in the [[Handbook:X86|Gentoo handbook]] that explain how to keep the system up to date. While that's the way things usually go, sometimes changes are made to the core system which require updates to be done manually.

=== Versiones y perfiles ===

Una pregunta que se repite sobre el proceso de publicación de versiones de Gentoo es: "¿Por qué liberar nuevas versiones frecuentemente si no están pensadas para ofrecer a sus usuarios la
actualización del software?". Hay varias razones: 

* Una nueva versión supone nuevos CDs de Instalación con errores corregidos y nuevas funcionalidades
* Una nueva versión proporciona un conjunto actualizado de paquetes GRP, por lo que aquellos usuarios que elijan "el modo rápido" de instalación (stage3 + paquetes precompilados) terminarán con un sistema que no está pasado de moda
* Por último, una nueva versión puede, de cuando en cuando, implementar algunas funcionalidades que no eran compatibles en versiones anteriores

Cuando una versión incluye nuevas funcionalidades anteriormente incompatibles o proporciona una serie de paquetes y configuraciones críticas que modifican intensamente el comportamiento del sistema, decimos que dicha versión ofrece un nuevo "perfil". 

Un ''perfil'' (profile) es una serie de ficheros de configuración almacenados en un subdirectorio dentro de {{Path|/usr/portage/profiles}} que definen cosas como los ficheros ebuild que se consideran paquetes ''system'', los ajustes USE por defecto, el mapeo por defecto de los paquetes virtuales y la arquitectura en la que se ejecuta el sistema. 

El perfil en uso se determina por el enlace simbólico {{Path|/etc/portage/make.profile}} el cual apunta a un subdirectorio dentro de {{Path|/usr/portage/profiles}} donde se almacenan todos los perfiles. Por ejemplo, el perfil por defecto de la versión 13.0 para {{Keyword|x86}} se puede encontrar en {{Path|/usr/portage/profiles/default/linux/x86/13.0}}. Los ficheros del directorio precedente también forman parte del perfil (y, por lo tanto, se comparten entre diferentes subperfiles diferentes). Ésta es la razón por la que los llamamos ''perfiles en cascada''. 

Los perfiles anticuados se guardan en {{Path|/usr/portage/profiles}} junto con los actuales pero marcados como obsoletos. Cuando eso sucede, se añade un fichero llamado {{Path|deprecated}} dentro del directorio del perfil obsoleto. El contenido de este fichero es el nombre del perfil al cual debería "actualizarse". Portage emplea esta información para avisar a los administradores automáticamente cuando deben actualizar a un nuevo perfil. 

Hay varias razones por la que se puede crear un nuevo perfil nuevo: la publicación de nuevas versiones de paquetes principales 
(como {{Package|sys-apps/baselayout}} , {{Package|sys-devel/gcc}} o {{Package|sys-libs/glibc}}) que son incompatibles con versiones previas, un cambio en los ajustes 
USE por defecto o en la relación entre los paquetes virtuales y los paquetes utilizados, o tal vez un cambio en la configuración que afecta a todo el sistema.

== Mantenerse al día con nuevas versiones ==

=== Versiones sin cambios de perfil ===

Si se anuncia una nueva versión de Gentoo que no incluye un nuevo perfil entonces se puede aparentar con seguridad que nunca ha ocurrido. :&#41; 

When the installed packages are upgraded as [[Handbook:X86/Working/Portage|explained]] in the Gentoo Handbook, then the system will be exactly the same as one that has been installed using the new release.

=== Versiones con cambio de perfil ===

If a release (such as 13.0 for {{Keyword|x86}}) introduces a new profile, then there is the choice to migrate to the new profile. 

Generally, such migrations are not mandatory, and systems can continue to use the old profile - just update the packages as [[Handbook:X86/Working/Portage|explained]] in the Gentoo Handbook. 

However, Gentoo strongly recommends updating the profile if it becomes deprecated. When this happens, it means that Gentoo developers no longer plan on supporting it. 

When a profile migration is apparent, then the upgrade has to be executed manually. The way to update may vary significantly from release to release; it depends on how deep the modifications introduced in the new profile are. 

In the simplest case users only have to change the {{Path|/etc/portage/make.profile}} symlink, in the worst case they may have to recompile the entire system from scratch while doing a neat voodoo dance. Migration is usually covered in the release notes. The necessary [[#Profile_updating_instructions|instructions]] are explained further in this guide.

=== Perfiles soportados ===

To view the list of supported profiles, call {{c|eselect}} (which can be installed using {{c|emerge eselect}}) as follows: 

{{RootCmd|eselect profile list}}

=== Actualizar desde sistemas antiguos ===

Algunos sistemas son tan antiguos que no es puede simplemente cambiar el perfil. Los nuevos perfiles podrían necesitar versiones más recientes de Portage u otro software que no se puede instalar debido a que las definiciones de los paquetes (ebuilds) para esas versiones antiguas del software ya no están disponibles.

En este caso, el sistema debe recibir en primer lugar instantáneas del árbol de Portage más antiguas y actualizar al menos Portage (pero es preferible que se actualicen todos los paquetes del conjunto system), se incrementa gradualmente la fecha de las instantáneas del árbol Portage hasta que sea lo suficientemente reciente para poder seguir de nuevo las instrucciones de cambio de perfil:

{{RootCmd
|mv /usr/portage /usr/portage.latest
|tar xjpf /path/to/portage-20090720.tar.bz2 -C /usr
|emerge -u portage
}}

Las instantáneas antiguas a menudo están disponibles en algunos servidores réplica en Internet o en [https://dev.gentoo.org/~swift/snapshots/ localizaciones específicas] para este propósito. Se recomienda verificar la integridad de estos ficheros para asegurarse de que no fueron modificados:

{{RootCmd|gpg --verify portage-20090720.tar.bz2.gpgsig portage-20090720.tar.bz2}}

Aunque las [[Project:RelEng#Keys|claves de firmado]] podrían haber expirado, la firma debería ser correta aún.

=== Actualizar desde sistemas (demasiado) antiguos ===

En ocasiones, los sistemas son tan antiguos que es complicado actualizarlos. En el camino para su actualización puede que se requieran versiones intermedias de software (como portage) que ya no existen, y por tanto se podría necesitar una actualización del árbol de portage en pasos (por ejemplo actualizaciones incrementales del árbol con pasos de tres o cuatro meses). 

To upgrade such systems, a recent stage3 can be used to update the system. Instructions for that are given in the [[#Updating_old_systems|Updating old systems]] section.

== Instrucciones para actualizar el perfil ==

=== Instrucciones generales ===

{{Important|Make sure the main Gentoo repository (the Portage tree) has been synced before performing any profile changes.}}

First, run {{c|emerge eselect}}. The {{c|eselect}} utility makes viewing and selecting profiles easy, without needing to create or remove symlinks by hand. 

{{RootCmd|eselect profile list |eselect profile set <número>}}

Changing profiles manually is still supported though: 

{{RootCmd
|rm /etc/portage/make.profile
|cd /etc/portage
|ln -s ../../usr/portage/profiles/<selected profile> make.profile
}}

{{Note|There are '''desktop''' and '''server''' subprofiles for most architectures. Examine these profiles carefully, as they may serve the requirements better than the extremely minimal default profiles.}}

{{Note/es|El subperfil de desarrollador está específicamente pensado para labores de desarrollo de Gentoo Linux. ''No'' tiene como objetivo configurar entornos generales de desarrollo.}}

=== Actualizar a 2008.0, 2007.0 ó 2006.1 ===

Be aware that, if an upgrade from these profiles is selected, that they expect the system to be set to a Unicode locale by default; specifically that <code>UNICODE="yes"</code> is set in {{Path|/etc/rc.conf}}. For this to work, a Unicode locale for the system must be created. Please read the [[UTF-8|UTF-8 article]] to learn how to create the proper locale. 

Alternatively, if setting a locale is not preferred, then users need to specify UNICODE="no" in {{Path|/etc/rc.conf}}, and re-emerge {{Package|sys-apps/baselayout}} (or wait until the next baselayout update) with the <code>-unicode</code> USE flag. This can be accomplished through:


* Configurar <code>-unicode</code> únicamente para {{Package|sys-apps/baselayout}} de esta forma:
: {{RootCmd|echo "sys-apps/baselayout -unicode" >> /etc/portage/package.use}}
: {{Emerge|sys-apps/baselayout}}

* or setting it globally for all packages by adding it to the USE variable in {{Path|/etc/portage/make.conf}}:
: {{FileBox|filename=/etc/portage/make.conf|title=Disable unicode support globally|lang=bash|1=USE="-unicode"}}
: {{Emerge|sys-apps/baselayout}}

{{Note|Users updating to a 2007.0 profile on the Sparc architecture will need to follow the [[Upgrading_GCC|GCC Upgrading Guide]], as <code>gcc-4</code> is the default compiler.}}

Finally, follow the general upgrade instructions for updating the profile.

=== Actualizar a 2006.0 ===

To switch to the 2006.0 profile, point the {{Path|/etc/portage/make.profile}} symlink to the new location. Make sure Portage is updated before changing the profile. 

{{RootCmd
|rm /etc/portage/make.profile
|ln -s ../usr/portage/profiles/<selected profile> /etc/portage/make.profile
}}

{{Keyword|alpha}}. Los usuarios que utilicen un núcleo 2.4 o no quieran usar NPTL, deberían escoger el perfil default-linux/alpha/no-nptl. Dispone de más información en [http://www.gentoo.org/proj/en/releng/release/2006.0/alpha-release-notes.xml las notas de la versión para alpha]. 

{{Keyword|ppc}} - The merge of the ppc32 and ppc64 profiles went forward. The ppc32 profile has been changed in a way that offers a minimalistic generic profile for all purposes, located in default-linux/ppc/ppc32. The release-dependent profile is optimized for desktop-usage and located in default-linux/ppc/ppc32/2006.0. There are some subprofiles available for G3 and G4 processors, and G3/Pegasos and G4/Pegasos for the Pegasos Open Desktop Workstation. Make sure to choose the correct subprofile for the system when migrating to a 2006.0 profile. 

{{Keyword|sparc}} - Actualizar al perfil 2006.0/2.4 para los núcleos de la rama '''2.4''' requiere la intervención del usuario (desinstalar cosas de java), además de un {{c|emerge -e @world}} debido a la
[[Upgrading_GCC/es|actualización de gcc]]. Actualizar al perfil 2006.0 para los núcleos de la rama '''2.6''' que no estén considerados como estables requiere también una entrada en {{Path|/etc/portage package.unmask}} para desenmascarar una versión 2.6 de {{Package|sys-kernel/gentoo-sources}} además de una reconstrucción completa. 

'''Resto de arquitecturas''' - No hay cambios importantes en este perfil. No es necesaria ninguna acción especial para realizar el cambio.

=== Actualizar a 2005.1 ===

To switch to the 2005.1 profile, point the {{Path|/etc/portage/make.profile}} symlink to the new location. Make sure Portage is updated before changing the profile. 

{{RootCmd|rm /etc/portage/make.profile
|ln -s ../usr/portage/profiles/<perfil seleccionado> /etc/portage/make.profile}}

'''Todas las arquitecturas''' -No hay cambios esenciales en este perfil. No se necesitan realizar acciones específicas. 

{{Keyword|ppc}} - With the 2005.1 release, the ppc and ppc64 profiles were merged and a number of subprofiles for specific subarchitectures were created. Make sure to choose the correct subprofile for the system when migrating to a 2005.1 profile. 

=== Actualizar a 2005.0 ===

With the introduction of 2005.0, several architectures have decided to define additional profiles. Make sure to read the description of said profiles before deciding to migrate to one of them. Most architectures now also default to the 2.6 kernel tree where 2.4 was chosen previously. 

Algunas arquitecturas necesitan unas cuantas acciones más para llevar
a cabo el cambio de un perfil a otro. Si es ese el caso, las guías
paso a paso están enlazadas desde la siguiente tabla. 

{| class="table table-striped table-condensed" style="text-align: left;"
|-
! Perfil
! Descripción
! Guía específica de actualización
|-
| default-linux/alpha/2005.0
| Default Alpha 2005.0 profile for 2.6 kernels
|
|-
| default-linux/alpha/2005.0/2.4
| Alpha 2005.0 profile for 2.4 kernels
|
|-
| default-linux/amd64/2005.0
| Default AMD64 2005.0 profile for 2.6 kernels
|
|-
| default-linux/amd64/2005.0/no-multilib
| AMD64 2005.0 profile for multilib-disabled system installations
|
|-
| default-linux/arm/2005.0
| Default ARM 2005.0 profile for 2.6 kernels
|
|-
| default-linux/hppa/2005.0
| Default HPPA 2005.0 profile for 2.6 kernels
|
|-
| default-linux/hppa/2005.0/2.4
| HPPA 2005.0 profile for 2.4 kernels
|
|-
| default-linux/mips/2005.0
| Default MIPS 2005.0 profile
|
|-
| default-linux/mips/cobalt/2005.0
| Cobalt specific MIPS 2005.0 profile
|
|-
| default-linux/mips/mips64/n32/2005.0
| 2005.0 profile for n32-supporting MIPS platforms
|
|-
| default-linux/mips/mips64/ip28/2005.0
| Indigo2 Impact specific 64-bit 2005.0 profile
|
|-
| default-linux/mips/mips64/2005.0
| 64-bit MIPS 2005.0 profile
|
|-
| default-linux/ppc/2005.0
| Default PPC 2005.0 profile for 2.6 kernels
|
|-
| default-linux/ppc64/2005.0
| Default PPC64 2005.0 profile for 2.6 kernels
|
|-
| default-linux/s390/2005.0
| Default S390 2005.0 profile
|
|-
| default-linux/sparc/sparc32/2005.0
| Default Sparc 32-bit 2005.0 profile
|
|-
| default-linux/sparc/sparc64/2005.0
| Default Sparc 64-bit 2005.0 profile
|
|-
| default-linux/x86/2005.0
| Default x86 2005.0 profile for 2.6 kernels
|
|-
| default-linux/x86/2005.0/2.4
| x86 2005.0 profile for 2.4 kernels
|
|-
|}

To switch to the selected profile, point the {{Path|/etc/portage/make.profile}} symlink to the new location. Make sure Portage is updated before changing the profile! 

{{RootCmd|rm /etc/portage/make.profile
|ln -s ../usr/portage/profiles/<perfil seleccionado> /etc/portage/make.profile}}

When an upgrade is planned from a Linux 2.4-based system to a 2.6 kernel, make sure to read our [[Kernel/Migrate_2.4_to_2.6|Gentoo Linux 2.6 Migration Guide]].

=== Actualizar a 2004.3 ===

Con la introducción de los perfiles 2004.3, los usuarios no van a ver enormes modificaciones en sus sistemas (vea los detalles más abajo). Sin embargo, los desarrolladores de Gentoo decidieron desplazar este nuevo perfil y deshacerse de un número considerable de otros antiguos para acelerar la adopción de los ''perfiles apilados'', que no son más que los perfiles que siguen la nueva distribución del directorio {{Path|/usr/portage/profiles}}, por ejemplo {{Path|/usr/portage/profiles/default-linux/x86/2004.3}} (soportado por Portage 2.0.51 y versiones posteriores). 

Para cambiar al perfil 2004.3, apunte el enlace simbólico {{Path|/etc/portage/make.profile}} a la nueva ubicación: 

{{Warning/es|¡No olvidarse de actualizar Portage ''antes'' de cambiar el perfil!}}

{{RootCmd|rm /etc/portage/make.profile
|ln -s ../usr/portage/profiles/default-linux/<arquitectura>/2004.3 /etc/portage/make.profile}}

'''All archs''' - As said above, there are no big changes introduced in this profile. However, it should be noted that {{Package|sys-apps/slocate}} and {{Package|net-misc/dhcpcd}} are no longer considered system packages. This means that during a {{c|emerge --depclean}}, Portage will try to remove them from the system. If any of those packages are needed, add them to {{Path|/var/lib/portage/world}} after the profile switch, or manually emerge them. 

{{keyword|ppc}} - Ahora se utiliza {{Package|sys-fs/udev}} por defecto en lugar de {{Package|sys-fs/devfs}} para las nuevas instalaciones. Esto no tiene ningún efecto en las máquinas en las que ya se ha realizado la instalación.

=== Actualizar Portage para que ofrezca soporte a perfiles en cascada ===

Aunque esta sección no parezca que se integre bien en esta guía de actualización, es muy importante. Cualquier perfil listado encima de esta sección requiere de una versión de Portage que soporte perfiles en cascada. Sin embargo, algunos perfiles obsoletos no permiten al usuario actualizar Portage o el usuario está utilizando un perfil que ya no se encuentra disponible por lo que cualquier intento de actualizar Portage fallará. 

To work around this problem, users can set a temporary symbolic link to the ''obsolete'' profile, allowing them to upgrade their Portage after which they can continue with the upgrade procedure set forth in this guide. Please substitute <code><nowiki><arch></nowiki></code> with the respective system architecture: 

{{RootCmd
|rm /etc/portage/make.profile
|cd /etc/portage
|ln -sf ../usr/portage/profiles/obsolete/<arch> make.profile
|emerge -n '>{{=}}sys-apps/portage-2.0.51'
}}

=== Actualizar a 2004.2 ===

Para cambiar al perfil 2004.2, apunte el enlace simbólico {{Path|/etc/portage/make.profile}} a la nueva ubicación: 

{{Warning/es|¡¡¡No olvidarse de actualizar Portage ''antes'' de cambiar el perfil!!!}}

{{RootCmd|rm /etc/portage/make.profile |ln -s ../usr/portage/profiles/default-linux/<arquitectura>/2004.2 /etc/portage/make.profile}}

{{Keyword|x86}} - This profile changes the default X11 implementation from <s>{{Package|x11-base/xfree}}</s> (deprecated) to {{Package|x11-base/xorg-x11}}. This change only touches the ''default'' value, and is only relevant for those who have not installed an X server yet. If one is already installed, then it will not affect the system at all; users are free to switch from one X server to the other exactly as before. 

{{Keyword|amd64}}. No hay cambios esenciales desde perfiles anteriores, por lo que no se necesitan realizar acciones específicas.

=== Actualizar a 2004.0 ===

Para cambiar al perfil 2004.0, apunte el enlace simbólico {{Path|/etc/portage/make.profile}} a la nueva ubicación: 

{{RootCmd
|rm /etc/portage/make.profile
|ln -s ../usr/portage/profiles/default-<arch>-2004.0 /etc/portage/make.profile
}}

'''Para todas las arquitecturas'''. No hay cambios esenciales desde perfiles anteriores, por lo que no se necesitan realizar acciones específicas. 

=== Actualizar a 1.4 desde perfiles anteriores a éste ===

The instructions for this upgrade are quite complex, and can be found [https://gentoo-handbook.lugons.org/doc/en/new-upgrade-to-gentoo-1.4.xml here]. 

== Actualizar sistemas antiguos ==

=== La idea de la actualización  ===

La idea del enfoque de esta actualización es que vamos a crear
una jaula chroot intermedia de construcción en la que extraeremos
un stage3 reciente. A continuación, utilizando las herramientas disponibles en la jaula del stage3, actualizaremos los paquetes del sistema vivo. 

{{Warning/es|Las órdenes descritas abajo pueden ser incompletas y deben servir más como guía que como instrucciones de trabajo. A menos que el enfoque esté claro, podría resultar más rápido hacer una copia de respaldo de los ficheros y reinstalar Gentoo.}}

=== Preparar la jaula chroot intermedia para la construcción ===

En primer lugar creamos la localización de la jaula intermedia de
construcción, digamos {{Path|/mnt/build}} y extraemos un archivo stage3 reciente en ella. 

{{RootCmd
|mkdir -p /mnt/build
|tar -xf /ruta/a/stage3-arquitectura-fecha.tar.bz2 -C /mnt/build
|mount --rbind /dev /mnt/build/dev
|mount --rbind /proc /mnt/build/proc
|mount --rbind /sys /mnt/build/sys
}}

A continuación creamos un punto de montaje dentro de este entorno chroot, en el cual montaremos el entorno vivo (antiguo) con la opción bind. 

{{RootCmd
|mkdir -p /mnt/build/mnt/host
|mount --rbind / /mnt/build/mnt/host
}}

Ahora también se puede acceder al sistema vivo (antiguo) a través de {{Path|/mnt/build/mnt/host}}. Esto nos permitirá acceder al sistema vivo (antiguo) y actualizar los paquetes incluso cuando están dentro de la jaula chroot intermedia de construcción.

=== Red, chroot y actualización ===

La nueva instalación necesita acceder a la red, por lo tanto, copie la información relacionada a través de la red:

{{RootCmd|cp -L /etc/resolv.conf /mnt/build/etc/}}

Now chroot into the intermediate build location, and start updating vital packages on the live system, until the live system can be updated from within the live system (rather than through the intermediate build chroot):

{{RootCmd
|chroot /mnt/build
|source /etc/profile
|export PS1{{=}}"(chroot) ${PS1}"}}

{{GenericCmd|prompt=(chroot) root #|color=red|emerge --sync}}

<!-- The following section is being tested... do not uncomment (author: Maffblaster -->
<!--Make sure the profile in the chroot matches the one inside the (old) live system. Run the following command in both environments to make sure profiles match:

{{RootCmd|eselect profile list}}
{{GenericCmd|prompt=(chroot) root #|color=red|eselect profile list}}

Verify Portage's configuration files in the new chroot are the same as the ones set in the old system. The following command will recursively copy the profile from the (old) live system into the chroot 

{{GenericCmd|prompt=(chroot) root #|color=red
|cp -rv /mnt/host/etc/portage /etc
|cp -rv /mnt/host/var/lib/portage /var/lib
}}

{{Note|Look at the output of the above commands to verify everything has copied correctly. There may be errors if some path names in the (old) live system were directories. For example, if {{Path|/etc/portage/package.use}} is a directory in the host, then it will probably not get copied correctly to the chroot system.}}
-->

Now start building packages into the (old) live system. If Portage is old or missing, it is a good idea to start with that:

{{GenericCmd|prompt=(chroot) root #|color=red|emerge --root{{=}}/mnt/host --config-root{{=}}/mnt/host --verbose --oneshot sys-apps/portage}}

Keep this chrooted session open and try to update the (old) live system. When failures occur, use this chrooted session to update packages using the build tools available in the intermediate build chroot (which includes recent {{Package|sys-libs/glibc}}, {{Package|sys-devel/gcc}}, etc.). Tools can be added as needed to the build chroot.

{{Important|Do not forget to add <code>--root{{=}}/mnt/host --config-root{{=}}/mnt/host</code> to all {{c|emerge}} commands executed within the chroot! Otherwise the chroot itself is updated rather than the (old) live system.}}

For some installations it may be necessary to update configuration files in order to install new software. Make the changes in the chroot environment.

To get the system fully up-to-date before exiting the root, build the <code>@world</code> set (all packages) into the (old) live system:

{{GenericCmd|prompt=(chroot) root #|color=red|emerge --root{{=}}/mnt/host --config-root{{=}}/mnt/host --update --newuse --deep --ask @world}}

Una vez finalizado, el sistema debería estar actualizado.

[[Category:Server and Security]] {{Migrated|originalauthors=Gregorio Guidi, Chris Gianelloni, Joshua Saddler}}
