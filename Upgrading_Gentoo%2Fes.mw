<languages />


{{Metadata|abstract=Este documento explica cómo las nuevas versiones de Gentoo afectan a instalaciones ya existentes.}}

Este documento explica cómo las nuevas versiones de Gentoo afectan a instalaciones ya existentes.

== Gentoo y las actualizaciones ==

=== Filosofía ===

Aquí en la tierra de Gentoo, el concepto de actualización es muy distinto comparado al resto del mundo Linux. Probablemente ya sepa que nosotros no nos familiarizamos con el modo "clásico" de actualizar software: esperar una nueva versión, descargarla, grabarla, ponerla en
el lector de CDROM y luego seguir las instrucciones de actualización. 

Ya sabe (después de todo es un usuario de) que este proceso es extremadamente frustrante para aquellos usuarios avanzados que quieren tener su sistema siempre a la última. Seguramente 
incluso usuarios avanzados de otras distribuciones tengan la misma sensación, dada la popularidad y expansión de herramientas como apt o apt-rpm que hacen posible disponer de actualizaciones de forma rápida y frecuente. Sin embargo, ninguna distribución es más adecuada que Gentoo para satisfacer a este tipo de usuarios exigentes. Desde el principio Gentoo se diseñó en torno al concepto 
de actualizaciones rápidas e incrementales. 

Lo ideal sería que instale una sola vez y no preocuparse de futuras versiones: simplemente seguir las instrucciones de la 
[http://www.gentoo.org//doc/ed/handbook/handbook-x86.xml?part=2&chap=1 A Introducción a Portage] en el [http://www.gentoo.org//doc/es/handbook/ Manual de Gentoo] que explica cómo mantener su sistema al día. Aunque esa es la forma con la que normalmente funcionan las cosas, a veces los cambios se hacen en los paquetes base del sistema los cuales requieren de una actualización manual. 

=== Versiones y perfiles ===

Una pregunta que se repite sobre el proceso de publicación de versiones de Gentoo es: "¿Por qué liberar nuevas versiones frecuentemente si no están pensadas para ofrecer a sus usuarios la
actualización del software?". Hay varias razones: 

* Una nueva versión supone nuevos CDs de Instalación con errores corregidos y nuevas funcionalidades
* Una nueva versión proporciona un conjunto actualizado de paquetes GRP, por lo que aquellos usuarios que elijan "el modo rápido" de instalación (stage3 + paquetes precompilados) terminarán con un sistema que no está pasado de moda
* Por último, una nueva versión puede, de cuando en cuando, implementar algunas funcionalidades que no eran compatibles en versiones anteriores

Cuando una versión incluye nuevas funcionalidades anteriormente incompatibles o proporciona una serie de paquetes y configuraciones críticas que modifican intensamente el comportamiento del sistema, decimos que dicha versión ofrece un nuevo "perfil". 

Un ''perfil'' (profile) es una serie de ficheros de configuración almacenados en un subdirectorio dentro de {{Path|/usr/portage/profiles}} que definen cosas como los ficheros ebuild que se consideran paquetes ''system'', los ajustes USE por defecto, el mapeo por defecto de los paquetes virtuales y la arquitectura en la que se ejecuta el sistema. 

El perfil en uso se determina por el enlace simbólico {{Path|/etc/portage/make.profile}} el cual apunta a un
subdirectorio dentro de {{Path|/usr/portage/profiles}} donde se almacenan todos los perfiles. Por ejemplo, el perfil por defecto de la versión 13.0 para x86 se puede encontrar en {{Path|/usr/portage/profiles/default/linux/x86/13.0}}. Los ficheros del directorio precedente también forman parte del perfil (y, por lo tanto, se comparten entre diferentes subperfiles diferentes). Ésta es la razón por la que los llamamos ''perfiles en cascada''. 

Los perfiles anticuados se guardan en {{Path|/usr/portage/profiles}} junto con los actuales pero marcados como obsoletos. Cuando eso sucede, se añade un fichero llamado {{Path|deprecated}} dentro del directorio del perfil obsoleto. El contenido de este fichero es el nombre del perfil al cual debería "actualizarse". Portage emplea esta información para avisarle automáticamente cuando tenga que actualizar a un nuevo perfil. 

Hay varias razones por la que se puede crear un nuevo perfil nuevo: la publicación de nuevas versiones de paquetes principales 
(como {{Package|baselayout}} , {{Package|gcc}} o {{Package|glibc}}) que son incompatibles con versiones previas, un cambio en los ajustes 
USE por defecto o en la relación entre los paquetes virtuales y los paquetes utilizados, o tal vez un cambio en la configuración que afecta a todo el sistema.

== Mantenerse al día con nuevas versiones ==

=== Versiones sin cambios de perfil ===

Si se anuncia una nueva versión de Gentoo que no incluye un
nuevo perfil entonces puede aparentar con seguridad que nunca
ha ocurrido. :&#41; 

Si actualiza los paquetes instalados [http://www.gentoo.org/doc/es/handbook/handbook-x86.xml?part=2&chap=1 como se explica en el manual de Gentoo], su sistema quedará exactamente igual que si hubiera reinstalado utilizando la nueva versión. 

=== Versiones con cambio de perfil ===

Si una nueva versión (por ejemplo la 13.0 para x86) añade un perfil nuevo, tiene la posibilidad de migrar a ese nuevo perfil. 

Naturalmente, no está obligado a hacerlo y puede continuar utilizando el perfil antiguo y actualizar únicamente sus paquetes [http://www.gentoo.org/doc/es/handbook/handbook-x86.xml?part=2&chap=1 como se explica en el manual de Gentoo]. 

Sin embargo, Gentoo recomienda encarecidamente la actualización del
perfil si éste quedara obsoleto. Cuando ésto ocurre, significa que
los desarrolladores de Gentoo no planean ofrecer soporte. 

Si decide migrar al nuevo perfil, tendrá que realizar la actualización
de forma manual. El modo de actualizar puede variar significativamente entre una versión y otra, depende del nivel de importancia de las modificaciones introducidas en el nuevo perfil. 

En el más simple de los casos, solo tendrá que cambiar el enlace simbólico {{Path|/etc/portage/make.profile}}. En el peor de los casos, puede que tenga que recompilar su sistema desde cero mientras hace un afinado baile vudú. La migración normalmente está cubierta en las notas de cada nueva versión. También puede encontrar en esta guía [[#Instrucciones_para_actualizar_el_perfil|instrucciones]] para actualizar el perfil.

=== Perfiles soportados ===

Puede ver la lista de perfiles para su arquitectura que están soportados oficialmente por los desarrolladores de Gentoo haciendo <code>emerge eselect</code> y lanzando la siguiente orden a continuación: 

{{RootCmd|eselect profile list}}

=== Actualizar desde sistemas antiguos ===

Algunos sistemas son tan antiguos que no es puede simplemente cambiar el perfil. Los nuevos perfiles podrían necesitar versiones más recientes de Portage u otro software que no se puede instalar debido a que las definiciones de los paquetes (ebuilds) para esas versiones antiguas del software ya no están disponibles.

En este caso, el sistema debe recibir en primer lugar instantáneas del árbol de Portage más antiguas y actualizar al menos Portage (pero es preferible que se actualicen todos los paquetes del conjunto system), se incrementa gradualmente la fecha de las instantáneas del árbol Portage hasta que sea lo suficientemente reciente para poder seguir de nuevo las instrucciones de cambio de perfil:

{{RootCmd|mv /usr/portage /usr/portage.latest |tar xjpf /camino/a/portage-20090720.tar.bz2 -C /usr |emerge -u portage}}

Las instantáneas antiguas a menudo están disponibles en algunos servidores réplica en Internet o en [https://dev.gentoo.org/~swift/snapshots/ localizaciones] específicas para este propósito. Se recomienda verificar la integridad de estos ficheros para asegurarse de que no fueron modificados:

{{RootCmd|gpg --verify portage-20090720.tar.bz2.gpgsig portage-20090720.tar.bz2}}

Aunque las claves de firmado hayan expirado, la firma debería ser correcta.

=== Actualizar desde sistemas (demasiado) antiguos ===

En ocasiones, los sistemas son tan antiguos que es complicado actualizarlos. En el camino para su actualización puede que se requieran versiones intermedias de software (como portage) que ya no existen, y por tanto podría necesitar una
actualización del árbol de portage en pasos (por ejemplo actualizaciones incrementales del árbol con pasos de tres o cuatro meses). 

Para actualizar estos sistemas, puede utilizar un stage3 reciente para poner al día el sistema. Las instrucciones 
para realizar esto se dan en la sección [[#Actualizar_sistemas_antiguos|Actualizar sistemas antiguos]].

== Instrucciones para actualizar el perfil ==

=== Instrucciones generales ===

{{Important/es|Asegúrese de que su Portage esté actualizado antes de llevar a cabo cualquier cambio de perfil.}}

En primer lugar, lance <code>emerge eselect</code>. La utilidad <code>eselect</code> le permitirá ver y seleccionar perfiles de forma sencilla, sin necesidad de crear o eliminar manualmente enlaces simbólicos. 

{{RootCmd|eselect profile list |eselect profile set <número>}}

Si de todos modos prefiere cambiar el perfil manualmente, entonces simplemente haga lo siguiente: 

{{RootCmd|rm /etc/portage/make.profile
|cd /etc/portage
|ln -s ../../usr/portage/profiles/<perfil seleccionado> make.profile}}

{{Note/es|Existen subperfiles '''desktop''' y '''server''' para la mayoría de arquitecturas. Examine estos perfiles con cuidado ya que pueden servir mejor sus necesidades que los perfiles por defecto que son 
excesivamente mínimos.}}

{{Note/es|El subperfil <code>developer</code> (desarrollador) está específicamente pensado para labores de desarrollo de Gentoo Linux. ''No'' tiene como objetivo configurar entornos generales de desarrollo.}}

=== Actualizar a 2008.0, 2007.0 ó 2006.1 ===

Si tiene la intención de actualizar a estos perfiles, debería saber
que estos esperan a que el sistema esté configurado a una localización por defecto; concretamente que UNICODE="yes" esté definido en 
{{Path|/etc/rc.conf}}. Para que esto funcione, debe tener creadas unas localizaciones Unicode para su sistema. Por favor, lea el  [[UTF-8|artículo sobre UTF-8]] para aprender a crear las localizaciones adecuadas. 

Como alternativa, si no desea definir localizaciones, debería entonces
especificar UNICODE="no" en
{{Path|/etc/rc.conf}}  y volver a hacer
emerge de <code>baselayout</code> (o esperar hasta la próxima actualización
de <code>baselayout</code>) con el parámetro USE <code>-unicode</code>. Puede definir <code>-unicode</code> solo para <c>baselayout</c> o de modo global para todos los paquetes, añadiéndolo en su variable USE en {{Path|/etc/portage/make.conf}}. 

{{RootCmd|echo "sys-apps/baselayout -unicode" >> /etc/portage/package.use |emerge -a baselayout}}

{{File|/etc/portage/make.conf|Deshabilitar el soporte para unicode globalmente|<pre>
USE="-unicode"
</pre>}}

{{Emerge|baselayout}}

Si está actualizando a un perfil 2007.0 en la arquitectura Sparc, necesitará seguir la [[Upgrading_GCC/es|Guía de actualización de GCC]], puesto que <code>gcc-4</code> es el compilador
predeterminado.

Por último, siga las instrucciones generales de para actualizar su perfil.

=== Actualizar a 2006.0 ===

Para cambiar al perfil 2006.0, apunte el enlace simbólico {{Path|/etc/portage/make.profile}} a la nueva ubicación.
Asegúrese de que Portage está actualizado antes de cambiar su perfil. 

{{RootCmd|rm /etc/portage/make.profile
|ln -s ../usr/portage/profiles/<perfil seleccinado> /etc/portage/make.profile}}

'''alpha''' - Los usuarios que utilicen un núcleo 2.4 o no quieran usar NPTL, deberían escoger el perfil
default-linux/alpha/no-nptl. Dispone de más información en [http://www.gentoo.org/proj/en/releng/release/2006.0/alpha-release-notes.xml las notas de la versión para alpha]. 

'''ppc''' - La unión de los perfiles ppc32 y ppc64 es ya un hecho. El perfil ppc32 ha cambiado de tal modo que ahora se presenta sencillo y genérico, para cualquier propósito, ubicado en default-linux/ppc/ppc32. Este nuevo perfil está optimizado para uso de escritorio y se halla en default-linux/ppc/ppc32/2006.0. Hay varios subperfiles disponibles para procesadores G3 y G4; también se dispone de G3/Pegasos y G4/Pegasos para la estación de trabajo Pegasos Open Desktop. Asegúrese de escoger el adecuado para su sistema cuando
cambie a un perfil 2006.0. 

'''sparc''' - Actualizar al perfil 2006.0/2.4 para los núcleos de la
rama '''2.4''' requiere de la intervención del usuario (desinstalar
cosas de java), además de un <code>emerge -e world</code> debido a 
[[Upgrading_GCC/es|actualización de gcc]]. Actualizar al perfil 2006.0 para los núcleos de la rama '''2.6''' que no estén considerados como estables requiere también una entrada en {{Path|/etc/portage package.unmask}} para desenmascarar una versión 2.6 del paquete <code>gentoo-sources</code>, además de una reconstrucción completa. 

'''Resto de arquitecturas''' - No hay cambios importantes en este perfil. No es necesaria ninguna acción especial para realizar el cambio.

=== Actualizar a 2005.1 ===

Para cambiar al perfil 2005.1, apunte el enlace simbólico {{Path|/etc/portage/make.profile}} a la nueva ubicación.
Asegúrese de que su Portage está actualizado antes de cambiar su perfil. 

{{RootCmd|rm /etc/portage/make.profile
|ln -s ../usr/portage/profiles/<perfil seleccionado> /etc/portage/make.profile}}

'''Todas las arquitecturas''' -No hay cambios esenciales en este perfil. No se necesitan realizar acciones específicas. 

'''Para ppc''' - Con la versión 2005.1, los perfiles ppc y ppc64 se
han unido y creado un número de subperfiles para subarquitecturas concretas. Asegúrese de elegir el subperfil correcto para su sistema cuando migre a un perfil 2005.1. 

=== Actualizar a 2005.0 ===

Con la llegada de la versión 2005.0, varias arquitecturas han decidido
definir perfiles adicionales. Asegúrese de leer la descripción de
dichos perfiles antes de decidir migrar a uno de ellos. Ahora la mayoría de arquitecturas también utilizan por defecto la rama 2.6 del
núcleo cuando era la 2.4 la que se escogía anteriormente. 

Algunas arquitecturas necesitan unas cuantas acciones más para llevar
a cabo el cambio de un perfil a otro. Si es ese el caso, las guías
paso a paso están enlazadas desde la siguiente tabla. 

{| class="wikitable" style="text-align: left;"
|-
! Perfil
! Descripción
! Guía específica de actualización
|-
| default-linux/alpha/2005.0
| Default Alpha 2005.0 profile for 2.6 kernels
|
|-
| default-linux/alpha/2005.0/2.4
| Alpha 2005.0 profile for 2.4 kernels
|
|-
| default-linux/amd64/2005.0
| Default AMD64 2005.0 profile for 2.6 kernels
|
|-
| default-linux/amd64/2005.0/no-multilib
| AMD64 2005.0 profile for multilib-disabled system installations
|
|-
| default-linux/arm/2005.0
| Default ARM 2005.0 profile for 2.6 kernels
|
|-
| default-linux/hppa/2005.0
| Default HPPA 2005.0 profile for 2.6 kernels
|
|-
| default-linux/hppa/2005.0/2.4
| HPPA 2005.0 profile for 2.4 kernels
|
|-
| default-linux/mips/2005.0
| Default MIPS 2005.0 profile
|
|-
| default-linux/mips/cobalt/2005.0
| Cobalt specific MIPS 2005.0 profile
|
|-
| default-linux/mips/mips64/n32/2005.0
| 2005.0 profile for n32-supporting MIPS platforms
|
|-
| default-linux/mips/mips64/ip28/2005.0
| Indigo2 Impact specific 64-bit 2005.0 profile
|
|-
| default-linux/mips/mips64/2005.0
| 64-bit MIPS 2005.0 profile
|
|-
| default-linux/ppc/2005.0
| Default PPC 2005.0 profile for 2.6 kernels
|
|-
| default-linux/ppc64/2005.0
| Default PPC64 2005.0 profile for 2.6 kernels
|
|-
| default-linux/s390/2005.0
| Default S390 2005.0 profile
|
|-
| default-linux/sparc/sparc32/2005.0
| Default Sparc 32-bit 2005.0 profile
|
|-
| default-linux/sparc/sparc64/2005.0
| Default Sparc 64-bit 2005.0 profile
|
|-
| default-linux/x86/2005.0
| Default x86 2005.0 profile for 2.6 kernels
|
|-
| default-linux/x86/2005.0/2.4
| x86 2005.0 profile for 2.4 kernels
|
|-
|}

Para cambiar al perfil seleccionado, apunte el enlace simbólico {{Path|/etc/portage/make.profile}} a la nueva ubicación. ¡Asegúrese de que Portage está actualizado antes de cambiar su
perfil! 

{{RootCmd|rm /etc/portage/make.profile
|ln -s ../usr/portage/profiles/<perfil seleccionado> /etc/portage/make.profile}}

Si está corriendo un sistema basado en Linux 2.4 pero quiere migrar a un núcleo basado en 2.6, asegúrese de leer nuestra [[Kernel/Migrate_2.4_to_2.6|Guía de migración a Linux 2.6]].

=== Actualizar a 2004.3 ===

With the introduction of the 2004.3 profiles, users are not going to see huge modifications of their systems (see below for details). However, Gentoo developers decided to push out this new profile and to deprecate quite a few of the old ones to speed up the adoption of ''stacked profiles'', that is, the profiles that follow the new layout of the {{Path|/usr/portage/profiles}} directory, for instance {{Path|/usr/portage/profiles/default-linux/x86/2004.3}} (supported by Portage 2.0.51 or later). 

To switch to the 2004.3 profile, point the {{Path|/etc/portage/make.profile}} symlink to the new location: 

{{Warning|Don't forget to upgrade Portage ''before'' you change your profile!!!}}

{{RootCmd|rm /etc/portage/make.profile
|ln -s ../usr/portage/profiles/default-linux/<arquitectura>/2004.3 /etc/portage/make.profile}}

'''All archs''' - As said above, there are no big changes introduced in this profile. However, it should be noted that <code>sys-apps/slocate</code> and <code>net-misc/dhcpcd</code> are no longer considered system packages. This means that if you run <code>emerge --depclean</code>, Portage will try to remove them from your system. If you need any of those packages, add them to {{Path|/var/lib/portage/world}} after the profile switch, or manually emerge them. 

'''ppc''' -<code>sys-fs/udev</code> is now the default instead of <code>sys-fs/devfs</code> for newly installed machines. This has no effect on already installed machines, though.

=== Updating Portage to Support Cascading Profiles ===

Although this section does not seem to integrate well in this upgrading guide, it is quite important. Any profile listed above this section requires a Portage version that supports cascading profiles. However, some obsoleted profiles don't allow the user to upgrade Portage or the user is using a profile that isn't available anymore - any attempt to upgrade Portage will result in a failure. 

To work around this problem, users can set a temporary symbolic link to the ''obsolete'' profile, allowing them to upgrade their Portage after which they can continue with the upgrade procedure set forth in this guide. Please substitute <code><arch></code> with your respective architecture: 

{{RootCmd|rm /etc/portage/make.profile
|cd /etc/portage
|ln -sf ../usr/portage/profiles/obsolete/<arquitectura> make.profile
|emerge -n '>{{=}}sys-apps/portage-2.0.51'}}

=== Updating to 2004.2 ===

To switch to the 2004.2 profile, point the {{Path|/etc/portage/make.profile}} symlink to the new location: 

{{Warning|Don't forget to upgrade Portage ''before'' you change your profile!!!}}

{{RootCmd|rm /etc/portage/make.profile
|ln -s ../usr/portage/profiles/default-linux/<arch>/2004.2 /etc/portage/make.profile}}

'''x86''' - This profile changes the default X11 implementation from <code>x11-base/xfree</code> to <code>x11-base/xorg-x11</code>. This change only touches the ''default'' value, and is only relevant for those who have not installed an X server yet. If you already have one installed, then it will not affect you at all; you are free to switch from one X server to the other exactly as before. 

'''amd64''' - There are no fundamental changes from previous profiles, no specific action needs to be performed.

=== Updating to 2004.0 ===

To switch to the 2004.0 profile, point the {{Path|/etc/portage/make.profile}} symlink to the new location: 

{{RootCmd|rm /etc/portage/make.profile
|ln -s ../usr/portage/profiles/default-<arquitectura>-2004.0
/etc/portage/make.profile}}

'''All archs''' - There are no fundamental changes from previous profiles, no specific action needs to be performed. 

=== Updating from profiles older than 1.4 to 1.4 ===

The instructions for this upgrade are quite complex, you can find them [http://www.gentoo.org//doc/en/new-upgrade-to-gentoo-1.4.xml here] . 

== Actualizar sistemas antiguos ==

=== Idea of the upgrade ===

The idea with this upgrade approach is that we create an intermediate build chroot in which a recent stage3 is extracted. Then, using the tools available in the stage3 chroot we upgrade the packages on the live system. 

{{Warning|The commands below might be incomplete and serve more as a guidance rather than work instructions. Unless the approach is clear, it might be faster to just backup the important files and re-install Gentoo.}}

=== Preparing the intermediate build chroot ===

Let's first create the intermediate build chroot location, say {{Path|/mnt/build}} , and extract a recent stage3 archive into it. 

{{RootCmd|mkdir /mnt/build
|tar -xf /camino/a/stage3-algunaarquitectura-algunafecha.tar.bz2 -C /mnt/build
|mount --rbind /dev /mnt/build/dev
|mount --rbind /proc /mnt/build/proc
|mount --rbind /sys /mnt/build/sys}}

Next, we create a mount point inside this chroot environment, on which we then bind-mount the live (old) environment. 

{{RootCmd|mkdir /mnt/build/mnt/host
|mount --rbind / /mnt/build/mnt/host}}

So now the live (old) system is also reachable within {{Path|/mnt/build/mnt/host}} . This will allow us to reach the live (old) system and update the packages even when chrooted inside the intermediate build chroot.

=== Network, Chroot and update ===

The new install needs to access the network, so copy over the network related information:

{{RootCmd|cp -L /etc/resolv.conf /mnt/build/etc/}}

We now chroot into the intermediate build location, and start updating vital packages on the live system, until we can continue updating the live system from within the live system (rather than through the intermediate build chroot). 

{{RootCmd|chroot /mnt/build
|source /etc/profile
|export PS1="(chroot) $PS1"
|emerge --sync}}
 

Now we start building packages onto the live system

{{RootCmd|ROOT{{=}}/mnt/host emerge -1v portage}}

Keep this chrooted session open and try to update the live system. When you hit failures, you can use this chrooted session to update packages using the build tools available in the intermediate build chroot (which includes recent glibc, gcc, etc.) Don't forget to prefix all <code>emerge</code> commands with <code>ROOT=/mnt/host</code> within the chroot!

== Agradecimientos ==

Nos gustaría dar las gracias a los siguientes autores y editores por sus contribuciones a esta guía:


* Gregorio Guidi
* Chris Gianelloni
* Joshua Saddler

[[Category:Server and Security]]
